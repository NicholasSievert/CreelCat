#### Initial Elements ####

##### Load Libraries #####
library(shiny)
library(googlesheets4)
library(shinyWidgets)
library(shinythemes)
library(DT)
library(shinyBS)
library(webshot)
library(rgdal)
library(dataRetrieval)
library(tidyverse)
library(plotly)
library(shinyjs)
library(shinyFiles)
library(googledrive)
library(zip)
library(crosstalk)
library(RColorBrewer)
library(sf)
library(sp)
library(leaflet.extras)
library(leaflet.extras2)
library(mapedit)
library(leafem)
library(shinycssloaders)
library(htmlwidgets)
library(tidyverse)
library(readxl)
library(Rcpp)


##### EasyPrint JS File #####
jsfile <- "https://rawgit.com/rowanwins/leaflet-easyPrint/gh-pages/dist/bundle.js"

load("www/CreelCat_Input.RData")

CountyBoundaries_SHP<-CountyBoundaries_SHP%>%
  mutate(County_ID=paste(State,County,sep="_"))

options(spinner.color="#0275D8", spinner.color.background="#ffffff", spinner.size=2)


#### User Interface ####
ui <- fluidPage(theme=shinytheme("yeti"),
                
##### Turn on JS #####
useShinyjs(), 

tags$style(type="text/css",
   ".shiny-output-error { visibility: hidden; }",
   ".shiny-output-error:before { visibility: hidden; }"
),

##### Application title and Navigation Bar #####

sidebarLayout(position=c("right"),
             
  sidebarPanel(id="sidebar",
    actionButton("DataSelHide","Hide Sidebar",class = "btn-warning btn-md"),
    br(),
    br(),
    
    bsCollapse(id="SelData_SelectCollapse",open="SelDataChoice", 
      bsCollapsePanel(HTML("Select Data&nbsp",as.character(actionLink(inputId = "SelDataChoice_Help", HTML('<i class="fas fa-book-open"></i>'))), as.character(actionLink(inputId = "SelDataChoice_Tip", HTML('<i class="fas fa-info-circle"></i>')))), value="SelDataChoice",
                               
     radioGroupButtons("SelDataContents",status='primary',h5(strong(HTML("Select Surveys&nbsp", as.character(actionLink(inputId = "VisSelectSurveysTip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("All","Filters","Map"),selected="0"),
                                           
    conditionalPanel(condition="input.SelDataContents=='Filters'",
        pickerInput("SelDataCustomTableFilters_Picker",h5(strong(HTML("Select Filters&nbsp", as.character(actionLink(inputId = "VisSelectSurveysTip_Filter", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("State","County","Year","Duration","Start Month","End Month","Survey Type","Waterbody Type","Waterbody Name","Waterbody Area"),  multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    conditionalPanel(condition="input.SelDataCustomTableFilters_Picker!=''",
        h5(strong(HTML("Set Filters&nbsp", as.character(actionLink(inputId = "VisSelectSurveysTip_FilterSet", HTML('<i class="fas fa-info-circle"></i>')))))),
    ),
        conditionalPanel(condition="input.SelDataCustomTableFilters_Picker.indexOf('State')>-1",
                         pickerInput("SelDataStateFilterPicker",strong("Select States:"),choices=sort(StateChoice),multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
       ),
      conditionalPanel(condition="input.SelDataCustomTableFilters_Picker.indexOf('County')>-1",
                         pickerInput("SelDataCountyFilterPicker",strong("Select Counties:"),choices=sort(County_IDChoice),multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
       ),
       
        conditionalPanel(condition="input.SelDataCustomTableFilters_Picker.indexOf('Year')>-1",
          fluidRow(
            column(12,
                   sliderInput("SelDataYearFilterSlider",strong("Select Year Range:"),min=min(Survey_Data$Year,na.rm=TRUE),max=max(Survey_Data$Year,na.rm=TRUE),step=1,value=c(min(Survey_Data$Year,na.rm=TRUE),min(Survey_Data$Year,na.rm=TRUE)),sep = ""),
                   ),
            column(width=6,align="left",
                   numericInput("SelDataYearFilter_Min","First Year:",min(Survey_Data$Year,na.rm=TRUE),min(Survey_Data$Year,na.rm=TRUE),max(Survey_Data$Year,na.rm=TRUE)),
                   ),
            column(width=6,align="left",
                   numericInput("SelDataYearFilter_Max","Last Year:",min(Survey_Data$Year,na.rm=TRUE),min(Survey_Data$Year,na.rm=TRUE),max(Survey_Data$Year,na.rm=TRUE)),
                   ),
          ),
           ),
        
        conditionalPanel(condition="input.SelDataCustomTableFilters_Picker.indexOf('Duration')>-1",
          fluidRow(
            column(12,
              sliderInput("SelDataDurationFilterSlider",strong("Select Duration Range:"),min=min(Survey_Data$Duration,na.rm=TRUE),max=max(Survey_Data$Duration,na.rm=TRUE),step=1,value=c(min(Survey_Data$Duration,na.rm=TRUE),min(Survey_Data$Duration,na.rm=TRUE)),sep = ""),
                   ),
            column(width=6,align="left",
                   numericInput("SelDataDurationFilter_Min","Min:",min(Survey_Data$Duration,na.rm=TRUE),min(Survey_Data$Duration,na.rm=TRUE),max(Survey_Data$Duration,na.rm=TRUE)),
                   ),
            column(width=6,align="left",
                   numericInput("SelDataDurationFilter_Max","Max:",min(Survey_Data$Duration,na.rm=TRUE),min(Survey_Data$Duration,na.rm=TRUE),max(Survey_Data$Duration,na.rm=TRUE)),
                   ),
          ),
           ),
      conditionalPanel(condition="input.SelDataCustomTableFilters_Picker.indexOf('Start Month')>-1",
                         pickerInput("SelDataStartMonthFilterPicker",strong("Select Start Month(s):"),choices=c("January","February","March","April","May","June","July","August","September","October","November","December"),multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
       ),
      conditionalPanel(condition="input.SelDataCustomTableFilters_Picker.indexOf('End Month')>-1",
                         pickerInput("SelDataEndMonthFilterPicker",strong("Select End Month(s):"),choices=c("January","February","March","April","May","June","July","August","September","October","November","December"),multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
       ),
      conditionalPanel(condition="input.SelDataCustomTableFilters_Picker.indexOf('Survey Type')>-1",
                         pickerInput("SelDataSurveyTypeFilterPicker",strong("Select Survey Type:"),choices=sort(SurveyTypeChoices),multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
       ),
      conditionalPanel(condition="input.SelDataCustomTableFilters_Picker.indexOf('Waterbody Type')>-1",
                         pickerInput("SelDataWB_TypeFilterPicker",strong("Select Waterbody Type:"),choices=c("Lakes, Reservoirs, Ponds, and Tailraces", "Rivers and Streams"),multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
       ),
        conditionalPanel(condition="input.SelDataCustomTableFilters_Picker.indexOf('Waterbody Name')>-1",
          pickerInput("SelDataWaterbody_NameFilterPicker",strong("Select Waterbodies:"),choices=sort(as.character(unique(Survey_Data$Waterbody_Name_Unique))),multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
        ),
        conditionalPanel(condition="input.SelDataCustomTableFilters_Picker.indexOf('Waterbody Area')>-1",
          fluidRow(
            column(12,
            sliderInput("SelDataWaterbodyAreaFilterSlider",strong("Select Waterbody Area (Acres) Range:"),min=min(Survey_Data$WB_Acres,na.rm=TRUE),max=max(Survey_Data$WB_Acres,na.rm=TRUE),step=1,value=c(min(Survey_Data$WB_Acres,na.rm=TRUE),min(Survey_Data$WB_Acres,na.rm=TRUE)),sep = ""),
                   ),
            column(width=6,align="left",
                   numericInput("SelDataWaterbodyAreaFilter_Min","Min Acres: ",min(Survey_Data$WB_Acres,na.rm=TRUE),min(Survey_Data$WB_Acres,na.rm=TRUE),max(Survey_Data$WB_Acres,na.rm=TRUE)),
                   ),
            column(width=6,align="left",
                   numericInput("SelDataWaterbodyAreaFilter_Max","Max Acres",min(Survey_Data$WB_Acres,na.rm=TRUE),min(Survey_Data$WB_Acres,na.rm=TRUE),max(Survey_Data$WB_Acres,na.rm=TRUE)),
                   ),
          ),
        ),                                                 
       ),
                                           
       conditionalPanel(condition="input.SelDataContents=='Map'",
                        
        radioGroupButtons("MapSel_SelectType",status='primary',h5(strong(HTML("Select By&nbsp", as.character(actionLink(inputId = "VisSelectSurveysTip_Map", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Polygon","States","Counties"),selected=""),
        
        conditionalPanel(condition="input.MapSel_SelectType=='Polygon'",
          radioGroupButtons("MapSel_SelectPolygon",h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "VisSelectSurveysTip_PolyControl", HTML('<i class="fas fa-info-circle"></i>')))))),status='primary',choices=c("Draw","Complete","Clear"),selected="Draw"),               
        ),
        
        conditionalPanel(condition="input.MapSel_SelectType=='States'",
           radioGroupButtons("MapSel_SelectState",h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "VisSelectSurveysTip_StateControl", HTML('<i class="fas fa-info-circle"></i>')))))),status='primary',choices=c("Select","Complete","Clear"),selected="Select"),              
        ),
        
        conditionalPanel(condition="input.MapSel_SelectType=='Counties'",
           radioGroupButtons("MapSel_SelectCounty",h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "VisSelectSurveysTip_CountyControl", HTML('<i class="fas fa-info-circle"></i>')))))),status='primary',choices=c("Select","Complete","Clear"),selected="Select"),              
        ),
        
             withSpinner(leafletOutput("MapSelData_Subset"),type=2),
         ),
       style="primary")),
                
    conditionalPanel(condition="(input.SelDataContents=='All'
    ||(input.SelDataContents=='Map'&&output.MapSelData_Status>0)
    ||(input.SelDataContents=='Filters'&&output.SelDataFilterStatus=='Complete')
    )&&input.CreelCatNavBar!='Data Availability'",
      bsCollapse(id="Fields_Collapse",open="SelectFieldsCollapse",
        bsCollapsePanel(value="SelectFieldsCollapse",title=HTML("Select Fields&nbsp",as.character(actionLink(inputId = "VisFieldChoice_Help", HTML('<i class="fas fa-book-open"></i>'))), as.character(actionLink(inputId = "VisFieldChoiceTip", HTML('<i class="fas fa-info-circle"></i>')))),
             actionButton("FieldUpdateBTN","Update Selected Fields",class = "btn-warning btn-md"),
             br(),
             br(),
             bsCollapse(id="Fields_Visualizations",
               bsCollapsePanel(value="SurveyInfoFields", title=HTML("Survey Info&nbsp",as.character(actionLink(inputId = "VisFieldChoiceTip_Survey", HTML('<i class="fas fa-info-circle"></i>')))), 
                               pickerInput("SurveyPicker",strong("Select Fields"),choices=SurveyChoices,  multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),style="primary"),
               bsCollapsePanel(value="WaterbodyInfoFields", title=HTML("Waterbody Info&nbsp",as.character(actionLink(inputId = "VisFieldChoiceTip_Waterbody", HTML('<i class="fas fa-info-circle"></i>')))), 
                               pickerInput("WaterbodyPicker",strong("Select Fields"),choices=WaterbodyChoices,  multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),style="primary"),
               bsCollapsePanel(value="FishInfoFields", title=HTML("Fish Info&nbsp",as.character(actionLink(inputId = "VisFieldChoiceTip_Fish", HTML('<i class="fas fa-info-circle"></i>')))), 
                               h4(strong("Step 1: Fish Metrics")," (Must include at least one selection)"),
                               pickerInput("FishMetricsPicker",strong(HTML("Select Metrics&nbsp", as.character(actionLink(inputId = "MetricsTaxaCombinedTip", HTML('<i class="fas fa-info-circle"></i>'))))),choices=FishMetricChoices, multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               awesomeRadio("FishValFill",inline=TRUE,status='primary',h5(strong(HTML("Unreported Taxa Values&nbsp", as.character(actionLink(inputId = "UnreportedTaxaTip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("NULL","0"),selected="NULL"),
                               br(),
                               h4(strong("Step 2: Taxa")," (Must include at least one selection)"),
                               awesomeRadio("AllTaxaInput",inline=TRUE,status='primary',h5(strong(HTML("All Taxa Combined&nbsp", as.character(actionLink(inputId = "AllTaxaCombinedTip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Yes"="All","No"=""),selected=""),
                               pickerInput("SubsPicker",strong(HTML("Subspecies and Variants&nbsp", as.character(actionLink(inputId = "SubsVariantsTaxaCombinedTip", HTML('<i class="fas fa-info-circle"></i>'))))),choices=SubsChoices, multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               pickerInput("SppPicker",strong(HTML("Species&nbsp", as.character(actionLink(inputId = "SpeciesTaxaCombinedTip", HTML('<i class="fas fa-info-circle"></i>'))))),choices=SppChoices, multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               pickerInput("GenPicker",strong(HTML("Genus&nbsp", as.character(actionLink(inputId = "GenusTaxaCombinedTip", HTML('<i class="fas fa-info-circle"></i>'))))),choices=GenChoices, multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               pickerInput("FamPicker",strong(HTML("Family&nbsp", as.character(actionLink(inputId = "FamilyTaxaCombinedTip", HTML('<i class="fas fa-info-circle"></i>'))))),choices=FamChoices, multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               pickerInput("GrpPicker",strong(HTML("Group&nbsp", as.character(actionLink(inputId = "GroupTaxaCombinedTip", HTML('<i class="fas fa-info-circle"></i>'))))),choices=GrpChoices, multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')), 
                               h4(strong(HTML("Taxa Lookup &nbsp", as.character(actionLink(inputId = "TaxaLookupTip", HTML('<i class="fas fa-table"></i>')))))), 
                               h4(strong(HTML("Group Membership Lookup &nbsp", as.character(actionLink(inputId = "GroupLookupTip", HTML('<i class="fas fa-table"></i>')))))),
                               style="primary"),
               bsCollapsePanel(value="EffortInfoFields", title=HTML("Effort Info&nbsp",as.character(actionLink(inputId = "VisFieldChoiceTip_Effort", HTML('<i class="fas fa-info-circle"></i>')))), 
                               pickerInput("EffortPicker",strong("Select Fields"),choices=AnglerEffortChoices, multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),style="primary"),
               bsCollapsePanel(value="PreferenceInfoFields", title=HTML("Angler Preference Info&nbsp",as.character(actionLink(inputId = "VisFieldChoiceTip_Preference", HTML('<i class="fas fa-info-circle"></i>')))), 
                               h4(strong("Angler Preference Metrics")," (Must include at least one selection)"),
                               pickerInput("TargetMetricPicker",strong(HTML("Select Metrics&nbsp", as.character(actionLink(inputId = "TargetMetricsCombinedTip", HTML('<i class="fas fa-info-circle"></i>'))))),choices=TargetMetricChoices, multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               awesomeRadio("TargetValFill",inline=TRUE,status='primary',h5(strong(HTML("Unreported Target Taxa Values&nbsp", as.character(actionLink(inputId = "UnreportedTargetTaxaTip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("NULL","0"),selected="NULL"),
                               br(),
                               h4(strong("Taxa")," (Must include at least one selection)"),
                               radioGroupButtons("AngPref_AllTaxaInput",status='primary',h5(strong(HTML("All Taxa Combined&nbsp", as.character(actionLink(inputId = "AngPref_AllTaxaCombinedTip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Yes"="All","No"=""),selected="No"),
                               pickerInput("AngPref_SubsPicker",strong(HTML("Subspecies and Variants&nbsp", as.character(actionLink(inputId = "AngPref_SubsVariantsTaxaCombinedTip", HTML('<i class="fas fa-info-circle"></i>'))))),choices=SubsChoices, multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               pickerInput("AngPref_SppPicker",strong(HTML("Species&nbsp", as.character(actionLink(inputId = "AngPref_SpeciesTaxaCombinedTip", HTML('<i class="fas fa-info-circle"></i>'))))),choices=SppChoices, multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               pickerInput("AngPref_GenPicker",strong(HTML("Genus&nbsp", as.character(actionLink(inputId = "AngPref_GenusTaxaCombinedTip", HTML('<i class="fas fa-info-circle"></i>'))))),choices=GenChoices, multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               pickerInput("AngPref_FamPicker",strong(HTML("Family&nbsp", as.character(actionLink(inputId = "AngPref_FamilyTaxaCombinedTip", HTML('<i class="fas fa-info-circle"></i>'))))),choices=FamChoices, multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               pickerInput("AngPref_GrpPicker",strong(HTML("Group&nbsp", as.character(actionLink(inputId = "AngPref_GroupTaxaCombinedTip", HTML('<i class="fas fa-info-circle"></i>'))))),choices=GrpChoices, multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                              style="primary"),
               bsCollapsePanel(value="DemographicInfoFields", title=HTML("Demographic Info&nbsp",as.character(actionLink(inputId = "VisFieldChoiceTip_Demographic", HTML('<i class="fas fa-info-circle"></i>')))), 
                               pickerInput("DemographicPicker",strong("Select Fields"),choices=DemoChoices, multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),style="primary")
            ),style="primary")),
          ),

    #### Data Avail Sidebar ####
    
        conditionalPanel(condition="input.CreelCatNavBar=='Data Availability'",
           bsCollapse(id="DataAvail_SelectCollapse",open=c("DataAvailChoice","DataAvailSetup"),multiple=TRUE, 
                bsCollapsePanel(HTML("Inquiry Setup&nbsp",as.character(actionLink(inputId = "DataAvailInquirySetup_Help", HTML('<i class="fas fa-book-open"></i>'))), as.character(actionLink(inputId = "DataAvailInquirySetupTip", HTML('<i class="fas fa-info-circle"></i>')))),value="DataAvailSetup",
                     pickerInput("DataAvailType_Pick",h5(strong(HTML("Inquiry Type&nbsp", as.character(actionLink(inputId = "DataAvailInquiryType_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Survey Count","Available Fields","Survey Characteristics","Species")),
                     conditionalPanel(condition="input.DataAvailType_Pick!='Survey Characteristics'",
                     radioGroupButtons("SurveyCountView",status='primary',h5(strong(HTML("View Results As&nbsp", as.character(actionLink(inputId = "DataAvailMapTable_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Map","Table"),selected="Map"),
                     ),
                     conditionalPanel(condition="input.DataAvailType_Pick=='Available Fields'&&input.SurveyCountView=='Map'",
                                      pickerInput("DataAvail_AvailFieldsPick",h5(strong(HTML("Select Field for Count by State&nbsp", as.character(actionLink(inputId = "DataAvailInquirySelFields_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=Fields_All$Field_Name, multiple=FALSE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                     ),
                     conditionalPanel(condition="input.DataAvailType_Pick=='Survey Characteristics'",
                                      pickerInput("DataAvail_AvailGroupPicker",h5(strong(HTML("Select Survey Characteristics to be Included in Breakdown&nbsp", as.character(actionLink(inputId = "DataAvailSurveyChar_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Survey Type"="Survey_Type","Interview Method"="Interview_Method","Count Method"="Count_Method","Waterbody Type"="WB_Type"), multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                     ),
                      conditionalPanel(condition="input.DataAvailType_Pick=='Species'&&input.SurveyCountView=='Map'",
                                radioGroupButtons("DataAvail_TaxaTypeSel",status='primary',h5(strong(HTML("Taxa Classes&nbsp", as.character(actionLink(inputId = "DataAvail_TaxaClass_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Subspecies and Variants","Species","Genus","Family","Groups"),selected=c("Species")),
                               conditionalPanel(condition="input.DataAvail_TaxaTypeSel.indexOf('Subspecies and Variants')>-1",
                                  pickerInput("DataAvail_SubsPicker",h5(strong("Subspecies and Variants")),choices=SubsChoices, multiple=FALSE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               ),
                               conditionalPanel(condition="input.DataAvail_TaxaTypeSel.indexOf('Species')>-1",
                                  pickerInput("DataAvail_SppPicker",h5(strong("Species")),choices=SppChoices, multiple=FALSE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               ),
                               conditionalPanel(condition="input.DataAvail_TaxaTypeSel.indexOf('Genus')>-1",
                                   pickerInput("DataAvail_GenPicker",h5(strong("Genus")),choices=GenChoices, multiple=FALSE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               ),
                               conditionalPanel(condition="input.DataAvail_TaxaTypeSel.indexOf('Family')>-1",
                                  pickerInput("DataAvail_FamPicker",h5(strong("Family")),choices=FamChoices, multiple=FALSE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               ),
                               conditionalPanel(condition="input.DataAvail_TaxaTypeSel.indexOf('Groups')>-1",
                                 pickerInput("DataAvail_GrpPicker",h5(strong("Group")),choices=GrpChoices, multiple=FALSE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                               ),
                                      
                                      ),
                     conditionalPanel(condition="input.SurveyCountView=='Table'",
                                      radioGroupButtons("DataAvail_StateSumm",status='primary',h5(strong(HTML("Summarize by State:&nbsp", as.character(actionLink(inputId = "DataAvail_StateSumm_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Yes","No"),selected="Yes"),
                     ),
                     style="primary")
                  ),
                ),
  #### View and Filter Sidebar ####
      conditionalPanel(condition="input.CreelCatNavBar=='View and Filter Data'",
               downloadButton("FullDatasetDownload","Download Full Dataset as CSV Files",style="vertical-align: middle;background-color:#008cba;color:white; width: 100%;",icon = shiny::icon("download")),
               actionButton("FullDatasetGS_Open","Open Full Dataset in Google Sheets to Copy or Download", class="btn-primary",width="100%",icon=icon("link"),onclick="window.open('https://docs.google.com/spreadsheets/d/1KcJ-ba2Xk4piz6qdppBRMD9KE1gK3CBrIgodQkDP8KE/edit?usp=sharing','_blank')"),
              ),
    
    #### Summarize Sidepanel ###

    conditionalPanel(condition="input.CreelCatNavBar=='Summarize Data'",
         conditionalPanel(condition="output.Picked_Data_Status=='Picked'&&(input.SurveyPicker!=''||input.WaterbodyPicker!=''||input.FishMetricsPicker!=''||input.EffortPicker!=''||input.TargetMetricPicker!=''||input.DemographicPicker!='')",
                 conditionalPanel(condition="(input.SelDataContents=='All'
                      ||(input.SelDataContents=='Map'&&output.MapSelData_Status>0)
                      ||(input.SelDataContents=='Filters'&&output.SelDataFilterStatus=='Complete')
                      )",
                 
           bsCollapse(id="Sum_Fields_Collapse",open="SummarizationSetup",
          bsCollapsePanel(HTML("Summarization Options&nbsp;&nbsp", as.character(actionLink(inputId = "SumOptions_Help", HTML('<i class="fas fa-book-open"></i>'))), as.character(actionLink(inputId = "SumOptionsTip", HTML('<i class="fas fa-info-circle"></i>')))),value="SummarizationSetup",
                          checkboxGroupButtons("SummaryMetric",h5(strong(HTML("Calculate:&nbsp", as.character(actionLink(inputId = "DataSum_Calculations_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Sum"="sum","Mean"="mean","Median"="median","Min"="min","Max"="max"),direction="vertical",checkIcon=list(yes=tags$i(class="fa fa-check-square",style="color: steelblue"),no=tags$i(class="fa fa-square-o",style="color:steelblue"))),
                          pickerInput("Survey_Summary_FieldGroup_Picker",h5(strong(HTML("Select 'Group by' Fields:&nbsp", as.character(actionLink(inputId = "DataSum_GroupByFields_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Nothing Selected"), multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                          pickerInput("Survey_Summary_FieldValue_Picker",h5(strong(HTML("Select Fields to be Summarized:&nbsp", as.character(actionLink(inputId = "DataSum_SummFields_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Nothing Selected"),multiple=TRUE,options=pickerOptions(actionsBox = TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                          style="primary")
                     )
    ),
  ),
 ),
    
 
 #### Visualize Sidepanel ####
 
  conditionalPanel(condition="input.CreelCatNavBar=='Visualize Data'",
     conditionalPanel(condition="output.Picked_Data_Status=='Picked'&&(input.SurveyPicker!=''||input.WaterbodyPicker!=''||input.FishMetricsPicker!=''||input.EffortPicker!=''||input.TargetMetricPicker!=''||input.DemographicPicker!='')",#input.SurveyPicker!=''||input.WaterbodyPicker!=''||input.FishMetricsPicker!=''||input.EffortPicker!=''||input.TargetMetricPicker!=''||input.DemographicPicker==''",
                 conditionalPanel(condition="(input.SelDataContents=='All'
                      ||(input.SelDataContents=='Map'&&output.MapSelData_Status>0)
                      ||(input.SelDataContents=='Filters'&&output.SelDataFilterStatus=='Complete')
                      )",                    
      
   bsCollapse(id="VisData_SettingsCollapse",open="Vis_Settings",
      bsCollapsePanel(value="Vis_Settings",HTML("Settings&nbsp",as.character(actionLink(inputId = "VisualizationSettings_Help", HTML('<i class="fas fa-book-open"></i>')))),
         radioGroupButtons("AF_VisNum_Selection",status='primary',h5(strong(HTML("Number of Visualizations&nbsp", as.character(actionLink(inputId = "AF_VisNum_Selection_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("1","2","3","4"),selected=0),
         conditionalPanel(condition="input.AF_VisNum_Selection>=2",
                          radioGroupButtons("AF_SharedData",status='primary',h5(strong(HTML("Shared Data&nbsp", as.character(actionLink(inputId = "AF_SharedData_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("No","Yes"),selected=0),
            conditionalPanel(condition="input.AF_SharedData=='Yes'",
              radioGroupButtons("AF_LinkedSelection",status='primary',h5(strong(HTML("Linked Selection&nbsp", as.character(actionLink(inputId = "AF_LinkedSelection_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("No","Yes"),selected=0),
                      
            conditionalPanel(condition="input.AF_LinkedSelection=='Yes'",
                             div(style="display:inline-block",actionButton("ClearSel","Clear Selection",class = "btn-warning btn-md")),
                             div(style="display:inline-block",h5(strong(HTML(as.character(actionLink(inputId = "ClearSel_Tip", HTML('<i class="fas fa-info-circle"></i>'))))))),
            ))),
         radioGroupButtons("DarkMode", status='primary',h5(strong(HTML("Visualization Background&nbsp", as.character(actionLink(inputId = "DarkMode_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Light","Dark"),selected="Light"),
     style='primary')),


##### Visualization 1 Sidebar #####
conditionalPanel(condition="input.AF_VisNum_Selection>=1",
   bsCollapse(id="Vis1Panel",open="Vis1_Panel",
      bsCollapsePanel(value="Vis1_Panel",HTML("Visualization 1 Inputs&nbsp",as.character(actionLink(inputId = "Visualization1Input_Help", HTML('<i class="fas fa-book-open"></i>')))),
           conditionalPanel(condition="input.AF_LinkedSelection!='Yes'&&output.Vis1SelClearStatus>0&&input.SelectVis1!='Map'",
                             actionButton("ClearSel_Vis1","Clear Selection", class = "btn-warning btn-md"),
           ),
            pickerInput("SelectVis1", h5(strong(HTML("Select Visualization 1&nbsp", as.character(actionLink(inputId = "SelectVis1_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected","Map","Line Plot","Scatter Plot","Bar Chart","Pie Chart"),selected="Nothing Selected",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),

##### Vis 1 Map Sidebar #####
   conditionalPanel(condition="input.SelectVis1=='Map'",
       bsCollapse(id="Vis1Map_Collapse",open="Creel Data Display",
            bsCollapsePanel("Creel Data Display",
                conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType=='Scaled Color'&&input.Vis1_MapDisplayField!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)||
                                                              (input.Vis1_Map_CreelDisplayType=='Scaled Size'&&input.Vis1_MapDisplayField_Size!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)||
                                                              (input.Vis1_Map_CreelDisplayType=='Both'&&input.Vis1_MapDisplayField_Size!='Nothing Selected'&&input.Vis1_MapDisplayField!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)",
                actionButton("DisplayCreel_Map_Vis_1","Display Creel Data on Map", class = "btn-danger btn-md"),
                ),
                
                radioGroupButtons("Vis1_Map_CreelDisplayType",status='primary',h5(strong(HTML("Select Creel Data Display Type&nbsp", as.character(actionLink(inputId = "Vis1_Map_CreelDisplayType_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Scaled Color","Scaled Size","Both"),selected=""),
       
        conditionalPanel(condition="input.Vis1_Map_CreelDisplayType!=null",
         bsCollapse(id="Vis1Map_Collapse_Color",
            bsCollapsePanel("Color Settings",
                    conditionalPanel(condition="input.Vis1_Map_CreelDisplayType=='Scaled Color'||input.Vis1_Map_CreelDisplayType=='Both'",
                        pickerInput("Vis1_MapDisplayField", h5(strong(HTML("Select Color Field&nbsp", as.character(actionLink(inputId = "Vis1_MapDisplayField_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                        pickerInput("Vis1_MapColorPalette", h5(strong(HTML("Select Color Palette&nbsp", as.character(actionLink(inputId = "Vis1_MapColorPalette_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Reds","Purples","Greens","Blues","Greys","Red-Yellow-Blue"="RdYlBu","Red-Yellow-Green"="RdYlGn","Spectral","Set1","Set2","Set3","Pastel1","Pastel2","Paired","Dark2","Accent"),selected="Spectral",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                        h5(strong(HTML("Palette Direction&nbsp", as.character(actionLink(inputId = "Vis1_Map_PalToggle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
                        switchInput("Vis1_Map_PalToggle", onLabel="Reverse",offLabel="Standard",value=FALSE),
                        radioGroupButtons("Vis1_Map_CreelColorscalePer",status='primary',h5(strong(HTML("Display Color Data As&nbsp", as.character(actionLink(inputId = "Vis1_Map_CreelColorscalePer_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Values","Percentiles"),selected="Values"),
                      ),
              
                conditionalPanel(condition="input.Vis1_Map_CreelDisplayType=='Scaled Size'",
                                 pickerInput("Vis1_MapColorSolid", h5(strong(HTML("Select Color&nbsp", as.character(actionLink(inputId = "Vis1_MapColorSolid_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Blue","Red","Purple","Green", "White","Black"),selected="Blue",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                ),
            style='primary')
            ),
         
      
        bsCollapse(id="Vis1Map_Collapse_Size",
            bsCollapsePanel("Size Settings",
                conditionalPanel(condition="input.Vis1_Map_CreelDisplayType=='Scaled Size'||input.Vis1_Map_CreelDisplayType=='Both'",
                        pickerInput("Vis1_MapDisplayField_Size", h5(strong(HTML("Select Size Field&nbsp", as.character(actionLink(inputId = "Vis1_MapDisplayField_Size_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                        sliderInput("Vis1_MapDisplayField_SizeSlider",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis1_MapDisplayField_SizeSlider_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=50,value=c(5,15),round=TRUE),
                        radioGroupButtons("Vis1_Map_CreelSizescalePer",status='primary',h5(strong(HTML("Display Size Data As&nbsp", as.character(actionLink(inputId = "Vis1_Map_CreelSizescalePer_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Values","Percentiles"),selected="Values"),
                ),
                
                conditionalPanel(condition="input.Vis1_Map_CreelDisplayType=='Scaled Color'",
                        sliderInput("Vis1_MapDisplayField_SizeSliderSingle",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis1_MapDisplayField_SizeSliderSingle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=25,value=c(5),round=TRUE)
                ),
                style='primary')
            ),
        
        ),
          style='primary'),
        
      bsCollapsePanel("Selection",
                
          radioGroupButtons("Vis1_SelectType",status='primary',h5(strong(HTML("Select by:&nbsp", as.character(actionLink(inputId = "Vis1_SelectType_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Polygon","States","Counties"),selected=""),
        
        conditionalPanel(condition="input.Vis1_SelectType=='Polygon'",
          radioGroupButtons("Vis1_SelectPolygon",status='primary',h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "Vis1_SelectPolygon_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Draw","Complete","Clear"),selected="Draw"),               
        ),
        
        conditionalPanel(condition="input.Vis1_SelectType=='States'",
           radioGroupButtons("Vis1_SelectState",status='primary',h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "Vis1_SelectState_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Select","Complete","Clear"),selected="Select"),              
        ),
        
        conditionalPanel(condition="input.Vis1_SelectType=='Counties'",
           radioGroupButtons("Vis1_SelectCounty",status='primary',h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "Vis1_SelectCounty_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Select","Complete","Clear"),selected="Select"),              
        ),
        
        conditionalPanel(condition="output.Vis1SelClearStatus>0",
                sliderInput("Vis1_FillOpacity",h5(strong(HTML("Unselected Marker Opacity&nbsp", as.character(actionLink(inputId = "Vis1_FillOpacity_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=1,value=0.1),
           ),
                            
                style='primary'),
          
      
      bsCollapsePanel("Labels and Legend",
              
        conditionalPanel(condition="input.Vis1_Map_CreelDisplayType=='Scaled Color'||input.Vis1_Map_CreelDisplayType=='Both'",
        radioGroupButtons("Vis1_AddLegend_Switch",status='primary',h5(strong(HTML("Add Legend:&nbsp", as.character(actionLink(inputId = "Vis1_AddLegend_Switch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Yes","No"))
        ),
        radioGroupButtons("Map_Vis1_Title_Switch",status='primary',h5(strong(HTML("Add Custom Label:&nbsp", as.character(actionLink(inputId = "Map_Vis1_Title_Switch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Yes","No"), selected="No"),
        conditionalPanel(condition="input.Map_Vis1_Title_Switch=='Yes'",
        textInput("Map_Vis1_Title_Text", h5(strong(HTML("Map Label&nbsp", as.character(actionLink(inputId = "Map_Vis1_Title_Text_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 1")
        ),  
          
                            
                style='primary'),
           
        
            bsCollapsePanel("Map Navigation",
                  radioGroupButtons("Vis1_ZoomTo_Switch",status='primary',h5(strong(HTML("Zoom to:&nbsp", as.character(actionLink(inputId = "Vis1_ZoomTo_Switch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Creel Data Extent"="Creel","Selected Geography"="Geography")),
                  conditionalPanel(condition="input.Vis1_ZoomTo_Switch=='Geography'",
                    pickerInput("Vis1_ZoomToState",h5(strong(HTML("Select State Zoom&nbsp", as.character(actionLink(inputId = "Vis1_ZoomToState_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=MapStateChoices,multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                    pickerInput("Vis1_ZoomToCounty",h5(strong(HTML("Select County Zoom&nbsp", as.character(actionLink(inputId = "Vis1_ZoomToCounty_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Nothing Selected","Test 1","Test 2"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                    actionButton("Vis1_GeographyZoomBTN","Zoom to Selected Geography",class = "btn-primary btn-md")
                  ),
                  conditionalPanel(condition="input.Vis1_ZoomTo_Switch=='Creel'",
                      actionButton("Vis1_CreelExtentZoomBTN","Zoom to Creel Extent",class = "btn-primary btn-md")
                  ),
                  style='primary')
            )
     ),

##### Vis 1 Scatter Sidebar #####
conditionalPanel(condition="input.SelectVis1=='Scatter Plot'",
  bsCollapse(id="Vis1Scatter_Collapse",
    bsCollapsePanel("Data Inputs",
      pickerInput("Vis1_ScatterX", h5(strong(HTML("Select X Variable&nbsp", as.character(actionLink(inputId = "Vis1_ScatterX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      pickerInput("Vis1_ScatterY", h5(strong(HTML("Select Y Variable&nbsp", as.character(actionLink(inputId = "Vis1_ScatterY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
     ,style='primary'),
    
    bsCollapsePanel("Marker Style",
      bsCollapse(id="Vis1ScatterStyle_Collapse",
          bsCollapsePanel("Marker Color",
                radioGroupButtons("Vis1_Scatter_ColorGroupSwitch",status='primary',h5(strong(HTML("Color Scale&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_ColorGroupSwitch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Uniform","Numeric","Factors"),selected=c("Uniform")),
               conditionalPanel(condition="input.Vis1_Scatter_ColorGroupSwitch=='Uniform'",
                  pickerInput("Vis1_Scatter_Color",h5(strong(HTML("Marker Color&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Gray","Black","White","Red","Blue","Yellow","Green","Purple"),selected="Gray",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
                ),
               conditionalPanel(condition="input.Vis1_Scatter_ColorGroupSwitch=='Numeric'",
                  pickerInput("Vis1_Scatter_MarkerColor_Numeric",h5(strong(HTML("Color by:&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_MarkerColor_Numeric_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Year"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  pickerInput("Vis1_Scatter_ColorPal_Numeric", h5(strong(HTML("Select Color Palette&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_ColorPal_Numeric_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Blackbody", "Bluered", "Blues", "Cividis", "Earth", "Electric", "Greens", "Greys", "Hot", "Jet", "Picnic", "Portland", "Rainbow", "RdBu", "Reds", "Viridis", "YlGnBu", "YlOrRd"),selected="Rainbow",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  h5(strong(HTML("Palette Direction&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_PalDirection", HTML('<i class="fas fa-info-circle"></i>')))))),   
                  switchInput("Vis1_Scatter_PalToggle", onLabel="Standard",offLabel="Reverse",value=FALSE),
                ),
                conditionalPanel(condition="input.Vis1_Scatter_ColorGroupSwitch=='Factors'",
                  pickerInput("Vis1_Scatter_MarkerColor_Factors",h5(strong(HTML("Color by:&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_MarkerColor_Factors_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("State","Waterbody_Name_Unique"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  pickerInput("Vis1_Scatter_ColorPal_Factors", h5(strong(HTML("Select Color Palette&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_ColorPal_Factors_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Reds","Purples","Greens","Blues","Greys","Red-Yellow-Blue"="RdYlBu","Red-Yellow-Green"="RdYlGn","Spectral","Set1","Set2","Set3","Pastel1","Pastel2","Paired","Dark2","Accent"),selected="Spectral",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  ),
              sliderInput("Vis_1_ScatterOpacity",h5(strong(HTML("Unselected Marker Opacity&nbsp", as.character(actionLink(inputId = "Vis_1_ScatterOpacity_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=1,value=0.2),                         
          style='primary'),
          bsCollapsePanel("Marker Size",
            radioGroupButtons("Vis1_Scatter_MarkerSizeSwitch",status='primary',h5(strong(HTML("Marker Size Method&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_MarkerSizeSwitch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Uniform","Scaled")),
             conditionalPanel(condition="input.Vis1_Scatter_MarkerSizeSwitch=='Uniform'",
                sliderInput("Vis1_Scatter_MarkerSize",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_MarkerSize_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=50,value=10,round=TRUE),
              ),
             conditionalPanel(condition="input.Vis1_Scatter_MarkerSizeSwitch=='Scaled'",
                pickerInput("Vis1_Scatter_MarkerScaleSize",h5(strong(HTML("Marker Size Field&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_MarkerScaleSize_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Year"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                sliderInput("Vis1_Scatter_MarkerSizeSlider",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_MarkerSizeSlider_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=50,value=c(10,20),round=TRUE),
                ),                          
          style='primary')
    ),
    style='primary'),
    
        

    bsCollapsePanel("Trendline",
      radioGroupButtons("Vis1_Scatter_TrendlineSwitch",status='primary',h5(strong(HTML("Add Trendline&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_TrendlineSwitch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("No","Yes")),
      pickerInput("Vis1_Scatter_TrendlineColor",h5(strong(HTML("Select Trendline Color&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_TrendlineColor_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Gray","White","Black","Red","Blue","Yellow","Green","Purple"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      sliderInput("Vis1_Scatter_TrendlineWidth",h5(strong(HTML("Trendline Width&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_TrendlineWidth_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=5,value=2,round=TRUE)
    ,style='primary'),       
    
    bsCollapsePanel("Labels and Legend",
      h5(strong(HTML("Toggle Legend and Text&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),   
      switchInput("Vis1_Scatter_HideLegend", onLabel="Display",offLabel="Hide",value=TRUE),
      radioGroupButtons("Vis1_Scatter_Orientation",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
      sliderInput("Vis1_Scatter_LegendX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=1,step=0.1),
      sliderInput("Vis1_Scatter_LegendY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis1_Scatter_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=1,step=0.1),
      textInput("Vis1_ScatterTitle", h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis1_ScatterTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 1"),
      textInput("Vis1_ScatterXlab", h5(strong(HTML("X Label&nbsp", as.character(actionLink(inputId = "Vis1_ScatterXlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
      textInput("Vis1_ScatterYlab", h5(strong(HTML("Y Label&nbsp", as.character(actionLink(inputId = "Vis1_ScatterYlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
     style='primary') 
    

 )),

##### Vis 1 Bar Chart Sidebar #####
conditionalPanel(condition="input.SelectVis1=='Bar Chart'",
  bsCollapse(id="Vis1Bar_Collapse",
    bsCollapsePanel("Data Inputs",
      radioGroupButtons("Vis1_Bar_Number",status='primary',h5(strong(HTML("Select number of Y variables&nbsp", as.character(actionLink(inputId = "Vis1_Bar_Number_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c(1:5),selected=""),
    conditionalPanel(condition="input.Vis1_Bar_Number>=1",
      pickerInput("Vis1_BarY1", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (1) Variable&nbsp", as.character(actionLink(inputId = "Vis1_BarY1_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis1_Bar_Number>=2",
      pickerInput("Vis1_BarY2", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (2) Variable&nbsp", as.character(actionLink(inputId = "Vis1_BarY2_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis1_Bar_Number>=3",
      pickerInput("Vis1_BarY3", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (3) Variable&nbsp", as.character(actionLink(inputId = "Vis1_BarY3_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis1_Bar_Number>=4",
      pickerInput("Vis1_BarY4", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (4) Variable&nbsp", as.character(actionLink(inputId = "Vis1_BarY4_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis1_Bar_Number>=5",
      pickerInput("Vis1_BarY5", choices=c("Nothing Selected"), h5(strong(HTML("Select Y (5) Variable&nbsp", as.character(actionLink(inputId = "*Vis1_BarY5_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
    ),
  style='primary'),
  bsCollapsePanel("Style",
      pickerInput("Vis1_BarY1_Color", h5(strong(HTML("Select Variable 1 Color&nbsp", as.character(actionLink(inputId = "Vis1_BarY1_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("blue"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    conditionalPanel(condition="input.Vis1_Bar_Number>=2",
      pickerInput("Vis1_BarY2_Color", h5(strong(HTML("Select Variable 2 Color&nbsp", as.character(actionLink(inputId = "Vis1_BarY2_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("orange"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis1_Bar_Number>=3",
      pickerInput("Vis1_BarY3_Color", h5(strong(HTML("Select Variable 3 Color&nbsp", as.character(actionLink(inputId = "Vis1_BarY3_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("red"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis1_Bar_Number>=4",
      pickerInput("Vis1_BarY4_Color", h5(strong(HTML("Select Variable 4 Color&nbsp", as.character(actionLink(inputId = "Vis1_BarY4_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("green"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis1_Bar_Number>=5",
      pickerInput("Vis1_BarY5_Color", h5(strong(HTML("Select Variable 5 Color&nbsp", as.character(actionLink(inputId = "*Vis1_BarY5_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("purple"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    style='primary'),
  bsCollapsePanel("Legend",
    h5(strong(HTML("Toggle Legend&nbsp", as.character(actionLink(inputId = "Vis1_Bar_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
    switchInput("Vis1_Bar_HideLegend",  onLabel="Display",offLabel="Hide", value=TRUE),
    radioGroupButtons("Vis1BarLegendOrient",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis1_Bar_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
    sliderInput("Vis1_Bar_LegendX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis1_Bar_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=0,step=0.1),
    sliderInput("Vis1_Bar_LegendY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis1_Bar_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=-0.6,step=0.1),
    style='primary'),
  
  bsCollapsePanel("Labels",
    textInput("Vis1_BarTitle", h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis1_BarTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 1"),
    textInput("Vis1_BarXlab", h5(strong(HTML("X Label&nbsp", as.character(actionLink(inputId = "Vis1_BarXlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Surveys"),
    textInput("Vis1_BarYlab", h5(strong(HTML("Y Label&nbsp", as.character(actionLink(inputId = "Vis1_BarYlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
  style='primary')
)),

#### Vis 1 Pie Chart Sidebar ####
conditionalPanel(condition="input.SelectVis1=='Pie Chart'",
  bsCollapse(id="Vis1Pie_Collapse",
    bsCollapsePanel("Data Inputs",
      radioGroupButtons("Vis1_Pie_CategoryType",status='primary',h5(strong(HTML("Categories&nbsp", as.character(actionLink(inputId = "Vis1_Pie_CategoryType_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Metrics","Surveys"),selected="0"),
      conditionalPanel(condition="input.Vis1_Pie_CategoryType=='Metrics'",
        pickerInput("Vis1_Pie_Metrics", h5(strong(HTML("Select Categories&nbsp", as.character(actionLink(inputId = "Vis1_Pie_Metrics_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),selected="Nothing Selected", multiple=TRUE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis1_Pie_CategoryType=='Surveys'",
        pickerInput("Vis1_Pie_Metrics_to_Sum", h5(strong(HTML("Select Metrics to Sum&nbsp", as.character(actionLink(inputId = "Vis1_Pie_Metrics_to_Sum_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),selected="Nothing Selected", multiple=TRUE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
    style='primary'),
  bsCollapsePanel("Legend and Labels",
    h5(strong(HTML("Toggle Legend&nbsp", as.character(actionLink(inputId = "Vis1_Pie_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
    switchInput("Vis1_Pie_HideLegend", onLabel="Display",offLabel="Hide", value=TRUE),
    radioGroupButtons("Vis1_Pie_LegendOrient",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis1_Pie_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
    sliderInput("Vis1_PieX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis1_Pie_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-2,max=2,value=-0.2,step=0.1),
    sliderInput("Vis1_PieY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis1_Pie_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-2,max=2,value=1,step=0.1),
    textInput("Vis1_PieTitle",h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis1_PieTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 1"),
  style='primary')
)),


#### Vis 1 Line Plot Sidebar ####

conditionalPanel(condition="input.SelectVis1=='Line Plot'",
  bsCollapse(id="Vis1Line_Collapse",
    bsCollapsePanel("Data Inputs",
      radioGroupButtons("Vis1_Line_Number", status='primary',h5(strong(HTML("Select number of Y variables:&nbsp", as.character(actionLink(inputId = "Vis1_Line_Number_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c(1:5),selected=""),
    conditionalPanel(condition="input.Vis1_Line_Number>=1",
      pickerInput("Vis1_LineY1", h5(strong(HTML("Select Y (1) Variable&nbsp", as.character(actionLink(inputId = "Vis1_LineY1_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis1_Line_Number>=2",
      pickerInput("Vis1_LineY2", h5(strong(HTML("Select Y (2) Variable&nbsp", as.character(actionLink(inputId = "Vis1_LineY2_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis1_Line_Number>=3",
      pickerInput("Vis1_LineY3", h5(strong(HTML("Select Y (3) Variable&nbsp", as.character(actionLink(inputId = "Vis1_LineY3_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis1_Line_Number>=4",
      pickerInput("Vis1_LineY4", h5(strong(HTML("Select Y (4) Variable&nbsp", as.character(actionLink(inputId = "Vis1_LineY4_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis1_Line_Number>=5",
      pickerInput("Vis1_LineY5", h5(strong(HTML("Select Y (5) Variable&nbsp", as.character(actionLink(inputId = "Vis1_LineY5_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
    ),
  style='primary'),
   bsCollapsePanel("Line and Marker Style",
    bsCollapse(id="Vis1LineandMarker_Collapse",
      bsCollapsePanel("Line Color",
        conditionalPanel(condition="input.Vis1_Line_Number>=1",
          pickerInput("Vis1_Line_ColPal", h5(strong(HTML("Select color palette:&nbsp", as.character(actionLink(inputId = "Vis1_Line_ColPal_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Reds","Purples","Greens","Blues","Greys","Red-Yellow-Blue"="RdYlBu","Red-Yellow-Green"="RdYlGn","Spectral","Set1","Set2","Set3","Pastel1","Pastel2","Paired","Dark2","Accent"),selected="Spectral",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
        ),
     style='primary'),
     bsCollapsePanel("Line Width and Type",
          sliderInput("Vis1_Line_Width",h5(strong(HTML("Line Width:&nbsp", as.character(actionLink(inputId = "Vis1_Line_Width_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=5,value=2,round=TRUE),
      conditionalPanel(condition="input.Vis1_Line_Number>=1",
          pickerInput("Vis1_Linedash1", h5(strong(HTML("Select style for line 1:&nbsp", as.character(actionLink(inputId = "Vis1_Linedash1_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="solid",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis1_Line_Number>=2",
          pickerInput("Vis1_Linedash2", h5(strong(HTML("Select style for line 2:&nbsp", as.character(actionLink(inputId = "Vis1_Linedash2_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="dash",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis1_Line_Number>=3",
          pickerInput("Vis1_Linedash3", h5(strong(HTML("Select style for line 3:&nbsp", as.character(actionLink(inputId = "Vis1_Linedash3_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="dot",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis1_Line_Number>=4",
          pickerInput("Vis1_Linedash4", h5(strong(HTML("Select style for line 4:&nbsp", as.character(actionLink(inputId = "Vis1_Linedash4_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="dashdot",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis1_Line_Number>=5",
          pickerInput("Vis1_Linedash5", h5(strong(HTML("Select style for line 5:&nbsp", as.character(actionLink(inputId = "Vis1_Linedash5_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="longdash",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
     style='primary'),
     bsCollapsePanel("Marker Style",
        sliderInput("Vis1_Line_Point_Size",h5(strong(HTML("Point Size:&nbsp", as.character(actionLink(inputId = "Vis1_Line_Point_Size_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=20,value=5,round=TRUE),
        pickerInput("Vis1_Line_Point_Color",h5(strong(HTML("Point Color&nbsp", as.character(actionLink(inputId = "Vis1_Line_Point_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Gray","Black","White","Red","Blue","Yellow","Green","Purple"),selected="Gray", multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
     style='primary')
    ),
    style='primary'),
  bsCollapsePanel("Legend",
    h5(strong(HTML("Toggle Legend&nbsp", as.character(actionLink(inputId = "Vis1_Line_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
    switchInput("Vis1_Line_HideLegend", onLabel="Display",offLabel="Hide", value=TRUE),
    radioGroupButtons("Vis1_Line_LegendOrient",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis1_Line_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
    sliderInput("Vis1_Line_LegendX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis1_Line_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=0,step=0.1),
    sliderInput("Vis1_Line_LegendY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis1_Line_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=-0.6,step=0.1),
    style='primary'),
  
  bsCollapsePanel("Labels",
    textInput("Vis1_LineTitle", h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis1_LineTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 1"),
    textInput("Vis1_LineXlab", h5(strong(HTML("X Label&nbsp", as.character(actionLink(inputId = "Vis1_LineXlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Year"),
    textInput("Vis1_LineYlab", h5(strong(HTML("Y Label&nbsp", as.character(actionLink(inputId = "Vis1_LineYlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
  style='primary')
)
),

style='primary'))),

##### Visualization 2 Sidebar #####
conditionalPanel(condition="input.AF_VisNum_Selection>=2",
   bsCollapse(id="Vis2Panel",open="Vis2_Panel",
      bsCollapsePanel(value="Vis2_Panel",HTML("Visualization 2 Inputs&nbsp",as.character(actionLink(inputId = "Visualization2Input_Help", HTML('<i class="fas fa-book-open"></i>')))),
           conditionalPanel(condition="input.AF_LinkedSelection!='Yes'&&output.Vis2SelClearStatus>0&&input.SelectVis2!='Map'",
                             actionButton("ClearSel_Vis2","Clear Selection", class = "btn-warning btn-md"),
           ),
            pickerInput("SelectVis2", h5(strong(HTML("Select Visualization 2&nbsp", as.character(actionLink(inputId = "SelectVis2_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected","Map","Line Plot","Scatter Plot","Bar Chart","Pie Chart"),selected="Nothing Selected",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),

##### Vis 2 Map Sidebar #####
   conditionalPanel(condition="input.SelectVis2=='Map'",
       bsCollapse(id="Vis2Map_Collapse",open="Creel Data Display",
            bsCollapsePanel("Creel Data Display",
                conditionalPanel(condition="(input.Vis2_Map_CreelDisplayType=='Scaled Color'&&input.Vis2_MapDisplayField!='Nothing Selected'&&output.Vis_2_Input_SelectCount>0)||
                                                              (input.Vis2_Map_CreelDisplayType=='Scaled Size'&&input.Vis2_MapDisplayField_Size!='Nothing Selected'&&output.Vis_2_Input_SelectCount>0)||
                                                              (input.Vis2_Map_CreelDisplayType=='Both'&&input.Vis2_MapDisplayField_Size!='Nothing Selected'&&input.Vis2_MapDisplayField!='Nothing Selected'&&output.Vis_2_Input_SelectCount>0)",
                actionButton("DisplayCreel_Map_Vis_2","Display Creel Data on Map", class = "btn-danger btn-md"),
                ),
                
                radioGroupButtons("Vis2_Map_CreelDisplayType",status='primary',h5(strong(HTML("Select Creel Data Display Type&nbsp", as.character(actionLink(inputId = "Vis2_Map_CreelDisplayType_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Scaled Color","Scaled Size","Both"),selected=""),
       
        conditionalPanel(condition="input.Vis2_Map_CreelDisplayType!=null",
         bsCollapse(id="Vis2Map_Collapse_Color",
            bsCollapsePanel("Color Settings",
                    conditionalPanel(condition="input.Vis2_Map_CreelDisplayType=='Scaled Color'||input.Vis2_Map_CreelDisplayType=='Both'",
                        pickerInput("Vis2_MapDisplayField", h5(strong(HTML("Select Color Field&nbsp", as.character(actionLink(inputId = "Vis2_MapDisplayField_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                        pickerInput("Vis2_MapColorPalette", h5(strong(HTML("Select Color Palette&nbsp", as.character(actionLink(inputId = "Vis2_MapColorPalette_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Reds","Purples","Greens","Blues","Greys","Red-Yellow-Blue"="RdYlBu","Red-Yellow-Green"="RdYlGn","Spectral","Set1","Set2","Set3","Pastel1","Pastel2","Paired","Dark2","Accent"),selected="Spectral",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                        h5(strong(HTML("Palette Direction&nbsp", as.character(actionLink(inputId = "Vis2_Map_PalToggle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
                        switchInput("Vis2_Map_PalToggle", onLabel="Reverse",offLabel="Standard",value=FALSE),
                        radioGroupButtons("Vis2_Map_CreelColorscalePer",status='primary',h5(strong(HTML("Display Color Data As&nbsp", as.character(actionLink(inputId = "Vis2_Map_CreelColorscalePer_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Values","Percentiles"),selected="Values"),
                      ),
              
                conditionalPanel(condition="input.Vis2_Map_CreelDisplayType=='Scaled Size'",
                                 pickerInput("Vis2_MapColorSolid", h5(strong(HTML("Select Color&nbsp", as.character(actionLink(inputId = "Vis2_MapColorSolid_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Blue","Red","Purple","Green", "White","Black"),selected="Blue",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                ),
            style='primary')
            ),
         
      
        bsCollapse(id="Vis2Map_Collapse_Size",
            bsCollapsePanel("Size Settings",
                conditionalPanel(condition="input.Vis2_Map_CreelDisplayType=='Scaled Size'||input.Vis2_Map_CreelDisplayType=='Both'",
                        pickerInput("Vis2_MapDisplayField_Size", h5(strong(HTML("Select Size Field&nbsp", as.character(actionLink(inputId = "Vis2_MapDisplayField_Size_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                        sliderInput("Vis2_MapDisplayField_SizeSlider",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis2_MapDisplayField_SizeSlider_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=50,value=c(5,15),round=TRUE),
                        radioGroupButtons("Vis2_Map_CreelSizescalePer",status='primary',h5(strong(HTML("Display Size Data As&nbsp", as.character(actionLink(inputId = "Vis2_Map_CreelSizescalePer_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Values","Percentiles"),selected="Values"),
                ),
                
                conditionalPanel(condition="input.Vis2_Map_CreelDisplayType=='Scaled Color'",
                        sliderInput("Vis2_MapDisplayField_SizeSliderSingle",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis2_MapDisplayField_SizeSliderSingle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=25,value=c(5),round=TRUE)
                ),
                style='primary')
            ),
        
        ),
          style='primary'),
        
      bsCollapsePanel("Selection",
                
          radioGroupButtons("Vis2_SelectType",status='primary',h5(strong(HTML("Select by:&nbsp", as.character(actionLink(inputId = "Vis2_SelectType_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Polygon","States","Counties"),selected=""),
        
        conditionalPanel(condition="input.Vis2_SelectType=='Polygon'",
          radioGroupButtons("Vis2_SelectPolygon",status='primary',h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "Vis2_SelectPolygon_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Draw","Complete","Clear"),selected="Draw"),               
        ),
        
        conditionalPanel(condition="input.Vis2_SelectType=='States'",
           radioGroupButtons("Vis2_SelectState",status='primary',h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "Vis2_SelectState_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Select","Complete","Clear"),selected="Select"),              
        ),
        
        conditionalPanel(condition="input.Vis2_SelectType=='Counties'",
           radioGroupButtons("Vis2_SelectCounty",status='primary',h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "Vis2_SelectCounty_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Select","Complete","Clear"),selected="Select"),              
        ),
        
        conditionalPanel(condition="output.Vis2SelClearStatus>0",
                sliderInput("Vis2_FillOpacity",h5(strong(HTML("Unselected Marker Opacity&nbsp", as.character(actionLink(inputId = "Vis2_FillOpacity_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=1,value=0.1),
           ),
                            
                style='primary'),
          
      
      bsCollapsePanel("Labels and Legend",
              
        conditionalPanel(condition="input.Vis2_Map_CreelDisplayType=='Scaled Color'||input.Vis2_Map_CreelDisplayType=='Both'",
        radioGroupButtons("Vis2_AddLegend_Switch",status='primary',h5(strong(HTML("Add Legend:&nbsp", as.character(actionLink(inputId = "Vis2_AddLegend_Switch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Yes","No"))
        ),
        radioGroupButtons("Map_Vis2_Title_Switch",status='primary',h5(strong(HTML("Add Custom Label:&nbsp", as.character(actionLink(inputId = "Map_Vis2_Title_Switch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Yes","No"), selected="No"),
        conditionalPanel(condition="input.Map_Vis2_Title_Switch=='Yes'",
        textInput("Map_Vis2_Title_Text", h5(strong(HTML("Map Label&nbsp", as.character(actionLink(inputId = "Map_Vis2_Title_Text_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 2")
        ),  
          
                            
                style='primary'),
           
        
            bsCollapsePanel("Map Navigation",
                  radioGroupButtons("Vis2_ZoomTo_Switch",status='primary',h5(strong(HTML("Zoom to:&nbsp", as.character(actionLink(inputId = "Vis2_ZoomTo_Switch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Creel Data Extent"="Creel","Selected Geography"="Geography")),
                  conditionalPanel(condition="input.Vis2_ZoomTo_Switch=='Geography'",
                    pickerInput("Vis2_ZoomToState",h5(strong(HTML("Select State Zoom&nbsp", as.character(actionLink(inputId = "Vis2_ZoomToState_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=MapStateChoices,multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                    pickerInput("Vis2_ZoomToCounty",h5(strong(HTML("Select County Zoom&nbsp", as.character(actionLink(inputId = "Vis2_ZoomToCounty_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Nothing Selected","Test 1","Test 2"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                    actionButton("Vis2_GeographyZoomBTN","Zoom to Selected Geography",class = "btn-primary btn-md")
                  ),
                  conditionalPanel(condition="input.Vis2_ZoomTo_Switch=='Creel'",
                      actionButton("Vis2_CreelExtentZoomBTN","Zoom to Creel Extent",class = "btn-primary btn-md")
                  ),
                  style='primary')
            )
     ),

##### Vis 2 Scatter Sidebar #####
conditionalPanel(condition="input.SelectVis2=='Scatter Plot'",
  bsCollapse(id="Vis2Scatter_Collapse",
    bsCollapsePanel("Data Inputs",
      pickerInput("Vis2_ScatterX", h5(strong(HTML("Select X Variable&nbsp", as.character(actionLink(inputId = "Vis2_ScatterX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      pickerInput("Vis2_ScatterY", h5(strong(HTML("Select Y Variable&nbsp", as.character(actionLink(inputId = "Vis2_ScatterY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
     ,style='primary'),
    
    bsCollapsePanel("Marker Style",
      bsCollapse(id="Vis2ScatterStyle_Collapse",
          bsCollapsePanel("Marker Color",
                radioGroupButtons("Vis2_Scatter_ColorGroupSwitch",status='primary',h5(strong(HTML("Color Scale&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_ColorGroupSwitch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Uniform","Numeric","Factors"),selected=c("Uniform")),
               conditionalPanel(condition="input.Vis2_Scatter_ColorGroupSwitch=='Uniform'",
                  pickerInput("Vis2_Scatter_Color",h5(strong(HTML("Marker Color&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Gray","Black","White","Red","Blue","Yellow","Green","Purple"),selected="Gray",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
                ),
               conditionalPanel(condition="input.Vis2_Scatter_ColorGroupSwitch=='Numeric'",
                  pickerInput("Vis2_Scatter_MarkerColor_Numeric",h5(strong(HTML("Color by:&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_MarkerColor_Numeric_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Year"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  pickerInput("Vis2_Scatter_ColorPal_Numeric", h5(strong(HTML("Select Color Palette&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_ColorPal_Numeric_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Blackbody", "Bluered", "Blues", "Cividis", "Earth", "Electric", "Greens", "Greys", "Hot", "Jet", "Picnic", "Portland", "Rainbow", "RdBu", "Reds", "Viridis", "YlGnBu", "YlOrRd"),selected="Rainbow",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  h5(strong(HTML("Palette Direction&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_PalDirection", HTML('<i class="fas fa-info-circle"></i>')))))),   
                  switchInput("Vis2_Scatter_PalToggle", onLabel="Standard",offLabel="Reverse",value=FALSE),
                ),
                conditionalPanel(condition="input.Vis2_Scatter_ColorGroupSwitch=='Factors'",
                  pickerInput("Vis2_Scatter_MarkerColor_Factors",h5(strong(HTML("Color by:&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_MarkerColor_Factors_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("State","Waterbody_Name_Unique"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  pickerInput("Vis2_Scatter_ColorPal_Factors", h5(strong(HTML("Select Color Palette&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_ColorPal_Factors_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Reds","Purples","Greens","Blues","Greys","Red-Yellow-Blue"="RdYlBu","Red-Yellow-Green"="RdYlGn","Spectral","Set1","Set2","Set3","Pastel1","Pastel2","Paired","Dark2","Accent"),selected="Spectral",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  ),
              sliderInput("Vis_2_ScatterOpacity",h5(strong(HTML("Unselected Marker Opacity&nbsp", as.character(actionLink(inputId = "Vis_2_ScatterOpacity_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=1,value=0.2),                         
          style='primary'),
          bsCollapsePanel("Marker Size",
            radioGroupButtons("Vis2_Scatter_MarkerSizeSwitch",status='primary',h5(strong(HTML("Marker Size Method&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_MarkerSizeSwitch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Uniform","Scaled")),
             conditionalPanel(condition="input.Vis2_Scatter_MarkerSizeSwitch=='Uniform'",
                sliderInput("Vis2_Scatter_MarkerSize",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_MarkerSize_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=50,value=10,round=TRUE),
              ),
             conditionalPanel(condition="input.Vis2_Scatter_MarkerSizeSwitch=='Scaled'",
                pickerInput("Vis2_Scatter_MarkerScaleSize",h5(strong(HTML("Marker Size Field&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_MarkerScaleSize_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Year"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                sliderInput("Vis2_Scatter_MarkerSizeSlider",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_MarkerSizeSlider_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=50,value=c(10,20),round=TRUE),
                ),                          
          style='primary')
    ),
    style='primary'),
    
        

    bsCollapsePanel("Trendline",
      radioGroupButtons("Vis2_Scatter_TrendlineSwitch",status='primary',h5(strong(HTML("Add Trendline&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_TrendlineSwitch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("No","Yes")),
      pickerInput("Vis2_Scatter_TrendlineColor",h5(strong(HTML("Select Trendline Color&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_TrendlineColor_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Gray","White","Black","Red","Blue","Yellow","Green","Purple"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      sliderInput("Vis2_Scatter_TrendlineWidth",h5(strong(HTML("Trendline Width&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_TrendlineWidth_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=5,value=2,round=TRUE)
    ,style='primary'),    
    
    bsCollapsePanel("Labels and Legend",
      h5(strong(HTML("Toggle Legend and Text&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),   
      switchInput("Vis2_Scatter_HideLegend", onLabel="Display",offLabel="Hide",value=TRUE),
      radioGroupButtons("Vis2_Scatter_Orientation",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
      sliderInput("Vis2_Scatter_LegendX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=1,step=0.1),
      sliderInput("Vis2_Scatter_LegendY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis2_Scatter_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=1,step=0.1),
      textInput("Vis2_ScatterTitle", h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis2_ScatterTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 2"),
      textInput("Vis2_ScatterXlab", h5(strong(HTML("X Label&nbsp", as.character(actionLink(inputId = "Vis2_ScatterXlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
      textInput("Vis2_ScatterYlab", h5(strong(HTML("Y Label&nbsp", as.character(actionLink(inputId = "Vis2_ScatterYlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
     style='primary')
    

 )),

##### Vis 2 Bar Chart Sidebar #####
conditionalPanel(condition="input.SelectVis2=='Bar Chart'",
  bsCollapse(id="Vis2Bar_Collapse",
    bsCollapsePanel("Data Inputs",
      radioGroupButtons("Vis2_Bar_Number",status='primary',h5(strong(HTML("Select number of Y variables&nbsp", as.character(actionLink(inputId = "Vis2_Bar_Number_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c(1:5),selected=""),
    conditionalPanel(condition="input.Vis2_Bar_Number>=1",
      pickerInput("Vis2_BarY1", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (1) Variable&nbsp", as.character(actionLink(inputId = "Vis2_BarY1_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis2_Bar_Number>=2",
      pickerInput("Vis2_BarY2", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (2) Variable&nbsp", as.character(actionLink(inputId = "Vis2_BarY2_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis2_Bar_Number>=3",
      pickerInput("Vis2_BarY3", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (3) Variable&nbsp", as.character(actionLink(inputId = "Vis2_BarY3_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis2_Bar_Number>=4",
      pickerInput("Vis2_BarY4", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (4) Variable&nbsp", as.character(actionLink(inputId = "Vis2_BarY4_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis2_Bar_Number>=5",
      pickerInput("Vis2_BarY5", choices=c("Nothing Selected"), h5(strong(HTML("Select Y (5) Variable&nbsp", as.character(actionLink(inputId = "*Vis2_BarY5_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
    ),
  style='primary'),
  bsCollapsePanel("Style",
      pickerInput("Vis2_BarY1_Color", h5(strong(HTML("Select Variable 1 Color&nbsp", as.character(actionLink(inputId = "Vis2_BarY1_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("blue"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    conditionalPanel(condition="input.Vis2_Bar_Number>=2",
      pickerInput("Vis2_BarY2_Color", h5(strong(HTML("Select Variable 2 Color&nbsp", as.character(actionLink(inputId = "Vis2_BarY2_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("orange"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis2_Bar_Number>=3",
      pickerInput("Vis2_BarY3_Color", h5(strong(HTML("Select Variable 3 Color&nbsp", as.character(actionLink(inputId = "Vis2_BarY3_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("red"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis2_Bar_Number>=4",
      pickerInput("Vis2_BarY4_Color", h5(strong(HTML("Select Variable 4 Color&nbsp", as.character(actionLink(inputId = "Vis2_BarY4_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("green"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis2_Bar_Number>=5",
      pickerInput("Vis2_BarY5_Color", h5(strong(HTML("Select Variable 5 Color&nbsp", as.character(actionLink(inputId = "*Vis2_BarY5_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("purple"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    style='primary'),
  bsCollapsePanel("Legend",
    h5(strong(HTML("Toggle Legend&nbsp", as.character(actionLink(inputId = "Vis2_Bar_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
    radioGroupButtons("Vis2BarLegendOrient",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis2_Bar_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
    switchInput("Vis2_Bar_HideLegend",  onLabel="Display",offLabel="Hide", value=TRUE),
    sliderInput("Vis2_Bar_LegendX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis2_Bar_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=0,step=0.1),
    sliderInput("Vis2_Bar_LegendY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis2_Bar_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=-0.6,step=0.1),
    style='primary'),
  
  bsCollapsePanel("Labels",
    textInput("Vis2_BarTitle", h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis2_BarTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 2"),
    textInput("Vis2_BarXlab", h5(strong(HTML("X Label&nbsp", as.character(actionLink(inputId = "Vis2_BarXlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Surveys"),
    textInput("Vis2_BarYlab", h5(strong(HTML("Y Label&nbsp", as.character(actionLink(inputId = "Vis2_BarYlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
  style='primary')
)),

#### Vis 2 Pie Chart Sidebar ####
conditionalPanel(condition="input.SelectVis2=='Pie Chart'",
  bsCollapse(id="Vis2Pie_Collapse",
    bsCollapsePanel("Data Inputs",
      radioGroupButtons("Vis2_Pie_CategoryType",status='primary',h5(strong(HTML("Categories&nbsp", as.character(actionLink(inputId = "Vis2_Pie_CategoryType_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Metrics","Surveys"),selected="0"),
      conditionalPanel(condition="input.Vis2_Pie_CategoryType=='Metrics'",
        pickerInput("Vis2_Pie_Metrics", h5(strong(HTML("Select Categories&nbsp", as.character(actionLink(inputId = "Vis2_Pie_Metrics_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),selected="Nothing Selected", multiple=TRUE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis2_Pie_CategoryType=='Surveys'",
        pickerInput("Vis2_Pie_Metrics_to_Sum", h5(strong(HTML("Select Metrics to Sum&nbsp", as.character(actionLink(inputId = "Vis2_Pie_Metrics_to_Sum_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),selected="Nothing Selected", multiple=TRUE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
    style='primary'),
  bsCollapsePanel("Legend and Labels",
    h5(strong(HTML("Toggle Legend&nbsp", as.character(actionLink(inputId = "Vis2_Pie_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
    switchInput("Vis2_Pie_HideLegend", onLabel="Display",offLabel="Hide", value=TRUE),
    radioGroupButtons("Vis2_Pie_LegendOrient",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis2_Pie_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
    sliderInput("Vis2_PieX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis2_Pie_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-2,max=2,value=-0.2,step=0.1),
    sliderInput("Vis2_PieY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis2_Pie_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-2,max=2,value=1,step=0.1),
    textInput("Vis2_PieTitle",h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis2_PieTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 2"),
  style='primary')
)),


#### Vis 2 Line Plot Sidebar ####

conditionalPanel(condition="input.SelectVis2=='Line Plot'",
  bsCollapse(id="Vis2Line_Collapse",
    bsCollapsePanel("Data Inputs",
      radioGroupButtons("Vis2_Line_Number", status='primary',h5(strong(HTML("Select number of Y variables:&nbsp", as.character(actionLink(inputId = "Vis2_Line_Number_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c(1:5),selected=""),
    conditionalPanel(condition="input.Vis2_Line_Number>=1",
      pickerInput("Vis2_LineY1", h5(strong(HTML("Select Y (1) Variable&nbsp", as.character(actionLink(inputId = "Vis2_LineY1_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis2_Line_Number>=2",
      pickerInput("Vis2_LineY2", h5(strong(HTML("Select Y (2) Variable&nbsp", as.character(actionLink(inputId = "Vis2_LineY2_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis2_Line_Number>=3",
      pickerInput("Vis2_LineY3", h5(strong(HTML("Select Y (3) Variable&nbsp", as.character(actionLink(inputId = "Vis2_LineY3_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis2_Line_Number>=4",
      pickerInput("Vis2_LineY4", h5(strong(HTML("Select Y (4) Variable&nbsp", as.character(actionLink(inputId = "Vis2_LineY4_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis2_Line_Number>=5",
      pickerInput("Vis2_LineY5", h5(strong(HTML("Select Y (5) Variable&nbsp", as.character(actionLink(inputId = "Vis2_LineY5_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
    ),
  style='primary'),
   bsCollapsePanel("Line and Marker Style",
    bsCollapse(id="Vis2LineandMarker_Collapse",
      bsCollapsePanel("Line Color",
        conditionalPanel(condition="input.Vis2_Line_Number>=1",
          pickerInput("Vis2_Line_ColPal", h5(strong(HTML("Select color palette:&nbsp", as.character(actionLink(inputId = "Vis2_Line_ColPal_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Reds","Purples","Greens","Blues","Greys","Red-Yellow-Blue"="RdYlBu","Red-Yellow-Green"="RdYlGn","Spectral","Set1","Set2","Set3","Pastel1","Pastel2","Paired","Dark2","Accent"),selected="Spectral",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
        ),
     style='primary'),
     bsCollapsePanel("Line Width and Type",
          sliderInput("Vis2_Line_Width",h5(strong(HTML("Line Width:&nbsp", as.character(actionLink(inputId = "Vis2_Line_Width_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=5,value=2,round=TRUE),
      conditionalPanel(condition="input.Vis2_Line_Number>=1",
          pickerInput("Vis2_Linedash1", h5(strong(HTML("Select style for line 1:&nbsp", as.character(actionLink(inputId = "Vis2_Linedash1_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="solid",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis2_Line_Number>=2",
          pickerInput("Vis2_Linedash2", h5(strong(HTML("Select style for line 2:&nbsp", as.character(actionLink(inputId = "Vis2_Linedash2_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="dash",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis2_Line_Number>=3",
          pickerInput("Vis2_Linedash3", h5(strong(HTML("Select style for line 3:&nbsp", as.character(actionLink(inputId = "Vis2_Linedash3_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="dot",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis2_Line_Number>=4",
          pickerInput("Vis2_Linedash4", h5(strong(HTML("Select style for line 4:&nbsp", as.character(actionLink(inputId = "Vis2_Linedash4_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="dashdot",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis2_Line_Number>=5",
          pickerInput("Vis2_Linedash5", h5(strong(HTML("Select style for line 5:&nbsp", as.character(actionLink(inputId = "Vis2_Linedash5_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="longdash",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
     style='primary'),
     bsCollapsePanel("Marker Style",
        sliderInput("Vis2_Line_Point_Size",h5(strong(HTML("Point Size:&nbsp", as.character(actionLink(inputId = "Vis2_Line_Point_Size_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=20,value=5,round=TRUE),
        pickerInput("Vis2_Line_Point_Color",h5(strong(HTML("Point Color&nbsp", as.character(actionLink(inputId = "Vis2_Line_Point_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Gray","Black","White","Red","Blue","Yellow","Green","Purple"),selected="Gray", multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
     style='primary')
    ),
    style='primary'),
  bsCollapsePanel("Legend",
    h5(strong(HTML("Toggle Legend&nbsp", as.character(actionLink(inputId = "Vis2_Line_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
    switchInput("Vis2_Line_HideLegend", onLabel="Display",offLabel="Hide", value=TRUE),
    radioGroupButtons("Vis2_Line_LegendOrient",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis2_Line_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
    sliderInput("Vis2_Line_LegendX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis2_Line_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=0,step=0.1),
    sliderInput("Vis2_Line_LegendY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis2_Line_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=-0.6,step=0.1),
    style='primary'),
  
  bsCollapsePanel("Labels",
    textInput("Vis2_LineTitle", h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis2_LineTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 2"),
    textInput("Vis2_LineXlab", h5(strong(HTML("X Label&nbsp", as.character(actionLink(inputId = "Vis2_LineXlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Year"),
    textInput("Vis2_LineYlab", h5(strong(HTML("Y Label&nbsp", as.character(actionLink(inputId = "Vis2_LineYlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
  style='primary')
)
),

style='primary'))),

##### Visualization 3 Sidebar #####
conditionalPanel(condition="input.AF_VisNum_Selection>=3",
   bsCollapse(id="Vis3Panel",open="Vis3_Panel",
      bsCollapsePanel(value="Vis3_Panel",HTML("Visualization 3 Inputs&nbsp",as.character(actionLink(inputId = "Visualization3Input_Help", HTML('<i class="fas fa-book-open"></i>')))),
           conditionalPanel(condition="input.AF_LinkedSelection!='Yes'&&output.Vis3SelClearStatus>0&&input.SelectVis3!='Map'",
                             actionButton("ClearSel_Vis3","Clear Selection", class = "btn-warning btn-md"),
           ),
            pickerInput("SelectVis3", h5(strong(HTML("Select Visualization 3&nbsp", as.character(actionLink(inputId = "SelectVis3_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected","Map","Line Plot","Scatter Plot","Bar Chart","Pie Chart"),selected="Nothing Selected",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),

##### Vis 3 Map Sidebar #####
   conditionalPanel(condition="input.SelectVis3=='Map'",
       bsCollapse(id="Vis3Map_Collapse",open="Creel Data Display",
            bsCollapsePanel("Creel Data Display",
                conditionalPanel(condition="(input.Vis3_Map_CreelDisplayType=='Scaled Color'&&input.Vis3_MapDisplayField!='Nothing Selected'&&output.Vis_3_Input_SelectCount>0)||
                                                              (input.Vis3_Map_CreelDisplayType=='Scaled Size'&&input.Vis3_MapDisplayField_Size!='Nothing Selected'&&output.Vis_3_Input_SelectCount>0)||
                                                              (input.Vis3_Map_CreelDisplayType=='Both'&&input.Vis3_MapDisplayField_Size!='Nothing Selected'&&input.Vis3_MapDisplayField!='Nothing Selected'&&output.Vis_3_Input_SelectCount>0)",
                actionButton("DisplayCreel_Map_Vis_3","Display Creel Data on Map", class = "btn-danger btn-md"),
                ),
                
                radioGroupButtons("Vis3_Map_CreelDisplayType",status='primary',h5(strong(HTML("Select Creel Data Display Type&nbsp", as.character(actionLink(inputId = "Vis3_Map_CreelDisplayType_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Scaled Color","Scaled Size","Both"),selected=""),
       
        conditionalPanel(condition="input.Vis3_Map_CreelDisplayType!=null",
         bsCollapse(id="Vis3Map_Collapse_Color",
            bsCollapsePanel("Color Settings",
                    conditionalPanel(condition="input.Vis3_Map_CreelDisplayType=='Scaled Color'||input.Vis3_Map_CreelDisplayType=='Both'",
                        pickerInput("Vis3_MapDisplayField", h5(strong(HTML("Select Color Field&nbsp", as.character(actionLink(inputId = "Vis3_MapDisplayField_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                        pickerInput("Vis3_MapColorPalette", h5(strong(HTML("Select Color Palette&nbsp", as.character(actionLink(inputId = "Vis3_MapColorPalette_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Reds","Purples","Greens","Blues","Greys","Red-Yellow-Blue"="RdYlBu","Red-Yellow-Green"="RdYlGn","Spectral","Set1","Set2","Set3","Pastel1","Pastel2","Paired","Dark2","Accent"),selected="Spectral",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                        h5(strong(HTML("Palette Direction&nbsp", as.character(actionLink(inputId = "Vis3_Map_PalToggle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
                        switchInput("Vis3_Map_PalToggle", onLabel="Reverse",offLabel="Standard",value=FALSE),
                        radioGroupButtons("Vis3_Map_CreelColorscalePer",status='primary',h5(strong(HTML("Display Color Data As&nbsp", as.character(actionLink(inputId = "Vis3_Map_CreelColorscalePer_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Values","Percentiles"),selected="Values"),
                      ),
              
                conditionalPanel(condition="input.Vis3_Map_CreelDisplayType=='Scaled Size'",
                                 pickerInput("Vis3_MapColorSolid", h5(strong(HTML("Select Color&nbsp", as.character(actionLink(inputId = "Vis3_MapColorSolid_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Blue","Red","Purple","Green", "White","Black"),selected="Blue",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                ),
            style='primary')
            ),
         
      
        bsCollapse(id="Vis3Map_Collapse_Size",
            bsCollapsePanel("Size Settings",
                conditionalPanel(condition="input.Vis3_Map_CreelDisplayType=='Scaled Size'||input.Vis3_Map_CreelDisplayType=='Both'",
                        pickerInput("Vis3_MapDisplayField_Size", h5(strong(HTML("Select Size Field&nbsp", as.character(actionLink(inputId = "Vis3_MapDisplayField_Size_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                        sliderInput("Vis3_MapDisplayField_SizeSlider",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis3_MapDisplayField_SizeSlider_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=50,value=c(5,15),round=TRUE),
                        radioGroupButtons("Vis3_Map_CreelSizescalePer",status='primary',h5(strong(HTML("Display Size Data As&nbsp", as.character(actionLink(inputId = "Vis3_Map_CreelSizescalePer_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Values","Percentiles"),selected="Values"),
                ),
                
                conditionalPanel(condition="input.Vis3_Map_CreelDisplayType=='Scaled Color'",
                        sliderInput("Vis3_MapDisplayField_SizeSliderSingle",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis3_MapDisplayField_SizeSliderSingle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=25,value=c(5),round=TRUE)
                ),
                style='primary')
            ),
        
        ),
          style='primary'),
        
      bsCollapsePanel("Selection",
                
          radioGroupButtons("Vis3_SelectType",status='primary',h5(strong(HTML("Select by:&nbsp", as.character(actionLink(inputId = "Vis3_SelectType_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Polygon","States","Counties"),selected=""),
        
        conditionalPanel(condition="input.Vis3_SelectType=='Polygon'",
          radioGroupButtons("Vis3_SelectPolygon",status='primary',h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "Vis3_SelectPolygon_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Draw","Complete","Clear"),selected="Draw"),               
        ),
        
        conditionalPanel(condition="input.Vis3_SelectType=='States'",
           radioGroupButtons("Vis3_SelectState",status='primary',h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "Vis3_SelectState_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Select","Complete","Clear"),selected="Select"),              
        ),
        
        conditionalPanel(condition="input.Vis3_SelectType=='Counties'",
           radioGroupButtons("Vis3_SelectCounty",status='primary',h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "Vis3_SelectCounty_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Select","Complete","Clear"),selected="Select"),              
        ),
        
        conditionalPanel(condition="output.Vis3SelClearStatus>0",
                sliderInput("Vis3_FillOpacity",h5(strong(HTML("Unselected Marker Opacity&nbsp", as.character(actionLink(inputId = "Vis3_FillOpacity_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=1,value=0.1),
           ),
                            
                style='primary'),
          
      
      bsCollapsePanel("Labels and Legend",
              
        conditionalPanel(condition="input.Vis3_Map_CreelDisplayType=='Scaled Color'||input.Vis3_Map_CreelDisplayType=='Both'",
        radioGroupButtons("Vis3_AddLegend_Switch",status='primary',h5(strong(HTML("Add Legend:&nbsp", as.character(actionLink(inputId = "Vis3_AddLegend_Switch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Yes","No"))
        ),
        radioGroupButtons("Map_Vis3_Title_Switch",status='primary',h5(strong(HTML("Add Custom Label:&nbsp", as.character(actionLink(inputId = "Map_Vis3_Title_Switch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Yes","No"), selected="No"),
        conditionalPanel(condition="input.Map_Vis3_Title_Switch=='Yes'",
        textInput("Map_Vis3_Title_Text", h5(strong(HTML("Map Label&nbsp", as.character(actionLink(inputId = "Map_Vis3_Title_Text_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 3")
        ),  
          
                            
                style='primary'),
           
        
            bsCollapsePanel("Map Navigation",
                  radioGroupButtons("Vis3_ZoomTo_Switch",status='primary',h5(strong(HTML("Zoom to:&nbsp", as.character(actionLink(inputId = "Vis3_ZoomTo_Switch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Creel Data Extent"="Creel","Selected Geography"="Geography")),
                  conditionalPanel(condition="input.Vis3_ZoomTo_Switch=='Geography'",
                    pickerInput("Vis3_ZoomToState",h5(strong(HTML("Select State Zoom&nbsp", as.character(actionLink(inputId = "Vis3_ZoomToState_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=MapStateChoices,multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                    pickerInput("Vis3_ZoomToCounty",h5(strong(HTML("Select County Zoom&nbsp", as.character(actionLink(inputId = "Vis3_ZoomToCounty_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Nothing Selected","Test 1","Test 2"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                    actionButton("Vis3_GeographyZoomBTN","Zoom to Selected Geography",class = "btn-primary btn-md")
                  ),
                  conditionalPanel(condition="input.Vis3_ZoomTo_Switch=='Creel'",
                      actionButton("Vis3_CreelExtentZoomBTN","Zoom to Creel Extent",class = "btn-primary btn-md")
                  ),
                  style='primary')
            )
     ),

##### Vis 3 Scatter Sidebar #####
conditionalPanel(condition="input.SelectVis3=='Scatter Plot'",
  bsCollapse(id="Vis3Scatter_Collapse",
    bsCollapsePanel("Data Inputs",
      pickerInput("Vis3_ScatterX", h5(strong(HTML("Select X Variable&nbsp", as.character(actionLink(inputId = "Vis3_ScatterX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      pickerInput("Vis3_ScatterY", h5(strong(HTML("Select Y Variable&nbsp", as.character(actionLink(inputId = "Vis3_ScatterY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
     ,style='primary'),
    
    bsCollapsePanel("Marker Style",
      bsCollapse(id="Vis3ScatterStyle_Collapse",
          bsCollapsePanel("Marker Color",
                radioGroupButtons("Vis3_Scatter_ColorGroupSwitch",status='primary',h5(strong(HTML("Color Scale&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_ColorGroupSwitch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Uniform","Numeric","Factors"),selected=c("Uniform")),
               conditionalPanel(condition="input.Vis3_Scatter_ColorGroupSwitch=='Uniform'",
                  pickerInput("Vis3_Scatter_Color",h5(strong(HTML("Marker Color&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Gray","Black","White","Red","Blue","Yellow","Green","Purple"),selected="Gray",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
                ),
               conditionalPanel(condition="input.Vis3_Scatter_ColorGroupSwitch=='Numeric'",
                  pickerInput("Vis3_Scatter_MarkerColor_Numeric",h5(strong(HTML("Color by:&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_MarkerColor_Numeric_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Year"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  pickerInput("Vis3_Scatter_ColorPal_Numeric", h5(strong(HTML("Select Color Palette&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_ColorPal_Numeric_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Blackbody", "Bluered", "Blues", "Cividis", "Earth", "Electric", "Greens", "Greys", "Hot", "Jet", "Picnic", "Portland", "Rainbow", "RdBu", "Reds", "Viridis", "YlGnBu", "YlOrRd"),selected="Rainbow",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  h5(strong(HTML("Palette Direction&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_PalDirection", HTML('<i class="fas fa-info-circle"></i>')))))),   
                  switchInput("Vis3_Scatter_PalToggle", onLabel="Standard",offLabel="Reverse",value=FALSE),
                ),
                conditionalPanel(condition="input.Vis3_Scatter_ColorGroupSwitch=='Factors'",
                  pickerInput("Vis3_Scatter_MarkerColor_Factors",h5(strong(HTML("Color by:&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_MarkerColor_Factors_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("State","Waterbody_Name_Unique"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  pickerInput("Vis3_Scatter_ColorPal_Factors", h5(strong(HTML("Select Color Palette&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_ColorPal_Factors_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Reds","Purples","Greens","Blues","Greys","Red-Yellow-Blue"="RdYlBu","Red-Yellow-Green"="RdYlGn","Spectral","Set1","Set2","Set3","Pastel1","Pastel2","Paired","Dark2","Accent"),selected="Spectral",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  ),
              sliderInput("Vis_3_ScatterOpacity",h5(strong(HTML("Unselected Marker Opacity&nbsp", as.character(actionLink(inputId = "Vis_3_ScatterOpacity_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=1,value=0.2),                         
          style='primary'),
          bsCollapsePanel("Marker Size",
            radioGroupButtons("Vis3_Scatter_MarkerSizeSwitch",status='primary',h5(strong(HTML("Marker Size Method&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_MarkerSizeSwitch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Uniform","Scaled")),
             conditionalPanel(condition="input.Vis3_Scatter_MarkerSizeSwitch=='Uniform'",
                sliderInput("Vis3_Scatter_MarkerSize",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_MarkerSize_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=50,value=10,round=TRUE),
              ),
             conditionalPanel(condition="input.Vis3_Scatter_MarkerSizeSwitch=='Scaled'",
                pickerInput("Vis3_Scatter_MarkerScaleSize",h5(strong(HTML("Marker Size Field&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_MarkerScaleSize_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Year"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                sliderInput("Vis3_Scatter_MarkerSizeSlider",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_MarkerSizeSlider_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=50,value=c(10,20),round=TRUE),
                ),                          
          style='primary')
    ),
    style='primary'),
    
        

    bsCollapsePanel("Trendline",
      radioGroupButtons("Vis3_Scatter_TrendlineSwitch",status='primary',h5(strong(HTML("Add Trendline&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_TrendlineSwitch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("No","Yes")),
      pickerInput("Vis3_Scatter_TrendlineColor",h5(strong(HTML("Select Trendline Color&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_TrendlineColor_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Gray","White","Black","Red","Blue","Yellow","Green","Purple"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      sliderInput("Vis3_Scatter_TrendlineWidth",h5(strong(HTML("Trendline Width&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_TrendlineWidth_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=5,value=2,round=TRUE)
    ,style='primary'),    
    
    bsCollapsePanel("Labels and Legend",
      h5(strong(HTML("Toggle Legend and Text&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),   
      switchInput("Vis3_Scatter_HideLegend", onLabel="Display",offLabel="Hide",value=TRUE),
      radioGroupButtons("Vis3_Scatter_Orientation",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
      sliderInput("Vis3_Scatter_LegendX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=1,step=0.1),
      sliderInput("Vis3_Scatter_LegendY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis3_Scatter_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=1,step=0.1),
      textInput("Vis3_ScatterTitle", h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis3_ScatterTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 3"),
      textInput("Vis3_ScatterXlab", h5(strong(HTML("X Label&nbsp", as.character(actionLink(inputId = "Vis3_ScatterXlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
      textInput("Vis3_ScatterYlab", h5(strong(HTML("Y Label&nbsp", as.character(actionLink(inputId = "Vis3_ScatterYlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
     style='primary')
    

 )),

##### Vis 3 Bar Chart Sidebar #####
conditionalPanel(condition="input.SelectVis3=='Bar Chart'",
  bsCollapse(id="Vis3Bar_Collapse",
    bsCollapsePanel("Data Inputs",
      radioGroupButtons("Vis3_Bar_Number",status='primary',h5(strong(HTML("Select number of Y variables&nbsp", as.character(actionLink(inputId = "Vis3_Bar_Number_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c(1:5),selected=""),
    conditionalPanel(condition="input.Vis3_Bar_Number>=1",
      pickerInput("Vis3_BarY1", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (1) Variable&nbsp", as.character(actionLink(inputId = "Vis3_BarY1_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis3_Bar_Number>=2",
      pickerInput("Vis3_BarY2", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (2) Variable&nbsp", as.character(actionLink(inputId = "Vis3_BarY2_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis3_Bar_Number>=3",
      pickerInput("Vis3_BarY3", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (3) Variable&nbsp", as.character(actionLink(inputId = "Vis3_BarY3_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis3_Bar_Number>=4",
      pickerInput("Vis3_BarY4", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (4) Variable&nbsp", as.character(actionLink(inputId = "Vis3_BarY4_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis3_Bar_Number>=5",
      pickerInput("Vis3_BarY5", choices=c("Nothing Selected"), h5(strong(HTML("Select Y (5) Variable&nbsp", as.character(actionLink(inputId = "*Vis3_BarY5_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
    ),
  style='primary'),
  bsCollapsePanel("Style",
      pickerInput("Vis3_BarY1_Color", h5(strong(HTML("Select Variable 1 Color&nbsp", as.character(actionLink(inputId = "Vis3_BarY1_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("blue"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    conditionalPanel(condition="input.Vis3_Bar_Number>=2",
      pickerInput("Vis3_BarY2_Color", h5(strong(HTML("Select Variable 2 Color&nbsp", as.character(actionLink(inputId = "Vis3_BarY2_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("orange"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis3_Bar_Number>=3",
      pickerInput("Vis3_BarY3_Color", h5(strong(HTML("Select Variable 3 Color&nbsp", as.character(actionLink(inputId = "Vis3_BarY3_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("red"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis3_Bar_Number>=4",
      pickerInput("Vis3_BarY4_Color", h5(strong(HTML("Select Variable 4 Color&nbsp", as.character(actionLink(inputId = "Vis3_BarY4_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("green"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis3_Bar_Number>=5",
      pickerInput("Vis3_BarY5_Color", h5(strong(HTML("Select Variable 5 Color&nbsp", as.character(actionLink(inputId = "*Vis3_BarY5_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("purple"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    style='primary'),
  bsCollapsePanel("Legend",
    h5(strong(HTML("Toggle Legend&nbsp", as.character(actionLink(inputId = "Vis3_Bar_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
    switchInput("Vis3_Bar_HideLegend",  onLabel="Display",offLabel="Hide", value=TRUE),
    radioGroupButtons("Vi3BarLegendOrient",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis3_Bar_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
    sliderInput("Vis3_Bar_LegendX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis3_Bar_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=0,step=0.1),
    sliderInput("Vis3_Bar_LegendY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis3_Bar_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=-0.6,step=0.1),
    style='primary'),
  
  bsCollapsePanel("Labels",
    textInput("Vis3_BarTitle", h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis3_BarTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 3"),
    textInput("Vis3_BarXlab", h5(strong(HTML("X Label&nbsp", as.character(actionLink(inputId = "Vis3_BarXlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Surveys"),
    textInput("Vis3_BarYlab", h5(strong(HTML("Y Label&nbsp", as.character(actionLink(inputId = "Vis3_BarYlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
  style='primary')
)),

#### Vis 3 Pie Chart Sidebar ####
conditionalPanel(condition="input.SelectVis3=='Pie Chart'",
  bsCollapse(id="Vis3Pie_Collapse",
    bsCollapsePanel("Data Inputs",
      radioGroupButtons("Vis3_Pie_CategoryType",status='primary',h5(strong(HTML("Categories&nbsp", as.character(actionLink(inputId = "Vis3_Pie_CategoryType_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Metrics","Surveys"),selected="0"),
      conditionalPanel(condition="input.Vis3_Pie_CategoryType=='Metrics'",
        pickerInput("Vis3_Pie_Metrics", h5(strong(HTML("Select Categories&nbsp", as.character(actionLink(inputId = "Vis3_Pie_Metrics_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),selected="Nothing Selected", multiple=TRUE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis3_Pie_CategoryType=='Surveys'",
        pickerInput("Vis3_Pie_Metrics_to_Sum", h5(strong(HTML("Select Metrics to Sum&nbsp", as.character(actionLink(inputId = "Vis3_Pie_Metrics_to_Sum_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),selected="Nothing Selected", multiple=TRUE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
    style='primary'),
  bsCollapsePanel("Legend and Labels",
    h5(strong(HTML("Toggle Legend&nbsp", as.character(actionLink(inputId = "Vis3_Pie_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
    switchInput("Vis3_Pie_HideLegend", onLabel="Display",offLabel="Hide", value=TRUE),
    radioGroupButtons("Vis3_Pie_LegendOrient",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis3_Pie_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
    sliderInput("Vis3_PieX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis3_Pie_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-2,max=2,value=-0.2,step=0.1),
    sliderInput("Vis3_PieY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis3_Pie_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-2,max=2,value=1,step=0.1),
    textInput("Vis3_PieTitle",h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis3_PieTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 3"),
  style='primary')
)),


#### Vis 3 Line Plot Sidebar ####

conditionalPanel(condition="input.SelectVis3=='Line Plot'",
  bsCollapse(id="Vis3Line_Collapse",
    bsCollapsePanel("Data Inputs",
      radioGroupButtons("Vis3_Line_Number", status='primary',h5(strong(HTML("Select number of Y variables:&nbsp", as.character(actionLink(inputId = "Vis3_Line_Number_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c(1:5),selected=""),
    conditionalPanel(condition="input.Vis3_Line_Number>=1",
      pickerInput("Vis3_LineY1", h5(strong(HTML("Select Y (1) Variable&nbsp", as.character(actionLink(inputId = "Vis3_LineY1_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis3_Line_Number>=2",
      pickerInput("Vis3_LineY2", h5(strong(HTML("Select Y (2) Variable&nbsp", as.character(actionLink(inputId = "Vis3_LineY2_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis3_Line_Number>=3",
      pickerInput("Vis3_LineY3", h5(strong(HTML("Select Y (3) Variable&nbsp", as.character(actionLink(inputId = "Vis3_LineY3_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis3_Line_Number>=4",
      pickerInput("Vis3_LineY4", h5(strong(HTML("Select Y (4) Variable&nbsp", as.character(actionLink(inputId = "Vis3_LineY4_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis3_Line_Number>=5",
      pickerInput("Vis3_LineY5", h5(strong(HTML("Select Y (5) Variable&nbsp", as.character(actionLink(inputId = "Vis3_LineY5_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
    ),
  style='primary'),
   bsCollapsePanel("Line and Marker Style",
    bsCollapse(id="Vis3LineandMarker_Collapse",
      bsCollapsePanel("Line Color",
        conditionalPanel(condition="input.Vis3_Line_Number>=1",
          pickerInput("Vis3_Line_ColPal", h5(strong(HTML("Select color palette:&nbsp", as.character(actionLink(inputId = "Vis3_Line_ColPal_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Reds","Purples","Greens","Blues","Greys","Red-Yellow-Blue"="RdYlBu","Red-Yellow-Green"="RdYlGn","Spectral","Set1","Set2","Set3","Pastel1","Pastel2","Paired","Dark2","Accent"),selected="Spectral",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
        ),
     style='primary'),
     bsCollapsePanel("Line Width and Type",
          sliderInput("Vis3_Line_Width",h5(strong(HTML("Line Width:&nbsp", as.character(actionLink(inputId = "Vis3_Line_Width_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=5,value=2,round=TRUE),
      conditionalPanel(condition="input.Vis3_Line_Number>=1",
          pickerInput("Vis3_Linedash1", h5(strong(HTML("Select style for line 1:&nbsp", as.character(actionLink(inputId = "Vis3_Linedash1_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="solid",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis3_Line_Number>=2",
          pickerInput("Vis3_Linedash2", h5(strong(HTML("Select style for line 2:&nbsp", as.character(actionLink(inputId = "Vis3_Linedash2_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="dash",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis3_Line_Number>=3",
          pickerInput("Vis3_Linedash3", h5(strong(HTML("Select style for line 3:&nbsp", as.character(actionLink(inputId = "Vis3_Linedash3_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="dot",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis3_Line_Number>=4",
          pickerInput("Vis3_Linedash4", h5(strong(HTML("Select style for line 4:&nbsp", as.character(actionLink(inputId = "Vis3_Linedash4_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="dashdot",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis3_Line_Number>=5",
          pickerInput("Vis3_Linedash5", h5(strong(HTML("Select style for line 5:&nbsp", as.character(actionLink(inputId = "Vis3_Linedash5_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="longdash",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
     style='primary'),
     bsCollapsePanel("Marker Style",
        sliderInput("Vis3_Line_Point_Size",h5(strong(HTML("Point Size:&nbsp", as.character(actionLink(inputId = "Vis3_Line_Point_Size_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=20,value=5,round=TRUE),
        pickerInput("Vis3_Line_Point_Color",h5(strong(HTML("Point Color&nbsp", as.character(actionLink(inputId = "Vis3_Line_Point_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Gray","Black","White","Red","Blue","Yellow","Green","Purple"),selected="Gray", multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
     style='primary')
    ),
    style='primary'),
  bsCollapsePanel("Legend",
    h5(strong(HTML("Toggle Legend&nbsp", as.character(actionLink(inputId = "Vis3_Line_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
    switchInput("Vis3_Line_HideLegend", onLabel="Display",offLabel="Hide", value=TRUE),
    radioGroupButtons("Vis3_Line_LegendOrient",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis3_Line_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
    sliderInput("Vis3_Line_LegendX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis3_Line_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=0,step=0.1),
    sliderInput("Vis3_Line_LegendY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis3_Line_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=-0.6,step=0.1),
    style='primary'),
  
  bsCollapsePanel("Labels",
    textInput("Vis3_LineTitle", h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis3_LineTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 3"),
    textInput("Vis3_LineXlab", h5(strong(HTML("X Label&nbsp", as.character(actionLink(inputId = "Vis3_LineXlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Year"),
    textInput("Vis3_LineYlab", h5(strong(HTML("Y Label&nbsp", as.character(actionLink(inputId = "Vis3_LineYlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
  style='primary')
)
),

style='primary'))),

##### Visualization 4 Sidebar #####
conditionalPanel(condition="input.AF_VisNum_Selection>=4",
   bsCollapse(id="Vis4Panel",open="Vis4_Panel",
      bsCollapsePanel(value="Vis4_Panel",HTML("Visualization 4 Inputs&nbsp",as.character(actionLink(inputId = "Visualization4Input_Help", HTML('<i class="fas fa-book-open"></i>')))),
           conditionalPanel(condition="input.AF_LinkedSelection!='Yes'&&output.Vis4SelClearStatus>0&&input.SelectVis4!='Map'",
                             actionButton("ClearSel_Vis4","Clear Selection", class = "btn-warning btn-md"),
           ),
            pickerInput("SelectVis4", h5(strong(HTML("Select Visualization 4&nbsp", as.character(actionLink(inputId = "SelectVis4_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected","Map","Line Plot","Scatter Plot","Bar Chart","Pie Chart"),selected="Nothing Selected",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),

##### Vis 4 Map Sidebar #####
   conditionalPanel(condition="input.SelectVis4=='Map'",
       bsCollapse(id="Vis4Map_Collapse",open="Creel Data Display",
            bsCollapsePanel("Creel Data Display",
                conditionalPanel(condition="(input.Vis4_Map_CreelDisplayType=='Scaled Color'&&input.Vis4_MapDisplayField!='Nothing Selected'&&output.Vis_4_Input_SelectCount>0)||
                                                              (input.Vis4_Map_CreelDisplayType=='Scaled Size'&&input.Vis4_MapDisplayField_Size!='Nothing Selected'&&output.Vis_4_Input_SelectCount>0)||
                                                              (input.Vis4_Map_CreelDisplayType=='Both'&&input.Vis4_MapDisplayField_Size!='Nothing Selected'&&input.Vis4_MapDisplayField!='Nothing Selected'&&output.Vis_4_Input_SelectCount>0)",
                actionButton("DisplayCreel_Map_Vis_4","Display Creel Data on Map", class = "btn-danger btn-md"),
                ),
                
                radioGroupButtons("Vis4_Map_CreelDisplayType",status='primary',h5(strong(HTML("Select Creel Data Display Type&nbsp", as.character(actionLink(inputId = "Vis4_Map_CreelDisplayType_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Scaled Color","Scaled Size","Both"),selected=""),
       
        conditionalPanel(condition="input.Vis4_Map_CreelDisplayType!=null",
         bsCollapse(id="Vis4Map_Collapse_Color",
            bsCollapsePanel("Color Settings",
                    conditionalPanel(condition="input.Vis4_Map_CreelDisplayType=='Scaled Color'||input.Vis4_Map_CreelDisplayType=='Both'",
                        pickerInput("Vis4_MapDisplayField", h5(strong(HTML("Select Color Field&nbsp", as.character(actionLink(inputId = "Vis4_MapDisplayField_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                        pickerInput("Vis4_MapColorPalette", h5(strong(HTML("Select Color Palette&nbsp", as.character(actionLink(inputId = "Vis4_MapColorPalette_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Reds","Purples","Greens","Blues","Greys","Red-Yellow-Blue"="RdYlBu","Red-Yellow-Green"="RdYlGn","Spectral","Set1","Set2","Set3","Pastel1","Pastel2","Paired","Dark2","Accent"),selected="Spectral",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                        h5(strong(HTML("Palette Direction&nbsp", as.character(actionLink(inputId = "Vis4_Map_PalToggle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
                        switchInput("Vis4_Map_PalToggle", onLabel="Reverse",offLabel="Standard",value=FALSE),
                        radioGroupButtons("Vis4_Map_CreelColorscalePer",status='primary',h5(strong(HTML("Display Color Data As&nbsp", as.character(actionLink(inputId = "Vis4_Map_CreelColorscalePer_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Values","Percentiles"),selected="Values"),
                      ),
              
                conditionalPanel(condition="input.Vis4_Map_CreelDisplayType=='Scaled Size'",
                                 pickerInput("Vis4_MapColorSolid", h5(strong(HTML("Select Color&nbsp", as.character(actionLink(inputId = "Vis4_MapColorSolid_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Blue","Red","Purple","Green", "White","Black"),selected="Blue",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                ),
            style='primary')
            ),
         
      
        bsCollapse(id="Vis4Map_Collapse_Size",
            bsCollapsePanel("Size Settings",
                conditionalPanel(condition="input.Vis4_Map_CreelDisplayType=='Scaled Size'||input.Vis4_Map_CreelDisplayType=='Both'",
                        pickerInput("Vis4_MapDisplayField_Size", h5(strong(HTML("Select Size Field&nbsp", as.character(actionLink(inputId = "Vis4_MapDisplayField_Size_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                        sliderInput("Vis4_MapDisplayField_SizeSlider",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis4_MapDisplayField_SizeSlider_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=50,value=c(5,15),round=TRUE),
                        radioGroupButtons("Vis4_Map_CreelSizescalePer",status='primary',h5(strong(HTML("Display Size Data As&nbsp", as.character(actionLink(inputId = "Vis4_Map_CreelSizescalePer_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Values","Percentiles"),selected="Values"),
                ),
                
                conditionalPanel(condition="input.Vis4_Map_CreelDisplayType=='Scaled Color'",
                        sliderInput("Vis4_MapDisplayField_SizeSliderSingle",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis4_MapDisplayField_SizeSliderSingle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=25,value=c(5),round=TRUE)
                ),
                style='primary')
            ),
        
        ),
          style='primary'),
        
      bsCollapsePanel("Selection",
                
          radioGroupButtons("Vis4_SelectType",status='primary',h5(strong(HTML("Select by:&nbsp", as.character(actionLink(inputId = "Vis4_SelectType_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Polygon","States","Counties"),selected=""),
        
        conditionalPanel(condition="input.Vis4_SelectType=='Polygon'",
          radioGroupButtons("Vis4_SelectPolygon",status='primary',h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "Vis4_SelectPolygon_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Draw","Complete","Clear"),selected="Draw"),               
        ),
        
        conditionalPanel(condition="input.Vis4_SelectType=='States'",
           radioGroupButtons("Vis4_SelectState",status='primary',h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "Vis4_SelectState_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Select","Complete","Clear"),selected="Select"),              
        ),
        
        conditionalPanel(condition="input.Vis4_SelectType=='Counties'",
           radioGroupButtons("Vis4_SelectCounty",status='primary',h5(strong(HTML("Controls&nbsp", as.character(actionLink(inputId = "Vis4_SelectCounty_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Select","Complete","Clear"),selected="Select"),              
        ),
        
        conditionalPanel(condition="output.Vis4SelClearStatus>0",
                sliderInput("Vis4_FillOpacity",h5(strong(HTML("Unselected Marker Opacity&nbsp", as.character(actionLink(inputId = "Vis4_FillOpacity_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=1,value=0.1),
           ),
                            
                style='primary'),
          
      
      bsCollapsePanel("Labels and Legend",
              
        conditionalPanel(condition="input.Vis4_Map_CreelDisplayType=='Scaled Color'||input.Vis4_Map_CreelDisplayType=='Both'",
        radioGroupButtons("Vis4_AddLegend_Switch",status='primary',h5(strong(HTML("Add Legend:&nbsp", as.character(actionLink(inputId = "Vis4_AddLegend_Switch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Yes","No"))
        ),
        radioGroupButtons("Map_Vis4_Title_Switch",status='primary',h5(strong(HTML("Add Custom Label:&nbsp", as.character(actionLink(inputId = "Map_Vis4_Title_Switch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Yes","No"), selected="No"),
        conditionalPanel(condition="input.Map_Vis4_Title_Switch=='Yes'",
        textInput("Map_Vis4_Title_Text", h5(strong(HTML("Map Label&nbsp", as.character(actionLink(inputId = "Map_Vis4_Title_Text_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 4")
        ),  
          
                            
                style='primary'),
           
        
            bsCollapsePanel("Map Navigation",
                  radioGroupButtons("Vis4_ZoomTo_Switch",status='primary',h5(strong(HTML("Zoom to:&nbsp", as.character(actionLink(inputId = "Vis4_ZoomTo_Switch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Creel Data Extent"="Creel","Selected Geography"="Geography")),
                  conditionalPanel(condition="input.Vis4_ZoomTo_Switch=='Geography'",
                    pickerInput("Vis4_ZoomToState",h5(strong(HTML("Select State Zoom&nbsp", as.character(actionLink(inputId = "Vis4_ZoomToState_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=MapStateChoices,multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                    pickerInput("Vis4_ZoomToCounty",h5(strong(HTML("Select County Zoom&nbsp", as.character(actionLink(inputId = "Vis4_ZoomToCounty_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Nothing Selected","Test 1","Test 2"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                    actionButton("Vis4_GeographyZoomBTN","Zoom to Selected Geography",class = "btn-primary btn-md")
                  ),
                  conditionalPanel(condition="input.Vis4_ZoomTo_Switch=='Creel'",
                      actionButton("Vis4_CreelExtentZoomBTN","Zoom to Creel Extent",class = "btn-primary btn-md")
                  ),
                  style='primary')
            )
     ),

##### Vis 4 Scatter Sidebar #####
conditionalPanel(condition="input.SelectVis4=='Scatter Plot'",
  bsCollapse(id="Vis4Scatter_Collapse",
    bsCollapsePanel("Data Inputs",
      pickerInput("Vis4_ScatterX", h5(strong(HTML("Select X Variable&nbsp", as.character(actionLink(inputId = "Vis4_ScatterX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      pickerInput("Vis4_ScatterY", h5(strong(HTML("Select Y Variable&nbsp", as.character(actionLink(inputId = "Vis4_ScatterY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
     ,style='primary'),
    
    bsCollapsePanel("Marker Style",
      bsCollapse(id="Vis4ScatterStyle_Collapse",
          bsCollapsePanel("Marker Color",
                radioGroupButtons("Vis4_Scatter_ColorGroupSwitch",status='primary',h5(strong(HTML("Color Scale&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_ColorGroupSwitch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Uniform","Numeric","Factors"),selected=c("Uniform")),
               conditionalPanel(condition="input.Vis4_Scatter_ColorGroupSwitch=='Uniform'",
                  pickerInput("Vis4_Scatter_Color",h5(strong(HTML("Marker Color&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Gray","Black","White","Red","Blue","Yellow","Green","Purple"),selected="Gray",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
                ),
               conditionalPanel(condition="input.Vis4_Scatter_ColorGroupSwitch=='Numeric'",
                  pickerInput("Vis4_Scatter_MarkerColor_Numeric",h5(strong(HTML("Color by:&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_MarkerColor_Numeric_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Year"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  pickerInput("Vis4_Scatter_ColorPal_Numeric", h5(strong(HTML("Select Color Palette&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_ColorPal_Numeric_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Blackbody", "Bluered", "Blues", "Cividis", "Earth", "Electric", "Greens", "Greys", "Hot", "Jet", "Picnic", "Portland", "Rainbow", "RdBu", "Reds", "Viridis", "YlGnBu", "YlOrRd"),selected="Rainbow",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  h5(strong(HTML("Palette Direction&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_PalDirection", HTML('<i class="fas fa-info-circle"></i>')))))),   
                  switchInput("Vis4_Scatter_PalToggle", onLabel="Standard",offLabel="Reverse",value=FALSE),
                ),
                conditionalPanel(condition="input.Vis4_Scatter_ColorGroupSwitch=='Factors'",
                  pickerInput("Vis4_Scatter_MarkerColor_Factors",h5(strong(HTML("Color by:&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_MarkerColor_Factors_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("State","Waterbody_Name_Unique"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  pickerInput("Vis4_Scatter_ColorPal_Factors", h5(strong(HTML("Select Color Palette&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_ColorPal_Factors_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Reds","Purples","Greens","Blues","Greys","Red-Yellow-Blue"="RdYlBu","Red-Yellow-Green"="RdYlGn","Spectral","Set1","Set2","Set3","Pastel1","Pastel2","Paired","Dark2","Accent"),selected="Spectral",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                  ),
              sliderInput("Vis_4_ScatterOpacity",h5(strong(HTML("Unselected Marker Opacity&nbsp", as.character(actionLink(inputId = "Vis_4_ScatterOpacity_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=1,value=0.2),                         
          style='primary'),
          bsCollapsePanel("Marker Size",
            radioGroupButtons("Vis4_Scatter_MarkerSizeSwitch",status='primary',h5(strong(HTML("Marker Size Method&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_MarkerSizeSwitch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Uniform","Scaled")),
             conditionalPanel(condition="input.Vis4_Scatter_MarkerSizeSwitch=='Uniform'",
                sliderInput("Vis4_Scatter_MarkerSize",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_MarkerSize_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=50,value=10,round=TRUE),
              ),
             conditionalPanel(condition="input.Vis4_Scatter_MarkerSizeSwitch=='Scaled'",
                pickerInput("Vis4_Scatter_MarkerScaleSize",h5(strong(HTML("Marker Size Field&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_MarkerScaleSize_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Year"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
                sliderInput("Vis4_Scatter_MarkerSizeSlider",h5(strong(HTML("Marker Size&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_MarkerSizeSlider_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=50,value=c(10,20),round=TRUE),
                ),                          
          style='primary')
    ),
    style='primary'),
    
        

    bsCollapsePanel("Trendline",
      radioGroupButtons("Vis4_Scatter_TrendlineSwitch",status='primary',h5(strong(HTML("Add Trendline&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_TrendlineSwitch_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("No","Yes")),
      pickerInput("Vis4_Scatter_TrendlineColor",h5(strong(HTML("Select Trendline Color&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_TrendlineColor_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Gray","White","Black","Red","Blue","Yellow","Green","Purple"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      sliderInput("Vis4_Scatter_TrendlineWidth",h5(strong(HTML("Trendline Width&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_TrendlineWidth_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=5,value=2,round=TRUE)
    ,style='primary'),    
    
    bsCollapsePanel("Labels and Legend",
      h5(strong(HTML("Toggle Legend and Text&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),   
      switchInput("Vis4_Scatter_HideLegend", onLabel="Display",offLabel="Hide",value=TRUE),
      radioGroupButtons("Vis4_Scatter_Orientation",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
      sliderInput("Vis4_Scatter_LegendX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=1,step=0.1),
      sliderInput("Vis4_Scatter_LegendY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis4_Scatter_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=1,step=0.1),
      textInput("Vis4_ScatterTitle", h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis4_ScatterTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 4"),
      textInput("Vis4_ScatterXlab", h5(strong(HTML("X Label&nbsp", as.character(actionLink(inputId = "Vis4_ScatterXlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
      textInput("Vis4_ScatterYlab", h5(strong(HTML("Y Label&nbsp", as.character(actionLink(inputId = "Vis4_ScatterYlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
     style='primary')
    

 )),

##### Vis 4 Bar Chart Sidebar #####
conditionalPanel(condition="input.SelectVis4=='Bar Chart'",
  bsCollapse(id="Vis4Bar_Collapse",
    bsCollapsePanel("Data Inputs",
      radioGroupButtons("Vis4_Bar_Number",status='primary',h5(strong(HTML("Select number of Y variables&nbsp", as.character(actionLink(inputId = "Vis4_Bar_Number_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c(1:5),selected=""),
    conditionalPanel(condition="input.Vis4_Bar_Number>=1",
      pickerInput("Vis4_BarY1", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (1) Variable&nbsp", as.character(actionLink(inputId = "Vis4_BarY1_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis4_Bar_Number>=2",
      pickerInput("Vis4_BarY2", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (2) Variable&nbsp", as.character(actionLink(inputId = "Vis4_BarY2_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis4_Bar_Number>=3",
      pickerInput("Vis4_BarY3", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (3) Variable&nbsp", as.character(actionLink(inputId = "Vis4_BarY3_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis4_Bar_Number>=4",
      pickerInput("Vis4_BarY4", choices=c("Nothing Selected"),h5(strong(HTML("Select Y (4) Variable&nbsp", as.character(actionLink(inputId = "Vis4_BarY4_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis4_Bar_Number>=5",
      pickerInput("Vis4_BarY5", choices=c("Nothing Selected"), h5(strong(HTML("Select Y (5) Variable&nbsp", as.character(actionLink(inputId = "*Vis4_BarY5_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
    ),
  style='primary'),
  bsCollapsePanel("Style",
      pickerInput("Vis4_BarY1_Color", h5(strong(HTML("Select Variable 1 Color&nbsp", as.character(actionLink(inputId = "Vis4_BarY1_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("blue"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    conditionalPanel(condition="input.Vis4_Bar_Number>=2",
      pickerInput("Vis4_BarY2_Color", h5(strong(HTML("Select Variable 2 Color&nbsp", as.character(actionLink(inputId = "Vis4_BarY2_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("orange"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis4_Bar_Number>=3",
      pickerInput("Vis4_BarY3_Color", h5(strong(HTML("Select Variable 3 Color&nbsp", as.character(actionLink(inputId = "Vis4_BarY3_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("red"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis4_Bar_Number>=4",
      pickerInput("Vis4_BarY4_Color", h5(strong(HTML("Select Variable 4 Color&nbsp", as.character(actionLink(inputId = "Vis4_BarY4_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("green"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis4_Bar_Number>=5",
      pickerInput("Vis4_BarY5_Color", h5(strong(HTML("Select Variable 5 Color&nbsp", as.character(actionLink(inputId = "*Vis4_BarY5_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), selected=c("purple"), choices=c("Red"="red","Blue"="blue","Yellow"="yellow","Green"="green","Orange"="orange","Purple"="purple","Brown"="brown","Pink"="pink","Black"="black","Grey"="grey"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    style='primary'),
  bsCollapsePanel("Legend",
    h5(strong(HTML("Toggle Legend&nbsp", as.character(actionLink(inputId = "Vis4_Bar_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
    switchInput("Vis4_Bar_HideLegend",  onLabel="Display",offLabel="Hide", value=TRUE),
    radioGroupButtons("Vis4BarLegendOrient",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis4_Bar_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
    sliderInput("Vis4_Bar_LegendX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis4_Bar_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=0,step=0.1),
    sliderInput("Vis4_Bar_LegendY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis4_Bar_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=-0.6,step=0.1),
    style='primary'),
  
  bsCollapsePanel("Labels",
    textInput("Vis4_BarTitle", h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis4_BarTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 4"),
    textInput("Vis4_BarXlab", h5(strong(HTML("X Label&nbsp", as.character(actionLink(inputId = "Vis4_BarXlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Surveys"),
    textInput("Vis4_BarYlab", h5(strong(HTML("Y Label&nbsp", as.character(actionLink(inputId = "Vis4_BarYlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
  style='primary')
)),

#### Vis 4 Pie Chart Sidebar ####
conditionalPanel(condition="input.SelectVis4=='Pie Chart'",
  bsCollapse(id="Vis4Pie_Collapse",
    bsCollapsePanel("Data Inputs",
      radioGroupButtons("Vis4_Pie_CategoryType",status='primary',h5(strong(HTML("Categories&nbsp", as.character(actionLink(inputId = "Vis4_Pie_CategoryType_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Metrics","Surveys"),selected="0"),
      conditionalPanel(condition="input.Vis4_Pie_CategoryType=='Metrics'",
        pickerInput("Vis4_Pie_Metrics", h5(strong(HTML("Select Categories&nbsp", as.character(actionLink(inputId = "Vis4_Pie_Metrics_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),selected="Nothing Selected", multiple=TRUE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis4_Pie_CategoryType=='Surveys'",
        pickerInput("Vis4_Pie_Metrics_to_Sum", h5(strong(HTML("Select Metrics to Sum&nbsp", as.character(actionLink(inputId = "Vis4_Pie_Metrics_to_Sum_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),selected="Nothing Selected", multiple=TRUE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
    style='primary'),
  bsCollapsePanel("Legend and Labels",
    h5(strong(HTML("Toggle Legend&nbsp", as.character(actionLink(inputId = "Vis4_Pie_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
    switchInput("Vis4_Pie_HideLegend", onLabel="Display",offLabel="Hide", value=TRUE),
    radioGroupButtons("Vis4_Pie_LegendOrient",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis4_Pie_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
    sliderInput("Vis4_PieX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis4_Pie_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-2,max=2,value=-0.2,step=0.1),
    sliderInput("Vis4_PieY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis4_Pie_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-2,max=2,value=1,step=0.1),
    textInput("Vis4_PieTitle",h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis4_PieTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 4"),
  style='primary')
)),


#### Vis 4 Line Plot Sidebar ####

conditionalPanel(condition="input.SelectVis4=='Line Plot'",
  bsCollapse(id="Vis4Line_Collapse",
    bsCollapsePanel("Data Inputs",
      radioGroupButtons("Vis4_Line_Number", status='primary',h5(strong(HTML("Select number of Y variables:&nbsp", as.character(actionLink(inputId = "Vis4_Line_Number_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c(1:5),selected=""),
    conditionalPanel(condition="input.Vis4_Line_Number>=1",
      pickerInput("Vis4_LineY1", h5(strong(HTML("Select Y (1) Variable&nbsp", as.character(actionLink(inputId = "Vis4_LineY1_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis4_Line_Number>=2",
      pickerInput("Vis4_LineY2", h5(strong(HTML("Select Y (2) Variable&nbsp", as.character(actionLink(inputId = "Vis4_LineY2_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis4_Line_Number>=3",
      pickerInput("Vis4_LineY3", h5(strong(HTML("Select Y (3) Variable&nbsp", as.character(actionLink(inputId = "Vis4_LineY3_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis4_Line_Number>=4",
      pickerInput("Vis4_LineY4", h5(strong(HTML("Select Y (4) Variable&nbsp", as.character(actionLink(inputId = "Vis4_LineY4_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
    ),
    conditionalPanel(condition="input.Vis4_Line_Number>=5",
      pickerInput("Vis4_LineY5", h5(strong(HTML("Select Y (5) Variable&nbsp", as.character(actionLink(inputId = "Vis4_LineY5_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Nothing Selected"),multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains'))
    ),
  style='primary'),
   bsCollapsePanel("Line and Marker Style",
    bsCollapse(id="Vis4LineandMarker_Collapse",
      bsCollapsePanel("Line Color",
        conditionalPanel(condition="input.Vis4_Line_Number>=1",
          pickerInput("Vis4_Line_ColPal", h5(strong(HTML("Select color palette:&nbsp", as.character(actionLink(inputId = "Vis4_Line_ColPal_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("Reds","Purples","Greens","Blues","Greys","Red-Yellow-Blue"="RdYlBu","Red-Yellow-Green"="RdYlGn","Spectral","Set1","Set2","Set3","Pastel1","Pastel2","Paired","Dark2","Accent"),selected="Spectral",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
        ),
     style='primary'),
     bsCollapsePanel("Line Width and Type",
          sliderInput("Vis4_Line_Width",h5(strong(HTML("Line Width:&nbsp", as.character(actionLink(inputId = "Vis4_Line_Width_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=0,max=5,value=2,round=TRUE),
      conditionalPanel(condition="input.Vis4_Line_Number>=1",
          pickerInput("Vis4_Linedash1", h5(strong(HTML("Select style for line 1:&nbsp", as.character(actionLink(inputId = "Vis4_Linedash1_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="solid",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis4_Line_Number>=2",
          pickerInput("Vis4_Linedash2", h5(strong(HTML("Select style for line 2:&nbsp", as.character(actionLink(inputId = "Vis4_Linedash2_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="dash",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis4_Line_Number>=3",
          pickerInput("Vis4_Linedash3", h5(strong(HTML("Select style for line 3:&nbsp", as.character(actionLink(inputId = "Vis4_Linedash3_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="dot",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis4_Line_Number>=4",
          pickerInput("Vis4_Linedash4", h5(strong(HTML("Select style for line 4:&nbsp", as.character(actionLink(inputId = "Vis4_Linedash4_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="dashdot",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
      conditionalPanel(condition="input.Vis4_Line_Number>=5",
          pickerInput("Vis4_Linedash5", h5(strong(HTML("Select style for line 5:&nbsp", as.character(actionLink(inputId = "Vis4_Linedash5_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("solid","dash","dot","dashdot","longdash","longdashdot"),selected="longdash",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
      ),
     style='primary'),
     bsCollapsePanel("Marker Style",
        sliderInput("Vis4_Line_Point_Size",h5(strong(HTML("Point Size:&nbsp", as.character(actionLink(inputId = "Vis4_Line_Point_Size_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),min=1,max=20,value=5,round=TRUE),
        pickerInput("Vis4_Line_Point_Color",h5(strong(HTML("Point Color&nbsp", as.character(actionLink(inputId = "Vis4_Line_Point_Color_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Gray","Black","White","Red","Blue","Yellow","Green","Purple"),selected="Gray", multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
     style='primary')
    ),
    style='primary'),
  bsCollapsePanel("Legend",
    h5(strong(HTML("Toggle Legend&nbsp", as.character(actionLink(inputId = "Vis4_Line_HideLegend_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),
    switchInput("Vis4_Line_HideLegend", onLabel="Display",offLabel="Hide", value=TRUE),
    radioGroupButtons("Vis4_Line_LegendOrient",status='primary',h5(strong(HTML("Legend Orientation&nbsp", as.character(actionLink(inputId = "Vis4_Line_Orientation_Tip", HTML('<i class="fas fa-info-circle"></i>')))))),choices=c("Vertical"="v","Horizontal"="h"),selected="v"),
    sliderInput("Vis4_Line_LegendX", h5(strong(HTML("Legend X Position:&nbsp", as.character(actionLink(inputId = "Vis4_Line_LegendX_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=0,step=0.1),
    sliderInput("Vis4_Line_LegendY", h5(strong(HTML("Legend Y Position:&nbsp", as.character(actionLink(inputId = "Vis4_Line_LegendY_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), min=-1,max=2,value=-0.6,step=0.1),
    style='primary'),
  
  bsCollapsePanel("Labels",
    textInput("Vis4_LineTitle", h5(strong(HTML("Title&nbsp", as.character(actionLink(inputId = "Vis4_LineTitle_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Visualization 4"),
    textInput("Vis4_LineXlab", h5(strong(HTML("X Label&nbsp", as.character(actionLink(inputId = "Vis4_LineXlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value="Year"),
    textInput("Vis4_LineYlab", h5(strong(HTML("Y Label&nbsp", as.character(actionLink(inputId = "Vis4_LineYlab_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), value=""),
  style='primary')
)
),

style='primary'))),


  style="primary")
),
                   
),


    
  ),
              
mainPanel(            
      navbarPage(id="CreelCatNavBar","CreelCat",
         
#### About CreelCat ####
tabPanel(
  "About CreelCat",
fluidPage(
tabsetPanel(type="tabs",
            id="AboutCC",


#### Project Info #####
tabPanel("Tools and Features",
   column(12,
      column(3,
        icon(""), # Need to have icon placed outside of a header for icons to show up, hiding a blank icon here
             img(src="CCLogo.png",height="100%",width="100%",style="vertical-align:middle"),
      ),
      column(9,
       column(12,
              align="center",
              h2(strong("The U.S. Inland Creel and Angler Survey Catalog (CreelCat):")),
              h3(strong("A database and interactive tool for inland fisheries management and research")),
              ),
       column(12,
              align="left",
      h3("CreelCat is a collection of creel and angler survey data from over 40 states as well as Washington DC and Puerto Rico."),
      br(),
      h4("Inland recreational fishing, defined as primarily leisure-driven fishing in freshwaters, is a popular past-time in the USA.
         State natural resource agencies endeavor to provide high-quality and sustainable fishing opportunities for anglers. Managers
         often use creel and other angler-survey data to inform state- and waterbody-level management efforts. CreelCat aims to provide
         access to data and tools necessary to both bridge the gap between state and regional/national efforts, while
         providing managers and decision makers a variety of tools to aid the conservation and management of recreational fisheries.
         ")
      ),
      ),

column(12,
  br(),
  column(4,align="center",
    h3(strong("Data Availability")),
    img(src="Icon_DataAvail.jpg",height="100%",width="100%",style="vertical-align:middle"),
    h4("View data availability for the entire dataset or a custom selection"),
    actionButton("DataAvail_Feature","Feature", class = "btn-primary btn-md",width='45%'),
    actionButton("DataAvail_UG","User Guide", class = "btn-primary btn-md",width='45%'),
         ),
  column(4,align="center",
    h3(strong("View and Filter Data")),
    img(src="ViewFilt.jpg",height="100%",width="100%",style="vertical-align:middle"),
    h4("View and filter creel and angler survey data"),
    actionButton("ViewFilt_Feature","Feature", class = "btn-primary btn-md",width='45%'),
    actionButton("ViewFilt_UG","User Guide", class = "btn-primary btn-md",width='45%'),
         ),
  column(4,align="center",
    h3(strong("Visualize Data")),
    img(src="LinkedSelectionIcon.jpg",height="100%",width="100%",style="vertical-align:middle"),
    h4("Create visualizations to display and interact with CreelCat data"),
    actionButton("Visualize_Feature","Feature", class = "btn-primary btn-md",width='45%'),
    actionButton("Visualize_UG","User Guide", class = "btn-primary btn-md",width='45%'),
         ),
),
column(12, br(),
  column(4,align="center",
    h3(strong("Summarize Data")),
    img(src="Summarize.jpg",height="100%",width="100%",style="vertical-align:middle"),
    h4("Calculate basic summary statistics for user-selected datasets"),
    actionButton("Summarize_Feature","Feature", class = "btn-primary btn-md",width='45%'),
    actionButton("Summarize_UG","User Guide", class = "btn-primary btn-md",width='45%'),
         ),
  column(4,align="center",
    h3(strong("Mapping")),
    img(src="Map.jpg",height="100%",width="100%",style="vertical-align:middle"),
    h4("Create custom maps based on user-selected survey data"),
    actionButton("Mapping_Feature","Feature", class = "btn-primary btn-md",width='45%'),
    actionButton("Mapping_UG","User Guide", class = "btn-primary btn-md",width='45%'),
         ),
  column(4,align="center",
    h3(strong("Scatter Plots")),
    img(src="Scatter.jpg",height="100%",width="100%",style="vertical-align:middle"),
    h4("Create custom scatter plots"),
    actionButton("Scatter_Feature","Feature", class = "btn-primary btn-md",width='45%'),
    actionButton("Scatter_UG","User Guide", class = "btn-primary btn-md",width='45%'),
         ),

),
column(12, br(),
  column(4,align="center",
    h3(strong("Time Series Plots")),
    img(src="LinePlot.jpg",height="100%",width="100%",style="vertical-align:middle"),
    h4("Create line plots to display survey data over time"),
    actionButton("LinePlot_Feature","Feature", class = "btn-primary btn-md",width='45%'),
    actionButton("LinePlot_UG","User Guide", class = "btn-primary btn-md",width='45%'),
         ),
  column(4,align="center",
  h3(strong("Bar Charts")),
  img(src="BarChart.jpg",height="100%",width="100%",style="vertical-align:middle"),
  h4("Create custom bar charts"),
  actionButton("Bar_Feature","Feature", class = "btn-primary btn-md",width='45%'),
  actionButton("Bar_UG","User Guide", class = "btn-primary btn-md",width='45%'),
         ),
  column(4,align="center",
  h3(strong("Pie Charts")),
  img(src="PieChart.jpg",height="100%",width="100%",style="vertical-align:middle"),
  h4("Create custom pie charts"),
  actionButton("Pie_Feature","Feature", class = "btn-primary btn-md",width='45%'),
  actionButton("Pie_UG","User Guide", class = "btn-primary btn-md",width='45%'),
         ),
),
column(12, br(),
  column(4,align="center",
  h3(strong("Submit Data")),
  img(src="CCLogo.png",height="100%",width="100%",style="vertical-align:middle"),
  h4("Create custom pie charts"),
  actionButton("DataSubmit_Feature","Feature", class = "btn-primary btn-md",width='45%'),
  actionButton("DataSubmit_UG","User Guide", class = "btn-primary btn-md",width='45%'),

),
),
),
),

#### Projects and Publications #####
tabPanel("Publications",
 column(12,
  column(7,
    tags$h3(
      tags$a(href="https://afspubs.onlinelibrary.wiley.com/doi/abs/10.1002/fsh.10671?casa_token=2-Ux8SEshwIAAAAA:0PQ8zp4bf_2-0FcOevoW1tr4_MNhp6GyOyMniJPIwVNsL0paOZbTU-Y-_9AqNUtJu9zSZ9PxZoqAUA",
             "The US inland creel and angler survey catalog (CreelCat): Development, applications, and opportunities"),
      ),
    h4("Lynch et al. 2021, Fisheries| Vol. 46 No. 11"),
    h4("Inland recreational fishing, defined as primarily leisure-driven fishing in freshwaters, 
       is a popular pastime in the USA. State natural resource agencies endeavor to provide high-quality 
       and sustainable fishing opportunities for anglers. Managers often use creel and other angler 
       survey data to inform state- and waterbody-level management efforts. Despite the broad 
       implementation of angler surveys and their importance to fisheries management at state scales, 
       regional and national coordination among these activities is minimal, limiting data applicability 
       for larger-scale management practices and research. Here, we introduce the U.S. Inland Creel and 
       Angler Survey Catalog (CreelCat), a first-of-its-kind, publicly available national database of 
       angler survey data that establishes a baseline of national inland recreational fishing metrics. 
       We highlight research and management applications to help support sustainable inland recreational 
       fishing practices, consider cautions, and make recommendations for implementation.")
     ),
  column(5,
    img(src="FisheriesImage.jpg",width="50%",style="vertical-align:middle"))
),
column(12,
       ),
),
tabPanel("Research Highlights",
  column(12,
    h3("Coming Soon!")
  )
  
),
tabPanel("Disclaimers",
  column(12,
    h4(strong("Data: "), "The data you have secured from the U.S. Geological Survey (USGS) database identified as CreelCat have not received USGS approval 
               and as such are provisional and subject to revision. The data are released on the condition that neither the USGS nor the U.S. 
               Government shall be held liable for any damages resulting from its authorized or unauthorized use."),
            h4(strong("Data Processing: "),"Although these data have been processed successfully on a computer system at the U.S. Geological Survey (USGS), 
            no warranty expressed or implied is made regarding the display or utility of the data for other purposes, nor on 
            all computer systems, nor shall the act of distribution constitute any such warranty. The USGS or the U.S. Government 
            shall not be held liable for improper or incorrect use of the data described and/or contained herein."),
            h4(strong("Software: "),"This software has not yet been approved for release by the U.S. Geological Survey (USGS). Although the software has 
            been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further 
            analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the 
            functionality of the software and related material nor shall the fact of release constitute any such warranty. 
            Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held 
            liable for any damages resulting from its authorized or unauthorized use."),
            h4(strong("State Disclaimers"), "In the process of aquiring this data we were instructed by several states to acknowledge that although 
               the data were collected and shared with consideration of accuracy and sound science, limitations to the accuracy and inference scope 
               of the data may exist. Therefore, there are no guarantees regarding the accuracy or utility of the data being provided."),
            # h4(strong("Software: "),"This software has been approved for release by the U.S. Geological Survey (USGS). Although the software has 
            # been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further 
            # analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the 
            # functionality of the software and related material nor shall the fact of release constitute any such warranty. 
            # Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held 
            # liable for any damages resulting from its authorized or unauthorized use."),
  )
  
),

tabPanel("Background and Contact",
 column(12,
    h2(strong("About CreelCat")),
    h3("CreelCat was developed and funded by the ",
       tags$a(href="https://www.usgs.gov/programs/climate-adaptation-science-centers",
             "USGS National Climate Adaptation Science Center"),
      ),
    h3("We would particularly like to thank all of our partner agencies and their staff who have 
       generously shared their data and time to support this project."),
    h3("Data is currently preliminary and should not be used for any official business. Once the data 
       has been approved for release relevant documentation will be provided here."),
    h3("For all inquiries related to CreelCat please contact:")
    ),    
    column(6,align="center",
    h3(strong("Abby Lynch")),
    h4("ajlynch@usgs.gov"),
    br(),
    fluidRow(img(src="AJLynchProfile.jpg",width="75%",style="display: inline-block;")),
    
  ),
  column(6,align="center",
    h3(strong("Nick Sievert")),
    h4("NicholasSievert@gmail.com"),
    br(),
    fluidRow(img(src="Sievert_Profile.jpg",width="75%",style="display: inline-block;")),
  ),
  
)

)
)
),

#### User Guide ####
tabPanel(
  "User Guide",
fluidPage(
  tabsetPanel(type="tabs",
    id="UserGuideTabs",
    ##### Survey Data ####
    ##### Data Availability ####
    tabPanel("User Guide Home", value="UG_Home",
            column(12,
                br(),
                column(4,
                    actionButton("UG_Home_ViewFilt","View, Filter, and Download", class = "btn-primary btn-md",width="100%"),
                    img(src="ViewFilt.jpg",width="100%",style="display: inline-block;"),
                       
                       ),
                column(4,
                    actionButton("UG_Home_DataAvail","Data Availability Inquiry", class = "btn-primary btn-md",width="100%"),
                    img(src="Icon_DataAvail.jpg",width="100%",style="display: inline-block;"),
                       
                       ),
                column(4,
                    actionButton("UG_Home_Visualization","Data Visualization", class = "btn-primary btn-md",width="100%"),
                    img(src="LinkedSelectionIcon.jpg",width="100%",style="display: inline-block;"),
                       
                       ),
                   
                   ),
            column(12,
                br(),
                column(4,
                    actionButton("UG_Home_Data_Summarization","Data Summarization", class = "btn-primary btn-md",width="100%"),
                    img(src="Summarize.jpg",width="100%",style="display: inline-block;"),
                       ),
                column(4,
                    actionButton("UG_Home_Map","Maps", class = "btn-primary btn-md",width="100%"),
                    img(src="Map.jpg",width="100%",style="display: inline-block;"),
                       ),
                column(4,
                    actionButton("UG_Home_Scatter","Scatter Plots", class = "btn-primary btn-md",width="100%"),
                    img(src="Scatter.jpg",width="100%",style="display: inline-block;"),
                       
                       ),
                   
                   ),
            column(12,
                br(),
                column(4,
                    actionButton("UG_Home_Bar","Bar Charts", class = "btn-primary btn-md",width="100%"),
                    img(src="BarChart.jpg",width="100%",style="display: inline-block;"),
                       
                       ),
                column(4,
                    actionButton("UG_Home_Pie","Pie Charts", class = "btn-primary btn-md",width="100%"),
                    img(src="PieChart.jpg",width="100%",style="display: inline-block;"),
                       
                       ),
                column(4,
                    actionButton("UG_Home_Line","Time Series", class = "btn-primary btn-md",width="100%"),
                    img(src="LinePlot.jpg",width="100%",style="display: inline-block;"),
                       
                       ),
                   
                   ),
            column(12,
                br(),
                column(4,
                    actionButton("UG_Home_DataSubm","Data Submission", class = "btn-primary btn-md",width="100%"),
                    img(src="CCLogo.png",width="100%",style="display: inline-block;"),
                       ),
                column(4,
                       
                       ),
                column(4,
                       
                       ),
                   
                   ),
             
          ),
    tabPanel("Overview",value="ViewFilt_Overview", 
      column(12,
             column(12,
             br()
             ),
             column(3,align="center",
             ),
             column(3, align="center",
                    actionButton("UG_ViewFilt_Overview_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_ViewFilt_Overview_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_ViewFilt_Overview_Next","Next", class = "btn-primary btn-md",width="100%"),
             ),
          column(12,
                 br()
                 ),
         column(12,align="center",
                h1(strong("View, Filter, and Download Creel Survey Data")),
         ),
         column(12,align="left",
                h3("Users can access a variety of features which allow them to view and download the complete dataset or create a custom table 
                   which includes user-selected fields and surveys"),
                img(src="Filter_View_Table.jpg",width="90%",style="display: inline-block;"),
         ),

      ),
    ),
      tabPanel("Select Surveys",value="ViewFilt_SelSurveys",
               column(12,
                      br()
               ),
               column(3,align="center",
                      actionButton("UG_ViewFilt_SelSurveys_Previous","Previous", class = "btn-primary btn-md",width="100%"),
               ),
               column(3,align="center",
                      actionButton("UG_ViewFilt_SelSurveys_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
               ),
               column(3,align="center",
                      actionButton("UG_ViewFilt_SelSurveys_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
               ),
               column(3,align="center",
                      actionButton("UG_ViewFilt_SelSurveys_Next","Next", class = "btn-primary btn-md",width="100%"),
               ),
               column(12,
                      br()
               ),
         column(12, align="center",
                h2(strong("Select Surveys for Inclusion")),
                ),
         column(12,
                h3("Select whether you wish to initially include ",strong("all")," surveys, a subset based on ",strong("filters"),", or a spatial subset based on a ",strong("map")," selection by selecting the 
                appropriate box. Additional filters can be applied at later steps as well. By subsetting the data, choices for fields will be reduced to only those which 
                   are populated, streamlining future steps. Included surveys can be modified at any time by modifying your selections."),
                br(),
         ),
            column(4,
                  column(12,align="center",
                h4(strong("All")),
                ),
                h4("All surveys contained in the CreelCat database are included in your use of the CreelCat App."),
                ),
            column(4,
                  column(12,align="center",
                       h4(strong("Map")),
                  ),
                    h4("Only surveys within the geographic bounds defined by a user-drawn polygon or user selected States/Counties in your use of the CreelCat App (Detailed Instructions Below)."),
                  ),
            column(4,
                  column(12,align="center",
                      h4(strong("Filters")),
                       ),
                       h4("Only surveys within the bounds defined by user-selected filters are included in your use of the CreelCat App (Detailed Instructions Below)."),
                      ),
         column(6,
                br(),
                h2(strong("Map Selected Survey Instructions")),
                h4(strong("Warning: "), "Selection near boundaries can be inconsistent, please verify that selected surveys match the desired extent (selection by state or county can also be accomplished via filters)"),
                h4(strong("Step 1: "), "Choose method for making spatial selections"),
                h4(strong("Options Include: "), "Polygon, State, or County"),
                img(src="Sel_Data_Map.jpg",width="90%",style="display: inline-block;"),
                h3(strong("Polygons: ")),
                h4(strong("Step 2: "), "Click 'Draw' button to begin drawing on map"),
                h4(strong("Step 3: "), "Click on map to create polygon vertices"),
                h4(strong("Step 4: "), "Once desired polygon has been drawn click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="Map_Filter_Polygon.jpg",width="90%",style="display: inline-block;"),
                h3(strong("State: ")),
                h4(strong("Step 2: "), "Click 'Select' button to begin making selections"),
                h4(strong("Step 3: "), "Click on map within state boundaries to make selections (selected states will be highlighted)"),
                h4(strong("Step 4: "), "Once all desired states have been selected click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="StateSelection_MapSel.jpg",width="90%",style="display: inline-block;"),
                h3(strong("County: ")),
                h4(strong("Step 2: "), "Click 'Select' button to begin making selections"),
                h4(strong("Step 3: "), "Click on map within county boundaries to make selections (selected counties will be highlighted)"),
                h4(strong("Step 4: "), "Once all desired counties have been selected click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="CountySelection_MapSel.jpg",width="90%",style="display: inline-block;"),
                ), 
         column(6,
                br(),
                h2(strong("Filter Selected Survey Instructions")),
                h4(strong("Step 1: "), "Select which fields you wish to use to filter the data"),
                h4(strong("Options Include: "), "State, County, Duration, Year, Waterbody Name, Waterbody Area, Waterbody Type"),
                h4(strong("Step 2: "), "Select values for desired filters to apply to the dataset"),
                h4("For ",strong("factor")," fields select all desired choices from picker input"),
                h4("For ",strong("numeric")," fields select desired range from slider input"),
                img(src="FilterDataIcon.jpg",width="90%",style="display: inline-block;"),
                ),

      ),
    
    tabPanel("Select Fields",value="ViewFilt_SelFields",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_ViewFilt_SelFields_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_ViewFilt_SelFields_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_ViewFilt_SelFields_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_ViewFilt_SelFields_Next","Next", class = "btn-primary btn-md",width="100%"),
             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Select Fields for Inclusion")),
             ),
             column(12,
                column(9,
                    h3(strong("Instructions")),
                    h4("Select the fields you wish to include while interacting with the CreelCat App. Changes can be made at any time, but doing so will reset all dependent items (tables, visualizations, etc.)."),
                    h4(strong("Step 1: "),"From sidebar select the fields you wish to include from each of the picker inputs on the sidebar"),
                    h4(strong("Consideration: "), "Processing time increases with additional fields, for the most efficient use of the app select only those fields you are interested in."),
                    h4(strong("Consideration: "), "Field choices are based on those fields which are populated within those surveys selected in the data selection step ('All','Filters', or 'Map'). If desired fields are not present in the pickers that means they are not populated in any of the surveys you selected for inclusion."),
                    h4(strong("Step 2: "), "Once all desired fields have been selected from the pickers on the sidebar click the 'Update Selected Fields' button. This will pass the selected fields to the interface. If you want to change selected fields you can select or unselect any of them by clicking on them. Once changes have been completed you
                        again need to click 'Update Selected Fields' to pass along the modifications to selected fields"),
                    br(),
                ),
                column(3,
                       br(),
                fluidRow(img(src="Paddlefish2.png",width="100%",style="display: inline-block;")),
                       ),
                column(9,
                    h3(strong("Field Category Descriptions")),
                    h4(strong("Default Fields: "),"Required fields which are automatically included. These include 'Survey_ID', 'State', 'Year','Waterbody_Name_Unique', and 'WB_ID'"),
                    h4(strong("Survey Info: "),"Includes fields related to the characteristics of the survey."),
                    h4(strong("Waterbody Info: "),"Includes fields related to the characteristics of the associated waterbody."),
                    h4(strong("Fish Info: "),"Includes fields related to the metrics used to quantify the characteristics of captured fish and associated taxonomic information."),
                    h4(strong("Effort Info: "),"Includes fields related to the angler effort."),
                    h4(strong("Angler Preference Info: "), "Includes fields related to the effort or preference associated with taxa being targetted by anglers"),
                    h4(strong("Demographic Info: "), "Includes fields related to angler demographics"),
                    br(),
                ),
                column(3,
                       br(),
                fluidRow(img(src="LMB_2.png",width="100%",style="display: inline-block;")),
                       ),
                column(12,
                    h3(strong("Field Descriptions")),
                    h4(strong("From picker below: "), "Select either 'All' to view all fields housed within the CreelCat database, or a specific table to view a detailed descriptions of the fields within the database."),
                    br(),
                    pickerInput("ViewFilt_UG_FieldMeta", "Select field catagories:",choices=c("All","Survey Info","Waterbody Info","Fish Info","Effort Info", "Angler Preference Info","Demographic Info"),selected="All",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
             conditionalPanel(condition="input.ViewFilt_UG_FieldMeta=='All'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_All_ViewFilt"),type=2)),
             ),
            conditionalPanel(condition="input.ViewFilt_UG_FieldMeta=='Survey Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Survey_ViewFilt"),type=2)),
             ),
            conditionalPanel(condition="input.ViewFilt_UG_FieldMeta=='Waterbody Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Waterbody_ViewFilt"),type=2)),
             ),
            conditionalPanel(condition="input.ViewFilt_UG_FieldMeta=='Fish Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Fish_ViewFilt"),type=2)),
             ),
            conditionalPanel(condition="input.ViewFilt_UG_FieldMeta=='Effort Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Effort_ViewFilt"),type=2)),
             ),
            conditionalPanel(condition="input.ViewFilt_UG_FieldMeta=='Angler Preference Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Preference_ViewFilt"),type=2)),
             ),
            conditionalPanel(condition="input.ViewFilt_UG_FieldMeta=='Demographic Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Demographic_ViewFilt"),type=2)),
             ),
            br(),
            br(),
            br(),
                    ),
             ),
    ),
    
    
    tabPanel("Data Considerations",value="ViewFilt_DataWarning",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_ViewFilt_DataWarning_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_ViewFilt_DataWarning_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_ViewFilt_DataWarning_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_ViewFilt_DataWarning_Next","Next", class = "btn-primary btn-md",width="100%"),
             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Important Data Considerations")),
             ),
             column(12,
                    h3("The data contained within the CreelCat database originate from surveys are quite varied in nature, because of this care and consideration should be taken when using the data."),
                    br(),
             ),
             column(12,
                column(9,
                     h4(strong("Survey Types: "),"Generally the data contained in CreelCat comes from state natural resource agency conducted creel surveys,
                         however in some cases we have also supplemented this data to include catch cards, mail surveys, phone surveys, angler journal programs, 
                        and other data sources which can be used to evaluate recreational fishing."),
                     h4(strong("Survey Protocols: "),"A wide variety of methods are employed by the surveys contained within CreelCat. These methods vary in both how 
                        informatoin is gathered from anglers as well as how angler counts are conducted in order to generate estimates. Examples of differing protocols 
                        include but are not limited to: Roving, Access, Combined, Aerial Counts, Camera Counts, and others."),
                     h4(strong("Survey Duration: "), "The duration of surveys can vary substantially from lengths of a few days to over a year. The length of the survey 
                               will impact the values contained within the survey data. Care should be exercised if when surveys with differences in duration are used
                               as an estimate (or count) generated from a short survey will likely underestimate values relative to a survey with a longer duration. When 
                               comparisons are made among surveys with varying durations it may be useful to employ rate based metrics such as values per day or per hours of effort"),
                     h4(strong("Survey Timing: "),"When surveys take place can also influence associated values. Surveys capturing data in different seasons (or with other differences 
                     in start or end dates) may influence results. Additionally, factors such as open seasons and other regulations may interact with survey timing to influence the data."),
                     h4(strong("Taxonomic Consistency: "),"How anglers and surveying agencies name, identify, and classify the taxa being caught and targetted can vary between 
                        and even within surveys. Accounting for this variability is important when utilizing this dataset."),
                  column(12,
                        h4(strong("Naming: "), "Different common names are often used for taxa among surveys. Where multiple common names were attributed to the same taxa we 
                           attempted to use the most common, widespread, or interpretable name (ex. 'Cisco' was selected over 'Lake Herring' as the common name for 'Coregonus artedi'). Hybrids 
                           are included in the database and although they often have a variety of common names (ie. Saugeye, Wiper, Tiger Muskie) we chose to name hybrids based on 
                           the common names of the parental species (ie. Walleye-Sauger (Hybrid), White-Striped Bass (Hybrid), Northern Pike-Muskellunge (Hybrid)) for easier interpretability."),
                        h4(strong("Attribution Levels: "), "Taxa were often attributed at different levels including: ",strong("Variants"),"(ie. Steelhead Rainbow Trout/Oncorhynchus mykiss) ",
                           strong("Subspecies "),"(ie. Yellowstone Cutthroat Trout/Oncorhynchus clarkii bouvieri) ",strong("Species "),"(ie. Largemouth Bass/Micropterus salmoides) ",
                           strong("Genus "),"(ie. Crappie/Pomoxis) ",strong("Family "),"(ie. Catfish/Ictaluridae) and ",strong("Non-Taxonomic Groups "),"(ie. Panfish). 
                           We attributed all taxa to higher levels when possible by summing values (where appropriate) of all taxa falling under the higher level classification (ie. Black Crappie and 
                           White Crappie (Species) could be summed to produce values attributable to Crappie (Genus)), however values attributed to a higher taxonomic level can not be attributed to lower 
                           levels (ie. Crappie (Genus) values can not be attributed to White Crappie and Black Crappie (Species) values)."),
                        h4(strong("Unattributed Data: "), "If a user selects a survey and taxa that contain values attributed at a higher taxonomic level they will recieve a warning stating that unattributed 
                           taxa exist and a list of those taxa in a table. For example if a user selects a species level data attribution (ie.'Black Crappie Harvest Estimate') and their data includes surveys 
                           which only have genus level attribution for that taxa (ie. 'Crappie Harvest Estimate), they will recieve a warning that their dataset includes unattributed data (ie. the harvest estimates 
                           attributed to Crappie may or may not be Black Crappie) and they should note that it is possible that for those surveys there is potentially unattributed data for those species (ie. some or 
                           all of the Crappie Harvest may have been Black Crappie but it can not be attributed as such based on the data). It is our recommendation that in cases of unattributed data the user either 
                           works with the data at a higher attribution level (ie. use Genus level data rather than Species level data) or drop surveys containing unattributed data."),
                        h4(strong("Partially Attributed Data: "), "If a user selects a survey and taxa that contain values attributed at both the selected taxonomic level as well as a higher taxonomic level 
                           they will recieve a warning that their dataset includes partially attributed taxa. This occurs when a survey attributes taxa to multiple levels simultaneously. For example a survey may attribute 
                           catch estimates to both Largemouth Bass (Species) and Black Bass (Genus). If the user selects Largemouth Bass as a taxonomic unit they will get values that may be a partial estimate (ie. 
                           some or all of the values attributed to Black Bass may also be Largemouth Bass). In these cases, similarly to situations with unattributed data, we recommend either switching to the higher 
                           taxonomic level or dropping the surveys that contain partially attributed data."),
                        h4(strong("Non-Taxonomic Attribution: "), "In some cases rather than associating data with monophyletic taxonomic units data is instead attributed to groups of species which are not contained within 
                           a single, monophyletic group. Examples of these groups include things like Panfish (which include species from a number of different families) or Trout (which predominately include inland 
                           Salmonid species while excluding many of the species that spend time in marine environments which are considered Salmon). Because these groups are not monophyletic 
                           values attributed to these groups can not be attributed to other taxa and often result in the presence of 'Unattributed Data' or Partially Attributed Data'. Additionally, the component species of 
                           these groups can differ from survey to survey. In order to accomodate this variability we defined these non-taxonomic groups at the broadest level observed within the dataset (ie. in Florida both Oscar and
                            Mayan Cichlids are classified as Panfish so our definition includes them as well."),
                  ),
                
                     h4(strong("Estimation/Expansion Methods: "),"A wide variety of statistical methods were used to generate estimates from survey data. These methods are often specific to the 
                        survey protocols. Differences in these methods may influence the values contained within the CreelCat database."),
                     h4(strong("Estimates vs Raw Data: "),"Wherever posssible we tried to include data in the form of estimates or expansions (Values calculated by combining interview and angler count data to generate overall estimates), 
                        rather than raw interview data which does not expand beyond the information collected from the anglers. In some cases only raw data was available (surveys did not employ angler counts or did not 
                        use the values generated via angler counts to statistically generate overall estimates), and in those cases we included raw data within our database. Raw data is likely not useful for comparisons with estimated data 
                        however it may be useful in looking at trends in specific waterbodies over time."),
                     h4(strong("Standardization: "),"Wherever possible we attempted to standardize the data for comparability. This included modifying units in some cases (we typically adopted the most commonly used units such as 
                        inches for length, acres for area, etc.), using consistent naming (taxonomic names, field names, etc.), and creating a paired data and geospatial structure that allowed survey data to be linked geospatially. Because there are 
                        differences in survey methodology and sometimes in protocol at times certain metrics were unable to be combined through standardization. For example angler effort is typically quantified based on the 
                        effort hours, however in some cases effort is quantified based on other metrics such as number of trips, anglers, or days. In these cases we either included an additional field to capture the data which couldn't be 
                        attributed to the existing field via standardization or employed simple calculations to make a conversion (ie. a survey provides angler counts and average effort hours we could calculate effort hours by multiplying 
                        the angler count by average effort hours). One particular field where we employed standardization to quantify a metric is in the quantification of percentage estimate for angler preference. Because effort and preference metrics 
                        varied among surveys in some cases this metric is based on percent of hours anglers spent targetting the specified taxa while in other cases this was based on the percentage of anglers. Additionally, with the angler preference data 
                        differences in protocols results in anglers attributing effort to a single or multiple species."),
                     h4(strong("Non-Random Datasets: "),"The locations selected for creel surveys and the timing of these surveys are often non-random and they may be conducted for specific purposes. Care should be taken when employing analyses to 
                        account for the non-random nature of this dataset."),
                     h4(strong("Unaccounted for factors: "),"A variety of factors likely are highly influential are not included in our dataset. Regulations such as open/closed seasons,
                               harvest limits, length limits, etc. may play a large role in shaping angling dynamics on waterbodies. Additionally, factors such as public and private waterbody access, infrastructure, 
                               fish population levels, size classes, species composition, waterbody characteristics, social/cultural/demographic factors and many others likely exert substantial influence on the data contained within 
                               the CreelCat database."),
                ),
                column(3,
                br(),
                fluidRow(img(src="Rosenberg5.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="Double.jpg",width="100%",style="display: inline-block;")),
                br(), 
                fluidRow(img(src="Sisters.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="ShoreLunch.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="JG.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="SMB.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="dnr0326.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="Sunset.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="FogAngling.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="Salmon.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="SMB_Hans.jpg",width="100%",style="display: inline-block;")),
              ),
           ),
    ),
    tabPanel("Interact and Download",value="ViewFilt_Interact",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_ViewFilt_Interact_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_ViewFilt_Interact_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_ViewFilt_Interact_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Data Interaction: Search, Filter, and Download")),
             ),
             column(12,
                    h3(strong("Filter Data")),
                    column(9,
                    h4(strong("Numeric Fields: "),"Range of values can be filtered by dragging the buttons on the slider to indivate minimum and maximum values or minimum and maximum values can be typed directly the box separated by '...' (ie. '1990...2020')"),
                    ),
                    column(3,
                      fluidRow(img(src="Filter_Slider.png",width="100%",style="display: inline-block;")),
                           ),
                    column(9,
                    h4(strong("Factor Fields: "),"Desired selections can be chosen by clicking in the dropdown, dropdown can be searched by typing a string, pressing enter will select highlighted factor"),
                    ),
                    column(3,
                      fluidRow(img(src="Filter_Factor.png",width="100%",style="display: inline-block;")),
                    ),
                    column(9,
                    h4(strong("Character Fields: "),"Typing a string in the field box will filter the dataset based on columns which have a match somewhere in the string"),
                    ),
                    column(3,
                      fluidRow(img(src="Filter_String.png",width="100%",style="display: inline-block;")),
                    ),
                    column(9,
                    h4(strong("Modifying Filters: "),"By clicking the small 'x' in a filtered column the filter can be cleared."),
                    ),
                    column(3,),
             ),
             column(12,
                    br(),
                    h3(strong("Sort Data")),
                    column(9,
                    h4("Click the arrows on the right side of a given field heading to sort the rows. First click sorts ascending, second click sorts descending."),
                    ),
                    column(3,
                      fluidRow(img(src="Sort.png",width="100%",style="display: inline-block;")),
                    ),
             ),
             column(12,
                    br(),
                    h3(strong("Search Data")),
                    column(9,
                    h4("Type a string in the search box to filter rows to only those which contain a match"),
                    ),
                    column(3,
                      fluidRow(img(src="Search.png",width="100%",style="display: inline-block;")),
                           ),
             ),
             column(12,
                    br(),
                    h3(strong("Select Data")),
                    column(9,
                    h4(strong("In-Table: ")),
                       h4("Press and hold the ",strong("'Ctrl' "), "button on keyboard to select multiple rows directly from table individually."),
                       h4("Press and hold the ",strong("'Shift' "), "button on keyboard to select a range of rows directly from table by clicking the first and last desired row."),
                    ),
                    column(3,
                      fluidRow(img(src="TableSelect.png",width="100%",style="display: inline-block;")),
                           ),
                    column(9,
                    h4(strong("Buttons: ")),
                      column(12, align="center",
                      fluidRow(img(src="ButtonSelection.png",width="60%",style="display: inline-block;")),
                      ),
                      column(12,alight="left",
                       h4(strong("Select All Filtered: "),"Selects all rows remaining rows in table after filters have been applied."), 
                       h4(strong("Deselect All Filtered: "),"Deselects all rows remaining in table after filters have been applied."), 
                       h4(strong("Select All: "),"Selects all rows from the initial table, even rows that do not appear due to filters."), 
                       h4(strong("Deselect All: "),"Deselects all rows from the table, even those rows which do not appear due to filters."),
                      ),
                    ),
                      column(3,),
                      ),
             column(12,
                    br(),
                    h3(strong("Export Data")),
                    h4("Data can be exported from the CreelCat interface in a number of ways including:"),
                    column(9,
                    h4(strong("Custom Table Buttons")),
                     column(12,align="center",
                      fluidRow(img(src="ButtonExport.png",width="50%",style="display: inline-block;")),
                     ),
                     column(12,align="left",
                           h4(strong("Copy: "), "Copies data from selected rows to clipboard."),
                           h4(strong("CSV: "), "Saves selected rows to a '.CSV' file."),
                           h4(strong("Excel: "), "Saves selected rows to an excel spreadsheet '.xlsx file'"),
                           h4(strong("PDF: "), "Saves selected rows to a PDF file '.PDF'"),
                           h4(strong("Print: "), 'Prints selected rows to a printer of your choice.'),
                     ),
                    ),
                     column(3,),
                    ),
             column(12,
                    br(),
                    h4(strong("Sidebar Buttons")),
                      column(9,align="center",
                      fluidRow(img(src="SidebarExport.png",width="50%",style="display: inline-block;")),
                      ),
                      column(3,),
                      column(9,align="left",
                           h4(strong("Download Full Dataset as CSV Files: "), "Downloads the complete CreelCat dataset as a series of .CSV files."),
                           h4(strong("Open Full Dataset in Google Sheets to Copy or Download: "), "Opens a link to a protected google sheets file which can then be download or copied to your own drive account for use."),
                          ),
                      column(3,),
             ), column(12,
                column(7,
                    h3(strong("Consider Data Warnings: ")), 
                    h4("The data contained in CreelCat is not homogenous and therefore care should be taken to consider differences among surveys when making 
                       any types of comparisons. Some relevant warnings about discrepancies in input data are displayed in the 'Data Warnings' panel located above the table. 
                       This panel can be clicked to expand/minimize. Although we have listed several of the major potential discrepancies care should be taken by the user to ascertain 
                       whether input data being used is valid for any comparisons being made."),
                    h4(strong("Warnings include:")),
                    column(12,
                           h4(strong("Duration Range: "), "Number of days surveys are representative of."),
                           h4(strong("Start Dates: "), "Range of months surveys began."),
                           h4(strong("Conclusion Dates: "), "Range of months surveys concluded."),
                           h4(strong("Survey Types: "), "Which types of surveys are included in the input data."),
                           h4(strong("Survey Protocols: "), "Which survey protocols were utilized for the surveys included in input data"),
                           h4(strong("Focal Species: "), "What species were targetted in the input surveys."),
                           h4(strong("Waterbody Types: "), "Which waterbody types were included in the input data."),
                           h4(strong("Unattributed Taxa: "), "See which surveys contained unattributed taxa. Unattributed taxa records are surveys which contain taxa which were attributed 
                           at a higher taxonomic level than the user is viewing which therefore can not be attibuted. For example a survey may have quantified harvest at the 
                           genus level (ie. Crappie) while the user may wish to view data at the species level (ie. Black or White Crappie). In this case the values associated 
                           with genus level observations can not be attributed to species. Because of this values can't be attributed for the desired taxa for those surveys. In these 
                           cases we recommend either removing those surveys from consideration or making evaluations at a higher taxonomic level (ie. 'Crappie' instead of 'White Crappie' and/or 
                           'Black Crappie'. Surveys containing unattributed taxa records can be viewed in the table below."),
                           h4(strong("Partially Attributed Taxa: "), "See which surveys contained partially attributed taxa. Partially attributed taxa records are surveys which contain taxa which were attributed 
                           at a multiple taxonomic levels within a single survey (ie. 'Crappie' (Genus) and 'Black Crappie'(Species)). In these cases selecting the higher taxonomic level 
                              (ie. 'Crappie' (Genus)), will resolve the issue as the lower taxonomic level records (ie. 'Black Crappie' (Species)) will be added to the higher taxonomic records, 
                              however use of the lower taxonomic level will result in the potential unattribution of records (ie. 'Crappie' records which may or may not have been 'Black Crappie' will not 
                              be attributed) causing potential underestimation of selected metrics for those taxa. To resolve this issue we recommend removing surveys containing partially attributed taxa or 
                              selecting the higher taxonomic level (ie. Genus instead of Species). Surveys containing partially attributed taxa can be viewed in the table below."),
                         ),
                    ),
                column(5,
                       br(),
                       img(src="DataWarning.png",width="90%",style="display: inline-block;"),
                       ),
             ),
    ),
    tabPanel("Overview",value="Data_Avail_Overview", 
             column(12,
                    column(12,
                           br()
                    ),
                    column(3,align="center",
                    ),
                    column(3, align="center",
                           actionButton("UG_Data_Avail_Overview_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
                    ),
                    column(3,align="center",
                           actionButton("UG_Data_Avail_Overview_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
                    ),
                    column(3,align="center",
                           actionButton("UG_Data_Avail_Overview_Next","Next", class = "btn-primary btn-md",width="100%"),
                    ),
                    column(12,
                           br()
                    ),
                    column(12,align="center",
                           h1(strong("Data Availability Inquiry")),
                    ),
                    column(12,align="left",
                           h2("Users can perform a variety of inquiries to determine data availability including: "),
                           h3(strong("Survey Counts")),
                           column(12,
                            h4("All Surveys"),
                            h4("By Survey Characteristics"),
                            h4("By Species"),
                            h4("By Populated Fields")
                           ),
                           br(),
                          ),
                    column(12,align="center",        
                      fluidRow(img(src="Icon_DataAvail.jpg",width="75%",style="display: inline-block;")),
                            
                    ),
                    
             ),
    ),
    tabPanel("Select Surveys",value="Data_Avail_SelSurveys",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_Data_Avail_SelSurveys_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Avail_SelSurveys_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Avail_SelSurveys_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Avail_SelSurveys_Next","Next", class = "btn-primary btn-md",width="100%"),
             ),
             column(12,
                    br()
             ),
         column(12, align="center",
                h2(strong("Select Surveys for Inclusion")),
                ),
         column(12,
                h3("Select whether you wish to initially include ",strong("all")," surveys, a subset based on ",strong("filters"),", or a spatial subset based on a ",strong("map")," selection by selecting the 
                appropriate box. Additional filters can be applied at later steps as well. By subsetting the data, choices for fields will be reduced to only those which 
                   are populated, streamlining future steps. Included surveys can be modified at any time by modifying your selections."),
                br(),
         ),
            column(4,
                  column(12,align="center",
                h4(strong("All")),
                ),
                h4("All surveys contained in the CreelCat database are included in your use of the CreelCat App."),
                ),
            column(4,
                  column(12,align="center",
                       h4(strong("Map")),
                  ),
                    h4("Only surveys within the geographic bounds defined by a user-drawn polygon or user selected States/Counties in your use of the CreelCat App (Detailed Instructions Below)."),
                  ),
            column(4,
                  column(12,align="center",
                      h4(strong("Filters")),
                       ),
                       h4("Only surveys within the bounds defined by user-selected filters are included in your use of the CreelCat App (Detailed Instructions Below)."),
                      ),
         column(6,
                br(),
                h2(strong("Map Selected Survey Instructions")),
                h4(strong("Warning: "), "Selection near boundaries can be inconsistent, please verify that selected surveys match the desired extent (selection by state or county can also be accomplished via filters)"),
                h4(strong("Step 1: "), "Choose method for making spatial selections"),
                h4(strong("Options Include: "), "Polygon, State, or County"),
                img(src="Sel_Data_Map.jpg",width="90%",style="display: inline-block;"),
                h3(strong("Polygons: ")),
                h4(strong("Step 2: "), "Click 'Draw' button to begin drawing on map"),
                h4(strong("Step 3: "), "Click on map to create polygon vertices"),
                h4(strong("Step 4: "), "Once desired polygon has been drawn click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="Map_Filter_Polygon.jpg",width="90%",style="display: inline-block;"),
                h3(strong("State: ")),
                h4(strong("Step 2: "), "Click 'Select' button to begin making selections"),
                h4(strong("Step 3: "), "Click on map within state boundaries to make selections (selected states will be highlighted)"),
                h4(strong("Step 4: "), "Once all desired states have been selected click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="StateSelection_MapSel.jpg",width="90%",style="display: inline-block;"),
                h3(strong("County: ")),
                h4(strong("Step 2: "), "Click 'Select' button to begin making selections"),
                h4(strong("Step 3: "), "Click on map within county boundaries to make selections (selected counties will be highlighted)"),
                h4(strong("Step 4: "), "Once all desired counties have been selected click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="CountySelection_MapSel.jpg",width="90%",style="display: inline-block;"),
                ), 
         column(6,
                br(),
                h2(strong("Filter Selected Survey Instructions")),
                h4(strong("Step 1: "), "Select which fields you wish to use to filter the data"),
                h4(strong("Options Include: "), "State, County, Duration, Year, Waterbody Name, Waterbody Area, Waterbody Type"),
                h4(strong("Step 2: "), "Select values for desired filters to apply to the dataset"),
                h4("For ",strong("factor")," fields select all desired choices from picker input"),
                h4("For ",strong("numeric")," fields select desired range from slider input"),
                img(src="FilterDataIcon.jpg",width="90%",style="display: inline-block;"),
                ),

      ),
    tabPanel("Data Considerations",value="Data_Avail_DataWarning",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_Data_Avail_DataWarning_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Avail_DataWarning_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Avail_DataWarning_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Avail_DataWarning_Next","Next", class = "btn-primary btn-md",width="100%"),
             ),
             column(12,
                    br()
             ),
             
             column(12, align="center",
                    h2(strong("Important Data Considerations")),
             ),
             column(12,
                    h3("The data contained within the CreelCat database originate from surveys are quite varied in nature, because of this care and consideration should be taken when using the data."),
                    br(),
             ),
             column(12,
                column(9,
                     h4(strong("Survey Types: "),"Generally the data contained in CreelCat comes from state natural resource agency conducted creel surveys,
                         however in some cases we have also supplemented this data to include catch cards, mail surveys, phone surveys, angler journal programs, 
                        and other data sources which can be used to evaluate recreational fishing."),
                     h4(strong("Survey Protocols: "),"A wide variety of methods are employed by the surveys contained within CreelCat. These methods vary in both how 
                        informatoin is gathered from anglers as well as how angler counts are conducted in order to generate estimates. Examples of differing protocols 
                        include but are not limited to: Roving, Access, Combined, Aerial Counts, Camera Counts, and others."),
                     h4(strong("Survey Duration: "), "The duration of surveys can vary substantially from lengths of a few days to over a year. The length of the survey 
                               will impact the values contained within the survey data. Care should be exercised if when surveys with differences in duration are used
                               as an estimate (or count) generated from a short survey will likely underestimate values relative to a survey with a longer duration. When 
                               comparisons are made among surveys with varying durations it may be useful to employ rate based metrics such as values per day or per hours of effort"),
                     h4(strong("Survey Timing: "),"When surveys take place can also influence associated values. Surveys capturing data in different seasons (or with other differences 
                     in start or end dates) may influence results. Additionally, factors such as open seasons and other regulations may interact with survey timing to influence the data."),
                     h4(strong("Taxonomic Consistency: "),"How anglers and surveying agencies name, identify, and classify the taxa being caught and targetted can vary between 
                        and even within surveys. Accounting for this variability is important when utilizing this dataset."),
                  column(12,
                        h4(strong("Naming: "), "Different common names are often used for taxa among surveys. Where multiple common names were attributed to the same taxa we 
                           attempted to use the most common, widespread, or interpretable name (ex. 'Cisco' was selected over 'Lake Herring' as the common name for 'Coregonus artedi'). Hybrids 
                           are included in the database and although they often have a variety of common names (ie. Saugeye, Wiper, Tiger Muskie) we chose to name hybrids based on 
                           the common names of the parental species (ie. Walleye-Sauger (Hybrid), White-Striped Bass (Hybrid), Northern Pike-Muskellunge (Hybrid)) for easier interpretability."),
                        h4(strong("Attribution Levels: "), "Taxa were often attributed at different levels including: ",strong("Variants"),"(ie. Steelhead Rainbow Trout/Oncorhynchus mykiss) ",
                           strong("Subspecies "),"(ie. Yellowstone Cutthroat Trout/Oncorhynchus clarkii bouvieri) ",strong("Species "),"(ie. Largemouth Bass/Micropterus salmoides) ",
                           strong("Genus "),"(ie. Crappie/Pomoxis) ",strong("Family "),"(ie. Catfish/Ictaluridae) and ",strong("Non-Taxonomic Groups "),"(ie. Panfish). 
                           We attributed all taxa to higher levels when possible by summing values (where appropriate) of all taxa falling under the higher level classification (ie. Black Crappie and 
                           White Crappie (Species) could be summed to produce values attributable to Crappie (Genus)), however values attributed to a higher taxonomic level can not be attributed to lower 
                           levels (ie. Crappie (Genus) values can not be attributed to White Crappie and Black Crappie (Species) values)."),
                        h4(strong("Unattributed Data: "), "If a user selects a survey and taxa that contain values attributed at a higher taxonomic level they will recieve a warning stating that unattributed 
                           taxa exist and a list of those taxa in a table. For example if a user selects a species level data attribution (ie.'Black Crappie Harvest Estimate') and their data includes surveys 
                           which only have genus level attribution for that taxa (ie. 'Crappie Harvest Estimate), they will recieve a warning that their dataset includes unattributed data (ie. the harvest estimates 
                           attributed to Crappie may or may not be Black Crappie) and they should note that it is possible that for those surveys there is potentially unattributed data for those species (ie. some or 
                           all of the Crappie Harvest may have been Black Crappie but it can not be attributed as such based on the data). It is our recommendation that in cases of unattributed data the user either 
                           works with the data at a higher attribution level (ie. use Genus level data rather than Species level data) or drop surveys containing unattributed data."),
                        h4(strong("Partially Attributed Data: "), "If a user selects a survey and taxa that contain values attributed at both the selected taxonomic level as well as a higher taxonomic level 
                           they will recieve a warning that their dataset includes partially attributed taxa. This occurs when a survey attributes taxa to multiple levels simultaneously. For example a survey may attribute 
                           catch estimates to both Largemouth Bass (Species) and Black Bass (Genus). If the user selects Largemouth Bass as a taxonomic unit they will get values that may be a partial estimate (ie. 
                           some or all of the values attributed to Black Bass may also be Largemouth Bass). In these cases, similarly to situations with unattributed data, we recommend either switching to the higher 
                           taxonomic level or dropping the surveys that contain partially attributed data."),
                        h4(strong("Non-Taxonomic Attribution: "), "In some cases rather than associating data with monophyletic taxonomic units data is instead attributed to groups of species which are not contained within 
                           a single, monophyletic group. Examples of these groups include things like Panfish (which include species from a number of different families) or Trout (which predominately include inland 
                           Salmonid species while excluding many of the species that spend time in marine environments which are considered Salmon). Because these groups are not monophyletic 
                           values attributed to these groups can not be attributed to other taxa and often result in the presence of 'Unattributed Data' or Partially Attributed Data'. Additionally, the component species of 
                           these groups can differ from survey to survey. In order to accomodate this variability we defined these non-taxonomic groups at the broadest level observed within the dataset (ie. in Florida both Oscar and
                            Mayan Cichlids are classified as Panfish so our definition includes them as well."),
                     
                  ),
                
                     h4(strong("Estimation/Expansion Methods: "),"A wide variety of statistical methods were used to generate estimates from survey data. These methods are often specific to the 
                        survey protocols. Differences in these methods may influence the values contained within the CreelCat database."),
                     h4(strong("Estimates vs Raw Data: "),"Wherever posssible we tried to include data in the form of estimates or expansions (Values calculated by combining interview and angler count data to generate overall estimates), 
                        rather than raw interview data which does not expand beyond the information collected from the anglers. In some cases only raw data was available (surveys did not employ angler counts or did not 
                        use the values generated via angler counts to statistically generate overall estimates), and in those cases we included raw data within our database. Raw data is likely not useful for comparisons with estimated data 
                        however it may be useful in looking at trends in specific waterbodies over time."),
                     h4(strong("Standardization: "),"Wherever possible we attempted to standardize the data for comparability. This included modifying units in some cases (we typically adopted the most commonly used units such as 
                        inches for length, acres for area, etc.), using consistent naming (taxonomic names, field names, etc.), and creating a paired data and geospatial structure that allowed survey data to be linked geospatially. Because there are 
                        differences in survey methodology and sometimes in protocol at times certain metrics were unable to be combined through standardization. For example angler effort is typically quantified based on the 
                        effort hours, however in some cases effort is quantified based on other metrics such as number of trips, anglers, or days. In these cases we either included an additional field to capture the data which couldn't be 
                        attributed to the existing field via standardization or employed simple calculations to make a conversion (ie. a survey provides angler counts and average effort hours we could calculate effort hours by multiplying 
                        the angler count by average effort hours). One particular field where we employed standardization to quantify a metric is in the quantification of percentage estimate for angler preference. Because effort and preference metrics 
                        varied among surveys in some cases this metric is based on percent of hours anglers spent targetting the specified taxa while in other cases this was based on the percentage of anglers. Additionally, with the angler preference data 
                        differences in protocols results in anglers attributing effort to a single or multiple species."),
                     h4(strong("Non-Random Datasets: "),"The locations selected for creel surveys and the timing of these surveys are often non-random and they may be conducted for specific purposes. Care should be taken when employing analyses to 
                        account for the non-random nature of this dataset."),
                     h4(strong("Unaccounted for factors: "),"A variety of factors likely are highly influential are not included in our dataset. Regulations such as open/closed seasons,
                               harvest limits, length limits, etc. may play a large role in shaping angling dynamics on waterbodies. Additionally, factors such as public and private waterbody access, infrastructure, 
                               fish population levels, size classes, species composition, waterbody characteristics, social/cultural/demographic factors and many others likely exert substantial influence on the data contained within 
                               the CreelCat database."),
                ),
                column(3,
                br(),
                fluidRow(img(src="Rosenberg5.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="Double.jpg",width="100%",style="display: inline-block;")),
                br(), 
                fluidRow(img(src="Sisters.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="ShoreLunch.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="JG.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="SMB.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="dnr0326.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="Sunset.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="FogAngling.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="Salmon.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="SMB_Hans.jpg",width="100%",style="display: inline-block;")),
              ),
           ),
    ),
    tabPanel("Performing an Inquiry",value="Data_Avail_Inquiry",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_Data_Avail_Inquiry_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Avail_Inquiry_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Avail_Inquiry_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Performing an Inquiry")),
             ),
             column(12, align="left",
                    h3(strong("Select Type of Inquiry")),
                  column(12,
                    h4(strong("Survey Count: "), "Number of surveys by state or overall."),
                    h4(strong("Available Fields: "), "Number of surveys which are populated for each field by state or overall."),
                    h4(strong("Survey Characteristics: "), "Count of surveys and survey characteristics broken down by user identified survey characteristics by state or overall."),
                    h4(strong("Species: "), "Number of surveys which include a record for a given species by state or overall."),
                    br(),
                  ),
                    h3(strong("Viewing Results")),
                    h4("All inquiry types can be viewed as a table, all inquiry types except 'Survey Characteristics' can also be viewed as a map which displayes counts by state."),
                    h3(strong("Data Input")),
                    h4("Default is entire CreelCat dataset. If you apply filters or make a map selection from the 'Select Data' menu from the sidebar 
                          reported results will be limited to the subsetted surveys."),
                    h3(strong("Survey Count")),
                       column(12,
                       h4(strong("Map: "), "Displays a map showing the number of surveys within each state. Click a state to get the value."),
                       h4(strong("Table: "), "Displays a table with survey counts. If 'Yes' is selected from 'Summarize by State' on sidebar counts will be displayed by state, if 'No' counts will be for all surveys."),
                       ),
                column(12, align="center",
                       br(),
                fluidRow(img(src="Icon_SurveyCount.jpg",width="75%",style="display: inline-block;")),
                br(),
                       ),
                h3(strong("Available Fields")),
                       column(12,
                       h4(strong("Map: "), "Displays a map showing the number of surveys within each state. Click a state to get the value."),
                       h4(strong("Table: "), "Displays a table with survey counts. If 'Yes' is selected from 'Summarize by State' on sidebar counts will be displayed by state, if 'No' counts will be for all surveys."),
                       ),

                column(12, align="center",
                       br(),
                fluidRow(img(src="Icon_Avail_FieldMap.jpg",width="75%",style="display: inline-block;")),
                       br(),
                       ),
                       h3(strong("Survey Characteristics")),
                       h4(strong("Table: "), "Displays a table containing counts of the following survey characteristcs. If 'Yes' is selected from 'Summarize by State' on sidebar counts will be displayed by state, if 'No' counts will be for all surveys."),
                       column(12,
                          h5("Earliest Year"),
                          h5("Latest Year"),
                          h5("Mean Duration"),
                          h5("Minimum Duration"),
                          h5("Maximum Duration"),
                       ),
                       h4(strong("Survey Characteristics Input (Optional): "), "Select survey characteristics to group data in table by."),
                      column(12,
                          h5("Survey Type"),
                          h5("Survey Protocol"),
                          h5("Waterbody Type"),

                       ),
                column(12, align="center",
                       br(),
                fluidRow(img(src="SurveyCharacteristics_Table.jpg",width="75%",style="display: inline-block;")),
                       br(),
                       ),
                       h3(strong("Species")),
                       h4(strong("Map: "), "Select a taxa class from 'Taxa Classes' bar to get desired choices. From picker select the desired taxa
                           to display number of surveys containing records for this species. Click on a state to get the value."),
                       h4(strong("Table: "), "A table of survey counts by taxa. Apply filters from top bar of table to select specific taxa or states. If 'Yes' is selected from 'Summarize by State' on sidebar counts will be displayed by state, if 'No' counts will be for all surveys."),

                column(12, align="center",
                br(),
                fluidRow(img(src="Species_Avail_Map.jpg",width="75%",style="display: inline-block;")),
                br(),
                       ),
    ),
    ),
    tabPanel("Overview",value="Data_Summ_Overview",
             column(12,
                    column(12,
                           br()
                    ),
                    column(3,align="center",
                    ),
                    column(3, align="center",
                           actionButton("UG_Data_Summ_Overview_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
                    ),
                    column(3,align="center",
                           actionButton("UG_Data_Summ_Overview_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
                    ),
                    column(3,align="center",
                           actionButton("UG_Data_Summ_Overview_Next","Next", class = "btn-primary btn-md",width="100%"),
                    ),
                    column(12,
                           br()
                    ),
                    column(12,align="center",
                           h1(strong("Summarize Creel Survey Data")),
                    ),
                    column(12,align="left",
                           h3("Users can quickly calculate basic summary statistics (Sum, Mean, Median, Minimum, Maximum, and Count) for user-selected data."),
                           br(),
                        column(12, align="center",
                            fluidRow(img(src="Summarize.jpg",width="100%",style="display: inline-block;")),
                          br(),
                        ),
                    ),

             ),
    ),
    tabPanel("Select Surveys",value="Data_Summ_SelSurveys",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_SelSurveys_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_SelSurveys_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_SelSurveys_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_SelSurveys_Next","Next", class = "btn-primary btn-md",width="100%"),
             ),
             column(12,
                    br()
             ),
         column(12, align="center",
                h2(strong("Select Surveys for Inclusion")),
                ),
         column(12,
                h3("Select whether you wish to initially include ",strong("all")," surveys, a subset based on ",strong("filters"),", or a spatial subset based on a ",strong("map")," selection by selecting the 
                appropriate box. Additional filters can be applied at later steps as well. By subsetting the data, choices for fields will be reduced to only those which 
                   are populated, streamlining future steps. Included surveys can be modified at any time by modifying your selections."),
                br(),
         ),
            column(4,
                  column(12,align="center",
                h4(strong("All")),
                ),
                h4("All surveys contained in the CreelCat database are included in your use of the CreelCat App."),
                ),
            column(4,
                  column(12,align="center",
                       h4(strong("Map")),
                  ),
                    h4("Only surveys within the geographic bounds defined by a user-drawn polygon or user selected States/Counties in your use of the CreelCat App (Detailed Instructions Below)."),
                  ),
            column(4,
                  column(12,align="center",
                      h4(strong("Filters")),
                       ),
                       h4("Only surveys within the bounds defined by user-selected filters are included in your use of the CreelCat App (Detailed Instructions Below)."),
                      ),
         column(6,
                br(),
                h2(strong("Map Selected Survey Instructions")),
                h4(strong("Warning: "), "Selection near boundaries can be inconsistent, please verify that selected surveys match the desired extent (selection by state or county can also be accomplished via filters)"),
                h4(strong("Step 1: "), "Choose method for making spatial selections"),
                h4(strong("Options Include: "), "Polygon, State, or County"),
                img(src="Sel_Data_Map.jpg",width="90%",style="display: inline-block;"),
                h3(strong("Polygons: ")),
                h4(strong("Step 2: "), "Click 'Draw' button to begin drawing on map"),
                h4(strong("Step 3: "), "Click on map to create polygon vertices"),
                h4(strong("Step 4: "), "Once desired polygon has been drawn click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="Map_Filter_Polygon.jpg",width="90%",style="display: inline-block;"),
                h3(strong("State: ")),
                h4(strong("Step 2: "), "Click 'Select' button to begin making selections"),
                h4(strong("Step 3: "), "Click on map within state boundaries to make selections (selected states will be highlighted)"),
                h4(strong("Step 4: "), "Once all desired states have been selected click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="StateSelection_MapSel.jpg",width="90%",style="display: inline-block;"),
                h3(strong("County: ")),
                h4(strong("Step 2: "), "Click 'Select' button to begin making selections"),
                h4(strong("Step 3: "), "Click on map within county boundaries to make selections (selected counties will be highlighted)"),
                h4(strong("Step 4: "), "Once all desired counties have been selected click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="CountySelection_MapSel.jpg",width="90%",style="display: inline-block;"),
                ), 
         column(6,
                br(),
                h2(strong("Filter Selected Survey Instructions")),
                h4(strong("Step 1: "), "Select which fields you wish to use to filter the data"),
                h4(strong("Options Include: "), "State, County, Duration, Year, Waterbody Name, Waterbody Area, Waterbody Type"),
                h4(strong("Step 2: "), "Select values for desired filters to apply to the dataset"),
                h4("For ",strong("factor")," fields select all desired choices from picker input"),
                h4("For ",strong("numeric")," fields select desired range from slider input"),
                img(src="FilterDataIcon.jpg",width="90%",style="display: inline-block;"),
                ),

      ),

    tabPanel("Select Fields",value="Data_Summ_SelFields",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_SelFields_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_SelFields_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_SelFields_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_SelFields_Next","Next", class = "btn-primary btn-md",width="100%"),
             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Select Fields for Inclusion")),
             ),
             column(12,
                column(9,
                    h3(strong("Instructions")),
                    h4("Select the fields you wish to include while interacting with the CreelCat App. Changes can be made at any time, but doing so will reset all dependent items (tables, visualizations, etc.)."),
                    h4(strong("Step 1: "),"From sidebar select the fields you wish to include from each of the picker inputs on the sidebar"),
                    h4(strong("Consideration: "), "Processing time increases with additional fields, for the most efficient use of the app select only those fields you are interested in."),
                    h4(strong("Consideration: "), "Field choices are based on those fields which are populated within those surveys selected in the data selection step ('All','Filters', or 'Map'). If desired fields are not present in the pickers that means they are not populated in any of the surveys you selected for inclusion."),
                    h4(strong("Step 2: "), "Once all desired fields have been selected from the pickers on the sidebar click the 'Update Selected Fields' button. This will pass the selected fields to the interface. If you want to change selected fields you can select or unselect any of them by clicking on them. Once changes have been completed you
                        again need to click 'Update Selected Fields' to pass along the modifications to selected fields"),
                    br(),
                ),
                column(3,
                       br(),
                fluidRow(img(src="Paddlefish2.png",width="100%",style="display: inline-block;")),
                       ),
                column(9,
                    h3(strong("Field Category Descriptions")),
                    h4(strong("Default Fields: "),"Required fields which are automatically included. These include 'Survey_ID', 'State', 'Year','Waterbody_Name_Unique', and 'WB_ID'"),
                    h4(strong("Survey Info: "),"Includes fields related to the characteristics of the survey."),
                    h4(strong("Waterbody Info: "),"Includes fields related to the characteristics of the associated waterbody."),
                    h4(strong("Fish Info: "),"Includes fields related to the metrics used to quantify the characteristics of captured fish and associated taxonomic information."),
                    h4(strong("Effort Info: "),"Includes fields related to the angler effort."),
                    h4(strong("Angler Preference Info: "), "Includes fields related to the effort or preference associated with taxa being targetted by anglers"),
                    h4(strong("Demographic Info: "), "Includes fields related to angler demographics"),
                    br(),
                ),
                column(3,
                       br(),
                fluidRow(img(src="LMB_2.png",width="100%",style="display: inline-block;")),
                       ),
                column(12,
                    h3(strong("Field Descriptions")),
                    h4(strong("From picker below: "), "Select either 'All' to view all fields housed within the CreelCat database, or a specific table to view a detailed descriptions of the fields within the database."),
                    br(),
                    pickerInput("Sum_UG_FieldMeta", "Select field catagories:",choices=c("All","Survey Info","Waterbody Info","Fish Info","Effort Info", "Angler Preference Info","Demographic Info"),selected="All",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
             conditionalPanel(condition="input.Sum_UG_FieldMeta=='All'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_All_Sum"),type=2)),
             ),
            conditionalPanel(condition="input.Sum_UG_FieldMeta=='Survey Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Survey_Sum"),type=2)),
             ),
            conditionalPanel(condition="input.Sum_UG_FieldMeta=='Waterbody Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Waterbody_Sum"),type=2)),
             ),
            conditionalPanel(condition="input.Sum_UG_FieldMeta=='Fish Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Fish_Sum"),type=2)),
             ),
            conditionalPanel(condition="input.Sum_UG_FieldMeta=='Effort Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Effort_Sum"),type=2)),
             ),
            conditionalPanel(condition="input.Sum_UG_FieldMeta=='Angler Preference Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Preference_Sum"),type=2)),
             ),
            conditionalPanel(condition="input.Sum_UG_FieldMeta=='Demographic Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Demographic_Sum"),type=2)),
             ),
            br(),
            br(),
            br(),
                    ),
             ),
    ),

    tabPanel("Data Considerations",value="Data_Summ_DataWarning",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_DataWarning_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_DataWarning_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_DataWarning_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_DataWarning_Next","Next", class = "btn-primary btn-md",width="100%"),
             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Important Data Considerations")),
             ),
             column(12,
                    h3("The data contained within the CreelCat database originate from surveys are quite varied in nature, because of this care and consideration should be taken when using the data."),
                    br(),
             ),
             column(12,
                column(9,
                     h4(strong("Survey Types: "),"Generally the data contained in CreelCat comes from state natural resource agency conducted creel surveys,
                         however in some cases we have also supplemented this data to include catch cards, mail surveys, phone surveys, angler journal programs, 
                        and other data sources which can be used to evaluate recreational fishing."),
                     h4(strong("Survey Protocols: "),"A wide variety of methods are employed by the surveys contained within CreelCat. These methods vary in both how 
                        informatoin is gathered from anglers as well as how angler counts are conducted in order to generate estimates. Examples of differing protocols 
                        include but are not limited to: Roving, Access, Combined, Aerial Counts, Camera Counts, and others."),
                     h4(strong("Survey Duration: "), "The duration of surveys can vary substantially from lengths of a few days to over a year. The length of the survey 
                               will impact the values contained within the survey data. Care should be exercised if when surveys with differences in duration are used
                               as an estimate (or count) generated from a short survey will likely underestimate values relative to a survey with a longer duration. When 
                               comparisons are made among surveys with varying durations it may be useful to employ rate based metrics such as values per day or per hours of effort"),
                     h4(strong("Survey Timing: "),"When surveys take place can also influence associated values. Surveys capturing data in different seasons (or with other differences 
                     in start or end dates) may influence results. Additionally, factors such as open seasons and other regulations may interact with survey timing to influence the data."),
                     h4(strong("Taxonomic Consistency: "),"How anglers and surveying agencies name, identify, and classify the taxa being caught and targetted can vary between 
                        and even within surveys. Accounting for this variability is important when utilizing this dataset."),
                  column(12,
                        h4(strong("Naming: "), "Different common names are often used for taxa among surveys. Where multiple common names were attributed to the same taxa we 
                           attempted to use the most common, widespread, or interpretable name (ex. 'Cisco' was selected over 'Lake Herring' as the common name for 'Coregonus artedi'). Hybrids 
                           are included in the database and although they often have a variety of common names (ie. Saugeye, Wiper, Tiger Muskie) we chose to name hybrids based on 
                           the common names of the parental species (ie. Walleye-Sauger (Hybrid), White-Striped Bass (Hybrid), Northern Pike-Muskellunge (Hybrid)) for easier interpretability."),
                        h4(strong("Attribution Levels: "), "Taxa were often attributed at different levels including: ",strong("Variants"),"(ie. Steelhead Rainbow Trout/Oncorhynchus mykiss) ",
                           strong("Subspecies "),"(ie. Yellowstone Cutthroat Trout/Oncorhynchus clarkii bouvieri) ",strong("Species "),"(ie. Largemouth Bass/Micropterus salmoides) ",
                           strong("Genus "),"(ie. Crappie/Pomoxis) ",strong("Family "),"(ie. Catfish/Ictaluridae) and ",strong("Non-Taxonomic Groups "),"(ie. Panfish). 
                           We attributed all taxa to higher levels when possible by summing values (where appropriate) of all taxa falling under the higher level classification (ie. Black Crappie and 
                           White Crappie (Species) could be summed to produce values attributable to Crappie (Genus)), however values attributed to a higher taxonomic level can not be attributed to lower 
                           levels (ie. Crappie (Genus) values can not be attributed to White Crappie and Black Crappie (Species) values)."),
                        h4(strong("Unattributed Data: "), "If a user selects a survey and taxa that contain values attributed at a higher taxonomic level they will recieve a warning stating that unattributed 
                           taxa exist and a list of those taxa in a table. For example if a user selects a species level data attribution (ie.'Black Crappie Harvest Estimate') and their data includes surveys 
                           which only have genus level attribution for that taxa (ie. 'Crappie Harvest Estimate), they will recieve a warning that their dataset includes unattributed data (ie. the harvest estimates 
                           attributed to Crappie may or may not be Black Crappie) and they should note that it is possible that for those surveys there is potentially unattributed data for those species (ie. some or 
                           all of the Crappie Harvest may have been Black Crappie but it can not be attributed as such based on the data). It is our recommendation that in cases of unattributed data the user either 
                           works with the data at a higher attribution level (ie. use Genus level data rather than Species level data) or drop surveys containing unattributed data."),
                        h4(strong("Partially Attributed Data: "), "If a user selects a survey and taxa that contain values attributed at both the selected taxonomic level as well as a higher taxonomic level 
                           they will recieve a warning that their dataset includes partially attributed taxa. This occurs when a survey attributes taxa to multiple levels simultaneously. For example a survey may attribute 
                           catch estimates to both Largemouth Bass (Species) and Black Bass (Genus). If the user selects Largemouth Bass as a taxonomic unit they will get values that may be a partial estimate (ie. 
                           some or all of the values attributed to Black Bass may also be Largemouth Bass). In these cases, similarly to situations with unattributed data, we recommend either switching to the higher 
                           taxonomic level or dropping the surveys that contain partially attributed data."),
                        h4(strong("Non-Taxonomic Attribution: "), "In some cases rather than associating data with monophyletic taxonomic units data is instead attributed to groups of species which are not contained within 
                           a single, monophyletic group. Examples of these groups include things like Panfish (which include species from a number of different families) or Trout (which predominately include inland 
                           Salmonid species while excluding many of the species that spend time in marine environments which are considered Salmon). Because these groups are not monophyletic 
                           values attributed to these groups can not be attributed to other taxa and often result in the presence of 'Unattributed Data' or Partially Attributed Data'. Additionally, the component species of 
                           these groups can differ from survey to survey. In order to accomodate this variability we defined these non-taxonomic groups at the broadest level observed within the dataset (ie. in Florida both Oscar and
                            Mayan Cichlids are classified as Panfish so our definition includes them as well."),
                  
                  ),
                
                     h4(strong("Estimation/Expansion Methods: "),"A wide variety of statistical methods were used to generate estimates from survey data. These methods are often specific to the 
                        survey protocols. Differences in these methods may influence the values contained within the CreelCat database."),
                     h4(strong("Estimates vs Raw Data: "),"Wherever posssible we tried to include data in the form of estimates or expansions (Values calculated by combining interview and angler count data to generate overall estimates), 
                        rather than raw interview data which does not expand beyond the information collected from the anglers. In some cases only raw data was available (surveys did not employ angler counts or did not 
                        use the values generated via angler counts to statistically generate overall estimates), and in those cases we included raw data within our database. Raw data is likely not useful for comparisons with estimated data 
                        however it may be useful in looking at trends in specific waterbodies over time."),
                     h4(strong("Standardization: "),"Wherever possible we attempted to standardize the data for comparability. This included modifying units in some cases (we typically adopted the most commonly used units such as 
                        inches for length, acres for area, etc.), using consistent naming (taxonomic names, field names, etc.), and creating a paired data and geospatial structure that allowed survey data to be linked geospatially. Because there are 
                        differences in survey methodology and sometimes in protocol at times certain metrics were unable to be combined through standardization. For example angler effort is typically quantified based on the 
                        effort hours, however in some cases effort is quantified based on other metrics such as number of trips, anglers, or days. In these cases we either included an additional field to capture the data which couldn't be 
                        attributed to the existing field via standardization or employed simple calculations to make a conversion (ie. a survey provides angler counts and average effort hours we could calculate effort hours by multiplying 
                        the angler count by average effort hours). One particular field where we employed standardization to quantify a metric is in the quantification of percentage estimate for angler preference. Because effort and preference metrics 
                        varied among surveys in some cases this metric is based on percent of hours anglers spent targetting the specified taxa while in other cases this was based on the percentage of anglers. Additionally, with the angler preference data 
                        differences in protocols results in anglers attributing effort to a single or multiple species."),
                     h4(strong("Non-Random Datasets: "),"The locations selected for creel surveys and the timing of these surveys are often non-random and they may be conducted for specific purposes. Care should be taken when employing analyses to 
                        account for the non-random nature of this dataset."),
                     h4(strong("Unaccounted for factors: "),"A variety of factors likely are highly influential are not included in our dataset. Regulations such as open/closed seasons,
                               harvest limits, length limits, etc. may play a large role in shaping angling dynamics on waterbodies. Additionally, factors such as public and private waterbody access, infrastructure, 
                               fish population levels, size classes, species composition, waterbody characteristics, social/cultural/demographic factors and many others likely exert substantial influence on the data contained within 
                               the CreelCat database."),
                ),
                column(3,
                br(),
                fluidRow(img(src="Rosenberg5.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="Double.jpg",width="100%",style="display: inline-block;")),
                br(), 
                fluidRow(img(src="Sisters.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="ShoreLunch.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="JG.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="SMB.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="dnr0326.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="Sunset.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="FogAngling.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="Salmon.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="SMB_Hans.jpg",width="100%",style="display: inline-block;")),
              ),
           ),
    ),

    tabPanel("Summarization Setup",value="Data_Summ_Inputs",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_Inputs_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_Inputs_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_Inputs_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_Inputs_Next","Next", class = "btn-primary btn-md",width="100%"),

             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Data Summarization Setup")),
             ),
             column(12,
                    h3(strong("Select Calculations")),
                  column(12,
                    h4(strong("Count: "),"Calculated automatically (no selection required) to provide a count of all surveys upon which summarization has been applied."),
                    h4(strong("Sum: "),"Reports total for all selected surveys and fields."),
                    h4(strong("Mean: "),"Reports the average (per survey) of selected surveys and fields."),
                    h4(strong("Median: "),"Reports the median value for selected surveys and fields."),
                    h4(strong("Min: "),"Reports the lowest value for selected surveys and fields."),
                    h4(strong("Max: "),"Reports the highest value for selected surveys and fields."),
                  ),
                  h3(strong("Select 'Group by' Fields")),
                  column(12,
                    h4(strong("Select "), "any fields you wish to use to create groups upon which to apply the summarization calculations. If no group-by fields 
                       are selected a single value will be provided for each field/calculation combination. If 'group by' fields are included summary statistics will be provided 
                       for each unique combination of 'group by' fields which exist in the dataset."),
                    h4(strong("Choices "), "of 'group by' fields include 'Year', 'State','County', 'Waterbody_Name_Unique', 'WB_ID', and any other user-selected fields that are classified as 'factors'."),
                        ),
                  h3(strong("Select Fields to be Summarized")),
                  column(12,
                      h4(strong("Select "), "any fields you wish to apply the summarization calculations to. If 'group by' fields are included, summarizations will be 
                         calculated for each of the selected fields within each unique group."),
                    h4(strong("Choices "), "for summarization fields will include any numeric fields which were included within the the 'Select Fields' step."),
                        ),
                  h3(strong("Select Surveys for Inclusion")),
                  column(12,
                      h4(strong("Select "), "desired surveys from the '' table in the main panel to be included within the summarization."),
                      h4(strong("In-Table: ")),
                      column(9,
                       h4("Press and hold the ",strong("'Ctrl' "), "button on keyboard to select multiple rows directly from table individually."),
                       h4("Press and hold the ",strong("'Shift' "), "button on keyboard to select a range of rows directly from table by clicking the first and last desired row."),
                      ),
                      column(3,
                            fluidRow(img(src="TableSelect.png",width="100%",style="display: inline-block;")), 
                             ),
                      h4(strong("Buttons: ")),
                      column(12, align="center",
                      fluidRow(img(src="ButtonSelection.png",width="60%",style="display: inline-block;")),
                      ),
                      column(12,alight="left",
                       h4(strong("Select All Filtered: "),"Selects all rows remaining rows in table after filters have been applied."), 
                       h4(strong("Deselect All Filtered: "),"Deselects all rows remaining in table after filters have been applied."), 
                       h4(strong("Select All: "),"Selects all rows from the initial table, even rows that do not appear due to filters."), 
                       h4(strong("Deselect All: "),"Deselects all rows from the table, even those rows which do not appear due to filters."),
                      ),
                    ),
                      
                        ),
             ),

    tabPanel("Summarization Results",value="Data_Summ_Results",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_Results_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_Results_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Data_Summ_Results_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",

             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Data Summarization Results")),
             ),
             column(12,
                    h3("Results of the summarization can be viewed in the 'Summarization Table' near the top of the page."),
                    h4("The first column(s) will list the grouping variables, followed by the 'Survey Count' field which lists how many 
                       surveys belong to the group, followed by the summarization statistics."),
                    h4("The information contained within the summarization table can be copied or saved using the buttons located above the table."),
                    h4("Filters, soring, and searching can also be applied to the results table."),
                    h4("Inputs to the summarization can be made at any time and the results will be updated based on any changes which were made."),
                    br(),
             ),
             column(12, align="center",
                      fluidRow(img(src="SummarizationResults.png",width="75%",style="display: inline-block;")),
                    br(),
                    ),
              column(12,
                column(7,
                    h3(strong("Consider Data Warnings: ")), 
                    h4("The data contained in CreelCat is not homogenous and therefore care should be taken to consider differences among surveys when making 
                       any types of comparisons. Some relevant warnings about discrepancies in input data are displayed in the 'Data Warnings' panel located above the summarization results. 
                       This panel can be clicked to expand/minimize. Although we have listed several of the major potential discrepancies care should be taken by the user to ascertain 
                       whether input data being used for visualizations is valid for any comparisons being made."),
                    h4(strong("Warnings include:")),
                    column(12,
                           h4(strong("Duration Range: "), "Number of days surveys are representative of."),
                           h4(strong("Start Dates: "), "Range of months surveys began."),
                           h4(strong("Conclusion Dates: "), "Range of months surveys concluded."),
                           h4(strong("Survey Types: "), "Which types of surveys are included in the input data."),
                           h4(strong("Survey Protocols: "), "Which survey protocols were utilized for the surveys included in input data"),
                           h4(strong("Focal Species: "), "What species were targetted in the input surveys."),
                           h4(strong("Waterbody Types: "), "Which waterbody types were included in the input data."),
                           h4(strong("NA Dropped Surveys: "), "How many of the selected input surveys were dropped from the summarization due to the presence of NA values 
                              for input fields (See tables below to view which surveys were dropped and which were retained."),
                           h4(strong("Unattributed Taxa: "), "See which surveys contained unattributed taxa. Unattributed taxa records are surveys which contain taxa which were attributed 
                           at a higher taxonomic level than the user is viewing which therefore can not be attibuted. For example a survey may have quantified harvest at the 
                           genus level (ie. Crappie) while the user may wish to view data at the species level (ie. Black or White Crappie). In this case the values associated 
                           with genus level observations can not be attributed to species. Because of this values can't be attributed for the desired taxa for those surveys. In these 
                           cases we recommend either removing those surveys from consideration or making evaluations at a higher taxonomic level (ie. 'Crappie' instead of 'White Crappie' and/or 
                           'Black Crappie'. Surveys containing unattributed taxa records can be viewed in the table below."),
                           h4(strong("Partially Attributed Taxa: "), "See which surveys contained partially attributed taxa. Partially attributed taxa records are surveys which contain taxa which were attributed 
                           at a multiple taxonomic levels within a single survey (ie. 'Crappie' (Genus) and 'Black Crappie'(Species)). In these cases selecting the higher taxonomic level 
                              (ie. 'Crappie' (Genus)), will resolve the issue as the lower taxonomic level records (ie. 'Black Crappie' (Species)) will be added to the higher taxonomic records, 
                              however use of the lower taxonomic level will result in the potential unattribution of records (ie. 'Crappie' records which may or may not have been 'Black Crappie' will not 
                              be attributed) causing potential underestimation of selected metrics for those taxa. To resolve this issue we recommend removing surveys containing partially attributed taxa or 
                              selecting the higher taxonomic level (ie. Genus instead of Species). Surveys containing partially attributed taxa can be viewed in the table below."),
                         ),
                    ),
                column(5,
                       br(),
                       img(src="DataWarning.png",width="90%",style="display: inline-block;"),
                       ),
             ),
    ),
    tabPanel("Overview",value="VisData_Overview", 
             column(12,
                    column(12,
                           br()
                    ),
                    column(3,align="center",
                    ),
                    column(3, align="center",
                           actionButton("UG_VisData_Overview_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
                    ),
                    column(3,align="center",
                           actionButton("UG_VisData_Overview_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
                    ),
                    column(3,align="center",
                           actionButton("UG_VisData_Overview_Next","Next", class = "btn-primary btn-md",width="100%"),
                    ),
                    column(12,
                           br()
                    ),
                    column(12,align="center",
                           h1(strong("Visualize Creel Survey Data")),
                    ),
                    column(12,align="left",
                           h3("Users can create custom visualizations based on the data contained within the creel survey database."),
                      column(12, align="center",
                      fluidRow(img(src="LinkedSelectionIcon.jpg",width="75%",style="display: inline-block;")),
                    ),
                    
             ),
    ),
    ),
    tabPanel("Select Surveys",value="VisData_SelSurveys",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_VisData_SelSurveys_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_SelSurveys_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_SelSurveys_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_SelSurveys_Next","Next", class = "btn-primary btn-md",width="100%"),
             ),
             column(12,
                    br()
             ),
         column(12, align="center",
                h2(strong("Select Surveys for Inclusion")),
                ),
         column(12,
                h3("Select whether you wish to initially include ",strong("all")," surveys, a subset based on ",strong("filters"),", or a spatial subset based on a ",strong("map")," selection by selecting the 
                appropriate box. Additional filters can be applied at later steps as well. By subsetting the data, choices for fields will be reduced to only those which 
                   are populated, streamlining future steps. Included surveys can be modified at any time by modifying your selections."),
                br(),
         ),
            column(4,
                  column(12,align="center",
                h4(strong("All")),
                ),
                h4("All surveys contained in the CreelCat database are included in your use of the CreelCat App."),
                ),
            column(4,
                  column(12,align="center",
                       h4(strong("Map")),
                  ),
                    h4("Only surveys within the geographic bounds defined by a user-drawn polygon or user selected States/Counties in your use of the CreelCat App (Detailed Instructions Below)."),
                  ),
            column(4,
                  column(12,align="center",
                      h4(strong("Filters")),
                       ),
                       h4("Only surveys within the bounds defined by user-selected filters are included in your use of the CreelCat App (Detailed Instructions Below)."),
                      ),
         column(6,
                br(),
                h2(strong("Map Selected Survey Instructions")),
                h4(strong("Warning: "), "Selection near boundaries can be inconsistent, please verify that selected surveys match the desired extent (selection by state or county can also be accomplished via filters)"),
                h4(strong("Step 1: "), "Choose method for making spatial selections"),
                h4(strong("Options Include: "), "Polygon, State, or County"),
                img(src="Sel_Data_Map.jpg",width="90%",style="display: inline-block;"),
                h3(strong("Polygons: ")),
                h4(strong("Step 2: "), "Click 'Draw' button to begin drawing on map"),
                h4(strong("Step 3: "), "Click on map to create polygon vertices"),
                h4(strong("Step 4: "), "Once desired polygon has been drawn click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="Map_Filter_Polygon.jpg",width="90%",style="display: inline-block;"),
                h3(strong("State: ")),
                h4(strong("Step 2: "), "Click 'Select' button to begin making selections"),
                h4(strong("Step 3: "), "Click on map within state boundaries to make selections (selected states will be highlighted)"),
                h4(strong("Step 4: "), "Once all desired states have been selected click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="StateSelection_MapSel.jpg",width="90%",style="display: inline-block;"),
                h3(strong("County: ")),
                h4(strong("Step 2: "), "Click 'Select' button to begin making selections"),
                h4(strong("Step 3: "), "Click on map within county boundaries to make selections (selected counties will be highlighted)"),
                h4(strong("Step 4: "), "Once all desired counties have been selected click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="CountySelection_MapSel.jpg",width="90%",style="display: inline-block;"),
                ), 
         column(6,
                br(),
                h2(strong("Filter Selected Survey Instructions")),
                h4(strong("Step 1: "), "Select which fields you wish to use to filter the data"),
                h4(strong("Options Include: "), "State, County, Duration, Year, Waterbody Name, Waterbody Area, Waterbody Type"),
                h4(strong("Step 2: "), "Select values for desired filters to apply to the dataset"),
                h4("For ",strong("factor")," fields select all desired choices from picker input"),
                h4("For ",strong("numeric")," fields select desired range from slider input"),
                img(src="FilterDataIcon.jpg",width="90%",style="display: inline-block;"),
                ),

      ),
    
    tabPanel("Select Fields",value="VisData_SelFields",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_VisData_SelFields_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_SelFields_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_SelFields_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_SelFields_Next","Next", class = "btn-primary btn-md",width="100%"),
             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Select Fields for Inclusion")),
             ),
             column(12,
                column(9,
                    h3(strong("Instructions")),
                    h4("Select the fields you wish to include while interacting with the CreelCat App. Changes can be made at any time, but doing so will reset all dependent items (tables, visualizations, etc.)."),
                    h4(strong("Step 1: "),"From sidebar select the fields you wish to include from each of the picker inputs on the sidebar"),
                    h4(strong("Consideration: "), "Processing time increases with additional fields, for the most efficient use of the app select only those fields you are interested in."),
                    h4(strong("Consideration: "), "Field choices are based on those fields which are populated within those surveys selected in the data selection step ('All','Filters', or 'Map'). If desired fields are not present in the pickers that means they are not populated in any of the surveys you selected for inclusion."),
                    h4(strong("Step 2: "), "Once all desired fields have been selected from the pickers on the sidebar click the 'Update Selected Fields' button. This will pass the selected fields to the interface. If you want to change selected fields you can select or unselect any of them by clicking on them. Once changes have been completed you
                        again need to click 'Update Selected Fields' to pass along the modifications to selected fields"),
                    br(),
                ),
                column(3,
                       br(),
                fluidRow(img(src="Paddlefish2.png",width="100%",style="display: inline-block;")),
                       ),
                column(9,
                    h3(strong("Field Category Descriptions")),
                    h4(strong("Default Fields: "),"Required fields which are automatically included. These include 'Survey_ID', 'State', 'Year','Waterbody_Name_Unique', and 'WB_ID'"),
                    h4(strong("Survey Info: "),"Includes fields related to the characteristics of the survey."),
                    h4(strong("Waterbody Info: "),"Includes fields related to the characteristics of the associated waterbody."),
                    h4(strong("Fish Info: "),"Includes fields related to the metrics used to quantify the characteristics of captured fish and associated taxonomic information."),
                    h4(strong("Effort Info: "),"Includes fields related to the angler effort."),
                    h4(strong("Angler Preference Info: "), "Includes fields related to the effort or preference associated with taxa being targetted by anglers"),
                    h4(strong("Demographic Info: "), "Includes fields related to angler demographics"),
                    br(),
                ),
                column(3,
                       br(),
                fluidRow(img(src="LMB_2.png",width="100%",style="display: inline-block;")),
                       ),
                column(12,
                    h3(strong("Field Descriptions")),
                    h4(strong("From picker below: "), "Select either 'All' to view all fields housed within the CreelCat database, or a specific table to view a detailed descriptions of the fields within the database."),
                    br(),
                    pickerInput("Vis_UG_FieldMeta", "Select field catagories:",choices=c("All","Survey Info","Waterbody Info","Fish Info","Effort Info", "Angler Preference Info","Demographic Info"),selected="All",multiple=FALSE,options=pickerOptions(actionsBox=TRUE,liveSearch=TRUE,liveSearchStyle='contains')),
             conditionalPanel(condition="input.Vis_UG_FieldMeta=='All'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_All_Vis"),type=2)),
             ),
            conditionalPanel(condition="input.Vis_UG_FieldMeta=='Survey Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Survey_Vis"),type=2)),
             ),
            conditionalPanel(condition="input.Vis_UG_FieldMeta=='Waterbody Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Waterbody_Vis"),type=2)),
             ),
            conditionalPanel(condition="input.Vis_UG_FieldMeta=='Fish Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Fish_Vis"),type=2)),
             ),
            conditionalPanel(condition="input.Vis_UG_FieldMeta=='Effort Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Effort_Vis"),type=2)),
             ),
            conditionalPanel(condition="input.Vis_UG_FieldMeta=='Angler Preference Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Preference_Vis"),type=2)),
             ),
            conditionalPanel(condition="input.Vis_UG_FieldMeta=='Demographic Info'",
                    div(withSpinner(DT::dataTableOutput("FieldMeta_Demographic_Vis"),type=2)),
             ),
            br(),
            br(),
            br(),
                    ),
             ),
    ),
    
    tabPanel("Data Considerations",value="VisData_DataWarning",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_VisData_DataWarning_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_DataWarning_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_DataWarning_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_DataWarning_Next","Next", class = "btn-primary btn-md",width="100%"),
             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Important Data Considerations")),
             ),
             column(12,
                    h3("The data contained within the CreelCat database originate from surveys are quite varied in nature, because of this care and consideration should be taken when using the data."),
                    br(),
             ),
             column(12,
                column(9,
                     h4(strong("Survey Types: "),"Generally the data contained in CreelCat comes from state natural resource agency conducted creel surveys,
                         however in some cases we have also supplemented this data to include catch cards, mail surveys, phone surveys, angler journal programs, 
                        and other data sources which can be used to evaluate recreational fishing."),
                     h4(strong("Survey Protocols: "),"A wide variety of methods are employed by the surveys contained within CreelCat. These methods vary in both how 
                        informatoin is gathered from anglers as well as how angler counts are conducted in order to generate estimates. Examples of differing protocols 
                        include but are not limited to: Roving, Access, Combined, Aerial Counts, Camera Counts, and others."),
                     h4(strong("Survey Duration: "), "The duration of surveys can vary substantially from lengths of a few days to over a year. The length of the survey 
                               will impact the values contained within the survey data. Care should be exercised if when surveys with differences in duration are used
                               as an estimate (or count) generated from a short survey will likely underestimate values relative to a survey with a longer duration. When 
                               comparisons are made among surveys with varying durations it may be useful to employ rate based metrics such as values per day or per hours of effort"),
                     h4(strong("Survey Timing: "),"When surveys take place can also influence associated values. Surveys capturing data in different seasons (or with other differences 
                     in start or end dates) may influence results. Additionally, factors such as open seasons and other regulations may interact with survey timing to influence the data."),
                     h4(strong("Taxonomic Consistency: "),"How anglers and surveying agencies name, identify, and classify the taxa being caught and targetted can vary between 
                        and even within surveys. Accounting for this variability is important when utilizing this dataset."),
                  column(12,
                        h4(strong("Naming: "), "Different common names are often used for taxa among surveys. Where multiple common names were attributed to the same taxa we 
                           attempted to use the most common, widespread, or interpretable name (ex. 'Cisco' was selected over 'Lake Herring' as the common name for 'Coregonus artedi'). Hybrids 
                           are included in the database and although they often have a variety of common names (ie. Saugeye, Wiper, Tiger Muskie) we chose to name hybrids based on 
                           the common names of the parental species (ie. Walleye-Sauger (Hybrid), White-Striped Bass (Hybrid), Northern Pike-Muskellunge (Hybrid)) for easier interpretability."),
                        h4(strong("Attribution Levels: "), "Taxa were often attributed at different levels including: ",strong("Variants"),"(ie. Steelhead Rainbow Trout/Oncorhynchus mykiss) ",
                           strong("Subspecies "),"(ie. Yellowstone Cutthroat Trout/Oncorhynchus clarkii bouvieri) ",strong("Species "),"(ie. Largemouth Bass/Micropterus salmoides) ",
                           strong("Genus "),"(ie. Crappie/Pomoxis) ",strong("Family "),"(ie. Catfish/Ictaluridae) and ",strong("Non-Taxonomic Groups "),"(ie. Panfish). 
                           We attributed all taxa to higher levels when possible by summing values (where appropriate) of all taxa falling under the higher level classification (ie. Black Crappie and 
                           White Crappie (Species) could be summed to produce values attributable to Crappie (Genus)), however values attributed to a higher taxonomic level can not be attributed to lower 
                           levels (ie. Crappie (Genus) values can not be attributed to White Crappie and Black Crappie (Species) values)."),
                        h4(strong("Unattributed Data: "), "If a user selects a survey and taxa that contain values attributed at a higher taxonomic level they will recieve a warning stating that unattributed 
                           taxa exist and a list of those taxa in a table. For example if a user selects a species level data attribution (ie.'Black Crappie Harvest Estimate') and their data includes surveys 
                           which only have genus level attribution for that taxa (ie. 'Crappie Harvest Estimate), they will recieve a warning that their dataset includes unattributed data (ie. the harvest estimates 
                           attributed to Crappie may or may not be Black Crappie) and they should note that it is possible that for those surveys there is potentially unattributed data for those species (ie. some or 
                           all of the Crappie Harvest may have been Black Crappie but it can not be attributed as such based on the data). It is our recommendation that in cases of unattributed data the user either 
                           works with the data at a higher attribution level (ie. use Genus level data rather than Species level data) or drop surveys containing unattributed data."),
                        h4(strong("Partially Attributed Data: "), "If a user selects a survey and taxa that contain values attributed at both the selected taxonomic level as well as a higher taxonomic level 
                           they will recieve a warning that their dataset includes partially attributed taxa. This occurs when a survey attributes taxa to multiple levels simultaneously. For example a survey may attribute 
                           catch estimates to both Largemouth Bass (Species) and Black Bass (Genus). If the user selects Largemouth Bass as a taxonomic unit they will get values that may be a partial estimate (ie. 
                           some or all of the values attributed to Black Bass may also be Largemouth Bass). In these cases, similarly to situations with unattributed data, we recommend either switching to the higher 
                           taxonomic level or dropping the surveys that contain partially attributed data."),
                        h4(strong("Non-Taxonomic Attribution: "), "In some cases rather than associating data with monophyletic taxonomic units data is instead attributed to groups of species which are not contained within 
                           a single, monophyletic group. Examples of these groups include things like Panfish (which include species from a number of different families) or Trout (which predominately include inland 
                           Salmonid species while excluding many of the species that spend time in marine environments which are considered Salmon). Because these groups are not monophyletic 
                           values attributed to these groups can not be attributed to other taxa and often result in the presence of 'Unattributed Data' or Partially Attributed Data'. Additionally, the component species of 
                           these groups can differ from survey to survey. In order to accomodate this variability we defined these non-taxonomic groups at the broadest level observed within the dataset (ie. in Florida both Oscar and
                            Mayan Cichlids are classified as Panfish so our definition includes them as well."),
                 ),
                
                     h4(strong("Estimation/Expansion Methods: "),"A wide variety of statistical methods were used to generate estimates from survey data. These methods are often specific to the 
                        survey protocols. Differences in these methods may influence the values contained within the CreelCat database."),
                     h4(strong("Estimates vs Raw Data: "),"Wherever posssible we tried to include data in the form of estimates or expansions (Values calculated by combining interview and angler count data to generate overall estimates), 
                        rather than raw interview data which does not expand beyond the information collected from the anglers. In some cases only raw data was available (surveys did not employ angler counts or did not 
                        use the values generated via angler counts to statistically generate overall estimates), and in those cases we included raw data within our database. Raw data is likely not useful for comparisons with estimated data 
                        however it may be useful in looking at trends in specific waterbodies over time."),
                     h4(strong("Standardization: "),"Wherever possible we attempted to standardize the data for comparability. This included modifying units in some cases (we typically adopted the most commonly used units such as 
                        inches for length, acres for area, etc.), using consistent naming (taxonomic names, field names, etc.), and creating a paired data and geospatial structure that allowed survey data to be linked geospatially. Because there are 
                        differences in survey methodology and sometimes in protocol at times certain metrics were unable to be combined through standardization. For example angler effort is typically quantified based on the 
                        effort hours, however in some cases effort is quantified based on other metrics such as number of trips, anglers, or days. In these cases we either included an additional field to capture the data which couldn't be 
                        attributed to the existing field via standardization or employed simple calculations to make a conversion (ie. a survey provides angler counts and average effort hours we could calculate effort hours by multiplying 
                        the angler count by average effort hours). One particular field where we employed standardization to quantify a metric is in the quantification of percentage estimate for angler preference. Because effort and preference metrics 
                        varied among surveys in some cases this metric is based on percent of hours anglers spent targetting the specified taxa while in other cases this was based on the percentage of anglers. Additionally, with the angler preference data 
                        differences in protocols results in anglers attributing effort to a single or multiple species."),
                     h4(strong("Non-Random Datasets: "),"The locations selected for creel surveys and the timing of these surveys are often non-random and they may be conducted for specific purposes. Care should be taken when employing analyses to 
                        account for the non-random nature of this dataset."),
                     h4(strong("Unaccounted for factors: "),"A variety of factors likely are highly influential are not included in our dataset. Regulations such as open/closed seasons,
                               harvest limits, length limits, etc. may play a large role in shaping angling dynamics on waterbodies. Additionally, factors such as public and private waterbody access, infrastructure, 
                               fish population levels, size classes, species composition, waterbody characteristics, social/cultural/demographic factors and many others likely exert substantial influence on the data contained within 
                               the CreelCat database."),
                ),
                column(3,
                br(),
                fluidRow(img(src="Rosenberg5.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="Double.jpg",width="100%",style="display: inline-block;")),
                br(), 
                fluidRow(img(src="Sisters.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="ShoreLunch.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="JG.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="SMB.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="dnr0326.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="Sunset.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="FogAngling.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="Salmon.jpg",width="100%",style="display: inline-block;")),
                br(),
                fluidRow(img(src="SMB_Hans.jpg",width="100%",style="display: inline-block;")),
              ),
           ),
    ),
    
    tabPanel("Visualization Settings",value="VisData_Settings",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Settings_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Settings_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Settings_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Settings_Next","Next", class = "btn-primary btn-md",width="100%"),
                    
             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Visualization Settings")),
             ),
             column(12,
                    h3("Settings which are applied to all visualizations via the 'Settings' panel on the sidebar include the number of visualizations 
                       to be created simultaneously (1-4), whether input data is shared between mutliple visualizations or selected independently, whether selection 
                       is linked among visualizations (Surveys selected on one visualization are selected across the other visualizations), and 
                       a toggle to determine whether you wish to have a light or dark background for your visualizations. More details about each 
                       of these components can be found below."),
             ),
             column(12,
                    br(),
                column(7,
                    h4(strong("Number of Visualizations: "),"Up to four visualizations can be created/displayed simultaneously. The use of shared data and linked selection requires at least two visualizations."),
                ),
                column(5,
                fluidRow(img(src="NumVisualizations.png",width="100%",style="display: inline-block;")),
                       )
                    ),
             column(12,
                    br(),
                column(7,
                    h4(strong("Shared Data: "),"When 'No' is input data can be selected independently for each visualization. When 'Yes' is selected input data is shared amongst all
                    visualizations. Surveys containing NULL values for input fields are dropped from the input dataset. When data is not shared surveys are only dropped for the 
                    associated visualization. When data is shared surveys containing NULL values for any of the input fields (across all visualizations) are dropped. Surveys must use 
                    shared data if the user wishes to employ linked selection."),
                ),
                column(5,
                fluidRow(img(src="SharedData.png",width="100%",style="display: inline-block;")),
                       )
                    ),
             column(12,
                    br(),
                column(7,
                    h4(strong("Linked Selection: "), "When 'No' is selected selections made within a visualization will only be reflected within that visualization and displayed in the associated 
                       selection table below. When 'Yes' is selected a selection made in any visualization will be reflected in across all other visualizations and in a single table below. 
                       The Use of this feature requires shared data to be enabled. When linked selection is enabled a 'Clear Selection' button will be displayed. Clicking this button will 
                       clear the selections across all visualizations. More details can be found on the 'Data selection' tab within the user guide."),
                ),
                column(5,
                fluidRow(img(src="LinkedSelectionIcon.png",width="100%",style="display: inline-block;")),
                       )
                    ),
             column(12,
                    br(),
                column(7,
                    h4(strong("Visualization Background: "), "Determines the style of the visualizations. When 'Light' is selected the backgrounds of maps and plots will be displayed with a light 
                       background and dark text elements. When 'Dark' is selected the backgrounds will be dark and text will be light. Making a change on this button will automatically change the 
                       basemap on all maps, however the basemap can still be alterred manually within the visualization."),
                ),
                column(5,
                fluidRow(img(src="BackgroundStyle.png",width="100%",style="display: inline-block;")),
                       )
                    ),
    ),
    tabPanel("Data Inputs",value="VisData_DataInputs",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_VisData_DataInputs_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_DataInputs_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_DataInputs_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_DataInputs_Next","Next", class = "btn-primary btn-md",width="100%"),
                    
             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Data Inputs for Visualizations")),
             ),
             column(12,
                    h3("Data displayed in visualizations is selected from table(s) displayed below the visualizations. Data can be 
                       selected using multiple techniques. Warnings regarding potential data issues are displayed in a collapsable panel 
                       above the visualizations."),
                    br(),
             ),
             column(12,
                    br(),
                column(12,
                      h3(strong("Input Tables: "),"Tables located below the visualizations are used to select visualization input data. When 
                         'Shared Data' is not used data should be selected from the table under the tab associated with each visualization 
                         (ie. 'Input (Vis. 2)', when 'Shared Data' is used data should be selected from the table under the 'Input Data' tab."),
                      br(),
                      h3(strong("Select "), "desired surveys from the input table can be selected in the following ways."),
                      h4(strong("In-Table: ")),
                      column(9,
                       h4("Press and hold the ",strong("'Ctrl' "), "button on keyboard to select multiple rows directly from table individually."),
                       h4("Press and hold the ",strong("'Shift' "), "button on keyboard to select a range of rows directly from table by clicking the first and last desired row."),
                      ),
                      column(3,
                            fluidRow(img(src="TableSelect.png",width="100%",style="display: inline-block;")), 
                             ),
                      h4(strong("Buttons: ")),
                      column(12, align="center",
                      fluidRow(img(src="ButtonSelection.png",width="60%",style="display: inline-block;")),
                      ),
                      column(12,alight="left",
                       h4(strong("Select All Filtered: "),"Selects all rows remaining rows in table after filters have been applied."), 
                       h4(strong("Deselect All Filtered: "),"Deselects all rows remaining in table after filters have been applied."), 
                       h4(strong("Select All: "),"Selects all rows from the initial table, even rows that do not appear due to filters."), 
                       h4(strong("Deselect All: "),"Deselects all rows from the table, even those rows which do not appear due to filters."),
                        br(),
                       ),
                    ),
             ),
    ),
    tabPanel("Linked Selection",value="VisData_DataSelection",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_VisData_DataSelection_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_DataSelection_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_DataSelection_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_DataSelection_Next","Next", class = "btn-primary btn-md",width="100%"),
                    
             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Linked Selection")),
             ),
             column(12,
                    h3("Surveys can be selected within visualizations to highlight desired surveys and view selected survey information with a table.Linked selection 
                    allows selections made in one visualization to be represented across all visualizations. This is a powerful tool for data exploration and comparison 
                    which allows users to simultaneously view a variety of potentially related phenomena and drill down to evaluate patterns across spatial or temporal scales.
                    Some examples of potential uses for this tool are listed here with instructions on how to make selections in different visualization types found below."),
                    br(),
              
              column(12,
                h3(strong("Linked Selection:")),
                column(6,
                    h4("Linked selection allows selections to be shared across visualizations."),
                    h4("The linked selection feature is available when the number of visualizations is set to 2 or more and shared data is enabled. It can be enabled from 
                       the 'Settings' panel on the sidebar."),
                    h4(strong("Maps and Scatter Plots: "), "When linked selection is enabled, selections made either in the 'Make Selection' table (User selects surveys directly from a table) 
                      or in any of the currently displayed maps or scatter plots are displayed across all visualizations. Selected surveys are shown at 100% opacity, while unselected 
                       surveys are transparent (the user can adjust the transparency of unselected surveys in the sidebar)."),
                    h4(strong("Line Plots, Bar Charts, and Pie Charts: "), "When linked selection is enabled, these types of visualizations display only those surveys which have
                       been selected either within a simultaneously displayed map or scatter plot, or from the 'Make Selection' table below. This allows users to quickly display time-series, 
                       pie charts, or bar charts based on selection from other visualizations."),
                    ),
                column(6,
                       column(12, align="center",
                      fluidRow(img(src="LinkedSelectionIcon.png",width="100%",style="display: inline-block;"))),
                       
                       ),
              ),
              column(12,
                     h4(strong("Patterns Across Metrics")),
                     h4("Users can view selected surveys across multiple visualizations simultaneously allowing users to quickly explore complex relationships among a variety of metrics."),
                      column(12, align="center",
                      fluidRow(img(src="ScatterLinked.png",width="75%",style="display: inline-block;")),
                      ),
                     h4(strong("Spatial Relationships")),
                     h4("Users can explore spatial relationships among metrics by selecting surveys within a scatter plot to see where they are located on the map or 
                        by selecting surveys on a map and seeing how surveys within the selected area compare to the entire input dataset."),
                     column(12, align="center",
                      fluidRow(img(src="Map_Scatter_MapSel.png",width="75%",style="display: inline-block;")),
                      ),
                     h4(strong("Summarize or Drill Down Across Features of Interest")),
                     h4("Users can quickly summarize portions of the dataset by creating pie charts based on data selected from scatter plots, maps, or the 'Make Selection' table. 
                        Users can also drill down to see more detailed information about surveys by linking selected data to bar charts and time-series (line) charts."),
                     column(12, align="center",
                      fluidRow(img(src="Map_Pie_Linked.png",width="75%",style="display: inline-block;")),
                      ),
                     column(12, align="center",
                      fluidRow(img(src="Scatter_Bar_Linked.png",width="75%",style="display: inline-block;")),
                      ),
                     h4(strong("Highlight Surveys of Interest Within the Context of the Full Dataset")),
                     h4("Users can quickly visualize the relative position of survey(s) of interest within the context of the input dataset by making selections within the 'Make 
                        Selections' table."),
                     column(12, align="center",
                      fluidRow(img(src="Table_Linked_Sel.png",width="75%",style="display: inline-block;")),
                      ),
                     ),
              column(12,
                column(3,
                       br(),
                       h3(strong("How to make and view selections")),
                       br(),
                       h4(strong("Table Selection")),
                       column(12, align="center",
                      fluidRow(img(src="TableSelect.png",width="60%",style="display: inline-block;"))),
                       ),
                column(3,
                       h4(strong("Map Selection")),
                       column(12, align="center",
                      fluidRow(img(src="MapSelect.png",width="60%",style="display: inline-block;"))),
                       ),
                column(3,
                      h4(strong("Plot Selection")),
                       column(12, align="center",
                      fluidRow(img(src="BoxSelect.png",width="60%",style="display: inline-block;"))),
                ),
                column(3,
                      h4(strong("View Selections")),
                       column(12, align="center",
                      fluidRow(img(src="ViewSelection.png",width="60%",style="display: inline-block;"))),
                ),
              ),
             ),
                column(12,
                h3(strong("Table Selection:")),
                column(6,
                  h4(strong("Step 1: "), "Click the 'Selection' tab associated with the visualization."),
                  h4(strong("Step 2: "), "Click the 'Make' button to view list of surveys displayed in the visualization."),
                  h4(strong("Step 3: "), "Click on desired surveys within table to highlight them in associated visualizations. 
                     To select multiple surveys hold 'Ctrl' to click on multiple surveys independently or 'Shift' to select the 
                     first and last survey of a range. Or use the buttons above the table to select or deselect all surveys or those 
                     currently displayed after in-table filters have been applied."),
                  h4(strong("Step 4: "), "Surveys may be unselected by clicking selected surveys to toggle them off, pressing the 
                       'Deselect all Filtered' button above the table to unselect all selected surveys from the currently displayed table (based on any applied filters), or the 
                       'Delsect all' button can be clicked to clear all selected surveys"),
                  h4(strong("Display: "), "For scatter plots and maps selected surveys will have 100% opacity in the associated visualization. 
                     For Line Plots, Bar Charts, and Pie Charts no change to the associated visualization will be made."),
                  h4(strong("Notice: "), "Due to software limitations the highlighted selections in the 'Make Selections' table will not 
                     be reset if selections are made or cleared within the visualizations themselves, however the 'View Selections' table will accurately 
                     reflect the currently selected surveys."),
                       ),
                column(6,
                       column(12, align="center",
                      fluidRow(img(src="TableSelectionExample.png",width="100%",style="display: inline-block;"))),
                       
                       ),
                ),
             column(12,
             h3(strong("Map Selection:")),
                h4(strong("Warning: "), "Selection near boundaries can be inconsistent, please verify that selected surveys match the desired extent (selection by state or county can also be accomplished using table)"),
                h4(strong("Step 1: "), "Choose method for making spatial selections"),
                h4(strong("Options Include: "), "Polygon, State, or County"),
             ),
             column(12,
             column(4,
                h4(strong("Polygons: ")),
                h4(strong("Step 2: "), "Click 'Draw' button to begin drawing on map"),
                h4(strong("Step 3: "), "Click on map to create polygon vertices"),
                h4(strong("Step 4: "), "Once desired polygon has been drawn click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="Map_Filter_Polygon.jpg",width="90%",style="display: inline-block;"),
             ),
             column(4,
                h4(strong("State: ")),
                h4(strong("Step 2: "), "Click 'Select' button to begin making selections"),
                h4(strong("Step 3: "), "Click on map within state boundaries to make selections (selected states will be highlighted)"),
                h4(strong("Step 4: "), "Once all desired states have been selected click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="StateSelection_MapSel.jpg",width="90%",style="display: inline-block;"),
             ),
             column(4,
                h4(strong("County: ")),
                h4(strong("Step 2: "), "Click 'Select' button to begin making selections"),
                h4(strong("Step 3: "), "Click on map within county boundaries to make selections (selected counties will be highlighted)"),
                h4(strong("Step 4: "), "Once all desired counties have been selected click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="CountySelection_MapSel.jpg",width="90%",style="display: inline-block;"),
                ), 
             ),
             column(12,
             h3(strong("Plot Selection:")),
              h4("Selections can be made within all plot types except pie charts. Selections made within bar charts and line charts do not alter the plots 
              appearance, but do add the selected surveys to the selected table so additional invormation can be viewed. Surveys selected within scatter plots 
              have 100% opacity, while unselected surveys are transparent (level of transparency can be adjusted by user in sidebar. Selections can be cleared 
                 by pressing the 'Clear Selection' button in the 'Settings' panel on the sidebar."),
                column(6,
                    h4(strong("Box Select")),
                    h4("Selections can be made by clicking the box select icon (visible by hovering near top of plot) and then clicking and dragging 
                       across the desired area. If no surveys are located within the area being selected the app will crash so be sure to include at least one survey."),
                    img(src="BoxSelect.png",width="90%",style="display: inline-block;"),
                       ),
                column(6,
                    h4(strong("Lasso Select")),
                    h4("Selections can be made by clicking the lasso select icon (visible by hovering near top of plot) and then clicking and dragging 
                       around the desired area. If no surveys are located within the area being selected the app will crash so be sure to include at least one survey."),
                    img(src="LassoSelect.png",width="90%",style="display: inline-block;"),
                       ),
             ),
             column(12,
             h3(strong("View Selections:")),
                column(6,
                    h4("A table containing only selected surveys can be found under the associated 'Selection' tab (below visualizations) when the 'View' button is selected."),
                    ),
                column(6,
                    img(src="ViewSelectionsExample.png",width="90%",style="display: inline-block;"),  
                       ),
                ),
                ),
    tabPanel("Visualization Types",value="VisData_VisTypes",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_VisData_VisTypes_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_VisTypes_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_VisTypes_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Overview of Available Visualization Types")),
             ),
             
            column(4,align="center",
                    actionButton("UG_VisType_Map","Maps", class = "btn-primary btn-md",width="90%"),
                    img(src="Map.jpg",width="90%",style="display: inline-block;"),       
             ),
            column(4,align="center",
                    actionButton("UG_VisType_Scatter","Scatter Plots", class = "btn-primary btn-md",width="90%"),
                    img(src="Scatter.jpg",width="90%",style="display: inline-block;"),
             ),
             column(4,align="center",
                    actionButton("UG_VisType_Line","Time Series", class = "btn-primary btn-md",width="90%"),
                    img(src="LinePlot.jpg",width="90%",style="display: inline-block;"),
             ),
            column(12,
                   br(),
                   br(),
                   ),
            column(2,),
             column(4,align="center",
                    actionButton("UG_VisType_Bar","Bar Charts", class = "btn-primary btn-md",width="90%"),
                    img(src="BarChart.jpg",width="90%",style="display: inline-block;"),
             ),
             column(4,align="center",
                    actionButton("UG_VisType_Pie","Pie Charts", class = "btn-primary btn-md",width="90%"),
                    img(src="PieChart.jpg",width="90%",style="display: inline-block;"),
             ),
            column(2,),
            
    ),
    tabPanel("Maps",value="VisData_Map",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Map_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Map_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Map_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                     ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Creating Maps Based on Creel Survey Data")),
                    br(),
                    img(src="Map_Options_Thumb.png",width="40%",style="display: inline-block;"),
                    br(),
             ),
             column(12,
                    h3("Maps can be created to visualize information contained within the CreelCat database. Markers can be used to reflect numeric fields 
                       contained within the CreelCat database based on color or size. Surveys can be selected to visually highlight surveys of interest,
                       view additional fields within an associated table, or link with other visualizations. In addition to styling individual markers and making selections, 
                       users can select various basemaps, make measurements or perform survey geolocation, and export custom maps."),
                    br(),
             ),
             column(12,
                  column(4, 
                      h3(strong("Select Input Data")),
                    img(src="SelInputData.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4, 
                      h3(strong("Creel Data Display")),
                    img(src="MapCreelFieldSelect.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4, 
                      h3(strong("Data Selection")),
                    img(src="MapSelection.png",width="90%",style="display: inline-block;"),
                  ),
             ),
             column(12,
                  column(4, 
                      h3(strong("Labels and Legend")),
                    img(src="MapLegendLabels.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4, 
                      h3(strong("Map Navigation")),
                    img(src="Map_Zoom_Icon.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4,
                      h3(strong("Map Options")),
                    img(src="Map_Options_Thumb.png",width="90%",style="display: inline-block;"),
                  ),
               ),
             column(12,br(),),
             column(12,
                column(7,
                    h3(strong("Selection of Input Data: ")), 
                    h4("Input data for visualizations are located in tables below the visualizations. Select those 
                       surveys you wish to include in your map either by clicking desired surveys (for multiple use Ctrl/Shift selection, or use the 'Select All'/'Select All Filtered' 
                       buttons located above the table. Any surveys which contain a NULL value for fields used to create the visualization will be dropped (A list of dropped fields can 
                       be located in the associated 'Data Warnings' panel located above the visualization."),
                    ),
                column(5,
                       img(src="SelInputData.png",width="90%",style="display: inline-block;"),
                       ),
             ),
             column(12,br(),),
             column(12,
                column(7,
                    h3(strong("Consider Data Warnings: ")), 
                    h4("The data contained in CreelCat is not homogenous and therefore care should be taken to consider differences among surveys when making 
                       any types of comparisons. Some relevant warnings about discrepancies in input data are displayed in the 'Warnings for Input Data' panel located above the visualizations. 
                       This panel can be clicked to expand/minimize. Although we have listed several of the major potential discrepancies care should be taken by the user to ascertain 
                       whether input data being used for visualizations is valid for any comparisons being made."),
                    h4(strong("Warnings include:")),
                    column(12,
                           h4(strong("Duration Range: "), "Number of days surveys are representative of."),
                           h4(strong("Start Dates: "), "Range of months surveys began."),
                           h4(strong("Conclusion Dates: "), "Range of months surveys concluded."),
                           h4(strong("Survey Types: "), "Which types of surveys are included in the input data."),
                           h4(strong("Survey Protocols: "), "Which survey protocols were utilized for the surveys included in input data"),
                           h4(strong("Focal Species: "), "What species were targetted in the input surveys."),
                           h4(strong("Waterbody Types: "), "Which waterbody types were included in the input data."),
                           h4(strong("NA Dropped Surveys: "), "How many of the selected input surveys were dropped from the visualization due to the presence of NA values 
                              for input fields (See tables below to view which surveys were dropped and which were retained."),
                           h4(strong("Unattributed Taxa: "), "See which surveys contained unattributed taxa. Unattributed taxa records are surveys which contain taxa which were attributed 
                           at a higher taxonomic level than the user is viewing which therefore can not be attibuted. For example a survey may have quantified harvest at the 
                           genus level (ie. Crappie) while the user may wish to view data at the species level (ie. Black or White Crappie). In this case the values associated 
                           with genus level observations can not be attributed to species. Because of this values can't be attributed for the desired taxa for those surveys. In these 
                           cases we recommend either removing those surveys from consideration or making evaluations at a higher taxonomic level (ie. 'Crappie' instead of 'White Crappie' and/or 
                           'Black Crappie'. Surveys containing unattributed taxa records can be viewed in the table below."),
                           h4(strong("Partially Attributed Taxa: "), "See which surveys contained partially attributed taxa. Partially attributed taxa records are surveys which contain taxa which were attributed 
                           at a multiple taxonomic levels within a single survey (ie. 'Crappie' (Genus) and 'Black Crappie'(Species)). In these cases selecting the higher taxonomic level 
                              (ie. 'Crappie' (Genus)), will resolve the issue as the lower taxonomic level records (ie. 'Black Crappie' (Species)) will be added to the higher taxonomic records, 
                              however use of the lower taxonomic level will result in the potential unattribution of records (ie. 'Crappie' records which may or may not have been 'Black Crappie' will not 
                              be attributed) causing potential underestimation of selected metrics for those taxa. To resolve this issue we recommend removing surveys containing partially attributed taxa or 
                              selecting the higher taxonomic level (ie. Genus instead of Species). Surveys containing partially attributed taxa can be viewed in the table below."),
                         ),
                    ),
                column(5,
                       br(),
                       img(src="DataWarning.png",width="90%",style="display: inline-block;"),
                       ),
             ),
             column(12,br(),),
             column(12,
                    h3(strong("Creel Data Display: ")), 
                    h4("Fields containing numeric values can be displayed on the map based on marker color or size."),
                    column(12,align="center",
                    img(src="Map_ColorSize.png",width="75%",style="display: inline-block;"),
                    ),
                    column(12,
                    h4(strong("Marker Options: "),"Select either 'Scaled Color', 'Scaled Size', or 'Both'  to determine how you wish to display creel data on the map."),
                    column(12,
                        h4(strong("Scaled Color: ")),
                        column(12,
                        h4("Select Field: From the 'Select Color Field' picker choose which numeric field you wish to base the marker color on."),
                        h4("Select Color Palette: From the 'Select Color Palette' picker choose a desired palette, default is 'Spectral'."),
                        h4("Palette Direction: Toggle button to switch the direction of the palette (ie. from red->purple to purple->red)"),
                        h4("Values or Percentiles: Toggle whether you want the colors to be based on the input values or based on the percent rank of a given survey."),
                        h4("Size Settings: Under the 'Size Settings' panel the slider for marker size can be moved to alter the size of the markers."),
                        ),
                    h4(strong("Scaled Size: ")),
                    column(12,
                        h4("Select Size Field: From the 'Select Size Field' picker choose which numeric field you wish to base the size of markers on."),
                        h4("Marker Size: Adjust the minimum and maximum values for marker size by adjusting the left and right buttons on the 'Marker Size' slider."),
                        h4("Values or Percentiles: Toggle whether you want marker size to be based on the input values or based on the percent rank of a given survey."),
                        h4("Color Settings: Under the 'Color Settings' panel use the 'Select Color' button to choose the desired color for markers."),
                    ),
                    h4(strong("Both: ")),
                    column(12,
                        h4("Displays data based on creel inputs for color and size."),
                    ),
                    ),
                    h4(strong("Display Data on Map: "), "In order to view the markers on the map this button needs to be clicked. It is displayed in the sidebar within the 'Creel Data' panel."),
                    h4(strong("Important Note: "), "Surveys which are attributed to the same waterbody may be hidden due to overlap (multiple markers in same position). A jitter was applied to allow surveys of the same waterbody to be seprated, 
                       but this seperation is only visible when zoomed in closely. The draw order for surveys is based on the order of surveys within the input table."),
                    br(),
                       ),
              ),
             column(12,br(),),
             column(12,
                    h3(strong("Select Markers: ")), 
                    h4("Markers displayed on the map can be selected by drawing a polygon, clicking states or counties, or selecting surveys from a table. 
                       Surveys which have been selected will be displayed with 100% opacity, while surveys which have not been selected will have an adjustable level 
                       of transparency. Full details of selected surveys can be viewed in the 'Selected' table below the map."),
              column(12,align="center",
                    img(src="MapSelection.png",width="50%",style="display: inline-block;"),
              ),
                  column(12,
                    h4(strong("Selection Types: "),"Polygon, States, Counties, and Table"),
                    column(4,
                h4(strong("Polygons: ")),
                h4(strong("Step 1: "), "From 'Selection' panel on sidebar select 'Polygon'"),
                h4(strong("Step 2: "), "Click 'Draw' button to begin drawing on map"),
                h4(strong("Step 3: "), "Click on map to create polygon vertices"),
                h4(strong("Step 4: "), "Once desired polygon has been drawn click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="Map_Filter_Polygon.jpg",width="90%",style="display: inline-block;"),
             ),
             column(4,
                h4(strong("State: ")),
                h4(strong("Step 1: "), "From 'Selection' panel on sidebar select 'State'"),
                h4(strong("Step 2: "), "Click 'Select' button to begin making selections"),
                h4(strong("Step 3: "), "Click on map within state boundaries to make selections (selected states will be highlighted)"),
                h4(strong("Step 4: "), "Once all desired states have been selected click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="StateSelection_MapSel.jpg",width="90%",style="display: inline-block;"),
             ),
             column(4,
                h4(strong("County: ")),
                h4(strong("Step 1: "), "From 'Selection' panel on sidebar select 'County'"),
                h4(strong("Step 2: "), "Click 'Select' button to begin making selections"),
                h4(strong("Step 3: "), "Click on map within county boundaries to make selections (selected counties will be highlighted)"),
                h4(strong("Step 4: "), "Once all desired counties have been selected click 'Complete' to finalize selection"),
                h4(strong("Step 5: "), "Procede to using the app with selected data"),
                h4(strong("Step 6: "), "Changes to the selection can be made by clicking the 'Clear' button and then either drawing a new polygon or using a different method for survey selection"),
                img(src="CountySelection_MapSel.jpg",width="90%",style="display: inline-block;"),
                ), 
             column(6,
                  h4(strong("Table: ")),
                  h4(strong("Step 1: "), "Click the 'Selection' tab associated with the visualization."),
                  h4(strong("Step 2: "), "Click the 'Make' button to view list of surveys displayed in the visualization."),
                  h4(strong("Step 3: "), "Click on desired surveys within table to highlight them in associated visualizations. 
                     To select multiple surveys hold 'Ctrl' to click on multiple surveys independently or 'Shift' to select the 
                     first and last survey of a range. Or use the buttons above the table to select or deselect all surveys or those 
                     currently displayed after in-table filters have been applied."),
                  h4(strong("Step 4: "), "Surveys may be unselected by clicking selected surveys to toggle them off, pressing the 
                       'Deselect all Filtered' button above the table to unselect all selected surveys from the currently displayed table (based on any applied filters), or the 
                       'Delsect all' button can be clicked to clear all selected surveys"),
                  h4(strong("Display: "), "Selected surveys will have 100% opacity in the associated visualization."),
                  h4(strong("Notice: "), "Due to software limitations the highlighted selections in the 'Make Selections' table will not 
                     be reset if selections are made or cleared within the visualizations themselves, however the 'View Selections' table will accurately 
                     reflect the currently selected surveys."),
                       ),
                column(6,
                       column(12, align="center",
                      fluidRow(img(src="MapTableSelect.png",width="100%",style="display: inline-block;"))),
                       ),
                    ),
             ),
             column(12,br(),),
             column(12,
                  column(7,
                    h3(strong("Labels and Legend: ")), 
                    h4("Allows users to create a custom label to be displayed on the map, and to toggle on and off both the label and legend."),
                    column(12,
                    h4(strong("Add Legend: "),"Toggle legend on and off"),
                    h4(strong("Add Custom Label: "),"Toggle a custom label on and off, when 'Yes' is selected text may be enterred in the box below to display on the map."),
                    ),
                  ),
                  column(5,
                      br(),
                      img(src="MapLegendLabels.png",width="90%",style="display: inline-block;"),   
                         ),
             ),
             column(12,br(),),
             column(12,
                  column(7,
                    h3(strong("Map Navigation: ")), 
                    h4("Allows users to quickly zoom to the extent of displayed data or a specific state and/or county."),
                  column(12,
                    h4(strong("Zoom to: "), "Select whether you wish to zoom to the extent of the input creel data or a selected geography."),
                    h4(strong("Zoom to Creel Extent: "),"Click button to zoom to the extent of the input creel data."),
                    h4(strong("Zoom to Selected Geography: "),"Click button to zoom to the geographical extent specified above. Desired state must be specified in 
                       the 'Select State Zoom' box. In the 'Select County Zoom' input a selection of 'Statewide' will zoom to the full state, if a county is specified 
                       the visible extent will correspond with the selected county."),
                    ),
                  ),
                  column(5,
                         br(),
                        img(src="Map_Zoom_Icon.png",width="90%",style="display: inline-block;"), 
                         ),
             ),
             column(12,br(),),
             column(12,
                  column(7,
                    h3(strong("Map Options: ")), 
                    h4("Several additional features exist for interacting with the map."),
                    column(12,
                    h4(strong("Base Layers: "), "By clicking the 'Layers' icon in the top right corner users can toggle among basemaps ('Dark', 'Light', 
                    'Imagery/Topo Hybrid', 'Topo', 'Imagery', 'Shaded Relief'), and turn on and off several layers ('Creel Data', 'State Boundaries', 
                       'County Boundaries', 'Hydrography')."),
                    h4(strong("Measure Tool: "), "By clicking the ''Layers'Measure' icon in the top right corner users can measure linear distances, calculate 
                       polygon areas, retrieve coordinates for a point, and zoom to a specified area."),
                    h4(strong("Zoom: "), "By clicking the '+' or '-' icons in the top left corner users can zoom in or out on the map, the same can be accomplished 
                       by scrolling with a mouse. Clicking the 'Globe' icon zooms out to the full United States, while clicking the 'Crosshairs' icon will zoom to a users 
                       location."),
                    h4(strong("Save Map: "),  "The 'Download' icon located in the top left corner will allow a user to save the current map either as the current size, 
                       portrait, or landscape."),
                    h4(strong("Mini Map: "),  "The 'Arrow' icon in the lower left hand corner will toggle the display of a mini map which displays the spatial context of 
                       the current level of zoom."),
                    h4(strong("Hover: "), "By hovering over a survey marker users can view information including the associated color and size values, waterbody name, 
                      survey year, and Survey_ID.")
                    ),
                  ),
                  column(5,
                    br(),
                    img(src="Map_Options_Thumb.png",width="90%",style="display: inline-block;"),
                    ),
             ),
             column(12,br(),),
    ),
    tabPanel("Scatter Plots",value="VisData_Scatter",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Scatter_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Scatter_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Scatter_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                     ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Creating Scatter Plots Based on Creel Survey Data")),
                    br(),
                    fluidRow(img(src="ScatterExample.png",width="40%",style="display: inline-block;")),
                    br(),
             ),
             column(12,
                    h3("Scatter plots can be created in order to compare any two numeric fields from any surveys contained within the CreelCat database. 
                       Additional options include custom marker styling, selection of data, addition of trendlines, modifying labels and the legend, and more."),
                    br(),
             ),
             column(12,
                  column(4, 
                      h3(strong("Select Inputs")),
                    img(src="ScatterXY.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4, 
                      h3(strong("Marker Style")),
                    img(src="ScatterMarkerStyle.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4, 
                      h3(strong("Selection")),
                    img(src="ScatterSelectionExample.png",width="90%",style="display: inline-block;"),
                  ),
             ),
             column(12,
                  column(4, 
                      h3(strong("Trendlines")),
                    img(src="ScatterTrendExample.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4, 
                      h3(strong("Labels and Legend")),
                    img(src="ScatterLegendLabels.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4,
                      h3(strong("Scatter Plot Options")),
                    img(src="ScatterOptions.png",width="90%",style="display: inline-block;"),
                  ),
               ),
             column(12,br(),),
             column(12,
                column(7,
                    h3(strong("Data Inputs: ")), 
                    column(12,
                    h4(strong("Select Surveys: ")),
                    h4("Input data for visualizations are located in tables below the visualizations. Select those 
                       surveys you wish to include in your scatter plot either by clicking desired surveys (for multiple 
                       use Ctrl/Shift selection, or use the 'Select All'/'Select All Filtered' 
                       buttons located above the table. Any surveys which contain a NULL value for fields 
                       used to create the visualization will be dropped (A list of dropped fields can 
                       be located in the associated 'Data Warnings' panel located above the visualization."),
                    h4(strong("Select X and Y Variables: ")),
                    h4("Variables to use for X and Y coordinates can be selected from the 'Data Inputs' panel within the 
                       associated visualization panel. Any numeric field within the user created input dataset is eligible for use.")
                    ),
                    ),
                column(5,
                       br(),
                       img(src="ScatterXY.png",width="90%",style="display: inline-block;"),
                       ),
             ),
             column(12,br(),),
             column(12,
                column(7,
                    h3(strong("Consider Data Warnings: ")), 
                    h4("The data contained in CreelCat is not homogenous and therefore care should be taken to consider differences among surveys when making 
                       any types of comparisons. Some relevant warnings about discrepancies in input data are displayed in the 'Warnings for Input Data' panel located above the visualizations. 
                       This panel can be clicked to expand/minimize. Although we have listed several of the major potential discrepancies care should be taken by the user to ascertain 
                       whether input data being used for visualizations is valid for any comparisons being made."),
                    h4(strong("Warnings include:")),
                    column(12,
                           h4(strong("Duration Range: "), "Number of days surveys are representative of."),
                           h4(strong("Start Dates: "), "Range of months surveys began."),
                           h4(strong("Conclusion Dates: "), "Range of months surveys concluded."),
                           h4(strong("Survey Types: "), "Which types of surveys are included in the input data."),
                           h4(strong("Survey Protocols: "), "Which survey protocols were utilized for the surveys included in input data"),
                           h4(strong("Focal Species: "), "What species were targetted in the input surveys."),
                           h4(strong("Waterbody Types: "), "Which waterbody types were included in the input data."),
                           h4(strong("NA Dropped Surveys: "), "How many of the selected input surveys were dropped from the visualization due to the presence of NA values 
                              for input fields (See tables below to view which surveys were dropped and which were retained."),
                           h4(strong("Unattributed Taxa: "), "See which surveys contained unattributed taxa. Unattributed taxa records are surveys which contain taxa which were attributed 
                           at a higher taxonomic level than the user is viewing which therefore can not be attibuted. For example a survey may have quantified harvest at the 
                           genus level (ie. Crappie) while the user may wish to view data at the species level (ie. Black or White Crappie). In this case the values associated 
                           with genus level observations can not be attributed to species. Because of this values can't be attributed for the desired taxa for those surveys. In these 
                           cases we recommend either removing those surveys from consideration or making evaluations at a higher taxonomic level (ie. 'Crappie' instead of 'White Crappie' and/or 
                           'Black Crappie'. Surveys containing unattributed taxa records can be viewed in the table below."),
                           h4(strong("Partially Attributed Taxa: "), "See which surveys contained partially attributed taxa. Partially attributed taxa records are surveys which contain taxa which were attributed 
                           at a multiple taxonomic levels within a single survey (ie. 'Crappie' (Genus) and 'Black Crappie'(Species)). In these cases selecting the higher taxonomic level 
                              (ie. 'Crappie' (Genus)), will resolve the issue as the lower taxonomic level records (ie. 'Black Crappie' (Species)) will be added to the higher taxonomic records, 
                              however use of the lower taxonomic level will result in the potential unattribution of records (ie. 'Crappie' records which may or may not have been 'Black Crappie' will not 
                              be attributed) causing potential underestimation of selected metrics for those taxa. To resolve this issue we recommend removing surveys containing partially attributed taxa or 
                              selecting the higher taxonomic level (ie. Genus instead of Species). Surveys containing partially attributed taxa can be viewed in the table below."),
                         ),
                    ),
                column(5,
                       br(),
                       img(src="DataWarning.png",width="90%",style="display: inline-block;"),
                       ),
             ),
             column(12,br(),),
             column(12,
                  column(7,
                    h3(strong("Marker Style: ")),
                  column(12,
                    h4(strong("Marker Color Options")),
                    h4(strong("Color Scale: "),"Uniform, Numeric, or Factors"),
                    h4(strong("Uniform: "), "All markers have the same color. User can specify desired color from 'Marker Color' panel on sidebar."),
                    h4(strong("Numeric: "), "Markers are colored based on a numeric field selected by user from sidebar. Default palette is 'Rainbow' but 
                       user may specify an alternative palette via an input on sidebar and may also change the palette direction."),
                    h4(strong("Factors: "), "Markers are colored based on a factor field (default is 'State') selected by user from sidebar. Default palette is 'Spectral' 
                       but user may specify an alternative palette via an input on sidebar and may also change the palette direction."),
                  ),
                  column(12,
                    h4(strong("Marker Size Options")),
                    h4(strong("Uniform: "), "All markers have the same size. User can specify desired size by adjusting the slider in the 'Marker Size' panel on the sidebar."),
                    h4(strong("Scaled: "), "Marker size based on a user-selected numeric field from sidebar picker. The range of marker sizes can then be adjusted by moving 
                       the buttons on the 'Marker Size' slider."),
                  ),
                  ),
                  column(5,
                         br(),
                    img(src="ScatterMarkerStyle2.png",width="90%",style="display: inline-block;"),
                         ),
              ),
             column(12,br(),),
             column(12,
                  column(7,
                    h3(strong("Selection: ")),
                    h4("Surveys displayed in a scatter plot can be selected in the plot (Box and Lasso methods) or by selecting surveys within an associated table. 
                       Selected surveys will be displayed with 100% opacity, while unselected surveys will be semi-transparent (user may adjust the level of 
                       transparency in sidebar). Selected surveys can be viewed by clicking on the associated 'Selection' tab below visualizations."),
                  column(12,
                    h4(strong("Box Select: "), "Plot options can be seen by hovering over the top-left corner of the plot. By clicking on the 'Box Select' 
                       icon the user activates the selection and can then click and drag over the desired area to make the selection. ",strong("Warning: If no markers are 
                        within the selection bounds the app will crash."), "To clear a selection please click the 'Clear Selection' icon in the panel for the associated visualization 
                        (or if linked selection is being used do so from the 'Settings' panel."),
                    h4(strong("Lasso Select: "), "Plot options can be seen by hovering over the top-left corner of the plot. By clicking on the 'Lasso Select' 
                       icon the user activates the selection and can then click and hold to trace the desired selection area. When the click is released 
                       the selection will be finalized. ",strong("Warning: If no markers are within the selection bounds the app will crash."), "To clear a selection please 
                       click the 'Clear Selection' icon in the panel for the associated visualization 
                        (or if linked selection is being used do so from the 'Settings' panel."),
                    h4(strong("Table Select: "), "Selections can also be made by selecting surveys within the 'Make Selections' table (which can be accessed under 
                       the associated 'Selections' tab below visualizations and clicking on the 'Make' button). Individual surveys can be selected by clicking on the 
                       desired row. If the user wishes to select multiple rows they can do so either by pressing the 'Ctrl' (click multiple) or 'Shift' (select range) keys on the 
                       keyboard, or by pressing the 'Select All' or 'Select All Filtered' buttons above the table."),
                  h4(strong("Notice: "), "Due to software limitations the highlighted selections in the 'Make Selections' table will not
                     be reset if selections are made or cleared within the visualizations themselves, however the 'View Selections' table will accurately
                     reflect the currently selected surveys."),
                    ),
                ),
                  column(5,
                         br(),
                    img(src="ScatterSelExample2.png",width="90%",style="display: inline-block;"),
                         ),
                    ),
             column(12,br(),),
             column(12,
                    column(7,                    
                      h3(strong("Trendline: ")), 
                       h4("Users can add trendlines to the scatter plot based on linear regressions of the entire input dataset as well as surveys selected 
                       within the visualization. The slope, intercept, and r-squred value for each regression is displayed on the plot if the 'Toggle Legend and Text' 
                       button is set to 'Display' within the associated 'Labels and Legend' sidebar panel."),
                     column(12,
                        h4(strong("Add Trendline: "), "When set to 'Yes' the trendline(s) will be displayed, when 'No' they will be hidden."),
                        h4(strong("Color: "), "Allows user to specify desired trendline color from a picker."),
                        h4(strong("Width: "), "Allows user to adjust trendline width via a slider."),
                    ),
                   ),
             column(5,
                    br(),
                    img(src="ScatterTrendExample.png",width="90%",style="display: inline-block;"),
                    ),
                    ),
             column(12,br(),),
             column(12,
                  column(7,
                    h3(strong("Labels and Legend: ")), 
                    h4("User may modify the appearance of labels and the legend of a scatterplot via the 'Labels and Legend' panel of the associated visualization from the sidebar."),
                    column(12,
                    h4(strong("Toggle Legend and Text: "),"Toggle legend and trendline text on and off"),
                    h4(strong("Title: "),"Enter text in this box to create a custom title for plot"),
                    h4(strong("X Label: "),"Enter text in this box to create a custom label for the x axis."),
                    h4(strong("Y Label: "),"Enter text in this box to create a custom label for the y axis."),
                    ),
                  ),
                    column(5,
                           br(),
                    img(src="ScatterLegendLabels.png",width="90%",style="display: inline-block;"),
                      ),
                    ),
             column(12,br(),),
             column(12,
                    column(7,
                    h3(strong("Scatter Plot Options: ")), 
                    h4("By hovering over the top right portion of a scatter plot various options become available for user interaction with the plot."),
                    column(12,
                    h4(strong("Download: "), "Click the 'Camera' icon to download a .png image of your scatter plot."),
                    h4(strong("Zoom: "), "Click the 'Magnifying Glass' icon to zoom in to a specific area. If you wish to set specific ranges for the axes you 
                       can use the 'Zoom Out' button (described below) to zoom out beyond the desired range and then use the 'Zoom' button to scale the axes to 
                       your requirements."),
                    h4(strong("Pan: "),  "Click the 'Pan' icon to enable panning of the plot via clicking and dragging."),
                    h4(strong("Box Select: "),  "Select markers by dragging a rectangle across the plot area (Vertical and Horizontal dragging will allow for full length/width 
                       coverage). ",strong("Warning: If no markers are within the selection bounds the app will crash.")),
                    h4(strong("Lasso Select: "),  "Select markers by dragging the cursor around the desired the plot area (Click and hold on plot to begin, release to complete 
                       selection). ",strong("Warning: If no markers are within the selection bounds the app will crash.")),
                    h4(strong("Zoom In: "),  "Click the '+' icon to zoom in on the plot."),
                    h4(strong("Zoom Out: "),  "Click the '-' icon to zoom out on the plot."),
                    h4(strong("Autoscale: "),  "Click the 'Autoscale' icon to fit all markers into the plot area."),
                    h4(strong("Reset Axes: "),  "Click the 'Home' icon to fit all markers into the plot area."),
                    h4(strong("Show Closest Data: "),  "Toggle the 'Single Arrow' icon (default) to view the x and y coordinates, state, year, 
                       waterbody name, and Survey_ID of the nearest marker when hovering."),
                    h4(strong("Compare Data: "),  "Toggle the 'Double Arrow' icon to view the x and y coordinates, state, year, 
                       waterbody name, and Survey_ID of multiple sharing the same (or nearly the same) x values."),
                    ),
                    ),
                    column(5,
                           br(),
                    img(src="ScatterOptions.png",width="90%",style="display: inline-block;"),
                           ),
                    ),
             column(12,br(),),
    ),
    tabPanel("Time Series Plots",value="VisData_TimeSeries",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_VisData_TimeSeries_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_TimeSeries_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_TimeSeries_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                      ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Creating Time Series (Line) Plots Based on Creel Survey Data")),
                    br(),
                    fluidRow(img(src="LineExample.png",width="40%",style="display: inline-block;")),
                    br(),
             ),
             column(12,
                    h3("Time Series (Line) Plots can be created in order to patterns in up to five numeric fields across years by waterbody from any surveys contained within the CreelCat database. 
                       Additional options include custom line and marker styling, selection of data, modifying labels and the legend, and more."),
                    br(),
             ),
             column(12,
                  column(4, 
                      h3(strong("Select Inputs")),
                    img(src="LineInputs.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4, 
                      h3(strong("Line and Marker Style")),
                    img(src="LineMarkerStyle.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4, 
                      h3(strong("Selection")),
                    img(src="LineSelection.png",width="90%",style="display: inline-block;"),
                  ),
             ),
             column(12,
                  column(2,
                  ),
                  column(4, 
                      h3(strong("Labels and Legend")),
                    img(src="LineLegendLabels.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4,
                      h3(strong("Scatter Plot Options")),
                    img(src="LineOptions.png",width="90%",style="display: inline-block;"),
                  ),
                  column(2,
                  ),
               ),
             column(12,br(),),
             column(12,
                column(7,
                    h3(strong("Data Inputs: ")), 
                    column(12,
                    h4(strong("Select Surveys: ")),
                    h4("Input data for visualizations are located in tables below the visualizations. Select those 
                       surveys you wish to include in your time-series (line) plot either by clicking desired surveys (for multiple 
                       use Ctrl/Shift selection, or use the 'Select All'/'Select All Filtered' 
                       buttons located above the table. Any surveys which contain a NULL value for fields 
                       used to create the visualization will be dropped (A list of dropped fields can 
                       be located in the associated 'Data Warnings' panel located above the visualization."),
                    h4(strong("Select Number of Variables: ")),
                    h4("Select how many variables you wish to include in the line plot."),
                    h4(strong("Select Variables: ")),
                    h4("Select numeric fields from inputs for each desired variable."),
                    ),
                    ),
                column(5,
                       br(),
                       img(src="LineInput.png",width="90%",style="display: inline-block;"),
                       ),
             ),
             column(12,br(),),
             column(12,
                column(7,
                    h3(strong("Consider Data Warnings: ")), 
                    h4("The data contained in CreelCat is not homogenous and therefore care should be taken to consider differences among surveys when making 
                       any types of comparisons. Some relevant warnings about discrepancies in input data are displayed in the 'Warnings for Input Data' panel located above the visualizations. 
                       This panel can be clicked to expand/minimize. Although we have listed several of the major potential discrepancies care should be taken by the user to ascertain 
                       whether input data being used for visualizations is valid for any comparisons being made."),
                    h4(strong("Warnings include:")),
                    column(12,
                           h4(strong("Duration Range: "), "Number of days surveys are representative of."),
                           h4(strong("Start Dates: "), "Range of months surveys began."),
                           h4(strong("Conclusion Dates: "), "Range of months surveys concluded."),
                           h4(strong("Survey Types: "), "Which types of surveys are included in the input data."),
                           h4(strong("Survey Protocols: "), "Which survey protocols were utilized for the surveys included in input data"),
                           h4(strong("Focal Species: "), "What species were targetted in the input surveys."),
                           h4(strong("Waterbody Types: "), "Which waterbody types were included in the input data."),
                           h4(strong("NA Dropped Surveys: "), "How many of the selected input surveys were dropped from the visualization due to the presence of NA values 
                              for input fields (See tables below to view which surveys were dropped and which were retained."),
                           h4(strong("Unattributed Taxa: "), "See which surveys contained unattributed taxa. Unattributed taxa records are surveys which contain taxa which were attributed 
                           at a higher taxonomic level than the user is viewing which therefore can not be attibuted. For example a survey may have quantified harvest at the 
                           genus level (ie. Crappie) while the user may wish to view data at the species level (ie. Black or White Crappie). In this case the values associated 
                           with genus level observations can not be attributed to species. Because of this values can't be attributed for the desired taxa for those surveys. In these 
                           cases we recommend either removing those surveys from consideration or making evaluations at a higher taxonomic level (ie. 'Crappie' instead of 'White Crappie' and/or 
                           'Black Crappie'. Surveys containing unattributed taxa records can be viewed in the table below."),
                           h4(strong("Partially Attributed Taxa: "), "See which surveys contained partially attributed taxa. Partially attributed taxa records are surveys which contain taxa which were attributed 
                           at a multiple taxonomic levels within a single survey (ie. 'Crappie' (Genus) and 'Black Crappie'(Species)). In these cases selecting the higher taxonomic level 
                              (ie. 'Crappie' (Genus)), will resolve the issue as the lower taxonomic level records (ie. 'Black Crappie' (Species)) will be added to the higher taxonomic records, 
                              however use of the lower taxonomic level will result in the potential unattribution of records (ie. 'Crappie' records which may or may not have been 'Black Crappie' will not 
                              be attributed) causing potential underestimation of selected metrics for those taxa. To resolve this issue we recommend removing surveys containing partially attributed taxa or 
                              selecting the higher taxonomic level (ie. Genus instead of Species). Surveys containing partially attributed taxa can be viewed in the table below."),
                         ),
                    ),
                column(5,
                       br(),
                       img(src="DataWarning.png",width="90%",style="display: inline-block;"),
                       ),
             ),
             column(12,br(),),
             column(12,
                  column(7,
                    h3(strong("Line and Marker Style: ")),
                  column(12,
                    h4(strong("Line Color: "), "Select a color palette to apply across input waterbodies (each waterbody will be assigned a unique color based on the selected palette."),
                    h4(strong("Line Width: "),"Move slider to adjust the width of each line."),
                    h4(strong("Select Line Style: "), "Select desired line style (Solid, Dash, Dot, etc.) for each of the selected Y variables."),
                    h4(strong("Point size: "), "Select desired size for each of the point markers on the plot."),
                    h4(strong("Point Color: "), "Select desired color for each of the point markers on the plot."),
                   ),
                  ),
                  column(5,
                         br(),
                    img(src="LineMarkerStyle.png",width="90%",style="display: inline-block;"),
                         ),
              ),
             column(12,br(),),
             column(12,
                  column(7,
                    h3(strong("Selection: ")),
                    h4("Surveys displayed in a line plot can be selected in the plot (Box and Lasso methods). Selection via the associated table method is only 
                    valid for maps and scatter plots. Selected surveys will be displayed with 100% opacity, while unselected surveys will be hidden. Selected surveys can be 
                       viewed by clicking on the associated 'Selection' tab below visualizations."),
                  column(12,
                    h4(strong("Box Select: "), "Plot options can be seen by hovering over the top-left corner of the plot. By clicking on the 'Box Select' 
                       icon the user activates the selection and can then click and drag over the desired area to make the selection. ",strong("Warning: If no markers are 
                        within the selection bounds the app will crash."), "To clear a selection please click the 'Clear Selection' icon in the panel for the associated visualization 
                        (or if linked selection is being used do so from the 'Settings' panel."),
                    h4(strong("Lasso Select: "), "Plot options can be seen by hovering over the top-left corner of the plot. By clicking on the 'Lasso Select' 
                       icon the user activates the selection and can then click and hold to trace the desired selection area. When the click is released 
                       the selection will be finalized. ",strong("Warning: If no markers are within the selection bounds the app will crash."), "To clear a selection please 
                       click the 'Clear Selection' icon in the panel for the associated visualization 
                        (or if linked selection is being used do so from the 'Settings' panel."),
                   ),
                ),
                  column(5,
                         br(),
                    img(src="LineSelection.png",width="90%",style="display: inline-block;"),
                         ),
                    ),
             column(12,br(),),
             column(12,
                  column(7,
                    h3(strong("Labels and Legend: ")), 
                    h4("User may modify the appearance of labels and the legend of a scatterplot via the 'Labels' and 'Legend' panels of the associated visualization from the sidebar."),
                    column(12,
                    h4(strong("Toggle Legend: "),"Toggle legend display on and off"),
                    h4(strong("Legend X Position: "),"Moves the position of the legend left and right via slider."),
                    h4(strong("Legend Y Position: "),"Moves the position of the legend up and down via slider."),
                    h4(strong("Title: "),"Enter text in this box to create a custom title for plot"),
                    h4(strong("X Label: "),"Enter text in this box to create a custom label for the x axis."),
                    h4(strong("Y Label: "),"Enter text in this box to create a custom label for the y axis."),
                    ),
                  ),
                    column(5,
                           br(),
                    img(src="LineLegendLabels.png",width="90%",style="display: inline-block;"),
                      ),
                    ),
             column(12,br(),),
             column(12,
                    column(7,
                    h3(strong("Time-series (Line) Plot Options: ")), 
                    h4("By hovering over the top right portion of a line plot various options become available for user interaction with the plot."),
                    column(12,
                    h4(strong("Download: "), "Click the 'Camera' icon to download a .png image of your line plot."),
                    h4(strong("Zoom: "), "Click the 'Magnifying Glass' icon to zoom in to a specific area. If you wish to set specific ranges for the axes you 
                       can use the 'Zoom Out' button (described below) to zoom out beyond the desired range and then use the 'Zoom' button to scale the axes to 
                       your requirements."),
                    h4(strong("Pan: "),  "Click the 'Pan' icon to enable panning of the plot via clicking and dragging."),
                    h4(strong("Box Select: "),  "Select markers by dragging a rectangle across the plot area (Vertical and Horizontal dragging will allow for full length/width 
                       coverage). ",strong("Warning: If no markers are within the selection bounds the app will crash.")),
                    h4(strong("Lasso Select: "),  "Select markers by dragging the cursor around the desired the plot area (Click and hold on plot to begin, release to complete 
                       selection). ",strong("Warning: If no markers are within the selection bounds the app will crash.")),
                    h4(strong("Zoom In: "),  "Click the '+' icon to zoom in on the plot."),
                    h4(strong("Zoom Out: "),  "Click the '-' icon to zoom out on the plot."),
                    h4(strong("Autoscale: "),  "Click the 'Autoscale' icon to fit all markers into the plot area."),
                    h4(strong("Reset Axes: "),  "Click the 'Home' icon to fit all markers into the plot area."),
                    h4(strong("Show Closest Data: "),  "Toggle the 'Single Arrow' icon (default) to view the x and y coordinates, state, year, 
                       waterbody name, and Survey_ID of the nearest marker when hovering."),
                    h4(strong("Compare Data: "),  "Toggle the 'Double Arrow' icon to view the x and y coordinates, state, year, 
                       waterbody name, and Survey_ID of multiple sharing the same (or nearly the same) x values."),
                    ),
                    ),
                    column(5,
                           br(),
                    img(src="LineOptions.png",width="90%",style="display: inline-block;"),
                           ),
                    ),
             column(12,br(),),
    ),
    tabPanel("Pie Charts",value="VisData_Pie",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Pie_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Pie_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Pie_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                   ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Creating Pie Charts Based on Creel Survey Data")),
                    br(),
                    fluidRow(img(src="PieExample.png",width="40%",style="display: inline-block;")),
                    br(),
             ),
             column(12,
                    h3("Pie charts can be created in order view proportional contributions by metric or by survey from numeric data contained within the CreelCat database."),
                    br(),
             ),
             column(12,
                  column(4, 
                      h3(strong("Select Inputs")),
                    img(src="PieInputs.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4, 
                      h3(strong("Labels and Legend")),
                    img(src="PieLegendLabels.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4,
                      h3(strong("Pie Chart Options")),
                    img(src="PieOptions.png",width="90%",style="display: inline-block;"),
                  ),
               ),
             column(12,br(),),
             column(12,
                column(7,
                    h3(strong("Data Inputs: ")), 
                    column(12,
                    h4(strong("Select Surveys: ")),
                    h4("Input data for visualizations are located in tables below the visualizations. Select those 
                       surveys you wish to include in your pie chart either by clicking desired surveys (for multiple 
                       use Ctrl/Shift selection, or use the 'Select All'/'Select All Filtered' 
                       buttons located above the table. Any surveys which contain a NULL value for fields 
                       used to create the visualization will be dropped (A list of dropped fields can 
                       be located in the associated 'Data Warnings' panel located above the visualization."),
                    h4(strong("Categories (Metrics vs Surveys): ")),
                    h4("Select whether slices of the pie should represent 'Metrics' (ie. Bluegill Harvest Estimate) or 'Surveys' (ie. Otter Lake 2004 Survey). When 
                       'Metrics' is selected values are summed across surveys. This allows you to see a summary of metrics across one or more input surveys. When 
                       'Surveys' is selected values are summed across all metrics. This allows you to see a summary of a proportion each survey contributed across one 
                       or more input metrics."),
                    h4(strong("Select Categories: ")),
                    h4("When 'Metrics' is selected the user will select one or more metrics they wish to include in the pie chart. Each selected metric will be represented 
                       by a slice of the pie."),
                    h4(strong("Select Metrics to Sum: ")),
                    h4("When 'Surveys' is selected the user will select one or more metrics they wish to include in the pie chart. Each selected metric will be summed in order 
                       to generate the proportional value for a survey (ie. if harvest estimates for Bluegill, Yellow Perch, and Black Crappie are selected each slice of the pie 
                       will represent the sum of those three metrics for each input survey)."),
                    ),
                    ),
                column(5,
                       br(),
                       img(src="PieInputs.png",width="90%",style="display: inline-block;"),
                       ),
             ),
             column(12,br(),),
             column(12,
                column(7,
                    h3(strong("Consider Data Warnings: ")), 
                    h4("The data contained in CreelCat is not homogenous and therefore care should be taken to consider differences among surveys when making 
                       any types of comparisons. Some relevant warnings about discrepancies in input data are displayed in the 'Warnings for Input Data' panel located above the visualizations. 
                       This panel can be clicked to expand/minimize. Although we have listed several of the major potential discrepancies care should be taken by the user to ascertain 
                       whether input data being used for visualizations is valid for any comparisons being made."),
                    h4(strong("Warnings include:")),
                    column(12,
                           h4(strong("Duration Range: "), "Number of days surveys are representative of."),
                           h4(strong("Start Dates: "), "Range of months surveys began."),
                           h4(strong("Conclusion Dates: "), "Range of months surveys concluded."),
                           h4(strong("Survey Types: "), "Which types of surveys are included in the input data."),
                           h4(strong("Survey Protocols: "), "Which survey protocols were utilized for the surveys included in input data"),
                           h4(strong("Focal Species: "), "What species were targetted in the input surveys."),
                           h4(strong("Waterbody Types: "), "Which waterbody types were included in the input data."),
                           h4(strong("NA Dropped Surveys: "), "How many of the selected input surveys were dropped from the visualization due to the presence of NA values 
                              for input fields (See tables below to view which surveys were dropped and which were retained."),
                           h4(strong("Unattributed Taxa: "), "See which surveys contained unattributed taxa. Unattributed taxa records are surveys which contain taxa which were attributed 
                           at a higher taxonomic level than the user is viewing which therefore can not be attibuted. For example a survey may have quantified harvest at the 
                           genus level (ie. Crappie) while the user may wish to view data at the species level (ie. Black or White Crappie). In this case the values associated 
                           with genus level observations can not be attributed to species. Because of this values can't be attributed for the desired taxa for those surveys. In these 
                           cases we recommend either removing those surveys from consideration or making evaluations at a higher taxonomic level (ie. 'Crappie' instead of 'White Crappie' and/or 
                           'Black Crappie'. Surveys containing unattributed taxa records can be viewed in the table below."),
                           h4(strong("Partially Attributed Taxa: "), "See which surveys contained partially attributed taxa. Partially attributed taxa records are surveys which contain taxa which were attributed 
                           at a multiple taxonomic levels within a single survey (ie. 'Crappie' (Genus) and 'Black Crappie'(Species)). In these cases selecting the higher taxonomic level 
                              (ie. 'Crappie' (Genus)), will resolve the issue as the lower taxonomic level records (ie. 'Black Crappie' (Species)) will be added to the higher taxonomic records, 
                              however use of the lower taxonomic level will result in the potential unattribution of records (ie. 'Crappie' records which may or may not have been 'Black Crappie' will not 
                              be attributed) causing potential underestimation of selected metrics for those taxa. To resolve this issue we recommend removing surveys containing partially attributed taxa or 
                              selecting the higher taxonomic level (ie. Genus instead of Species). Surveys containing partially attributed taxa can be viewed in the table below."),
                         ),
                    ),
                column(5,
                       br(),
                       img(src="DataWarning.png",width="90%",style="display: inline-block;"),
                       ),
             ),
             column(12,br(),),
             column(12,
                  column(12,
                    h3(strong("Selection: ")),
                    h4("No options exist for making selections within a pie chart."),
                    ),
                  ),
             column(12,br(),),
             column(12,
                  column(7,
                    h3(strong("Labels and Legend: ")), 
                    h4("User may modify the presence of a legend and text of a title via the 'Labels and Legend' panel of the associated visualization from the sidebar."),
                    column(12,
                    h4(strong("Toggle Legend: "),"Toggle legend display on and off"),
                    h4(strong("Title: "),"Enter text in this box to create a custom title for plot"),
                    ),
                  ),
                    column(5,
                           br(),
                    img(src="PieLegendLabels.png",width="90%",style="display: inline-block;"),
                      ),
                    ),
             column(12,br(),),
             column(12,
                    column(7,
                    h3(strong("Pie Chart Options: ")), 
                    h4("By hovering over the top right portion of a line plot various options become available for user interaction with the plot."),
                    column(12,
                    h4(strong("Download: "), "Click the 'Camera' icon to download a .png image of your line plot."),
                    h4(strong("Compare Data: "),  "Toggle the 'Single Arrow' icon to view the Metric/Survey_ID, raw value, and percentage associated with each slice."),
                    ),
                    ),
                    column(5,
                           br(),
                    img(src="PieOptions.png",width="90%",style="display: inline-block;"),
                           ),
                    ),
             column(12,br(),),
    ),
    tabPanel("Bar Charts",value="VisData_Bar",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Bar_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Bar_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_VisData_Bar_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Creating Bar Charts Based on Creel Survey Data")),
                    br(),
                    fluidRow(img(src="BarChartExample.png",width="40%",style="display: inline-block;")),
                    br(),
             ),
             column(12,
                    h3("Bar charts can be created in order to evaluate up to five numeric fields across across any surveys contained within the CreelCat database. 
                       Additional options include bar styling, selection of data, modifying labels and the legend, and more."),
                    br(),
             ),
             column(12,
                  column(4, 
                      h3(strong("Select Inputs")),
                    img(src="BarInputs.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4, 
                      h3(strong("Bar Style")),
                    img(src="BarStyle.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4, 
                      h3(strong("Selection")),
                    img(src="BarSelect.png",width="90%",style="display: inline-block;"),
                  ),
             ),
             column(12,
                  column(2,
                  ),
                  column(4, 
                      h3(strong("Labels and Legend")),
                    img(src="LineLegendLabels.png",width="90%",style="display: inline-block;"),
                  ),
                  column(4,
                      h3(strong("Scatter Plot Options")),
                    img(src="BarOptions.png",width="90%",style="display: inline-block;"),
                  ),
                  column(2,
                  ),
               ),
             column(12,br(),),
             column(12,
                column(7,
                    h3(strong("Data Inputs: ")), 
                    column(12,
                    h4(strong("Select Surveys: ")),
                    h4("Input data for visualizations are located in tables below the visualizations. Select those 
                       surveys you wish to include in your bar chart either by clicking desired surveys (for multiple 
                       use Ctrl/Shift selection, or use the 'Select All'/'Select All Filtered' 
                       buttons located above the table. Any surveys which contain a NULL value for fields 
                       used to create the visualization will be dropped (A list of dropped fields can 
                       be located in the associated 'Data Warnings' panel located above the visualization."),
                    h4(strong("Select Number of Variables: ")),
                    h4("Select how many variables you wish to include in the bar chart."),
                    h4(strong("Select Variables: ")),
                    h4("Select numeric fields from inputs for each desired variable."),
                    ),
                    ),
                column(5,
                       br(),
                       img(src="BarInputs.png",width="90%",style="display: inline-block;"),
                       ),
             ),
             column(12,br(),),
             column(12,
                column(7,
                    h3(strong("Consider Data Warnings: ")), 
                    h4("The data contained in CreelCat is not homogenous and therefore care should be taken to consider differences among surveys when making 
                       any types of comparisons. Some relevant warnings about discrepancies in input data are displayed in the 'Warnings for Input Data' panel located above the visualizations. 
                       This panel can be clicked to expand/minimize. Although we have listed several of the major potential discrepancies care should be taken by the user to ascertain 
                       whether input data being used for visualizations is valid for any comparisons being made."),
                    h4(strong("Warnings include:")),
                    column(12,
                           h4(strong("Duration Range: "), "Number of days surveys are representative of."),
                           h4(strong("Start Dates: "), "Range of months surveys began."),
                           h4(strong("Conclusion Dates: "), "Range of months surveys concluded."),
                           h4(strong("Survey Types: "), "Which types of surveys are included in the input data."),
                           h4(strong("Survey Protocols: "), "Which survey protocols were utilized for the surveys included in input data"),
                           h4(strong("Focal Species: "), "What species were targetted in the input surveys."),
                           h4(strong("Waterbody Types: "), "Which waterbody types were included in the input data."),
                           h4(strong("NA Dropped Surveys: "), "How many of the selected input surveys were dropped from the visualization due to the presence of NA values 
                              for input fields (See tables below to view which surveys were dropped and which were retained."),
                           h4(strong("Unattributed Taxa: "), "See which surveys contained unattributed taxa. Unattributed taxa records are surveys which contain taxa which were attributed 
                           at a higher taxonomic level than the user is viewing which therefore can not be attibuted. For example a survey may have quantified harvest at the 
                           genus level (ie. Crappie) while the user may wish to view data at the species level (ie. Black or White Crappie). In this case the values associated 
                           with genus level observations can not be attributed to species. Because of this values can't be attributed for the desired taxa for those surveys. In these 
                           cases we recommend either removing those surveys from consideration or making evaluations at a higher taxonomic level (ie. 'Crappie' instead of 'White Crappie' and/or 
                           'Black Crappie'. Surveys containing unattributed taxa records can be viewed in the table below."),
                           h4(strong("Partially Attributed Taxa: "), "See which surveys contained partially attributed taxa. Partially attributed taxa records are surveys which contain taxa which were attributed 
                           at a multiple taxonomic levels within a single survey (ie. 'Crappie' (Genus) and 'Black Crappie'(Species)). In these cases selecting the higher taxonomic level 
                              (ie. 'Crappie' (Genus)), will resolve the issue as the lower taxonomic level records (ie. 'Black Crappie' (Species)) will be added to the higher taxonomic records, 
                              however use of the lower taxonomic level will result in the potential unattribution of records (ie. 'Crappie' records which may or may not have been 'Black Crappie' will not 
                              be attributed) causing potential underestimation of selected metrics for those taxa. To resolve this issue we recommend removing surveys containing partially attributed taxa or 
                              selecting the higher taxonomic level (ie. Genus instead of Species). Surveys containing partially attributed taxa can be viewed in the table below."),
                         ),
                    ),
                column(5,
                       br(),
                       img(src="DataWarning.png",width="90%",style="display: inline-block;"),
                       ),
             ),
             column(12,br(),),
             column(12,
                  column(7,
                    h3(strong("Bar Style: ")),
                  column(12,
                    h4(strong("Select Variable Color: "), "Select a color for bars associated with a given variable."),
                   ),
                  ),
                  column(5,
                         br(),
                    img(src="BarStyle.png",width="90%",style="display: inline-block;"),
                         ),
              ),
             column(12,br(),),
             column(12,
                  column(7,
                    h3(strong("Selection: ")),
                    h4("Surveys displayed in a chart can be selected in the plot (Box and Lasso methods). Selection via the associated table method is only 
                    valid for maps and scatter plots. Selected surveys/variables will be displayed with 100% opacity, while unselected surveys/variables will be semi transparent. Selected surveys can be 
                       viewed by clicking on the associated 'Selection' tab below visualizations."),
                  column(12,
                    h4(strong("Box Select: "), "Plot options can be seen by hovering over the top-left corner of the plot. By clicking on the 'Box Select' 
                       icon the user activates the selection and can then click and drag over the desired area to make the selection. ",strong("Warning: If no markers are 
                        within the selection bounds the app will crash."), "To clear a selection please click the 'Clear Selection' icon in the panel for the associated visualization 
                        (or if linked selection is being used do so from the 'Settings' panel."),
                    h4(strong("Lasso Select: "), "Plot options can be seen by hovering over the top-left corner of the plot. By clicking on the 'Lasso Select' 
                       icon the user activates the selection and can then click and hold to trace the desired selection area. When the click is released 
                       the selection will be finalized. ",strong("Warning: If no markers are within the selection bounds the app will crash."), "To clear a selection please 
                       click the 'Clear Selection' icon in the panel for the associated visualization 
                        (or if linked selection is being used do so from the 'Settings' panel."),
                   ),
                ),
                  column(5,
                         br(),
                    img(src="BarSelect.png",width="90%",style="display: inline-block;"),
                         ),
                    ),
             column(12,br(),),
             column(12,
                  column(7,
                    h3(strong("Labels and Legend: ")), 
                    h4("User may modify the appearance of labels and the legend of a bar chart via the 'Labels' and 'Legend' panels of the associated visualization from the sidebar."),
                    column(12,
                    h4(strong("Toggle Legend: "),"Toggle legend display on and off"),
                    h4(strong("Legend X Position: "),"Moves the position of the legend left and right via slider."),
                    h4(strong("Legend Y Position: "),"Moves the position of the legend up and down via slider."),
                    h4(strong("Title: "),"Enter text in this box to create a custom title for plot"),
                    h4(strong("X Label: "),"Enter text in this box to create a custom label for the x axis."),
                    h4(strong("Y Label: "),"Enter text in this box to create a custom label for the y axis."),
                    ),
                  ),
                    column(5,
                           br(),
                    img(src="LineLegendLabels.png",width="90%",style="display: inline-block;"),
                      ),
                    ),
             column(12,br(),),
             column(12,
                    column(7,
                    h3(strong("Bar Chart Options: ")), 
                    h4("By hovering over the top right portion of a bar chart various options become available for user interaction with the plot."),
                    column(12,
                    h4(strong("Download: "), "Click the 'Camera' icon to download a .png image of your bar chart."),
                    h4(strong("Zoom: "), "Click the 'Magnifying Glass' icon to zoom in to a specific area. If you wish to set specific ranges for the axes you 
                       can use the 'Zoom Out' button (described below) to zoom out beyond the desired range and then use the 'Zoom' button to scale the axes to 
                       your requirements."),
                    h4(strong("Pan: "),  "Click the 'Pan' icon to enable panning of the plot via clicking and dragging."),
                    h4(strong("Box Select: "),  "Select markers by dragging a rectangle across the plot area (Vertical and Horizontal dragging will allow for full length/width 
                       coverage). ",strong("Warning: If no markers are within the selection bounds the app will crash.")),
                    h4(strong("Lasso Select: "),  "Select markers by dragging the cursor around the desired the plot area (Click and hold on plot to begin, release to complete 
                       selection). ",strong("Warning: If no markers are within the selection bounds the app will crash.")),
                    h4(strong("Zoom In: "),  "Click the '+' icon to zoom in on the plot."),
                    h4(strong("Zoom Out: "),  "Click the '-' icon to zoom out on the plot."),
                    h4(strong("Autoscale: "),  "Click the 'Autoscale' icon to fit all markers into the plot area."),
                    h4(strong("Reset Axes: "),  "Click the 'Home' icon to fit all markers into the plot area."),
                    h4(strong("Show Closest Data: "),  "Toggle the 'Single Arrow' icon (default) to view the x and y coordinates, state, year, 
                       waterbody name, and Survey_ID of the nearest marker when hovering."),
                    h4(strong("Compare Data: "),  "Toggle the 'Double Arrow' icon to view the x and y coordinates, state, year, 
                       waterbody name, and Survey_ID of multiple sharing the same (or nearly the same) x values."),
                    ),
                    ),
                    column(5,
                           br(),
                    img(src="BarOptions.png",width="90%",style="display: inline-block;"),
                           ),
                    ),
             column(12,br(),),
     )
    ,
    tabPanel("Overview",value="Submit_Overview",
             column(12,
                    column(12,
                           br()
                    ),
                    column(3,align="center",
                    ),
                    column(3, align="center",
                           actionButton("UG_Submit_Overview_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
                    ),
                    column(3,align="center",
                           actionButton("UG_Submit_Overview_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
                    ),
                    column(3,align="center",
                           actionButton("UG_Submit_Overview_Next","Next", class = "btn-primary btn-md",width="100%"),
                    ),
                    column(12,
                           br()
                    ),
                    column(12,align="center",
                           h1(strong("Submit Creel Survey Data")),
                    ),
                    column(12,align="left",
                           h3("Currently users may reach out to us to submit data to the CreelCat database (Email NicholasSievert@gmail.com to do so). We will 
                              work to get data enterred into the database and release expediently. If there is a need for direct entry and immediate use of survey 
                              data (User wishes to enter survey results and immediately be able to create summaries, visualizations, etc. for reporting, decision making, 
                              etc.) by contributors we can facilitate that as well."),
                    ),

             ),
    ),

    tabPanel("Submit Data via File Sharing",value="Submit_Transfer",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_Submit_Transfer_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Submit_Transfer_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Submit_Transfer_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Submit_Transfer_Next","Next", class = "btn-primary btn-md",width="100%"),
             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Submit data via file sharing")),
             ),
             column(12,
                    h3("If you are willing and able to share creel and/or other anlger survey data with us for inclusion in the CreelCat database 
                       please contact us via email at NicholasSievert@gmail.com to facilitate the data transfer."),
                    br(),
                    h4("Data is easiest to transfer when it is in a tabular format (database, spreadsheet, etc.) however when data is not in this form (reports) 
                       we can still extract data and merge it into our database. We appreciate your support of our efforts!")
             ),
    ),



    tabPanel("Submit Data via Direct Input",value="Submit_DirectInput",
             column(12,
                    br()
             ),
             column(3,align="center",
                    actionButton("UG_Submit_DirectInput_Previous","Previous", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Submit_DirectInput_Home","Go to User Guide Home", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Submit_DirectInput_Feature","Go to Feature", class = "btn-primary btn-md",width="100%"),
             ),
             column(3,align="center",
                    actionButton("UG_Submit_DirectInput_Next","Next", class = "btn-primary btn-md",width="100%"),
             ),
             column(12,
                    br()
             ),
             column(12, align="center",
                    h2(strong("Submit data directly via direct entry into the CreelCat database")),
             ),
             column(12,
                    h3("We are considering adding functionality which would allow users to directly enter their own data and 
                       interact with it through the CreelCat interface (either online or locally). If you would be interested in 
                       this functionality please reach out to us (NicholasSievert@gmail.com) to discuss making this feature available for 
                       your use."),
                    br(),
             ),
    )
    

))
),

#### Data Avail Main ####                 
    tabPanel("Data Availability",
 fluidRow(
# Main Panel
  column(12,
  
      conditionalPanel(condition="input.SurveyCountView=='Map'",
        conditionalPanel(condition="input.DataAvailType_Pick=='Survey Count'",
          withSpinner(leafletOutput("mapDataAvail_SurveyCount", height=800),type=2),
            ),
         conditionalPanel(condition="input.DataAvailType_Pick=='Species'",
           withSpinner(leafletOutput("mapDataAvail_SppCount", height=800),type=2),
          ),
       conditionalPanel(condition="input.DataAvailType_Pick=='Available Fields'",
          withSpinner(leafletOutput("mapDataAvail_FieldsCount", height=800),type=2),
       ),
      ),
                  
      conditionalPanel(condition="input.SurveyCountView=='Table'",
        conditionalPanel(condition="input.DataAvailType_Pick=='Survey Count'",
          div(withSpinner(DT::dataTableOutput("StateSurveyCountTBL"),type=2)),
        ),
        conditionalPanel(condition="input.DataAvailType_Pick=='Available Fields'",
          div(withSpinner(DT::dataTableOutput("DataAvailFieldsTBL"),type=2)),
        ),
        conditionalPanel(condition="input.DataAvailType_Pick=='Survey Characteristics'",
          div(withSpinner(DT::dataTableOutput("DataAvailSurveyCharacteristicsTBL"),type=2)),
        ),
        conditionalPanel(condition="input.DataAvailType_Pick=='Species'",
          div(withSpinner(DT::dataTableOutput("DataAvailSPTBL"),type=2)),
        ),      
      ),
    ),
   )
),                  
                    

#### Filter Data Main ####
tabPanel("View and Filter Data",
  fluidRow(
  ##### Filter Main Panel #####
      tags$head(tags$script(src = jsfile)),
      column(12,
             conditionalPanel(condition="input.SelDataContents==null",
                              h2(strong("User must select what data they want to include in their custom data table.")),
                              h3(strong("Required Action: "), "Select either 'All', 'Filters', or 'Map' from the side bar."),
                              h5(strong("All: "), "All data are included in the table, however this data can be reduced via interactive filters in the table."),
                              h5(strong("Filters: "), "Only a subset of the data based on user defined filters are included in the table. Additional filters can be applied in the table. Only fields populated in the filtered dataset are listed in the field selection step."),
                              h5(strong("Map: "), "Only a subset of the data based on user-selected waterbodies from the mapping tool are included. Additional filters can be applied in the table. Only fields populated in the map selected dataset are listed in the field selection step.")
                               ),

             conditionalPanel(condition="(input.SelDataContents=='Filters'&&output.SelDataFilterStatus=='Incomplete')",
                              h2(strong("User must select any filters they wish to use to subset the data in their custom data table.")),
                              h3(strong("Required Action: "), "Select at least one field to filter and set criteria for all selected filters in the side bar."),
                              h5(strong("State: "), "Create a subset of states to include in your custom table"),
                              h5(strong("County: "), "Create a subset of counties to include in your table"),
                              h5(strong("Year: "), "Set the range of years you wish to include for surveys in your table."),
                              h5(strong("Duration: "), "Set the range of survey durations you wish to include."),
                              h5(strong("Waterbody Name: "), "Select specific waterbodies to include."),
                              h5(strong("Waterbody Area: "), "Set the range in waterbody size (acres) to include.")
                              ),
             conditionalPanel(condition="input.SelDataContents=='Map'&& output.MapSelData_Status==0",
                              h2(strong("User must select waterbodies to include based on selection from sidebar map.")),
                              h3(strong("Required Action: "), "Select waterbodies either by drawing a polygon or clicking states or counties with tool on the sidebar map. Those waterbodies within the selected area will then be included in all further steps."),
                              h5(strong("Required Action: "), "Select method for spatial waterbody selection, either polygon, states, or counties."),
                              h5(strong("Required Action: "), "Select 'Draw' (Polygon) or 'Select' (States/Counties) to begin drawing your polygon or selecting states/counties."),
                              h5(strong("Required Action: "), "Select 'Complete' to finalize your selection and add your selected waterbodies to the map."),
                              h5(strong("Required Action: "), "Select 'Clear' to remove current selection."),
                              h5(strong("Modifying Selections "), "can be made at any time by editing the selections within the sidebar map."),
                              h5(strong("Warning: "), "check that selections match intended boundaries. Due to projection issues occasionally there are mismatched selections along boundaries.")
             ),


                              conditionalPanel(condition="output.Picked_Data_Status=='Not_Picked'||(input.SurveyPicker==''&&input.WaterbodyPicker==''&&input.FishMetricsPicker==''&&input.EffortPicker==''&&input.TargetMetricPicker==''&&input.DemographicPicker=='')",
                                conditionalPanel(condition="(input.SelDataContents=='All'
                                                            ||(input.SelDataContents=='Map'&&output.MapSelData_Status>0)
                                                            ||(input.SelDataContents=='Filters'&&output.SelDataFilterStatus=='Complete')
                                                            )",
                                               h2(strong("User must select any fields they wish to include in their custom data table.")),
                                               h3(strong("Required Action: "), "Select at least one field to include in table from the side bar."),
                                               h5(strong("Default Fields: "), "Year, State, and Waterbody Name are all included by default."),
                                               h5(strong("Survey Info: "), "Fields related to survey details."),
                                               h5(strong("Waterbody Info: "), "Fields related to waterbody characteristics."),
                                               h5(strong("Fish Info: "), "Fields related to catch, harvest, and fish characteristics."),
                                               h5(strong("Effort Info: "), "Fields related to angler effort."),
                                               h5(strong("Angler Preference Info: "), "Fields related to data on species targetted by anglers."),
                                               h5(strong("Demographic Info: "), "Fields related to demographic information."),
                                               br(),
                                               h3(strong("Required Action: "), "Click 'Update Selected Fields' button to update the table with selected fields."),
                                               br(),
                                               h3(strong("Warning: "), "If no fields are present in inputs your filtered selection (Select Data->Filters) does not contain any surveys. Please adjust filters in order to include at least one survey."),
                             ),
                            ),

             
               conditionalPanel(condition="output.Picked_Data_Status=='Picked'&&(input.SurveyPicker!=''||input.WaterbodyPicker!=''||input.FishMetricsPicker!=''||input.EffortPicker!=''||input.TargetMetricPicker!=''||input.DemographicPicker!='')",#input.SurveyPicker!=''||input.WaterbodyPicker!=''||input.FishMetricsPicker!=''||input.EffortPicker!=''||input.TargetMetricPicker!=''||input.DemographicPicker==''",
                 conditionalPanel(condition="(input.SelDataContents=='All'
                                    ||(input.SelDataContents=='Map'&&output.MapSelData_Status>0)
                                    ||(input.SelDataContents=='Filters'&&output.SelDataFilterStatus=='Complete')
                                    )",
                        bsCollapse(id="DataWarning_Compiled",open="CompiledDataWarningCollapse",
                          bsCollapsePanel(HTML("Data Warnings&nbsp",as.character(actionLink(inputId = "CompiledDataWarning_Help", HTML('<i class="fas fa-book-open"></i>'))), as.character(actionLink(inputId = "CompiledDataWarning_Tip", HTML('<i class="fas fa-info-circle"></i>')))),value="CompiledDataWarningCollapse",
                          
                              h4(strong("Survey Characteristics")),
                              htmlOutput("Compiled_Survey_TypeWarning"),
                              htmlOutput("Compiled_WB_TypeWarning"),
                              htmlOutput("Compiled_DurationWarning"),
                              htmlOutput("Compiled_StartWarning"),
                              htmlOutput("Compiled_EndWarning"),
                              htmlOutput("Compiled_Interview_MethodWarning"),
                              htmlOutput("Compiled_Count_MethodWarning"),
                              htmlOutput("Compiled_Estimate_MethodWarning"),
                              htmlOutput("Compiled_Survey_GapsWarning"),
                              htmlOutput("Compiled_Focal_SpeciesWarning"),
                              htmlOutput("Compiled_FlaggedHeading"),
                              htmlOutput("Compiled_Timing_WarnWarning"),
                              htmlOutput("Compiled_Location_WarnWarning"),
                              htmlOutput("Compiled_Extent_WarnWarning"),
                              htmlOutput("Compiled_FishTaxaHeading"),
                              htmlOutput("Compiled_OverlapFishWarning"),
                              htmlOutput("Compiled_UnattributedFishTaxaWarning"),
                              htmlOutput("Compiled_PartiallyAttributedFishTaxaWarning"),
                              htmlOutput("Compiled_AttributedFishTaxaWarning"),
                              htmlOutput("Compiled_IncompleteAttributedFishTaxaWarning"),
                              htmlOutput("Compiled_AngPrefTaxaHeading"),
                              htmlOutput("Compiled_OverlapTargetWarning"),
                              htmlOutput("Compiled_UnattributedTarget_TaxaWarning"),
                              htmlOutput("Compiled_PartiallyAttributedTarget_TaxaWarning"),
                              htmlOutput("Compiled_AttributedTarget_TaxaWarning"),
                              htmlOutput("Compiled_IncompleteAttributedTarget_TaxaWarning"),
                              h4(strong("Dropped Surveys:")),
                              htmlOutput("Compiled_Survey_Char_Drop"),
                              switchInput("NonCreel_Compiled_Switch","Non-Creel Approaches",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkTiming_Compiled_Switch","Unknown/Uncertain Timing",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkLocation_Compiled_Switch","Unknown/Uncertain Location",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkExtent_Compiled_Switch","Unknown/Uncertain Spatial Extent",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("FocSpecies_Compiled_Switch","Focal Species",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              htmlOutput("Compiled_Taxa_Atr_Drop"),
                              switchInput("UnFish_Compiled_Switch","Unattributed Input Fish Taxa",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("InFishGroup_Compiled_Switch","Incomplete Input Fish Groups",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnTarget_Compiled_Switch","Unattributed Input Target Taxa",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("InTargetGroup_Compiled_Switch","Incomplete Input Target Groups",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              htmlOutput("Compiled_Dropped_All_Warning"),
                              br(),
                              h4(strong("View Warning Tables")),
                              awesomeRadio("Compiled_ShowTables",inline=TRUE,status='primary',
                                           h5(strong(HTML("Display table showing: &nbsp", as.character(actionLink(inputId = "CompiledWarningTableTip", HTML('<i class="fas fa-info-circle"></i>')))))),
                                           choices=c("No Table","Survey Characteristics","Retained Surveys","Dropped Surveys","Non-Creel Approaches","Unknown/Uncertain Timing","Unknown/Uncertain Location","Unknown/Uncertain Spatial Extent","Focal Species","Unattributed Taxa","Partially Attributed Taxa", "Incomplete Groups", "Unattributed Target Taxa", "Partially Attributed Target Taxa","Incomplete Target Groups"),selected="No Table"),                              
                              
                              conditionalPanel(condition="input.Compiled_ShowTables=='Survey Characteristics'",
                                  h3("Survey Characteristics"),
                                 div(withSpinner(DT::dataTableOutput("Compiled_WarnTBL_SurveyChar"),type=2)),
                              ),
                              conditionalPanel(condition="input.Compiled_ShowTables=='Non-Creel Approaches'",
                                  h3("Non-Creel Approaches"),
                                 div(withSpinner(DT::dataTableOutput("Compiled_WarnTBL_Non_Creel"),type=2)),
                              ),
                              conditionalPanel(condition="input.Compiled_ShowTables=='Unknown/Uncertain Timing'",
                                  h3("Unknown/Uncertain Timing"),
                                 div(withSpinner(DT::dataTableOutput("Compiled_WarnTBL_Timing"),type=2)),
                              ),
                              conditionalPanel(condition="input.Compiled_ShowTables=='Unknown/Uncertain Location'",
                                  h3("Unknown/Uncertain Location"),
                                 div(withSpinner(DT::dataTableOutput("Compiled_WarnTBL_Location"),type=2)),
                              ),
                              conditionalPanel(condition="input.Compiled_ShowTables=='Unknown/Uncertain Spatial Extent'",
                                  h3("Unknown/Uncertain Spatial Extent"),
                                 div(withSpinner(DT::dataTableOutput("Compiled_WarnTBL_Extent"),type=2)),
                              ),
                              conditionalPanel(condition="input.Compiled_ShowTables=='Focal Species'",
                                  h3("Focal Species"),
                                 div(withSpinner(DT::dataTableOutput("Compiled_WarnTBL_FocalSpecies"),type=2)),
                              ),
                              conditionalPanel(condition="input.Compiled_ShowTables=='Retained Surveys'",
                                  h3("Surveys Retained in Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Compiled_Retained_All_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Compiled_ShowTables=='Dropped Surveys'",
                                  h3("Surveys Dropped from Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Compiled_Dropped_All_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Compiled_ShowTables=='Unattributed Taxa'",
                                  h3("Unattributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Compiled_UnattributedFishTaxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Compiled_ShowTables=='Partially Attributed Taxa'",
                                  h3("Partially Attributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Compiled_PartiallyAttributedFishTaxa_TBL"),type=2)), # Compiled_PartiallyAttributedFishTaxa_TBL
                                ),
                              conditionalPanel(condition="input.Compiled_ShowTables=='Incomplete Groups'",
                                  h3("Incomplete Group Attribution Table"),
                                 div(withSpinner(DT::dataTableOutput("Compiled_IncompleteAttributedFishTaxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Compiled_ShowTables=='Unattributed Target Taxa'",
                                  h3("Unattributed Target Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Compiled_UnattributedTarget_Taxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Compiled_ShowTables=='Partially Attributed Target Taxa'",
                                  h3("Partially Attributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Compiled_PartiallyAttributedTarget_Taxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Compiled_ShowTables=='Incomplete Target Groups'",
                                  h3("Incomplete Group Attribution Table"),
                                 div(withSpinner(DT::dataTableOutput("Compiled_IncompleteAttributedTarget_Taxa_TBL"),type=2)),
                                ),
                          style='danger')
              ),
                         

                           h3(HTML("Custom Table&nbsp;&nbsp", as.character(actionLink(inputId = "CustomTable_UG_Link",HTML('<i class="fas fa-book-open"></i>'))), as.character(actionLink(inputId = "CustomTable_Tip", HTML('<i class="fas fa-info-circle"></i>'))))),
                           br(),
                           div(withSpinner(DT::dataTableOutput("Compiled_DT"),type=2)),


                ),
             ),
            ),


            )
  ),

       
                           
#### Summarize Data Main ####
tabPanel("Summarize Data",
fluidRow(
column(12,
       column(12,
             conditionalPanel(condition="input.SelDataContents==null",
                              h2(strong("User must select what data they want to include in their summarization.")),
                              h3(strong("Required Action: "), "Select either 'All', 'Filters', or 'Map' from the side bar."),
                              h5(strong("All: "), "All data are included in the table, however this data can be reduced via interactive filters in the table."),
                              h5(strong("Filters: "), "Only a subset of the data based on user defined filters are included in the table. Additional filters can be applied in the table. Only fields populated in the filtered dataset are listed in the field selection step."),
                              h5(strong("Map: "), "Only a subset of the data based on user-selected waterbodies from the mapping tool are included. Additional filters can be applied in the table. Only fields populated in the map selected dataset are listed in the field selection step.")
                               ),

             conditionalPanel(condition="input.SelDataContents=='Filters'&&output.SelDataFilterStatus=='Incomplete'",
                              h2(strong("User must select any filters they wish to use to subset the data in their summarization.")),
                              h3(strong("Required Action: "), "Select at least one field to filter and set criteria for all selected filters in the side bar."),
                              h5(strong("State: "), "Create a subset of states to include in your table"),
                              h5(strong("County: "), "Create a subset of counties to include in your table"),
                              h5(strong("Year: "), "Set the range of years you wish to include for surveys in your table."),
                              h5(strong("Duration: "), "Set the range of survey durations you wish to include."),
                              h5(strong("Waterbody Name: "), "Select specific waterbodies to include."),
                              h5(strong("Waterbody Area: "), "Set the range in waterbody size (acres) to include.")
                              ),
             conditionalPanel(condition="input.SelDataContents=='Map'&& output.MapSelData_Status==0",
                              h2(strong("User must select waterbodies to include based on selection from sidebar map.")),
                              h3(strong("Required Action: "), "Select waterbodies either by drawing a polygon or clicking states or counties with tool on the sidebar map. Those waterbodies within the selected area will then be included in all further steps."),
                              h5(strong("Required Action: "), "Select method for spatial waterbody selection, either polygon, states, or counties."),
                              h5(strong("Required Action: "), "Select 'Draw' (Polygon) or 'Select' (States/Counties) to begin drawing your polygon or selecting states/counties."),
                              h5(strong("Required Action: "), "Select 'Complete' to finalize your selection and add your selected waterbodies to the map."),
                              h5(strong("Required Action: "), "Select 'Clear' to remove current selection."),
                              h5(strong("Modifying Selections "), "can be made at any time by editing the selections within the sidebar map."),
                              h5(strong("Warning: "), "check that selections match intended boundaries. Due to projection issues occasionally there are mismatched selections along boundaries.")
             ),


                conditionalPanel(condition="output.Picked_Data_Status=='Not_Picked'||(input.SurveyPicker==''&&input.WaterbodyPicker==''&&input.FishMetricsPicker==''&&input.EffortPicker==''&&input.TargetMetricPicker==''&&input.DemographicPicker=='')",
                             conditionalPanel(condition="(input.SelDataContents=='All'
                                              ||(input.SelDataContents=='Map'&&output.MapSelData_Status>0)
                                              ||(input.SelDataContents=='Filters'&&output.SelDataFilterStatus=='Complete')
                                              )",
                                               h2(strong("User must select any fields they wish to include in their summarization.")),
                                               h3(strong("Required Action: "), "Select at least one field to include in table from the side bar."),
                                               h5(strong("Default Fields: "), "Year, State, and Waterbody Name are all included by default."),
                                               h5(strong("Survey Info: "), "Fields related to survey details."),
                                               h5(strong("Waterbody Info: "), "Fields related to waterbody characteristics."),
                                               h5(strong("Fish Info: "), "Fields related to catch, harvest, and fish characteristics."),
                                               h5(strong("Effort Info: "), "Fields related to angler effort."),
                                               h5(strong("Angler Preference Info: "), "Fields related to data on species targetted by anglers."),
                                               h5(strong("Demographic Info: "), "Fields related to demographic information."),
                                               br(),
                                               h3(strong("Required Action: "), "Click 'Update Selected Fields' button to update the table with selected fields."),
                                               br(),
                                               h3(strong("Warning: "), "If no fields are present in inputs your filtered selection (Select Data->Filters) does not contain any surveys. Please adjust filters in order to include at least one survey."),
                             ),
                             ),
                           # ),
  conditionalPanel(condition="output.Picked_Data_Status=='Picked'&&(input.SurveyPicker!=''||input.WaterbodyPicker!=''||input.FishMetricsPicker!=''||input.EffortPicker!=''||input.TargetMetricPicker!=''||input.DemographicPicker!='')",#input.SurveyPicker!=''||input.WaterbodyPicker!=''||input.FishMetricsPicker!=''||input.EffortPicker!=''||input.TargetMetricPicker!=''||input.DemographicPicker==''",
                 conditionalPanel(condition="(input.SelDataContents=='All'
                                              ||(input.SelDataContents=='Map'&&output.MapSelData_Status>0)
                                              ||(input.SelDataContents=='Filters'&&output.SelDataFilterStatus=='Complete')
                                              )",
                                         
                       
     conditionalPanel(condition="input.SummaryMetric==''||input.Survey_Summary_FieldGroup_Picker==''||input.Survey_Summary_FieldValue_Picker==''",
          h2(strong("User must populate the required fields from the 'Summarization Options' panel on sidebar.")),
          h3(strong("Required Action: "), "Select all summarization metrics you would like to be calculated."),
          h3(strong("Required Action: "), "Select at least one field to group the data by."),
          h3(strong("Required Action: "), "Select at least one field to apply summarization to.")
          ),
     
        conditionalPanel(condition="input.SummaryMetric!=''&&input.Survey_Summary_FieldGroup_Picker!=''&&input.Survey_Summary_FieldValue_Picker!=''",
        conditionalPanel(condition="typeof output.CompiledSummary_SelectCount =='undefined'||output.CompiledSummary_SelectCount<1",
          h2(strong("User must select surveys they want to summarize from table below.")),
          h3(strong("Required Action: "), "Select surveys from table below (use 'CTRL' and/or 'Shift' keys to select multiple, or 'Select All' button).")
         ),
        ),


        
              conditionalPanel(condition="output.Picked_Data_Status=='Picked'&&(input.SurveyPicker!=''||input.WaterbodyPicker!=''||input.FishMetricsPicker!=''||input.EffortPicker!=''||input.TargetMetricPicker!=''||input.DemographicPicker!='')",#input.SurveyPicker!=''||input.WaterbodyPicker!=''||input.FishMetricsPicker!=''||input.EffortPicker!=''||input.TargetMetricPicker!=''||input.DemographicPicker==''",
                 conditionalPanel(condition="(input.SelDataContents=='All'
                                              ||(input.SelDataContents=='Map'&&output.MapSelData_Status>0)
                                              ||(input.SelDataContents=='Filters'&&output.SelDataFilterStatus=='Complete')
                                              )",
                     conditionalPanel(condition="input.SummaryMetric!=''&&input.Survey_Summary_FieldGroup_Picker!=''&&input.Survey_Summary_FieldValue_Picker!=''",
                      conditionalPanel(condition="typeof output.CompiledSummary_SelectCount !=='undefined'&& output.CompiledSummary_SelectCount>0",
                        bsCollapse(id="DataWarning_Summarized",open="SummarizedDataWarningCollapse",
                          bsCollapsePanel(HTML("Data Warnings&nbsp",as.character(actionLink(inputId = "SummarizedDataWarning_Help", HTML('<i class="fas fa-book-open"></i>'))), as.character(actionLink(inputId = "SummarizedDataWarning_Tip", HTML('<i class="fas fa-info-circle"></i>')))),value="SummarizedDataWarningCollapse",
                              h4(strong("Survey Characteristics")),
                              htmlOutput("Summary_Survey_TypeWarning"),
                              htmlOutput("Summary_WB_TypeWarning"),
                              htmlOutput("Summary_DurationWarning"),
                              htmlOutput("Summary_StartWarning"),
                              htmlOutput("Summary_EndWarning"),
                              htmlOutput("Summary_Interview_MethodWarning"),
                              htmlOutput("Summary_Count_MethodWarning"),
                              htmlOutput("Summary_Estimate_MethodWarning"),
                              htmlOutput("Summary_Survey_GapsWarning"),
                              htmlOutput("Summary_Focal_SpeciesWarning"),
                              htmlOutput("Summary_FlaggedHeading"),
                              htmlOutput("Summary_Timing_WarnWarning"),
                              htmlOutput("Summary_Location_WarnWarning"),
                              htmlOutput("Summary_Extent_WarnWarning"),
                              htmlOutput("Summary_FishTaxaHeading"),
                              htmlOutput("Summary_OverlapFishWarning"),
                              htmlOutput("Summary_UnattributedFishTaxaWarning"),
                              htmlOutput("Summary_PartiallyAttributedFishTaxaWarning"),
                              htmlOutput("Summary_AttributedFishTaxaWarning"),
                              htmlOutput("Summary_IncompleteAttributedFishTaxaWarning"),
                              htmlOutput("Summary_AngPrefTaxaHeading"),
                              htmlOutput("Summary_OverlapTargetWarning"),
                              htmlOutput("Summary_UnattributedTarget_TaxaWarning"),
                              htmlOutput("Summary_PartiallyAttributedTarget_TaxaWarning"),
                              htmlOutput("Summary_AttributedTarget_TaxaWarning"),
                              htmlOutput("Summary_IncompleteAttributedTarget_TaxaWarning"),
                              h4(strong("Dropped Surveys:")),
                              h5(strong("Null Inputs")),
                              htmlOutput("Summary_Dropped_NA_Warning"),
                              htmlOutput("Summary_Survey_Char_Drop"),
                              switchInput("NonCreel_Summary_Switch","Non-Creel Approaches",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkTiming_Summary_Switch","Unknown/Uncertain Timing",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkLocation_Summary_Switch","Unknown/Uncertain Location",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkExtent_Summary_Switch","Unknown/Uncertain Spatial Extent",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("FocSpecies_Summary_Switch","Focal Species",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              htmlOutput("Summary_Taxa_Atr_Drop"),
                              switchInput("UnFish_Summary_Switch","Unattributed Input Fish Taxa",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("InFishGroup_Summary_Switch","Incomplete Input Fish Groups",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnTarget_Summary_Switch","Unattributed Input Target Taxa",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("InTargetGroup_Summary_Switch","Incomplete Input Target Groups",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              htmlOutput("Summary_Dropped_All_Warning"),
                              br(),
                              h4(strong("View Warning Tables")),
                              awesomeRadio("Summary_ShowTables",inline=TRUE,status='primary',
                                           h5(strong(HTML("Display table showing: &nbsp", as.character(actionLink(inputId = "SummaryWarningTableTip", HTML('<i class="fas fa-info-circle"></i>')))))),
                                           choices=c("No Table","Survey Characteristics","Retained Surveys","Dropped Surveys","Retained NA Surveys","Dropped NA Surveys","Non-Creel Approaches","Unknown/Uncertain Timing","Unknown/Uncertain Location","Unknown/Uncertain Spatial Extent","Focal Species","Unattributed Taxa","Partially Attributed Taxa", "Incomplete Groups", "Unattributed Target Taxa", "Partially Attributed Target Taxa","Incomplete Target Groups"),selected="No Table"),                              
                              
                              conditionalPanel(condition="input.Summary_ShowTables=='Survey Characteristics'",
                                  h3("Survey Characteristics"),
                                 div(withSpinner(DT::dataTableOutput("Summary_WarnTBL_SurveyChar"),type=2)),
                              ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Non-Creel Approaches'",
                                  h3("Non-Creel Approaches"),
                                 div(withSpinner(DT::dataTableOutput("Summary_WarnTBL_Non_Creel"),type=2)),
                              ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Unknown/Uncertain Timing'",
                                  h3("Unknown/Uncertain Timing"),
                                 div(withSpinner(DT::dataTableOutput("Summary_WarnTBL_Timing"),type=2)),
                              ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Unknown/Uncertain Location'",
                                  h3("Unknown/Uncertain Location"),
                                 div(withSpinner(DT::dataTableOutput("Summary_WarnTBL_Location"),type=2)),
                              ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Unknown/Uncertain Spatial Extent'",
                                  h3("Unknown/Uncertain Spatial Extent"),
                                 div(withSpinner(DT::dataTableOutput("Summary_WarnTBL_Extent"),type=2)),
                              ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Focal Species'",
                                  h3("Focal Species"),
                                 div(withSpinner(DT::dataTableOutput("Summary_WarnTBL_FocalSpecies"),type=2)),
                              ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Retained NA Surveys'",
                                  h3("Surveys Retained in Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Summary_Retained_NA_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Dropped NA Surveys'",
                                  h3("Surveys Dropped from Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Summary_Dropped_NA_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Retained Surveys'",
                                  h3("Surveys Retained in Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Summary_Retained_All_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Dropped Surveys'",
                                  h3("Surveys Dropped from Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Summary_Dropped_All_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Unattributed Taxa'",
                                  h3("Unattributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Summary_UnattributedFishTaxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Partially Attributed Taxa'",
                                  h3("Partially Attributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Summary_PartiallyAttributedFishTaxa_TBL"),type=2)), # Summary_PartiallyAttributedFishTaxa_TBL
                                ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Incomplete Groups'",
                                  h3("Incomplete Group Attribution Table"),
                                 div(withSpinner(DT::dataTableOutput("Summary_IncompleteAttributedFishTaxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Unattributed Target Taxa'",
                                  h3("Unattributed Target Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Summary_UnattributedTarget_Taxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Partially Attributed Target Taxa'",
                                  h3("Partially Attributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Summary_PartiallyAttributedTarget_Taxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Summary_ShowTables=='Incomplete Target Groups'",
                                  h3("Incomplete Group Attribution Table"),
                                 div(withSpinner(DT::dataTableOutput("Summary_IncompleteAttributedTarget_Taxa_TBL"),type=2)),
                                ),
                          style='danger')
              ),
                          
                           h3(HTML("Summarized Table&nbsp;&nbsp", as.character(actionLink(inputId = "SummarizedTable_UG_Link",HTML('<i class="fas fa-book-open"></i>'))), as.character(actionLink(inputId = "SummarizedTable_Tip", HTML('<i class="fas fa-info-circle"></i>'))))),
                           br(),
                           div(withSpinner(DT::dataTableOutput("Compiled_Summary"),type=2)),
                           
                 ),
                           br(),
                           br(),
                           h3(HTML("Select Surveys Below for Summarization&nbsp;&nbsp", as.character(actionLink(inputId = "SummarizedInputTable_UG_Link",HTML('<i class="fas fa-book-open"></i>'))), as.character(actionLink(inputId = "SummarizedInputTable_Tip", HTML('<i class="fas fa-info-circle"></i>'))))),
                           br(),
                           div(withSpinner(DT::dataTableOutput("CompiledSummary_Input"),type=2)),
                      ),

                ),
             ),
     
            ),
       )
       )
)
)
),

                           
#### Visualization Main ####
tabPanel("Visualize Data",
fluidRow(
  
column(12,
       conditionalPanel(condition="input.SelDataContents==null",
                        h2(strong("User must select what data they want to include in their visualizations.")),
                        h3(strong("Required Action: "), "Select either 'All', 'Filters', or 'Map' from the side bar."),
                        h5(strong("All: "), "All data are included in the table, however this data can be reduced via interactive filters in the table."),
                        h5(strong("Filters: "), "Only a subset of the data based on user defined filters are included in the table. Additional filters can be applied in the table. Only fields populated in the filtered dataset are listed in the field selection step."),
                        h5(strong("Map: "), "Only a subset of the data based on user-selected waterbodies from the mapping tool are included. Additional filters can be applied in the table. Only fields populated in the map selected dataset are listed in the field selection step.")
       ),
       
       conditionalPanel(condition="input.SelDataContents=='Filters'&&output.SelDataFilterStatus=='Incomplete'",
                        h2(strong("User must select any filters they wish to use to subset the data in their visualizations.")),
                        h3(strong("Required Action: "), "Select at least one field to filter and set criteria for all selected filters in the side bar."),
                        h5(strong("State: "), "Create a subset of states to include in your table"),
                        h5(strong("County: "), "Create a subset of counties to include in your table"),
                        h5(strong("Year: "), "Set the range of years you wish to include for surveys in your table."),
                        h5(strong("Duration: "), "Set the range of survey durations you wish to include."),
                        h5(strong("Waterbody Name: "), "Select specific waterbodies to include."),
                        h5(strong("Waterbody Area: "), "Set the range in waterbody size (acres) to include.")
       ),
       conditionalPanel(condition="input.SelDataContents=='Map'&& output.MapSelData_Status==0",
                              h2(strong("User must select waterbodies to include based on selection from sidebar map.")),
                              h3(strong("Required Action: "), "Select waterbodies either by drawing a polygon or clicking states or counties with tool on the sidebar map. Those waterbodies within the selected area will then be included in all further steps."),
                              h5(strong("Required Action: "), "Select method for spatial waterbody selection, either polygon, states, or counties."),
                              h5(strong("Required Action: "), "Select 'Draw' (Polygon) or 'Select' (States/Counties) to begin drawing your polygon or selecting states/counties."),
                              h5(strong("Required Action: "), "Select 'Complete' to finalize your selection and add your selected waterbodies to the map."),
                              h5(strong("Required Action: "), "Select 'Clear' to remove current selection."),
                              h5(strong("Modifying Selections "), "can be made at any time by editing the selections within the sidebar map."),
                              h5(strong("Warning: "), "check that selections match intended boundaries. Due to projection issues occasionally there are mismatched selections along boundaries.")
             ),
       
       
       conditionalPanel(condition="output.Picked_Data_Status=='Not_Picked'||(input.SurveyPicker==''&&input.WaterbodyPicker==''&&input.FishMetricsPicker==''&&input.EffortPicker==''&&input.TargetMetricPicker==''&&input.DemographicPicker=='')",
                               conditionalPanel(condition="(input.SelDataContents=='All'
                                              ||(input.SelDataContents=='Map'&&output.MapSelData_Status>0)
                                              ||(input.SelDataContents=='Filters'&&output.SelDataFilterStatus=='Complete')
                                              )",
                                         h2(strong("User must select any fields they wish to include in their visualizations.")),
                                               h3(strong("Required Action: "), "Select at least one field to include in table from the side bar."),
                                               h5(strong("Default Fields: "), "Year, State, and Waterbody Name are all included by default."),
                                               h5(strong("Survey Info: "), "Fields related to survey details."),
                                               h5(strong("Waterbody Info: "), "Fields related to waterbody characteristics."),
                                               h5(strong("Fish Info: "), "Fields related to catch, harvest, and fish characteristics."),
                                               h5(strong("Effort Info: "), "Fields related to angler effort."),
                                               h5(strong("Angler Preference Info: "), "Fields related to data on species targetted by anglers."),
                                               h5(strong("Demographic Info: "), "Fields related to demographic information."),
                                               br(),
                                               h3(strong("Required Action: "), "Click 'Update Selected Fields' button to update the table with selected fields."),
                                               br(),
                                               h3(strong("Warning: "), "If no fields are present in inputs your filtered selection (Select Data->Filters) does not contain any surveys. Please adjust filters in order to include at least one survey."),
                             ),
                        ),
       #),
       
       
 conditionalPanel(condition="output.Picked_Data_Status=='Picked'&&(input.SurveyPicker!=''||input.WaterbodyPicker!=''||input.FishMetricsPicker!=''||input.EffortPicker!=''||input.TargetMetricPicker!=''||input.DemographicPicker!='')",#input.SurveyPicker!=''||input.WaterbodyPicker!=''||input.FishMetricsPicker!=''||input.EffortPicker!=''||input.TargetMetricPicker!=''||input.DemographicPicker==''",
                 conditionalPanel(condition="(input.SelDataContents=='All'
                                              ||(input.SelDataContents=='Map'&&output.MapSelData_Status>0)
                                              ||(input.SelDataContents=='Filters'&&output.SelDataFilterStatus=='Complete')
                                              )",                                         
                       
     conditionalPanel(condition="input.AF_VisNum_Selection!=1&&input.AF_VisNum_Selection!=2&&input.AF_VisNum_Selection!=3&&input.AF_VisNum_Selection!=4",
          h2(strong("User must select the number of visualizations they intend to simultaneously display from 'Settings' panel on sidebar.")),
          h3(strong("Required Action: "), "Select the number of visualizations you wish to create (1-4 visualizations can be displayed simultaneously)."),
       ),
  
     conditionalPanel(condition="(input.AF_VisNum_Selection==2||input.AF_VisNum_Selection==3||input.AF_VisNum_Selection==4)
                      &&input.AF_SharedData==null",
          h2(strong("User must select whether they wish for their visualizations to share the same input data from 'Settings' panel on sidebar.")),
          h3(strong("Required Action: "), "Select whether you would like your visualizations to share the same input surveys or each operate on a unique subset of surveys", strong("(Requires two or more visualizations).")),
       ),
     
     conditionalPanel(condition="input.AF_SharedData=='Yes'&&input.AF_LinkedSelection==null",
          h2(strong("User must select whether they wish for selections to be linked among visualizations (ie. a selection made in one visualization (or from the selection table) is dispalyed across all visualizations from the 'Settings' panel on sidebar.")),
          h3(strong("Required Action: "), "If multiple visualizations are being displayed and they share the same input surveys ('Shared Data' set to 'Yes') then 'Linked Selection' can be enabled. Linked selection transfers selections from one visualization to others. Linked selections highlight objects in scatter plots, maps, and subsets the data displayed in bar, time-series (line plots)and pie charts. ", strong("(Requires two or more visualizations and shared data)"),"."),
       ),
      
      conditionalPanel(condition="input.AF_VisNum_Selection=='1'||input.AF_SharedData=='No'||(input.AF_SharedData=='Yes'&&input.AF_LinkedSelection!=null)",
             bsCollapse(id="VisDataWarning",
              bsCollapsePanel(HTML("Warnings for Input Data&nbsp",as.character(actionLink(inputId = "VisDataWarning_Help", HTML('<i class="fas fa-book-open"></i>'))), as.character(actionLink(inputId = "VisDataWarning_Tip", HTML('<i class="fas fa-info-circle"></i>')))),value="VisDataWarningCollapse",
                  conditionalPanel(condition="input.AF_SharedData=='Yes'&&input.AF_VisNum_Selection!='1'",
                     bsCollapse(id="VisDataWarning_Shared",open="SharedDataWarningCollapse",
                           bsCollapsePanel(HTML("Shared Input Data"),value="SharedDataWarningCollapse",
                              h4(strong("Survey Characteristics")),
                              htmlOutput("Shared_Survey_TypeWarning"),
                              htmlOutput("Shared_WB_TypeWarning"),
                              htmlOutput("Shared_DurationWarning"),
                              htmlOutput("Shared_StartWarning"),
                              htmlOutput("Shared_EndWarning"),
                              htmlOutput("Shared_Interview_MethodWarning"),
                              htmlOutput("Shared_Count_MethodWarning"),
                              htmlOutput("Shared_Estimate_MethodWarning"),
                              htmlOutput("Shared_Survey_GapsWarning"),
                              htmlOutput("Shared_Focal_SpeciesWarning"),
                              htmlOutput("Shared_FlaggedHeading"),
                              htmlOutput("Shared_Timing_WarnWarning"),
                              htmlOutput("Shared_Location_WarnWarning"),
                              htmlOutput("Shared_Extent_WarnWarning"),
                              htmlOutput("Shared_FishTaxaHeading"),
                              htmlOutput("Shared_OverlapFishWarning"),
                              htmlOutput("Shared_UnattributedFishTaxaWarning"),
                              htmlOutput("Shared_PartiallyAttributedFishTaxaWarning"),
                              htmlOutput("Shared_AttributedFishTaxaWarning"),
                              htmlOutput("Shared_IncompleteAttributedFishTaxaWarning"),
                              htmlOutput("Shared_AngPrefTaxaHeading"),
                              htmlOutput("Shared_OverlapTargetWarning"),
                              htmlOutput("Shared_UnattributedTarget_TaxaWarning"),
                              htmlOutput("Shared_PartiallyAttributedTarget_TaxaWarning"),
                              htmlOutput("Shared_AttributedTarget_TaxaWarning"),
                              htmlOutput("Shared_IncompleteAttributedTarget_TaxaWarning"),
                              h4(strong("Dropped Surveys:")),
                              h5(strong("Null Inputs")),
                              htmlOutput("Shared_Dropped_NA_Warning"),
                              htmlOutput("Shared_Survey_Char_Drop"),
                              switchInput("NonCreel_Shared_Switch","Non-Creel Approaches",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkTiming_Shared_Switch","Unknown/Uncertain Timing",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkLocation_Shared_Switch","Unknown/Uncertain Location",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkExtent_Shared_Switch","Unknown/Uncertain Spatial Extent",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("FocSpecies_Shared_Switch","Focal Species",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              htmlOutput("Shared_Taxa_Atr_Drop"),
                              switchInput("UnFish_Shared_Switch","Unattributed Input Fish Taxa",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("InFishGroup_Shared_Switch","Incomplete Input Fish Groups",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnTarget_Shared_Switch","Unattributed Input Target Taxa",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("InTargetGroup_Shared_Switch","Incomplete Input Target Groups",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              htmlOutput("Shared_Dropped_All_Warning"),
                              br(),
                              h4(strong("View Warning Tables")),
                              awesomeRadio("Shared_ShowTables",inline=TRUE,status='primary',
                                           h5(strong(HTML("Display table showing: &nbsp", as.character(actionLink(inputId = "SharedWarningTableTip", HTML('<i class="fas fa-info-circle"></i>')))))),
                                           choices=c("No Table","Survey Characteristics","Retained Surveys","Dropped Surveys","Retained NA Surveys","Dropped NA Surveys","Non-Creel Approaches","Unknown/Uncertain Timing","Unknown/Uncertain Location","Unknown/Uncertain Spatial Extent","Focal Species","Unattributed Taxa","Partially Attributed Taxa", "Incomplete Groups", "Unattributed Target Taxa", "Partially Attributed Target Taxa","Incomplete Target Groups"),selected="No Table"),                              
                              
                              conditionalPanel(condition="input.Shared_ShowTables=='Survey Characteristics'",
                                  h3("Survey Characteristics"),
                                 div(withSpinner(DT::dataTableOutput("Shared_WarnTBL_SurveyChar"),type=2)),
                              ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Non-Creel Approaches'",
                                  h3("Non-Creel Approaches"),
                                 div(withSpinner(DT::dataTableOutput("Shared_WarnTBL_Non_Creel"),type=2)),
                              ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Unknown/Uncertain Timing'",
                                  h3("Unknown/Uncertain Timing"),
                                 div(withSpinner(DT::dataTableOutput("Shared_WarnTBL_Timing"),type=2)),
                              ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Unknown/Uncertain Location'",
                                  h3("Unknown/Uncertain Location"),
                                 div(withSpinner(DT::dataTableOutput("Shared_WarnTBL_Location"),type=2)),
                              ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Unknown/Uncertain Spatial Extent'",
                                  h3("Unknown/Uncertain Spatial Extent"),
                                 div(withSpinner(DT::dataTableOutput("Shared_WarnTBL_Extent"),type=2)),
                              ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Focal Species'",
                                  h3("Focal Species"),
                                 div(withSpinner(DT::dataTableOutput("Shared_WarnTBL_FocalSpecies"),type=2)),
                              ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Retained NA Surveys'",
                                  h3("Surveys Retained in Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Shared_Retained_NA_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Dropped NA Surveys'",
                                  h3("Surveys Dropped from Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Shared_Dropped_NA_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Retained Surveys'",
                                  h3("Surveys Retained in Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Shared_Retained_All_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Dropped Surveys'",
                                  h3("Surveys Dropped from Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Shared_Dropped_All_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Unattributed Taxa'",
                                  h3("Unattributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Shared_UnattributedFishTaxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Partially Attributed Taxa'",
                                  h3("Partially Attributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Shared_PartiallyAttributedFishTaxa_TBL"),type=2)), # Shared_PartiallyAttributedFishTaxa_TBL
                                ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Incomplete Groups'",
                                  h3("Incomplete Group Attribution Table"),
                                 div(withSpinner(DT::dataTableOutput("Shared_IncompleteAttributedFishTaxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Unattributed Target Taxa'",
                                  h3("Unattributed Target Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Shared_UnattributedTarget_Taxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Partially Attributed Target Taxa'",
                                  h3("Partially Attributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Shared_PartiallyAttributedTarget_Taxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Shared_ShowTables=='Incomplete Target Groups'",
                                  h3("Incomplete Group Attribution Table"),
                                 div(withSpinner(DT::dataTableOutput("Shared_IncompleteAttributedTarget_Taxa_TBL"),type=2)),
                                ),
                          style='danger')
              ),
                     ),
          conditionalPanel(condition="input.AF_VisNum_Selection=='1'||input.AF_SharedData=='No'",
              bsCollapse(id="DataWarning_Vis_1",open="Vis_1DataWarningCollapse",
                    bsCollapsePanel(HTML("Visualization 1 Input Data"),value="Vis_1DataWarningCollapse",
                              h4(strong("Survey Characteristics")),
                              htmlOutput("Vis_1_Survey_TypeWarning"),
                              htmlOutput("Vis_1_WB_TypeWarning"),
                              htmlOutput("Vis_1_DurationWarning"),
                              htmlOutput("Vis_1_StartWarning"),
                              htmlOutput("Vis_1_EndWarning"),
                              htmlOutput("Vis_1_Interview_MethodWarning"),
                              htmlOutput("Vis_1_Count_MethodWarning"),
                              htmlOutput("Vis_1_Estimate_MethodWarning"),
                              htmlOutput("Vis_1_Survey_GapsWarning"),
                              htmlOutput("Vis_1_Focal_SpeciesWarning"),
                              htmlOutput("Vis_1_FlaggedHeading"),
                              htmlOutput("Vis_1_Timing_WarnWarning"),
                              htmlOutput("Vis_1_Location_WarnWarning"),
                              htmlOutput("Vis_1_Extent_WarnWarning"),
                              htmlOutput("Vis_1_FishTaxaHeading"),
                              htmlOutput("Vis_1_OverlapFishWarning"),
                              htmlOutput("Vis_1_UnattributedFishTaxaWarning"),
                              htmlOutput("Vis_1_PartiallyAttributedFishTaxaWarning"),
                              htmlOutput("Vis_1_AttributedFishTaxaWarning"),
                              htmlOutput("Vis_1_IncompleteAttributedFishTaxaWarning"),
                              htmlOutput("Vis_1_AngPrefTaxaHeading"),
                              htmlOutput("Vis_1_OverlapTargetWarning"),
                              htmlOutput("Vis_1_UnattributedTarget_TaxaWarning"),
                              htmlOutput("Vis_1_PartiallyAttributedTarget_TaxaWarning"),
                              htmlOutput("Vis_1_AttributedTarget_TaxaWarning"),
                              htmlOutput("Vis_1_IncompleteAttributedTarget_TaxaWarning"),
                              h4(strong("Dropped Surveys:")),
                              h5(strong("Null Inputs")),
                              htmlOutput("Vis_1_Dropped_NA_Warning"),
                              htmlOutput("Vis_1_Survey_Char_Drop"),
                              switchInput("NonCreel_Vis_1_Switch","Non-Creel Approaches",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkTiming_Vis_1_Switch","Unknown/Uncertain Timing",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkLocation_Vis_1_Switch","Unknown/Uncertain Location",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkExtent_Vis_1_Switch","Unknown/Uncertain Spatial Extent",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("FocSpecies_Vis_1_Switch","Focal Species",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              htmlOutput("Vis_1_Taxa_Atr_Drop"),
                              switchInput("UnFish_Vis_1_Switch","Unattributed Input Fish Taxa",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("InFishGroup_Vis_1_Switch","Incomplete Input Fish Groups",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnTarget_Vis_1_Switch","Unattributed Input Target Taxa",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("InTargetGroup_Vis_1_Switch","Incomplete Input Target Groups",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              htmlOutput("Vis_1_Dropped_All_Warning"),
                              br(),
                              h4(strong("View Warning Tables")),
                              awesomeRadio("Vis_1_ShowTables",inline=TRUE,status='primary',
                                           h5(strong(HTML("Display table showing: &nbsp", as.character(actionLink(inputId = "Vis_1WarningTableTip", HTML('<i class="fas fa-info-circle"></i>')))))),
                                           choices=c("No Table","Survey Characteristics","Retained Surveys","Dropped Surveys","Retained NA Surveys","Dropped NA Surveys","Non-Creel Approaches","Unknown/Uncertain Timing","Unknown/Uncertain Location","Unknown/Uncertain Spatial Extent","Focal Species","Unattributed Taxa","Partially Attributed Taxa", "Incomplete Groups", "Unattributed Target Taxa", "Partially Attributed Target Taxa","Incomplete Target Groups"),selected="No Table"),                              
                              
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Survey Characteristics'",
                                  h3("Survey Characteristics"),
                                 div(withSpinner(DT::dataTableOutput("Vis_1_WarnTBL_SurveyChar"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Non-Creel Approaches'",
                                  h3("Non-Creel Approaches"),
                                 div(withSpinner(DT::dataTableOutput("Vis_1_WarnTBL_Non_Creel"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Unknown/Uncertain Timing'",
                                  h3("Unknown/Uncertain Timing"),
                                 div(withSpinner(DT::dataTableOutput("Vis_1_WarnTBL_Timing"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Unknown/Uncertain Location'",
                                  h3("Unknown/Uncertain Location"),
                                 div(withSpinner(DT::dataTableOutput("Vis_1_WarnTBL_Location"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Unknown/Uncertain Spatial Extent'",
                                  h3("Unknown/Uncertain Spatial Extent"),
                                 div(withSpinner(DT::dataTableOutput("Vis_1_WarnTBL_Extent"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Focal Species'",
                                  h3("Focal Species"),
                                 div(withSpinner(DT::dataTableOutput("Vis_1_WarnTBL_FocalSpecies"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Retained NA Surveys'",
                                  h3("Surveys Retained in Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_1_Retained_NA_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Dropped NA Surveys'",
                                  h3("Surveys Dropped from Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_1_Dropped_NA_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Retained Surveys'",
                                  h3("Surveys Retained in Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_1_Retained_All_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Dropped Surveys'",
                                  h3("Surveys Dropped from Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_1_Dropped_All_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Unattributed Taxa'",
                                  h3("Unattributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis1_UnattributedFishTaxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Partially Attributed Taxa'",
                                  h3("Partially Attributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis1_PartiallyAttributedFishTaxa_TBL"),type=2)), # Vis1_PartiallyAttributedFishTaxa_TBL
                                ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Incomplete Groups'",
                                  h3("Incomplete Group Attribution Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis1_IncompleteAttributedFishTaxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Unattributed Target Taxa'",
                                  h3("Unattributed Target Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis1_UnattributedTarget_Taxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Partially Attributed Target Taxa'",
                                  h3("Partially Attributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis1_PartiallyAttributedTarget_Taxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_1_ShowTables=='Incomplete Target Groups'",
                                  h3("Incomplete Group Attribution Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis1_IncompleteAttributedTarget_Taxa_TBL"),type=2)),
                                ),
                          style='danger')
              ),
              conditionalPanel(condition="input.AF_VisNum_Selection=='2'||input.AF_VisNum_Selection=='3'||input.AF_VisNum_Selection=='4'",
                      bsCollapse(id="DataWarning_Vis_2",open="Vis_2DataWarningCollapse",
                          bsCollapsePanel(HTML("Visualization 2 Input Data"),value="Vis_2DataWarningCollapse",
                              h4(strong("Survey Characteristics")),
                              htmlOutput("Vis_2_Survey_TypeWarning"),
                              htmlOutput("Vis_2_WB_TypeWarning"),
                              htmlOutput("Vis_2_DurationWarning"),
                              htmlOutput("Vis_2_StartWarning"),
                              htmlOutput("Vis_2_EndWarning"),
                              htmlOutput("Vis_2_Interview_MethodWarning"),
                              htmlOutput("Vis_2_Count_MethodWarning"),
                              htmlOutput("Vis_2_Estimate_MethodWarning"),
                              htmlOutput("Vis_2_Survey_GapsWarning"),
                              htmlOutput("Vis_2_Focal_SpeciesWarning"),
                              htmlOutput("Vis_2_FlaggedHeading"),
                              htmlOutput("Vis_2_Timing_WarnWarning"),
                              htmlOutput("Vis_2_Location_WarnWarning"),
                              htmlOutput("Vis_2_Extent_WarnWarning"),
                              htmlOutput("Vis_2_FishTaxaHeading"),
                              htmlOutput("Vis_2_OverlapFishWarning"),
                              htmlOutput("Vis_2_UnattributedFishTaxaWarning"),
                              htmlOutput("Vis_2_PartiallyAttributedFishTaxaWarning"),
                              htmlOutput("Vis_2_AttributedFishTaxaWarning"),
                              htmlOutput("Vis_2_IncompleteAttributedFishTaxaWarning"),
                              htmlOutput("Vis_2_AngPrefTaxaHeading"),
                              htmlOutput("Vis_2_OverlapTargetWarning"),
                              htmlOutput("Vis_2_UnattributedTarget_TaxaWarning"),
                              htmlOutput("Vis_2_PartiallyAttributedTarget_TaxaWarning"),
                              htmlOutput("Vis_2_AttributedTarget_TaxaWarning"),
                              htmlOutput("Vis_2_IncompleteAttributedTarget_TaxaWarning"),
                              h4(strong("Dropped Surveys:")),
                              h5(strong("Null Inputs")),
                              htmlOutput("Vis_2_Dropped_NA_Warning"),
                              htmlOutput("Vis_2_Survey_Char_Drop"),
                              switchInput("NonCreel_Vis_2_Switch","Non-Creel Approaches",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkTiming_Vis_2_Switch","Unknown/Uncertain Timing",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkLocation_Vis_2_Switch","Unknown/Uncertain Location",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkExtent_Vis_2_Switch","Unknown/Uncertain Spatial Extent",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("FocSpecies_Vis_2_Switch","Focal Species",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              htmlOutput("Vis_2_Taxa_Atr_Drop"),
                              switchInput("UnFish_Vis_2_Switch","Unattributed Input Fish Taxa",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("InFishGroup_Vis_2_Switch","Incomplete Input Fish Groups",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnTarget_Vis_2_Switch","Unattributed Input Target Taxa",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("InTargetGroup_Vis_2_Switch","Incomplete Input Target Groups",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              htmlOutput("Vis_2_Dropped_All_Warning"),
                              br(),
                              h4(strong("View Warning Tables")),
                              awesomeRadio("Vis_2_ShowTables",inline=TRUE,status='primary',
                                           h5(strong(HTML("Display table showing: &nbsp", as.character(actionLink(inputId = "Vis_2WarningTableTip", HTML('<i class="fas fa-info-circle"></i>')))))),
                                           choices=c("No Table","Survey Characteristics","Retained Surveys","Dropped Surveys","Retained NA Surveys","Dropped NA Surveys","Non-Creel Approaches","Unknown/Uncertain Timing","Unknown/Uncertain Location","Unknown/Uncertain Spatial Extent","Focal Species","Unattributed Taxa","Partially Attributed Taxa", "Incomplete Groups", "Unattributed Target Taxa", "Partially Attributed Target Taxa","Incomplete Target Groups"),selected="No Table"),                              
                              
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Survey Characteristics'",
                                  h3("Survey Characteristics"),
                                 div(withSpinner(DT::dataTableOutput("Vis_2_WarnTBL_SurveyChar"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Non-Creel Approaches'",
                                  h3("Non-Creel Approaches"),
                                 div(withSpinner(DT::dataTableOutput("Vis_2_WarnTBL_Non_Creel"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Unknown/Uncertain Timing'",
                                  h3("Unknown/Uncertain Timing"),
                                 div(withSpinner(DT::dataTableOutput("Vis_2_WarnTBL_Timing"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Unknown/Uncertain Location'",
                                  h3("Unknown/Uncertain Location"),
                                 div(withSpinner(DT::dataTableOutput("Vis_2_WarnTBL_Location"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Unknown/Uncertain Spatial Extent'",
                                  h3("Unknown/Uncertain Spatial Extent"),
                                 div(withSpinner(DT::dataTableOutput("Vis_2_WarnTBL_Extent"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Focal Species'",
                                  h3("Focal Species"),
                                 div(withSpinner(DT::dataTableOutput("Vis_2_WarnTBL_FocalSpecies"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Retained NA Surveys'",
                                  h3("Surveys Retained in Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_2_Retained_NA_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Dropped NA Surveys'",
                                  h3("Surveys Dropped from Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_2_Dropped_NA_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Retained Surveys'",
                                  h3("Surveys Retained in Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_2_Retained_All_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Dropped Surveys'",
                                  h3("Surveys Dropped from Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_2_Dropped_All_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Unattributed Taxa'",
                                  h3("Unattributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis2_UnattributedFishTaxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Partially Attributed Taxa'",
                                  h3("Partially Attributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis2_PartiallyAttributedFishTaxa_TBL"),type=2)), # Vis2_PartiallyAttributedFishTaxa_TBL
                                ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Incomplete Groups'",
                                  h3("Incomplete Group Attribution Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis2_IncompleteAttributedFishTaxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Unattributed Target Taxa'",
                                  h3("Unattributed Target Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis2_UnattributedTarget_Taxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Partially Attributed Target Taxa'",
                                  h3("Partially Attributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis2_PartiallyAttributedTarget_Taxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_2_ShowTables=='Incomplete Target Groups'",
                                  h3("Incomplete Group Attribution Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis2_IncompleteAttributedTarget_Taxa_TBL"),type=2)),
                                ),
                          style='danger')
              ),
              ),
            conditionalPanel(condition="input.AF_VisNum_Selection=='3'||input.AF_VisNum_Selection=='4'",
              bsCollapse(id="DataWarning_Vis_3",open="Vis_3DataWarningCollapse",
                          bsCollapsePanel(HTML("Visualization 3 Input Data"),value="Vis_3DataWarningCollapse",
                              h4(strong("Survey Characteristics")),
                              htmlOutput("Vis_3_Survey_TypeWarning"),
                              htmlOutput("Vis_3_WB_TypeWarning"),
                              htmlOutput("Vis_3_DurationWarning"),
                              htmlOutput("Vis_3_StartWarning"),
                              htmlOutput("Vis_3_EndWarning"),
                              htmlOutput("Vis_3_Interview_MethodWarning"),
                              htmlOutput("Vis_3_Count_MethodWarning"),
                              htmlOutput("Vis_3_Estimate_MethodWarning"),
                              htmlOutput("Vis_3_Survey_GapsWarning"),
                              htmlOutput("Vis_3_Focal_SpeciesWarning"),
                              htmlOutput("Vis_3_FlaggedHeading"),
                              htmlOutput("Vis_3_Timing_WarnWarning"),
                              htmlOutput("Vis_3_Location_WarnWarning"),
                              htmlOutput("Vis_3_Extent_WarnWarning"),
                              htmlOutput("Vis_3_FishTaxaHeading"),
                              htmlOutput("Vis_3_OverlapFishWarning"),
                              htmlOutput("Vis_3_UnattributedFishTaxaWarning"),
                              htmlOutput("Vis_3_PartiallyAttributedFishTaxaWarning"),
                              htmlOutput("Vis_3_AttributedFishTaxaWarning"),
                              htmlOutput("Vis_3_IncompleteAttributedFishTaxaWarning"),
                              htmlOutput("Vis_3_AngPrefTaxaHeading"),
                              htmlOutput("Vis_3_OverlapTargetWarning"),
                              htmlOutput("Vis_3_UnattributedTarget_TaxaWarning"),
                              htmlOutput("Vis_3_PartiallyAttributedTarget_TaxaWarning"),
                              htmlOutput("Vis_3_AttributedTarget_TaxaWarning"),
                              htmlOutput("Vis_3_IncompleteAttributedTarget_TaxaWarning"),
                              h4(strong("Dropped Surveys:")),
                              h5(strong("Null Inputs")),
                              htmlOutput("Vis_3_Dropped_NA_Warning"),
                              htmlOutput("Vis_3_Survey_Char_Drop"),
                              switchInput("NonCreel_Vis_3_Switch","Non-Creel Approaches",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkTiming_Vis_3_Switch","Unknown/Uncertain Timing",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkLocation_Vis_3_Switch","Unknown/Uncertain Location",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkExtent_Vis_3_Switch","Unknown/Uncertain Spatial Extent",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("FocSpecies_Vis_3_Switch","Focal Species",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              htmlOutput("Vis_3_Taxa_Atr_Drop"),
                              switchInput("UnFish_Vis_3_Switch","Unattributed Input Fish Taxa",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("InFishGroup_Vis_3_Switch","Incomplete Input Fish Groups",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnTarget_Vis_3_Switch","Unattributed Input Target Taxa",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("InTargetGroup_Vis_3_Switch","Incomplete Input Target Groups",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              htmlOutput("Vis_3_Dropped_All_Warning"),
                              br(),
                              h4(strong("View Warning Tables")),
                              awesomeRadio("Vis_3_ShowTables",inline=TRUE,status='primary',
                                           h5(strong(HTML("Display table showing: &nbsp", as.character(actionLink(inputId = "Vis_3WarningTableTip", HTML('<i class="fas fa-info-circle"></i>')))))),
                                           choices=c("No Table","Survey Characteristics","Retained Surveys","Dropped Surveys","Retained NA Surveys","Dropped NA Surveys","Non-Creel Approaches","Unknown/Uncertain Timing","Unknown/Uncertain Location","Unknown/Uncertain Spatial Extent","Focal Species","Unattributed Taxa","Partially Attributed Taxa", "Incomplete Groups", "Unattributed Target Taxa", "Partially Attributed Target Taxa","Incomplete Target Groups"),selected="No Table"),                              
                              
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Survey Characteristics'",
                                  h3("Survey Characteristics"),
                                 div(withSpinner(DT::dataTableOutput("Vis_3_WarnTBL_SurveyChar"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Non-Creel Approaches'",
                                  h3("Non-Creel Approaches"),
                                 div(withSpinner(DT::dataTableOutput("Vis_3_WarnTBL_Non_Creel"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Unknown/Uncertain Timing'",
                                  h3("Unknown/Uncertain Timing"),
                                 div(withSpinner(DT::dataTableOutput("Vis_3_WarnTBL_Timing"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Unknown/Uncertain Location'",
                                  h3("Unknown/Uncertain Location"),
                                 div(withSpinner(DT::dataTableOutput("Vis_3_WarnTBL_Location"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Unknown/Uncertain Spatial Extent'",
                                  h3("Unknown/Uncertain Spatial Extent"),
                                 div(withSpinner(DT::dataTableOutput("Vis_3_WarnTBL_Extent"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Focal Species'",
                                  h3("Focal Species"),
                                 div(withSpinner(DT::dataTableOutput("Vis_3_WarnTBL_FocalSpecies"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Retained NA Surveys'",
                                  h3("Surveys Retained in Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_3_Retained_NA_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Dropped NA Surveys'",
                                  h3("Surveys Dropped from Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_3_Dropped_NA_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Retained Surveys'",
                                  h3("Surveys Retained in Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_3_Retained_All_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Dropped Surveys'",
                                  h3("Surveys Dropped from Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_3_Dropped_All_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Unattributed Taxa'",
                                  h3("Unattributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis3_UnattributedFishTaxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Partially Attributed Taxa'",
                                  h3("Partially Attributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis3_PartiallyAttributedFishTaxa_TBL"),type=2)), # Vis3_PartiallyAttributedFishTaxa_TBL
                                ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Incomplete Groups'",
                                  h3("Incomplete Group Attribution Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis3_IncompleteAttributedFishTaxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Unattributed Target Taxa'",
                                  h3("Unattributed Target Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis3_UnattributedTarget_Taxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Partially Attributed Target Taxa'",
                                  h3("Partially Attributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis3_PartiallyAttributedTarget_Taxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_3_ShowTables=='Incomplete Target Groups'",
                                  h3("Incomplete Group Attribution Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis3_IncompleteAttributedTarget_Taxa_TBL"),type=2)),
                                ),
                          style='danger')
              ),
            ),
            conditionalPanel(condition="input.AF_VisNum_Selection=='4'",
                bsCollapse(id="DataWarning_Vis_4",open="Vis_4DataWarningCollapse",
                          bsCollapsePanel(HTML("Visualization 4 Input Data"),value="Vis_4DataWarningCollapse",
                              h4(strong("Survey Characteristics")),
                              htmlOutput("Vis_4_Survey_TypeWarning"),
                              htmlOutput("Vis_4_WB_TypeWarning"),
                              htmlOutput("Vis_4_DurationWarning"),
                              htmlOutput("Vis_4_StartWarning"),
                              htmlOutput("Vis_4_EndWarning"),
                              htmlOutput("Vis_4_Interview_MethodWarning"),
                              htmlOutput("Vis_4_Count_MethodWarning"),
                              htmlOutput("Vis_4_Estimate_MethodWarning"),
                              htmlOutput("Vis_4_Survey_GapsWarning"),
                              htmlOutput("Vis_4_Focal_SpeciesWarning"),
                              htmlOutput("Vis_4_FlaggedHeading"),
                              htmlOutput("Vis_4_Timing_WarnWarning"),
                              htmlOutput("Vis_4_Location_WarnWarning"),
                              htmlOutput("Vis_4_Extent_WarnWarning"),
                              htmlOutput("Vis_4_FishTaxaHeading"),
                              htmlOutput("Vis_4_OverlapFishWarning"),
                              htmlOutput("Vis_4_UnattributedFishTaxaWarning"),
                              htmlOutput("Vis_4_PartiallyAttributedFishTaxaWarning"),
                              htmlOutput("Vis_4_AttributedFishTaxaWarning"),
                              htmlOutput("Vis_4_IncompleteAttributedFishTaxaWarning"),
                              htmlOutput("Vis_4_AngPrefTaxaHeading"),
                              htmlOutput("Vis_4_OverlapTargetWarning"),
                              htmlOutput("Vis_4_UnattributedTarget_TaxaWarning"),
                              htmlOutput("Vis_4_PartiallyAttributedTarget_TaxaWarning"),
                              htmlOutput("Vis_4_AttributedTarget_TaxaWarning"),
                              htmlOutput("Vis_4_IncompleteAttributedTarget_TaxaWarning"),
                              h4(strong("Dropped Surveys:")),
                              h5(strong("Null Inputs")),
                              htmlOutput("Vis_4_Dropped_NA_Warning"),
                              htmlOutput("Vis_4_Survey_Char_Drop"),
                              switchInput("NonCreel_Vis_4_Switch","Non-Creel Approaches",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkTiming_Vis_4_Switch","Unknown/Uncertain Timing",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkLocation_Vis_4_Switch","Unknown/Uncertain Location",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnkExtent_Vis_4_Switch","Unknown/Uncertain Spatial Extent",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("FocSpecies_Vis_4_Switch","Focal Species",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              htmlOutput("Vis_4_Taxa_Atr_Drop"),
                              switchInput("UnFish_Vis_4_Switch","Unattributed Input Fish Taxa",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("InFishGroup_Vis_4_Switch","Incomplete Input Fish Groups",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("UnTarget_Vis_4_Switch","Unattributed Input Target Taxa",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              switchInput("InTargetGroup_Vis_4_Switch","Incomplete Input Target Groups",value=FALSE,inline=TRUE,onLabel="Dropped",offLabel="Retained"),
                              htmlOutput("Vis_4_Dropped_All_Warning"),
                              br(),
                              h4(strong("View Warning Tables")),
                              awesomeRadio("Vis_4_ShowTables",inline=TRUE,status='primary',
                                           h5(strong(HTML("Display table showing: &nbsp", as.character(actionLink(inputId = "Vis_4WarningTableTip", HTML('<i class="fas fa-info-circle"></i>')))))),
                                           choices=c("No Table","Survey Characteristics","Retained Surveys","Dropped Surveys","Retained NA Surveys","Dropped NA Surveys","Non-Creel Approaches","Unknown/Uncertain Timing","Unknown/Uncertain Location","Unknown/Uncertain Spatial Extent","Focal Species","Unattributed Taxa","Partially Attributed Taxa", "Incomplete Groups", "Unattributed Target Taxa", "Partially Attributed Target Taxa","Incomplete Target Groups"),selected="No Table"),                              
                              
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Survey Characteristics'",
                                  h3("Survey Characteristics"),
                                 div(withSpinner(DT::dataTableOutput("Vis_4_WarnTBL_SurveyChar"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Non-Creel Approaches'",
                                  h3("Non-Creel Approaches"),
                                 div(withSpinner(DT::dataTableOutput("Vis_4_WarnTBL_Non_Creel"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Unknown/Uncertain Timing'",
                                  h3("Unknown/Uncertain Timing"),
                                 div(withSpinner(DT::dataTableOutput("Vis_4_WarnTBL_Timing"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Unknown/Uncertain Location'",
                                  h3("Unknown/Uncertain Location"),
                                 div(withSpinner(DT::dataTableOutput("Vis_4_WarnTBL_Location"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Unknown/Uncertain Spatial Extent'",
                                  h3("Unknown/Uncertain Spatial Extent"),
                                 div(withSpinner(DT::dataTableOutput("Vis_4_WarnTBL_Extent"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Focal Species'",
                                  h3("Focal Species"),
                                 div(withSpinner(DT::dataTableOutput("Vis_4_WarnTBL_FocalSpecies"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Retained NA Surveys'",
                                  h3("Surveys Retained in Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_4_Retained_NA_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Dropped NA Surveys'",
                                  h3("Surveys Dropped from Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_4_Dropped_NA_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Retained Surveys'",
                                  h3("Surveys Retained in Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_4_Retained_All_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Dropped Surveys'",
                                  h3("Surveys Dropped from Summarization"),
                                 div(withSpinner(DT::dataTableOutput("Vis_4_Dropped_All_TBL"),type=2)),
                              ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Unattributed Taxa'",
                                  h3("Unattributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis4_UnattributedFishTaxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Partially Attributed Taxa'",
                                  h3("Partially Attributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis4_PartiallyAttributedFishTaxa_TBL"),type=2)), # Vis4_PartiallyAttributedFishTaxa_TBL
                                ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Incomplete Groups'",
                                  h3("Incomplete Group Attribution Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis4_IncompleteAttributedFishTaxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Unattributed Target Taxa'",
                                  h3("Unattributed Target Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis4_UnattributedTarget_Taxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Partially Attributed Target Taxa'",
                                  h3("Partially Attributed Taxa Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis4_PartiallyAttributedTarget_Taxa_TBL"),type=2)),
                                ),
                              conditionalPanel(condition="input.Vis_4_ShowTables=='Incomplete Target Groups'",
                                  h3("Incomplete Group Attribution Table"),
                                 div(withSpinner(DT::dataTableOutput("Vis4_IncompleteAttributedTarget_Taxa_TBL"),type=2)),
                                ),
                          style='danger')
              ),
            ),
          ),
                      
          style='danger')
             )
         ),
  ### One Visualization ###                
    conditionalPanel(condition="input.AF_VisNum_Selection=='1'",
                     column(12,style = "border: 2px solid black;height:600px;",
                            conditionalPanel(condition="input.SelectVis1=='Nothing Selected'",                 
                                             h2(strong("Select Visualization Type")),
                                             h3(strong("Required Action: "), "Select the type of visualization you wish to create."),
                                             h4(strong("From Sidebar Select: "), "Visualization 1 Inputs->Select Visualization 1"),
                            ),
                            conditionalPanel(condition="input.SelectVis1=='Map'",
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType==null)||
                                                              (input.Vis1_Map_CreelDisplayType=='Scaled Color'&&(input.Vis1_MapDisplayField=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))||
                                                              (input.Vis1_Map_CreelDisplayType=='Scaled Size'&&(input.Vis1_MapDisplayField_Size=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))||
                                                              (input.Vis1_Map_CreelDisplayType=='Both'&&(input.Vis1_MapDisplayField_Size=='Nothing Selected'||input.Vis1_MapDisplayField=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))",
                                                              h2(strong("Visualization 1 Map Requirements"))
                                                              ),
                                             conditionalPanel(condition="input.Vis1_Map_CreelDisplayType==null",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select Creel Data Marker Display Type "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1 Inputs->Creel Data Display->Select either 'Scaled Color', 'Scaled Size' or 'Both'")),
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType=='Scaled Color'||input.Vis1_Map_CreelDisplayType=='Both')&&input.Vis1_MapDisplayField=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select Map Display Field "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1 Inputs->Creel Data Display->Select Field for Display (Color)")),
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType=='Scaled Size'||input.Vis1_Map_CreelDisplayType=='Both')&&input.Vis1_MapDisplayField_Size=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select Map Display Size Field "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1 Inputs->Creel Data Display->Select Field for Display (Size)")),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h4(strong("From Table Located Below:"), "Input (Vis. 1) Table->Select One or More Rows")),
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType=='Scaled Color'&&input.Vis1_MapDisplayField!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)||
                                                              (input.Vis1_Map_CreelDisplayType=='Scaled Size'&&input.Vis1_MapDisplayField_Size!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)||
                                                              (input.Vis1_Map_CreelDisplayType=='Both'&&input.Vis1_MapDisplayField_Size!='Nothing Selected'&&input.Vis1_MapDisplayField!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)",
                                                              br(),
                                                              withSpinner(leafletOutput("MapVis1_1", height=560),type=2),
                                                              br(),
                                             ),
                                             
                            ),
                            conditionalPanel(condition="input.SelectVis1=='Scatter Plot'",
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1 || input.Vis1_ScatterX=='Nothing Selected'|| input.Vis1_ScatterY=='Nothing Selected'||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis1_Scatter_MarkerColor_Numeric=='Nothing Selected')||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Factors'&&input.Vis1_Scatter_MarkerColor_Factors=='Nothing Selected')||
                                                              (input.Vis1_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis1_Scatter_MarkerScaleSize=='Nothing Selected')
                                                              ",
                                                              h2(strong("Visualization 1 Scatter Requirements"))),
                                             conditionalPanel(condition="input.Vis1_ScatterX=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select X variable "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1 Inputs->Data Inputs->Select X Variable")),
                                             conditionalPanel(condition="input.Vis1_ScatterY=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select Y variable "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1 Inputs->Data Inputs->Select Y Variable")),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h4(strong("From Table Located Below:"), "Input (Vis. 1) Table->Select One or More Rows")),
                                             conditionalPanel(condition="input.Vis1_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis1_Scatter_MarkerColor_Numeric=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h4(strong("From Sidebar Select:"), "Visualization 1 Inputs->Marker Style->Select 'Color By:'")),
                                             conditionalPanel(condition="input.Vis1_Scatter_ColorGroupSwitch=='Factors'&&input.Vis1_Scatter_MarkerColor_Factors=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h4(strong("From Sidebar Select:"), "Visualization 1 Inputs->Marker Style->Select 'Color By:'")),
                                            conditionalPanel(condition="input.Vis1_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis1_Scatter_MarkerScaleSize=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select field to base marker size on"),
                                                              h4(strong("From Sidebar Select:"), "Visualization 1 Inputs->Marker Style->Select Size Scale Field:")),
                                            conditionalPanel(condition="output.Vis_1_Input_SelectCount>0 && input.Vis1_ScatterX!='Nothing Selected'&& input.Vis1_ScatterY!='Nothing Selected'&&
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Uniform'||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis1_Scatter_MarkerColor_Numeric!='Nothing Selected')||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Factors'&&input.Vis1_Scatter_MarkerColor_Factors!='Nothing Selected'))&&
                                                              (input.Vis1_Scatter_MarkerSizeSwitch=='Uniform'||
                                                              (input.Vis1_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis1_Scatter_MarkerScaleSize!='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_1_1_Scatter", height=560),type=2),
                                                              br(),
                                             )
                            ),                  


                            conditionalPanel(condition="input.SelectVis1=='Line Plot'",
                                             conditionalPanel(condition="
                                                              input.Vis1_Line_Number==null
                                                              ||(input.Vis1_Line_Number==1&&(input.Vis1_LineY1=='Nothing Selected'|| output.Vis_1_Input_SelectCount<1))
                                                              ||(input.Vis1_Line_Number==2&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))
                                                              ||(input.Vis1_Line_Number==3&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))
                                                              ||(input.Vis1_Line_Number==4&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'|| output.Vis_1_Input_SelectCount<1))
                                                              ||(input.Vis1_Line_Number==5&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'|| input.Vis1_LineY5=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))
                                                              ",
                                                              h2(strong("Visualization 1 Line Plot Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis1_Line_Number==null
                                                              ||(input.Vis1_Line_Number==1&&(input.Vis1_LineY1=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==2&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==3&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==4&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==5&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'|| input.Vis1_LineY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Number of Y Variables"),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select at least one row from the Visualization 1 data table"),
                                                              h4(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis1_Line_Number==1&&input.Vis1_LineY1!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0)
                                                              ||(input.Vis1_Line_Number==2&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0)
                                                              ||(input.Vis1_Line_Number==3&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0)
                                                              ||(input.Vis1_Line_Number==4&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0)
                                                              ||(input.Vis1_Line_Number==5&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&& input.Vis1_LineY5!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0)
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_1_1_Line", height=560),type=2),
                                                              br())
                            ),
                            
                                        conditionalPanel(condition="input.SelectVis1=='Bar Chart'",
                                             conditionalPanel(condition="
                                                              input.Vis1_Bar_Number==null
                                                              ||(input.Vis1_Bar_Number==1&&(input.Vis1_BarY1=='Nothing Selected'|| output.Vis_1_Input_SelectCount<1))
                                                              ||(input.Vis1_Bar_Number==2&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| output.Vis_1_Input_SelectCount<1))
                                                              ||(input.Vis1_Bar_Number==3&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| output.Vis_1_Input_SelectCount<1))
                                                              ||(input.Vis1_Bar_Number==4&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'|| output.Vis_1_Input_SelectCount<1))
                                                              ||(input.Vis1_Bar_Number==5&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'|| input.Vis1_BarY5=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))
                                                              ",
                                                              h2(strong("Visualization 1 Bar Chart Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis1_Bar_Number==null
                                                              ||(input.Vis1_Bar_Number==1&&(input.Vis1_BarY1=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==2&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==3&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==4&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==5&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'|| input.Vis1_BarY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Number of Y Variables"),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select at least one row from the Visualization 1 data table"),
                                                              h4(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select One or More Rows")
                                                              ),

                                             conditionalPanel(condition="
                                                              (input.Vis1_Bar_Number==1&&input.Vis1_BarY1!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0)
                                                              ||(input.Vis1_Bar_Number==2&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0)
                                                              ||(input.Vis1_Bar_Number==3&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0)
                                                              ||(input.Vis1_Bar_Number==4&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0)
                                                              ||(input.Vis1_Bar_Number==5&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&& input.Vis1_BarY5!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0)
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_1_1_Bar", height=560),type=2),
                                                              br())
                            ),

                     

                            conditionalPanel(condition="input.SelectVis1=='Pie Chart'",
                                             conditionalPanel(condition="input.Vis1_Pie_CategoryType==null",
                                                              h2(strong("Visualization 1 Pie Chart Requirements")),
                                                              h3(strong("Required Action: "), "Select the category type"),
                                                              h4(strong("From the sidebar select:"), "Data Inputs->Metrics or Surveys")
                                             ),
                                             conditionalPanel(condition="input.Vis1_Pie_CategoryType=='Metrics'",
                                                      conditionalPanel(condition="input.Vis1_Pie_Metrics=='' ||output.Vis_1_Input_SelectCount<1 ",
                                                             h2(strong("Visualization 1 Pie Chart Requirements"))
                                                             ),
                                                      conditionalPanel(condition="input.Vis1_Pie_Metrics==''",
                                                                       br(),
                                                                     h3(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h4(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Metrics")
                                                      ),
                                                      conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                                       br(),
                                                              conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h3(strong("Required Action: "), "User must select at least one row from the Shared Data table"),
                                                              h4(strong("From Table Located Below: "), "Input Data->Select One or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h3(strong("Required Action: "), "User must select at least one row from the Visualization 1 input table"),
                                                              h4(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select One or More Rows")
                                                              ),
                                                      ),
                                                      conditionalPanel(condition="input.Vis1_Pie_Metrics!='' && output.Vis_1_Input_SelectCount>0",
                                                                       br(),
                                                                       withSpinner(plotlyOutput("Vis_1_1_Pie_Metrics", height=560),type=2),
                                                                       br()
                                                                       )
                                                     ),
                                             conditionalPanel(condition="input.Vis1_Pie_CategoryType=='Surveys'",
                                                    conditionalPanel(condition="input.Vis1_Pie_Metrics_to_Sum=='' ||output.Vis_1_Input_SelectCount<1",
                                                                     h2(strong("Visualization 1 Pie Chart Requirements"))
                                                                     ),
                                                    conditionalPanel(condition="input.Vis1_Pie_Metrics_to_Sum==''",
                                                                     br(),
                                                                     h3(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h4(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Metrics")
                                                                      ),
                                                    conditionalPanel(condition="output.Vis_1_Input_SelectCount<2",
                                                                     br(),
                                                            conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h3(strong("Required Action: "), "User must select at least two rows from the Shared Data table"),
                                                              h4(strong("From Table Located Below: "), "Input Data->Select Two or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h3(strong("Required Action: "), "User must select at least two rows from the Visualization 1 input table"),
                                                              h4(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select Two or More Rows")
                                                              ),
                                                              ),
                                                    conditionalPanel(condition="input.Vis1_Pie_Metrics_to_Sum!='' && output.Vis_1_Input_SelectCount>0",
                                                                      br(),
                                                                     withSpinner(plotlyOutput("Vis_1_1_Pie_Surveys", height=560),type=2),
                                                                     br()
                                                                     )
                                                    ),

                                            )
            
                            )),
    
# Two Visualizations #
    conditionalPanel(condition="input.AF_VisNum_Selection=='2'&&(input.AF_SharedData=='No'||(input.AF_SharedData=='Yes'&&input.AF_LinkedSelection!=null))",
                     fluidRow(
                       column(6, style = "border: 2px solid black;height:600px;",
                             conditionalPanel(condition="input.SelectVis1=='Nothing Selected'",                 
                                             h2(strong("Select Visualization Type")),
                                             h3(strong("Required Action: "), "Select the type of visualization you wish to create."),
                                             h4(strong("From Sidebar Select: "), "Visualization 1 Inputs->Select Visualization 1"),
                            ),
                            conditionalPanel(condition="input.SelectVis1=='Map'",
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType==null)||
                                                              (input.Vis1_Map_CreelDisplayType=='Scaled Color'&&(input.Vis1_MapDisplayField=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))||
                                                              (input.Vis1_Map_CreelDisplayType=='Scaled Size'&&(input.Vis1_MapDisplayField_Size=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))||
                                                              (input.Vis1_Map_CreelDisplayType=='Both'&&(input.Vis1_MapDisplayField_Size=='Nothing Selected'||input.Vis1_MapDisplayField=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))",
                                                              h2(strong("Visualization 1 Map Requirements"))
                                                              ),
                                             conditionalPanel(condition="input.Vis1_Map_CreelDisplayType==null",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select Creel Data Marker Display Type "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1 Inputs->Creel Data Display->Select either 'Scaled Color', 'Scaled Size' or 'Both'")),
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType=='Scaled Color'||input.Vis1_Map_CreelDisplayType=='Both')&&input.Vis1_MapDisplayField=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select Map Display Field "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1 Inputs->Creel Data Display->Select Field for Display (Color)")),
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType=='Scaled Size'||input.Vis1_Map_CreelDisplayType=='Both')&&input.Vis1_MapDisplayField_Size=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select Map Display Size Field "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1 Inputs->Creel Data Display->Select Field for Display (Size)")),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h4(strong("From Table Located Below:"), "Input (Vis. 1) Table->Select One or More Rows")),
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType=='Scaled Color'&&input.Vis1_MapDisplayField!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)||
                                                              (input.Vis1_Map_CreelDisplayType=='Scaled Size'&&input.Vis1_MapDisplayField_Size!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)||
                                                              (input.Vis1_Map_CreelDisplayType=='Both'&&input.Vis1_MapDisplayField_Size!='Nothing Selected'&&input.Vis1_MapDisplayField!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)",
                                                              br(),
                                                              withSpinner(leafletOutput("MapVis2_1", height=560),type=2),
                                                              br(),
                                             ),
                                             
                            ),


                            conditionalPanel(condition="input.SelectVis1=='Scatter Plot'",
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1 || input.Vis1_ScatterX=='Nothing Selected'|| input.Vis1_ScatterY=='Nothing Selected'||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis1_Scatter_MarkerColor_Numeric=='Nothing Selected')||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Factors'&&input.Vis1_Scatter_MarkerColor_Factors=='Nothing Selected')||
                                                              (input.Vis1_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis1_Scatter_MarkerScaleSize=='Nothing Selected')
                                                              ",
                                                              h2(strong("Visualization 1 Scatter Requirements"))),
                                             conditionalPanel(condition="input.Vis1_ScatterX=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select X variable "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1 Inputs->Data Inputs->Select X Variable")),
                                             conditionalPanel(condition="input.Vis1_ScatterY=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select Y variable "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1 Inputs->Data Inputs->Select Y Variable")),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h4(strong("From Table Located Below:"), "Input (Vis. 1) Table->Select One or More Rows")),
                                             conditionalPanel(condition="input.Vis1_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis1_Scatter_MarkerColor_Numeric=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h4(strong("From Sidebar Select:"), "Visualization 1 Inputs->Marker Style->Select 'Color By:'")),
                                             conditionalPanel(condition="input.Vis1_Scatter_ColorGroupSwitch=='Factors'&&input.Vis1_Scatter_MarkerColor_Factors=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h4(strong("From Sidebar Select:"), "Visualization 1 Inputs->Marker Style->Select 'Color By:'")),
                                            conditionalPanel(condition="input.Vis1_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis1_Scatter_MarkerScaleSize=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select field to base marker size on"),
                                                              h4(strong("From Sidebar Select:"), "Visualization 1 Inputs->Marker Style->Select Size Scale Field:")),
                                            conditionalPanel(condition="output.Vis_1_Input_SelectCount>0 && input.Vis1_ScatterX!='Nothing Selected'&& input.Vis1_ScatterY!='Nothing Selected'&&
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Uniform'||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis1_Scatter_MarkerColor_Numeric!='Nothing Selected')||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Factors'&&input.Vis1_Scatter_MarkerColor_Factors!='Nothing Selected'))&&
                                                              (input.Vis1_Scatter_MarkerSizeSwitch=='Uniform'||
                                                              (input.Vis1_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis1_Scatter_MarkerScaleSize!='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_2_1_Scatter", height=560),type=2),
                                                              br(),
                                             )
                            ),                 


                            conditionalPanel(condition="input.SelectVis1=='Line Plot'",
                                             conditionalPanel(condition="
                                                              input.Vis1_Line_Number==null
                                                              ||(input.Vis1_Line_Number==1&&(input.Vis1_LineY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Line_Number==2&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Line_Number==3&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Line_Number==4&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Line_Number==5&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'|| input.Vis1_LineY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h2(strong("Visualization 1 Line Plot Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis1_Line_Number==null
                                                              ||(input.Vis1_Line_Number==1&&(input.Vis1_LineY1=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==2&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==3&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==4&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==5&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'|| input.Vis1_LineY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Number of Y Variables"),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select at least one row from the Visualization 1 data table"),
                                                              h4(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis1_Line_Number==1&&input.Vis1_LineY1!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==2&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==3&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==4&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==5&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&& input.Vis1_LineY5!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h3(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                            h4(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h4(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis1_Line_Number==1&&input.Vis1_LineY1!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Line_Number==2&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Line_Number==3&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Line_Number==4&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Line_Number==5&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&& input.Vis1_LineY5!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis1_Line_Number==1&&input.Vis1_LineY1!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==2&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==3&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==4&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==5&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&& input.Vis1_LineY5!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_2_1_Line", height=560),type=2),
                                                              br())
                            ),
                            
                                        conditionalPanel(condition="input.SelectVis1=='Bar Chart'",
                                             conditionalPanel(condition="
                                                              input.Vis1_Bar_Number==null
                                                              ||(input.Vis1_Bar_Number==1&&(input.Vis1_BarY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Bar_Number==2&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Bar_Number==3&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Bar_Number==4&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Bar_Number==5&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'|| input.Vis1_BarY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h2(strong("Visualization 1 Bar Chart Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis1_Bar_Number==null
                                                              ||(input.Vis1_Bar_Number==1&&(input.Vis1_BarY1=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==2&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==3&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==4&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==5&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'|| input.Vis1_BarY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Number of Y Variables"),
                                                              h4(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select at least one row from the Visualization 1 data table"),
                                                              h4(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis1_Bar_Number==1&&input.Vis1_BarY1!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==2&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==3&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==4&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==5&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&& input.Vis1_BarY5!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h3(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                            h4(strong("From a scatter plot "), "use either the box or lasso select tool (in-Chart toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h4(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis1_Bar_Number==1&&input.Vis1_BarY1!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Bar_Number==2&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Bar_Number==3&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Bar_Number==4&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Bar_Number==5&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&& input.Vis1_BarY5!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis1_Bar_Number==1&&input.Vis1_BarY1!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==2&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==3&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==4&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==5&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&& input.Vis1_BarY5!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_2_1_Bar", height=560),type=2),
                                                              br())
                            ),

                     

                            conditionalPanel(condition="input.SelectVis1=='Pie Chart'",
                                             conditionalPanel(condition="input.Vis1_Pie_CategoryType==null",
                                                              h2(strong("Visualization 1 Pie Chart Requirements")),
                                                              h3(strong("Required Action: "), "Select the category type"),
                                                              h4(strong("From the sidebar select:"), "Data Inputs->Metrics or Surveys")
                                             ),
                                             conditionalPanel(condition="input.Vis1_Pie_CategoryType=='Metrics'",
                                                      conditionalPanel(condition="input.Vis1_Pie_Metrics=='' ||((output.Vis_1_Input_SelectCount<1 && input.AF_LinkedSelection=='No')|| (output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes'))",
                                                             h2(strong("Visualization 1 Pie Chart Requirements"))),
                                                      conditionalPanel(condition="input.Vis1_Pie_Metrics==''",
                                                                       br(),
                                                                     h3(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h4(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Metrics")
                                                      ),
                                                      conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                                       br(),
                                                              conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h3(strong("Required Action: "), "User must select at least one row from the Shared Data table"),
                                                              h4(strong("From Table Located Below: "), "Input Data->Select One or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h3(strong("Required Action: "), "User must select at least one row from the Visualization 1 input table"),
                                                              h4(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select One or More Rows")
                                                              ),
                                                      ),
                                           conditionalPanel(condition="input.Vis1_Pie_Metrics!=''&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h4(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h4(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                      conditionalPanel(condition="(input.Vis1_Pie_Metrics!='' && output.Vis_1_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis1_Pie_Metrics!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_2Vis>0)",
                                                                       br(),
                                                                       withSpinner(plotlyOutput("Vis_2_1_Pie_Metrics", height=560),type=2),
                                                                       br()
                                                                       )
                                                     ),
                                             conditionalPanel(condition="input.Vis1_Pie_CategoryType=='Surveys'",
                                                    conditionalPanel(condition="input.Vis1_Pie_Metrics_to_Sum=='' ||((output.Vis_1_Input_SelectCount<1 && input.AF_LinkedSelection=='No')|| (output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes'))",
                                                                     h2(strong("Visualization 1 Pie Chart Requirements"))
                                                                     ),
                                                    conditionalPanel(condition="input.Vis1_Pie_Metrics_to_Sum==''",
                                                                     br(),
                                                                     h3(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h4(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Metrics")
                                                                      ),
                                                    conditionalPanel(condition="output.Vis_1_Input_SelectCount<2",
                                                                     br(),
                                                            conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h3(strong("Required Action: "), "User must select at least two rows from the Shared Data table"),
                                                              h4(strong("From Table Located Below: "), "Input Data->Select Two or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h3(strong("Required Action: "), "User must select at least two rows from the Visualization 1 input table"),
                                                              h4(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select Two or More Rows")
                                                              ),
                                                              ),
                                                        conditionalPanel(condition="input.Vis1_Pie_Metrics!=''&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h4(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h4(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                    conditionalPanel(condition="(input.Vis1_Pie_Metrics_to_Sum!='' && output.Vis_1_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis1_Pie_Metrics_to_Sum!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_2Vis>0)",
                                                                      br(),
                                                                     withSpinner(plotlyOutput("Vis_2_1_Pie_Surveys", height=560),type=2),
                                                                     br()
                                                                     )
                                                    ),

                                            )
                                           
            
                            ),
                       column(6,style = "border: 2px solid black;height:600px;",
                              conditionalPanel(condition="input.SelectVis2=='Nothing Selected'",                 
                                             h2(strong("Select Visualization Type")),
                                             h3(strong("Required Action: "), "Select the type of visualization you wish to create."),
                                             h4(strong("From Sidebar Select: "), "Visualization 2 Inputs->Select Visualization 2"),     
                                          ),
                            conditionalPanel(condition="input.SelectVis2=='Map'",
                                             conditionalPanel(condition="(input.Vis2_Map_CreelDisplayType==null)||
                                                              (input.Vis2_Map_CreelDisplayType=='Scaled Color'&&(input.Vis2_MapDisplayField=='Nothing Selected'||output.Vis_2_Input_SelectCount<1))||
                                                              (input.Vis2_Map_CreelDisplayType=='Scaled Size'&&(input.Vis2_MapDisplayField_Size=='Nothing Selected'||output.Vis_2_Input_SelectCount<1))||
                                                              (input.Vis2_Map_CreelDisplayType=='Both'&&(input.Vis2_MapDisplayField_Size=='Nothing Selected'||input.Vis2_MapDisplayField=='Nothing Selected'||output.Vis_2_Input_SelectCount<1))",
                                                              h2(strong("Visualization 2 Map Requirements"))
                                                              ),
                                             conditionalPanel(condition="input.Vis2_Map_CreelDisplayType==null",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select Creel Data Marker Display Type "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 2 Inputs->Creel Data Display->Select either 'Scaled Color', 'Scaled Size' or 'Both'")),
                                             conditionalPanel(condition="(input.Vis2_Map_CreelDisplayType=='Scaled Color'||input.Vis2_Map_CreelDisplayType=='Both')&&input.Vis2_MapDisplayField=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select Map Display Field "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 2 Inputs->Creel Data Display->Select Field for Display (Color)")),
                                             conditionalPanel(condition="(input.Vis2_Map_CreelDisplayType=='Scaled Size'||input.Vis2_Map_CreelDisplayType=='Both')&&input.Vis2_MapDisplayField_Size=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select Map Display Size Field "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 2 Inputs->Creel Data Display->Select Field for Display (Size)")),
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h4(strong("From Table Located Below:"), "Input (Vis. 2) Table->Select One or More Rows")),
                                             conditionalPanel(condition="(input.Vis2_Map_CreelDisplayType=='Scaled Color'&&input.Vis2_MapDisplayField!='Nothing Selected'&&output.Vis_2_Input_SelectCount>0)||
                                                              (input.Vis2_Map_CreelDisplayType=='Scaled Size'&&input.Vis2_MapDisplayField_Size!='Nothing Selected'&&output.Vis_2_Input_SelectCount>0)||
                                                              (input.Vis2_Map_CreelDisplayType=='Both'&&input.Vis2_MapDisplayField_Size!='Nothing Selected'&&input.Vis2_MapDisplayField!='Nothing Selected'&&output.Vis_2_Input_SelectCount>0)",
                                                              br(),
                                                              withSpinner(leafletOutput("MapVis2_2", height=560),type=2),
                                                              br(),
                                             ),
                                             
                            ),

                                                        conditionalPanel(condition="input.SelectVis2=='Scatter Plot'",
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1 || input.Vis2_ScatterX=='Nothing Selected'|| input.Vis2_ScatterY=='Nothing Selected'||
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis2_Scatter_MarkerColor_Numeric=='Nothing Selected')||
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Factors'&&input.Vis2_Scatter_MarkerColor_Factors=='Nothing Selected')||
                                                              (input.Vis2_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis2_Scatter_MarkerScaleSize=='Nothing Selected')
                                                              ",
                                                              h2(strong("Visualization 2 Scatter Requirements"))),
                                             conditionalPanel(condition="input.Vis2_ScatterX=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select X variable "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 2 Inputs->Data Inputs->Select X Variable")),
                                             conditionalPanel(condition="input.Vis2_ScatterY=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select Y variable "),
                                                              h4(strong("From Sidebar Select: "), "Visualization 2 Inputs->Data Inputs->Select Y Variable")),
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h4(strong("From Table Located Below:"), "Input (Vis. 2) Table->Select One or More Rows")),
                                             conditionalPanel(condition="input.Vis2_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis2_Scatter_MarkerColor_Numeric=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h4(strong("From Sidebar Select:"), "Visualization 2 Inputs->Marker Style->Select 'Color By:'")),
                                             conditionalPanel(condition="input.Vis2_Scatter_ColorGroupSwitch=='Factors'&&input.Vis2_Scatter_MarkerColor_Factors=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h4(strong("From Sidebar Select:"), "Visualization 2 Inputs->Marker Style->Select 'Color By:'")),
                                            conditionalPanel(condition="input.Vis2_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis2_Scatter_MarkerScaleSize=='Nothing Selected'",
                                                              br(),
                                                              h3(strong("Required Action: "), "Select field to base marker size on"),
                                                              h4(strong("From Sidebar Select:"), "Visualization 2 Inputs->Marker Style->Select Size Scale Field:")),
                                            conditionalPanel(condition="output.Vis_2_Input_SelectCount>0 && input.Vis2_ScatterX!='Nothing Selected'&& input.Vis2_ScatterY!='Nothing Selected'&&
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Uniform'||
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis2_Scatter_MarkerColor_Numeric!='Nothing Selected')||
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Factors'&&input.Vis2_Scatter_MarkerColor_Factors!='Nothing Selected'))&&
                                                              (input.Vis2_Scatter_MarkerSizeSwitch=='Uniform'||
                                                              (input.Vis2_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis2_Scatter_MarkerScaleSize!='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_2_2_Scatter", height=560),type=2),
                                                              br(),
                                             )
                            ),     
                            
                            
                            conditionalPanel(condition="input.SelectVis2=='Line Plot'",
                                             conditionalPanel(condition="
                                                              input.Vis2_Line_Number==null
                                                              ||(input.Vis2_Line_Number==1&&(input.Vis2_LineY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Line_Number==2&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Line_Number==3&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Line_Number==4&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| input.Vis2_LineY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Line_Number==5&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| input.Vis2_LineY4=='Nothing Selected'|| input.Vis2_LineY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h2(strong("Visualization 2 Line Plot Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis2_Line_Number==null
                                                              ||(input.Vis2_Line_Number==1&&(input.Vis2_LineY1=='Nothing Selected'))
                                                              ||(input.Vis2_Line_Number==2&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'))
                                                              ||(input.Vis2_Line_Number==3&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'))
                                                              ||(input.Vis2_Line_Number==4&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| input.Vis2_LineY4=='Nothing Selected'))
                                                              ||(input.Vis2_Line_Number==5&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| input.Vis2_LineY4=='Nothing Selected'|| input.Vis2_LineY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h4(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Number of Y Variables"),
                                                              h4(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select at least one row from the Visualization 2 data table"),
                                                              h4(strong("From Table Located Below: "), "Input (Vis. 2) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis2_Line_Number==1&&input.Vis2_LineY1!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==2&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==3&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==4&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==5&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&& input.Vis2_LineY5!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h3(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                            h4(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h4(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis2_Line_Number==1&&input.Vis2_LineY1!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Line_Number==2&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Line_Number==3&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Line_Number==4&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Line_Number==5&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&& input.Vis2_LineY5!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis2_Line_Number==1&&input.Vis2_LineY1!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==2&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==3&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==4&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==5&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&& input.Vis2_LineY5!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_2_2_Line", height=560),type=2),
                                                              br())
                            ),
                            
                                          conditionalPanel(condition="input.SelectVis2=='Bar Chart'",
                                             conditionalPanel(condition="
                                                              input.Vis2_Bar_Number==null
                                                              ||(input.Vis2_Bar_Number==1&&(input.Vis2_BarY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Bar_Number==2&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Bar_Number==3&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Bar_Number==4&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| input.Vis2_BarY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Bar_Number==5&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| input.Vis2_BarY4=='Nothing Selected'|| input.Vis2_BarY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h2(strong("Visualization 2 Bar Chart Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis2_Bar_Number==null
                                                              ||(input.Vis2_Bar_Number==1&&(input.Vis2_BarY1=='Nothing Selected'))
                                                              ||(input.Vis2_Bar_Number==2&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'))
                                                              ||(input.Vis2_Bar_Number==3&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'))
                                                              ||(input.Vis2_Bar_Number==4&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| input.Vis2_BarY4=='Nothing Selected'))
                                                              ||(input.Vis2_Bar_Number==5&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| input.Vis2_BarY4=='Nothing Selected'|| input.Vis2_BarY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h4(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Number of Y Variables"),
                                                              h4(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select at least one row from the Visualization 2 data table"),
                                                              h4(strong("From Table Located Below: "), "Input (Vis. 2) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis2_Bar_Number==1&&input.Vis2_BarY1!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==2&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==3&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==4&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==5&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&& input.Vis2_BarY5!='Nothing Selected'&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h3(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                            h4(strong("From a scatter plot "), "use either the box or lasso select tool (in-Chart toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h4(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis2_Bar_Number==1&&input.Vis2_BarY1!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Bar_Number==2&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Bar_Number==3&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Bar_Number==4&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Bar_Number==5&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&& input.Vis2_BarY5!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis2_Bar_Number==1&&input.Vis2_BarY1!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==2&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==3&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==4&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==5&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&& input.Vis2_BarY5!='Nothing Selected'&&output.LinkedSel_2Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_2_2_Bar", height=560),type=2),
                                                              br())
                            ),

                     

                            conditionalPanel(condition="input.SelectVis2=='Pie Chart'",
                                             conditionalPanel(condition="input.Vis2_Pie_CategoryType==null",
                                                              h2(strong("Visualization 2 Pie Chart Requirements")),
                                                              h3(strong("Required Action: "), "Select the category type"),
                                                              h4(strong("From the sidebar select:"), "Data Inputs->Metrics or Surveys")
                                             ),
                                             conditionalPanel(condition="input.Vis2_Pie_CategoryType=='Metrics'",
                                                      conditionalPanel(condition="input.Vis2_Pie_Metrics=='' ||((output.Vis_2_Input_SelectCount<1 && input.AF_LinkedSelection=='No')|| (output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes'))",
                                                             h2(strong("Visualization 2 Pie Chart Requirements"))),
                                                      conditionalPanel(condition="input.Vis2_Pie_Metrics==''",
                                                                       br(),
                                                                     h3(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h4(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Metrics")
                                                      ),
                                                      conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                                       br(),
                                                              conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h3(strong("Required Action: "), "User must select at least one row from the Shared Data table"),
                                                              h4(strong("From Table Located Below: "), "Input Data->Select One or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h3(strong("Required Action: "), "User must select at least one row from the Visualization 2 input table"),
                                                              h4(strong("From Table Located Below: "), "Input (Vis. 2) Table->Select One or More Rows")
                                                              ),
                                                      ),
                                           conditionalPanel(condition="input.Vis2_Pie_Metrics!=''&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h4(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h4(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                      conditionalPanel(condition="(input.Vis2_Pie_Metrics!='' && output.Vis_2_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis2_Pie_Metrics!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_2Vis>0)",
                                                                       br(),
                                                                       withSpinner(plotlyOutput("Vis_2_2_Pie_Metrics", height=560),type=2),
                                                                       br()
                                                                       )
                                                     ),
                                             conditionalPanel(condition="input.Vis2_Pie_CategoryType=='Surveys'",
                                                    conditionalPanel(condition="input.Vis2_Pie_Metrics_to_Sum=='' ||((output.Vis_2_Input_SelectCount<1 && input.AF_LinkedSelection=='No')|| (output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes'))",
                                                                     h2(strong("Visualization 2 Pie Chart Requirements"))
                                                                     ),
                                                    conditionalPanel(condition="input.Vis2_Pie_Metrics_to_Sum==''",
                                                                     br(),
                                                                     h3(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h4(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Metrics")
                                                                      ),
                                                    conditionalPanel(condition="output.Vis_2_Input_SelectCount<2",
                                                                     br(),
                                                            conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h3(strong("Required Action: "), "User must select at least two rows from the Shared Data table"),
                                                              h4(strong("From Table Located Below: "), "Input Data->Select Two or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h3(strong("Required Action: "), "User must select at least two rows from the Visualization 2 input table"),
                                                              h4(strong("From Table Located Below: "), "Input (Vis. 2) Table->Select Two or More Rows")
                                                              ),
                                                              ),
                                                        conditionalPanel(condition="input.Vis2_Pie_Metrics!=''&&output.LinkedSel_2Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h3(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h4(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h4(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                    conditionalPanel(condition="(input.Vis2_Pie_Metrics_to_Sum!='' && output.Vis_2_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis2_Pie_Metrics_to_Sum!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_2Vis>0)",
                                                                      br(),
                                                                     withSpinner(plotlyOutput("Vis_2_2_Pie_Surveys", height=560),type=2),
                                                                     br()
                                                                     )
                                                    ),

                                            )

                       )
                     )),
                     
# Three Visualizations #
    conditionalPanel(condition="input.AF_VisNum_Selection=='3'&&(input.AF_SharedData=='No'||(input.AF_SharedData=='Yes'&&input.AF_LinkedSelection!=null))",
                     fluidRow(
                       column(12,style = "border: 2px solid black;height:400px;",
                              conditionalPanel(condition="input.SelectVis1=='Nothing Selected'",                 
                                             h3(strong("Select Visualization Type")),
                                             h4(strong("Required Action: "), "Select the type of visualization you wish to create."),
                                             h5(strong("From Sidebar Select: "), "Visualization 1 Inputs->Select Visualization 1"),
                            ),
                            conditionalPanel(condition="input.SelectVis1=='Map'",
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType==null)||
                                                              (input.Vis1_Map_CreelDisplayType=='Scaled Color'&&(input.Vis1_MapDisplayField=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))||
                                                              (input.Vis1_Map_CreelDisplayType=='Scaled Size'&&(input.Vis1_MapDisplayField_Size=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))||
                                                              (input.Vis1_Map_CreelDisplayType=='Both'&&(input.Vis1_MapDisplayField_Size=='Nothing Selected'||input.Vis1_MapDisplayField=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))",
                                                              h3(strong("Visualization 1 Map Requirements"))
                                                              ),
                                             conditionalPanel(condition="input.Vis1_Map_CreelDisplayType==null",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Creel Data Marker Display Type "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1 Inputs->Creel Data Display->Select either 'Scaled Color', 'Scaled Size' or 'Both'")),
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType=='Scaled Color'||input.Vis1_Map_CreelDisplayType=='Both')&&input.Vis1_MapDisplayField=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Map Display Field "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1 Inputs->Creel Data Display->Select Field for Display (Color)")),
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType=='Scaled Size'||input.Vis1_Map_CreelDisplayType=='Both')&&input.Vis1_MapDisplayField_Size=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Map Display Size Field "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1 Inputs->Creel Data Display->Select Field for Display (Size)")),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h5(strong("From Table Located Below:"), "Input (Vis. 1) Table->Select One or More Rows")),
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType=='Scaled Color'&&input.Vis1_MapDisplayField!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)||
                                                              (input.Vis1_Map_CreelDisplayType=='Scaled Size'&&input.Vis1_MapDisplayField_Size!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)||
                                                              (input.Vis1_Map_CreelDisplayType=='Both'&&input.Vis1_MapDisplayField_Size!='Nothing Selected'&&input.Vis1_MapDisplayField!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)",
                                                              br(),
                                                              withSpinner(leafletOutput("MapVis3_1", height=365),type=2),
                                                              br(),
                                             ),
                                             
                            ),


                                                        conditionalPanel(condition="input.SelectVis1=='Scatter Plot'",
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1 || input.Vis1_ScatterX=='Nothing Selected'|| input.Vis1_ScatterY=='Nothing Selected'||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis1_Scatter_MarkerColor_Numeric=='Nothing Selected')||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Factors'&&input.Vis1_Scatter_MarkerColor_Factors=='Nothing Selected')||
                                                              (input.Vis1_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis1_Scatter_MarkerScaleSize=='Nothing Selected')
                                                              ",
                                                              h3(strong("Visualization 1 Scatter Requirements"))),
                                             conditionalPanel(condition="input.Vis1_ScatterX=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select X variable "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1 Inputs->Data Inputs->Select X Variable")),
                                             conditionalPanel(condition="input.Vis1_ScatterY=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Y variable "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1 Inputs->Data Inputs->Select Y Variable")),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h5(strong("From Table Located Below:"), "Input (Vis. 1) Table->Select One or More Rows")),
                                             conditionalPanel(condition="input.Vis1_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis1_Scatter_MarkerColor_Numeric=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 1 Inputs->Marker Style->Select 'Color By:'")),
                                             conditionalPanel(condition="input.Vis1_Scatter_ColorGroupSwitch=='Factors'&&input.Vis1_Scatter_MarkerColor_Factors=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 1 Inputs->Marker Style->Select 'Color By:'")),
                                            conditionalPanel(condition="input.Vis1_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis1_Scatter_MarkerScaleSize=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker size on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 1 Inputs->Marker Style->Select Size Scale Field:")),
                                            conditionalPanel(condition="output.Vis_1_Input_SelectCount>0 && input.Vis1_ScatterX!='Nothing Selected'&& input.Vis1_ScatterY!='Nothing Selected'&&
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Uniform'||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis1_Scatter_MarkerColor_Numeric!='Nothing Selected')||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Factors'&&input.Vis1_Scatter_MarkerColor_Factors!='Nothing Selected'))&&
                                                              (input.Vis1_Scatter_MarkerSizeSwitch=='Uniform'||
                                                              (input.Vis1_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis1_Scatter_MarkerScaleSize!='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_3_1_Scatter", height=365),type=2),
                                                              br(),
                                             )
                            ),                 


                                                       conditionalPanel(condition="input.SelectVis1=='Line Plot'",
                                             conditionalPanel(condition="
                                                              input.Vis1_Line_Number==null
                                                              ||(input.Vis1_Line_Number==1&&(input.Vis1_LineY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Line_Number==2&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Line_Number==3&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Line_Number==4&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Line_Number==5&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'|| input.Vis1_LineY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h3(strong("Visualization 1 Line Plot Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis1_Line_Number==null
                                                              ||(input.Vis1_Line_Number==1&&(input.Vis1_LineY1=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==2&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==3&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==4&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==5&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'|| input.Vis1_LineY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Number of Y Variables"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 1 data table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis1_Line_Number==1&&input.Vis1_LineY1!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==2&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==3&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==4&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==5&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&& input.Vis1_LineY5!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                            h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis1_Line_Number==1&&input.Vis1_LineY1!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Line_Number==2&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Line_Number==3&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Line_Number==4&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Line_Number==5&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&& input.Vis1_LineY5!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis1_Line_Number==1&&input.Vis1_LineY1!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==2&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==3&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==4&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==5&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&& input.Vis1_LineY5!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_3_1_Line", height=365),type=2),
                                                              br())
                            ),
                            
                                                       conditionalPanel(condition="input.SelectVis1=='Bar Chart'",
                                             conditionalPanel(condition="
                                                              input.Vis1_Bar_Number==null
                                                              ||(input.Vis1_Bar_Number==1&&(input.Vis1_BarY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Bar_Number==2&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Bar_Number==3&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Bar_Number==4&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Bar_Number==5&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'|| input.Vis1_BarY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h3(strong("Visualization 1 Bar Chart Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis1_Bar_Number==null
                                                              ||(input.Vis1_Bar_Number==1&&(input.Vis1_BarY1=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==2&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==3&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==4&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==5&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'|| input.Vis1_BarY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Number of Y Variables"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 1 data table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis1_Bar_Number==1&&input.Vis1_BarY1!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==2&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==3&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==4&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==5&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&& input.Vis1_BarY5!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h4(strong("Required Action: "), "User must select at least one survey from either a map or scatterChart in one of the other visualizations"),
                                                            h5(strong("From a ScatterChart "), "use either the box or lasso select tool (in-Chart toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis1_Bar_Number==1&&input.Vis1_BarY1!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Bar_Number==2&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Bar_Number==3&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Bar_Number==4&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Bar_Number==5&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&& input.Vis1_BarY5!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis1_Bar_Number==1&&input.Vis1_BarY1!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==2&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==3&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==4&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==5&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&& input.Vis1_BarY5!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_3_1_Bar", height=365),type=2),
                                                              br())
                            ),

                     

                            conditionalPanel(condition="input.SelectVis1=='Pie Chart'",
                                             conditionalPanel(condition="input.Vis1_Pie_CategoryType==null",
                                                              h3(strong("Visualization 1 Pie Chart Requirements")),
                                                              h4(strong("Required Action: "), "Select the category type"),
                                                              h5(strong("From the sidebar select:"), "Data Inputs->Metrics or Surveys")
                                             ),
                                             conditionalPanel(condition="input.Vis1_Pie_CategoryType=='Metrics'",
                                                      conditionalPanel(condition="input.Vis1_Pie_Metrics=='' || output.Vis_1_Input_SelectCount<1",
                                                             h3(strong("Visualization 1 Pie Chart Requirements"))),
                                                      conditionalPanel(condition="input.Vis1_Pie_Metrics==''",
                                                                       br(),
                                                                       h4("User must select categories for the pie chart (Visualization 1->Data Inputs->Select Pie Categories)")),
                                                      conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                                       br(),
                                                              conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h4(strong("Required Action: "), "User must select at least one row from the Shared Data table"),
                                                              h5(strong("From Table Located Below: "), "Input Data->Select One or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 1 input table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select One or More Rows")
                                                              ),
                                                      ),
                                           conditionalPanel(condition="input.Vis1_Pie_Metrics!=''&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                      conditionalPanel(condition="(input.Vis1_Pie_Metrics!='' && output.Vis_1_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis1_Pie_Metrics!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_3Vis>0)",
                                                                       br(),
                                                                       withSpinner(plotlyOutput("Vis_3_1_Pie_Metrics", height=365),type=2),
                                                                       br()
                                                                       )
                                                     ),
                                             conditionalPanel(condition="input.Vis1_Pie_CategoryType=='Surveys'",
                                                    conditionalPanel(condition="input.Vis1_Pie_Metrics_to_Sum=='' || output.Vis_1_Input_SelectCount<2",
                                                                     h3(strong("Visualization 1 Pie Chart Requirements"))
                                                                     ),
                                                    conditionalPanel(condition="input.Vis1_Pie_Metrics_to_Sum==''",
                                                                     br(),
                                                                     h4("User must select categories for the pie chart (Visualization 1->Data Inputs->Select Pie Categories)")
                                                                      ),
                                                    conditionalPanel(condition="output.Vis_1_Input_SelectCount<2",
                                                                     br(),
                                                            conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h4(strong("Required Action: "), "User must select at least two rows from the Shared Data table"),
                                                              h5(strong("From Table Located Below: "), "Input Data->Select Two or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h4(strong("Required Action: "), "User must select at least two rows from the Visualization 1 input table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select Two or More Rows")
                                                              ),
                                                              ),
                                                        conditionalPanel(condition="input.Vis1_Pie_Metrics!=''&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                    conditionalPanel(condition="(input.Vis1_Pie_Metrics_to_Sum!='' && output.Vis_1_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis1_Pie_Metrics_to_Sum!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_3Vis>0)",
                                                                      br(),
                                                                     withSpinner(plotlyOutput("Vis_3_1_Pie_Surveys", height=365),type=2),
                                                                     br()
                                                                     )
                                                    ),

                                            )
                                           
            
                            ),

                     # )
                     ),

                             
                     fluidRow(
                       column(6,style = "border: 2px solid black;height:400px;",
                              conditionalPanel(condition="input.SelectVis2=='Nothing Selected'",                 
                                               h3(strong("Select Visualization Type")),
                                               h4(strong("Required Action: "), "Select the type of visualization you wish to create."),
                                               h5(strong("From Sidebar Select: "), "Visualization 2 Inputs->Select Visualization 2"),
                              ),
                              
                            conditionalPanel(condition="input.SelectVis2=='Map'",
                                             conditionalPanel(condition="(input.Vis2_Map_CreelDisplayType==null)||
                                                              (input.Vis2_Map_CreelDisplayType=='Scaled Color'&&(input.Vis2_MapDisplayField=='Nothing Selected'||output.Vis_2_Input_SelectCount<1))||
                                                              (input.Vis2_Map_CreelDisplayType=='Scaled Size'&&(input.Vis2_MapDisplayField_Size=='Nothing Selected'||output.Vis_2_Input_SelectCount<1))||
                                                              (input.Vis2_Map_CreelDisplayType=='Both'&&(input.Vis2_MapDisplayField_Size=='Nothing Selected'||input.Vis2_MapDisplayField=='Nothing Selected'||output.Vis_2_Input_SelectCount<1))",
                                                              h3(strong("Visualization 2 Map Requirements"))
                                                              ),
                                             conditionalPanel(condition="input.Vis2_Map_CreelDisplayType==null",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Creel Data Marker Display Type "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2 Inputs->Creel Data Display->Select either 'Scaled Color', 'Scaled Size' or 'Both'")),
                                             conditionalPanel(condition="(input.Vis2_Map_CreelDisplayType=='Scaled Color'||input.Vis2_Map_CreelDisplayType=='Both')&&input.Vis2_MapDisplayField=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Map Display Field "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2 Inputs->Creel Data Display->Select Field for Display (Color)")),
                                             conditionalPanel(condition="(input.Vis2_Map_CreelDisplayType=='Scaled Size'||input.Vis2_Map_CreelDisplayType=='Both')&&input.Vis2_MapDisplayField_Size=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Map Display Size Field "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2 Inputs->Creel Data Display->Select Field for Display (Size)")),
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h5(strong("From Table Located Below:"), "Input (Vis. 2) Table->Select One or More Rows")),
                                             conditionalPanel(condition="(input.Vis2_Map_CreelDisplayType=='Scaled Color'&&input.Vis2_MapDisplayField!='Nothing Selected'&&output.Vis_2_Input_SelectCount>0)||
                                                              (input.Vis2_Map_CreelDisplayType=='Scaled Size'&&input.Vis2_MapDisplayField_Size!='Nothing Selected'&&output.Vis_2_Input_SelectCount>0)||
                                                              (input.Vis2_Map_CreelDisplayType=='Both'&&input.Vis2_MapDisplayField_Size!='Nothing Selected'&&input.Vis2_MapDisplayField!='Nothing Selected'&&output.Vis_2_Input_SelectCount>0)",
                                                              br(),
                                                              withSpinner(leafletOutput("MapVis3_2", height=365),type=2),
                                                              br(),
                                             ),
                                             
                            ),

                                                        conditionalPanel(condition="input.SelectVis2=='Scatter Plot'",
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1 || input.Vis2_ScatterX=='Nothing Selected'|| input.Vis2_ScatterY=='Nothing Selected'||
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis2_Scatter_MarkerColor_Numeric=='Nothing Selected')||
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Factors'&&input.Vis2_Scatter_MarkerColor_Factors=='Nothing Selected')||
                                                              (input.Vis2_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis2_Scatter_MarkerScaleSize=='Nothing Selected')
                                                              ",
                                                              h3(strong("Visualization 2 Scatter Requirements"))),
                                             conditionalPanel(condition="input.Vis2_ScatterX=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select X variable "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2 Inputs->Data Inputs->Select X Variable")),
                                             conditionalPanel(condition="input.Vis2_ScatterY=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Y variable "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2 Inputs->Data Inputs->Select Y Variable")),
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h5(strong("From Table Located Below:"), "Input (Vis. 2) Table->Select One or More Rows")),
                                             conditionalPanel(condition="input.Vis2_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis2_Scatter_MarkerColor_Numeric=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 2 Inputs->Marker Style->Select 'Color By:'")),
                                             conditionalPanel(condition="input.Vis2_Scatter_ColorGroupSwitch=='Factors'&&input.Vis2_Scatter_MarkerColor_Factors=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 2 Inputs->Marker Style->Select 'Color By:'")),
                                            conditionalPanel(condition="input.Vis2_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis2_Scatter_MarkerScaleSize=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker size on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 2 Inputs->Marker Style->Select Size Scale Field:")),
                                            conditionalPanel(condition="output.Vis_2_Input_SelectCount>0 && input.Vis2_ScatterX!='Nothing Selected'&& input.Vis2_ScatterY!='Nothing Selected'&&
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Uniform'||
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis2_Scatter_MarkerColor_Numeric!='Nothing Selected')||
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Factors'&&input.Vis2_Scatter_MarkerColor_Factors!='Nothing Selected'))&&
                                                              (input.Vis2_Scatter_MarkerSizeSwitch=='Uniform'||
                                                              (input.Vis2_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis2_Scatter_MarkerScaleSize!='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_3_2_Scatter", height=365),type=2),
                                                              br(),
                                             )
                            ),                


                            conditionalPanel(condition="input.SelectVis2=='Line Plot'",
                                             conditionalPanel(condition="
                                                              input.Vis2_Line_Number==null
                                                              ||(input.Vis2_Line_Number==1&&(input.Vis2_LineY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Line_Number==2&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Line_Number==3&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Line_Number==4&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| input.Vis2_LineY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Line_Number==5&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| input.Vis2_LineY4=='Nothing Selected'|| input.Vis2_LineY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h3(strong("Visualization 2 Line Plot Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis2_Line_Number==null
                                                              ||(input.Vis2_Line_Number==1&&(input.Vis2_LineY1=='Nothing Selected'))
                                                              ||(input.Vis2_Line_Number==2&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'))
                                                              ||(input.Vis2_Line_Number==3&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'))
                                                              ||(input.Vis2_Line_Number==4&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| input.Vis2_LineY4=='Nothing Selected'))
                                                              ||(input.Vis2_Line_Number==5&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| input.Vis2_LineY4=='Nothing Selected'|| input.Vis2_LineY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Number of Y Variables"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 2 data table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 2) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis2_Line_Number==1&&input.Vis2_LineY1!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==2&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==3&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==4&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==5&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&& input.Vis2_LineY5!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                            h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis2_Line_Number==1&&input.Vis2_LineY1!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Line_Number==2&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Line_Number==3&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Line_Number==4&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Line_Number==5&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&& input.Vis2_LineY5!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis2_Line_Number==1&&input.Vis2_LineY1!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==2&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==3&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==4&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==5&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&& input.Vis2_LineY5!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_3_2_Line", height=365),type=2),
                                                              br())
                            ),
                            
                                                       conditionalPanel(condition="input.SelectVis2=='Bar Chart'",
                                             conditionalPanel(condition="
                                                              input.Vis2_Bar_Number==null
                                                              ||(input.Vis2_Bar_Number==1&&(input.Vis2_BarY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Bar_Number==2&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Bar_Number==3&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Bar_Number==4&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| input.Vis2_BarY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Bar_Number==5&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| input.Vis2_BarY4=='Nothing Selected'|| input.Vis2_BarY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h3(strong("Visualization 2 Bar Chart Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis2_Bar_Number==null
                                                              ||(input.Vis2_Bar_Number==1&&(input.Vis2_BarY1=='Nothing Selected'))
                                                              ||(input.Vis2_Bar_Number==2&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'))
                                                              ||(input.Vis2_Bar_Number==3&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'))
                                                              ||(input.Vis2_Bar_Number==4&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| input.Vis2_BarY4=='Nothing Selected'))
                                                              ||(input.Vis2_Bar_Number==5&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| input.Vis2_BarY4=='Nothing Selected'|| input.Vis2_BarY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Number of Y Variables"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 2 data table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 2) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis2_Bar_Number==1&&input.Vis2_BarY1!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==2&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==3&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==4&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==5&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&& input.Vis2_BarY5!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h4(strong("Required Action: "), "User must select at least one survey from either a map or scatterChart in one of the other visualizations"),
                                                            h5(strong("From a ScatterChart "), "use either the box or lasso select tool (in-Chart toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis2_Bar_Number==1&&input.Vis2_BarY1!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Bar_Number==2&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Bar_Number==3&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Bar_Number==4&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Bar_Number==5&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&& input.Vis2_BarY5!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis2_Bar_Number==1&&input.Vis2_BarY1!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==2&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==3&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==4&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==5&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&& input.Vis2_BarY5!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_3_2_Bar", height=365),type=2),
                                                              br())
                            ),

                     

                            conditionalPanel(condition="input.SelectVis2=='Pie Chart'",
                                             conditionalPanel(condition="input.Vis2_Pie_CategoryType==null",
                                                              h3(strong("Visualization 2 Pie Chart Requirements")),
                                                              h4(strong("Required Action: "), "Select the category type"),
                                                              h5(strong("From the sidebar select:"), "Data Inputs->Metrics or Surveys")
                                             ),
                                             conditionalPanel(condition="input.Vis2_Pie_CategoryType=='Metrics'",
                                                      conditionalPanel(condition="input.Vis2_Pie_Metrics=='' ||((output.Vis_2_Input_SelectCount<1 && input.AF_LinkedSelection=='No')|| (output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes'))",
                                                             h3(strong("Visualization 2 Pie Chart Requirements"))),
                                                      conditionalPanel(condition="input.Vis2_Pie_Metrics==''",
                                                                       br(),
                                                                     h4(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h5(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Metrics")
                                                      ),
                                                      conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                                       br(),
                                                              conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h4(strong("Required Action: "), "User must select at least one row from the Shared Data table"),
                                                              h5(strong("From Table Located Below: "), "Input Data->Select One or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 2 input table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 2) Table->Select One or More Rows")
                                                              ),
                                                      ),
                                           conditionalPanel(condition="input.Vis2_Pie_Metrics!=''&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                      conditionalPanel(condition="(input.Vis2_Pie_Metrics!='' && output.Vis_2_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis2_Pie_Metrics!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_3Vis>0)",
                                                                       br(),
                                                                       withSpinner(plotlyOutput("Vis_3_2_Pie_Metrics", height=365),type=2),
                                                                       br()
                                                                       )
                                                     ),
                                             conditionalPanel(condition="input.Vis2_Pie_CategoryType=='Surveys'",
                                                    conditionalPanel(condition="input.Vis2_Pie_Metrics_to_Sum=='' ||((output.Vis_2_Input_SelectCount<1 && input.AF_LinkedSelection=='No')|| (output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes'))",
                                                                     h3(strong("Visualization 2 Pie Chart Requirements"))
                                                                     ),
                                                    conditionalPanel(condition="input.Vis2_Pie_Metrics_to_Sum==''",
                                                                     br(),
                                                                     h4(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h5(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Metrics")
                                                                      ),
                                                    conditionalPanel(condition="output.Vis_2_Input_SelectCount<2",
                                                                     br(),
                                                            conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h4(strong("Required Action: "), "User must select at least two rows from the Shared Data table"),
                                                              h5(strong("From Table Located Below: "), "Input Data->Select Two or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h4(strong("Required Action: "), "User must select at least two rows from the Visualization 2 input table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 2) Table->Select Two or More Rows")
                                                              ),
                                                              ),
                                                        conditionalPanel(condition="input.Vis2_Pie_Metrics!=''&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                    conditionalPanel(condition="(input.Vis2_Pie_Metrics_to_Sum!='' && output.Vis_2_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis2_Pie_Metrics_to_Sum!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_3Vis>0)",
                                                                      br(),
                                                                     withSpinner(plotlyOutput("Vis_3_2_Pie_Surveys", height=365),type=2),
                                                                     br()
                                                                     )
                                                    ),

                                            )
                          
                              
                              ),
                       column(6,style = "border: 2px solid black;height:400px;",
                              conditionalPanel(condition="input.SelectVis3=='Nothing Selected'",                 
                                               h3(strong("Select Visualization Type")),
                                               h4(strong("Required Action: "), "Select the type of visualization you wish to create."),
                                               h5(strong("From Sidebar Select: "), "Visualization 3 Inputs->Select Visualization 3"),
                              ),
                              
                            conditionalPanel(condition="input.SelectVis3=='Map'",
                                             conditionalPanel(condition="(input.Vis3_Map_CreelDisplayType==null)||
                                                              (input.Vis3_Map_CreelDisplayType=='Scaled Color'&&(input.Vis3_MapDisplayField=='Nothing Selected'||output.Vis_3_Input_SelectCount<1))||
                                                              (input.Vis3_Map_CreelDisplayType=='Scaled Size'&&(input.Vis3_MapDisplayField_Size=='Nothing Selected'||output.Vis_3_Input_SelectCount<1))||
                                                              (input.Vis3_Map_CreelDisplayType=='Both'&&(input.Vis3_MapDisplayField_Size=='Nothing Selected'||input.Vis3_MapDisplayField=='Nothing Selected'||output.Vis_3_Input_SelectCount<1))",
                                                              h3(strong("Visualization 3 Map Requirements"))
                                                              ),
                                             conditionalPanel(condition="input.Vis3_Map_CreelDisplayType==null",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Creel Data Marker Display Type "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3 Inputs->Creel Data Display->Select either 'Scaled Color', 'Scaled Size' or 'Both'")),
                                             conditionalPanel(condition="(input.Vis3_Map_CreelDisplayType=='Scaled Color'||input.Vis3_Map_CreelDisplayType=='Both')&&input.Vis3_MapDisplayField=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Map Display Field "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3 Inputs->Creel Data Display->Select Field for Display (Color)")),
                                             conditionalPanel(condition="(input.Vis3_Map_CreelDisplayType=='Scaled Size'||input.Vis3_Map_CreelDisplayType=='Both')&&input.Vis3_MapDisplayField_Size=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Map Display Size Field "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3 Inputs->Creel Data Display->Select Field for Display (Size)")),
                                             conditionalPanel(condition="output.Vis_3_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h5(strong("From Table Located Below:"), "Input (Vis. 3) Table->Select One or More Rows")),
                                             conditionalPanel(condition="(input.Vis3_Map_CreelDisplayType=='Scaled Color'&&input.Vis3_MapDisplayField!='Nothing Selected'&&output.Vis_3_Input_SelectCount>0)||
                                                              (input.Vis3_Map_CreelDisplayType=='Scaled Size'&&input.Vis3_MapDisplayField_Size!='Nothing Selected'&&output.Vis_3_Input_SelectCount>0)||
                                                              (input.Vis3_Map_CreelDisplayType=='Both'&&input.Vis3_MapDisplayField_Size!='Nothing Selected'&&input.Vis3_MapDisplayField!='Nothing Selected'&&output.Vis_3_Input_SelectCount>0)",
                                                              br(),
                                                              withSpinner(leafletOutput("MapVis3_3", height=365),type=2),
                                                              br(),
                                             ),
                                             
                            ),

                                                        conditionalPanel(condition="input.SelectVis3=='Scatter Plot'",
                                             conditionalPanel(condition="output.Vis_3_Input_SelectCount<1 || input.Vis3_ScatterX=='Nothing Selected'|| input.Vis3_ScatterY=='Nothing Selected'||
                                                              (input.Vis3_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis3_Scatter_MarkerColor_Numeric=='Nothing Selected')||
                                                              (input.Vis3_Scatter_ColorGroupSwitch=='Factors'&&input.Vis3_Scatter_MarkerColor_Factors=='Nothing Selected')||
                                                              (input.Vis3_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis3_Scatter_MarkerScaleSize=='Nothing Selected')
                                                              ",
                                                              h3(strong("Visualization 3 Scatter Requirements"))),
                                             conditionalPanel(condition="input.Vis3_ScatterX=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select X variable "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3 Inputs->Data Inputs->Select X Variable")),
                                             conditionalPanel(condition="input.Vis3_ScatterY=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Y variable "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3 Inputs->Data Inputs->Select Y Variable")),
                                             conditionalPanel(condition="output.Vis_3_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h5(strong("From Table Located Below:"), "Input (Vis. 2) Table->Select One or More Rows")),
                                             conditionalPanel(condition="input.Vis3_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis3_Scatter_MarkerColor_Numeric=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 3 Inputs->Marker Style->Select 'Color By:'")),
                                             conditionalPanel(condition="input.Vis3_Scatter_ColorGroupSwitch=='Factors'&&input.Vis3_Scatter_MarkerColor_Factors=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 3 Inputs->Marker Style->Select 'Color By:'")),
                                            conditionalPanel(condition="input.Vis3_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis3_Scatter_MarkerScaleSize=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker size on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 3 Inputs->Marker Style->Select Size Scale Field:")),
                                            conditionalPanel(condition="output.Vis_3_Input_SelectCount>0 && input.Vis3_ScatterX!='Nothing Selected'&& input.Vis3_ScatterY!='Nothing Selected'&&
                                                              (input.Vis3_Scatter_ColorGroupSwitch=='Uniform'||
                                                              (input.Vis3_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis3_Scatter_MarkerColor_Numeric!='Nothing Selected')||
                                                              (input.Vis3_Scatter_ColorGroupSwitch=='Factors'&&input.Vis3_Scatter_MarkerColor_Factors!='Nothing Selected'))&&
                                                              (input.Vis3_Scatter_MarkerSizeSwitch=='Uniform'||
                                                              (input.Vis3_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis3_Scatter_MarkerScaleSize!='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_3_3_Scatter", height=365),type=2),
                                                              br(),
                                             )
                            ),                   



                            conditionalPanel(condition="input.SelectVis3=='Line Plot'",
                                             conditionalPanel(condition="
                                                              input.Vis3_Line_Number==null
                                                              ||(input.Vis3_Line_Number==1&&(input.Vis3_LineY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Line_Number==2&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Line_Number==3&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'|| input.Vis3_LineY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Line_Number==4&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'|| input.Vis3_LineY3=='Nothing Selected'|| input.Vis3_LineY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Line_Number==5&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'|| input.Vis3_LineY3=='Nothing Selected'|| input.Vis3_LineY4=='Nothing Selected'|| input.Vis3_LineY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h3(strong("Visualization 3 Line Plot Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis3_Line_Number==null
                                                              ||(input.Vis3_Line_Number==1&&(input.Vis3_LineY1=='Nothing Selected'))
                                                              ||(input.Vis3_Line_Number==2&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'))
                                                              ||(input.Vis3_Line_Number==3&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'|| input.Vis3_LineY3=='Nothing Selected'))
                                                              ||(input.Vis3_Line_Number==4&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'|| input.Vis3_LineY3=='Nothing Selected'|| input.Vis3_LineY4=='Nothing Selected'))
                                                              ||(input.Vis3_Line_Number==5&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'|| input.Vis3_LineY3=='Nothing Selected'|| input.Vis3_LineY4=='Nothing Selected'|| input.Vis3_LineY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3->Data Inputs->Select Number of Y Variables"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_3_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 3 data table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 3) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis3_Line_Number==1&&input.Vis3_LineY1!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==2&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==3&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==4&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&& input.Vis3_LineY4!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==5&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&& input.Vis3_LineY4!='Nothing Selected'&& input.Vis3_LineY5!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                            h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis3_Line_Number==1&&input.Vis3_LineY1!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Line_Number==2&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Line_Number==3&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Line_Number==4&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&& input.Vis3_LineY4!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Line_Number==5&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&& input.Vis3_LineY4!='Nothing Selected'&& input.Vis3_LineY5!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis3_Line_Number==1&&input.Vis3_LineY1!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==2&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==3&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==4&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&& input.Vis3_LineY4!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==5&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&& input.Vis3_LineY4!='Nothing Selected'&& input.Vis3_LineY5!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_3_3_Line", height=365),type=2),
                                                              br())
                            ),
                            
                                                       conditionalPanel(condition="input.SelectVis3=='Bar Chart'",
                                             conditionalPanel(condition="
                                                              input.Vis3_Bar_Number==null
                                                              ||(input.Vis3_Bar_Number==1&&(input.Vis3_BarY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Bar_Number==2&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Bar_Number==3&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'|| input.Vis3_BarY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Bar_Number==4&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'|| input.Vis3_BarY3=='Nothing Selected'|| input.Vis3_BarY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Bar_Number==5&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'|| input.Vis3_BarY3=='Nothing Selected'|| input.Vis3_BarY4=='Nothing Selected'|| input.Vis3_BarY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h3(strong("Visualization 3 Bar Chart Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis3_Bar_Number==null
                                                              ||(input.Vis3_Bar_Number==1&&(input.Vis3_BarY1=='Nothing Selected'))
                                                              ||(input.Vis3_Bar_Number==2&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'))
                                                              ||(input.Vis3_Bar_Number==3&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'|| input.Vis3_BarY3=='Nothing Selected'))
                                                              ||(input.Vis3_Bar_Number==4&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'|| input.Vis3_BarY3=='Nothing Selected'|| input.Vis3_BarY4=='Nothing Selected'))
                                                              ||(input.Vis3_Bar_Number==5&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'|| input.Vis3_BarY3=='Nothing Selected'|| input.Vis3_BarY4=='Nothing Selected'|| input.Vis3_BarY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3->Data Inputs->Select Number of Y Variables"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_3_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 3 data table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 3) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis3_Bar_Number==1&&input.Vis3_BarY1!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==2&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==3&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==4&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&& input.Vis3_BarY4!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==5&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&& input.Vis3_BarY4!='Nothing Selected'&& input.Vis3_BarY5!='Nothing Selected'&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h4(strong("Required Action: "), "User must select at least one survey from either a map or scatterChart in one of the other visualizations"),
                                                            h5(strong("From a ScatterChart "), "use either the box or lasso select tool (in-Chart toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis3_Bar_Number==1&&input.Vis3_BarY1!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Bar_Number==2&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Bar_Number==3&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Bar_Number==4&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&& input.Vis3_BarY4!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Bar_Number==5&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&& input.Vis3_BarY4!='Nothing Selected'&& input.Vis3_BarY5!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis3_Bar_Number==1&&input.Vis3_BarY1!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==2&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==3&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==4&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&& input.Vis3_BarY4!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==5&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&& input.Vis3_BarY4!='Nothing Selected'&& input.Vis3_BarY5!='Nothing Selected'&&output.LinkedSel_3Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_3_3_Bar", height=365),type=2),
                                                              br())
                            ),

                     

                            conditionalPanel(condition="input.SelectVis3=='Pie Chart'",
                                             conditionalPanel(condition="input.Vis3_Pie_CategoryType==null",
                                                              h3(strong("Visualization 3 Pie Chart Requirements")),
                                                              h4(strong("Required Action: "), "Select the category type"),
                                                              h5(strong("From the sidebar select:"), "Data Inputs->Metrics or Surveys")
                                             ),
                                             conditionalPanel(condition="input.Vis3_Pie_CategoryType=='Metrics'",
                                                      conditionalPanel(condition="input.Vis3_Pie_Metrics=='' ||((output.Vis_3_Input_SelectCount<1 && input.AF_LinkedSelection=='No')|| (output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes'))",
                                                             h3(strong("Visualization 3 Pie Chart Requirements"))),
                                                      conditionalPanel(condition="input.Vis3_Pie_Metrics==''",
                                                                       br(),
                                                                     h4(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h5(strong("From Sidebar Select: "), "Visualization 3->Data Inputs->Select Metrics")
                                                      ),
                                                      conditionalPanel(condition="output.Vis_3_Input_SelectCount<1",
                                                                       br(),
                                                              conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h4(strong("Required Action: "), "User must select at least one row from the Shared Data table"),
                                                              h5(strong("From Table Located Below: "), "Input Data->Select One or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 3 input table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 3) Table->Select One or More Rows")
                                                              ),
                                                      ),
                                           conditionalPanel(condition="input.Vis3_Pie_Metrics!=''&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                      conditionalPanel(condition="(input.Vis3_Pie_Metrics!='' && output.Vis_3_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis3_Pie_Metrics!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_3Vis>0)",
                                                                       br(),
                                                                       withSpinner(plotlyOutput("Vis_3_3_Pie_Metrics", height=365),type=2),
                                                                       br()
                                                                       )
                                                     ),
                                             conditionalPanel(condition="input.Vis3_Pie_CategoryType=='Surveys'",
                                                    conditionalPanel(condition="input.Vis3_Pie_Metrics_to_Sum=='' ||((output.Vis_3_Input_SelectCount<1 && input.AF_LinkedSelection=='No')|| (output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes'))",
                                                                     h3(strong("Visualization 3 Pie Chart Requirements"))
                                                                     ),
                                                    conditionalPanel(condition="input.Vis3_Pie_Metrics_to_Sum==''",
                                                                     br(),
                                                                     h4(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h5(strong("From Sidebar Select: "), "Visualization 3->Data Inputs->Select Metrics")
                                                                      ),
                                                    conditionalPanel(condition="output.Vis_3_Input_SelectCount<2",
                                                                     br(),
                                                            conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h4(strong("Required Action: "), "User must select at least two rows from the Shared Data table"),
                                                              h5(strong("From Table Located Below: "), "Input Data->Select Two or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h4(strong("Required Action: "), "User must select at least two rows from the Visualization 3 input table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 3) Table->Select Two or More Rows")
                                                              ),
                                                              ),
                                                        conditionalPanel(condition="input.Vis3_Pie_Metrics!=''&&output.LinkedSel_3Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                    conditionalPanel(condition="(input.Vis3_Pie_Metrics_to_Sum!='' && output.Vis_3_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis3_Pie_Metrics_to_Sum!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_3Vis>0)",
                                                                      br(),
                                                                     withSpinner(plotlyOutput("Vis_3_3_Pie_Surveys", height=365),type=2),
                                                                     br()
                                                                     )
                                                    ),

                                            )
                            
                            
                            
                              
                              )

    )
    ),

### Four Visualizations ###
    conditionalPanel(condition="input.AF_VisNum_Selection=='4'&&(input.AF_SharedData=='No'||(input.AF_SharedData=='Yes'&&input.AF_LinkedSelection!=null))",
                     fluidRow(
                       column(6,style = "border: 2px solid black;height:400px;",
                              conditionalPanel(condition="input.SelectVis1=='Nothing Selected'",                 
                                               h3(strong("Select Visualization Type")),
                                               h4(strong("Required Action: "), "Select the type of visualization you wish to create."),
                                               h5(strong("From Sidebar Select: "), "Visualization 1 Inputs->Select Visualization 1"),
                              ),
                              
                            conditionalPanel(condition="input.SelectVis1=='Map'",
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType==null)||
                                                              (input.Vis1_Map_CreelDisplayType=='Scaled Color'&&(input.Vis1_MapDisplayField=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))||
                                                              (input.Vis1_Map_CreelDisplayType=='Scaled Size'&&(input.Vis1_MapDisplayField_Size=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))||
                                                              (input.Vis1_Map_CreelDisplayType=='Both'&&(input.Vis1_MapDisplayField_Size=='Nothing Selected'||input.Vis1_MapDisplayField=='Nothing Selected'||output.Vis_1_Input_SelectCount<1))",
                                                              h3(strong("Visualization 1 Map Requirements"))
                                                              ),
                                             conditionalPanel(condition="input.Vis1_Map_CreelDisplayType==null",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Creel Data Marker Display Type "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1 Inputs->Creel Data Display->Select either 'Scaled Color', 'Scaled Size' or 'Both'")),
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType=='Scaled Color'||input.Vis1_Map_CreelDisplayType=='Both')&&input.Vis1_MapDisplayField=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Map Display Field "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1 Inputs->Creel Data Display->Select Field for Display (Color)")),
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType=='Scaled Size'||input.Vis1_Map_CreelDisplayType=='Both')&&input.Vis1_MapDisplayField_Size=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Map Display Size Field "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1 Inputs->Creel Data Display->Select Field for Display (Size)")),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h5(strong("From Table Located Below:"), "Input (Vis. 1) Table->Select One or More Rows")),
                                             conditionalPanel(condition="(input.Vis1_Map_CreelDisplayType=='Scaled Color'&&input.Vis1_MapDisplayField!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)||
                                                              (input.Vis1_Map_CreelDisplayType=='Scaled Size'&&input.Vis1_MapDisplayField_Size!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)||
                                                              (input.Vis1_Map_CreelDisplayType=='Both'&&input.Vis1_MapDisplayField_Size!='Nothing Selected'&&input.Vis1_MapDisplayField!='Nothing Selected'&&output.Vis_1_Input_SelectCount>0)",
                                                              br(),
                                                              withSpinner(leafletOutput("MapVis4_1", height=365),type=2),
                                                              br(),
                                             ),
                                             
                            ),


                                                        conditionalPanel(condition="input.SelectVis1=='Scatter Plot'",
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1 || input.Vis1_ScatterX=='Nothing Selected'|| input.Vis1_ScatterY=='Nothing Selected'||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis1_Scatter_MarkerColor_Numeric=='Nothing Selected')||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Factors'&&input.Vis1_Scatter_MarkerColor_Factors=='Nothing Selected')||
                                                              (input.Vis1_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis1_Scatter_MarkerScaleSize=='Nothing Selected')
                                                              ",
                                                              h3(strong("Visualization 1 Scatter Requirements"))),
                                             conditionalPanel(condition="input.Vis1_ScatterX=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select X variable "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1 Inputs->Data Inputs->Select X Variable")),
                                             conditionalPanel(condition="input.Vis1_ScatterY=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Y variable "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1 Inputs->Data Inputs->Select Y Variable")),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h5(strong("From Table Located Below:"), "Input (Vis. 1) Table->Select One or More Rows")),
                                             conditionalPanel(condition="input.Vis1_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis1_Scatter_MarkerColor_Numeric=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 1 Inputs->Marker Style->Select 'Color By:'")),
                                             conditionalPanel(condition="input.Vis1_Scatter_ColorGroupSwitch=='Factors'&&input.Vis1_Scatter_MarkerColor_Factors=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 1 Inputs->Marker Style->Select 'Color By:'")),
                                            conditionalPanel(condition="input.Vis1_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis1_Scatter_MarkerScaleSize=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker size on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 1 Inputs->Marker Style->Select Size Scale Field:")),
                                            conditionalPanel(condition="output.Vis_1_Input_SelectCount>0 && input.Vis1_ScatterX!='Nothing Selected'&& input.Vis1_ScatterY!='Nothing Selected'&&
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Uniform'||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis1_Scatter_MarkerColor_Numeric!='Nothing Selected')||
                                                              (input.Vis1_Scatter_ColorGroupSwitch=='Factors'&&input.Vis1_Scatter_MarkerColor_Factors!='Nothing Selected'))&&
                                                              (input.Vis1_Scatter_MarkerSizeSwitch=='Uniform'||
                                                              (input.Vis1_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis1_Scatter_MarkerScaleSize!='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_4_1_Scatter", height=365),type=2),
                                                              br(),
                                             )
                            ),                  


                            conditionalPanel(condition="input.SelectVis1=='Line Plot'",
                                             conditionalPanel(condition="
                                                              input.Vis1_Line_Number==null
                                                              ||(input.Vis1_Line_Number==1&&(input.Vis1_LineY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Line_Number==2&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Line_Number==3&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Line_Number==4&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Line_Number==5&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'|| input.Vis1_LineY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h3(strong("Visualization 1 Line Plot Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis1_Line_Number==null
                                                              ||(input.Vis1_Line_Number==1&&(input.Vis1_LineY1=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==2&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==3&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==4&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'))
                                                              ||(input.Vis1_Line_Number==5&&(input.Vis1_LineY1=='Nothing Selected'|| input.Vis1_LineY2=='Nothing Selected'|| input.Vis1_LineY3=='Nothing Selected'|| input.Vis1_LineY4=='Nothing Selected'|| input.Vis1_LineY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Number of Y Variables"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 1 data table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis1_Line_Number==1&&input.Vis1_LineY1!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==2&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==3&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==4&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==5&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&& input.Vis1_LineY5!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                            h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis1_Line_Number==1&&input.Vis1_LineY1!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Line_Number==2&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Line_Number==3&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Line_Number==4&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Line_Number==5&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&& input.Vis1_LineY5!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis1_Line_Number==1&&input.Vis1_LineY1!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==2&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==3&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==4&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Line_Number==5&&input.Vis1_LineY1!='Nothing Selected'&& input.Vis1_LineY2!='Nothing Selected'&& input.Vis1_LineY3!='Nothing Selected'&& input.Vis1_LineY4!='Nothing Selected'&& input.Vis1_LineY5!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_4_1_Line", height=365),type=2),
                                                              br())
                            ),
                            
                                                       conditionalPanel(condition="input.SelectVis1=='Bar Chart'",
                                             conditionalPanel(condition="
                                                              input.Vis1_Bar_Number==null
                                                              ||(input.Vis1_Bar_Number==1&&(input.Vis1_BarY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Bar_Number==2&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Bar_Number==3&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Bar_Number==4&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis1_Bar_Number==5&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'|| input.Vis1_BarY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_1_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h3(strong("Visualization 1 Bar Chart Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis1_Bar_Number==null
                                                              ||(input.Vis1_Bar_Number==1&&(input.Vis1_BarY1=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==2&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==3&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==4&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'))
                                                              ||(input.Vis1_Bar_Number==5&&(input.Vis1_BarY1=='Nothing Selected'|| input.Vis1_BarY2=='Nothing Selected'|| input.Vis1_BarY3=='Nothing Selected'|| input.Vis1_BarY4=='Nothing Selected'|| input.Vis1_BarY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Number of Y Variables"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 1->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 1 data table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis1_Bar_Number==1&&input.Vis1_BarY1!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==2&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==3&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==4&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==5&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&& input.Vis1_BarY5!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h4(strong("Required Action: "), "User must select at least one survey from either a map or scatterChart in one of the other visualizations"),
                                                            h5(strong("From a ScatterChart "), "use either the box or lasso select tool (in-Chart toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis1_Bar_Number==1&&input.Vis1_BarY1!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Bar_Number==2&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Bar_Number==3&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Bar_Number==4&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis1_Bar_Number==5&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&& input.Vis1_BarY5!='Nothing Selected'&& output.Vis_1_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis1_Bar_Number==1&&input.Vis1_BarY1!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==2&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==3&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==4&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis1_Bar_Number==5&&input.Vis1_BarY1!='Nothing Selected'&& input.Vis1_BarY2!='Nothing Selected'&& input.Vis1_BarY3!='Nothing Selected'&& input.Vis1_BarY4!='Nothing Selected'&& input.Vis1_BarY5!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_4_1_Bar", height=365),type=2),
                                                              br())
                            ),

                     

                            conditionalPanel(condition="input.SelectVis1=='Pie Chart'",
                                             conditionalPanel(condition="input.Vis1_Pie_CategoryType==null",
                                                              h3(strong("Visualization 1 Pie Chart Requirements")),
                                                              h4(strong("Required Action: "), "Select the category type"),
                                                              h5(strong("From the sidebar select:"), "Data Inputs->Metrics or Surveys")
                                             ),
                                             conditionalPanel(condition="input.Vis1_Pie_CategoryType=='Metrics'",
                                                      conditionalPanel(condition="input.Vis1_Pie_Metrics=='' || output.Vis_1_Input_SelectCount<1",
                                                             h3(strong("Visualization 1 Pie Chart Requirements"))),
                                                      conditionalPanel(condition="input.Vis1_Pie_Metrics==''",
                                                                       br(),
                                                                       h4("User must select categories for the pie chart (Visualization 1->Data Inputs->Select Pie Categories)")),
                                                      conditionalPanel(condition="output.Vis_1_Input_SelectCount<1",
                                                                       br(),
                                                              conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h4(strong("Required Action: "), "User must select at least one row from the Shared Data table"),
                                                              h5(strong("From Table Located Below: "), "Input Data->Select One or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 1 input table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select One or More Rows")
                                                              ),
                                                      ),
                                           conditionalPanel(condition="input.Vis1_Pie_Metrics!=''&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                      conditionalPanel(condition="(input.Vis1_Pie_Metrics!='' && output.Vis_1_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis1_Pie_Metrics!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_4Vis>0)",
                                                                       br(),
                                                                       withSpinner(plotlyOutput("Vis_4_1_Pie_Metrics", height=365),type=2),
                                                                       br()
                                                                       )
                                                     ),
                                             conditionalPanel(condition="input.Vis1_Pie_CategoryType=='Surveys'",
                                                    conditionalPanel(condition="input.Vis1_Pie_Metrics_to_Sum=='' || output.Vis_1_Input_SelectCount<2",
                                                                     h3(strong("Visualization 1 Pie Chart Requirements"))
                                                                     ),
                                                    conditionalPanel(condition="input.Vis1_Pie_Metrics_to_Sum==''",
                                                                     br(),
                                                                     h4("User must select categories for the pie chart (Visualization 1->Data Inputs->Select Pie Categories)")
                                                                      ),
                                                    conditionalPanel(condition="output.Vis_1_Input_SelectCount<2",
                                                                     br(),
                                                            conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h4(strong("Required Action: "), "User must select at least two rows from the Shared Data table"),
                                                              h5(strong("From Table Located Below: "), "Input Data->Select Two or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h4(strong("Required Action: "), "User must select at least two rows from the Visualization 1 input table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 1) Table->Select Two or More Rows")
                                                              ),
                                                              ),
                                                        conditionalPanel(condition="input.Vis1_Pie_Metrics!=''&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                    conditionalPanel(condition="(input.Vis1_Pie_Metrics_to_Sum!='' && output.Vis_1_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis1_Pie_Metrics_to_Sum!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_4Vis>0)",
                                                                      br(),
                                                                     withSpinner(plotlyOutput("Vis_4_1_Pie_Surveys", height=365),type=2),
                                                                     br()
                                                                     )
                                                    ),

                                            )
                                           
            
                            
                              ),
                       column(6,style = "border: 2px solid black;height:400px;",
                              conditionalPanel(condition="input.SelectVis2=='Nothing Selected'",                 
                                               h3(strong("Select Visualization Type")),
                                               h4(strong("Required Action: "), "Select the type of visualization you wish to create."),
                                               h5(strong("From Sidebar Select: "), "Visualization 2 Inputs->Select Visualization 2"),
                              ),
                              
                            conditionalPanel(condition="input.SelectVis2=='Map'",
                                             conditionalPanel(condition="(input.Vis2_Map_CreelDisplayType==null)||
                                                              (input.Vis2_Map_CreelDisplayType=='Scaled Color'&&(input.Vis2_MapDisplayField=='Nothing Selected'||output.Vis_2_Input_SelectCount<1))||
                                                              (input.Vis2_Map_CreelDisplayType=='Scaled Size'&&(input.Vis2_MapDisplayField_Size=='Nothing Selected'||output.Vis_2_Input_SelectCount<1))||
                                                              (input.Vis2_Map_CreelDisplayType=='Both'&&(input.Vis2_MapDisplayField_Size=='Nothing Selected'||input.Vis2_MapDisplayField=='Nothing Selected'||output.Vis_2_Input_SelectCount<1))",
                                                              h3(strong("Visualization 2 Map Requirements"))
                                                              ),
                                             conditionalPanel(condition="input.Vis2_Map_CreelDisplayType==null",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Creel Data Marker Display Type "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2 Inputs->Creel Data Display->Select either 'Scaled Color', 'Scaled Size' or 'Both'")),
                                             conditionalPanel(condition="(input.Vis2_Map_CreelDisplayType=='Scaled Color'||input.Vis2_Map_CreelDisplayType=='Both')&&input.Vis2_MapDisplayField=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Map Display Field "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2 Inputs->Creel Data Display->Select Field for Display (Color)")),
                                             conditionalPanel(condition="(input.Vis2_Map_CreelDisplayType=='Scaled Size'||input.Vis2_Map_CreelDisplayType=='Both')&&input.Vis2_MapDisplayField_Size=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Map Display Size Field "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2 Inputs->Creel Data Display->Select Field for Display (Size)")),
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h5(strong("From Table Located Below:"), "Input (Vis. 2) Table->Select One or More Rows")),
                                             conditionalPanel(condition="(input.Vis2_Map_CreelDisplayType=='Scaled Color'&&input.Vis2_MapDisplayField!='Nothing Selected'&&output.Vis_2_Input_SelectCount>0)||
                                                              (input.Vis2_Map_CreelDisplayType=='Scaled Size'&&input.Vis2_MapDisplayField_Size!='Nothing Selected'&&output.Vis_2_Input_SelectCount>0)||
                                                              (input.Vis2_Map_CreelDisplayType=='Both'&&input.Vis2_MapDisplayField_Size!='Nothing Selected'&&input.Vis2_MapDisplayField!='Nothing Selected'&&output.Vis_2_Input_SelectCount>0)",
                                                              br(),
                                                              withSpinner(leafletOutput("MapVis4_2", height=365),type=2),
                                                              br(),
                                             ),
                                             
                            ),


                                                        conditionalPanel(condition="input.SelectVis2=='Scatter Plot'",
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1 || input.Vis2_ScatterX=='Nothing Selected'|| input.Vis2_ScatterY=='Nothing Selected'||
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis2_Scatter_MarkerColor_Numeric=='Nothing Selected')||
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Factors'&&input.Vis2_Scatter_MarkerColor_Factors=='Nothing Selected')||
                                                              (input.Vis2_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis2_Scatter_MarkerScaleSize=='Nothing Selected')
                                                              ",
                                                              h3(strong("Visualization 2 Scatter Requirements"))),
                                             conditionalPanel(condition="input.Vis2_ScatterX=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select X variable "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2 Inputs->Data Inputs->Select X Variable")),
                                             conditionalPanel(condition="input.Vis2_ScatterY=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Y variable "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2 Inputs->Data Inputs->Select Y Variable")),
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h5(strong("From Table Located Below:"), "Input (Vis. 2) Table->Select One or More Rows")),
                                             conditionalPanel(condition="input.Vis2_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis2_Scatter_MarkerColor_Numeric=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 2 Inputs->Marker Style->Select 'Color By:'")),
                                             conditionalPanel(condition="input.Vis2_Scatter_ColorGroupSwitch=='Factors'&&input.Vis2_Scatter_MarkerColor_Factors=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 2 Inputs->Marker Style->Select 'Color By:'")),
                                            conditionalPanel(condition="input.Vis2_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis2_Scatter_MarkerScaleSize=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker size on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 2 Inputs->Marker Style->Select Size Scale Field:")),
                                            conditionalPanel(condition="output.Vis_2_Input_SelectCount>0 && input.Vis2_ScatterX!='Nothing Selected'&& input.Vis2_ScatterY!='Nothing Selected'&&
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Uniform'||
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis2_Scatter_MarkerColor_Numeric!='Nothing Selected')||
                                                              (input.Vis2_Scatter_ColorGroupSwitch=='Factors'&&input.Vis2_Scatter_MarkerColor_Factors!='Nothing Selected'))&&
                                                              (input.Vis2_Scatter_MarkerSizeSwitch=='Uniform'||
                                                              (input.Vis2_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis2_Scatter_MarkerScaleSize!='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_4_2_Scatter", height=365),type=2),
                                                              br(),
                                             )
                            ),                  


 
                            conditionalPanel(condition="input.SelectVis2=='Line Plot'",
                                             conditionalPanel(condition="
                                                              input.Vis2_Line_Number==null
                                                              ||(input.Vis2_Line_Number==1&&(input.Vis2_LineY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Line_Number==2&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Line_Number==3&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Line_Number==4&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| input.Vis2_LineY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Line_Number==5&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| input.Vis2_LineY4=='Nothing Selected'|| input.Vis2_LineY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h3(strong("Visualization 2 Line Plot Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis2_Line_Number==null
                                                              ||(input.Vis2_Line_Number==1&&(input.Vis2_LineY1=='Nothing Selected'))
                                                              ||(input.Vis2_Line_Number==2&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'))
                                                              ||(input.Vis2_Line_Number==3&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'))
                                                              ||(input.Vis2_Line_Number==4&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| input.Vis2_LineY4=='Nothing Selected'))
                                                              ||(input.Vis2_Line_Number==5&&(input.Vis2_LineY1=='Nothing Selected'|| input.Vis2_LineY2=='Nothing Selected'|| input.Vis2_LineY3=='Nothing Selected'|| input.Vis2_LineY4=='Nothing Selected'|| input.Vis2_LineY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Number of Y Variables"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 2 data table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 2) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis2_Line_Number==1&&input.Vis2_LineY1!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==2&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==3&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==4&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==5&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&& input.Vis2_LineY5!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                            h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis2_Line_Number==1&&input.Vis2_LineY1!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Line_Number==2&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Line_Number==3&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Line_Number==4&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Line_Number==5&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&& input.Vis2_LineY5!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis2_Line_Number==1&&input.Vis2_LineY1!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==2&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==3&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==4&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Line_Number==5&&input.Vis2_LineY1!='Nothing Selected'&& input.Vis2_LineY2!='Nothing Selected'&& input.Vis2_LineY3!='Nothing Selected'&& input.Vis2_LineY4!='Nothing Selected'&& input.Vis2_LineY5!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_4_2_Line", height=365),type=2),
                                                              br())
                            ),
                            
                                                       conditionalPanel(condition="input.SelectVis2=='Bar Chart'",
                                             conditionalPanel(condition="
                                                              input.Vis2_Bar_Number==null
                                                              ||(input.Vis2_Bar_Number==1&&(input.Vis2_BarY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Bar_Number==2&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Bar_Number==3&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Bar_Number==4&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| input.Vis2_BarY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis2_Bar_Number==5&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| input.Vis2_BarY4=='Nothing Selected'|| input.Vis2_BarY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_2_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h3(strong("Visualization 2 Bar Chart Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis2_Bar_Number==null
                                                              ||(input.Vis2_Bar_Number==1&&(input.Vis2_BarY1=='Nothing Selected'))
                                                              ||(input.Vis2_Bar_Number==2&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'))
                                                              ||(input.Vis2_Bar_Number==3&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'))
                                                              ||(input.Vis2_Bar_Number==4&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| input.Vis2_BarY4=='Nothing Selected'))
                                                              ||(input.Vis2_Bar_Number==5&&(input.Vis2_BarY1=='Nothing Selected'|| input.Vis2_BarY2=='Nothing Selected'|| input.Vis2_BarY3=='Nothing Selected'|| input.Vis2_BarY4=='Nothing Selected'|| input.Vis2_BarY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Number of Y Variables"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 2 data table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 2) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis2_Bar_Number==1&&input.Vis2_BarY1!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==2&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==3&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==4&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==5&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&& input.Vis2_BarY5!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h4(strong("Required Action: "), "User must select at least one survey from either a map or scatterChart in one of the other visualizations"),
                                                            h5(strong("From a ScatterChart "), "use either the box or lasso select tool (in-Chart toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis2_Bar_Number==1&&input.Vis2_BarY1!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Bar_Number==2&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Bar_Number==3&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Bar_Number==4&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis2_Bar_Number==5&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&& input.Vis2_BarY5!='Nothing Selected'&& output.Vis_2_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis2_Bar_Number==1&&input.Vis2_BarY1!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==2&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==3&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==4&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis2_Bar_Number==5&&input.Vis2_BarY1!='Nothing Selected'&& input.Vis2_BarY2!='Nothing Selected'&& input.Vis2_BarY3!='Nothing Selected'&& input.Vis2_BarY4!='Nothing Selected'&& input.Vis2_BarY5!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_4_2_Bar", height=365),type=2),
                                                              br())
                            ),

                     

                            conditionalPanel(condition="input.SelectVis2=='Pie Chart'",
                                             conditionalPanel(condition="input.Vis2_Pie_CategoryType==null",
                                                              h3(strong("Visualization 2 Pie Chart Requirements")),
                                                              h4(strong("Required Action: "), "Select the category type"),
                                                              h5(strong("From the sidebar select:"), "Data Inputs->Metrics or Surveys")
                                             ),
                                             conditionalPanel(condition="input.Vis2_Pie_CategoryType=='Metrics'",
                                                      conditionalPanel(condition="input.Vis2_Pie_Metrics=='' ||((output.Vis_2_Input_SelectCount<1 && input.AF_LinkedSelection=='No')|| (output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes'))",
                                                             h3(strong("Visualization 2 Pie Chart Requirements"))),
                                                      conditionalPanel(condition="input.Vis2_Pie_Metrics==''",
                                                                       br(),
                                                                     h4(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h5(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Metrics")
                                                      ),
                                                      conditionalPanel(condition="output.Vis_2_Input_SelectCount<1",
                                                                       br(),
                                                              conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h4(strong("Required Action: "), "User must select at least one row from the Shared Data table"),
                                                              h5(strong("From Table Located Below: "), "Input Data->Select One or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 2 input table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 2) Table->Select One or More Rows")
                                                              ),
                                                      ),
                                           conditionalPanel(condition="input.Vis2_Pie_Metrics!=''&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                      conditionalPanel(condition="(input.Vis2_Pie_Metrics!='' && output.Vis_2_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis2_Pie_Metrics!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_4Vis>0)",
                                                                       br(),
                                                                       withSpinner(plotlyOutput("Vis_4_2_Pie_Metrics", height=365),type=2),
                                                                       br()
                                                                       )
                                                     ),
                                             conditionalPanel(condition="input.Vis2_Pie_CategoryType=='Surveys'",
                                                    conditionalPanel(condition="input.Vis2_Pie_Metrics_to_Sum=='' ||((output.Vis_2_Input_SelectCount<1 && input.AF_LinkedSelection=='No')|| (output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes'))",
                                                                     h3(strong("Visualization 2 Pie Chart Requirements"))
                                                                     ),
                                                    conditionalPanel(condition="input.Vis2_Pie_Metrics_to_Sum==''",
                                                                     br(),
                                                                     h4(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h5(strong("From Sidebar Select: "), "Visualization 2->Data Inputs->Select Metrics")
                                                                      ),
                                                    conditionalPanel(condition="output.Vis_2_Input_SelectCount<2",
                                                                     br(),
                                                            conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h4(strong("Required Action: "), "User must select at least two rows from the Shared Data table"),
                                                              h5(strong("From Table Located Below: "), "Input Data->Select Two or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h4(strong("Required Action: "), "User must select at least two rows from the Visualization 2 input table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 2) Table->Select Two or More Rows")
                                                              ),
                                                              ),
                                                        conditionalPanel(condition="input.Vis2_Pie_Metrics!=''&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                    conditionalPanel(condition="(input.Vis2_Pie_Metrics_to_Sum!='' && output.Vis_2_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis2_Pie_Metrics_to_Sum!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_4Vis>0)",
                                                                      br(),
                                                                     withSpinner(plotlyOutput("Vis_4_2_Pie_Surveys", height=365),type=2),
                                                                     br()
                                                                     )
                                                    ),

                                            )
                            
                       )
                            
                            
                              ),
                     fluidRow(
                       column(6,style = "border: 2px solid black;height:400px;",
                              conditionalPanel(condition="input.SelectVis3=='Nothing Selected'",                 
                                               h3(strong("Select Visualization Type")),
                                               h4(strong("Required Action: "), "Select the type of visualization you wish to create."),
                                               h5(strong("From Sidebar Select: "), "Visualization 3 Inputs->Select Visualization 3"),
                              ),
                              
                            conditionalPanel(condition="input.SelectVis3=='Map'",
                                             conditionalPanel(condition="(input.Vis3_Map_CreelDisplayType==null)||
                                                              (input.Vis3_Map_CreelDisplayType=='Scaled Color'&&(input.Vis3_MapDisplayField=='Nothing Selected'||output.Vis_3_Input_SelectCount<1))||
                                                              (input.Vis3_Map_CreelDisplayType=='Scaled Size'&&(input.Vis3_MapDisplayField_Size=='Nothing Selected'||output.Vis_3_Input_SelectCount<1))||
                                                              (input.Vis3_Map_CreelDisplayType=='Both'&&(input.Vis3_MapDisplayField_Size=='Nothing Selected'||input.Vis3_MapDisplayField=='Nothing Selected'||output.Vis_3_Input_SelectCount<1))",
                                                              h3(strong("Visualization 3 Map Requirements"))
                                                              ),
                                             conditionalPanel(condition="input.Vis3_Map_CreelDisplayType==null",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Creel Data Marker Display Type "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3 Inputs->Creel Data Display->Select either 'Scaled Color', 'Scaled Size' or 'Both'")),
                                             conditionalPanel(condition="(input.Vis3_Map_CreelDisplayType=='Scaled Color'||input.Vis3_Map_CreelDisplayType=='Both')&&input.Vis3_MapDisplayField=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Map Display Field "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3 Inputs->Creel Data Display->Select Field for Display (Color)")),
                                             conditionalPanel(condition="(input.Vis3_Map_CreelDisplayType=='Scaled Size'||input.Vis3_Map_CreelDisplayType=='Both')&&input.Vis3_MapDisplayField_Size=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Map Display Size Field "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3 Inputs->Creel Data Display->Select Field for Display (Size)")),
                                             conditionalPanel(condition="output.Vis_3_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h5(strong("From Table Located Below:"), "Input (Vis. 3) Table->Select One or More Rows")),
                                             conditionalPanel(condition="(input.Vis3_Map_CreelDisplayType=='Scaled Color'&&input.Vis3_MapDisplayField!='Nothing Selected'&&output.Vis_3_Input_SelectCount>0)||
                                                              (input.Vis3_Map_CreelDisplayType=='Scaled Size'&&input.Vis3_MapDisplayField_Size!='Nothing Selected'&&output.Vis_3_Input_SelectCount>0)||
                                                              (input.Vis3_Map_CreelDisplayType=='Both'&&input.Vis3_MapDisplayField_Size!='Nothing Selected'&&input.Vis3_MapDisplayField!='Nothing Selected'&&output.Vis_3_Input_SelectCount>0)",
                                                              br(),
                                                              withSpinner(leafletOutput("MapVis4_3", height=365),type=2),
                                                              br(),
                                             ),
                                             
                            ),

                                                        conditionalPanel(condition="input.SelectVis3=='Scatter Plot'",
                                             conditionalPanel(condition="output.Vis_3_Input_SelectCount<1 || input.Vis3_ScatterX=='Nothing Selected'|| input.Vis3_ScatterY=='Nothing Selected'||
                                                              (input.Vis3_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis3_Scatter_MarkerColor_Numeric=='Nothing Selected')||
                                                              (input.Vis3_Scatter_ColorGroupSwitch=='Factors'&&input.Vis3_Scatter_MarkerColor_Factors=='Nothing Selected')||
                                                              (input.Vis3_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis3_Scatter_MarkerScaleSize=='Nothing Selected')
                                                              ",
                                                              h3(strong("Visualization 3 Scatter Requirements"))),
                                             conditionalPanel(condition="input.Vis3_ScatterX=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select X variable "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3 Inputs->Data Inputs->Select X Variable")),
                                             conditionalPanel(condition="input.Vis3_ScatterY=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Y variable "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3 Inputs->Data Inputs->Select Y Variable")),
                                             conditionalPanel(condition="output.Vis_3_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h5(strong("From Table Located Below:"), "Input (Vis. 2) Table->Select One or More Rows")),
                                             conditionalPanel(condition="input.Vis3_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis3_Scatter_MarkerColor_Numeric=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 3 Inputs->Marker Style->Select 'Color By:'")),
                                             conditionalPanel(condition="input.Vis3_Scatter_ColorGroupSwitch=='Factors'&&input.Vis3_Scatter_MarkerColor_Factors=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 3 Inputs->Marker Style->Select 'Color By:'")),
                                            conditionalPanel(condition="input.Vis3_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis3_Scatter_MarkerScaleSize=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker size on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 3 Inputs->Marker Style->Select Size Scale Field:")),
                                            conditionalPanel(condition="output.Vis_3_Input_SelectCount>0 && input.Vis3_ScatterX!='Nothing Selected'&& input.Vis3_ScatterY!='Nothing Selected'&&
                                                              (input.Vis3_Scatter_ColorGroupSwitch=='Uniform'||
                                                              (input.Vis3_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis3_Scatter_MarkerColor_Numeric!='Nothing Selected')||
                                                              (input.Vis3_Scatter_ColorGroupSwitch=='Factors'&&input.Vis3_Scatter_MarkerColor_Factors!='Nothing Selected'))&&
                                                              (input.Vis3_Scatter_MarkerSizeSwitch=='Uniform'||
                                                              (input.Vis3_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis3_Scatter_MarkerScaleSize!='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_4_3_Scatter", height=365),type=2),
                                                              br(),
                                             )
                            ),               


                            conditionalPanel(condition="input.SelectVis3=='Line Plot'",
                                             conditionalPanel(condition="
                                                              input.Vis3_Line_Number==null
                                                              ||(input.Vis3_Line_Number==1&&(input.Vis3_LineY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Line_Number==2&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Line_Number==3&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'|| input.Vis3_LineY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Line_Number==4&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'|| input.Vis3_LineY3=='Nothing Selected'|| input.Vis3_LineY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Line_Number==5&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'|| input.Vis3_LineY3=='Nothing Selected'|| input.Vis3_LineY4=='Nothing Selected'|| input.Vis3_LineY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h3(strong("Visualization 3 Line Plot Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis3_Line_Number==null
                                                              ||(input.Vis3_Line_Number==1&&(input.Vis3_LineY1=='Nothing Selected'))
                                                              ||(input.Vis3_Line_Number==2&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'))
                                                              ||(input.Vis3_Line_Number==3&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'|| input.Vis3_LineY3=='Nothing Selected'))
                                                              ||(input.Vis3_Line_Number==4&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'|| input.Vis3_LineY3=='Nothing Selected'|| input.Vis3_LineY4=='Nothing Selected'))
                                                              ||(input.Vis3_Line_Number==5&&(input.Vis3_LineY1=='Nothing Selected'|| input.Vis3_LineY2=='Nothing Selected'|| input.Vis3_LineY3=='Nothing Selected'|| input.Vis3_LineY4=='Nothing Selected'|| input.Vis3_LineY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3->Data Inputs->Select Number of Y Variables"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_3_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 3 data table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 3) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis3_Line_Number==1&&input.Vis3_LineY1!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==2&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==3&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==4&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&& input.Vis3_LineY4!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==5&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&& input.Vis3_LineY4!='Nothing Selected'&& input.Vis3_LineY5!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                            h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis3_Line_Number==1&&input.Vis3_LineY1!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Line_Number==2&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Line_Number==3&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Line_Number==4&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&& input.Vis3_LineY4!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Line_Number==5&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&& input.Vis3_LineY4!='Nothing Selected'&& input.Vis3_LineY5!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis3_Line_Number==1&&input.Vis3_LineY1!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==2&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==3&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==4&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&& input.Vis3_LineY4!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Line_Number==5&&input.Vis3_LineY1!='Nothing Selected'&& input.Vis3_LineY2!='Nothing Selected'&& input.Vis3_LineY3!='Nothing Selected'&& input.Vis3_LineY4!='Nothing Selected'&& input.Vis3_LineY5!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_4_3_Line", height=365),type=2),
                                                              br())
                            ),
                            
                                                       conditionalPanel(condition="input.SelectVis3=='Bar Chart'",
                                             conditionalPanel(condition="
                                                              input.Vis3_Bar_Number==null
                                                              ||(input.Vis3_Bar_Number==1&&(input.Vis3_BarY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Bar_Number==2&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Bar_Number==3&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'|| input.Vis3_BarY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Bar_Number==4&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'|| input.Vis3_BarY3=='Nothing Selected'|| input.Vis3_BarY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis3_Bar_Number==5&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'|| input.Vis3_BarY3=='Nothing Selected'|| input.Vis3_BarY4=='Nothing Selected'|| input.Vis3_BarY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_3_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h3(strong("Visualization 3 Bar Chart Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis3_Bar_Number==null
                                                              ||(input.Vis3_Bar_Number==1&&(input.Vis3_BarY1=='Nothing Selected'))
                                                              ||(input.Vis3_Bar_Number==2&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'))
                                                              ||(input.Vis3_Bar_Number==3&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'|| input.Vis3_BarY3=='Nothing Selected'))
                                                              ||(input.Vis3_Bar_Number==4&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'|| input.Vis3_BarY3=='Nothing Selected'|| input.Vis3_BarY4=='Nothing Selected'))
                                                              ||(input.Vis3_Bar_Number==5&&(input.Vis3_BarY1=='Nothing Selected'|| input.Vis3_BarY2=='Nothing Selected'|| input.Vis3_BarY3=='Nothing Selected'|| input.Vis3_BarY4=='Nothing Selected'|| input.Vis3_BarY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3->Data Inputs->Select Number of Y Variables"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 3->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_3_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 3 data table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 3) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis3_Bar_Number==1&&input.Vis3_BarY1!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==2&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==3&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==4&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&& input.Vis3_BarY4!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==5&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&& input.Vis3_BarY4!='Nothing Selected'&& input.Vis3_BarY5!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h4(strong("Required Action: "), "User must select at least one survey from either a map or scatterChart in one of the other visualizations"),
                                                            h5(strong("From a ScatterChart "), "use either the box or lasso select tool (in-Chart toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis3_Bar_Number==1&&input.Vis3_BarY1!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Bar_Number==2&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Bar_Number==3&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Bar_Number==4&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&& input.Vis3_BarY4!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis3_Bar_Number==5&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&& input.Vis3_BarY4!='Nothing Selected'&& input.Vis3_BarY5!='Nothing Selected'&& output.Vis_3_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis3_Bar_Number==1&&input.Vis3_BarY1!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==2&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==3&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==4&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&& input.Vis3_BarY4!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis3_Bar_Number==5&&input.Vis3_BarY1!='Nothing Selected'&& input.Vis3_BarY2!='Nothing Selected'&& input.Vis3_BarY3!='Nothing Selected'&& input.Vis3_BarY4!='Nothing Selected'&& input.Vis3_BarY5!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_4_3_Bar", height=365),type=2),
                                                              br())
                            ),

                     

                            conditionalPanel(condition="input.SelectVis3=='Pie Chart'",
                                             conditionalPanel(condition="input.Vis3_Pie_CategoryType==null",
                                                              h3(strong("Visualization 3 Pie Chart Requirements")),
                                                              h4(strong("Required Action: "), "Select the category type"),
                                                              h5(strong("From the sidebar select:"), "Data Inputs->Metrics or Surveys")
                                             ),
                                             conditionalPanel(condition="input.Vis3_Pie_CategoryType=='Metrics'",
                                                      conditionalPanel(condition="input.Vis3_Pie_Metrics=='' ||((output.Vis_3_Input_SelectCount<1 && input.AF_LinkedSelection=='No')|| (output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes'))",
                                                             h3(strong("Visualization 3 Pie Chart Requirements"))),
                                                      conditionalPanel(condition="input.Vis3_Pie_Metrics==''",
                                                                       br(),
                                                                     h4(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h5(strong("From Sidebar Select: "), "Visualization 3->Data Inputs->Select Metrics")
                                                      ),
                                                      conditionalPanel(condition="output.Vis_3_Input_SelectCount<1",
                                                                       br(),
                                                              conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h4(strong("Required Action: "), "User must select at least one row from the Shared Data table"),
                                                              h5(strong("From Table Located Below: "), "Input Data->Select One or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 3 input table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 3) Table->Select One or More Rows")
                                                              ),
                                                      ),
                                           conditionalPanel(condition="input.Vis3_Pie_Metrics!=''&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                      conditionalPanel(condition="(input.Vis3_Pie_Metrics!='' && output.Vis_3_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis3_Pie_Metrics!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_4Vis>0)",
                                                                       br(),
                                                                       withSpinner(plotlyOutput("Vis_4_3_Pie_Metrics", height=365),type=2),
                                                                       br()
                                                                       )
                                                     ),
                                             conditionalPanel(condition="input.Vis3_Pie_CategoryType=='Surveys'",
                                                    conditionalPanel(condition="input.Vis3_Pie_Metrics_to_Sum=='' ||((output.Vis_3_Input_SelectCount<1 && input.AF_LinkedSelection=='No')|| (output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes'))",
                                                                     h3(strong("Visualization 3 Pie Chart Requirements"))
                                                                     ),
                                                    conditionalPanel(condition="input.Vis3_Pie_Metrics_to_Sum==''",
                                                                     br(),
                                                                     h4(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h5(strong("From Sidebar Select: "), "Visualization 3->Data Inputs->Select Metrics")
                                                                      ),
                                                    conditionalPanel(condition="output.Vis_3_Input_SelectCount<2",
                                                                     br(),
                                                            conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h4(strong("Required Action: "), "User must select at least two rows from the Shared Data table"),
                                                              h5(strong("From Table Located Below: "), "Input Data->Select Two or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h4(strong("Required Action: "), "User must select at least two rows from the Visualization 3 input table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 3) Table->Select Two or More Rows")
                                                              ),
                                                              ),
                                                        conditionalPanel(condition="input.Vis3_Pie_Metrics!=''&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                    conditionalPanel(condition="(input.Vis3_Pie_Metrics_to_Sum!='' && output.Vis_3_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis3_Pie_Metrics_to_Sum!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_4Vis>0)",
                                                                      br(),
                                                                     withSpinner(plotlyOutput("Vis_4_3_Pie_Surveys", height=365),type=2),
                                                                     br()
                                                                     )
                                                    ),

                                            )
                              
                              ),
                       column(6,style = "border: 2px solid black;height:400px;",
                              conditionalPanel(condition="input.SelectVis4=='Nothing Selected'",                 
                                               h3(strong("Select Visualization Type")),
                                               h4(strong("Required Action: "), "Select the type of visualization you wish to create."),
                                               h5(strong("From Sidebar Select: "), "Visualization 4 Inputs->Select Visualization 4"),
                              ),
                              
                            conditionalPanel(condition="input.SelectVis4=='Map'",
                                             conditionalPanel(condition="(input.Vis4_Map_CreelDisplayType==null)||
                                                              (input.Vis4_Map_CreelDisplayType=='Scaled Color'&&(input.Vis4_MapDisplayField=='Nothing Selected'||output.Vis_4_Input_SelectCount<1))||
                                                              (input.Vis4_Map_CreelDisplayType=='Scaled Size'&&(input.Vis4_MapDisplayField_Size=='Nothing Selected'||output.Vis_4_Input_SelectCount<1))||
                                                              (input.Vis4_Map_CreelDisplayType=='Both'&&(input.Vis4_MapDisplayField_Size=='Nothing Selected'||input.Vis4_MapDisplayField=='Nothing Selected'||output.Vis_4_Input_SelectCount<1))",
                                                              h3(strong("Visualization 4 Map Requirements"))
                                                              ),
                                             conditionalPanel(condition="input.Vis4_Map_CreelDisplayType==null",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Creel Data Marker Display Type "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 4 Inputs->Creel Data Display->Select either 'Scaled Color', 'Scaled Size' or 'Both'")),
                                             conditionalPanel(condition="(input.Vis4_Map_CreelDisplayType=='Scaled Color'||input.Vis4_Map_CreelDisplayType=='Both')&&input.Vis4_MapDisplayField=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Map Display Field "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 4 Inputs->Creel Data Display->Select Field for Display (Color)")),
                                             conditionalPanel(condition="(input.Vis4_Map_CreelDisplayType=='Scaled Size'||input.Vis4_Map_CreelDisplayType=='Both')&&input.Vis4_MapDisplayField_Size=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Map Display Size Field "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 4 Inputs->Creel Data Display->Select Field for Display (Size)")),
                                             conditionalPanel(condition="output.Vis_4_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h5(strong("From Table Located Below:"), "Input (Vis. 4) Table->Select One or More Rows")),
                                             conditionalPanel(condition="(input.Vis4_Map_CreelDisplayType=='Scaled Color'&&input.Vis4_MapDisplayField!='Nothing Selected'&&output.Vis_4_Input_SelectCount>0)||
                                                              (input.Vis4_Map_CreelDisplayType=='Scaled Size'&&input.Vis4_MapDisplayField_Size!='Nothing Selected'&&output.Vis_4_Input_SelectCount>0)||
                                                              (input.Vis4_Map_CreelDisplayType=='Both'&&input.Vis4_MapDisplayField_Size!='Nothing Selected'&&input.Vis4_MapDisplayField!='Nothing Selected'&&output.Vis_4_Input_SelectCount>0)",
                                                              br(),
                                                              withSpinner(leafletOutput("MapVis4_4", height=365),type=2),
                                                              br(),
                                             ),
                                             
                            ),

                            conditionalPanel(condition="input.SelectVis4=='Scatter Plot'",
                                             conditionalPanel(condition="output.Vis_4_Input_SelectCount<1 || input.Vis4_ScatterX=='Nothing Selected'|| input.Vis4_ScatterY=='Nothing Selected'||
                                                              (input.Vis4_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis4_Scatter_MarkerColor_Numeric=='Nothing Selected')||
                                                              (input.Vis4_Scatter_ColorGroupSwitch=='Factors'&&input.Vis4_Scatter_MarkerColor_Factors=='Nothing Selected')||
                                                              (input.Vis4_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis4_Scatter_MarkerScaleSize=='Nothing Selected')
                                                              ",
                                                              h3(strong("Visualization 4 Scatter Requirements"))),
                                             conditionalPanel(condition="input.Vis4_ScatterX=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select X variable "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 4 Inputs->Data Inputs->Select X Variable")),
                                             conditionalPanel(condition="input.Vis4_ScatterY=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select Y variable "),
                                                              h5(strong("From Sidebar Select: "), "Visualization 4 Inputs->Data Inputs->Select Y Variable")),
                                             conditionalPanel(condition="output.Vis_4_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select at least one survey from the data input table"),
                                                              h5(strong("From Table Located Below:"), "Input (Vis. 2) Table->Select One or More Rows")),
                                             conditionalPanel(condition="input.Vis4_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis4_Scatter_MarkerColor_Numeric=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 4 Inputs->Marker Style->Select 'Color By:'")),
                                             conditionalPanel(condition="input.Vis4_Scatter_ColorGroupSwitch=='Factors'&&input.Vis4_Scatter_MarkerColor_Factors=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker colors on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 4 Inputs->Marker Style->Select 'Color By:'")),
                                            conditionalPanel(condition="input.Vis4_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis4_Scatter_MarkerScaleSize=='Nothing Selected'",
                                                              br(),
                                                              h4(strong("Required Action: "), "Select field to base marker size on"),
                                                              h5(strong("From Sidebar Select:"), "Visualization 4 Inputs->Marker Style->Select Size Scale Field:")),
                                            conditionalPanel(condition="output.Vis_4_Input_SelectCount>0 && input.Vis4_ScatterX!='Nothing Selected'&& input.Vis4_ScatterY!='Nothing Selected'&&
                                                              (input.Vis4_Scatter_ColorGroupSwitch=='Uniform'||
                                                              (input.Vis4_Scatter_ColorGroupSwitch=='Numeric'&&input.Vis4_Scatter_MarkerColor_Numeric!='Nothing Selected')||
                                                              (input.Vis4_Scatter_ColorGroupSwitch=='Factors'&&input.Vis4_Scatter_MarkerColor_Factors!='Nothing Selected'))&&
                                                              (input.Vis4_Scatter_MarkerSizeSwitch=='Uniform'||
                                                              (input.Vis4_Scatter_MarkerSizeSwitch=='Scaled'&&input.Vis4_Scatter_MarkerScaleSize!='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_4_4_Scatter", height=365),type=2),
                                                              br(),
                                             )
                            ),                


            
                            conditionalPanel(condition="input.SelectVis4=='Line Plot'",
                                             conditionalPanel(condition="
                                                              input.Vis4_Line_Number==null
                                                              ||(input.Vis4_Line_Number==1&&(input.Vis4_LineY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_4_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis4_Line_Number==2&&(input.Vis4_LineY1=='Nothing Selected'|| input.Vis4_LineY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_4_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis4_Line_Number==3&&(input.Vis4_LineY1=='Nothing Selected'|| input.Vis4_LineY2=='Nothing Selected'|| input.Vis4_LineY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_4_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis4_Line_Number==4&&(input.Vis4_LineY1=='Nothing Selected'|| input.Vis4_LineY2=='Nothing Selected'|| input.Vis4_LineY3=='Nothing Selected'|| input.Vis4_LineY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_4_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis4_Line_Number==5&&(input.Vis4_LineY1=='Nothing Selected'|| input.Vis4_LineY2=='Nothing Selected'|| input.Vis4_LineY3=='Nothing Selected'|| input.Vis4_LineY4=='Nothing Selected'|| input.Vis4_LineY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_4_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h3(strong("Visualization 4 Line Plot Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis4_Line_Number==null
                                                              ||(input.Vis4_Line_Number==1&&(input.Vis4_LineY1=='Nothing Selected'))
                                                              ||(input.Vis4_Line_Number==2&&(input.Vis4_LineY1=='Nothing Selected'|| input.Vis4_LineY2=='Nothing Selected'))
                                                              ||(input.Vis4_Line_Number==3&&(input.Vis4_LineY1=='Nothing Selected'|| input.Vis4_LineY2=='Nothing Selected'|| input.Vis4_LineY3=='Nothing Selected'))
                                                              ||(input.Vis4_Line_Number==4&&(input.Vis4_LineY1=='Nothing Selected'|| input.Vis4_LineY2=='Nothing Selected'|| input.Vis4_LineY3=='Nothing Selected'|| input.Vis4_LineY4=='Nothing Selected'))
                                                              ||(input.Vis4_Line_Number==5&&(input.Vis4_LineY1=='Nothing Selected'|| input.Vis4_LineY2=='Nothing Selected'|| input.Vis4_LineY3=='Nothing Selected'|| input.Vis4_LineY4=='Nothing Selected'|| input.Vis4_LineY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 4->Data Inputs->Select Number of Y Variables"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 4->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_4_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 4 data table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 4) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis4_Line_Number==1&&input.Vis4_LineY1!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Line_Number==2&&input.Vis4_LineY1!='Nothing Selected'&& input.Vis4_LineY2!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Line_Number==3&&input.Vis4_LineY1!='Nothing Selected'&& input.Vis4_LineY2!='Nothing Selected'&& input.Vis4_LineY3!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Line_Number==4&&input.Vis4_LineY1!='Nothing Selected'&& input.Vis4_LineY2!='Nothing Selected'&& input.Vis4_LineY3!='Nothing Selected'&& input.Vis4_LineY4!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Line_Number==5&&input.Vis4_LineY1!='Nothing Selected'&& input.Vis4_LineY2!='Nothing Selected'&& input.Vis4_LineY3!='Nothing Selected'&& input.Vis4_LineY4!='Nothing Selected'&& input.Vis4_LineY5!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                            h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis4_Line_Number==1&&input.Vis4_LineY1!='Nothing Selected'&& output.Vis_4_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis4_Line_Number==2&&input.Vis4_LineY1!='Nothing Selected'&& input.Vis4_LineY2!='Nothing Selected'&& output.Vis_4_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis4_Line_Number==3&&input.Vis4_LineY1!='Nothing Selected'&& input.Vis4_LineY2!='Nothing Selected'&& input.Vis4_LineY3!='Nothing Selected'&& output.Vis_4_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis4_Line_Number==4&&input.Vis4_LineY1!='Nothing Selected'&& input.Vis4_LineY2!='Nothing Selected'&& input.Vis4_LineY3!='Nothing Selected'&& input.Vis4_LineY4!='Nothing Selected'&& output.Vis_4_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis4_Line_Number==5&&input.Vis4_LineY1!='Nothing Selected'&& input.Vis4_LineY2!='Nothing Selected'&& input.Vis4_LineY3!='Nothing Selected'&& input.Vis4_LineY4!='Nothing Selected'&& input.Vis4_LineY5!='Nothing Selected'&& output.Vis_4_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis4_Line_Number==1&&input.Vis4_LineY1!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Line_Number==2&&input.Vis4_LineY1!='Nothing Selected'&& input.Vis4_LineY2!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Line_Number==3&&input.Vis4_LineY1!='Nothing Selected'&& input.Vis4_LineY2!='Nothing Selected'&& input.Vis4_LineY3!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Line_Number==4&&input.Vis4_LineY1!='Nothing Selected'&& input.Vis4_LineY2!='Nothing Selected'&& input.Vis4_LineY3!='Nothing Selected'&& input.Vis4_LineY4!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Line_Number==5&&input.Vis4_LineY1!='Nothing Selected'&& input.Vis4_LineY2!='Nothing Selected'&& input.Vis4_LineY3!='Nothing Selected'&& input.Vis4_LineY4!='Nothing Selected'&& input.Vis4_LineY5!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_4_4_Line", height=365),type=2),
                                                              br())
                            ),
                            
                                                       conditionalPanel(condition="input.SelectVis4=='Bar Chart'",
                                             conditionalPanel(condition="
                                                              input.Vis4_Bar_Number==null
                                                              ||(input.Vis4_Bar_Number==1&&(input.Vis4_BarY1=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_4_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis4_Bar_Number==2&&(input.Vis4_BarY1=='Nothing Selected'|| input.Vis4_BarY2=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_4_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis4_Bar_Number==3&&(input.Vis4_BarY1=='Nothing Selected'|| input.Vis4_BarY2=='Nothing Selected'|| input.Vis4_BarY3=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_4_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis4_Bar_Number==4&&(input.Vis4_BarY1=='Nothing Selected'|| input.Vis4_BarY2=='Nothing Selected'|| input.Vis4_BarY3=='Nothing Selected'|| input.Vis4_BarY4=='Nothing Selected'|| (input.AF_LinkedSelection=='No'&&output.Vis_4_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ||(input.Vis4_Bar_Number==5&&(input.Vis4_BarY1=='Nothing Selected'|| input.Vis4_BarY2=='Nothing Selected'|| input.Vis4_BarY3=='Nothing Selected'|| input.Vis4_BarY4=='Nothing Selected'|| input.Vis4_BarY5=='Nothing Selected'||(input.AF_LinkedSelection=='No'&&output.Vis_4_Input_SelectCount<1)||(output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')))
                                                              ",
                                                              h3(strong("Visualization 4 Bar Chart Requirements"))
                                                              ),
                                             conditionalPanel(condition="
                                                              input.Vis4_Bar_Number==null
                                                              ||(input.Vis4_Bar_Number==1&&(input.Vis4_BarY1=='Nothing Selected'))
                                                              ||(input.Vis4_Bar_Number==2&&(input.Vis4_BarY1=='Nothing Selected'|| input.Vis4_BarY2=='Nothing Selected'))
                                                              ||(input.Vis4_Bar_Number==3&&(input.Vis4_BarY1=='Nothing Selected'|| input.Vis4_BarY2=='Nothing Selected'|| input.Vis4_BarY3=='Nothing Selected'))
                                                              ||(input.Vis4_Bar_Number==4&&(input.Vis4_BarY1=='Nothing Selected'|| input.Vis4_BarY2=='Nothing Selected'|| input.Vis4_BarY3=='Nothing Selected'|| input.Vis4_BarY4=='Nothing Selected'))
                                                              ||(input.Vis4_Bar_Number==5&&(input.Vis4_BarY1=='Nothing Selected'|| input.Vis4_BarY2=='Nothing Selected'|| input.Vis4_BarY3=='Nothing Selected'|| input.Vis4_BarY4=='Nothing Selected'|| input.Vis4_BarY5=='Nothing Selected'))
                                                              ",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select Y variable(s)"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 4->Data Inputs->Select Number of Y Variables"),
                                                              h5(strong("From Sidebar Select: "), "Visualization 4->Data Inputs->Select Y Variable")
                                                              ),
                                             conditionalPanel(condition="output.Vis_4_Input_SelectCount<1",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 4 data table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 4) Table->Select One or More Rows")
                                                              ),
                                             conditionalPanel(condition="
                                                              (input.Vis4_Bar_Number==1&&input.Vis4_BarY1!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Bar_Number==2&&input.Vis4_BarY1!='Nothing Selected'&& input.Vis4_BarY2!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Bar_Number==3&&input.Vis4_BarY1!='Nothing Selected'&& input.Vis4_BarY2!='Nothing Selected'&& input.Vis4_BarY3!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Bar_Number==4&&input.Vis4_BarY1!='Nothing Selected'&& input.Vis4_BarY2!='Nothing Selected'&& input.Vis4_BarY3!='Nothing Selected'&& input.Vis4_BarY4!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Bar_Number==5&&input.Vis4_BarY1!='Nothing Selected'&& input.Vis4_BarY2!='Nothing Selected'&& input.Vis4_BarY3!='Nothing Selected'&& input.Vis4_BarY4!='Nothing Selected'&& input.Vis4_BarY5!='Nothing Selected'&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes')
                                                              ",
                                                            br(),
                                                            h4(strong("Required Action: "), "User must select at least one survey from either a map or scatterChart in one of the other visualizations"),
                                                            h5(strong("From a ScatterChart "), "use either the box or lasso select tool (in-Chart toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                            h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                            ),
                                             conditionalPanel(condition="
                                                              ((input.Vis4_Bar_Number==1&&input.Vis4_BarY1!='Nothing Selected'&& output.Vis_4_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis4_Bar_Number==2&&input.Vis4_BarY1!='Nothing Selected'&& input.Vis4_BarY2!='Nothing Selected'&& output.Vis_4_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis4_Bar_Number==3&&input.Vis4_BarY1!='Nothing Selected'&& input.Vis4_BarY2!='Nothing Selected'&& input.Vis4_BarY3!='Nothing Selected'&& output.Vis_4_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis4_Bar_Number==4&&input.Vis4_BarY1!='Nothing Selected'&& input.Vis4_BarY2!='Nothing Selected'&& input.Vis4_BarY3!='Nothing Selected'&& input.Vis4_BarY4!='Nothing Selected'&& output.Vis_4_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              ||(input.Vis4_Bar_Number==5&&input.Vis4_BarY1!='Nothing Selected'&& input.Vis4_BarY2!='Nothing Selected'&& input.Vis4_BarY3!='Nothing Selected'&& input.Vis4_BarY4!='Nothing Selected'&& input.Vis4_BarY5!='Nothing Selected'&& output.Vis_4_Input_SelectCount>0&&input.AF_LinkedSelection=='No')
                                                              )||
                                                              ((input.Vis4_Bar_Number==1&&input.Vis4_BarY1!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Bar_Number==2&&input.Vis4_BarY1!='Nothing Selected'&& input.Vis4_BarY2!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Bar_Number==3&&input.Vis4_BarY1!='Nothing Selected'&& input.Vis4_BarY2!='Nothing Selected'&& input.Vis4_BarY3!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Bar_Number==4&&input.Vis4_BarY1!='Nothing Selected'&& input.Vis4_BarY2!='Nothing Selected'&& input.Vis4_BarY3!='Nothing Selected'&& input.Vis4_BarY4!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              ||(input.Vis4_Bar_Number==5&&input.Vis4_BarY1!='Nothing Selected'&& input.Vis4_BarY2!='Nothing Selected'&& input.Vis4_BarY3!='Nothing Selected'&& input.Vis4_BarY4!='Nothing Selected'&& input.Vis4_BarY5!='Nothing Selected'&&output.LinkedSel_4Vis>0&&input.AF_LinkedSelection=='Yes')
                                                              )
                                                              ", 
                                                              br(),
                                                              withSpinner(plotlyOutput("Vis_4_4_Bar", height=365),type=2),
                                                              br())
                            ),

                     

                            conditionalPanel(condition="input.SelectVis4=='Pie Chart'",
                                             conditionalPanel(condition="input.Vis4_Pie_CategoryType==null",
                                                              h3(strong("Visualization 4 Pie Chart Requirements")),
                                                              h4(strong("Required Action: "), "Select the category type"),
                                                              h5(strong("From the sidebar select:"), "Data Inputs->Metrics or Surveys")
                                             ),
                                             conditionalPanel(condition="input.Vis4_Pie_CategoryType=='Metrics'",
                                                      conditionalPanel(condition="input.Vis4_Pie_Metrics=='' ||((output.Vis_4_Input_SelectCount<1 && input.AF_LinkedSelection=='No')|| (output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes'))",
                                                             h3(strong("Visualization 4 Pie Chart Requirements"))),
                                                      conditionalPanel(condition="input.Vis4_Pie_Metrics==''",
                                                                       br(),
                                                                     h4(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h5(strong("From Sidebar Select: "), "Visualization 4->Data Inputs->Select Metrics")
                                                      ),
                                                      conditionalPanel(condition="output.Vis_4_Input_SelectCount<1",
                                                                       br(),
                                                              conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h4(strong("Required Action: "), "User must select at least one row from the Shared Data table"),
                                                              h5(strong("From Table Located Below: "), "Input Data->Select One or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h4(strong("Required Action: "), "User must select at least one row from the Visualization 4 input table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 4) Table->Select One or More Rows")
                                                              ),
                                                      ),
                                           conditionalPanel(condition="input.Vis4_Pie_Metrics!=''&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                      conditionalPanel(condition="(input.Vis4_Pie_Metrics!='' && output.Vis_4_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis4_Pie_Metrics!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_4Vis>0)",
                                                                       br(),
                                                                       withSpinner(plotlyOutput("Vis_4_4_Pie_Metrics", height=365),type=2),
                                                                       br()
                                                                       )
                                                     ),
                                             conditionalPanel(condition="input.Vis4_Pie_CategoryType=='Surveys'",
                                                    conditionalPanel(condition="input.Vis4_Pie_Metrics_to_Sum=='' ||((output.Vis_4_Input_SelectCount<1 && input.AF_LinkedSelection=='No')|| (output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes'))",
                                                                     h3(strong("Visualization 4 Pie Chart Requirements"))
                                                                     ),
                                                    conditionalPanel(condition="input.Vis4_Pie_Metrics_to_Sum==''",
                                                                     br(),
                                                                     h4(strong("Required Action: "), "User must select categories for the pie chart"),
                                                                     h5(strong("From Sidebar Select: "), "Visualization 4->Data Inputs->Select Metrics")
                                                                      ),
                                                    conditionalPanel(condition="output.Vis_4_Input_SelectCount<2",
                                                                     br(),
                                                            conditionalPanel(condition="input.AF_SharedData=='Yes'",
                                                              h4(strong("Required Action: "), "User must select at least two rows from the Shared Data table"),
                                                              h5(strong("From Table Located Below: "), "Input Data->Select Two or More Rows")
                                                              ),
                                                              conditionalPanel(condition="input.AF_SharedData=='No'",
                                                              h4(strong("Required Action: "), "User must select at least two rows from the Visualization 4 input table"),
                                                              h5(strong("From Table Located Below: "), "Input (Vis. 4) Table->Select Two or More Rows")
                                                              ),
                                                              ),
                                                        conditionalPanel(condition="input.Vis4_Pie_Metrics!=''&&output.LinkedSel_4Vis<1&&input.AF_LinkedSelection=='Yes'",
                                                              br(),
                                                              h4(strong("Required Action: "), "User must select at least one survey from either a map or scatter plot in one of the other visualizations"),
                                                              h5(strong("From a Scatter Plot "), "use either the box or lasso select tool (in-plot toolset) to select markers associated with surveys you wish to pass to the visualization"),
                                                              h5(strong("From a Map "), "use either the polygon, state, or county selection tool (sidebar) to select markers associated with surveys you wish to pass to the visualization")
                                                              ),
                                                    conditionalPanel(condition="(input.Vis4_Pie_Metrics_to_Sum!='' && output.Vis_4_Input_SelectCount>0&&(input.AF_SharedData=='No'||input.AF_LinkedSelection=='No'))||(input.Vis4_Pie_Metrics_to_Sum!='' && input.AF_LinkedSelection=='Yes'&& output.LinkedSel_4Vis>0)",
                                                                      br(),
                                                                     withSpinner(plotlyOutput("Vis_4_4_Pie_Surveys", height=365),type=2),
                                                                     br()
                                                                     )
                                                    ),

                                            )
                         
                              )
                     ),
                     ),
    
         column(12,
                br(),
                br(),
                conditionalPanel(condition="(input.AF_VisNum_Selection=='1'
                      ||(input.AF_VisNum_Selection>1&&input.AF_LinkedSelection=='No')
                      ||(input.AF_VisNum_Selection>1&&input.AF_LinkedSelection=='Yes'&&input.AF_LinkedSelection!=null)
                      )",
                tabsetPanel(
                  tabPanel("Input Data", #Shared Input
                           div(withSpinner(DT::dataTableOutput("Vis_Filters_Shared"),type=2))
                           ),  
                  tabPanel("Selected Data",
                           radioGroupButtons("Linked_SelectionView", status='primary',h5(strong(HTML("Linked Selection&nbsp", as.character(actionLink(inputId = "LinkedSelect_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("View","Make"),selected="View"),
                           conditionalPanel(condition="input.Linked_SelectionView=='View'",
                              div(withSpinner(DT::dataTableOutput("Vis_Linked_Selection_DT"),type=2))              
                           ),
                           conditionalPanel(condition="input.Linked_SelectionView=='Make'",
                              div(withSpinner(DT::dataTableOutput("Vis_Linked_VisSelect_Make"),type=2)) 
                           ),
                           ),   
                  tabPanel("Input (Vis. 1)",
                           div(withSpinner(DT::dataTableOutput("Vis_1_Input"),type=2))
                           ),  
                  tabPanel("Selection (Vis. 1)",
                           radioGroupButtons("Vis1_SelectionView", status='primary',h5(strong(HTML("Visualization 1 Selection&nbsp", as.character(actionLink(inputId = "Vis1Select_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("View","Make"),selected="View"),
                           conditionalPanel(condition="input.Vis1_SelectionView=='View'",
                              div(withSpinner(DT::dataTableOutput("Vis_1_VisSelect"),type=2))              
                           ),
                           conditionalPanel(condition="input.Vis1_SelectionView=='Make'",
                              div(withSpinner(DT::dataTableOutput("Vis_1_VisSelect_Make"),type=2)) 
                           ),
                           ),   
                  tabPanel("Input (Vis. 2)",
                           div(withSpinner(DT::dataTableOutput("Vis_2_Input"),type=2))
                           ),  
                  tabPanel("Selection (Vis. 2)",
                           radioGroupButtons("Vis2_SelectionView", status='primary',h5(strong(HTML("Visualization 2 Selection&nbsp", as.character(actionLink(inputId = "Vis2Select_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("View","Make"),selected="View"),
                           conditionalPanel(condition="input.Vis2_SelectionView=='View'",
                              div(withSpinner(DT::dataTableOutput("Vis_2_VisSelect"),type=2))              
                           ),
                           conditionalPanel(condition="input.Vis2_SelectionView=='Make'",
                              div(withSpinner(DT::dataTableOutput("Vis_2_VisSelect_Make"),type=2)) 
                           ),
                           ),  
                  tabPanel("Input (Vis. 3)",
                           div(withSpinner(DT::dataTableOutput("Vis_3_Input"),type=2))
                           ),  
                  tabPanel("Selection (Vis. 3)",
                           radioGroupButtons("Vis3_SelectionView", status='primary',h5(strong(HTML("Visualization 3 Selection&nbsp", as.character(actionLink(inputId = "Vis3Select_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("View","Make"),selected="View"),
                           conditionalPanel(condition="input.Vis3_SelectionView=='View'",
                              div(withSpinner(DT::dataTableOutput("Vis_3_VisSelect"),type=2))              
                           ),
                           conditionalPanel(condition="input.Vis3_SelectionView=='Make'",
                              div(withSpinner(DT::dataTableOutput("Vis_3_VisSelect_Make"),type=2)) 
                           ),
                           ),  
                  tabPanel("Input (Vis. 4)",
                           div(withSpinner(DT::dataTableOutput("Vis_4_Input"),type=2))
                           ),  
                  tabPanel("Selection (Vis. 4)",
                           radioGroupButtons("Vis4_SelectionView", status='primary',h5(strong(HTML("Visualization 4 Selection&nbsp", as.character(actionLink(inputId = "Vis4Select_Tip", HTML('<i class="fas fa-info-circle"></i>')))))), choices=c("View","Make"),selected="View"),
                           conditionalPanel(condition="input.Vis4_SelectionView=='View'",
                              div(withSpinner(DT::dataTableOutput("Vis_4_VisSelect"),type=2))              
                           ),
                           conditionalPanel(condition="input.Vis4_SelectionView=='Make'",
                              div(withSpinner(DT::dataTableOutput("Vis_4_VisSelect_Make"),type=2)) 
                           ),
                           ),  
                      id = "VisDataTabsetPanels"
                      )
                ),
                ),
             ),

            )
 ))),  


  

    
tags$script(
  HTML("var header = $('.navbar > .container-fluid');
                              header.append('<div style=\"float:right; padding-top: 8px\"><button id=\"DataSelShow\" type=\"button\" class=\"btn btn-warning action-button\" onclick=\"signIn()\">Show Sidebar</button></div>')")
)
               
),
id="main")
)
)




#### Server ####
server <- function(input, output, session) {
  
  
#### App Opening Popups ####
    
    #### Beta Popup Notification ####
    showModal(modalDialog(
        footer=list(actionButton("BetaClick", label="Click to continue")),
        title = strong("You are Accessing the Beta Version of CreelCat App"),
        h3(strong('Attention:'),' This app is currently in development and some features may be missing or result in errors. The user guide and help dialogues are currently being revised.'),
        br(),
        h4('We are in the process of uploading data and have about half of the data loaded into the web-app. This data has not yet been fully vetted and is not approved for use beyond testing. We anticipate an initial data release with approval for use coming in October.'),
       br(),
        h4('Information currently contained in the database is for ',strong('testing purposes
          only'),'. Additionally, many of the features of the app are still in active development. Please contact us with any questions, feedback, or if you would like to
          recieve updates about the status of the dataset and application. The CreelCat team may be reached by contacting Nicholas
           Sievert at ',strong('NicholasSievert@gmail.com')),
        easyClose=FALSE
    ))

    #### Data Considerations Notification ####
    observeEvent(input$BetaClick,{
        showModal(modalDialog(
            footer=list(actionButton("DataConsiderationBTN", label="Click to continue")),
            title = strong("Important Data Consideration"),
            h3(strong("Surveys use a variety of methods and can differ in a variety of ways including (but not limited to):")),
            h3(strong("Timing and Duration, Survey Protocols, Estimation Methods, Types of Data Collected, and Taxonomic Units")),
            h4("Where possible we have standardized the data, such as converting units, however in many cases our ability to do
               so was limited based on available data. We encourage users to pay attention to the app supplied data warnings, 
               which flag potential discrepancies in selected data, as well as evaluating the data on their own to identify 
               and determine how to account for data. We recommend users review the 'Data Considerations' tab within any of 
               the user-guide sections for additional information. ", strong("CreelCat users are responsible evaluating whether selected 
               surveys are valid for analysis, comparison, summarization, visualization, etc.")),
            easyClose = FALSE
        ))
    },ignoreInit=TRUE)
  
      observeEvent(input$DataConsiderationBTN,{
        showModal(modalDialog(
            footer=list(actionButton("TipsBTN", label="Click to continue")),
            title = strong("Important Tips"),
            h4(strong("Data Selection: "), "Limiting selection to only those surveys of interest, via the 'Select Data' menu on the sidebar, 
               either through filtering surveys or spatial selection will improve app performance. The inclusion of too many surveys may result 
               in slow processing or crashing of the app."),
            h4(strong("Field Selection: "), "Limiting selection to only those fields of interest, via the 'Select Fields' menu on the sidebar, 
               will improve app performance. The inclusion of too many fields may result in slow processing or crashing of the app."),
            easyClose = FALSE
        ))
    },ignoreInit=TRUE)
  
      observeEvent(input$TipsBTN,{
        showModal(modalDialog(
            footer=list(modalButton(label="Click to continue")),
            title = strong("Disclaimers"),
            h4(strong("Data: "), "The data you have secured from the U.S. Geological Survey (USGS) database identified as CreelCat have not received USGS approval 
               and as such are provisional and subject to revision. The data are released on the condition that neither the USGS nor the U.S. 
               Government shall be held liable for any damages resulting from its authorized or unauthorized use."),
            h4(strong("Data Processing: "),"Although these data have been processed successfully on a computer system at the U.S. Geological Survey (USGS), 
            no warranty expressed or implied is made regarding the display or utility of the data for other purposes, nor on 
            all computer systems, nor shall the act of distribution constitute any such warranty. The USGS or the U.S. Government 
            shall not be held liable for improper or incorrect use of the data described and/or contained herein."),
            h4(strong("Software: "),"This software has not yet been approved for release by the U.S. Geological Survey (USGS). Although the software has 
            been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further 
            analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the 
            functionality of the software and related material nor shall the fact of release constitute any such warranty. 
            Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held 
            liable for any damages resulting from its authorized or unauthorized use."),
            h4(strong("State Disclaimers"), "In the process of aquiring this data we were instructed by several states to acknowledge that although 
               the data were collected and shared with consideration of accuracy and sound science, limitations to the accuracy and inference scope 
               of the data may exist. Therefore, there are no guarantees regarding the accuracy or utility of the data being provided."),
            # h4(strong("Software: "),"This software has been approved for release by the U.S. Geological Survey (USGS). Although the software has 
            # been subjected to rigorous review, the USGS reserves the right to update the software as needed pursuant to further 
            # analysis and review. No warranty, expressed or implied, is made by the USGS or the U.S. Government as to the 
            # functionality of the software and related material nor shall the fact of release constitute any such warranty. 
            # Furthermore, the software is released on condition that neither the USGS nor the U.S. Government shall be held 
            # liable for any damages resulting from its authorized or unauthorized use."),
            easyClose = FALSE
        ))
    },ignoreInit=TRUE)
  
#### Sidebar Visibility #####
  observeEvent(input$DataSelHide, {
    hideElement(selector = "#sidebar")
    removeCssClass("main", "col-sm-8")
    addCssClass("main", "col-sm-12")
  },ignoreInit=TRUE)
  
  observeEvent(input$DataSelShow, {
    showElement(selector = "#sidebar")
    removeCssClass("main", "col-sm-12")
    addCssClass("main", "col-sm-8")
  },ignoreInit=TRUE)

# Hide button on startup #
  shinyjs::hide("DataSelShow")

# Show button when collapsed
  observeEvent(input$DataSelHide, {
    shinyjs::show("DataSelShow")
  },ignoreInit=TRUE)
  
# Hide Button when open
  observeEvent(input$DataSelShow, {
    shinyjs::hide("DataSelShow")
  },ignoreInit=TRUE)

# Sidebar automatic collapse
  
  observeEvent(input$FieldUpdateBTN, {
    updateCollapse(session, "Fields_Collapse", close="SelectFieldsCollapse")
  },ignoreInit=TRUE)
  
   observeEvent(input$SelDataContents, {
     req(input$SelDataContents=="All")
    updateCollapse(session, "SelData_SelectCollapse", close="SelDataChoice")
  },ignoreInit=TRUE)
   
   observeEvent(input$Vis1_Map_CreelDisplayType, {
     if(input$Vis1_Map_CreelDisplayType=="Both"){
     updateCollapse(session, "Vis1Map_Collapse_Size", open="Size Settings")
     updateCollapse(session, "Vis1Map_Collapse_Color", open="Color Settings")
     } else if (input$Vis1_Map_CreelDisplayType=="Scaled Color"){
     updateCollapse(session, "Vis1Map_Collapse_Color", open="Color Settings")
     } else if (input$Vis1_Map_CreelDisplayType=="Scaled Size"){
     updateCollapse(session, "Vis1Map_Collapse_Size", open="Size Settings")
     }
   },ignoreInit=TRUE)

   observeEvent(input$Vis2_Map_CreelDisplayType, {
     if(input$Vis2_Map_CreelDisplayType=="Both"){
     updateCollapse(session, "Vis2Map_Collapse_Size", open="Size Settings")
     updateCollapse(session, "Vis2Map_Collapse_Color", open="Color Settings")
     } else if (input$Vis2_Map_CreelDisplayType=="Scaled Color"){
     updateCollapse(session, "Vis2Map_Collapse_Color", open="Color Settings")
     } else if (input$Vis2_Map_CreelDisplayType=="Scaled Size"){
     updateCollapse(session, "Vis2Map_Collapse_Size", open="Size Settings")
     }
   },ignoreInit=TRUE)
   
   observeEvent(input$Vis3_Map_CreelDisplayType, {
     if(input$Vis3_Map_CreelDisplayType=="Both"){
     updateCollapse(session, "Vis3Map_Collapse_Size", open="Size Settings")
     updateCollapse(session, "Vis3Map_Collapse_Color", open="Color Settings")
     } else if (input$Vis3_Map_CreelDisplayType=="Scaled Color"){
     updateCollapse(session, "Vis3Map_Collapse_Color", open="Color Settings")
     } else if (input$Vis3_Map_CreelDisplayType=="Scaled Size"){
     updateCollapse(session, "Vis3Map_Collapse_Size", open="Size Settings")
     }
   },ignoreInit=TRUE)   
   
   observeEvent(input$Vis4_Map_CreelDisplayType, {
     if(input$Vis4_Map_CreelDisplayType=="Both"){
     updateCollapse(session, "Vis4Map_Collapse_Size", open="Size Settings")
     updateCollapse(session, "Vis4Map_Collapse_Color", open="Color Settings")
     } else if (input$Vis4_Map_CreelDisplayType=="Scaled Color"){
     updateCollapse(session, "Vis4Map_Collapse_Color", open="Color Settings")
     } else if (input$Vis4_Map_CreelDisplayType=="Scaled Size"){
     updateCollapse(session, "Vis4Map_Collapse_Size", open="Size Settings")
     }
   },ignoreInit=TRUE)   
   
#### Field Metadata ####
  output$FieldMeta_All_ViewFilt<-DT::renderDataTable(
    Fields_All, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Survey_ViewFilt<-DT::renderDataTable(
    Fields_Survey, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Waterbody_ViewFilt<-DT::renderDataTable(
    Fields_Waterbody, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  
  output$FieldMeta_Fish_ViewFilt<-DT::renderDataTable(
    Fields_Fish, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )

  output$FieldMeta_Effort_ViewFilt<-DT::renderDataTable(
    Fields_Effort,
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Preference_ViewFilt<-DT::renderDataTable(
    Fields_Preference, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Demographic_ViewFilt<-DT::renderDataTable(
    Fields_Demographic, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
  
  output$FieldMeta_All_Vis<-DT::renderDataTable(
    Fields_All, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Survey_Vis<-DT::renderDataTable(
    Fields_Survey, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Waterbody_Vis<-DT::renderDataTable(
    Fields_Waterbody, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  
  output$FieldMeta_Fish_Vis<-DT::renderDataTable(
    Fields_Fish, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )

  output$FieldMeta_Effort_Vis<-DT::renderDataTable(
    Fields_Effort,
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Preference_Vis<-DT::renderDataTable(
    Fields_Preference, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Demographic_Vis<-DT::renderDataTable(
    Fields_Demographic, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
  
  output$FieldMeta_All_Sum<-DT::renderDataTable(
    Fields_All, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Survey_Sum<-DT::renderDataTable(
    Fields_Survey, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Waterbody_Sum<-DT::renderDataTable(
    Fields_Waterbody, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  
  output$FieldMeta_Fish_Sum<-DT::renderDataTable(
    Fields_Fish, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )

  output$FieldMeta_Effort_Sum<-DT::renderDataTable(
    Fields_Effort,
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Preference_Sum<-DT::renderDataTable(
    Fields_Preference, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Demographic_Sum<-DT::renderDataTable(
    Fields_Demographic, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
  
  output$FieldMeta_All_SB<-DT::renderDataTable(
    Fields_All, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=10,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Survey_SB<-DT::renderDataTable(
    Fields_Survey, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=10,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Waterbody_SB<-DT::renderDataTable(
    Fields_Waterbody, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=10,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  
  output$FieldMeta_Fish_SB<-DT::renderDataTable(
    Fields_Fish, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=10,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
  
  output$FieldMeta_Fish_SB2<-DT::renderDataTable(
    Fields_Fish, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=10,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
  
output$TaxaLookup<-DT::renderDataTable(
    TaxaTable, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=10,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
  
output$GroupComposition<-DT::renderDataTable(
    GroupTaxa, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=10,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
  output$FieldMeta_Effort_SB<-DT::renderDataTable(
    Fields_Effort,
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=10,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Preference_SB<-DT::renderDataTable(
    Fields_Preference, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=10,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
  
  output$FieldMeta_Preference_SB2<-DT::renderDataTable(
    Fields_Preference, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=10,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
   
  output$FieldMeta_Demographic_SB<-DT::renderDataTable(
    Fields_Demographic, 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=10,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display compact",
      filter="top",
      server = FALSE
    )
  
# #### Data Warning Modals ###  
#         observeEvent(input$Compiled_Unattributed_Tip,{
#         showModal(modalDialog(
#             footer=list(modalButton(label="Close")),
#             size=c("l"),
#             title = strong("Unattributed Taxa"),
#             h4(strong("Surveys include Unattributed Taxa: ")),
#             h4(strong("Unattributed Taxa: "), "Noted taxa include those which have potentially unattributed data. Unattributed data occurs when values have been attributed 
#                at a higher taxonomic order, or within a non-taxonomic group, and therefore can not be directly attributed to the selected taxa. This results in the potential 
#                for the dataset to be missing values for the identified species. Leading to the potential for missing occurrence or underestimation of selected metrics."),
#             h4(strong("Example: "), "A survey of Teal Lake estimated that 150 'Pomoxis (Crappies)' were harvested, if you selected. 'Pomoxis annularis (White Crappie)' 
#                some or all of the 150 could be 'Pomoxis annularis (White Crappie)' but that value can not be attributed. Therefore any comparison/analysis which includes this 
#                this survey could potentially underestimate the number of 'Pomoxis annularis (White Crappie)' in the survey"),
#             h4(strong("Recommendation: "), "Replace unattributed taxa listed here with a higher taxonomic (or group) selection. (For example replace 'Pomoxis annularis (White Crappie)' with 'Pomoxis (Crappies)'."),
#             h4(strong("Recommendation: "), "Select 'Yes' from the 'Drop Surveys Containing Unattrributed/Partially Attributed Taxa' button below. This will cause any surveys containing unattributed or partiallyl attributed 
#                taxa to be dropped from the displayed table."),
#             easyClose = TRUE
#         ))
#     },ignoreInit=TRUE)
#         
#         observeEvent(input$Compiled_PartiallyAttributed_Tip,{
#         showModal(modalDialog(
#             footer=list(modalButton(label="Close")),
#             size=c("l"),
#             title = strong("Partially Attributed Taxa"),
#             h4(strong("Surveys include Partially Attributed Taxa: ")),
#             h4(strong("Partially Attributed Taxa: "), "Noted taxa include those which have potentially partially attributed data. Partially attributed data occurs when values have been attributed 
#                at a higher taxonomic order, or within a non-taxonomic group, and therefore can not be directly attributed to the selected taxa, while also being attributed at the desired taxonomic level. This results in the potential 
#                for the dataset to be underestimating values for the identified species."),
#             h4(strong("Example: "), "A survey of Teal Lake estimated that 150 'Pomoxis (Crappies)' and 25 'Pomoxis annularis (White Crappies)' were caught, if you selected. 'Pomoxis annularis (White Crappie)' 
#                some or all of the 150 'Pomoxis (Crappies)' could be 'Pomoxis annularis (White Crappie)' but that value can not be attributed, so the true value for 'Pomoxis annularis (White Crappie)' is somewhere 
#                between the recorded 25 and the maximum potential of 175 (if all the 'Pomoxis (Crappies)' were in fact 'Pomoxis annularis (White Crappie)'. Therefore any comparison/analysis which includes this 
#                this survey could potentially underestimate the number of 'Pomoxis annularis (White Crappie)' in the survey."),
#             h4(strong("Recommendation: "), "Replace partially attributed taxa listed here with a higher taxonomic (or group) selection. (For example replace 'Pomoxis annularis (White Crappie)' with 'Pomoxis (Crappies)'."),
#             h4(strong("Recommendation: "), "Select 'Yes' from the 'Drop Surveys Containing Unattrributed/Partially Attributed Taxa' button below. This will cause any surveys containing unattributed or partially attributed 
#                taxa to be dropped from the displayed table."),
#             easyClose = TRUE
#         ))
#     },ignoreInit=TRUE)
#         
#         observeEvent(input$Compiled_Attributed_Tip,{
#         showModal(modalDialog(
#             footer=list(modalButton(label="Close")),
#             size=c("l"),
#             title = strong("Attributed Taxa"),
#             h4(strong("Lists of alternative taxonomic selections to avoid unattributed and partially attributed taxa: ")),
#             h4("These are the taxa that were actually attributed in the reported survey data as well as the count of number of surveys in which this was the case. By switching to 
#                these attributed taxa you will gain attribution for at least the number listed with each and in many cases significantly more."),
#             h4(strong("Example: "), "You select 'Pomoxis annularis (White Crappie)' as a desired taxa from the sidebar. The attributed taxa list shows 200 surveys were attributed as 'Pomoxis (Crappies)' 
#                and 10 surveys were attributed to 'Centraridae (Sunfishes)'. This means that if you switch to 'Pomoxis (Crappies)' you will gain 200 more attributed surveys, and if you switch to 'Centrarchidae (Sunfishes)' 
#                you will gain 210 attributed surverys (10 for the 'Centrarchidae (Sunfishes)' attribution, and 200 because 'Pomoxis (Crappies)' are recognized as Centrarchids and automatically included in those values."),
#             h4(strong("Recommendation: "), "Substitute unattributed taxa for attributed taxa where possible."),
#             h4(strong("Recommendation: "), "Select 'Yes' from the 'Drop Surveys Containing Unattrributed/Partially Attributed Taxa' button below to drop any remaining surveys which contain unattributed and/or partially attributed surveys."),
#             easyClose = TRUE
#         ))
#     },ignoreInit=TRUE)
#         
#         observeEvent(input$Compiled_Overlap_Tip,{
#         showModal(modalDialog(
#             footer=list(modalButton(label="Close")),
#             size=c("l"),
#             title = strong("Overlapping Taxa"),
#             h4(strong("Selected taxa result in overlapping values: ")),
#             h4("Values are automatically attributed across taxonomic levels. The taxa you have selected will result in values which are attributed to mutlple taxa and/or groups."),
#             h4(strong("Example: "), "You select both 'Trout' and 'Oncorhynchus mykiss (Rainbow Trout)' as Taxa. If Rainbow Trout has 
#                a harvest estimate of 75, and Trout has an estimate of 100. That means that the 75 Rainbow Trout are represented both within 
#                the Rainbow Trout estimate as well as the Trout estimate (75/100 Trout are Rainbow Trout)."),
#             h4(strong("Recommendation: "), "If making any comparisons among taxa in which double counting of fish would be determimental for each overlap pair be sure to remove one taxa 
#                in order to eliminate all overlaps."),
#             easyClose = TRUE
#         ))
#     },ignoreInit=TRUE)
#         
#         
#          
#         observeEvent(input$Compiled_Incomplete_Tip ,{
#         showModal(modalDialog(
#             footer=list(modalButton(label="Close")),
#             size=c("l"),
#             title = strong("Incomplete Group Attribution"),
#             h4(strong("Surveys include Incomplete Attribution of Groups: ")),
#             h4(strong("Incomplete Group Attribution: "), "Noted groups include those which have potential underestimation of values based on values attributed to taxa from which only some members are included within 
#                the membership of that group. Because the proportion of the values associated with the noted taxa attributable to the group can not be determined they are not attributed. This results in potential underestimation of the 
#                true value for a given group."),
#             h4(strong("Example: "), "A user wishes to view the number of 'Trout' caught in a survey on Lake Superior. A portion of the catch (50 individuals) was attributed to 'Salmonidae (Salmon Family)'. Because the group 'Trout' 
#                contains some Salmonid species (Rainbow Trout, Lake Trout, Brown Trout, etc.) but not other Salmonid Species (Chinook Salmon, Coho Salmon, etc.) it is unknown what if any porportion of the 50 Salmonids recorded as caught 
#                should be attributed to 'Trout', and therefore none are attributed. This results in a potential underestimate of the true value between 0 (None of the recorded Salmonids were 'Trout' to 50 (All of the recorded Salmonids were 'Trout')."),
#             h4(strong("Recommendation: "), "Consider using taxonomic attributions instead of group attributions. However, sometimes this may prove detrimental as values assigned to a group can not always be assigned to a taxa ('Trout' can be assigned to 
#                'Salmonidae (Salmon and Trout Family)' as all taxa within 'Trout' are salmonids but can not be assigned to 'Oncorhynchus (Pacific Salmons and Trouts)' as not all of the recorded 'Trout' are necessarily from this genus."),
#             h4(strong("Recommendation: "), "Select 'Yes' from the 'Drop Surveys Containing Incompletely Attributed Groups' button below. This will cause any surveys containing incompletely attributed 
#                groups to be dropped from the displayed table."),
#             easyClose = TRUE
#         ))
#     },ignoreInit=TRUE)
  
#### Field Sidebar Modals ####
  
      observeEvent(input$VisFieldChoiceTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Select Fields"),
            h4(strong("Instructions: "), "Select all field(s) you wish to include, then click the 'Update Selected Fields' button."),
            h4(strong("Note: "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected fields to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            h3("CreelCat Field Descriptions"),
            div(withSpinner(DT::dataTableOutput("FieldMeta_All_SB"),type=2)),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

      observeEvent(input$VisFieldChoiceTip_Survey,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Fields"),
            h4(strong("Description: "), "Fields related to survey characteristics and methods."),
            h4(strong("Instructions: "), "Select all field(s) from the dropdown(s) you wish to include, then 
               click the 'Update Selected Fields' button."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected fields to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            h3("CreelCat Survey Fields Descriptions"),
            div(withSpinner(DT::dataTableOutput("FieldMeta_Survey_SB"),type=2)),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

      observeEvent(input$VisFieldChoiceTip_Waterbody,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Waterbody Fields"),
            h4(strong("Description: "), "Fields related to waterbody characteristics."),
            br(),
            h4(strong("Instructions: "), "Select all field(s) from the dropdown(s) you wish to include, then 
               click the 'Update Selected Fields' button."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            br(),
            h4(strong("Recommendation: "), "Limit selected fields to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            br(),
            h3("CreelCat Waterbody Fields Descriptions"),
            div(withSpinner(DT::dataTableOutput("FieldMeta_Waterbody_SB"),type=2)),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

      observeEvent(input$VisFieldChoiceTip_Fish,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Fish Fields"),
            h4(strong("Description: "), "Fields related to the characteristics and outcomes of fish caught by anglers."),
            h4(strong("Instructions: "), "Select all field(s) from the dropdown(s) you wish to include, then 
               click the 'Update Selected Fields' button."),
            h4(strong("Required: "), "Select at least one metric from the 'Select Metrics' picker."),
            h4(strong("Required: "), "Select at least one taxa from any of the taxa pickers."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected fields to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            h3("CreelCat Fish Fields Descriptions"),
            div(withSpinner(DT::dataTableOutput("FieldMeta_Fish_SB"),type=2)),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
      
        observeEvent(input$MetricsTaxaCombinedTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Fish Metrics"),
            h4(strong("Description: "), "Select any metrics you wish to calculate for selected taxa."),
            h4(strong("Instructions: "), "Select all metrics from the dropdown you wish to include"),
            h4(strong("Required: "), "Select at least one metric from the 'Select Metrics' picker."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected metrics to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            h3("CreelCat Fish Fields Descriptions"),
            div(withSpinner(DT::dataTableOutput("FieldMeta_Fish_SB2"),type=2)),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        observeEvent(input$AllTaxaCombinedTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("All Taxa"),
            h4(strong("Description: "), "By toggling this switch to yes, selected metrics are calculated across all taxa (combined) recorded in each survey. This gives a total output for all taxa."),
            h4(strong("Instructions: "), "Toggle 'Yes' to include all taxa combined, 'No' will not include all taxa combined in the results."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected taxa to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        observeEvent(input$SubsVariantsTaxaCombinedTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Subspecies and Variants"),
            h4(strong("Description: "), "Select any subspecies (ie. Rio Grande Cutthroat Trout) or variants (ie. Steelhead Rainbow Trout) you wish to include."),
            h4(strong("Instructions: "), "Select or deselect by clicking taxa within the picker input or by using the 'Select All or 'Deselect All Buttons."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected taxa to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        observeEvent(input$SpeciesTaxaCombinedTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Species"),
            h4(strong("Description: "), "Select any species you wish to include."),
            h4(strong("Instructions: "), "Select or deselect by clicking taxa within the picker input or by using the 'Select All or 'Deselect All Buttons."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected taxa to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        observeEvent(input$GenusTaxaCombinedTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Genus"),
            h4(strong("Description: "), "Select any genera you wish to include."),
            h4(strong("Instructions: "), "Select or deselect by clicking taxa within the picker input or by using the 'Select All or 'Deselect All Buttons."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected taxa to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        observeEvent(input$FamilyTaxaCombinedTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Species"),
            h4(strong("Description: "), "Select any families you wish to include."),
            h4(strong("Instructions: "), "Select or deselect by clicking taxa within the picker input or by using the 'Select All or 'Deselect All Buttons."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected taxa to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        observeEvent(input$GroupTaxaCombinedTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Non-Taxonomic Groups"),
            h4(strong("Description: "), "Select any groups you wish to include."),
            h4(strong("Instructions: "), "Select or deselect by clicking groups within the picker input or by using the 'Select All or 'Deselect All Buttons. All 
               taxa within a group will be summed together when generating the metric values (ie. if 'Trout' is selected all species and subspecies of trout will be
               combined when calculating this metrics."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected taxa to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
    observeEvent(input$TaxaLookupTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Taxonomic Lookup Table"),
            h4(strong("Description: "), "View full taxanomic information for all species within the CreelCat database."),
            h4(strong("Instructions: "), "Table can be filtered or searched to view taxa of interest."),
            h3("CreelCat Taxa"),
            div(withSpinner(DT::dataTableOutput("TaxaLookup"),type=2)),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        
          
        observeEvent(input$GroupLookupTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Non-Taxonomic Group Membership"),
            h4(strong("Description: "), "View which taxa are cinlduded within each group."),
            h4(strong("Instructions: "), "Table can be filtered by group to display which taxa are included."),
            h4(strong("Note "), "Taxa classified as 'Complete' have all members included within the group (ie. all species within the genus Lepomis 
               are included within the 'Panfish' group. Taxa classified as 'Partial' only include some members within 
               the group. (ie. some species within the Centrarchid family such as 'Bluegill' are part of the 'Panfish' group while others such as 'Largemouth Bass' are not."),
            h3("Group Composition"),
            div(withSpinner(DT::dataTableOutput("GroupComposition"),type=2)),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        observeEvent(input$UnreportedTaxaTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unreported Taxa"),
            h4(strong("Description: "), "Determine how you want unreported taxa to be represented within your dataset. When 'NA' is selected all metrics for 
               unreported taxa (taxa not reported in survey results) will be left blank across all metrics, if '0' is selected all unreported taxa will be assigned 
               values of '0' across all metrics."),
            h4(strong("Instructions: "), "Select 'NA' or '0' from input to determine how you wish for unrepresented taxa to be represented."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        

      observeEvent(input$VisFieldChoiceTip_Effort,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Effort Fields"),
            h4(strong("Description: "), "Fields related to angling effort."),
            h4(strong("Instructions: "), "Select all field(s) from the dropdown(s) you wish to include, then 
               click the 'Update Selected Fields' button."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected fields to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            h3("CreelCat Angler Effort Fields Descriptions"),
            div(withSpinner(DT::dataTableOutput("FieldMeta_Effort_SB"),type=2)),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

      observeEvent(input$VisFieldChoiceTip_Preference,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Angler Preference Fields"),
            h4(strong("Description: "), "Fields related to the amount of effort or preference anglers allocate to different taxa."),
            h4(strong("Instructions: "), "Select all field(s) from the dropdown(s) you wish to include, then 
               click the 'Update Selected Fields' button."),
            h4(strong("Required: "), "Select at least one metric from the 'Select Metrics' picker."),
            h4(strong("Required: "), "Select at least one taxa from any of the taxa pickers."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected fields to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            h3("CreelCat Angler Preference Fields Descriptions"),
            div(withSpinner(DT::dataTableOutput("FieldMeta_Preference_SB"),type=2)),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
      
        observeEvent(input$AngPref_MetricsTaxaCombinedTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Angler Preference Metrics"),
            h4(strong("Description: "), "Select any metrics you wish to calculate for selected taxa."),
            h4(strong("Instructions: "), "Select all metrics from the dropdown you wish to include"),
            h4(strong("Required: "), "Select at least one metric from the 'Select Metrics' picker."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected metrics to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            h3("CreelCat Angler Preference Fields Descriptions"),
            div(withSpinner(DT::dataTableOutput("FieldMeta_Preference_SB2"),type=2)),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        observeEvent(input$AngPref_AllTaxaCombinedTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("All Taxa"),
            h4(strong("Description: "), "By toggling this switch to yes, selected metrics are calculated across all taxa (combined) recorded in each survey. This gives a total output for all taxa."),
            h4(strong("Instructions: "), "Toggle 'Yes' to include all taxa combined, 'No' will not include all taxa combined in the results."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected taxa to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        observeEvent(input$AngPref_SubsVariantsTaxaCombinedTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Subspecies and Variants"),
            h4(strong("Description: "), "Select any subspecies (ie. Rio Grande Cutthroat Trout) or variants (ie. Steelhead Rainbow Trout) you wish to include."),
            h4(strong("Instructions: "), "Select or deselect by clicking taxa within the picker input or by using the 'Select All or 'Deselect All Buttons."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected taxa to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        observeEvent(input$AngPref_SpeciesTaxaCombinedTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Species"),
            h4(strong("Description: "), "Select any species you wish to include."),
            h4(strong("Instructions: "), "Select or deselect by clicking taxa within the picker input or by using the 'Select All or 'Deselect All Buttons."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected taxa to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        observeEvent(input$AngPref_GenusTaxaCombinedTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Genus"),
            h4(strong("Description: "), "Select any genera you wish to include."),
            h4(strong("Instructions: "), "Select or deselect by clicking taxa within the picker input or by using the 'Select All or 'Deselect All Buttons."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected taxa to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        observeEvent(input$AngPref_FamilyTaxaCombinedTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Species"),
            h4(strong("Description: "), "Select any families you wish to include."),
            h4(strong("Instructions: "), "Select or deselect by clicking taxa within the picker input or by using the 'Select All or 'Deselect All Buttons."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected taxa to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        observeEvent(input$AngPref_GroupTaxaCombinedTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Non-Taxonomic Groups"),
            h4(strong("Description: "), "Select any groups you wish to include."),
            h4(strong("Instructions: "), "Select or deselect by clicking groups within the picker input or by using the 'Select All or 'Deselect All Buttons. All 
               taxa within a group will be summed together when generating the metric values (ie. if 'Trout' is selected all species and subspecies of trout will be
               combined when calculating this metrics."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected taxa to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        
        observeEvent(input$UnreportedTargetTaxaTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unreported Taxa"),
            h4(strong("Description: "), "Determine how you want unreported taxa to be represented within your dataset. When 'NA' is selected all metrics for 
               unreported taxa (taxa not reported in survey results) will be left blank across all metrics, if '0' is selected all unreported taxa will be assigned 
               values of '0' across all metrics."),
            h4(strong("Instructions: "), "Select 'NA' or '0' from input to determine how you wish for unrepresented taxa to be represented."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
        

      observeEvent(input$VisFieldChoiceTip_Demographic,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Demographic Fields"),
            h4(strong("Description: "), "Fields related to angler demographic characteristics."),
            h4(strong("Instructions: "), "Select all field(s) from the dropdown(s) you wish to include, then 
               click the 'Update Selected Fields' button."),
            h4(strong("Note "), "New selections can be made at any time but afterwards the update button 
               must be pressed again. Doing so will update the fields but will also reset any dependent operations."),
            h4(strong("Recommendation: "), "Limit selected fields to only those you wish to view/use, additional fields will increase 
               processing time and make the interface more vulnerable to crashing."),
            h3("CreelCat Demographic Fields Descriptions"),
            div(withSpinner(DT::dataTableOutput("FieldMeta_Demographic_SB"),type=2)),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
      
      observeEvent(input$SelDataChoice_Tip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Select Surveys for Use in Interface"),
            h4(strong("Users must select which surveys they wish to include while utilizing the CreelCat interface")),
            h4(strong("Recommendation: "), "Limit selected surveys to only those you wish to view/use via filtering or spatial selection. 
            Additional surveys will increase processing time and make the interface more vulnerable to crashing."),
           easyClose = TRUE
        ))
    },ignoreInit=TRUE)
      
      observeEvent(input$VisSelectSurveysTip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Select Surveys for Use in Interface"),
            h4(strong("Instructions: "), "Select which surveys you wish to include while using CreelCat"),
            h4(strong("All "), "includes all surveys contained within the CreelCat database"),
            h4(strong("Filters "), "reduces the included surveys to only those met by user specified conditions"),
            h4(strong("Map "), "reduces the surveys to only those included within a spatial selection made by the user via the map selection tool."),
            h4(strong("Recommendation: "), "Reducing the number of included surveys via filtering/map selection will allow the interface to run more quickly,
            and reduce instances of crashing. We recommend filtering the dataset to only surveys you wish to view/use."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
      
      observeEvent(input$VisSelectSurveysTip_Filter,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Select filters you wish to apply to subset the dataset"),
            h4(strong("Instructions: "), "Select any filters you wish to include from the ",strong("Select Filters "), "picker."),
            h4(strong("Recommendation: "), "Reducing the number of included surveys via filtering will allow the interface to run more quickly,
            and reduce instances of crashing. We recommend filtering the dataset to only surveys you wish to view/use."),
           easyClose = TRUE
        ))
    },ignoreInit=TRUE)
      
      observeEvent(input$VisSelectSurveysTip_FilterSet,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Select filters you wish to apply to subset the dataset"),
            h4(strong("Instructions: "), "Populate any of the filters you have selected either from pickers for factor variables or sliders for numeric variables which are displayed below. Modifications 
               to filters can be made at any time, however by resetting filters all dependent operations will be reset."),
            h4(strong("Warning: "), "All selected filters must have at least one option selected, if you no longer wish to use a given filter remove it by deselecting it 
               from the ", strong("Select Filters "), "picker above."),
            h4(strong("Recommendation: "), "Select only those surveys you wish to view/use, additional surveys will increase 
               processing time and make the interface more vulnerable to crashing."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
      
      observeEvent(input$VisSelectSurveysTip_Map,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Select which surveys you wish to include by selecting a desired area from which to import surveys."),
            h4(strong("Instructions: "), "Select method for performing spatial selection."),
            h4(strong("Polygon: "), "Click on map to draw outline of polygon, all surveys within drawn boundaries will then be selected for inclusion."),
            h4(strong("State: "), "Click on map to select states to include, all surveys within spatial boundaries of those states will be selected for inclusion."),
            h4(strong("County: "), "Click on map to select counties to include, all surveys within spatial boundaries of those counties will be selected for inclusion."),
            h4(strong("Recommendation: "), "Reducing the number of included surveys via map selection will allow the interface to run more quickly,
            and reduce instances of crashing. We recommend reducing the dataset to only surveys you wish to view/use."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
      
  observeEvent(input$VisSelectSurveysTip_PolyControl,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Controls for selecting surveys via polygon."),
            h4(strong("Step 1: "), "Confirm that 'Draw' is selected from the bar above map."),
            h4(strong("Step 2: "), "Click on map to draw the desired polygon."),
            h4(strong("Step 3: "), "Once the boundaries of the desired polygon are complete, select 'Complete' from the bar above to finalize selection."),
            h4(strong("Optional: "), "Select the 'Clear' from the bar above if you wish to clear the current polygon in order to draw a new one."),
            h4(strong("Warning: "), "Modifying the selected surveys will reset all dependent operations including selected fields, tables, summarizations, and visualizations."),
            h4(strong("Warning: "), "Survey selection near polygon edges will sometimes be included or excluded erroneously, double check near boundaries to be sure expectations are met."),
            h4(strong("Recommendation: "), "Reducing the number of included surveys via map selection will allow the interface to run more quickly,
            and reduce instances of crashing. We recommend reducing the dataset to only surveys you wish to view/use."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$VisSelectSurveysTip_StateControl,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Controls for selecting surveys via state boundaries."),
            h4(strong("Step 1: "), "Confirm that 'Select' is selected from the bar above map."),
            h4(strong("Step 2: "), "Click on map within borders of desired states to identify desired selection area."),
            h4(strong("Step 3: "), "Once all desired states have been selected, select 'Complete' from the bar above to finalize selection."),
            h4(strong("Optional: "), "Select the 'Clear' from the bar above if you wish to clear the current selection in order to make a new one."),
            h4(strong("Warning: "), "Modifying the selected surveys will reset all dependent operations including selected fields, tables, summarizations, and visualizations."),
            br(),
            h4(strong("Warning: "), "Surveys near state borders will sometimes be included or excluded erroneously, double check near boundaries to be sure expectations are met. 
               Alternatively you can use the filter input to filter based on state."),
            h4(strong("Recommendation: "), "Reducing the number of included surveys via map selection will allow the interface to run more quickly,
            and reduce instances of crashing. We recommend reducing the dataset to only surveys you wish to view/use."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$VisSelectSurveysTip_CountyControl,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Controls for selecting surveys via county boundaries."),
            h4(strong("Step 1: "), "Confirm that 'Select' is selected from the bar above map."),
            h4(strong("Step 2: "), "Click on map within borders of desired counties to identify desired selection area."),
            h4(strong("Step 3: "), "Once all desired counties have been selected, select 'Complete' from the bar above to finalize selection."),
            h4(strong("Optional: "), "Select the 'Clear' from the bar above if you wish to clear the current selection in order to make a new one."),
            h4(strong("Warning: "), "Modifying the selected surveys will reset all dependent operations including selected fields, tables, summarizations, and visualizations."),
            h4(strong("Warning: "), "Surveys near county borders will sometimes be included or excluded erroneously, double check near boundaries to be sure expectations are met. 
               Alternatively you can use the filter input to filter based on county."),
            h4(strong("Recommendation: "), "Reducing the number of included surveys via map selection will allow the interface to run more quickly,
            and reduce instances of crashing. We recommend reducing the dataset to only surveys you wish to view/use."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$CustomTable_Tip ,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Interacting with Custom Table"),
            h4(strong("Search: "), "Return any rows which contain matches for the enterred search term."),
            h4(strong("Filter Boxes: "), "Return any rows matching the criteria from the filters."),
            h4(strong("Click Selection: "), "Use 'Ctrl' or 'Shift' + click to select multiple rows."),
            h4(strong("Button Selection: "), "'Select/Deselect All Filtered' will select or deselect all rows displayed in the filtered table. 'Select/Deselect All' will select or deselect all rows regardless of filter status."),
            h4(strong("Custom Table Export: "), "Selected table contents can be exported via the 'Copy','CSV','Excel','PDF', and 'Print' buttons above the table."),
            h4(strong("Full Dataset Export: "), "The full CreelCat dataset can be saved via the 'Download full Dataset as CSV files' or 'Open Full Dataset in Google Sheets to Copy or Download' buttons on the sidebar."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$DataAvailInquiryType_Tip ,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Data Availability Inquiry"),
            h4(strong("Inquiry Type: "), "From picker select which type of inquiry you wish to perform."),
            h5(strong("Survey Count: "), "View the number of surveys contained within the CreelCat database (overall or based on selected data)."),
            h5(strong("Available Fields: "), "View the number of surveys containing fields by field."),
            h5(strong("Survey Characteristics: "), "View the number of surveys and selected survey characteristics for surveys within the CreelCat database."),
            h5(strong("Species: "), "View the number of surveys containing records by taxa."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$DataAvailMapTable_Tip ,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Display Method"),
            h4(strong("Map: "), "Displays survey count by state on a map."),
            h4(strong("Table: "), "Displays survey count by table (either overall or by state)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$DataAvailMapTable_Tip ,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Display Method"),
            h4(strong("Map: "), "Displays survey count by state on a map."),
            h4(strong("Table: "), "Displays survey count by table (either overall or by state)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$DataAvail_StateSumm_Tip ,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Summarize by State"),
            h4(strong("Yes: "), "Details survey counts by state."),
            h4(strong("No: "), "Details survey counts for all selected surveys combined."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
 
  
  observeEvent(input$DataAvailInquirySelFields_Tip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Select Field"),
            h4(strong("Choose Field: "), "Select which field you wish to view the number of surveys it is populated for within each state."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$DataAvailSurveyChar_Tip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Survey Characteristics"),
            h4(strong("Select Characteristics "), "Select which (if any) survey characteristis you wish to group summarizations on."),
            h5(strong("Survey Type: "), "Groups statistics by survey type (Creel, Mail, etc)."),
            h5(strong("Survey Protocol: "), "Groups statistics based on protocol classification (Roving, Access, etc.)."),
            h5(strong("Waterbody Type: "), "Groups statistics based on waterbody class (Lentic, Lotic, etc.)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$DataAvail_TaxaClass_Tip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Taxa Class Selection"),
            h4(strong("Select taxa class "), "to view taxa choices for display."),
            h5(strong("Subspecies and variants: "), "Pick from a list containing subspecies and variants (ie. Yellowstone Cutthroat Trout or Blacknose Crappie)."),
            h5(strong("Species: "), "Pick from a list containing species."),
            h5(strong("Genus: "), "Pick from a list containing genuses."),
            h5(strong("Family: "), "Pick from a list containing families."),
            h5(strong("Group: "), "Pick from a list containing non-taxonomic groups (ie. Panfish)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$DataSum_Calculations_Tip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Select Summarization Metrics"),
            h4(strong("Select metrics "), "you wish to calculate as part of your summarization."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$DataSum_GroupByFields_Tip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Group By Fields"),
            h4(strong("Select fields "), "you wish to use to group by for summary calculations."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$DataSum_SummFields_Tip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Summarization Fields"),
            h4(strong("Select fields "), "you wish to calculate summary calculations on."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$AF_VisNum_Selection_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Number of Visualizations"),
            h4(strong("Select "), "the number of visualizations you wish view and interact with simultaneously."),
            h5(strong("Shared data "), "requires at least 2 visualizations."),
            h5(strong("Linked Selection "), "requires shared data and at least 2 visualizations."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(c(
    input$AF_SharedData_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Shared Data"),
            h4(strong("Yes "), "Input data is selected independently for each visualization."),
            h4(strong("No: "), "Input data is selected from a single table and shared amongst all visualizations."),
            h4(strong("Note: "), "Surveys containing ", strong("null "), "values for input fields are dropped. When shared data is used ",strong("null "), "values from any fields across all visualizations are dropped from all visualizations."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$AF_LinkedSelection_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Linked Selection"),
            h4(strong("Yes"), "Selections made in visualization are used to highlight (Maps and Scatter Plots) or subset (Line, Bar and Pie Charts) in the other plots."),
            h4(strong("No"), "Selections made in visualization do not interact with any other visualizations."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$ClearSel_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Clear Selection"),
            h4(strong("Clears the selected surveys from all visualizations and redraws them with no selection.")),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$DarkMode_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Color Scheme"),
            h4(strong("Light: "), "Visualization backgrounds are light and text is dark."),
            h4(strong("Dark: "), "Visualization backgrounds are dark and text is light."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  
  
  observeEvent(c(
    input$SelectVis1_Tip,
    input$SelectVis2_Tip,
    input$SelectVis3_Tip,
    input$SelectVis4_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Visualization Type"),
            h4(strong("Select Visualization Type")),
            h4(strong("Map: "), "Display and interact with CreelCat data on a map."),
            h4(strong("Line Chart: "), "Plot data over time for selected waterbodies on a line chart."),
            h4(strong("Scatter Plot"), "Select two CreelCat fields to serve as x and y values in a scatter plot."),
            h4(strong("Bar Chart"), "Plot up to five CreelCat fields in a bar chart."),
            h4(strong("Pie Chart"), "Plot the either the percentage of each selected metric for selected surveys or the sum of selected metrics by survey as a percentage."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_Map_CreelDisplayType_Tip,
    input$Vis2_Map_CreelDisplayType_Tip,
    input$Vis3_Map_CreelDisplayType_Tip,
    input$Vis4_Map_CreelDisplayType_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Creel Display Type"),
            h4(strong("Select how you wish to display CreelCat Data on the map")),
            h4(strong("Scaled Color"), "Marker colors are based on a gradient attributed to a selected field."),
            h4(strong("Scaled Color"), "Marker sizes are based on a scale attributed to a selected field."),
            h4(strong("Both"), "Marker colors and sizes are based on selected fields."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_MapDisplayField_Tip,
    input$Vis2_MapDisplayField_Tip,
    input$Vis3_MapDisplayField_Tip,
    input$Vis4_MapDisplayField_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Map Size Field"),
            h4(strong("Select "), "the field you wish to base marker color upon."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_MapColorPalette_Tip,
    input$Vis2_MapColorPalette_Tip,
    input$Vis3_MapColorPalette_Tip,
    input$Vis4_MapColorPalette_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Palette"),
            h4(strong("Select "), "the color palette you wish to base marker color upon."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_Map_PalToggle_Tip,
    input$Vis2_Map_PalToggle_Tip,
    input$Vis3_Map_PalToggle_Tip,
    input$Vis4_Map_PalToggle_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Palette Direction"),
            h4(strong("Toggle "), "the switch to reverse the order of colors within the palette relative to the data values."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_Map_CreelColorscalePer_Tip,
    input$Vis2_Map_CreelColorscalePer_Tip,
    input$Vis3_Map_CreelColorscalePer_Tip,
    input$Vis4_Map_CreelColorscalePer_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Color Attribution"),
            h4(strong("Select how to attribute marker colors")),
            h4(strong("Values: "), "Marker color is assigned based on the value relative to the total range of values."),
            h4(strong("Percentile: "), "Marker color is assigned based on the value percentile."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_MapColorSolid_Tip,
    input$Vis2_MapColorSolid_Tip,
    input$Vis3_MapColorSolid_Tip,
    input$Vis4_MapColorSolid_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Select Color"),
            h4("Select the color of markers displayed on the map."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_MapDisplayField_Size_Tip,
    input$Vis2_MapDisplayField_Size_Tip,
    input$Vis3_MapDisplayField_Size_Tip,
    input$Vis4_MapDisplayField_Size_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Marker Size Field"),
            h4(strong("Select "), "the field you which to base marker size upon for the map."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_MapDisplayField_SizeSlider_Tip,
    input$Vis2_MapDisplayField_SizeSlider_Tip,
    input$Vis3_MapDisplayField_SizeSlider_Tip,
    input$Vis4_MapDisplayField_SizeSlider_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Marker Size Range Slider"),
            h4(strong("Select the range of marker sizes for the map.")),
            h4(strong("Minimum: "), "drag the left-most button to the minimum marker size."),
            h4(strong("Maximum: "), "drag the right-most button to the maximum marker size."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_Map_CreelSizescalePer_Tip,
    input$Vis2_Map_CreelSizescalePer_Tip,
    input$Vis3_Map_CreelSizescalePer_Tip,
    input$Vis4_Map_CreelSizescalePer_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Marker Size Scale"),
            h4(strong("Value: "), "Scales marker size based on value of selected field for a given survey."),
            h4(strong("Percentile: "), "Scales marker size based on the percentile of the value of selected field for a given survey."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_MapDisplayField_SizeSliderSingle_Tip,
    input$Vis2_MapDisplayField_SizeSliderSingle_Tip,
    input$Vis3_MapDisplayField_SizeSliderSingle_Tip,
    input$Vis4_MapDisplayField_SizeSliderSingle_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Marker Size Field"),
            h4(strong("Slider: "), "Adjust the size of markers on map by moving the slider."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_SelectType_Tip,
    input$Vis2_SelectType_Tip,
    input$Vis3_SelectType_Tip,
    input$Vis4_SelectType_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Map Selection Method."),
            h4(strong("Polygon: "), "Click on map to draw outline of polygon, all surveys within drawn boundaries will then be selected for inclusion."),
            h4(strong("State: "), "Click on map to select states to include, all surveys within spatial boundaries of those states will be selected for inclusion."),
            h4(strong("County: "), "Click on map to select counties to include, all surveys within spatial boundaries of those counties will be selected for inclusion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_SelectPolygon_Tip,
    input$Vis2_SelectPolygon_Tip,
    input$Vis3_SelectPolygon_Tip,
    input$Vis4_SelectPolygon_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Selecting surveys via polygon."),
            h4(strong("Step 1: "), "Confirm that 'Draw' is selected from the bar above map."),
            h4(strong("Step 2: "), "Click on map to draw the desired polygon."),
            h4(strong("Step 3: "), "Once the boundaries of the desired polygon are complete, select 'Complete' from the bar above to finalize selection."),
            h4(strong("Optional: "), "Select the 'Clear' from the bar above if you wish to clear the current polygon in order to draw a new one."),
            h4(strong("Warning: "), "Survey selection near polygon edges will sometimes be included or excluded erroneously, double check near boundaries to be sure expectations are met."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_SelectState_Tip,
    input$Vis2_SelectState_Tip,
    input$Vis3_SelectState_Tip,
    input$Vis4_SelectState_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Selecting surveys via state boundaries."),
            h4(strong("Step 1: "), "Confirm that 'Select' is selected from the bar above map."),
            h4(strong("Step 2: "), "Click on map within borders of desired states to identify desired selection area."),
            h4(strong("Step 3: "), "Once all desired states have been selected, select 'Complete' from the bar above to finalize selection."),
            h4(strong("Optional: "), "Select the 'Clear' from the bar above if you wish to clear the current selection in order to make a new one."),
            h4(strong("Warning: "), "Surveys near state borders will sometimes be included or excluded erroneously, double check near boundaries to be sure expectations are met."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_SelectCounty_Tip,
    input$Vis2_SelectCounty_Tip,
    input$Vis3_SelectCounty_Tip,
    input$Vis4_SelectCounty_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Selecting surveys via county boundaries."),
            h4(strong("Step 1: "), "Confirm that 'Select' is selected from the bar above map."),
            h4(strong("Step 2: "), "Click on map within borders of desired counties to identify desired selection area."),
            h4(strong("Step 3: "), "Once all desired counties have been selected, select 'Complete' from the bar above to finalize selection."),
            h4(strong("Optional: "), "Select the 'Clear' from the bar above if you wish to clear the current selection in order to make a new one."),
            h4(strong("Warning: "), "Surveys near county borders will sometimes be included or excluded erroneously, double check near boundaries to be sure expectations are met."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_FillOpacity_Tip,
    input$Vis2_FillOpacity_Tip,
    input$Vis3_FillOpacity_Tip,
    input$Vis4_FillOpacity_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Unselected Marker Opacity"),
            h4("Adjust opacity of unselected markers by dragging the slider, where lower values results in higher marker transparency."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_AddLegend_Switch_Tip,
    input$Vis2_AddLegend_Switch_Tip,
    input$Vis3_AddLegend_Switch_Tip,
    input$Vis4_AddLegend_Switch_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Legend Visibility"),
            h4(strong("Yes: "), "Display legend on map"),
            h4(strong("No: "), "Hide legend on map"),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Map_Vis1_Title_Switch_Tip,
    input$Map_Vis2_Title_Switch_Tip,
    input$Map_Vis3_Title_Switch_Tip,
    input$Map_Vis4_Title_Switch_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Label Toggler"),
            h4(strong("Yes: "), "Display custom text on map"),
            h4(strong("No: "), "Hide custom text on map"),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Map_Vis1_Title_Text_Tip,
    input$Map_Vis2_Title_Text_Tip,
    input$Map_Vis3_Title_Text_Tip,
    input$Map_Vis4_Title_Text_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Label Input"),
            h4("User may enter text in the box below to display on map."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_ZoomTo_Switch_Tip,
    input$Vis2_ZoomTo_Switch_Tip,
    input$Vis3_ZoomTo_Switch_Tip,
    input$Vis4_ZoomTo_Switch_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Select Zoom Type"),
            h4(strong("Creel Data Extent: "), "Resets the zoom on the map to capture the full extent of data markers."),
            h4(strong("Selected Geography: "), "Allows user to zoom the map to a specified geographical extent (State or County)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_ZoomToState_Tip,
    input$Vis2_ZoomToState_Tip,
    input$Vis3_ZoomToState_Tip,
    input$Vis4_ZoomToState_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Zoom to State"),
            h4(strong("Select desired state")),
            h4("If 'County Zoom' is not set to 'Statewide' be sure to do so."),
            h4("Press 'Zoom to Selected Geography' button located below."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(c(
    input$Vis1_ZoomToCounty_Tip,
    input$Vis2_ZoomToCounty_Tip,
    input$Vis3_ZoomToCounty_Tip,
    input$Vis4_ZoomToCounty_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Zoom to County"),
            h4(strong("Select desired county")),
            h4("Press 'Zoom to Selected Geography' button located below."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  
  observeEvent(c(
    input$Vis1_ScatterX_Tip,
    input$Vis2_ScatterX_Tip,
    input$Vis3_ScatterX_Tip,
    input$Vis4_ScatterX_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Scatter X"),
            h4(strong("Select "), "field to serve as x-axis values"),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_ScatterY_Tip,
    input$Vis2_ScatterY_Tip,
    input$Vis3_ScatterY_Tip,
    input$Vis4_ScatterY_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Scatter Y"),
            h4(strong("Select "), "field to serve as y-axis values"),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Scatter_ColorGroupSwitch_Tip,
    input$Vis2_Scatter_ColorGroupSwitch_Tip,
    input$Vis3_Scatter_ColorGroupSwitch_Tip,
    input$Vis4_Scatter_ColorGroupSwitch_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Marker Color Mode"),
            h4(strong("Uniform: "), "Markers will all have same color, which user may select."),
            h4(strong("Numeric: "), "Markers will all be colored based on numeric values from a user-selected field, color palette may be modified by user."),
            h4(strong("Uniform: "), "Markers will all be colored based on factor values from a user-selected field, color palette may be modified by user."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Scatter_Color_Tip,
    input$Vis2_Scatter_Color_Tip,
    input$Vis3_Scatter_Color_Tip,
    input$Vis4_Scatter_Color_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Marker Color"),
            h4(strong("Select "), "color desired for scatter plot markers"),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Scatter_MarkerColor_Numeric_Tip,
    input$Vis2_Scatter_MarkerColor_Numeric_Tip,
    input$Vis3_Scatter_MarkerColor_Numeric_Tip,
    input$Vis4_Scatter_MarkerColor_Numeric_Tip,
    input$Vis1_Scatter_MarkerColor_Factors_Tip,
    input$Vis2_Scatter_MarkerColor_Factors_Tip,
    input$Vis3_Scatter_MarkerColor_Factors_Tip,
    input$Vis4_Scatter_MarkerColor_Factors_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Color Field"),
            h4(strong("Select field "), "to base scatter plot marker colors upon."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Scatter_ColorPal_Numeric_Tip,
    input$Vis2_Scatter_ColorPal_Numeric_Tip,
    input$Vis3_Scatter_ColorPal_Numeric_Tip,
    input$Vis4_Scatter_ColorPal_Numeric_Tip,
    input$Vis1_Scatter_ColorPal_Factors_Tip,
    input$Vis2_Scatter_ColorPal_Factors_Tip,
    input$Vis3_Scatter_ColorPal_Factors_Tip,
    input$Vis4_Scatter_ColorPal_Factors_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Palette"),
            h4(strong("Select "), "a color palette to apply to scatter plot markers"),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis_1_ScatterOpacity_Tip,
    input$Vis_2_ScatterOpacity_Tip,
    input$Vis_3_ScatterOpacity_Tip,
    input$Vis_4_ScatterOpacity_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Unselected Marker Opacity"),
            h4(strong("Adjust slider "), "to change the opacity of unselected markers where 0 is fully transparent and 1 is completely opaque."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Scatter_MarkerSizeSwitch_Tip,
    input$Vis2_Scatter_MarkerSizeSwitch_Tip,
    input$Vis3_Scatter_MarkerSizeSwitch_Tip,
    input$Vis4_Scatter_MarkerSizeSwitch_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Marker Size Mode"),
            h4(strong("Uniform: "), "All markers have same size, which may be adjusted by user via slider."),
            h4(strong("Scaled: "), "Marker size is based on a user-selected field, with minimum and maximum size values which may be adjusted by user via a slider."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Scatter_MarkerSize_Tip,
    input$Vis2_Scatter_MarkerSize_Tip,
    input$Vis3_Scatter_MarkerSize_Tip,
    input$Vis4_Scatter_MarkerSize_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Marker Size"),
            h4(strong("Move "), "button on slider to adjust scatter plot marker size."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Scatter_MarkerScaleSize_Tip,
    input$Vis2_Scatter_MarkerScaleSize_Tip,
    input$Vis3_Scatter_MarkerScaleSize_Tip,
    input$Vis4_Scatter_MarkerScaleSize_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Marker Size Field"),
            h4(strong("Select field "), "upon which to base the size of scatter plot markers."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Scatter_MarkerSizeSlider_Tip,
    input$Vis2_Scatter_MarkerSizeSlider_Tip,
    input$Vis3_Scatter_MarkerSizeSlider_Tip,
    input$Vis4_Scatter_MarkerSizeSlider_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Marker Size Slider"),
            h4(strong("Move "), "buttons on slider to adjust minimum and maximum scatter plot marker sizes."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Scatter_TrendlineSwitch_Tip,
    input$Vis2_Scatter_TrendlineSwitch_Tip,
    input$Vis3_Scatter_TrendlineSwitch_Tip,
    input$Vis4_Scatter_TrendlineSwitch_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Trendline"),
            h4(strong("Yes: "), "Add trendline to scatterplot."),
            h4(strong("No: "), "Remove trendline from scatterplot."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Scatter_TrendlineColor_Tip,
    input$Vis2_Scatter_TrendlineColor_Tip,
    input$Vis3_Scatter_TrendlineColor_Tip,
    input$Vis4_Scatter_TrendlineColor_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Trendline Color"),
            h4(strong("Select "), "color of trendline on scatter plot."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Scatter_TrendlineWidth_Tip,
    input$Vis2_Scatter_TrendlineWidth_Tip,
    input$Vis3_Scatter_TrendlineWidth_Tip,
    input$Vis4_Scatter_TrendlineWidth_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Trendline Width"),
            h4(strong("Move "), "slider button to adjust the width of the scatter plot trendline."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Scatter_HideLegend_Tip,
    input$Vis2_Scatter_HideLegend_Tip,
    input$Vis3_Scatter_HideLegend_Tip,
    input$Vis4_Scatter_HideLegend_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Legend and Text Visibility"),
            h4(strong("Toggle "), "switch to show or hide legend, annotations, and certain other text items"),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_ScatterTitle_Tip,
    input$Vis2_ScatterTitle_Tip,
    input$Vis3_ScatterTitle_Tip,
    input$Vis4_ScatterTitle_Tip,
    input$Vis1_BarTitle_Tip,
    input$Vis2_BarTitle_Tip,
    input$Vis3_BarTitle_Tip,
    input$Vis4_BarTitle_Tip,
    input$Vis1_PieTitle_Tip,
    input$Vis2_PieTitle_Tip,
    input$Vis3_PieTitle_Tip,
    input$Vis4_PieTitle_Tip,
    input$Vis1_LineTitle_Tip,
    input$Vis2_LineTitle_Tip,
    input$Vis3_LineTitle_Tip,
    input$Vis4_LineTitle_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Title"),
            h4(strong("Enter "), "text to create a custom title for your visualization."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_ScatterXlab_Tip,
    input$Vis2_ScatterXlab_Tip,
    input$Vis3_ScatterXlab_Tip,
    input$Vis4_ScatterXlab_Tip,
    input$Vis1_BarXlab_Tip,
    input$Vis2_BarXlab_Tip,
    input$Vis3_BarXlab_Tip,
    input$Vis4_BarXlab_Tip,
    input$Vis1_LineXlab_Tip,
    input$Vis2_LineXlab_Tip,
    input$Vis3_LineXlab_Tip,
    input$Vis4_LineXlab_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("X-Axis Label"),
            h4(strong("Enter "), "text to create a custom label for the x-axis of your visualization."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_ScatterYlab_Tip,
    input$Vis2_ScatterYlab_Tip,
    input$Vis3_ScatterYlab_Tip,
    input$Vis4_ScatterYlab_Tip,
    input$Vis1_BarYlab_Tip,
    input$Vis2_BarYlab_Tip,
    input$Vis3_BarYlab_Tip,
    input$Vis4_BarYlab_Tip,
    input$Vis1_LineYlab_Tip,
    input$Vis2_LineYlab_Tip,
    input$Vis3_LineYlab_Tip,
    input$Vis4_LineYlab_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Y-Axis Label"),
            h4(strong("Enter "), "text to create a custom label for the y-axis of your visualization."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Bar_Number_Tip,
    input$Vis2_Bar_Number_Tip,
    input$Vis3_Bar_Number_Tip,
    input$Vis4_Bar_Number_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Number of Bar Inputs"),
            h4(strong("Select "), "the number of fields you wish to include as variables within the chart. Bars will be grouped by survey."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_BarY1_Tip,
    input$Vis1_BarY2_Tip,
    input$Vis1_BarY3_Tip,
    input$Vis1_BarY4_Tip,
    input$Vis1_BarY5_Tip,
    input$Vis2_BarY1_Tip,
    input$Vis2_BarY2_Tip,
    input$Vis2_BarY3_Tip,
    input$Vis2_BarY4_Tip,
    input$Vis2_BarY5_Tip,
    input$Vis3_BarY1_Tip,
    input$Vis3_BarY2_Tip,
    input$Vis3_BarY3_Tip,
    input$Vis3_BarY4_Tip,
    input$Vis3_BarY5_Tip,
    input$Vis4_BarY1_Tip,
    input$Vis4_BarY2_Tip,
    input$Vis4_BarY3_Tip,
    input$Vis4_BarY4_Tip,
    input$Vis4_BarY5_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Bar Chart Variables"),
            h4(strong("Select field"), "you wish to include as a variable in your bar chart."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_BarY1_Color_Tip,
    input$Vis1_BarY2_Color_Tip,
    input$Vis1_BarY3_Color_Tip,
    input$Vis1_BarY4_Color_Tip,
    input$Vis1_BarY5_Color_Tip,
    input$Vis2_BarY1_Color_Tip,
    input$Vis2_BarY2_Color_Tip,
    input$Vis2_BarY3_Color_Tip,
    input$Vis2_BarY4_Color_Tip,
    input$Vis2_BarY5_Color_Tip,
    input$Vis3_BarY1_Color_Tip,
    input$Vis3_BarY2_Color_Tip,
    input$Vis3_BarY3_Color_Tip,
    input$Vis3_BarY4_Color_Tip,
    input$Vis3_BarY5_Color_Tip,
    input$Vis4_BarY1_Color_Tip,
    input$Vis4_BarY2_Color_Tip,
    input$Vis4_BarY3_Color_Tip,
    input$Vis4_BarY4_Color_Tip,
    input$Vis4_BarY5_Color_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Bar Colors"),
            h4(strong("Select color"), "you wish to apply to bars associated with the respective variable in your bar chart."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_LineY1_Tip,
    input$Vis1_LineY2_Tip,
    input$Vis1_LineY3_Tip,
    input$Vis1_LineY4_Tip,
    input$Vis1_LineY5_Tip,
    input$Vis2_LineY1_Tip,
    input$Vis2_LineY2_Tip,
    input$Vis2_LineY3_Tip,
    input$Vis2_LineY4_Tip,
    input$Vis2_LineY5_Tip,
    input$Vis3_LineY1_Tip,
    input$Vis3_LineY2_Tip,
    input$Vis3_LineY3_Tip,
    input$Vis3_LineY4_Tip,
    input$Vis3_LineY5_Tip,
    input$Vis4_LineY1_Tip,
    input$Vis4_LineY2_Tip,
    input$Vis4_LineY3_Tip,
    input$Vis4_LineY4_Tip,
    input$Vis4_LineY5_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Line Chart Variables"),
            h4(strong("Select field"), "you wish to include as a variable in your line chart."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Linedash1_Tip,
    input$Vis1_Linedash2_Tip,
    input$Vis1_Linedash3_Tip,
    input$Vis1_Linedash4_Tip,
    input$Vis1_Linedash5_Tip,
    input$Vis2_Linedash1_Tip,
    input$Vis2_Linedash2_Tip,
    input$Vis2_Linedash3_Tip,
    input$Vis2_Linedash4_Tip,
    input$Vis2_Linedash5_Tip,
    input$Vis3_Linedash1_Tip,
    input$Vis3_Linedash2_Tip,
    input$Vis3_Linedash3_Tip,
    input$Vis3_Linedash4_Tip,
    input$Vis3_Linedash5_Tip,
    input$Vis4_Linedash1_Tip,
    input$Vis4_Linedash2_Tip,
    input$Vis4_Linedash3_Tip,
    input$Vis4_Linedash4_Tip,
    input$Vis4_Linedash5_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Line Dash Style"),
            h4(strong("Select type "), "of dash you wish to use for for the respective variable in your line chart."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  

  
  
  observeEvent(c(
    input$Vis1_Bar_HideLegend_Tip,
    input$Vis2_Bar_HideLegend_Tip,
    input$Vis3_Bar_HideLegend_Tip,
    input$Vis4_Bar_HideLegend_Tip,
    input$Vis1_Pie_HideLegend_Tip,
    input$Vis2_Pie_HideLegend_Tip,
    input$Vis3_Pie_HideLegend_Tip,
    input$Vis4_Pie_HideLegend_Tip,
    input$Vis1_Line_HideLegend_Tip,
    input$Vis2_Line_HideLegend_Tip,
    input$Vis3_Line_HideLegend_Tip,
    input$Vis4_Line_HideLegend_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Legend Display"),
            h4(strong("Toggle "), "switch in order to display or hide the visualization legend."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Bar_LegendX_Tip,
    input$Vis2_Bar_LegendX_Tip,
    input$Vis3_Bar_LegendX_Tip,
    input$Vis4_Bar_LegendX_Tip,
    input$Vis1_Line_LegendX_Tip,
    input$Vis2_Line_LegendX_Tip,
    input$Vis3_Line_LegendX_Tip,
    input$Vis4_Line_LegendX_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Legend Horizontal Position"),
            h4(strong("Move "), "slider button to adjust the horizontal position of the legend."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Bar_LegendY_Tip,
    input$Vis2_Bar_LegendY_Tip,
    input$Vis3_Bar_LegendY_Tip,
    input$Vis4_Bar_LegendY_Tip,
    input$Vis1_Line_LegendY_Tip,
    input$Vis2_Line_LegendY_Tip,
    input$Vis3_Line_LegendY_Tip,
    input$Vis4_Line_LegendY_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Legend Vertical Position"),
            h4(strong("Move "), "slider button to adjust the vertical position of the legend."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Line_Number_Tip,
    input$Vis2_Line_Number_Tip,
    input$Vis3_Line_Number_Tip,
    input$Vis4_Line_Number_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Number of Line Inputs"),
            h4(strong("Select "), "the number of fields you wish to include as variables within the chart. Lines will connect surveys attributed to unique waterbody identifiers."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Line_ColPal_Tip,
    input$Vis2_Line_ColPal_Tip,
    input$Vis3_Line_ColPal_Tip,
    input$Vis4_Line_ColPal_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Palette"),
            h4(strong("Select "), "a color palette to apply to lines (colors matched across variables by unique waterbody identifier)."),easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Line_Width_Tip,
    input$Vis2_Line_Width_Tip,
    input$Vis3_Line_Width_Tip,
    input$Vis4_Line_Width_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Line Width"),
            h4(strong("Move "), "slider button to adjust the width of lines on the chart."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Line_Point_Size_Tip,
    input$Vis2_Line_Point_Size_Tip,
    input$Vis3_Line_Point_Size_Tip,
    input$Vis4_Line_Point_Size_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Point Size"),
            h4(strong("Move "), "slider button to adjust the size of points on the chart."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Line_Point_Color_Tip,
    input$Vis2_Line_Point_Color_Tip,
    input$Vis3_Line_Point_Color_Tip,
    input$Vis4_Line_Point_Color_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Point Color"),
            h4(strong("Select "), "the desired color for points on the chart."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Pie_CategoryType_Tip,
    input$Vis2_Pie_CategoryType_Tip,
    input$Vis3_Pie_CategoryType_Tip,
    input$Vis4_Pie_CategoryType_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Select Display Mode"),
            h4(strong("Metrics: "), "Surveys are summed together for each of the selected metrics and the percentage of the total is displayed for each metric ('Slice')."),
            h4(strong("Surveys: "), "Metrics are summed together for each of the selected surveys and the percentage of the total is displayed for each survey ('Slice')."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Pie_Metrics_Tip,
    input$Vis2_Pie_Metrics_Tip,
    input$Vis3_Pie_Metrics_Tip,
    input$Vis4_Pie_Metrics_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Metric Selection"),
            h4(strong("Select "), "fields to serve as slices of the pie (with selected surveys being added together)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(c(
    input$Vis1_Pie_Metrics_to_Sum_Tip,
    input$Vis2_Pie_Metrics_to_Sum_Tip,
    input$Vis3_Pie_Metrics_to_Sum_Tip,
    input$Vis4_Pie_Metrics_to_Sum_Tip
      ),{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Metric Selection"),
            h4(strong("Select "), "at least one field to be used within the pie chart (multiple selected fields will be added together to calculate percentages), while surveys will be displayed as the slices."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

  
  # observeEvent(c(
  #   input$****,
  #     ),{
  #       showModal(modalDialog(
  #           footer=list(modalButton(label="Close")),
  #           size=c("m"),
  #           title = strong("***"),
  #           h4(strong("***"), "***"),
  #           easyClose = TRUE
  #       ))
  #   },ignoreInit=TRUE)  
  # 
  
  observeEvent(input$CompiledDataWarning_Tip,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("m"),
            title = strong("Custom Table Warnings."),
            h4(strong("Warnings: "), "The information below displays the ranges or categories of data within the custom dataset (exclusive of user-defined filters). Care should be taken 
               when comparing data that differs in any of the listed categories (or others which may not be listed)."), br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
 
      
 observeEvent(
    c(
      input$SelDataChoice_Help
      ),
    {
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      hideTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "ViewFilt_SelSurveys")
      },ignoreInit=TRUE)
 
  observeEvent(
    c(
      input$VisFieldChoice_Help
      ),
    {
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      hideTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "ViewFilt_SelFields")
      },ignoreInit=TRUE)
  
    observeEvent(
    c(
      input$DataAvailInquirySetup_Help
      ),
    {
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      showTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      showTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      hideTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Avail_Overview")
      },ignoreInit=TRUE)
    
    observeEvent(
    c(
      input$SumOptions_Help
      ),
    {
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      showTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      showTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      showTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      showTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      hideTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Summ_Overview")
      },ignoreInit=TRUE)
  

  observeEvent(
    c(
      input$CustomTable_UG_Link
      ),
    {
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      hideTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "ViewFilt_Interact")
      },ignoreInit=TRUE)
    
   
  observeEvent(
    c(
      input$CompiledDataWarning_Help
      ),
    {
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      hideTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "ViewFilt_DataWarning")
      },ignoreInit=TRUE)
   
#### User Guide ####

# Hide Tabs on Startup #
  hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
  hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
  hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
  hideTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
  hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
  hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
  hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
  hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
  hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
  hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
  hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
  hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
  hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
  hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
  hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
  hideTab(inputId = "UserGuideTabs", target = "VisData_Overview")
  hideTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
  hideTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
  hideTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
  hideTab(inputId = "UserGuideTabs", target = "VisData_Settings")
  hideTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
  hideTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
  hideTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
  hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
  hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
  hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
  hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
  hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
  hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
  hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
  hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")

 observeEvent(
    c(
      input$UG_Home_ViewFilt,
      input$ViewFilt_UG
      ),
    {
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      hideTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "ViewFilt_Overview")
      },ignoreInit=TRUE)

  observeEvent(
    c(
      input$UG_Home_DataAvail,
      input$DataAvail_UG
    ),
    {
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      showTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      showTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      hideTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Avail_Overview")
    },ignoreInit=TRUE)

  observeEvent(
    c(
      input$UG_Home_Data_Summarization,
      input$Summarize_UG
    ),
    {
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      showTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      showTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      showTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      showTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      hideTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Summ_Overview")
    },ignoreInit=TRUE)

  observeEvent(
    c(input$UG_Home_Visualization,
      input$Visualize_UG
    ),
    {
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      showTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      showTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      showTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_Overview")
    },ignoreInit=TRUE)

observeEvent(
    c(
      input$UG_Home_Map,
      input$Mapping_UG
    ),
    {
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      showTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      showTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      showTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      showTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_SelSurveys")
    },ignoreInit=TRUE)

  observeEvent(
    c(
      input$UG_Home_Scatter,
      input$Scatter_UG
    ),
    {
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      showTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      showTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      showTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      showTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_SelSurveys")
    },ignoreInit=TRUE)

    observeEvent(
    c(
      input$UG_Home_Line,
      input$LinePlot_UG
    ),
    {
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      showTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      showTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      showTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      showTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_SelSurveys")
    },ignoreInit=TRUE)

  observeEvent(
    c(
      input$UG_Home_Pie,
      input$Pie_UG
    ),
    {
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      showTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      showTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      showTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      showTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_SelSurveys")
    },ignoreInit=TRUE)

   observeEvent(
    c(
      input$UG_Home_Bar,
      input$Bar_UG
    ),
    {
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      showTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      showTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      showTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      showTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      showTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      showTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      showTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_SelSurveys")
    },ignoreInit=TRUE)
   
      observeEvent(
    c(
       input$UG_Home_DataSubm,
       input$DataSubmit_UG
    ),
    {
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
      hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Overview")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
      hideTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Settings")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
      hideTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
      hideTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      showTab(inputId = "UserGuideTabs", target = "Submit_Overview")
      showTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
      showTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
      updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
      updateTabsetPanel(session, "UserGuideTabs",selected = "Submit_Overview")
    },ignoreInit=TRUE)
        

  observeEvent(
    c(
    input$UG_ViewFilt_Overview_Home,
    input$UG_ViewFilt_SelSurveys_Home,
    input$UG_ViewFilt_SelFields_Home,
    input$UG_ViewFilt_DataWarning_Home,
    input$UG_ViewFilt_Interact_Home,
    input$UG_Data_Avail_Overview_Home,
    input$UG_Data_Avail_SelSurveys_Home,
    input$UG_Data_Avail_DataWarning_Home,
    input$UG_Data_Avail_Inquiry_Home,
    input$UG_Data_Summ_Overview_Home,
    input$UG_Data_Summ_SelSurveys_Home,
    input$UG_Data_Summ_SelFields_Home,
    input$UG_Data_Summ_DataWarning_Home,
    input$UG_Data_Summ_Inputs_Home,
    input$UG_Data_Summ_Results_Home,
    input$UG_VisData_Overview_Home,
    input$UG_VisData_SelSurveys_Home,
    input$UG_VisData_SelFields_Home,
    input$UG_VisData_DataWarning_Home,
    input$UG_VisData_Settings_Home,
    input$UG_VisData_DataInputs_Home,
    input$UG_VisData_DataSelection_Home,
    input$UG_VisData_VisTypes_Home,
    input$UG_VisData_Map_Home,
    input$UG_VisData_Scatter_Home,
    input$UG_VisData_TimeSeries_Home,
    input$UG_VisData_Pie_Home,
    input$UG_VisData_Bar_Home,
    input$UG_Submit_Overview_Home,
    input$UG_Submit_Transfer_Home,
    input$UG_Submit_DirectInput_Home
  ),
  {
  hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Overview")
  hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelSurveys")
  hideTab(inputId = "UserGuideTabs", target = "ViewFilt_SelFields")
  hideTab(inputId = "UserGuideTabs", target = "ViewFilt_DataWarning")
  hideTab(inputId = "UserGuideTabs", target = "ViewFilt_Interact")
  hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Overview")
  hideTab(inputId = "UserGuideTabs", target = "Data_Avail_SelSurveys")
  hideTab(inputId = "UserGuideTabs", target = "Data_Avail_DataWarning")
  hideTab(inputId = "UserGuideTabs", target = "Data_Avail_Inquiry")
  hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Overview")
  hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelSurveys")
  hideTab(inputId = "UserGuideTabs", target = "Data_Summ_SelFields")
  hideTab(inputId = "UserGuideTabs", target = "Data_Summ_DataWarning")
  hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Inputs")
  hideTab(inputId = "UserGuideTabs", target = "Data_Summ_Results")
  hideTab(inputId = "UserGuideTabs", target = "VisData_Overview")
  hideTab(inputId = "UserGuideTabs", target = "VisData_SelSurveys")
  hideTab(inputId = "UserGuideTabs", target = "VisData_SelFields")
  hideTab(inputId = "UserGuideTabs", target = "VisData_DataWarning")
  hideTab(inputId = "UserGuideTabs", target = "VisData_Settings")
  hideTab(inputId = "UserGuideTabs", target = "VisData_DataInputs")
  hideTab(inputId = "UserGuideTabs", target = "VisData_DataSelection")
  hideTab(inputId = "UserGuideTabs", target = "VisData_VisTypes")
  hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
  hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
  hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
  hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
  hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
  hideTab(inputId = "UserGuideTabs", target = "Submit_Overview")
  hideTab(inputId = "UserGuideTabs", target = "Submit_Transfer")
  hideTab(inputId = "UserGuideTabs", target = "Submit_DirectInput")
  updateTabsetPanel(session, "CreelCatNavBar",selected = "User Guide")
  updateTabsetPanel(session, "UserGuideTabs",selected = "UG_Home")
     },ignoreInit=TRUE
  )


  observeEvent(input$UG_ViewFilt_Overview_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "ViewFilt_SelSurveys")
  },ignoreInit=TRUE)

  observeEvent(input$UG_ViewFilt_SelSurveys_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "ViewFilt_SelFields")
  },ignoreInit=TRUE)

  observeEvent(input$UG_ViewFilt_SelFields_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "ViewFilt_DataWarning")
  },ignoreInit=TRUE)

  observeEvent(input$UG_ViewFilt_DataWarning_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "ViewFilt_Interact")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Avail_Overview_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Avail_SelSurveys")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Avail_SelSurveys_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Avail_DataWarning")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Avail_DataWarning_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Avail_Inquiry")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Summ_Overview_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Summ_SelSurveys")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Summ_SelSurveys_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Summ_SelFields")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Summ_SelFields_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Summ_DataWarning")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Summ_DataWarning_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Summ_Inputs")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Summ_Inputs_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Summ_Results")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_Overview_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_SelSurveys")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_SelSurveys_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_SelFields")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_SelFields_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_DataWarning")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_DataWarning_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_Settings")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_Settings_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_DataInputs")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_DataInputs_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_DataSelection")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_DataSelection_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_VisTypes")
  },ignoreInit=TRUE)

  observeEvent(
    input$UG_VisType_Map,
    {
      showTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_Map")
    },ignoreInit=TRUE)
  
    observeEvent(
    input$UG_VisType_Scatter,
    {
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      showTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_Scatter")
    },ignoreInit=TRUE)
      
      
    observeEvent(
    input$UG_VisType_Line,
    {
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      showTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_TimeSeries")
    },ignoreInit=TRUE)
      
      
   observeEvent(
    input$UG_VisType_Pie,
    {
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      showTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_Pie")
    },ignoreInit=TRUE)
      
      
    observeEvent(
    input$UG_VisType_Bar,
    {
      hideTab(inputId = "UserGuideTabs", target = "VisData_Map")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Scatter")
      hideTab(inputId = "UserGuideTabs", target = "VisData_TimeSeries")
      hideTab(inputId = "UserGuideTabs", target = "VisData_Pie")
      showTab(inputId = "UserGuideTabs", target = "VisData_Bar")
      updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_Bar")
    },ignoreInit=TRUE)
    



  observeEvent(input$UG_Submit_Overview_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Submit_Transfer")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Submit_Transfer_Next,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Submit_DirectInput")
  },ignoreInit=TRUE)

  observeEvent(input$UG_ViewFilt_SelSurveys_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "ViewFilt_Overview")
  },ignoreInit=TRUE)

  observeEvent(input$UG_ViewFilt_SelFields_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "ViewFilt_SelSurveys")
  },ignoreInit=TRUE)

  observeEvent(input$UG_ViewFilt_DataWarning_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "ViewFilt_SelFields")
  },ignoreInit=TRUE)

  observeEvent(input$UG_ViewFilt_Interact_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "ViewFilt_DataWarning")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Avail_SelSurveys_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Avail_Overview")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Avail_DataWarning_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Avail_SelSurveys")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Avail_Inquiry_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Avail_DataWarning")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Summ_SelFields_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Summ_Overview")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Summ_DataWarning_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Summ_SelFields")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Summ_Inputs_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Summ_DataWarning")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Data_Summ_Results_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Data_Summ_Inputs")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_SelSurveys_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_Overview")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_SelFields_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_SelSurveys")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_DataWarning_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_SelFields")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_Settings_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_DataWarning")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_DataInputs_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_Settings")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_DataSelection_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_DataInputs")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_VisTypes_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_DataSelection")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_Map_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_VisTypes")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_Scatter_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_VisTypes")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_TimeSeries_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_VisTypes")
  },ignoreInit=TRUE)
  observeEvent(input$UG_VisData_Pie_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_VisTypes")
  },ignoreInit=TRUE)

  observeEvent(input$UG_VisData_Bar_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "VisData_VisTypes")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Submit_Transfer_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Submit_Overview")
  },ignoreInit=TRUE)

  observeEvent(input$UG_Submit_DirectInput_Previous,{
    updateTabsetPanel(session, "UserGuideTabs",selected = "Submit_Transfer")
  },ignoreInit=TRUE)


  
  
  
#   #### Test Help Open ####
#   observeEvent(input$FiltDataFields_Help, {
#     updateCollapse(session, "ViewFiltHelp", open="User Guide")
#   })
#   observeEvent(input$FiltDataFields_Help, {
#     updateCollapse(session, "ViewFiltUG", open="Fields")
#   })
#   
#   observeEvent(input$FiltTable_Help, {
#     updateCollapse(session, "ViewFiltHelp", open="User Guide")
#   })
#   observeEvent(input$FiltTable_Help, {
#     updateCollapse(session, "ViewFiltUG", open="Table")
#   })
#     
  #### Tools and Features Feature Navigation ####
  observeEvent(c(
    input$DataAvail_Feature,
    input$UG_Data_Avail_Overview_Feature,
    input$UG_Data_Avail_SelSurveys_Feature,
    input$UG_Data_Avail_DataWarning_Feature,
    input$UG_Data_Avail_Inquiry_Feature
                 ), {
    updateTabsetPanel(session, "CreelCatNavBar",selected = "Data Availability")
  },ignoreInit=TRUE)

  observeEvent(c(
    input$ViewFilt_Feature,
    input$UG_ViewFilt_Overview_Feature,
    input$UG_ViewFilt_SelSurveys_Feature,
    input$UG_ViewFilt_SelFields_Feature,
    input$UG_ViewFilt_DataWarning_Feature,
    input$UG_ViewFilt_Interact_Feature
    ), {
    updateTabsetPanel(session, "CreelCatNavBar",selected = "View and Filter Data")
  },ignoreInit=TRUE)

  observeEvent(c(
    input$Summarize_Feature,
    input$UG_Data_Summ_Overview_Feature,
    input$UG_Data_Summ_SelFields_Feature,
    input$UG_Data_Summ_DataWarning_Feature,
    input$UG_Data_Summ_Inputs_Feature,
    input$UG_Data_Summ_Results_Feature
    ), {
    updateTabsetPanel(session, "CreelCatNavBar",selected = "Summarize Data")
  },ignoreInit=TRUE)

  observeEvent(c(
    input$Visualize_Feature,
    input$Mapping_Feature,
    input$LinePlot_Feature,
    input$Scatter_Feature,
    input$Bar_Feature,
    input$Pie_Feature,
    input$UG_VisData_Overview_Feature,
    input$UG_VisData_SelSurveys_Feature,
    input$UG_VisData_SelFields_Feature,
    input$UG_VisData_DataWarning_Feature,
    input$UG_VisData_Settings_Feature,
    input$UG_VisData_DataInputs_Feature,
    input$UG_VisData_DataSelection_Feature,
    input$UG_VisData_VisTypes_Feature,
    input$UG_VisData_Map_Feature,
    input$UG_VisData_Scatter_Feature,
    input$UG_VisData_TimeSeries_Feature,
    input$UG_VisData_Pie_Feature,
    input$UG_VisData_Bar_Feature
    ),{
    updateTabsetPanel(session, "CreelCatNavBar",selected = "Visualize Data")
  },ignoreInit=TRUE)

  observeEvent(c(
    input$DataSubmit_Feature,
    input$UG_Submit_Overview_Feature,
    input$UG_Submit_Transfer_Feature,
    input$UG_Submit_DirectInput_Feature
    ),{
    updateTabsetPanel(session, "CreelCatNavBar",selected = "Submit Data")
  },ignoreInit=TRUE)


  # observe({
  #   updateTabsetPanel(session, "CreelCatNavBar",selected = "About CreelCat")
  # })
  

  
### Data Warning For Later 
  #   observeEvent(c(
#     input$Vis_Filters_Shared_rows_selected,
#     input$Vis_1_Input_rows_selected,
#     input$Vis_2_Input_rows_selected,
#     input$Vis_3_Input_rows_selected,
#     input$Vis_4_Input_rows_selected
#   ),{
#         updateCollapse(session, "VisDataWarning", open="VisDataWarningCollapse")
#   }
#   )
  
  
#### All Page Inputs ####
  
  
#### Data Field Pickers ####
    #### Reactive Filter Inputs ####
  SurveyPick<-reactive({input$SurveyPicker})
  WaterbodyPick<-reactive({input$WaterbodyPicker})
  FishMetricPick<-reactive({input$FishMetricsPicker})
  AllTaxaPick<-reactive({input$AllTaxaInput})
  SubsPick<-reactive({input$SubsPicker})
  SppPick<-reactive({input$SppPicker})
  GenPick<-reactive({input$GenPicker})
  FamPick<-reactive({input$FamPicker})
  GrpPick<-reactive({input$GrpPicker})
  TaxaPick<-reactive({c(AllTaxaPick(),SubsPick(),SppPick(),GenPick(),FamPick(),GrpPick())})
  TaxaPick_NoGroup<-reactive({c(AllTaxaPick(),SubsPick(),SppPick(),GenPick(),FamPick())})
  EffortPick<-reactive({input$EffortPicker})
  TargetMetricPick<-reactive({input$TargetMetricPicker})
  AngPref_AllTaxaPick<-reactive({input$AngPref_AllTaxaInput})
  AngPref_SubsPick<-reactive({input$AngPref_SubsPicker})
  AngPref_SppPick<-reactive({input$AngPref_SppPicker})
  AngPref_GenPick<-reactive({input$AngPref_GenPicker})
  AngPref_FamPick<-reactive({input$AngPref_FamPicker})
  AngPref_GrpPick<-reactive({input$AngPref_GrpPicker})
  AngPref_TaxaPick<-reactive({c(AngPref_AllTaxaPick(),AngPref_SubsPick(),AngPref_SppPick(),AngPref_GenPick(),AngPref_FamPick(),AngPref_GrpPick())})
  AngPref_TaxaPick_NoGroup<-reactive({c(AngPref_AllTaxaPick(),AngPref_SubsPick(),AngPref_SppPick(),AngPref_GenPick(),AngPref_FamPick())})
  DemographicPick<-reactive({input$DemographicPicker})
  
#### Picked Data Tables ####
  
  Picked_DT_Status<-reactiveVal("Not_Picked")
  
  observeEvent(input$FieldUpdateBTN,{
    Picked_DT_Status("Picked")
    },ignoreInit=TRUE)
  
    observeEvent(c(input$SurveyPicker,input$WaterbodyPicker,input$FishMetricsPicker,input$AllTaxaInput,
                   input$SubsPicker, input$SppPicker, input$GenPicker, input$FamPicker, input$GrpPicker,
                   input$FishValFill,input$TargetValFill,
                   input$EffortPicker, input$TargetMetricPicker, input$AngPref_AllTaxaInput, 
                   input$AngPref_SubsPicker,input$AngPref_SppPicker, input$AngPref_GenPicker, 
                   input$AngPref_FamPicker, input$AngPref_GrpPicker, input$DemographicPicker
                   ),{
    Picked_DT_Status("Not_Picked")
    },ignoreInit=TRUE)
      
    
  output$Picked_Data_Status<-reactive({
    if(Picked_DT_Status()=="Not_Picked"){"Not_Picked"}
       else if (Picked_DT_Status()=="Picked"){"Picked"}
   })
  
  outputOptions(output,'Picked_Data_Status',suspendWhenHidden=FALSE)
  # outputOptions(output,'SelDataFilterYearSliderStatus',suspendWhenHidden=FALSE)
  
  #### All Surveys ####
  
  #### Survey Table ####
  SurveyData<-eventReactive(input$FieldUpdateBTN,{
    SurveyTBL<-Survey_Data[,c("Survey_ID","State","Year","Duration",SurveyPick())]
  })
  
  #### Waterbody Table ####
  WaterbodyData<-eventReactive(input$FieldUpdateBTN,{
    WaterbodyTBL<-Survey_Data[,c("Survey_ID","Waterbody_Name_Unique","WB_ID",WaterbodyPick())]
  })
  
  
  #### Fish Table ####
    FishData<-eventReactive(input$FieldUpdateBTN,{
      if(is.null(input$FishMetricsPicker)||is.null(TaxaPick())){
        DF<-data.frame(Survey_ID=character())
      }else{
        pivot_wider(
          FishDataCompiled[FishDataCompiled$Taxa%in%(TaxaPick()),c("Survey_ID","Taxa",FishMetricPick())], # Filtered Data
          id_cols=Survey_ID,
          values_fill=if(input$FishValFill=="NULL"){NA}else{0},
          names_from=Taxa,
          names_glue="{Taxa} {.value}",
          values_from=c(FishMetricPick()))%>%
          select("Survey_ID",sort(names(.)))
      }
    })
  
  #### Effort Table ####
  EffortData<-eventReactive(input$FieldUpdateBTN,{
    AngEffort_Data[,c("Survey_ID",EffortPick())]
  })
  
  #### Angler Preference Table ####
  AnglerPrefData<-eventReactive(input$FieldUpdateBTN,{
      if(is.null(input$TargetMetricPicker)||is.null(AngPref_TaxaPick())){
        DF<-data.frame(Survey_ID=character())
      }else{
        pivot_wider(
          AngPrefDataCompiled[AngPrefDataCompiled$Target_Taxa%in%(AngPref_TaxaPick()),c("Survey_ID","Target_Taxa",TargetMetricPick())], # Filtered Data
          id_cols=Survey_ID,
          values_fill=if(input$TargetValFill=="NULL"){NA}else{0},
          names_from=Target_Taxa,
          names_glue="{Target_Taxa} {.value}",
          values_from=c(TargetMetricPick()))%>%
          select("Survey_ID",sort(names(.)))
      }
  })
  
  #### Filter Demographic Data ####
  DemoData<-eventReactive(input$FieldUpdateBTN,{
    Demographic_Data[,c("Survey_ID",DemographicPick())]
  })
  
  
#### Compiled Datatable #####
  
  CompiledData_All<-eventReactive(input$FieldUpdateBTN,{
    left_join(SurveyData(),WaterbodyData(),by='Survey_ID')%>%
      left_join(.,EffortData(),by='Survey_ID')%>%
      left_join(.,DemoData(),by='Survey_ID')%>%
      left_join(.,FishData(),by='Survey_ID')%>%
      left_join(.,AnglerPrefData(),by='Survey_ID')
  })
  
  
### All Fields ###
  
  output$SelDataFilterYearSliderStatus<-reactive({
    if(is.null(input$SelDataYearFilterSlider)){"Unused"}
       else if (input$SelDataYearFilterSlider[2]==min(Survey_Data$Year,na.rm=TRUE)){"No"}
       else{"Yes"}
   })
  
  outputOptions(output,'SelDataFilterYearSliderStatus',suspendWhenHidden=FALSE)
  
  output$SelDataFilterDurationSliderStatus<-reactive({
    if(is.null(input$SelDataDurationFilterSlider)){"Unused"}
       else if (input$SelDataDurationFilterSlider[2]==min(Survey_Data$Duration,na.rm=TRUE)){"No"}
       else{"Yes"}
   })
  
  outputOptions(output,'SelDataFilterDurationSliderStatus',suspendWhenHidden=FALSE)
  
  output$SelDataFilterWaterbodyAreaSliderStatus<-reactive({
    if(is.null(input$SelDataWaterbodyAreaFilterSlider)){"Unused"}
       else if (input$SelDataWaterbodyAreaFilterSlider[2]==min(Survey_Data$WB_Acres,na.rm=TRUE)){"No"}
       else{"Yes"}
   })
  
  outputOptions(output,'SelDataFilterWaterbodyAreaSliderStatus',suspendWhenHidden=FALSE)
  
 
  

    
  output$SelDataFilterStatus<-reactive({
    if(is.null(input$SelDataCustomTableFilters_Picker)){"Incomplete"}else if 
    (("State"%in%input$SelDataCustomTableFilters_Picker)&&is.null(input$SelDataStateFilterPicker)){"Incomplete"}else if
    (("Waterbody Name"%in%input$SelDataCustomTableFilters_Picker)&&is.null(input$SelDataWaterbody_NameFilterPicker)){"Incomplete"}else if
    (("County"%in%input$SelDataCustomTableFilters_Picker)&&is.null(input$SelDataCountyFilterPicker)){"Incomplete"}else if
    (("Survey Type"%in%input$SelDataCustomTableFilters_Picker)&&is.null(input$SelDataSurveyTypeFilterPicker)){"Incomplete"}else if
    (("Start Month"%in%input$SelDataCustomTableFilters_Picker)&&is.null(input$SelDataStartMonthFilterPicker)){"Incomplete"}else if
    (("End Month"%in%input$SelDataCustomTableFilters_Picker)&&is.null(input$SelDataEndMonthFilterPicker)){"Incomplete"}else if
    (("Waterbody Type"%in%input$SelDataCustomTableFilters_Picker)&&is.null(input$SelDataWB_TypeFilterPicker)){"Incomplete"}else if
    (("Year"%in%input$SelDataCustomTableFilters_Picker)&&input$SelDataYearFilterSlider[2]==min(Survey_Data$Year,na.rm=TRUE)){"Incomplete"}else if
    (("Duration"%in%input$SelDataCustomTableFilters_Picker)&&input$SelDataDurationFilterSlider[2]==min(Survey_Data$Duration,na.rm=TRUE)){"Incomplete"}else if
    (("Waterbody Area"%in%input$SelDataCustomTableFilters_Picker)&&input$SelDataWaterbodyAreaFilterSlider[2]==min(Survey_Data$WB_Acres,na.rm=TRUE)){"Incomplete"}else
    {"Complete"}
     })
  
  outputOptions(output,'SelDataFilterStatus',suspendWhenHidden=FALSE)
  
  
  
  
 
### Sel Data Slider Input Link ###
  
 observeEvent(input$SelDataYearFilter_Min,{
    req(isTruthy(input$SelDataYearFilter_Min))
     req(input$SelDataYearFilter_Min<min(Survey_Data$Year,na.rm=TRUE))
     req(input$SelDataYearFilter_Min>1000)
     
     updateNumericInput(
            session = session,
            inputId = 'SelDataYearFilter_Min',
            value = min(Survey_Data$Year,na.rm=TRUE)
          )
     
  },ignoreInit=TRUE)
  
    observeEvent(input$SelDataYearFilter_Max,{
    req(isTruthy(input$SelDataYearFilter_Max))
     req(input$SelDataYearFilter_Max>max(Survey_Data$Year,na.rm=TRUE))
     
     updateNumericInput(
            session = session,
            inputId = 'SelDataYearFilter_Max',
            value = max(Survey_Data$Year,na.rm=TRUE)
          )
     
  },ignoreInit=TRUE)

   observeEvent(input$SelDataYearFilter_Min, {
     
     req(isTruthy(input$SelDataYearFilter_Min))
     req(input$SelDataYearFilter_Min>=min(Survey_Data$Year,na.rm=TRUE))
     
     MaxVal<-if(input$SelDataYearFilterSlider[2]>input$SelDataYearFilter_Min){
       input$SelDataYearFilterSlider[2]
     } else {input$SelDataYearFilter_Min}
     
     if ((input$SelDataYearFilter_Min != input$SelDataYearFilterSlider[1]))
        {
          updateSliderInput(
            session = session,
            inputId = 'SelDataYearFilterSlider',
            value = c(input$SelDataYearFilter_Min,MaxVal)
          )
        } else {
            
        }
    

      },ignoreInit=TRUE)

     observeEvent(input$SelDataYearFilter_Max, {
       
       req(isTruthy(input$SelDataYearFilter_Max))
       req(input$SelDataYearFilter_Max>1000)
       req(input$SelDataYearFilter_Max<=max(Survey_Data$Year,na.rm=TRUE))
       
       MinVal<-if (input$SelDataYearFilterSlider[1]<input$SelDataYearFilter_Max){
       input$SelDataYearFilterSlider[1]
     } else {input$SelDataYearFilter_Max}
       
      if ((input$SelDataYearFilter_Max != input$SelDataYearFilterSlider[2]))
        {
          updateSliderInput(
            session = session,
            inputId = 'SelDataYearFilterSlider',
            value = c(MinVal,input$SelDataYearFilter_Max)
          )
        } else {

        }

      },ignoreInit=TRUE)

  observeEvent(input$SelDataYearFilterSlider[1], {
    

       if (!isTruthy(input$SelDataYearFilter_Min)|(input$SelDataYearFilter_Min != input$SelDataYearFilterSlider[1]))
        {
          updateNumericInput(
            session = session,
            inputId = 'SelDataYearFilter_Min',
            value = input$SelDataYearFilterSlider[1]
          )
        } else {

        }

      },ignoreInit=TRUE)

    observeEvent(input$SelDataYearFilterSlider[2], {

     if (!isTruthy(input$SelDataYearFilter_Max)|(input$SelDataYearFilter_Max != input$SelDataYearFilterSlider[2]))
        {
          updateNumericInput(
            session = session,
            inputId = 'SelDataYearFilter_Max',
            value = input$SelDataYearFilterSlider[2]
          )
        } else {

        }

      },ignoreInit=TRUE)
    
 observeEvent(input$SelDataDurationFilter_Min,{
    req(isTruthy(input$SelDataDurationFilter_Min))
     req(input$SelDataDurationFilter_Min<min(Survey_Data$Duration,na.rm=TRUE))
     
     updateNumericInput(
            session = session,
            inputId = 'SelDataDurationFilter_Min',
            value = min(Survey_Data$Duration,na.rm=TRUE)
          )
     
  },ignoreInit=TRUE)
  
    observeEvent(input$SelDataDurationFilter_Max,{
    req(isTruthy(input$SelDataDurationFilter_Max))
     req(input$SelDataDurationFilter_Max>max(Survey_Data$Duration,na.rm=TRUE))
     
     updateNumericInput(
            session = session,
            inputId = 'SelDataDurationFilter_Max',
            value = max(Survey_Data$Duration,na.rm=TRUE)
          )
     
  },ignoreInit=TRUE)

   observeEvent(input$SelDataDurationFilter_Min, {
     
     req(isTruthy(input$SelDataDurationFilter_Min))
     req(input$SelDataDurationFilter_Min>=min(Survey_Data$Duration,na.rm=TRUE))
     
     MaxVal<-if(input$SelDataDurationFilterSlider[2]>input$SelDataDurationFilter_Min){
       input$SelDataDurationFilterSlider[2]
     } else {input$SelDataDurationFilter_Min}
     
     if ((input$SelDataDurationFilter_Min != input$SelDataDurationFilterSlider[1]))
        {
          updateSliderInput(
            session = session,
            inputId = 'SelDataDurationFilterSlider',
            value = c(input$SelDataDurationFilter_Min,MaxVal)
          )
        } else {
            
        }
    

      },ignoreInit=TRUE)

     observeEvent(input$SelDataDurationFilter_Max, {
       
       req(isTruthy(input$SelDataDurationFilter_Max))
       req(input$SelDataDurationFilter_Max<=max(Survey_Data$Duration,na.rm=TRUE))
       
       MinVal<-if (input$SelDataDurationFilterSlider[1]<input$SelDataDurationFilter_Max){
       input$SelDataDurationFilterSlider[1]
     } else {input$SelDataDurationFilter_Max}
       
      if ((input$SelDataDurationFilter_Max != input$SelDataDurationFilterSlider[2]))
        {
          updateSliderInput(
            session = session,
            inputId = 'SelDataDurationFilterSlider',
            value = c(MinVal,input$SelDataDurationFilter_Max)
          )
        } else {

        }

      },ignoreInit=TRUE)

  observeEvent(input$SelDataDurationFilterSlider[1], {
    

       if (!isTruthy(input$SelDataDurationFilter_Min)|(input$SelDataDurationFilter_Min != input$SelDataDurationFilterSlider[1]))
        {
          updateNumericInput(
            session = session,
            inputId = 'SelDataDurationFilter_Min',
            value = input$SelDataDurationFilterSlider[1]
          )
        } else {

        }

      },ignoreInit=TRUE)

    observeEvent(input$SelDataDurationFilterSlider[2], {

     if (!isTruthy(input$SelDataDurationFilter_Max)|(input$SelDataDurationFilter_Max != input$SelDataDurationFilterSlider[2]))
        {
          updateNumericInput(
            session = session,
            inputId = 'SelDataDurationFilter_Max',
            value = input$SelDataDurationFilterSlider[2]
          )
        } else {

        }

      },ignoreInit=TRUE)
  
 observeEvent(input$SelDataWaterbodyAreaFilter_Min,{
    req(isTruthy(input$SelDataWaterbodyAreaFilter_Min))
     req(input$SelDataWaterbodyAreaFilter_Min<min(Survey_Data$WB_Acres,na.rm=TRUE))
     
     updateNumericInput(
            session = session,
            inputId = 'SelDataWaterbodyAreaFilter_Min',
            value = min(Survey_Data$WB_Acres,na.rm=TRUE)
          )
     
  },ignoreInit=TRUE)
  
    observeEvent(input$SelDataWaterbodyAreaFilter_Max,{
    req(isTruthy(input$SelDataWaterbodyAreaFilter_Max))
     req(input$SelDataWaterbodyAreaFilter_Max>max(Survey_Data$WB_Acres,na.rm=TRUE))
     
     updateNumericInput(
            session = session,
            inputId = 'SelDataWaterbodyAreaFilter_Max',
            value = max(Survey_Data$WB_Acres,na.rm=TRUE)
          )
     
  },ignoreInit=TRUE)

   observeEvent(input$SelDataWaterbodyAreaFilter_Min, {
     
     req(isTruthy(input$SelDataWaterbodyAreaFilter_Min))
     req(input$SelDataWaterbodyAreaFilter_Min>=min(Survey_Data$WB_Acres,na.rm=TRUE))
     
     MaxVal<-if(input$SelDataWaterbodyAreaFilterSlider[2]>input$SelDataWaterbodyAreaFilter_Min){
       input$SelDataWaterbodyAreaFilterSlider[2]
     } else {input$SelDataWaterbodyAreaFilter_Min}
     
     if ((input$SelDataWaterbodyAreaFilter_Min != input$SelDataWaterbodyAreaFilterSlider[1]))
        {
          updateSliderInput(
            session = session,
            inputId = 'SelDataWaterbodyAreaFilterSlider',
            value = c(input$SelDataWaterbodyAreaFilter_Min,MaxVal)
          )
        } else {
            
        }
    

      },ignoreInit=TRUE)

     observeEvent(input$SelDataWaterbodyAreaFilter_Max, {
       
       req(isTruthy(input$SelDataWaterbodyAreaFilter_Max))
       req(input$SelDataWaterbodyAreaFilter_Max<=max(Survey_Data$WB_Acres,na.rm=TRUE))
       
       MinVal<-if (input$SelDataWaterbodyAreaFilterSlider[1]<input$SelDataWaterbodyAreaFilter_Max){
       input$SelDataWaterbodyAreaFilterSlider[1]
     } else {input$SelDataWaterbodyAreaFilter_Max}
       
      if ((input$SelDataWaterbodyAreaFilter_Max != input$SelDataWaterbodyAreaFilterSlider[2]))
        {
          updateSliderInput(
            session = session,
            inputId = 'SelDataWaterbodyAreaFilterSlider',
            value = c(MinVal,input$SelDataWaterbodyAreaFilter_Max)
          )
        } else {

        }

      },ignoreInit=TRUE)

  observeEvent(input$SelDataWaterbodyAreaFilterSlider[1], {
    

       if (!isTruthy(input$SelDataWaterbodyAreaFilter_Min)|(input$SelDataWaterbodyAreaFilter_Min != input$SelDataWaterbodyAreaFilterSlider[1]))
        {
          updateNumericInput(
            session = session,
            inputId = 'SelDataWaterbodyAreaFilter_Min',
            value = input$SelDataWaterbodyAreaFilterSlider[1]
          )
        } else {

        }

      },ignoreInit=TRUE)

    observeEvent(input$SelDataWaterbodyAreaFilterSlider[2], {

     if (!isTruthy(input$SelDataWaterbodyAreaFilter_Max)|(input$SelDataWaterbodyAreaFilter_Max != input$SelDataWaterbodyAreaFilterSlider[2]))
        {
          updateNumericInput(
            session = session,
            inputId = 'SelDataWaterbodyAreaFilter_Max',
            value = input$SelDataWaterbodyAreaFilterSlider[2]
          )
        } else {

        }

      },ignoreInit=TRUE)
  
  
### Filtered Surveys ###
   Filtered_Surveys<-reactive({
    Filtered_Surveys_Data<-droplevels(Survey_Data%>%
                                        {if("Year"%in%input$SelDataCustomTableFilters_Picker) filter(.,Year>=input$SelDataYearFilterSlider[1] &Year<=input$SelDataYearFilterSlider[2]) else .}%>%
                                        {if("State"%in%input$SelDataCustomTableFilters_Picker) filter(.,State %in% input$SelDataStateFilterPicker) else .}%>%
                                        {if("County"%in%input$SelDataCustomTableFilters_Picker) filter(.,County_ID %in% input$SelDataCountyFilterPicker) else .}%>%
                                        {if("Survey Type"%in%input$SelDataCustomTableFilters_Picker) filter(.,Survey_Type %in% input$SelDataSurveyTypeFilterPicker) else .}%>%
                                        {if("Start Month"%in%input$SelDataCustomTableFilters_Picker) filter(.,Start_Month %in% input$SelDataStartMonthFilterPicker) else .}%>%
                                        {if("End Month"%in%input$SelDataCustomTableFilters_Picker) filter(.,End_Month %in% input$SelDataEndMonthFilterPicker) else .}%>%
                                        {if("Waterbody Type"%in%input$SelDataCustomTableFilters_Picker) filter(.,WB_Type %in% input$SelDataWB_TypeFilterPicker) else .}%>%
                                        {if("Duration"%in%input$SelDataCustomTableFilters_Picker) filter(.,Duration>=input$SelDataDurationFilterSlider[1] &Duration<=input$SelDataDurationFilterSlider[2]) else .}%>%
                                        {if("Waterbody Name"%in%input$SelDataCustomTableFilters_Picker) filter(.,Waterbody_Name_Unique %in% input$SelDataWaterbody_NameFilterPicker) else .}%>%
                                        {if("Waterbody Area"%in%input$SelDataCustomTableFilters_Picker) filter(.,WB_Acres>=input$SelDataWaterbodyAreaFilterSlider[1] &Year<=input$SelDataWaterbodyAreaFilterSlider[2]) else .}
    )
  })
  
  Filtered_Surveys_IDs<-reactive({
    req(input$SelDataContents=="Filters")
    FiltSurvey_IDS<-as.data.frame(Filtered_Surveys()[,c("Survey_ID")])%>%
       rename(Survey_ID=1)
  })
  
  CompiledData_Filt<-reactive({
    return(left_join(Filtered_Surveys_IDs(),CompiledData_All(),by='Survey_ID'))
   })
  

  
    observeEvent(c(
    Filtered_Surveys_IDs()
    ),{



  FilteredFullDataset<-left_join(Filtered_Surveys_IDs(), CompiledData_Full_All,by='Survey_ID')

  Filtered_Populated_FieldsTable<-Filter(function(NA_ColDrop) !all(is.na(NA_ColDrop)),FilteredFullDataset)

  Filtered_Populated_Fields<-colnames(Filtered_Populated_FieldsTable)

  Survey_Filt_PopFields<-intersect(Filtered_Populated_Fields,SurveyChoices)

  updatePickerInput(session,"SurveyPicker",choices=Survey_Filt_PopFields)

  Waterbody_Filt_PopFields<-intersect(Filtered_Populated_Fields,WaterbodyChoices)

  updatePickerInput(session,"WaterbodyPicker",choices=Waterbody_Filt_PopFields)

  FishMetrics_Filt_PopFields<-intersect(Filtered_Populated_Fields,FishMetricChoices)

  updatePickerInput(session,"FishMetricsPicker",choices=FishMetrics_Filt_PopFields)

  Effort_Filt_PopFields<-intersect(Filtered_Populated_Fields,AnglerEffortChoices)

  updatePickerInput(session,"EffortPicker",choices=Effort_Filt_PopFields)

  TargetMetric_Filt_PopFields<-intersect(Filtered_Populated_Fields,TargetMetricChoices)

  updatePickerInput(session,"TargetMetricPicker",choices=TargetMetric_Filt_PopFields)

  Demographic_Filt_PopFields<-intersect(Filtered_Populated_Fields,DemoChoices)

  updatePickerInput(session,"DemographicPicker",choices=Demographic_Filt_PopFields)
  
  
  FishData1<-left_join(Filtered_Surveys_IDs(),FishDataCompiled[,c("Survey_ID","Taxa")],by='Survey_ID')
    
  FishData_TaxaChoices<-sort(unique(as.character(FishData1$Taxa)))
  
  Fish_Subs_Filt_PopFields<-intersect(FishData_TaxaChoices,SubsChoices)

  updatePickerInput(session,"SubsPicker",choices=Fish_Subs_Filt_PopFields)
  updatePickerInput(session,"DataAvail_SubsPicker",choices=Fish_Subs_Filt_PopFields)
  
  Fish_Spp_Filt_PopFields<-intersect(FishData_TaxaChoices,SppChoices)

  updatePickerInput(session,"SppPicker",choices=Fish_Spp_Filt_PopFields)
  updatePickerInput(session,"DataAvail_SppPicker",choices=Fish_Spp_Filt_PopFields)
  
  Fish_Gen_Filt_PopFields<-intersect(FishData_TaxaChoices,GenChoices)

  updatePickerInput(session,"GenPicker",choices=Fish_Gen_Filt_PopFields)
  updatePickerInput(session,"DataAvail_GenPicker",choices=Fish_Gen_Filt_PopFields)
  
  Fish_Fam_Filt_PopFields<-intersect(FishData_TaxaChoices,FamChoices)

  updatePickerInput(session,"FamPicker",choices=Fish_Fam_Filt_PopFields)
  updatePickerInput(session,"DataAvail_FamPicker",choices=Fish_Fam_Filt_PopFields)
  
  Fish_Grp_Filt_PopFields<-intersect(FishData_TaxaChoices,GrpChoices)

  updatePickerInput(session,"GrpPicker",choices=Fish_Grp_Filt_PopFields)
  updatePickerInput(session,"DataAvail_GrpPicker",choices=Fish_Grp_Filt_PopFields)
  
  AngPrefData1<-left_join(Filtered_Surveys_IDs(),AngPrefDataCompiled[,c("Survey_ID","Target_Taxa")],by='Survey_ID')
    
  AngPrefData_TaxaChoices<-sort(unique(as.character(AngPrefData1$Target_Taxa)))
  
  AngPref_Subs_Filt_PopFields<-intersect(AngPrefData_TaxaChoices,SubsChoices)

  updatePickerInput(session,"AngPref_SubsPicker",choices=AngPref_Subs_Filt_PopFields)
  
  AngPref_Spp_Filt_PopFields<-intersect(AngPrefData_TaxaChoices,SppChoices)

  updatePickerInput(session,"AngPref_SppPicker",choices=AngPref_Spp_Filt_PopFields)
  
  AngPref_Gen_Filt_PopFields<-intersect(AngPrefData_TaxaChoices,GenChoices)

  updatePickerInput(session,"AngPref_GenPicker",choices=AngPref_Gen_Filt_PopFields)
  
  AngPref_Fam_Filt_PopFields<-intersect(AngPrefData_TaxaChoices,FamChoices)

  updatePickerInput(session,"AngPref_FamPicker",choices=AngPref_Fam_Filt_PopFields)
  
  AngPref_Grp_Filt_PopFields<-intersect(AngPrefData_TaxaChoices,GrpChoices)

  updatePickerInput(session,"AngPref_GrpPicker",choices=AngPref_Grp_Filt_PopFields)

  },ignoreInit=TRUE)


    
  #### Data Subset based on Map ####

  CreelWaterbodies_Info_SHP$Waterbody_Name<-unlist(CreelWaterbodies_Info_SHP$Waterbody_Name)

  GetURL <- function(service, host = "basemap.nationalmap.gov") {
    sprintf("https://%s/arcgis/services/%s/MapServer/WmsServer", host, service)
  }

  FullBounds<-st_bbox(CreelWaterbodies_Info_SHP)%>%as.vector()



 MapSel_Title<-paste("<span style=\"color:grey50\"><strong>Select Waterbodies</span>")

  output$MapSelData_Subset <- renderLeaflet({
    SelDataMap <- leaflet()%>%
      addMapPane("SelectedArea",zIndex=440)%>%
      addMapPane("SelectedWBs",zIndex=430)%>%
      addMapPane("CreelData",zIndex=420)%>%
      addMapPane("SupplementaryData",zIndex=410)%>%
      addProviderTiles("CartoDB.DarkMatter",group="Dark")%>%
        addProviderTiles("CartoDB.Positron",group="Light")%>%
      addWMSTiles(GetURL("USGSImageryTopo"),group="Imagery Topo Hybrid",layers="0")%>%
      addWMSTiles(GetURL("USGSTopo"),group="Topo",layers="0")%>%
      addWMSTiles(GetURL("USGSImageryOnly"),group="Imagery",layers="0")%>%
      addWMSTiles(GetURL("USGSShadedReliefOnly"),group="Shaded Relief",layers="0")%>%
      addWMSTiles(GetURL("USGSHydroCached"),group="Hydrography",layers="0",options =list(format="image/png",transparent=TRUE))%>%
      addCircleMarkers(
        data=CreelWaterbodies_Info_SHP,
                group="Creel Waterbodies",
                layerId = as.character(CreelWaterbodies_Info_SHP$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 0.75,
                color = "blue",
                radius = 5,
                label=~CreelWaterbodies_Info_SHP$Waterbody_Name
      )%>%
      addPolygons(data=StateBoundaries_SHP,
                    group="State Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 2,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=StateBoundaries_SHP$STUSPS,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE),
        )%>%
        addPolygons(data=CountyBoundaries_SHP,
                    group="County Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 1.5,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=CountyBoundaries_SHP$County_ID,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE)
        )%>%
        addLayersControl(
          baseGroups=c("Dark","Light","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief"),
          overlayGroups =c("Creel Data", "State Boundaries","County Boundaries","Hydrography"),
          options = layersControlOptions(collapsed = TRUE))%>%
        hideGroup("County Boundaries")%>%
        hideGroup("Hydrography")%>%
      addMeasure()%>%
      addControl(MapSel_Title, position = "bottomright")%>%
      addMiniMap(position="bottomleft",minimized=TRUE,toggleDisplay=TRUE)%>%
      addEasyButton(easyButton(
        icon="fa-globe", title="Zoom to Level 1",
        onClick=JS("function(btn, map){ map.setZoom(3); }")))%>%
      addEasyButton(easyButton(
        icon="fa-crosshairs", title="Locate Me",
        onClick=JS("function(btn, map){ map.locate({setView: true, maxZoom: 10}); }")))%>%
      fitBounds(FullBounds[1], FullBounds[2], FullBounds[3], FullBounds[4])
  })

MapSel_area<-reactiveValues()

Poly_SHP_MapSel<-reactiveVal()

observeEvent(input$MapSelData_Subset_click, {
  req(input$MapSel_SelectType=="Polygon")
  req(input$MapSel_SelectPolygon=="Draw")

    coords <- input$MapSelData_Subset_click
    cm <- matrix(data = c(coords$lat, coords$lng), nrow = 1, ncol = 2)
    MapSel_area$mp <- if(!is.null(MapSel_area$mp)){rbind(MapSel_area$mp, cm)}else{cm}

    leafletProxy("MapSelData_Subset")%>%
      clearGroup("Polygon Draw")%>%
      addPolygons(lat = MapSel_area$mp[ , 1], lng = MapSel_area$mp[ , 2],color="red",fillOpacity=0,group='Polygon Draw',
          options=pathOptions(pane="SelectedArea"))

},ignoreInit=TRUE)


observeEvent(input$MapSel_SelectPolygon, {

  req(input$MapSel_SelectType=="Polygon")
  req(length(MapSel_area$mp)>5)
  req(input$MapSel_SelectPolygon=="Complete")

  Sel_MapSel_area<-as.data.frame(MapSel_area$mp)%>%
    rename(lat=1)%>%
    rename(lng=2)



 Poly_SHP_MapSel(
    polygon_MapSel<-Sel_MapSel_area%>%
  st_as_sf(coords = c("lng", "lat"), crs = 4326)%>%
  summarise(geometry = st_combine(geometry))%>%
  st_cast("POLYGON")
 )

},ignoreInit=TRUE)

observeEvent(input$MapSel_SelectPolygon,{
req(input$MapSel_SelectPolygon=="Clear")
  req(input$MapSel_SelectType=="Polygon")

  MapSel_area$mp<-NULL
  
  Poly_SHP_MapSel(NULL)

  leafletProxy("MapSelData_Subset")%>%
      clearGroup("Polygon Draw")%>%
      clearGroup('MapSel_Circles')%>%
        clearGroup("Creel Waterbodies")%>%
        clearGroup("SelData_Subset")%>%
        addCircleMarkers(
                data=CreelWaterbodies_Info_SHP,
                group="Creel Waterbodies",
                layerId = as.character(CreelWaterbodies_Info_SHP$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 1,
                fillOpacity=1,
                color = "blue",
                radius = 5,
                label=~CreelWaterbodies_Info_SHP$Waterbody_Name
        )


},ignoreInit=TRUE)


MapSel_State_Clicks<-reactiveVal()
MapSel_SelStatePoly_SHP<-reactiveVal()
MapSel_SelStatePoints_SHP<-reactiveVal()
MapSel_SelStates_Filtered<-reactiveVal()

observeEvent(input$MapSelData_Subset_click, {
  req(input$MapSel_SelectType=="States")
  req(input$MapSel_SelectState=="Select")

      click <- input$MapSelData_Subset_shape_click

      MapSel_State_Clicks(list(c(MapSel_State_Clicks(),click$id)))

    SelStates_df<-as.data.frame(MapSel_State_Clicks())


    Selected_States_Vector<-as.character(SelStates_df[1,])


    PH<-StateBoundaries_SHP%>%
      filter(., STUSPS %in% Selected_States_Vector)

    MapSel_SelStates_Filtered(PH)


    leafletProxy("MapSelData_Subset")%>%
      clearGroup("Selected States")%>%
      addPolygons(data=MapSel_SelStates_Filtered(),color="red",weight=3,fillOpacity=0,group='Selected States',
          options=pathOptions(pane="SelectedArea"))



  },ignoreInit=TRUE)

observeEvent(input$MapSel_SelectState, {
  req(input$MapSel_SelectType=="States")
  req(input$MapSel_SelectState=="Complete")
  req(!is.null(MapSel_SelStates_Filtered()))



    MapSel_SelStatePoly_SHP(MapSel_SelStates_Filtered())

    State_Intersects<-as.data.frame(st_intersects(CreelWaterbodies_Info_SHP,MapSel_SelStatePoly_SHP(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    State_Intersects2<-State_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      State_Intersects3<-CreelWaterbodies_Info_SHP%>%slice(as.numeric(row.names(State_Intersects2)))


      MapSel_SelStatePoints_SHP(State_Intersects3)

    leafletProxy("MapSelData_Subset")%>%
      clearGroup("Selected States")%>%
      addPolygons(data=MapSel_SelStatePoly_SHP(),color="red",weight=3,fillOpacity=0,group='Selected States',
          options=pathOptions(pane="SelectedArea"))

  },ignoreInit=TRUE)

observeEvent(input$MapSel_SelectState, {
  req(input$MapSel_SelectType=="States")
  req(input$MapSel_SelectState=="Clear")

    leafletProxy("MapSelData_Subset")%>%
      clearGroup("Selected States")%>%
    clearGroup('MapSel_Circles')%>%
        clearGroup("Creel Waterbodies")%>%
        clearGroup("SelData_Subset")%>%
        addCircleMarkers(
                data=CreelWaterbodies_Info_SHP,
                group="Creel Waterbodies",
                layerId = as.character(CreelWaterbodies_Info_SHP$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 1,
                fillOpacity=1,
                color = "blue",
                radius = 5,
                label=~CreelWaterbodies_Info_SHP$Waterbody_Name
        )

    MapSel_SelStatePoly_SHP(NULL)

    MapSel_State_Clicks(NULL)
    MapSel_SelStates_Filtered(NULL)
    MapSel_SelStatePoints_SHP(NULL)


  },ignoreInit=TRUE)

observeEvent(input$MapSel_SelectType, {
  req(input$MapSel_SelectType=="States")

    leafletProxy("MapSelData_Subset")%>%
      hideGroup("County Boundaries")%>%
      showGroup("State Boundaries")
})

observeEvent(input$MapSel_SelectType, {
  req(input$MapSel_SelectType=="Counties")

    leafletProxy("MapSelData_Subset")%>%
      hideGroup("State Boundaries")%>%
      showGroup("County Boundaries")
},ignoreInit=TRUE)


MapSel_County_Clicks<-reactiveVal()
MapSel_SelCountyPoly_SHP<-reactiveVal()
MapSel_SelCountyPoints_SHP<-reactiveVal()
MapSel_SelCounties_Filtered<-reactiveVal()

observeEvent(input$MapSelData_Subset_click, {
  req(input$MapSel_SelectType=="Counties")
  req(input$MapSel_SelectCounty=="Select")

      click <- input$MapSelData_Subset_shape_click

      MapSel_County_Clicks(list(c(MapSel_County_Clicks(),click$id)))

    SelCounties_df<-as.data.frame(MapSel_County_Clicks())


    Selected_Counties_Vector<-as.character(SelCounties_df[1,])

    PH<-CountyBoundaries_SHP%>%
      filter(., County_ID %in% Selected_Counties_Vector)

    MapSel_SelCounties_Filtered(PH)

    leafletProxy("MapSelData_Subset")%>%
      clearGroup("Selected Counties")%>%
      addPolygons(data=MapSel_SelCounties_Filtered(),color="red",weight=3,fillOpacity=0,group='Selected Counties',
          options=pathOptions(pane="SelectedArea"))



  },ignoreInit=TRUE)

observeEvent(input$MapSel_SelectCounty, {
  req(input$MapSel_SelectType=="Counties")
  req(input$MapSel_SelectCounty=="Complete")
  req(!is.null(MapSel_SelCounties_Filtered()))



    MapSel_SelCountyPoly_SHP(MapSel_SelCounties_Filtered())

    County_Intersects<-as.data.frame(st_intersects(CreelWaterbodies_Info_SHP,MapSel_SelCountyPoly_SHP(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    County_Intersects2<-County_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      County_Intersects3<-CreelWaterbodies_Info_SHP%>%slice(as.numeric(row.names(County_Intersects2)))


      MapSel_SelCountyPoints_SHP(County_Intersects3)

    leafletProxy("MapSelData_Subset")%>%
      clearGroup("Selected Counties")%>%
      addPolygons(data=MapSel_SelCountyPoly_SHP(),color="red",weight=3,fillOpacity=0,group='Selected Counties',
          options=pathOptions(pane="SelectedArea"))

  },ignoreInit=TRUE)

observeEvent(input$MapSel_SelectCounty, {
  req(input$MapSel_SelectType=="Counties")
  req(input$MapSel_SelectCounty=="Clear")

    leafletProxy("MapSelData_Subset")%>%
      clearGroup("Selected Counties")%>%
    clearGroup('MapSel_Circles')

    MapSel_SelCountyPoly_SHP(NULL)

    MapSel_County_Clicks(NULL)
    MapSel_SelCounties_Filtered(NULL)
    MapSel_SelCountyPoints_SHP(NULL)
    
     leafletProxy("MapSelData_Subset",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
        clearGroup("Creel Waterbodies")%>%
        clearGroup("SelData_Subset")%>%
        addCircleMarkers(
                data=CreelWaterbodies_Info_SHP,
                group="Creel Waterbodies",
                layerId = as.character(CreelWaterbodies_Info_SHP$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 1,
                fillOpacity=1,
                color = "blue",
                radius = 5,
                label=~CreelWaterbodies_Info_SHP$Waterbody_Name
        )


  },ignoreInit=TRUE)


observeEvent(input$MapSel_SelectType,{
  leafletProxy("MapSelData_Subset")%>%
      clearGroup("Selected States")%>%
      clearGroup("Selected Counties")%>%
      clearGroup("Polygon Draw")%>%
      clearGroup('MapSel_Circles')

    MapSel_area$mp<-NULL
    Poly_SHP_MapSel(NULL)

    MapSel_State_Clicks(NULL)
    MapSel_SelStatePoly_SHP(NULL)
    MapSel_SelStatePoints_SHP(NULL)
    MapSel_SelStates_Filtered(NULL)

    MapSel_County_Clicks(NULL)
    MapSel_SelCountyPoly_SHP(NULL)
    MapSel_SelCountyPoints_SHP(NULL)
    MapSel_SelCounties_Filtered(NULL)

},ignoreInit=TRUE)



          MapSelData_Subset_SelectedWB_SHP<-reactive({
              req(input$MapSel_SelectType)

              if(input$MapSel_SelectType=="Polygon"){
                req(length(Poly_SHP_MapSel())>0)
                req(input$MapSel_SelectPolygon=="Complete")
                 PH<-CreelWaterbodies_Info_SHP%>%
                  filter(st_intersects(.,Poly_SHP_MapSel(),sparse=FALSE)[,1])
              } else if (input$MapSel_SelectType=="States"){
                req(length(MapSel_SelStatePoly_SHP())>0)
                req(input$MapSel_SelectState=="Complete")
                PH<-MapSel_SelStatePoints_SHP()
              } else if (input$MapSel_SelectType=="Counties"){
                req(length(MapSel_SelCountyPoly_SHP())>0)
                req(input$MapSel_SelectCounty=="Complete")
                PH<-MapSel_SelCountyPoints_SHP()
              }

             return(PH)

              })

          output$MapSelData_Status<-reactive({
            
            if(is.null(input$MapSel_SelectType)){
                 PH<-0
              } else if (input$MapSel_SelectType=="States"){
                PH<-length(MapSel_SelStatePoints_SHP())
              } else if (input$MapSel_SelectType=="Counties"){
                PH<-length(MapSel_SelCountyPoints_SHP())
              } else if (input$MapSel_SelectType=="Polygon"){
                 PH<-length(Poly_SHP_MapSel())
              }

             return(PH)
          })
          
          outputOptions(output,"MapSelData_Status",suspendWhenHidden=FALSE)
            



  observeEvent(
    MapSelData_Subset_SelectedWB_SHP(),{
       leafletProxy("MapSelData_Subset",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
        clearGroup("Creel Waterbodies")%>%
        clearGroup("SelData_Subset")%>%
        addCircleMarkers(
                data=CreelWaterbodies_Info_SHP,
                group="Creel Waterbodies",
                layerId = as.character(CreelWaterbodies_Info_SHP$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 0.2,
                fillOpacity=0.2,
                color = "blue",
                radius = 5,
                label=~CreelWaterbodies_Info_SHP$Waterbody_Name
      )%>%
        addCircleMarkers(
          data=MapSelData_Subset_SelectedWB_SHP(),
          popup="SelectedWaterbodies",
          group='SelData_Subset',
          color="white",
          opacity=1,
          fillOpacity=1,
          radius=5,
          label=~MapSelData_Subset_SelectedWB_SHP()$Waterbody_Name,
          options=pathOptions(pane="SelectedWBs"))
    },ignoreInit=TRUE)


  

  #### Filter Creel Dataset based on map

  Map_Filtered_Surveys_IDs<-reactive({
    Map_FiltSurvey_IDS<-as.data.frame(MapSelData_Subset_SelectedWB_SHP())%>%dplyr::select("Survey_ID")
  })

    CompiledData_Map<-reactive({
    CompiledData_MapSel<-left_join(Map_Filtered_Surveys_IDs(),CompiledData_All(),by='Survey_ID')
   })
    
    observeEvent(c(
    Map_Filtered_Surveys_IDs()
    ),{


  FilteredFullDataset<-left_join(Map_Filtered_Surveys_IDs(), CompiledData_Full_All,by='Survey_ID')

  Filtered_Populated_FieldsTable<-Filter(function(NA_ColDrop) !all(is.na(NA_ColDrop)),FilteredFullDataset)

  Filtered_Populated_Fields<-colnames(Filtered_Populated_FieldsTable)

  Survey_Filt_PopFields<-intersect(Filtered_Populated_Fields,SurveyChoices)

  updatePickerInput(session,"SurveyPicker",choices=Survey_Filt_PopFields)

  Waterbody_Filt_PopFields<-intersect(Filtered_Populated_Fields,WaterbodyChoices)

  updatePickerInput(session,"WaterbodyPicker",choices=Waterbody_Filt_PopFields)

  FishMetrics_Filt_PopFields<-intersect(Filtered_Populated_Fields,FishMetricChoices)

  updatePickerInput(session,"FishMetricsPicker",choices=FishMetrics_Filt_PopFields)

  Effort_Filt_PopFields<-intersect(Filtered_Populated_Fields,AnglerEffortChoices)

  updatePickerInput(session,"EffortPicker",choices=Effort_Filt_PopFields)

  TargetMetric_Filt_PopFields<-intersect(Filtered_Populated_Fields,TargetMetricChoices)

  updatePickerInput(session,"TargetMetricPicker",choices=TargetMetric_Filt_PopFields)

  Demographic_Filt_PopFields<-intersect(Filtered_Populated_Fields,DemoChoices)

  updatePickerInput(session,"DemographicPicker",choices=Demographic_Filt_PopFields)
  
  
  FishData1<-left_join(Map_Filtered_Surveys_IDs(),FishDataCompiled[,c("Survey_ID","Taxa")],by='Survey_ID')
    
  FishData_TaxaChoices<-sort(unique(as.character(FishData1$Taxa)))
  
  Fish_Subs_Filt_PopFields<-intersect(FishData_TaxaChoices,SubsChoices)

  updatePickerInput(session,"SubsPicker",choices=Fish_Subs_Filt_PopFields)
  updatePickerInput(session,"DataAvail_SubsPicker",choices=Fish_Subs_Filt_PopFields)
  
  Fish_Spp_Filt_PopFields<-intersect(FishData_TaxaChoices,SppChoices)

  updatePickerInput(session,"SppPicker",choices=Fish_Spp_Filt_PopFields)
  updatePickerInput(session,"DataAvail_SppPicker",choices=Fish_Spp_Filt_PopFields)
  
  Fish_Gen_Filt_PopFields<-intersect(FishData_TaxaChoices,GenChoices)

  updatePickerInput(session,"GenPicker",choices=Fish_Gen_Filt_PopFields)
  updatePickerInput(session,"DataAvail_GenPicker",choices=Fish_Gen_Filt_PopFields)
  
  Fish_Fam_Filt_PopFields<-intersect(FishData_TaxaChoices,FamChoices)

  updatePickerInput(session,"FamPicker",choices=Fish_Fam_Filt_PopFields)
  updatePickerInput(session,"DataAvail_FamPicker",choices=Fish_Fam_Filt_PopFields)
  
  Fish_Grp_Filt_PopFields<-intersect(FishData_TaxaChoices,GrpChoices)

  updatePickerInput(session,"GrpPicker",choices=Fish_Grp_Filt_PopFields)
  updatePickerInput(session,"DataAvail_GrpPicker",choices=Fish_Grp_Filt_PopFields)
  
  AngPrefData1<-left_join(Map_Filtered_Surveys_IDs(),AngPrefDataCompiled[,c("Survey_ID","Target_Taxa")],by='Survey_ID')
    
  AngPrefData_TaxaChoices<-sort(unique(as.character(AngPrefData1$Target_Taxa)))
  
  AngPref_Subs_Filt_PopFields<-intersect(AngPrefData_TaxaChoices,SubsChoices)

  updatePickerInput(session,"AngPref_SubsPicker",choices=AngPref_Subs_Filt_PopFields)
  
  AngPref_Spp_Filt_PopFields<-intersect(AngPrefData_TaxaChoices,SppChoices)

  updatePickerInput(session,"AngPref_SppPicker",choices=AngPref_Spp_Filt_PopFields)
  
  AngPref_Gen_Filt_PopFields<-intersect(AngPrefData_TaxaChoices,GenChoices)

  updatePickerInput(session,"AngPref_GenPicker",choices=AngPref_Gen_Filt_PopFields)
  
  AngPref_Fam_Filt_PopFields<-intersect(AngPrefData_TaxaChoices,FamChoices)

  updatePickerInput(session,"AngPref_FamPicker",choices=AngPref_Fam_Filt_PopFields)
  
  AngPref_Grp_Filt_PopFields<-intersect(AngPrefData_TaxaChoices,GrpChoices)

  updatePickerInput(session,"AngPref_GrpPicker",choices=AngPref_Grp_Filt_PopFields)

  },ignoreInit=TRUE)
    
    
    observeEvent(c(
    input$SelDataContents
    ),{

req(input$SelDataContents=="All")
      
 updatePickerInput(session,"SurveyPicker",choices=SurveyChoices)
  updatePickerInput(session,"WaterbodyPicker",choices=WaterbodyChoices)
  updatePickerInput(session,"FishMetricsPicker",choices=FishMetricChoices)
  updatePickerInput(session,"EffortPicker",choices=AnglerEffortChoices)
  updatePickerInput(session,"TargetMetricPicker",choices=TargetMetricChoices)
  updatePickerInput(session,"DemographicPicker",choices=DemoChoices)
  
  
  updatePickerInput(session,"SubsPicker",choices=SubsChoices)
  updatePickerInput(session,"SppPicker",choices=SppChoices)
  updatePickerInput(session,"GenPicker",choices=GenChoices)
  updatePickerInput(session,"FamPicker",choices=FamChoices)
  updatePickerInput(session,"GrpPicker",choices=GrpChoices)
  
  updatePickerInput(session,"AngPref_SubsPicker",choices=SubsChoices)
  updatePickerInput(session,"AngPref_SppPicker",choices=SppChoices)
  updatePickerInput(session,"AngPref_GenPicker",choices=GenChoices)
  updatePickerInput(session,"AngPref_FamPicker",choices=FamChoices)
  updatePickerInput(session,"AngPref_GrpPicker",choices=GrpChoices)

  },ignoreInit=TRUE)
 
#### Bind Into Compiled Data Full ####  

  CompiledData_Full_Filt<-reactive({
      CompiledData_Full_Filtered<-left_join(Filtered_Surveys_IDs(),CompiledData_Full_All,by='Survey_ID')
  })
  
  CompiledData_Full_Map<-reactive({
    CompiledData_Full_Mapped<-left_join(Map_Filtered_Surveys_IDs(),CompiledData_Full_All,by='Survey_ID')
  })
  
    CompiledData_Full<-reactive(
  if(is.null(input$SelDataContents)){
    CompiledData_Full_All
  }else if(input$SelDataContents=="All"){
    CompiledData_Full_All
  }else if(input$SelDataContents=="Map"){
   CompiledData_Full_Map()
  }else if (input$SelDataContents=="Filters"){
    CompiledData_Full_Filt()
  }   
  ) 

### Filter Unattributed Data ###
    
### Bind Into Compiled Data
  Filtered_CompiledData<-reactive({
    req(CompiledData_All())
    if(input$SelDataContents=="All"){
      CompiledData_All()%>%
        droplevels()%>%
        arrange(Waterbody_Name_Unique)%>%
        arrange(State)
    }else if(input$SelDataContents=="Map"){
      CompiledData_Map()%>%
        droplevels()%>%
        arrange(Waterbody_Name_Unique)%>%
        arrange(State)
    }else if (input$SelDataContents=="Filters"){
      CompiledData_Filt()%>%
        droplevels()%>%
        arrange(Waterbody_Name_Unique)%>%
        arrange(State)
    }
  })
  
  
    Compiled_SurveyWarnDrop<-reactive({
      req(Compiled_WarningData())

      NonCreel_Retained<-if(input$NonCreel_Compiled_Switch==TRUE){
        Compiled_WarningData()%>%
          filter(.,Survey_Type=="Creel Survey")%>%
          select(Survey_ID)
        }else{
            Compiled_WarningData()%>%
              select(Survey_ID)
        }

      Timing_Retained<-if(input$UnkTiming_Compiled_Switch==TRUE){
        Compiled_WarningData()%>%
          filter(.,!Timing_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Compiled_WarningData()%>%
              select(Survey_ID)
        }

      Location_Retained<-if(input$UnkLocation_Compiled_Switch==TRUE){
        Compiled_WarningData()%>%
          filter(.,!Location_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Compiled_WarningData()%>%
              select(Survey_ID)
        }

      Extent_Retained<-if(input$UnkExtent_Compiled_Switch==TRUE){
        Compiled_WarningData()%>%
          filter(.,!Extent_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Compiled_WarningData()%>%
              select(Survey_ID)
        }

      FocalTaxa_Retained<-if(input$FocSpecies_Compiled_Switch==TRUE){
        Compiled_WarningData()%>%
          filter(.,Focal_Species==c("All"))%>%
          select(Survey_ID)
        }else{
            Compiled_WarningData()%>%
              select(Survey_ID)
        }

     

        Compiled_Survey_Filt<-NonCreel_Retained%>%
          semi_join(.,Timing_Retained,by='Survey_ID')%>%
          semi_join(.,Location_Retained,by='Survey_ID')%>%
          semi_join(.,Extent_Retained,by='Survey_ID')%>%
          semi_join(.,FocalTaxa_Retained,by='Survey_ID')%>%
          droplevels()

    return(Compiled_Survey_Filt)

    })
    
    Compiled_TaxaWarnDrop<-reactive({
      req(Filtered_CompiledData())
     
      CompiledUnattributedSurveys_Retained<-if(is.null(Compiled_UnattributedFishTaxa())){
        Filtered_CompiledData()%>%
          select(Survey_ID)
      }else if(input$UnFish_Compiled_Switch==TRUE){
        Filtered_CompiledData()%>%
        anti_join(Compiled_UnattributedFishTaxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Filtered_CompiledData()%>%
          select(Survey_ID)
      }

      CompiledIncompleteSurveys_Retained<-if(is.null(Compiled_IncompleteAttributedFishTaxa())){
        Filtered_CompiledData()%>%
          select(Survey_ID)
      }else if(input$InFishGroup_Compiled_Switch==TRUE){
        Filtered_CompiledData()%>%
        anti_join(Compiled_IncompleteAttributedFishTaxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Filtered_CompiledData()%>%
          select(Survey_ID)
      }

      CompiledUnattributedTargetSurveys_Retained<-if(is.null(Compiled_UnattributedTarget_Taxa())){
        Filtered_CompiledData()%>%
          select(Survey_ID)
      }else if(input$UnTarget_Compiled_Switch==TRUE){
        Filtered_CompiledData()%>%
        anti_join(Compiled_UnattributedTarget_Taxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Filtered_CompiledData()%>%
          select(Survey_ID)
      }

      CompiledIncompleteTargetSurveys_Retained<-if(is.null(Compiled_IncompleteAttributedTarget_Taxa())){
        Filtered_CompiledData()%>%
          select(Survey_ID)
      }else if(input$InTargetGroup_Compiled_Switch==TRUE){
        Filtered_CompiledData()%>%
        anti_join(Compiled_IncompleteAttributedTarget_Taxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Filtered_CompiledData()%>%
          select(Survey_ID)
      }

        Compiled_Survey_Filt<-CompiledUnattributedSurveys_Retained%>%
          semi_join(.,CompiledIncompleteSurveys_Retained,by='Survey_ID')%>%
          semi_join(.,CompiledUnattributedTargetSurveys_Retained,by='Survey_ID')%>%
          semi_join(.,CompiledIncompleteTargetSurveys_Retained,by='Survey_ID')%>%
          droplevels()

    return(Compiled_Survey_Filt)
    })  
   
CompiledData<-reactive({
  req(Filtered_CompiledData())
  req(Compiled_SurveyWarnDrop())
  req(Compiled_TaxaWarnDrop())
  
  Filtered_CompiledData()%>%
    semi_join(.,Compiled_SurveyWarnDrop(),by='Survey_ID')%>%
    semi_join(.,Compiled_TaxaWarnDrop(),by='Survey_ID')%>%
    droplevels()
  
})
  

  
 
#### View and Filter Data Server Info ####
  
   output$Compiled_DT<-DT::renderDataTable(
    CompiledData(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Compiled_DT table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Compiled_DT table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
  

  
  
  
  #### Compiled Data Warnings ####
    
  Compiled_WarningData<-reactive({Filtered_CompiledData()%>%select(Survey_ID)%>%left_join(Survey_Data)})


# Duration #
  Compiled_DurationDifference<-reactive({
    req(Compiled_WarningData())
    PH<-max(Compiled_WarningData()$Duration,na.rm=TRUE)-min(Compiled_WarningData()$Duration,na.rm=TRUE)
    })
  
  Compiled_DurationDifferenceMin<-reactive({
    req(Compiled_WarningData())
    PH<-min(Compiled_WarningData()$Duration,na.rm=TRUE)
    })
  
  Compiled_DurationDifferenceMax<-reactive({req(Compiled_WarningData())
    PH<-max(Compiled_WarningData()$Duration,na.rm=TRUE)
    })
  
  output$Compiled_DurationWarning<-renderText({
    if(Compiled_DurationDifference()>0){
      return(paste(as.character(actionLink(inputId = "Compiled_DurationWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">The difference in duration of input surveys is </span><span style=\"color:red;font-weight:bold\">", Compiled_DurationDifference(),"</span><span style=\"color:black\"> days: </span><span style=\"color:red;font-weight:bold\">",Compiled_DurationDifferenceMin(),"to",Compiled_DurationDifferenceMax()," days</span>"))
  }else if(Compiled_DurationDifference()==0){
    return(paste(as.character(actionLink(inputId = "Compiled_DurationWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys have the same duration:</span><span style=\"color:green;font-weight:bold\">",Compiled_DurationDifferenceMin(),"</span><span style=\"color:black\"> days</span>"))
  } else {
      
    }
  })
  
  observeEvent(input$Compiled_DurationWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Duration Warning"),
            h4(strong("Surveys span a range of durations: ")),
            h4("Creel surveys may be conducted for differing lengths of time. Expansions are typically calculated to generate estimates for the surveyed period. 
               Because of this care should be taken when comparing surveys with differences in duration."),
            h4(strong("Recommendation: "), "Select surveys with similar durations to minimize the impacts of comparing longer and shorter surveys."),
            h4(strong("Recommendation: "), "Select duration indepedent rate based metrics if surveys spanning a wide range of durations are to be used. Examples include 
               percentages of various metrics, or 'Per Day' estimates (Such as Harvest per Day)"),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
# Start and End Dates  
  Compiled_StartDifferenceMin<-reactive({req(Compiled_WarningData())
    PH<-month.name[min(as.numeric(format(Compiled_WarningData()$Start_Date, '%m')),na.rm=TRUE)]})
  Compiled_StartDifferenceMax<-reactive({req(Compiled_WarningData())
    PH<-month.name[max(as.numeric(format(Compiled_WarningData()$Start_Date, '%m')),na.rm=TRUE)]})
  Compiled_EndDifferenceMin<-reactive({req(Compiled_WarningData())
    PH<-month.name[min(as.numeric(format(Compiled_WarningData()$End_Date, '%m')),na.rm=TRUE)]})
  Compiled_EndDifferenceMax<-reactive({req(Compiled_WarningData())
    PH<-month.name[max(as.numeric(format(Compiled_WarningData()$End_Date, '%m')),na.rm=TRUE)]})
  
  output$Compiled_StartWarning<-renderText({
    if(Compiled_StartDifferenceMin()==Compiled_StartDifferenceMax()){
      return(paste(as.character(actionLink(inputId = "Compiled_StartWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All surveys begin in </span><span style=\"color:green;font-weight:bold\">", Compiled_StartDifferenceMin(),"</span>"))
  }else {
    return(paste(as.character(actionLink(inputId = "Compiled_StartWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Start dates for input surveys range from </span><span style=\"color:red;font-weight:bold\">",Compiled_StartDifferenceMin(), "</span><span style=\"color:black\"> to </span><span style=\"color:red;font-weight:bold\">", Compiled_StartDifferenceMax(), "</span>"))
  }
  })
  
    output$Compiled_EndWarning<-renderText({
    if(Compiled_EndDifferenceMin()==Compiled_EndDifferenceMax()){
      return(paste(as.character(actionLink(inputId = "Compiled_EndWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All surveys conclude in </span><span style=\"color:green;font-weight:bold\">", Compiled_EndDifferenceMin(),".</span>"))
  }else {
    return(paste(as.character(actionLink(inputId = "Compiled_EndWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Conclusion dates for input surveys range from </span><span style=\"color:red;font-weight:bold\">",Compiled_EndDifferenceMin(), "</span><span style=\"color:black\"> to </span><span style=\"color:red;font-weight:bold\">", Compiled_EndDifferenceMax(), "</span>"))
  }
  }) 
    

  
  observeEvent(input$Compiled_StartWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may cover different periods of the year: ")),
            h4("Creel surveys may be conducted across a variety of time periods. Attention should be paid to the start and end dates of surveys (as well as duration) 
               in order to make sure selected surveys are valid for user defined applications. For example some surveys may cover the winter angling, while others may cover spring/summer, 
               while others still may generate annual estimates (or nearly)."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those matching desired time periods based on 'Start' and 'End' months and Duration."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Compiled_EndWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may cover different periods of the year: ")),
            h4("Creel surveys may be conducted across a variety of time periods. Attention should be paid to the start and end dates of surveys (as well as duration) 
               in order to make sure selected surveys are valid for user defined applications. For example some surveys may cover the winter angling, while others may cover spring/summer, 
               while others still may generate annual estimates (or nearly)."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those matching desired time periods based on 'Start' and 'End' months and Duration."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  
    
# Survey Gaps #
    
    Compiled_Survey_GapsWarn_Max<-reactive({req(Compiled_WarningData())
      max(Compiled_WarningData()$Lost_Duration,na.rm=TRUE)
      })
    
    output$Compiled_Survey_GapsWarning<-renderText({
    if (Compiled_Survey_GapsWarn_Max()>0){
      return(paste(as.character(actionLink(inputId = "Compiled_Survey_GapsWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include those with gaps in the survey period. Maximum gap of: </span><span style=\"color:red;font-weight:bold\">", Compiled_Survey_GapsWarn_Max(),"</span><span style=\"color:black\"> days.</span>"))
      } else {
    }
  })
    
  observeEvent(input$Compiled_Survey_GapsWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Gap Warning"),
            h4(strong("Surveys may occasionally have a period of time between the start and end date when surveys (and associated expansions) do not occur: ")),
            h4("Creel surveys sometimes have periods of time for which the survey is suspended, often due to staffing issues. When documented we record both the lost duration 
               and months for which the survey was not taking place. This 'Lost Duration' is then substracted from the overall duration (End Date-Start Date) in order to provide an accurately 
               populate the 'Duration' field to reflect the number of days represented in survey estimates."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

# Survey Type #
    Compiled_Survey_TypeWarn_Dat<-reactive({req(Compiled_WarningData())
      as.list(as.character(unique(Compiled_WarningData()$Survey_Type)))
      })
    
    Compiled_Survey_TypeWarn_Vals<-reactive({req(Compiled_Survey_TypeWarn_Dat())
      paste(Compiled_Survey_TypeWarn_Dat(),collapse=" & ")
      })
    
    Compiled_Survey_TypeWarn_Vals_3<-reactive({req(Compiled_Survey_TypeWarn_Dat())
      paste(Compiled_Survey_TypeWarn_Dat()[1:3],collapse=" & ")
      })
    
    Compiled_Survey_TypeWarn_Count<-reactive({req(Compiled_Survey_TypeWarn_Dat())
      paste(length(Compiled_Survey_TypeWarn_Dat()),"Types;")
      })
    
  output$Compiled_Survey_TypeWarning<-renderText({
    if(length(Compiled_Survey_TypeWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Compiled_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys are of the same type: </span><span style=\"color:green;font-weight:bold\">", Compiled_Survey_TypeWarn_Dat(),"</span>"))
  }else if (length(Compiled_Survey_TypeWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Compiled_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple types: </span><span style=\"color:red;font-weight:bold\">", Compiled_Survey_TypeWarn_Count(),Compiled_Survey_TypeWarn_Vals_3(),as.character(actionLink(inputId = "Compiled_Survey_TypeWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Compiled_Survey_TypeWarn_Dat())<4&&length(Compiled_Survey_TypeWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Compiled_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple types: </span><span style=\"color:red;font-weight:bold\">", Compiled_Survey_TypeWarn_Count(), Compiled_Survey_TypeWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Compiled_Survey_TypeWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Survey Methods"),
            HTML(paste(Compiled_Survey_TypeWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Compiled_Survey_TypeWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Types Warning"),
            h4(strong("Surveys may include multiple type classifications: ")),
            h4("While most of the surveys contained in CreelCat are creel surveys (angler interviews and counts conducted on-site) we also included other types of angler 
            surveys to provide a more complete picture of angler data, particularly for areas where traditional creel surveys are not conducted. Many (although not all) of the other survey 
               approaches included in CreelCat are Mail/Phone/Online surveys where licensed anglers responses are solicited from anglers about there activities remotely."),
            h4("Consideration should be given as to how the different survey methods may impact any inferences drawn from comparisons which include multiple survey types."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
    
# Interview Methods #
    Compiled_Interview_MethodWarn_Dat<-reactive({req(Compiled_WarningData())
      as.list(as.character(unique(Compiled_WarningData()$Interview_Method)))
      })
    Compiled_Interview_MethodWarn_Vals<-reactive({req(Compiled_Interview_MethodWarn_Dat())
      paste(Compiled_Interview_MethodWarn_Dat(),collapse=" & ")
      })
    
    Compiled_Interview_MethodWarn_Vals_3<-reactive({req(Compiled_Interview_MethodWarn_Dat())
      paste(Compiled_Interview_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Compiled_Interview_MethodWarn_Interview<-reactive({req(Compiled_Interview_MethodWarn_Dat())
      paste(length(Compiled_Interview_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Compiled_Interview_MethodWarning<-renderText({
    if(length(Compiled_Interview_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Compiled_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same interview method: </span><span style=\"color:green;font-weight:bold\">", Compiled_Interview_MethodWarn_Dat(),"</span>"))
  }else if (length(Compiled_Interview_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Compiled_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple interview methods: </span><span style=\"color:red;font-weight:bold\">", Compiled_Interview_MethodWarn_Interview(),Compiled_Interview_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Compiled_Interview_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Compiled_Interview_MethodWarn_Dat())<4&&length(Compiled_Interview_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Compiled_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple interview methods: </span><span style=\"color:red;font-weight:bold\">", Compiled_Interview_MethodWarn_Interview(), Compiled_Interview_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Compiled_Interview_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Interview Methods"),
            HTML(paste(Compiled_Interview_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Compiled_Interview_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Interview Methods Warning"),
            h4(strong("Surveys may include multiple interview methodologies: ")),
            h4("Creel surveys can employ a variety of methods for interviewing anglers. This warning identifies the various interview methodology classifications 
               associated with your selected inputs."),
            h4("While differences in methods for conducting angler interviews is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Count Methods #
    Compiled_Count_MethodWarn_Dat<-reactive({req(Compiled_WarningData())
      as.list(as.character(unique(Compiled_WarningData()$Count_Method)))
      })
    Compiled_Count_MethodWarn_Vals<-reactive({req(Compiled_Count_MethodWarn_Dat())
      paste(Compiled_Count_MethodWarn_Dat(),collapse=" & ")
      })
    
    Compiled_Count_MethodWarn_Vals_3<-reactive({req(Compiled_Count_MethodWarn_Dat())
      paste(Compiled_Count_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Compiled_Count_MethodWarn_Count<-reactive({req(Compiled_Count_MethodWarn_Dat())
      paste(length(Compiled_Count_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Compiled_Count_MethodWarning<-renderText({
    if(length(Compiled_Count_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Compiled_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same count method: </span><span style=\"color:green;font-weight:bold\">", Compiled_Count_MethodWarn_Dat(),"</span>"))
  }else if (length(Compiled_Count_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Compiled_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple count methods: </span><span style=\"color:red;font-weight:bold\">", Compiled_Count_MethodWarn_Count(),Compiled_Count_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Compiled_Count_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Compiled_Count_MethodWarn_Dat())<4&&length(Compiled_Count_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Compiled_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple count methods: </span><span style=\"color:red;font-weight:bold\">", Compiled_Count_MethodWarn_Count(), Compiled_Count_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Compiled_Count_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Count Methods"),
            HTML(paste(Compiled_Count_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Compiled_Count_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Count Methods Warning"),
            h4(strong("Surveys may include multiple count methodologies: ")),
            h4("Creel surveys can employ a variety of methods for counting the number of anglers. This warning identifies the various count methodology classifications 
               associated with your selected inputs."),
            h4("While differences in methods for conducting angler counts is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  

    
    
# Estimate Methods #
    Compiled_Estimate_MethodWarn_Dat<-reactive({req(Compiled_WarningData())
      as.list(as.character(unique(Compiled_WarningData()$Estimate_Method)))
      })
    Compiled_Estimate_MethodWarn_Vals<-reactive({req(Compiled_Estimate_MethodWarn_Dat())
      paste(Compiled_Estimate_MethodWarn_Dat(),collapse=" & ")
      })
    
    Compiled_Estimate_MethodWarn_Vals_3<-reactive({req(Compiled_Estimate_MethodWarn_Dat())
      paste(Compiled_Estimate_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Compiled_Estimate_MethodWarn_Estimate<-reactive({req(Compiled_Estimate_MethodWarn_Dat())
      paste(length(Compiled_Estimate_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Compiled_Estimate_MethodWarning<-renderText({
    if(length(Compiled_Estimate_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Compiled_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same method for generating estimates: </span><span style=\"color:green;font-weight:bold\">", Compiled_Estimate_MethodWarn_Dat(),"</span>"))
  }else if (length(Compiled_Estimate_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Compiled_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple methods for generating estimates: </span><span style=\"color:red;font-weight:bold\">", Compiled_Estimate_MethodWarn_Estimate(),Compiled_Estimate_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Compiled_Estimate_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Compiled_Estimate_MethodWarn_Dat())<4&&length(Compiled_Estimate_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Compiled_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple methods for generating estimates: </span><span style=\"color:red;font-weight:bold\">", Compiled_Estimate_MethodWarn_Estimate(), Compiled_Estimate_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Compiled_Estimate_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Estimate Methods"),
            HTML(paste(Compiled_Estimate_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Compiled_Estimate_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Estimate Methods Warning"),
            h4(strong("Surveys may include multiple estimate methodologies: ")),
            h4("Creel surveys can employ a variety of methods for generating estimates. This warning identifies the various estimate methodology classifications 
               associated with your selected input surveys."),
            h4("While differences in methods for generating estimates is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    

# Focal Species #
    Compiled_Focal_SpeciesWarn_Dat<-reactive({req(Compiled_WarningData())
      as.list(as.character(unique(Compiled_WarningData()$Focal_Species)))
      })
    Compiled_Focal_SpeciesWarn_Vals<-reactive({req(Compiled_Focal_SpeciesWarn_Dat())
      paste(Compiled_Focal_SpeciesWarn_Dat(),collapse=" & ")
      })
    
    Compiled_Focal_SpeciesWarn_Vals_3<-reactive({req(Compiled_Focal_SpeciesWarn_Dat())
      paste(Compiled_Focal_SpeciesWarn_Dat()[1:3],collapse=" & ")
      })
    
    Compiled_Focal_SpeciesWarn_Estimate<-reactive({req(Compiled_Focal_SpeciesWarn_Dat())
      paste(length(Compiled_Focal_SpeciesWarn_Dat()),"Classes;")
      })
    
    
  output$Compiled_Focal_SpeciesWarning<-renderText({
    if(length(Compiled_Focal_SpeciesWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Compiled_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys have the same classification for 'Focal Species': </span><span style=\"color:green;font-weight:bold\">", Compiled_Focal_SpeciesWarn_Dat(),"</span>"))
  }else if (length(Compiled_Focal_SpeciesWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Compiled_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys have multiple classifications for 'Focal Species': </span><span style=\"color:red;font-weight:bold\">", Compiled_Focal_SpeciesWarn_Estimate(),Compiled_Focal_SpeciesWarn_Vals_3(),as.character(actionLink(inputId = "Compiled_Focal_SpeciesWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Compiled_Focal_SpeciesWarn_Dat())<4&&length(Compiled_Focal_SpeciesWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Compiled_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys have multiple classifications for 'Focal Species': </span><span style=\"color:red;font-weight:bold\">", Compiled_Focal_SpeciesWarn_Estimate(), Compiled_Focal_SpeciesWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Compiled_Focal_SpeciesWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Focal Species Classifications"),
            HTML(paste(Compiled_Focal_SpeciesWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Compiled_Focal_SpeciesWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Focal Species Warning"),
            h4(strong("Surveys may include multiple classifications for focal species: ")),
            h4("Creel surveys typically assess the full range of species captured/targetted by anglers, however sometimes creel surveys may only consider certain focal species without consideration of others. This warning identifies what classifications of focal species are included within the pool of selected surveys."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those including those species you are analyzing. This can mean including only surveys focused on 'All' taxa, or if you are interested in a specific taxa only including surveys listed as either 'All' or your taxa of interest. You may use the button below in the warning panel to drop surveys which are not inclusive of 'All' taxa."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

# Waterbody Type #
    Compiled_WB_TypeWarn_Dat<-reactive({req(Compiled_WarningData())
      as.list(as.character(unique(Compiled_WarningData()$WB_Type)))
      })
    Compiled_WB_TypeWarn_Vals<-reactive({req(Compiled_WB_TypeWarn_Dat())
      paste(Compiled_WB_TypeWarn_Dat(),collapse=" & ")
      })
    
    Compiled_WB_TypeWarn_Vals_3<-reactive({req(Compiled_WB_TypeWarn_Dat())
      paste(Compiled_WB_TypeWarn_Dat()[1:3],collapse=" & ")
      })
    
    Compiled_WB_TypeWarn_Estimate<-reactive({req(Compiled_WB_TypeWarn_Dat())
      paste(length(Compiled_WB_TypeWarn_Dat()),"Classes;")
      })
    
    
  output$Compiled_WB_TypeWarning<-renderText({
    if(length(Compiled_WB_TypeWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Compiled_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys are of the same waterbody type classification: </span><span style=\"color:green;font-weight:bold\">", Compiled_WB_TypeWarn_Dat(),"</span>"))
  }else if (length(Compiled_WB_TypeWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Compiled_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys span multiple waterbody type classifications: </span><span style=\"color:red;font-weight:bold\">", Compiled_WB_TypeWarn_Estimate(),Compiled_WB_TypeWarn_Vals_3(),as.character(actionLink(inputId = "Compiled_WB_TypeWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Compiled_WB_TypeWarn_Dat())<4&&length(Compiled_WB_TypeWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Compiled_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys span multiple waterbody type classifications: </span><span style=\"color:red;font-weight:bold\">", Compiled_WB_TypeWarn_Estimate(), Compiled_WB_TypeWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Compiled_WB_TypeWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Waterbody Type Classifications"),
            HTML(paste(Compiled_WB_TypeWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Compiled_WB_TypeWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Waterbody Type Warning"),
            h4(strong("Surveys may include multiple classifications for waterbody type: ")),
            h4("Creel surveys contained in CreelCat come from freshwater systems across the United States. We have done our best to classify waterbody types as either 'Lakes, Reservoirs, Ponds, and Tailraces' or 'Streams and Rivers'. This warning identifies what classifications of waterbody types exist within your selection of surveys."),
            h4("There is nothing necessarily problematic about including both types within an analysis, however users should be aware of the presence of both waterbody types when using the dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Flagged Warning Heading #
  output$Compiled_FlaggedHeading<-renderText({
    if(Compiled_Timing_WarnWarn_Count()>0||
       Compiled_Location_WarnWarn_Count()>0||
       Compiled_Extent_WarnWarn_Count()>0
       ){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Flagged Survey Issues: </span></h4>"))
  }else {

  }
  }) 
  
# Timing Uncertain #
    
    Compiled_Timing_WarnWarn_Count<-reactive({req(Compiled_WarningData())
      PH<-Compiled_WarningData()%>%
        filter(., Timing_Warn=="Unknown"|Timing_Warn=="Uncertain")
     
       return(count(PH))
      
      })
    
    output$Compiled_Timing_WarnWarning<-renderText({
    if(Compiled_Timing_WarnWarn_Count()==0){

  }else if (Compiled_Timing_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Compiled_Timing_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
             "<span style=\"color:black\">Input surveys include those with survey timing uncertainties: </span><span style=\"color:red;font-weight:bold\">", Compiled_Timing_WarnWarn_Count(),"Surveys</span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Compiled_Timing_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may be missing critical information regarding the timing of the survey: ")),
            h4("Creel surveys included in CreelCat typically include both start and end dates which allows users to determine when the survey took place and how long it lasted. Surveys which are missing start and/or end dates have been flagged as either uncertain or unknown."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that ris sensitive to the timing or duration of input surveys, surveys flagged as having unknown or uncertain timing should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Location Uncertain #
  
      Compiled_Location_WarnWarn_Count<-reactive({req(Compiled_WarningData())
      PH<-Compiled_WarningData()%>%
        filter(., Location_Warn=="Unknown"|Location_Warn=="Uncertain")
      
      return(count(PH))
      
      })
    
    output$Compiled_Location_WarnWarning<-renderText({
    if(Compiled_Location_WarnWarn_Count()==0){

  }else if (Compiled_Location_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Compiled_Location_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include those with survey location uncertainties: </span><span style=\"color:red;font-weight:bold\">", Compiled_Location_WarnWarn_Count(),"Surveys </span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Compiled_Location_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Location Warning"),
            h4(strong("Surveys may be missing critical information regarding the location of the survey: ")),
            h4("Creel surveys included in CreelCat typically identify the location of the waterbody being surveyed. Surveys which are missing the information needed to generate the location of the survey have been flagged as either uncertain (location assigned according to our best judgement despite lack of required documentation) or unknown (no location assigned for a given survey)."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that is sensitive to the location of input surveys or requires any spatial information, surveys flagged as having unknown or uncertain locations should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    

    
# Extent Warning #
  
      Compiled_Extent_WarnWarn_Count<-reactive({req(Compiled_WarningData())
      PH<-Compiled_WarningData()%>%
        filter(., Extent_Warn=="Unknown"|Extent_Warn=="Uncertain")
      return(count(PH))
      })
    
    output$Compiled_Extent_WarnWarning<-renderText({
    if(Compiled_Extent_WarnWarn_Count()==0){

  }else if (Compiled_Extent_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Compiled_Extent_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include those with survey extent uncertainties: </span><span style=\"color:red;font-weight:bold\">", Compiled_Extent_WarnWarn_Count(),"Surveys </span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Compiled_Extent_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Extent Warning"),
            h4(strong("Surveys may be missing critical information regarding the extent of the survey: ")),
            h4("Creel surveys included in CreelCat typically identify the extent of the waterbody being surveyed. Surveys which are missing the information needed to generate the extent of the survey have been flagged as either uncertain (extent assigned according to our best judgement despite lack of required documentation) or unknown (no extent assigned for a given survey)."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that is sensitive to the extent of input surveys or requires any spatial information, surveys flagged as having unknown or uncertain extents should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)    

    
  
### Warning Tables ###
  
  
    Compiled_WarningTBL_SurveyChar<-reactive({
      req(Compiled_WarningData())
      Compiled_WarningData()%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Duration','Survey_Gaps','Lost_Duration','Survey_Type','Interview_Method','Count_Method','Estimate_Method','Location_Warn','Extent_Warn','Timing_Warn')%>%
        droplevels()
      })   
  
   
   output$Compiled_WarnTBL_SurveyChar<-DT::renderDataTable(
    Compiled_WarningTBL_SurveyChar(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )   
   

    Compiled_WarningTBL_Non_Creel<-reactive({
      req(Compiled_WarningData())
      Compiled_WarningData()%>%
        filter(Survey_Type!='Creel Survey')%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Survey_Type')%>%
        droplevels()
      })   
   
   output$Compiled_WarnTBL_Non_Creel<-DT::renderDataTable(
    Compiled_WarningTBL_Non_Creel(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )   
   

    Compiled_WarningTBL_Timing<-reactive({
      req(Compiled_WarningData())
      Compiled_WarningData()%>%
        filter(Timing_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Timing_Warn')%>%
        droplevels()
      })

   output$Compiled_WarnTBL_Timing<-DT::renderDataTable(
    Compiled_WarningTBL_Timing(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Compiled_WarningTBL_Location<-reactive({
      req(Compiled_WarningData())
      Compiled_WarningData()%>%
        filter(Location_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Location_Warn')%>%
        droplevels()
      })

   output$Compiled_WarnTBL_Location<-DT::renderDataTable(
    Compiled_WarningTBL_Location(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Compiled_WarningTBL_Extent<-reactive({
      req(Compiled_WarningData())
      Compiled_WarningData()%>%
        filter(Extent_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Extent_Warn')%>%
        droplevels()
      })

   output$Compiled_WarnTBL_Extent<-DT::renderDataTable(
    Compiled_WarningTBL_Extent(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Compiled_WarningTBL_FocalSpecies<-reactive({
      req(Compiled_WarningData())
      Compiled_WarningData()%>%
        filter(Focal_Species!='All')%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Focal_Species')%>%
        droplevels()
      })

   output$Compiled_WarnTBL_FocalSpecies<-DT::renderDataTable(
    Compiled_WarningTBL_FocalSpecies(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

### Fish Taxa Warnings ##
    Compiled_UnattributedFishTaxa<-reactive({
     if(length(TaxaPick())>0){
       return(
         Filtered_CompiledData()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(UnattributedTaxa)%>%
       filter(Taxa%in%TaxaPick())%>%
       select(!(UnattributedTaxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })

  Compiled_PartiallyAttributedFishTaxa<-reactive({
      if(length(TaxaPick())>0){
       return(
         Filtered_CompiledData()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(PartiallyAttributedTaxa)%>%
       filter(Taxa%in%TaxaPick())%>%
       select(!(PartiallyAttributedTaxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })

   Compiled_IncompleteAttributedFishTaxa<-reactive({
      if(length(TaxaPick())>0){
       return(
         Filtered_CompiledData()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(IncompleteAttributedTaxa)%>%
       filter(Taxa%in%TaxaPick())%>%
       select(!(Incomplete_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })

       Compiled_UnattributedTarget_Taxa<-reactive({
     if(length(AngPref_TaxaPick())>0){
       return(
         Filtered_CompiledData()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(UnattributedTarget_Taxa)%>%
       filter(Taxa%in%AngPref_TaxaPick())%>%
       select(!(UnattributedTarget_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })

  Compiled_PartiallyAttributedTarget_Taxa<-reactive({
      if(length(AngPref_TaxaPick())>0){
       return(
         Filtered_CompiledData()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(PartiallyAttributedTarget_Taxa)%>%
       filter(Taxa%in%AngPref_TaxaPick())%>%
       select(!(PartiallyAttributedTarget_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })

   Compiled_IncompleteAttributedTarget_Taxa<-reactive({
      if(length(AngPref_TaxaPick())>0){
       return(
         Filtered_CompiledData()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(IncompleteAttributedTarget_Taxa)%>%
       filter(Taxa%in%AngPref_TaxaPick())%>%
       select(!(Incomplete_Target_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
   
      output$Compiled_Survey_Char_Drop<-renderText({
        return(paste(as.character(actionLink(inputId = "CompiledSurveyDropCharacteristicsTip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black;font-weight:bold\">Survey Characteristic Drops </span>"))
      })
      
      output$Compiled_Taxa_Atr_Drop<-renderText({
        return(paste(as.character(actionLink(inputId = "CompiledTaxaAttributionDropTip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black;font-weight:bold\">Taxa Attribution Issue Drops </span>"))
      })

    Compiled_Retained_Surveys<-reactive({
      CompiledData()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
    })

   Compiled_Retained_All_Warn_Surveys_Count<-reactive({
     nrow(CompiledData())
     })

    Compiled_Dropped_Surveys<-reactive({
      Filtered_CompiledData()%>%anti_join(CompiledData(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))%>%
        unique()
    })

   Compiled_Dropped_All_Warn_Surveys_Count<-reactive({
     nrow(Compiled_Dropped_Surveys())
     })
   
   output$Compiled_Dropped_All_Warning<-renderText({
    if(nrow(Compiled_Dropped_Surveys())>0){
      return(paste(as.character(actionLink(inputId = "Compiled_Dropped_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Surveys containing user-selected drop characteristics have been dropped. </span><span style=\"color:red;font-weight:bold\">", Compiled_Dropped_All_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been dropped;</><span style=\"color:green;font-weight:bold\">",Compiled_Retained_All_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been retained</>"))
  }else {
  } 
  })

  observeEvent(input$Compiled_Dropped_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Dropped Surveys"),
            h4(strong("User may drop surveys from the datatable by applying the drop criteria from the warning menu: ")),
            h4("Surveys sometimes contain undesireable attributes or contain input taxa with attribution issues which lead to the user to drop them from the visualizations by switching the toggles."),
            h4("This warning reports the total number of surveys which were selected to be included in the table as well as the number of surveys which have been dropped either due to undesireable survey characteristics, or the presence of taxa attribution issues."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)   
  
  observeEvent(input$CompiledSurveyDropCharacteristicsTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Drop Based on Survey Characteristics"),
            h4(strong("Undesireable Survey Characteristics: ")),
            h4("Surveys occasionally contain undesireable characteristics which may result in a user wishing to exclude/drop them from thier visualizations."),
            h4("By toggling the switches in this section users can decide whether they wish to retain or drop surveys with the following characteristcis."),
            h4(strong("Non-Creel Approaches: "), "Drops surveys which are not classified as 'Creel Survey'. These typically include things like Mail/Phone/Internet Surveys."),
            h4(strong("Unknown/Uncertain Timing: "), "Drops surveys for which are missing start and/or end dates"),
            h4(strong("Unknown/Uncertain Location: "), "Drops surveys for which the location of the waterbody being surveyed can not be confirmed."),
            h4(strong("Unknown/Uncertain Spatial Extent: "), "Drops surveys for which the spatial extent of a survey can not be confirmed."),
            h4(strong("Focal Species: "), "Drops surveys which focus on only a single or group of taxa rather than the entire community."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$CompiledTaxaAttributionDropTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),title = strong("Drop Based on Taxa Attribution Issues"),
            h4(strong("Taxa attribution issues: ")),
            h4("Surveys occasionally contain issues with the attribution of values to taxa."),
            h4("By toggling the switches in this section users can decide whether they wish to retain or drop surveys with the following characteristics."),
            h4(strong("Unattributed Input Fish Taxa: "), "Drops surveys for which one of the visualization inputs contains a fish taxa which cannot be attributed 
               (see tip at unattributed taxa warning in the warning panel for more details). Note: For visualizations wholly unattributed taxa are 'Null' so they 
               are dropped automatically, however partially attributed data are contain both attributed values and potentially unattributed values and therefore require 
               toggling of this switch to drop in order to remove."),
            h4(strong("Incomplete Input Fish Groups: "), "Drops surveys for which one of the visualization inputs contains a fish groups which have incomplete attribution 
               (see tip at incomplete group warning in the warning panel for more details)."),
            h4(strong("Unattributed Input Target Taxa: "), "Drops surveys for which one of the visualization inputs contains a target taxa which cannot be attributed 
               (see tip at unattributed target taxa warning in the warning panel for more details). Note: For visualizations wholly unattributed target taxa are 'Null' so they 
               are dropped automatically, however partially attributed data are contain both attributed values and potentially unattributed values and therefore require 
               toggling of this switch to drop in order to remove."),
            h4(strong("Incomplete Input Target Groups: "), "Drops surveys for which one of the visualization inputs contains a target groups which have incomplete attribution 
               (see tip at incomplete group warning in the warning panel for more details)."),
        easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$CompiledWarningTableTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("View Warning Tables"),
            h4(strong("Select whether you wish to view tables which summarize any of the listed warning attributes: ")),
            h4(strong("Retained Surveys: "), "Table showing surveys which were retained after surveys which contained 'NA' in at least one visualization input or contained undesireable survey characteristics or input taxa attribution issues were dropped."),
            h4(strong("Dropped Surveys: "), "Table showing surveys which were dropped due to the presence of an 'NA' in at least one visualization input or undesireable survey characteristics or taxa attribution issues."),
            h4(strong("Retained NA Surveys: "), "Table showing surveys which were retained after surveys which contained 'NA' in at least one visualization input were dropped."),
            h4(strong("Dropped NA Surveys: "), "Table showing surveys which were dropped due to the presence of an 'NA' in at least one visualization input."),
            h4(strong("Non-Creel Approaches: "), "Table showing surveys which used any approach not classified as a 'Creel Survey'."),
            h4(strong("Unknown/Uncertain Timing: "), "Table showing surveys which were flagged ashaving unknown or uncertain timing."),
            h4(strong("Unknown/Uncertain Location: "), "Table showing surveys which were flagged ashaving unknown or uncertain locations."),
            h4(strong("Unknown/Uncertain Spatial Extent: "), "Table showing surveys which were flagged ashaving unknown or uncertain spatial extents."),
            h4(strong("Focal Species: "), "Table showing surveys which were conducted based on a focal species rather than the full community."),
            h4(strong("Unattributed Taxa: "), "Table showing records containing unattributed input taxa."),
            h4(strong("Partially Attributed Taxa: "), "Table showing records containing partially attributed input taxa."),
            h4(strong("Incomplete Groups: "), "Table showing records containing incomplete attribution of input groups."),
            h4(strong("Unattributed Target Taxa: "), "Table showing records containing unattributed input target taxa."),
            h4(strong("Partially Attributed Target Taxa: "), "Table showing records containing partially attributed input target taxa."),
            h4(strong("Incomplete Target Groups: "), "Table showing records containing incomplete attribution of input target groups."),
        easyClose = TRUE
        ))
    },ignoreInit=TRUE)
     
   
   output$Compiled_Dropped_All_TBL<-DT::renderDataTable(
    Compiled_Dropped_Surveys(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

  output$Compiled_Retained_All_TBL<-DT::renderDataTable(
    Compiled_Retained_Surveys(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
  

  ################################## Working Here ############################

  
   output$Compiled_FishTaxaHeading<-renderText({
    if((length(CompiledUnattributedTaxa_Warn_Taxa())>0)||
       (length(CompiledIncompleteAttributedTaxa_Warn_Taxa())>0)||
       (nchar(Compiled_Overlap_Warn())>1)){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Fish Taxa Input Attribution Issues: </span></h4>"))
  }else {

  }
  })  
   
   output$Compiled_AngPrefTaxaHeading<-renderText({
    if((length(CompiledUnattributedTarget_Taxa_Warn_Taxa())>0)||
       (length(CompiledIncompleteAttributedTarget_Taxa_Warn_Taxa())>0)||
       (nchar(TargetCompiled_Overlap_Warn())>1)
       ){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Angler Preference Taxa Input Attribution Issues: </span></h4>"))
  }else {

  }
  })  
   
  CompiledUnattributedTaxa_Count<-reactive({
    if(is.null(Compiled_UnattributedFishTaxa())){
      return(NULL)
    }else{
     Compiled_UnattributedFishTaxa()%>%
     count(Taxa)%>%
     unite(Unattributed_Records,"Taxa","n",sep="-")
    }
     })

   CompiledUnattributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(CompiledUnattributedTaxa_Count()$Unattributed_Records))
     })
   
   CompiledUnattributedTaxa_Warn_Vals<-reactive({
     paste(CompiledUnattributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Compiled_UnattributedFishTaxaWarning<-renderText({
    if(length(CompiledUnattributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Compiled_Unattributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include unattributed taxa: </span><span style=\"color:red;font-weight:bold\">", CompiledUnattributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })

  
  observeEvent(input$Compiled_Unattributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unattributed Fish Taxa"),
            h4(strong("Selected surveys contain unattributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The list identifies which taxa have unattributed records in the dataset and how 
               many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


   output$Compiled_UnattributedTBL_Pop<-reactive({
      length(CompiledUnattributedTaxa_Warn_Taxa())
      })
   
    outputOptions(output,'Compiled_UnattributedTBL_Pop',suspendWhenHidden=FALSE)

   output$Compiled_UnattributedFishTaxa_TBL<-DT::renderDataTable(
    Compiled_UnattributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Attributed Taxa Suggestions ###
    Compiled_Attributed_Gain<-reactive({
    if(is.null(Compiled_UnattributedFishTaxa())){return(NULL)}else{
     Compiled_UnattributedFishTaxa()%>%
     count(Attributed_Taxa)%>%
     unite(GainedRecords,"Attributed_Taxa","n",sep="-")
    }
     })

   CompiledAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Compiled_Attributed_Gain()$GainedRecords))
     })
   
   CompiledAttributedTaxa_Warn_Vals<-reactive({
     paste(CompiledAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Compiled_AttributedFishTaxaWarning<-renderText({
    if(length(CompiledUnattributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Compiled_Attributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Consider replacing unattributed and partially attributed taxa with attributed taxa: </span><span style=\"color:green;font-weight:bold\">", CompiledAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Compiled_Attributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Alternative Attributed Fish Taxa"),
            h4(strong("Alternatives to unattributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The species in this list show the taxa which were originall attributed 
               in the creel survey (ie. what level the taxa was initially recorded at) and the number of records for which this is the case."),
            h4(strong("Recommendation: "),"If possible replace the unattributed taxa with the recommended attributed taxa. Doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


# Partially Attributed Species #
   
   CompiledPartiallyAttributedTaxa_Count<-reactive({
    if(is.null(Compiled_PartiallyAttributedFishTaxa())){
      return(NULL)
    } else {
     Compiled_PartiallyAttributedFishTaxa()%>%
     count(Taxa)%>%
     unite(PartiallyAttributed_Records,"Taxa","n",sep="-")
    }
     })

   CompiledPartiallyAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(CompiledPartiallyAttributedTaxa_Count()$PartiallyAttributed_Records))
     })
   
   CompiledPartiallyAttributedTaxa_Warn_Vals<-reactive({
     paste(CompiledPartiallyAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Compiled_PartiallyAttributedFishTaxaWarning<-renderText({
    if(length(CompiledPartiallyAttributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Compiled_PartiallyAttributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include partially attributed taxa: </span><span style=\"color:red;font-weight:bold\">", CompiledPartiallyAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Compiled_PartiallyAttributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Partially Attributed Fish Taxa"),
            h4(strong("Selected surveys contain partially attributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). Occasionally a survey may record data across multiple overlapping taxanomic 
               levels creating partially attributed taxa. In these cases a survey may contain values attributed to both 'Black Crappie' (species) and 'Crappie' (genus). In thise case the value attributed to 'Black 
               Crappie' represents some, but not necessarily all, of the 'Black Crappie' in the survey as some of the values associated with 'Crappie' (genus) may actually also be 'Black Crappie'. Because of this 
               surveys which include both 'Black Crappie' and  'Crappie' attributions are considered partial attributions (ie. we can not fully attribute the 'Black Crappie' values). The list identifies which taxa have 
               partially attributed records in the dataset and how many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed or partially attributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip: "), "'Partially Attributed' taxa have both attributed and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset. Otherwise 
               partially attributed records will be included in the dataset but only include the directly attributed values without consideration of potential missing values from the unattributed portion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


   output$Compiled_PartiallyAttributedTBL_Pop<-reactive({
      
      length(CompiledPartiallyAttributedTaxa_Warn_Taxa())
      })
    outputOptions(output,'Compiled_PartiallyAttributedTBL_Pop',suspendWhenHidden=FALSE)

   output$Compiled_PartiallyAttributedFishTaxa_TBL<-DT::renderDataTable(
    Compiled_PartiallyAttributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Incomplete Groups #
      
     CompiledIncompleteAttributedTaxa_Count<-reactive({
    if(is.null(Compiled_IncompleteAttributedFishTaxa())){
      return(NULL)
    }else{
     Compiled_IncompleteAttributedFishTaxa()%>%
     count(Taxa)%>%
     unite(IncompleteAttributed_Records,"Taxa","n",sep="-")
    }
     })

   CompiledIncompleteAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(CompiledIncompleteAttributedTaxa_Count()$IncompleteAttributed_Records))
     })
   
   CompiledIncompleteAttributedTaxa_Warn_Vals<-reactive({
     paste(CompiledIncompleteAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Compiled_IncompleteAttributedFishTaxaWarning<-renderText({
    if(length(CompiledIncompleteAttributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Compiled_IncompleteAttributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include groups with incomplete attribution of taxa: </span><span style=\"color:red;font-weight:bold\">", CompiledIncompleteAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Compiled_IncompleteAttributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Incomplete Attribution of Fish Taxa"),
            h4(strong("Selected surveys contain incompletely attributed fish groups in inputs: ")),
            h4("Values for groups are typically generated either as a direct attribution of the group in the survey (ie. 'Panfish' estimates recorded directly), or by summing values for all component members 
            (ie. 'Trout' estimate generated by adding values from 'Rainbow Trout', 'Brook Trout', and 'Brown Trout'). Because groups are not monophyletic there can be cases when a group value may be incompletely 
            attributed due to component taxa which span within and outside group status (ie. a survey containing values attributed to the genus' 'Salvelinus' and 'Onchorynchus', while all values for 'Salvelinus' can 
            be (and therefore are) attributed to 'Trout', 'Onchorynchus'  includes both 'Trout' (Rainbow Trout, Cutthroat Trout...) and 'Non-Trout' (Chinook Salmon, Coho Salmon...), and therefore can not be attributed to 'Trout' 
            although some portion of those values may actually be 'Trout'.). In this case the records for 'Trout' are identified as 'Incomplete' meaning that some taxa are present within the record which may or may not be attributable 
            to the selected 'Group'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping incompletely attributed fish group records by toggling the 'Incomplete Input Fish Groups'  
               switch from 'Retained' to 'Dropped'."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)



   output$Compiled_IncompleteTBL_Pop<-reactive({
      
      length(CompiledIncompleteAttributedTaxa_Warn_Taxa())
      })
    outputOptions(output,'Compiled_IncompleteTBL_Pop',suspendWhenHidden=FALSE)

   output$Compiled_IncompleteAttributedFishTaxa_TBL<-DT::renderDataTable(
    Compiled_IncompleteAttributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
   
   ####### Check Here ######
   


   ### Overlapping Taxa Selection ###

FamilyCompiled_Selected<-reactive({
  TaxaTable%>%filter(Family %in% TaxaPick())%>%select(Family)%>%unique()
  })
GenusCompiled_Selected<-reactive({
      
  TaxaTable%>%filter(Genus %in% TaxaPick())%>%select(Family,Genus)%>%unique()
  })
SpeciesCompiled_Selected<-reactive({
      
  TaxaTable%>%filter(Species %in% TaxaPick())%>%select(Family,Genus,Species)%>%unique()
  })
SubsCompiled_Selected<-reactive({
      
  TaxaTable%>%filter(Subspecies_Variants %in% TaxaPick())%>%select(Family,Genus,Species,Subspecies_Variants)%>%unique()
  })


Genus_Family_Compiled_Overlap<-reactive({
      
  req(GenusCompiled_Selected())
  req(FamilyCompiled_Selected())
  
  GenusCompiled_Selected()%>%
  inner_join(FamilyCompiled_Selected(),by='Family')%>%
  select(Family,Genus)%>%
  unite(Overlaps,"Family","Genus",sep=" overlaps ")})

Species_Family_Compiled_Overlap<-reactive({
      
  req(SpeciesCompiled_Selected())
  req(FamilyCompiled_Selected())
  
  SpeciesCompiled_Selected()%>%
  inner_join(FamilyCompiled_Selected(),by='Family')%>%
  select(Family,Species)%>%
  unite(Overlaps,"Family","Species",sep=" overlaps ")})

Species_Genus_Compiled_Overlap<-reactive({
      
  req(SpeciesCompiled_Selected())
  req(GenusCompiled_Selected())
  
  SpeciesCompiled_Selected()%>%
  inner_join(GenusCompiled_Selected(),by='Genus')%>%
  select(Genus,Species)%>%
  unite(Overlaps,"Genus","Species",sep=" overlaps ")})

Subspecies_Family_Compiled_Overlap<-reactive({
  req(SubsCompiled_Selected())
  req(FamilyCompiled_Selected())
  
  SubsCompiled_Selected()%>%
  inner_join(FamilyCompiled_Selected(),by='Family')%>%
  select(Family,Subspecies_Variants)%>%
  unite(Overlaps,"Family","Subspecies_Variants",sep=" overlaps ")})

Subspecies_Genus_Compiled_Overlap<-reactive({
      
  req(SubsCompiled_Selected())
  req(GenusCompiled_Selected())
  
  SubsCompiled_Selected()%>%
  inner_join(GenusCompiled_Selected(),by='Genus')%>%
  select(Genus,Subspecies_Variants)%>%
  unite(Overlaps,"Genus","Subspecies_Variants",sep=" overlaps ")})

Subspecies_Species_Compiled_Overlap<-reactive({
      
  req(SubsCompiled_Selected())
  req(SpeciesCompiled_Selected())
  
  SubsCompiled_Selected()%>%
  inner_join(SpeciesCompiled_Selected(),by='Species')%>%
  select(Species,Subspecies_Variants)%>%
  unite(Overlaps,"Species","Subspecies_Variants",sep=" overlaps ")})

Group_Taxa_Compiled_Overlap<-reactive({
  req(TaxaPick())
  
  GroupTaxa%>%
  filter(Group %in% TaxaPick())%>%
  filter(Taxa %in% TaxaPick_NoGroup())%>%
  unite(Overlaps,"Group","Taxa",sep=" overlaps ")%>%
  select(Overlaps)})

CompiledOverlaps<-reactive({
  PH<-as.list(bind_rows(Genus_Family_Compiled_Overlap(),Species_Family_Compiled_Overlap(),Species_Genus_Compiled_Overlap(),Subspecies_Family_Compiled_Overlap(),Subspecies_Genus_Compiled_Overlap(),Subspecies_Species_Compiled_Overlap(),Group_Taxa_Compiled_Overlap()))
return(PH)
})

   CompiledOverlapTaxa_Warn<-reactive({
     as.list(as.character(unique(CompiledOverlaps()$Overlaps)))
     })
   
   Compiled_Overlap_Warn<-reactive({
     paste(CompiledOverlapTaxa_Warn(),collapse=" & ")
     })

   output$Compiled_OverlapFishWarning<-renderText({
    if(nchar(Compiled_Overlap_Warn())>1){
      return(paste(as.character(actionLink(inputId = "Compiled_Overlap_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input taxa include overlapping value attribution: </span><span style=\"color:red;font-weight:bold\">", Compiled_Overlap_Warn(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Compiled_Overlap_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Overlap of Input Fish Taxa"),
            h4(strong("Selected fish inputs contain overlapping taxa: ")),
            h4("Taxa can be attributed at multiple, overlapping taxanomic levels and therefore the associated values can result in overlap or double counting (ie. a user selects both 
               'Bluegill' (Species) and 'Lepomis' (Genus) harvest estimates, the harvest estimate attributable to 'Bluegill'(10) is also included within 'Lepomis'(30), meaning of the 30 'Lepomis' individuals harvested 10 of them are the 
               same as the 10 recorded in Bluegill, while 20 of them are from different 'Lepomis' taxa."),
            h4(strong("Recommendation: "),"We suggest avoiding overlapping taxa whereever possible to avoid double, triple, etc. counting of values. In order to do this select only non-overlapping taxa for inputs."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)


  CompiledUnattributedTarget_Taxa_Count<-reactive({
    if(is.null(Compiled_UnattributedTarget_Taxa())){
      return(NULL)
    }else{
     Compiled_UnattributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(Unattributed_Records,"Taxa","n",sep="-")
    }
     })

   CompiledUnattributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(CompiledUnattributedTarget_Taxa_Count()$Unattributed_Records))
     })
   
   CompiledUnattributedTarget_Taxa_Warn_Vals<-reactive({
     paste(CompiledUnattributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Compiled_UnattributedTarget_TaxaWarning<-renderText({
    if(length(CompiledUnattributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Compiled_Unattributed_Target_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include unattributed target taxa: </span><span style=\"color:red;font-weight:bold\">", CompiledUnattributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Compiled_Unattributed_Target_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unattributed Target Taxa"),
            h4(strong("Selected surveys contain unattributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The list identifies which taxa have unattributed records in the dataset and how 
               many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   # Attributed Taxa Suggestions ###
    Compiled_Attributed_TargetGain<-reactive({
      if(is.null(Compiled_UnattributedTarget_Taxa())){
        return(NULL)
      }else{
     return(Compiled_UnattributedTarget_Taxa()%>%
     count(Attributed_Target_Taxa)%>%
     unite(GainedRecords,"Attributed_Target_Taxa","n",sep="-"))
      }
     })

   CompiledAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Compiled_Attributed_TargetGain()$GainedRecords))
     })
   
   CompiledAttributedTarget_Taxa_Warn_Vals<-reactive({paste(CompiledAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")})

   output$Compiled_AttributedTarget_TaxaWarning<-renderText({
    if(nchar(CompiledAttributedTarget_Taxa_Warn_Vals())>1){
      return(paste(as.character(actionLink(inputId = "Compiled_AttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Consider replacing unattributed and partially attributed taxa with attributed taxa: </span><span style=\"color:green;font-weight:bold\">", CompiledAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Compiled_AttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Alternative Attributed Target Taxa"),
            h4(strong("Alternatives to unattributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The species in this list show the taxa which were originall attributed 
               in the creel survey (ie. what level the taxa was initially recorded at) and the number of records for which this is the case."),
            h4(strong("Recommendation: "),"If possible replace the unattributed target taxa with the recommended attributed target taxa. Doing so will reduce the instances of 
               unattributed target taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however if a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Compiled_UnattributedTargetTBL_Pop<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
      length(CompiledUnattributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Compiled_UnattributedTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Compiled_UnattributedTarget_Taxa_TBL<-DT::renderDataTable(
    Compiled_UnattributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
 CompiledPartiallyAttributedTarget_Taxa_Count<-reactive({
    if(is.null(Compiled_PartiallyAttributedTarget_Taxa())){
      return(NULL)
    } else {
     Compiled_PartiallyAttributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(PartiallyAttributed_Records,"Taxa","n",sep="-")
    }
     })

   CompiledPartiallyAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(CompiledPartiallyAttributedTarget_Taxa_Count()$PartiallyAttributed_Records))
     })
   
   CompiledPartiallyAttributedTarget_Taxa_Warn_Vals<-reactive({
     paste(CompiledPartiallyAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Compiled_PartiallyAttributedFishTarget_TaxaWarning<-renderText({
    if(length(CompiledPartiallyAttributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Compiled_PartiallyAttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include partially attributed target taxa: </span><span style=\"color:red;font-weight:bold\">", CompiledPartiallyAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })

    observeEvent(input$Compiled_PartiallyAttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Partially Attributed Target Taxa"),
            h4(strong("Selected surveys contain partially attributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). Occasionally a survey may record data across multiple overlapping taxanomic 
               levels creating partially attributed taxa. In these cases a survey may contain values attributed to both 'Black Crappie' (species) and 'Crappie' (genus). In thise case the value attributed to 'Black 
               Crappie' represents some, but not necessarily all, of the 'Black Crappie' in the survey as some of the values associated with 'Crappie' (genus) may actually also be 'Black Crappie'. Because of this 
               surveys which include both 'Black Crappie' and  'Crappie' attributions are considered partial attributions (ie. we can not fully attribute the 'Black Crappie' values). The list identifies which taxa have 
               partially attributed records in the dataset and how many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed or partially attributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Target Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip: "), "'Partially Attributed' taxa have both attributed and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset. Otherwise 
               partially attributed records will be included in the dataset but only include the directly attributed values without consideration of potential missing values from the unattributed portion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Compiled_PartiallyAttributedTargetTBL_Pop<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
      length(CompiledPartiallyAttributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Compiled_PartiallyAttributedTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Compiled_PartiallyAttributedTarget_Taxa_TBL<-DT::renderDataTable(
    Compiled_PartiallyAttributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Incomplete Groups #
   
     CompiledIncompleteAttributedTarget_Taxa_Count<-reactive({
    if(is.null(Compiled_IncompleteAttributedTarget_Taxa())){
      return(NULL)
    }else{
     Compiled_IncompleteAttributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(IncompleteAttributed_Records,"Taxa","n",sep="-")
    }
     })

   CompiledIncompleteAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(CompiledIncompleteAttributedTarget_Taxa_Count()$IncompleteAttributed_Records))
     })
   
   CompiledIncompleteAttributedTarget_Taxa_Warn_Vals<-reactive({
     paste(CompiledIncompleteAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Compiled_IncompleteAttributedFishTarget_TaxaWarning<-renderText({
    if(length(CompiledIncompleteAttributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Compiled_IncompleteAttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include groups with incomplete attribution of target taxa: </span><span style=\"color:red;font-weight:bold\">", CompiledIncompleteAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })  
   
  observeEvent(input$Compiled_IncompleteAttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Incomplete Attribution of Target Taxa"),
            h4(strong("Selected surveys contain incompletely attributed target groups in inputs: ")),
            h4("Values for groups are typically generated either as a direct attribution of the group in the survey (ie. 'Panfish' estimates recorded directly), or by summing values for all component members 
            (ie. 'Trout' estimate generated by adding values from 'Rainbow Trout', 'Brook Trout', and 'Brown Trout'). Because groups are not monophyletic there can be cases when a group value may be incompletely 
            attributed due to component taxa which span within and outside group status (ie. a survey containing values attributed to the genus' 'Salvelinus' and 'Onchorynchus', while all values for 'Salvelinus' can 
            be (and therefore are) attributed to 'Trout', 'Onchorynchus'  includes both 'Trout' (Rainbow Trout, Cutthroat Trout...) and 'Non-Trout' (Chinook Salmon, Coho Salmon...), and therefore can not be attributed to 'Trout' 
            although some portion of those values may actually be 'Trout'.). In this case the records for 'Trout' are identified as 'Incomplete' meaning that some taxa are present within the record which may or may not be attributable 
            to the selected 'Group'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping incompletely attributed target group records by toggling the 'Incomplete Input Fish Groups'  
               switch from 'Retained' to 'Dropped'."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Compiled_IncompleteTargetTBL_Pop<-reactive({
      
      length(CompiledIncompleteAttributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Compiled_IncompleteTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Compiled_IncompleteAttributedTarget_Taxa_TBL<-DT::renderDataTable(
    Compiled_IncompleteAttributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )



   ### Overlapping Target Taxa Selection ###



TargetFamilyCompiled_Selected<-reactive({
  TaxaTable%>%filter(Family %in% AngPref_TaxaPick())%>%select(Family)%>%unique()
  })
TargetGenusCompiled_Selected<-reactive({
      
  TaxaTable%>%filter(Genus %in% AngPref_TaxaPick())%>%select(Family,Genus)%>%unique()
  })
TargetSpeciesCompiled_Selected<-reactive({
      
  TaxaTable%>%filter(Species %in% AngPref_TaxaPick())%>%select(Family,Genus,Species)%>%unique()
  })
TargetSubsCompiled_Selected<-reactive({
      
  TaxaTable%>%filter(Subspecies_Variants %in% AngPref_TaxaPick())%>%select(Family,Genus,Species,Subspecies_Variants)%>%unique()
  })


TargetGenus_Family_Compiled_Overlap<-reactive({
  req(TargetGenusCompiled_Selected())
  req(TargetFamilyCompiled_Selected())
  
  TargetGenusCompiled_Selected()%>%
  inner_join(TargetFamilyCompiled_Selected(),by='Family')%>%
  select(Family,Genus)%>%
  unite(Overlaps,"Family","Genus",sep=" overlaps ")
  })

TargetSpecies_Family_Compiled_Overlap<-reactive({
  req(TargetSpeciesCompiled_Selected())
  req(TargetFamilyCompiled_Selected())
  
  TargetSpeciesCompiled_Selected()%>%
  inner_join(TargetFamilyCompiled_Selected(),by='Family')%>%
  select(Family,Species)%>%
  unite(Overlaps,"Family","Species",sep=" overlaps ")
  })

TargetSpecies_Genus_Compiled_Overlap<-reactive({
  req(TargetSpeciesCompiled_Selected())
  req(TargetGenusCompiled_Selected())
  
  TargetSpeciesCompiled_Selected()%>%
  inner_join(TargetGenusCompiled_Selected(),by='Genus')%>%
  select(Genus,Species)%>%
  unite(Overlaps,"Genus","Species",sep=" overlaps ")
  })

TargetSubspecies_Family_Compiled_Overlap<-reactive({
  req(TargetSubsCompiled_Selected())
  req(TargetFamilyCompiled_Selected())
  
  TargetSubsCompiled_Selected()%>%
  inner_join(TargetFamilyCompiled_Selected(),by='Family')%>%
  select(Family,Subspecies_Variants)%>%
  unite(Overlaps,"Family","Subspecies_Variants",sep=" overlaps ")
  })

TargetSubspecies_Genus_Compiled_Overlap<-reactive({
  req(TargetSubsCompiled_Selected())
  req(TargetGenusCompiled_Selected())
  
  TargetSubsCompiled_Selected()%>%
  inner_join(TargetGenusCompiled_Selected(),by='Genus')%>%
  select(Genus,Subspecies_Variants)%>%
  unite(Overlaps,"Genus","Subspecies_Variants",sep=" overlaps ")
  })

TargetSubspecies_Species_Compiled_Overlap<-reactive({
  req(TargetSubsCompiled_Selected())
  req(TargetSpeciesCompiled_Selected())
  
  TargetSubsCompiled_Selected()%>%
  inner_join(TargetSpeciesCompiled_Selected(),by='Species')%>%
  select(Species,Subspecies_Variants)%>%
  unite(Overlaps,"Species","Subspecies_Variants",sep=" overlaps ")
  })

TargetGroup_Taxa_Compiled_Overlap<-reactive({
  req(AngPref_TaxaPick())
  
    GroupTaxa%>%
  filter(Group %in% AngPref_TaxaPick())%>%
  filter(Taxa %in% AngPref_TaxaPick_NoGroup())%>%
  unite(Overlaps,"Group","Taxa",sep=" overlaps ")%>%
  select(Overlaps)
 
  })

TargetCompiledOverlaps<-reactive({
  PH<-as.list(bind_rows(TargetGenus_Family_Compiled_Overlap(),TargetSpecies_Family_Compiled_Overlap(),TargetSpecies_Genus_Compiled_Overlap(),TargetSubspecies_Family_Compiled_Overlap(),TargetSubspecies_Genus_Compiled_Overlap(),TargetSubspecies_Species_Compiled_Overlap(),TargetGroup_Taxa_Compiled_Overlap()))
return(PH)
})

   TargetCompiledOverlapTaxa_Warn<-reactive({
     as.list(as.character(unique(TargetCompiledOverlaps()$Overlaps)))
     })
   
   TargetCompiled_Overlap_Warn<-reactive({
     paste(TargetCompiledOverlapTaxa_Warn(),collapse=" & ")
     })

   output$Compiled_OverlapTargetWarning<-renderText({
    if(nchar(TargetCompiled_Overlap_Warn())>1){
      return(paste(as.character(actionLink(inputId = "TargetCompiled_Overlap_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input target taxa include overlapping value attribution: </span><span style=\"color:red;font-weight:bold\">", TargetCompiled_Overlap_Warn(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$TargetCompiled_Overlap_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Overlap of Input Target Taxa"),
            h4(strong("Selected angler preference inputs contain overlapping target taxa: ")),
            h4("Taxa can be attributed at multiple, overlapping taxanomic levels and therefore the associated values can result in overlap or double counting (ie. a user selects both 
               'Bluegill' (Species) and 'Lepomis' (Genus) estimates, the estimate attributable to 'Bluegill'(10) is also included within 'Lepomis'(30), meaning of the 30 'Lepomis' values 10 of them are the 
               same as the 10 recorded in Bluegill, while 20 of them are from different 'Lepomis' taxa."),
            h4(strong("Recommendation: "),"We suggest avoiding overlapping taxa whereever possible to avoid double, triple, etc. counting of values. In order to do this select only non-overlapping target taxa for inputs."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)

  
  ############################# End Working #######################
    


#### Data Availability Server Info ####
    #### State Status Map ####
  
    observeEvent({
    input$DataAvailType_Pick
    },{
      if(input$DataAvailType_Pick=='Survey Characteristics'){
    updateRadioGroupButtons(session, "SurveyCountView", selected=c("Table"))}
  },ignoreInit=TRUE)

  observeEvent({
    input$SurveyCountView
    },{
      if(input$SurveyCountView=='Map'){
    updateRadioGroupButtons(session, "DataAvail_StateSumm", selected=c("Yes"))}
  },ignoreInit=TRUE)
 

  StateSurveyCount<-reactive({
    req(input$CreelCatNavBar=='Data Availability')
    PH<-as.data.frame(CompiledData_Full())%>%
      group_by(State)%>%
      summarize(Survey_Count=n())
  })

  StateSurveyCount_TBL<-reactive({
    req(input$CreelCatNavBar=='Data Availability')
    if(input$DataAvail_StateSumm=='Yes'){
      as.data.frame(CompiledData_Full())%>%
        group_by(State)%>%
        summarize(Survey_Count=n())
    }else{
      as.data.frame(CompiledData_Full())%>%
        summarize(Survey_Count=n())
      }
  })

  output$StateSurveyCountTBL<-DT::renderDataTable(
    StateSurveyCount_TBL(),
    extensions=c('Buttons','Select','Scroller'),
   options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
    class="display nowrap compact",
    server = FALSE,
    filter="top",
    selection='none'
  )

  DataAvailSp1<-reactive({
    req(input$CreelCatNavBar=='Data Availability')
    left_join(CompiledData_Full()[,c("Survey_ID","State")],FishDataCompiled[,c("Survey_ID","Taxa")],by='Survey_ID')
  })

  DataAvailSp<-reactive({
    req(input$CreelCatNavBar=='Data Availability')
    DataAvailSp1()[,c("State","Taxa")]%>%
    mutate_at(vars(Taxa),list(factor))
  })
  
  

  DataAvailSP_TBL<-reactive({
    req(input$CreelCatNavBar=='Data Availability')
    if(input$DataAvail_StateSumm=='Yes'){
      as.data.frame(DataAvailSp())%>%
        group_by(State,Taxa)%>%
        summarize(Survey_Count=n())
    }else{
      as.data.frame(DataAvailSp())%>%
        group_by(Taxa)%>%
        summarize(Survey_Count=n())
    }
  })

  output$DataAvailSPTBL<-DT::renderDataTable(
    DataAvailSP_TBL(),
    extensions=c('Buttons','Select','Scroller'),
    options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
    class="display nowrap compact",
    server = FALSE,
    filter="top",
    selection='none'
  )
  


     
  DataAvail_Fields_TBL<-reactive({
    req(input$CreelCatNavBar=='Data Availability')
    if(input$DataAvail_StateSumm=='Yes'){
      as.data.frame(CompiledData_Full())%>%
        group_by(State)%>%
        summarise_each(funs(sum(!is.na(.))))%>%
        pivot_longer(!State,names_to="Fields",values_to="Survey_Count")%>%
        mutate_at(vars(Fields),list(factor))%>%
        filter(Survey_Count>0)
    }else{
      as.data.frame(CompiledData_Full())%>%
        summarise_each(funs(sum(!is.na(.))))%>%
        pivot_longer(!State,names_to="Fields",values_to="Survey_Count")%>%
        mutate_at(vars(Fields),list(factor))%>%
        filter(Survey_Count>0)%>%
        select(-State)
    }
  })
  

  
  output$DataAvailFieldsTBL<-DT::renderDataTable(
    DataAvail_Fields_TBL(),
    extensions=c('Buttons','Select','Scroller'),
    options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
    class="display nowrap compact",
    server = FALSE,
    filter="top",
    selection='none'
  )
  


  #### Survey Characteristics

    DataAvail_SurveyCharacteristics_TBL<-reactive({
      req(input$CreelCatNavBar=='Data Availability')
    if(input$DataAvail_StateSumm=='Yes'){
      as.data.frame(CompiledData_Full())%>%
        group_by(across(c(State,input$DataAvail_AvailGroupPicker)))%>%
        summarize(Survey_Count=n(),Earliest_Year=min(Year,na.rm=TRUE),Latest_Year=max(Year,na.rm=TRUE),Mean_Duration=mean(Duration,na.rm=TRUE),Min_Duration=min(Duration,na.rm=TRUE),Max_Duration=max(Duration,na.rm=TRUE))
    }else{
      as.data.frame(CompiledData_Full())%>%
        select(-State)%>%
        group_by(across(c(input$DataAvail_AvailGroupPicker)))%>%
        summarize(Survey_Count=n(),Earliest_Year=min(Year,na.rm=TRUE),Latest_Year=max(Year,na.rm=TRUE),Mean_Duration=mean(Duration,na.rm=TRUE),Min_Duration=min(Duration,na.rm=TRUE),Max_Duration=max(Duration,na.rm=TRUE))
    }
  })


  output$DataAvailSurveyCharacteristicsTBL<-DT::renderDataTable(
    DataAvail_SurveyCharacteristics_TBL(),
    extensions=c('Buttons','Select','Scroller'),
    options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
    class="display nowrap compact",
    server = FALSE,
    filter="top",
    selection='none'
  )

  StateBoundaries_SHP1<-reactive({
    req(input$CreelCatNavBar=='Data Availability')
    req(StateBoundaries_SHP,StateSurveyCount())
    sp::merge(x=StateBoundaries_SHP,y=StateSurveyCount(),by.x="NAME",by.y="State",all.x=FALSE)})



  output$CreelCatSurveyCount = renderUI({paste("The CreelCat database contains data from ", nrow(Survey_Data), "surveys.")})
  ST_pal <- reactive({req(input$CreelCatNavBar=='Data Availability')
    colorBin(palette="Blues", StateBoundaries_SHP1()$Survey_Count, bins=c(1,5,10,25,50,100,250,500,1000,5000,ceiling(max(StateBoundaries_SHP1()$Survey_Count)/10000)*10000), reverse=FALSE)
    })

  output$mapDataAvail_SurveyCount <- renderLeaflet({
    DataAvailMap_SurveyCount <- leaflet()%>%
      addMapPane("SurveyCountData",zIndex=420)%>%
      addMapPane("SupplementaryData",zIndex=410)%>%
      addProviderTiles("CartoDB.DarkMatter",group="Dark")%>%
        addProviderTiles("CartoDB.Positron",group="Light")%>%
      addWMSTiles(GetURL("USGSImageryTopo"),group="Imagery Topo Hybrid",layers="0")%>%
      addWMSTiles(GetURL("USGSTopo"),group="Topo",layers="0")%>%
      addWMSTiles(GetURL("USGSImageryOnly"),group="Imagery",layers="0")%>%
      addWMSTiles(GetURL("USGSShadedReliefOnly"),group="Shaded Relief",layers="0")%>%
      addWMSTiles(GetURL("USGSHydroCached"),group="Hydrography",layers="0",options =list(format="image/png",transparent=TRUE))%>%
      addPolygons(data=StateBoundaries_SHP1(),
                  group="Survey Count",
                  options=pathOptions(pane="SurveyCountData"),
                  weight = 2,
                  opacity = 1,
                  #color = ~ST_pal()(Survey_Count),
                  fillColor = ~ST_pal()(Survey_Count),
                  color = "grey",
                  dashArray = "1",
                  fillOpacity = 1,
                  popup = ~sprintf(
                    "<strong>%s</strong><br/>Survey Count: %s",
                    StateBoundaries_SHP1()$NAME,StateBoundaries_SHP1()$Survey_Count)
      )%>%
      addPolygons(data=StateBoundaries_SHP,
                      group="State Boundaries",
                      options=pathOptions(pane="SupplementaryData"),
                      weight = 1,
                      opacity = 1,
                      color = "grey",
                      dashArray = "1",
                      fillOpacity = 0,
                      highlight = highlightOptions(
                        weight = 5,
                        color = "#666",
                        dashArray = "",
                        fillOpacity = 0,
                        bringToFront = TRUE),
      )%>%
      addLayersControl(
        baseGroups=c("Dark","Light","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief"),
        overlayGroups = c("Survey Count", "State Boundaries","Hydrography"),
        options = layersControlOptions(collapsed = TRUE))%>%
      hideGroup("Hydrography")%>%
      fitBounds(FullBounds[1], FullBounds[2], FullBounds[3], FullBounds[4])%>%
      addLegend("bottomright", pal = ST_pal(), values =StateBoundaries_SHP1()$Survey_Count, title="Survey Count", group= "Survey Count", layerId="Survey Count", opacity = 1)
  })

  DataAvail_SubsPick<-reactive({req(input$CreelCatNavBar=='Data Availability')
    input$DataAvail_SubsPicker
    })
  DataAvail_SppPick<-reactive({
    req(input$CreelCatNavBar=='Data Availability')
    input$DataAvail_SppPicker
    })
  DataAvail_GenPick<-reactive({req(input$CreelCatNavBar=='Data Availability')
    input$DataAvail_GenPicker
    })
  DataAvail_FamPick<-reactive({
    req(input$CreelCatNavBar=='Data Availability')
    input$DataAvail_FamPicker
    })
  DataAvail_GrpPick<-reactive({req(input$CreelCatNavBar=='Data Availability')
    input$DataAvail_GrpPicker
    })
  DataAvail_TaxaPick<-reactive({req(input$CreelCatNavBar=='Data Availability')
    if(input$DataAvail_TaxaTypeSel=="Subspecies and Variants"){
    DataAvail_SubsPick()
    }else if (input$DataAvail_TaxaTypeSel=="Species"){
      DataAvail_SppPick()
      }else if (input$DataAvail_TaxaTypeSel=="Genus"){
        DataAvail_GenPick()
        }else if(input$DataAvail_TaxaTypeSel=="Family"){
         DataAvail_FamPick()
        }else if(input$DataAvail_TaxaTypeSel=="Groups"){
            DataAvail_GrpPick()
        }
  })

  DataAvailSP_TBL_MAP<-reactive({
    req(input$CreelCatNavBar=='Data Availability')
      as.data.frame(DataAvailSp())%>%
        group_by(State,Taxa)%>%
        summarize(Survey_Count=n())
  })

  StateBoundaries_SppSHP<-reactive({
    req(input$CreelCatNavBar=='Data Availability')
    req(StateBoundaries_SHP,StateSurveyCount())
    sp::merge(x=StateBoundaries_SHP,y=DataAvailSP_TBL_MAP(),by.x="NAME",by.y="State",all.x=FALSE)%>%
      filter(Taxa==DataAvail_TaxaPick())
    })

  DataAvailSppChoices<-reactive({
    req(input$CreelCatNavBar=='Data Availability')
    PH<-sort(unique(as.character(DataAvailSP_TBL_MAP()$Taxa)))
  })

  observeEvent({
    DataAvailSP_TBL_MAP()
    },{
    updatePickerInput(session, "DataAvail_SppMapPicker", choices=DataAvailSppChoices())
  },ignoreInit=TRUE)

    
  ST_SPPpal <- reactive({
    req(input$CreelCatNavBar=='Data Availability')
    colorBin(palette="Blues", StateBoundaries_SppSHP()$Survey_Count, bins=c(1,5,10,25,50,100,250,500,1000,5000,ceiling(max(StateBoundaries_SHP1()$Survey_Count)/10000)*10000), reverse=FALSE)
    })
 

  output$mapDataAvail_SppCount <- renderLeaflet({
    DataAvailMap_SppCount <- leaflet()%>%
      addMapPane("SurveyCountData",zIndex=420)%>%
      addMapPane("SupplementaryData",zIndex=410)%>%
      addProviderTiles("CartoDB.DarkMatter",group="Dark")%>%
        addProviderTiles("CartoDB.Positron",group="Light")%>%
      addWMSTiles(GetURL("USGSImageryTopo"),group="Imagery Topo Hybrid",layers="0")%>%
      addWMSTiles(GetURL("USGSTopo"),group="Topo",layers="0")%>%
      addWMSTiles(GetURL("USGSImageryOnly"),group="Imagery",layers="0")%>%
      addWMSTiles(GetURL("USGSShadedReliefOnly"),group="Shaded Relief",layers="0")%>%
      addWMSTiles(GetURL("USGSHydroCached"),group="Hydrography",layers="0",options =list(format="image/png",transparent=TRUE))%>%
      addPolygons(data=StateBoundaries_SppSHP(),
                  group="Survey Count",
                  options=pathOptions(pane="SurveyCountData"),
                  weight = 2,
                  opacity = 1,
                  fillColor=~ST_SPPpal()(Survey_Count),
                  color ="grey",
                  dashArray = "1",
                  fillOpacity = 1,
                  popup = ~sprintf(
                    "<strong>%s</strong><br/>Survey Count: %s",
                    StateBoundaries_SppSHP()$NAME,StateBoundaries_SppSHP()$Survey_Count)
      )%>%
      addPolygons(data=StateBoundaries_SHP,
                  group="State Boundaries",
                  options=pathOptions(pane="SupplementaryData"),
                  weight = 1,
                  opacity = 1,
                  color = "grey",
                  dashArray = "1",
                  fillOpacity = 0,
                  highlight = highlightOptions(
                    weight = 5,
                    color = "#666",
                    dashArray = "",
                    fillOpacity = 0,
                    bringToFront = TRUE),
      )%>%
      addLayersControl(
        baseGroups=c("Dark","Light","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief"),
        overlayGroups = c("Survey Count", "State Boundaries","Hydrography"),
        options = layersControlOptions(collapsed = TRUE))%>%
      hideGroup("Hydrography")%>%
      fitBounds(FullBounds[1], FullBounds[2], FullBounds[3], FullBounds[4])%>%
      addLegend("bottomright", pal = ST_SPPpal(), values =StateBoundaries_SppSHP()$Survey_Count, title="Survey Count", group= "Survey Count", layerId="Survey Count", opacity = 1)
  })

  StateBoundaries_FieldsSHP<-reactive({
    req(DataAvail_Fields_TBL())
    sp::merge(x=StateBoundaries_SHP,y=DataAvail_Fields_TBL(),by.x="NAME",by.y="State",all.x=FALSE)%>%
      filter(Fields==input$DataAvail_AvailFieldsPick)
  })

  DataAvailFieldsChoices<-reactive({
    req(input$CreelCatNavBar=='Data Availability')
    PH<-sort(unique(as.character(DataAvail_Fields_TBL()$Fields)))
  })

  observeEvent({
    DataAvail_Fields_TBL()
  },{
    updatePickerInput(session, "DataAvail_AvailFieldsPick", choices=DataAvailFieldsChoices())
  },ignoreInit=TRUE)


  ST_Fieldspal <- reactive({colorBin(palette="Blues", StateBoundaries_FieldsSHP()$Survey_Count, bins=c(1,5,10,25,50,100,250,500,1000,5000,ceiling(max(StateBoundaries_SHP1()$Survey_Count)/10000)*10000), reverse=FALSE)})

  output$mapDataAvail_FieldsCount <- renderLeaflet({
    DataAvailMap_FieldsCount <- leaflet()%>%
      addMapPane("SurveyCountData",zIndex=420)%>%
      addMapPane("SupplementaryData",zIndex=410)%>%
      addProviderTiles("CartoDB.DarkMatter",group="Dark")%>%
        addProviderTiles("CartoDB.Positron",group="Light")%>%
      addWMSTiles(GetURL("USGSImageryTopo"),group="Imagery Topo Hybrid",layers="0")%>%
      addWMSTiles(GetURL("USGSTopo"),group="Topo",layers="0")%>%
      addWMSTiles(GetURL("USGSImageryOnly"),group="Imagery",layers="0")%>%
      addWMSTiles(GetURL("USGSShadedReliefOnly"),group="Shaded Relief",layers="0")%>%
      addWMSTiles(GetURL("USGSHydroCached"),group="Hydrography",layers="0",options =list(format="image/png",transparent=TRUE))%>%
      addPolygons(data=StateBoundaries_FieldsSHP(),
                  group="Survey Count",
                  options=pathOptions(pane="SurveyCountData"),
                  weight = 2,
                  opacity = 1,
                  fillColor=~ST_Fieldspal()(Survey_Count),
                  color ="grey",
                  dashArray = "1",
                  fillOpacity = 1,
                  popup = ~sprintf(
                    "<strong>%s</strong><br/>Survey Count: %s",
                    StateBoundaries_FieldsSHP()$NAME,StateBoundaries_FieldsSHP()$Survey_Count)
      )%>%
      addPolygons(data=StateBoundaries_SHP,
                  group="State Boundaries",
                  options=pathOptions(pane="SupplementaryData"),
                  weight = 1,
                  opacity = 1,
                  color = "grey",
                  dashArray = "1",
                  fillOpacity = 0,
                  highlight = highlightOptions(
                    weight = 5,
                    color = "#666",
                    dashArray = "",
                    fillOpacity = 0,
                    bringToFront = TRUE),
      )%>%
      addLayersControl(
        baseGroups=c("Dark","Light","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief"),
        overlayGroups = c("Survey Count", "State Boundaries","Hydrography"),
        options = layersControlOptions(collapsed = TRUE))%>%
      hideGroup("Hydrography")%>%
      fitBounds(FullBounds[1], FullBounds[2], FullBounds[3], FullBounds[4])%>%
      addLegend("bottomright", pal = ST_Fieldspal(), values =StateBoundaries_FieldsSHP()$Survey_Count, title="Survey Count", group= "Survey Count", layerId="Survey Count", opacity = 1)
  })
  
  
#### Summarization Server Info ####

    SummaryGroups<-reactive({input$Survey_Summary_FieldGroup_Picker})
    FieldVals<-reactive({input$Survey_Summary_FieldValue_Picker})

  
  SummaryInputFishTaxa<-reactive({
      Fish_Output<-trimws(sub(paste(FishMetricPick(), collapse = "|"), "", FieldVals()[str_detect(FieldVals(),paste(FishMetricPick(),collapse="|"))]) )
      return(Fish_Output)
  })
  
  SummaryInputFishTaxa_NoGroup<-reactive({ 
    req(SummaryInputFishTaxa())
    SummaryInputFishTaxa()%>%
      .[.!=GrpPick()]
  })
 
  SummaryInputTarget_Taxa<-reactive({
      Target_Output<-trimws(sub(paste(TargetMetricPick(), collapse = "|"), "", FieldVals()[str_detect(FieldVals(),paste(TargetMetricPick(),collapse="|"))]) )
      return(Target_Output)
  }) 
  
  SummaryInputTarget_Taxa_NoGroup<-reactive({
    req(SummaryInputTarget_Taxa())
    SummaryInputTarget_Taxa()%>%
      .[.!=AngPref_GrpPick()]
  })

  


    Summary_UnattributedFishTaxa<-reactive({
     if(length(SummaryInputFishTaxa())>0){
       return(
         CompiledSummaryInput_Dat_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(UnattributedTaxa)%>%
       filter(Taxa%in%SummaryInputFishTaxa())%>%
       select(!(UnattributedTaxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
      
  Summary_PartiallyAttributedFishTaxa<-reactive({
      if(length(SummaryInputFishTaxa())>0){
       return(
         CompiledSummaryInput_Dat_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(PartiallyAttributedTaxa)%>%
       filter(Taxa%in%SummaryInputFishTaxa())%>%
       select(!(PartiallyAttributedTaxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
   
   Summary_IncompleteAttributedFishTaxa<-reactive({
      if(length(SummaryInputFishTaxa())>0){
       return(
         CompiledSummaryInput_Dat_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(IncompleteAttributedTaxa)%>%
       filter(Taxa%in%SummaryInputFishTaxa())%>%
       select(!(Incomplete_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })

       Summary_UnattributedTarget_Taxa<-reactive({
     if(length(SummaryInputTarget_Taxa())>0){
       return(
         CompiledSummaryInput_Dat_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(UnattributedTarget_Taxa)%>%
       filter(Taxa%in%SummaryInputTarget_Taxa())%>%
       select(!(UnattributedTarget_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
      
  Summary_PartiallyAttributedTarget_Taxa<-reactive({
      if(length(SummaryInputTarget_Taxa())>0){
       return(
         CompiledSummaryInput_Dat_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(PartiallyAttributedTarget_Taxa)%>%
       filter(Taxa%in%SummaryInputTarget_Taxa())%>%
       select(!(PartiallyAttributedTarget_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
   
   Summary_IncompleteAttributedTarget_Taxa<-reactive({
      if(length(SummaryInputTarget_Taxa())>0){
       return(
         CompiledSummaryInput_Dat_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(IncompleteAttributedTarget_Taxa)%>%
       filter(Taxa%in%SummaryInputTarget_Taxa())%>%
       select(!(Incomplete_Target_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })

Summary_Selected_NA_TBL<-reactive({
  CompiledSummaryInput_Dat_Raw()%>%
    drop_na(input$Survey_Summary_FieldGroup_Picker)%>%
    drop_na(input$Survey_Summary_FieldValue_Picker)
})
   
 CompiledSummaryInput_DatSurvey<-reactive({
      req(Summary_WarningData())
     
      NonCreel_Retained<-if(input$NonCreel_Summary_Switch==TRUE){
        Summary_WarningData()%>%
          filter(.,Survey_Type=="Creel Survey")%>%
          select(Survey_ID)
        }else{
            Summary_WarningData()%>%
              select(Survey_ID)
        }

      Timing_Retained<-if(input$UnkTiming_Summary_Switch==TRUE){
        Summary_WarningData()%>%
          filter(.,!Timing_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Summary_WarningData()%>%
              select(Survey_ID)
        }

      Location_Retained<-if(input$UnkLocation_Summary_Switch==TRUE){
        Summary_WarningData()%>%
          filter(.,!Location_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Summary_WarningData()%>%
              select(Survey_ID)
        }

      Extent_Retained<-if(input$UnkExtent_Summary_Switch==TRUE){
        Summary_WarningData()%>%
          filter(.,!Extent_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Summary_WarningData()%>%
              select(Survey_ID)
        }

      FocalTaxa_Retained<-if(input$FocSpecies_Summary_Switch==TRUE){
        Summary_WarningData()%>%
          filter(.,Focal_Species==c("All"))%>%
          select(Survey_ID)
        }else{
            Summary_WarningData()%>%
              select(Survey_ID)
        }
      
        Summary_Survey_Filt<-NonCreel_Retained%>%
          semi_join(.,Timing_Retained,by='Survey_ID')%>%
          semi_join(.,Location_Retained,by='Survey_ID')%>%
          semi_join(.,Extent_Retained,by='Survey_ID')%>%
          semi_join(.,FocalTaxa_Retained,by='Survey_ID')%>%
          droplevels()

    return(Summary_Survey_Filt)
    
   })

 CompiledSummaryInput_DatTaxa<-reactive({
      req(CompiledSummaryInput_Dat_Raw())
      req(input$Survey_Summary_FieldGroup_Picker)
      req(input$Survey_Summary_FieldValue_Picker)
      
      SummaryUnattributedSurveys_Retained<-if(is.null(Summary_UnattributedFishTaxa())){
        CompiledSummaryInput_Dat_Raw()%>%
          select(Survey_ID)
      }else if(input$UnFish_Summary_Switch==TRUE){
        CompiledSummaryInput_Dat_Raw()%>%
        anti_join(Summary_UnattributedFishTaxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        CompiledSummaryInput_Dat_Raw()%>%
          select(Survey_ID)
      }

      SummaryIncompleteSurveys_Retained<-if(is.null(Summary_IncompleteAttributedFishTaxa())){
        CompiledSummaryInput_Dat_Raw()%>%
          select(Survey_ID)
      }else if(input$InFishGroup_Summary_Switch==TRUE){
        CompiledSummaryInput_Dat_Raw()%>%
        anti_join(Summary_IncompleteAttributedFishTaxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        CompiledSummaryInput_Dat_Raw()%>%
          select(Survey_ID)
      }

      SummaryUnattributedTargetSurveys_Retained<-if(is.null(Summary_UnattributedTarget_Taxa())){
        CompiledSummaryInput_Dat_Raw()%>%
          select(Survey_ID)
      }else if(input$UnTarget_Summary_Switch==TRUE){
        CompiledSummaryInput_Dat_Raw()%>%
        anti_join(Summary_UnattributedTarget_Taxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        CompiledSummaryInput_Dat_Raw()%>%
          select(Survey_ID)
      }

      SummaryIncompleteTargetSurveys_Retained<-if(is.null(Summary_IncompleteAttributedTarget_Taxa())){
        CompiledSummaryInput_Dat_Raw()%>%
          select(Survey_ID)
      }else if(input$InTargetGroup_Summary_Switch==TRUE){
        CompiledSummaryInput_Dat_Raw()%>%
        anti_join(Summary_IncompleteAttributedTarget_Taxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        CompiledSummaryInput_Dat_Raw()%>%
          select(Survey_ID)
      }
       
        Summary_Survey_Filt<-SummaryUnattributedSurveys_Retained%>%
          semi_join(.,SummaryIncompleteSurveys_Retained,by='Survey_ID')%>%
          semi_join(.,SummaryUnattributedTargetSurveys_Retained,by='Survey_ID')%>%
          semi_join(.,SummaryIncompleteTargetSurveys_Retained,by='Survey_ID')%>%
          droplevels()

    return(Summary_Survey_Filt)
    
   })
 
 CompiledSummaryInput_Dat<-reactive({
  req(CompiledSummaryInput_DatTaxa())
  req(CompiledSummaryInput_DatSurvey())
  req(Summary_Selected_NA_TBL())
  
  Summary_Selected_NA_TBL()%>%
    semi_join(.,CompiledSummaryInput_DatSurvey(),by='Survey_ID')%>%
    semi_join(.,CompiledSummaryInput_DatTaxa(),by='Survey_ID')%>%
    droplevels()
  
})
 


    Summary_Retained_Surveys<-reactive({      
      CompiledSummaryInput_Dat()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
    })
    
    Summary_Dropped_Surveys<-reactive({
      CompiledSummaryInput_Dat_Raw()%>%anti_join(CompiledSummaryInput_Dat(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))%>%
        unique()
    })


   output$Summary_Dropped_TBL<-DT::renderDataTable(
    Summary_Dropped_Surveys(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

  output$Summary_Retained_TBL<-DT::renderDataTable(
    Summary_Retained_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
   Summary_Dropped_NA_Surveys<-reactive({
     req(Summary_Selected_NA_TBL(),
         CompiledSummaryInput_Dat_Raw()
         )
     CompiledSummaryInput_Dat_Raw()%>%
       anti_join(Summary_Selected_NA_TBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })
   
   Summary_Dropped_NA_Warn_Surveys<-reactive({
     req(Summary_Dropped_NA_Surveys())
     as.list(as.character(unique(Summary_Dropped_NA_Surveys()$Survey_ID)))
     })
   
   Summary_Dropped_NA_Warn_Surveys_Count<-reactive({
     length(Summary_Dropped_NA_Warn_Surveys())
     })
   
    Summary_Retained_NA_Surveys<-reactive({
      req(Summary_Selected_NA_TBL())
     Summary_Selected_NA_TBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })

   Summary_Retained_NA_Warn_Surveys<-reactive({
     req(Summary_Retained_NA_Surveys())
     as.list(as.character(unique(Summary_Retained_NA_Surveys()$Survey_ID)))
     })
   
   Summary_Retained_NA_Warn_Surveys_Count<-reactive({
     req(Summary_Retained_NA_Warn_Surveys())
     length(Summary_Retained_NA_Warn_Surveys())
     })
   
   output$Summary_Dropped_NA_Warning<-renderText({
    if(length(Summary_Dropped_NA_Warn_Surveys())>0){
      return(paste(as.character(actionLink(inputId = "Summary_NA_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Summarization input fields contain NA values. Surveys containing NA for a summarization input are automatically dropped. </span><span style=\"color:red;font-weight:bold\">", Summary_Dropped_NA_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been dropped;</><span style=\"color:green;font-weight:bold\">",Summary_Retained_NA_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been retained</>"))
  }else {
  } 
  })
      output$Summary_Survey_Char_Drop<-renderText({
        return(paste(as.character(actionLink(inputId = "SummarySurveyDropCharacteristicsTip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black;font-weight:bold\">Survey Characteristic Drops </span>"))
      })
      
      output$Summary_Taxa_Atr_Drop<-renderText({
        return(paste(as.character(actionLink(inputId = "SummaryTaxaAttributionDropTip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black;font-weight:bold\">Taxa Attribution Issue Drops </span>"))
      })
  
  observeEvent(input$Summary_NA_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Dropped NA Inputs"),
            h4(strong("Selected surveys contain 'NA' values for inputs which are automatically dropped: ")),
            h4("Summarizations are unable to accomodate 'NA' values for any inputs and they are therefore automatically dropped."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
   
   output$Summary_Dropped_NA_TBL_Pop<-reactive({
      
      length(Summary_Dropped_NA_Warn_Surveys())
      })
    outputOptions(output,'Summary_Dropped_NA_TBL_Pop',suspendWhenHidden=FALSE)
   
   output$Summary_Dropped_NA_TBL<-DT::renderDataTable(
    Summary_Dropped_NA_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
  output$Summary_Retained_NA_TBL<-DT::renderDataTable(
    Summary_Retained_NA_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
  

   Summary_Dropped_All_Surveys<-reactive({
      
     req(CompiledSummaryInput_Dat(),
         CompiledSummaryInput_Dat_Raw()
         )
     
     CompiledSummaryInput_Dat_Raw()%>%
       anti_join(CompiledSummaryInput_Dat(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })
   
   
   Summary_Dropped_All_Warn_Surveys<-reactive({
     req(Summary_Dropped_All_Surveys())
     as.list(as.character(unique(Summary_Dropped_All_Surveys()$Survey_ID)))
     })
   
   Summary_Dropped_All_Warn_Surveys_Count<-reactive({
     length(Summary_Dropped_All_Warn_Surveys())
     })
   
    Summary_Retained_All_Surveys<-reactive({
      req(CompiledSummaryInput_Dat())
     CompiledSummaryInput_Dat()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })

   Summary_Retained_All_Warn_Surveys<-reactive({
     req(Summary_Retained_All_Surveys())
     as.list(as.character(unique(Summary_Retained_All_Surveys()$Survey_ID)))
     })
   
   Summary_Retained_All_Warn_Surveys_Count<-reactive({
     req(Summary_Retained_All_Warn_Surveys())
     length(Summary_Retained_All_Warn_Surveys())
     })
   
   output$Summary_Dropped_All_Warning<-renderText({
    if(length(Summary_Dropped_All_Warn_Surveys())>0){
      return(paste(as.character(actionLink(inputId = "Summary_Dropped_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Surveys containing NA for summarization inputs or user-selected drop characteristics have been dropped. </span><span style=\"color:red;font-weight:bold\">", Summary_Dropped_All_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been dropped;</><span style=\"color:green;font-weight:bold\">",Summary_Retained_All_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been retained</>"))
  }else {
  } 
  })

  
  observeEvent(input$Summary_Dropped_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Dropped Surveys"),
            h4(strong("Selected surveys contain 'NA' values for inputs or characteristics which match user selected 'Drop' criteria from switches above: ")),
            h4("Summarizations are unable to accomodate 'NA' values for any inputs and they are therefore automatically dropped."),
            h4("Surveys sometimes contain undesireable attributes or contain input taxa with attribution issues which lead to the user to drop them from the summarization by switching the toggles above."),
            h4("This warning reports the total number of surveys which were selected to be included in the summarization as well as the number of surveys which have been dropped either due to NA inputs, undesireable survey characteristics, or the presence of input taxa attribution issues."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$SummarySurveyDropCharacteristicsTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Drop Based on Survey Characteristics"),
            h4(strong("Undesireable Survey Characteristics: ")),
            h4("Surveys occasionally contain undesireable characteristics which may result in a user wishing to exclude/drop them from thier summarization."),
            h4("By toggling the switches in this section users can decide whether they wish to retain or drop surveys with the following characteristcis."),
            h4(strong("Non-Creel Approaches: "), "Drops surveys which are not classified as 'Creel Survey'. These typically include things like Mail/Phone/Internet Surveys."),
            h4(strong("Unknown/Uncertain Timing: "), "Drops surveys for which are missing start and/or end dates"),
            h4(strong("Unknown/Uncertain Location: "), "Drops surveys for which the location of the waterbody being surveyed can not be confirmed."),
            h4(strong("Unknown/Uncertain Spatial Extent: "), "Drops surveys for which the spatial extent of a survey can not be confirmed."),
            h4(strong("Focal Species: "), "Drops surveys which focus on only a single or group of taxa rather than the entire community."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$SummaryTaxaAttributionDropTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),title = strong("Drop Based on Taxa Attribution Issues"),
            h4(strong("Taxa attribution issues: ")),
            h4("Surveys occasionally contain issues with the attribution of values to taxa."),
            h4("By toggling the switches in this section users can decide whether they wish to retain or drop surveys with the following characteristics."),
            h4(strong("Unattributed Input Fish Taxa: "), "Drops surveys for which one of the summarization inputs contains a fish taxa which cannot be attributed 
               (see tip at unattributed taxa warning in the warning panel for more details). Note: For summarizations wholly unattributed taxa are 'Null' so they 
               are dropped automatically, however partially attributed data are contain both attributed values and potentially unattributed values and therefore require 
               toggling of this switch to drop in order to remove."),
            h4(strong("Incomplete Input Fish Groups: "), "Drops surveys for which one of the summarization inputs contains a fish groups which have incomplete attribution 
               (see tip at incomplete group warning in the warning panel for more details)."),
            h4(strong("Unattributed Input Target Taxa: "), "Drops surveys for which one of the summarization inputs contains a target taxa which cannot be attributed 
               (see tip at unattributed target taxa warning in the warning panel for more details). Note: For summarizations wholly unattributed target taxa are 'Null' so they 
               are dropped automatically, however partially attributed data are contain both attributed values and potentially unattributed values and therefore require 
               toggling of this switch to drop in order to remove."),
            h4(strong("Incomplete Input Target Groups: "), "Drops surveys for which one of the summarization inputs contains a target groups which have incomplete attribution 
               (see tip at incomplete group warning in the warning panel for more details)."),
        easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$SummaryWarningTableTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("View Warning Tables"),
            h4(strong("Select whether you wish to view tables which summarize any of the listed warning attributes: ")),
            h4(strong("Retained Surveys: "), "Table showing surveys which were retained after surveys which contained 'NA' in at least one summarization input or contained undesireable survey characteristics or input taxa attribution issues were dropped."),
            h4(strong("Dropped Surveys: "), "Table showing surveys which were dropped due to the presence of an 'NA' in at least one summarization input or undesireable survey characteristics or taxa attribution issues."),
            h4(strong("Retained NA Surveys: "), "Table showing surveys which were retained after surveys which contained 'NA' in at least one summarization input were dropped."),
            h4(strong("Dropped NA Surveys: "), "Table showing surveys which were dropped due to the presence of an 'NA' in at least one summarization input."),
            h4(strong("Non-Creel Approaches: "), "Table showing surveys which used any approach not classified as a 'Creel Survey'."),
            h4(strong("Unknown/Uncertain Timing: "), "Table showing surveys which were flagged ashaving unknown or uncertain timing."),
            h4(strong("Unknown/Uncertain Location: "), "Table showing surveys which were flagged ashaving unknown or uncertain locations."),
            h4(strong("Unknown/Uncertain Spatial Extent: "), "Table showing surveys which were flagged ashaving unknown or uncertain spatial extents."),
            h4(strong("Focal Species: "), "Table showing surveys which were conducted based on a focal species rather than the full community."),
            h4(strong("Unattributed Taxa: "), "Table showing records containing unattributed input taxa."),
            h4(strong("Partially Attributed Taxa: "), "Table showing records containing partially attributed input taxa."),
            h4(strong("Incomplete Groups: "), "Table showing records containing incomplete attribution of input groups."),
            h4(strong("Unattributed Target Taxa: "), "Table showing records containing unattributed input target taxa."),
            h4(strong("Partially Attributed Target Taxa: "), "Table showing records containing partially attributed input target taxa."),
            h4(strong("Incomplete Target Groups: "), "Table showing records containing incomplete attribution of input target groups."),
        easyClose = TRUE
        ))
    },ignoreInit=TRUE)
   
   output$Summary_Dropped_All_TBL<-DT::renderDataTable(
    Summary_Dropped_All_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
  output$Summary_Retained_All_TBL<-DT::renderDataTable(
    Summary_Retained_All_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
  
   output$Summary_FishTaxaHeading<-renderText({
    if((length(SummaryUnattributedTaxa_Warn_Taxa())>0)||
       (length(SummaryIncompleteAttributedTaxa_Warn_Taxa())>0)||
       (nchar(Summary_Overlap_Warn())>1)){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Fish Taxa Input Attribution Issues: </span></h4>"))
  }else {

  }
  })  
   
   output$Summary_AngPrefTaxaHeading<-renderText({
    if((length(SummaryUnattributedTarget_Taxa_Warn_Taxa())>0)||
       (length(SummaryIncompleteAttributedTarget_Taxa_Warn_Taxa())>0)||
       (nchar(TargetSummary_Overlap_Warn())>1)
       ){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Angler Preference Taxa Input Attribution Issues: </span></h4>"))
  }else {

  }
  })  
   
  SummaryUnattributedTaxa_Count<-reactive({
    if(is.null(Summary_UnattributedFishTaxa())){
      return(NULL)
    }else{
     Summary_UnattributedFishTaxa()%>%
     count(Taxa)%>%
     unite(Unattributed_Records,"Taxa","n",sep="-")
    }
     })

   SummaryUnattributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(SummaryUnattributedTaxa_Count()$Unattributed_Records))
     })
   
   SummaryUnattributedTaxa_Warn_Vals<-reactive({
     paste(SummaryUnattributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Summary_UnattributedFishTaxaWarning<-renderText({
    if(length(SummaryUnattributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Summary_Unattributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include unattributed taxa: </span><span style=\"color:red;font-weight:bold\">", SummaryUnattributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })

  
  observeEvent(input$Summary_Unattributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unattributed Fish Taxa"),
            h4(strong("Selected surveys contain unattributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The list identifies which taxa have unattributed records in the dataset and how 
               many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a summarization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


   output$Summary_UnattributedTBL_Pop<-reactive({
      length(SummaryUnattributedTaxa_Warn_Taxa())
      })
   
    outputOptions(output,'Summary_UnattributedTBL_Pop',suspendWhenHidden=FALSE)

   output$Summary_UnattributedFishTaxa_TBL<-DT::renderDataTable(
    Summary_UnattributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Attributed Taxa Suggestions ###
    Summary_Attributed_Gain<-reactive({
    if(is.null(Summary_UnattributedFishTaxa())){return(NULL)}else{
     Summary_UnattributedFishTaxa()%>%
     count(Attributed_Taxa)%>%
     unite(GainedRecords,"Attributed_Taxa","n",sep="-")
    }
     })

   SummaryAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Summary_Attributed_Gain()$GainedRecords))
     })
   
   SummaryAttributedTaxa_Warn_Vals<-reactive({
     paste(SummaryAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Summary_AttributedFishTaxaWarning<-renderText({
    if(length(SummaryUnattributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Summary_Attributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Consider replacing unattributed and partially attributed taxa with attributed taxa: </span><span style=\"color:green;font-weight:bold\">", SummaryAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Summary_Attributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Alternative Attributed Fish Taxa"),
            h4(strong("Alternatives to unattributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The species in this list show the taxa which were originall attributed 
               in the creel survey (ie. what level the taxa was initially recorded at) and the number of records for which this is the case."),
            h4(strong("Recommendation: "),"If possible replace the unattributed taxa with the recommended attributed taxa. Doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a summarization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


# Partially Attributed Species #
   
   SummaryPartiallyAttributedTaxa_Count<-reactive({
    if(is.null(Summary_PartiallyAttributedFishTaxa())){
      return(NULL)
    } else {
     Summary_PartiallyAttributedFishTaxa()%>%
     count(Taxa)%>%
     unite(PartiallyAttributed_Records,"Taxa","n",sep="-")
    }
     })

   SummaryPartiallyAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(SummaryPartiallyAttributedTaxa_Count()$PartiallyAttributed_Records))
     })
   
   SummaryPartiallyAttributedTaxa_Warn_Vals<-reactive({
     paste(SummaryPartiallyAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Summary_PartiallyAttributedFishTaxaWarning<-renderText({
    if(length(SummaryPartiallyAttributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Summary_PartiallyAttributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include partially attributed taxa: </span><span style=\"color:red;font-weight:bold\">", SummaryPartiallyAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Summary_PartiallyAttributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Partially Attributed Fish Taxa"),
            h4(strong("Selected surveys contain partially attributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). Occasionally a survey may record data across multiple overlapping taxanomic 
               levels creating partially attributed taxa. In these cases a survey may contain values attributed to both 'Black Crappie' (species) and 'Crappie' (genus). In thise case the value attributed to 'Black 
               Crappie' represents some, but not necessarily all, of the 'Black Crappie' in the survey as some of the values associated with 'Crappie' (genus) may actually also be 'Black Crappie'. Because of this 
               surveys which include both 'Black Crappie' and  'Crappie' attributions are considered partial attributions (ie. we can not fully attribute the 'Black Crappie' values). The list identifies which taxa have 
               partially attributed records in the dataset and how many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a summarization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed or partially attributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip: "), "'Partially Attributed' taxa have both attributed and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset. Otherwise 
               partially attributed records will be included in the dataset but only include the directly attributed values without consideration of potential missing values from the unattributed portion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


   output$Summary_PartiallyAttributedTBL_Pop<-reactive({
      
      length(SummaryPartiallyAttributedTaxa_Warn_Taxa())
      })
    outputOptions(output,'Summary_PartiallyAttributedTBL_Pop',suspendWhenHidden=FALSE)

   output$Summary_PartiallyAttributedFishTaxa_TBL<-DT::renderDataTable(
    Summary_PartiallyAttributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Incomplete Groups #
      
     SummaryIncompleteAttributedTaxa_Count<-reactive({
    if(is.null(Summary_IncompleteAttributedFishTaxa())){
      return(NULL)
    }else{
     Summary_IncompleteAttributedFishTaxa()%>%
     count(Taxa)%>%
     unite(IncompleteAttributed_Records,"Taxa","n",sep="-")
    }
     })

   SummaryIncompleteAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(SummaryIncompleteAttributedTaxa_Count()$IncompleteAttributed_Records))
     })
   
   SummaryIncompleteAttributedTaxa_Warn_Vals<-reactive({
     paste(SummaryIncompleteAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Summary_IncompleteAttributedFishTaxaWarning<-renderText({
    if(length(SummaryIncompleteAttributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Summary_IncompleteAttributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include groups with incomplete attribution of taxa: </span><span style=\"color:red;font-weight:bold\">", SummaryIncompleteAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Summary_IncompleteAttributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Incomplete Attribution of Fish Taxa"),
            h4(strong("Selected surveys contain incompletely attributed fish groups in inputs: ")),
            h4("Values for groups are typically generated either as a direct attribution of the group in the survey (ie. 'Panfish' estimates recorded directly), or by summing values for all component members 
            (ie. 'Trout' estimate generated by adding values from 'Rainbow Trout', 'Brook Trout', and 'Brown Trout'). Because groups are not monophyletic there can be cases when a group value may be incompletely 
            attributed due to component taxa which span within and outside group status (ie. a survey containing values attributed to the genus' 'Salvelinus' and 'Onchorynchus', while all values for 'Salvelinus' can 
            be (and therefore are) attributed to 'Trout', 'Onchorynchus'  includes both 'Trout' (Rainbow Trout, Cutthroat Trout...) and 'Non-Trout' (Chinook Salmon, Coho Salmon...), and therefore can not be attributed to 'Trout' 
            although some portion of those values may actually be 'Trout'.). In this case the records for 'Trout' are identified as 'Incomplete' meaning that some taxa are present within the record which may or may not be attributable 
            to the selected 'Group'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping incompletely attributed fish group records by toggling the 'Incomplete Input Fish Groups'  
               switch from 'Retained' to 'Dropped'."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)



   output$Summary_IncompleteTBL_Pop<-reactive({
      
      length(SummaryIncompleteAttributedTaxa_Warn_Taxa())
      })
    outputOptions(output,'Summary_IncompleteTBL_Pop',suspendWhenHidden=FALSE)

   output$Summary_IncompleteAttributedFishTaxa_TBL<-DT::renderDataTable(
    Summary_IncompleteAttributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )



   ### Overlapping Taxa Selection ###

FamilySummary_Selected<-reactive({
  TaxaTable%>%filter(Family %in% SummaryInputFishTaxa())%>%select(Family)%>%unique()
  })
GenusSummary_Selected<-reactive({
      
  TaxaTable%>%filter(Genus %in% SummaryInputFishTaxa())%>%select(Family,Genus)%>%unique()
  })
SpeciesSummary_Selected<-reactive({
      
  TaxaTable%>%filter(Species %in% SummaryInputFishTaxa())%>%select(Family,Genus,Species)%>%unique()
  })
SubsSummary_Selected<-reactive({
      
  TaxaTable%>%filter(Subspecies_Variants %in% SummaryInputFishTaxa())%>%select(Family,Genus,Species,Subspecies_Variants)%>%unique()
  })


Genus_Family_Summary_Overlap<-reactive({
      
  req(GenusSummary_Selected())
  req(FamilySummary_Selected())
  
  GenusSummary_Selected()%>%
  inner_join(FamilySummary_Selected(),by='Family')%>%
  select(Family,Genus)%>%
  unite(Overlaps,"Family","Genus",sep=" overlaps ")})

Species_Family_Summary_Overlap<-reactive({
      
  req(SpeciesSummary_Selected())
  req(FamilySummary_Selected())
  
  SpeciesSummary_Selected()%>%
  inner_join(FamilySummary_Selected(),by='Family')%>%
  select(Family,Species)%>%
  unite(Overlaps,"Family","Species",sep=" overlaps ")})

Species_Genus_Summary_Overlap<-reactive({
      
  req(SpeciesSummary_Selected())
  req(GenusSummary_Selected())
  
  SpeciesSummary_Selected()%>%
  inner_join(GenusSummary_Selected(),by='Genus')%>%
  select(Genus,Species)%>%
  unite(Overlaps,"Genus","Species",sep=" overlaps ")})

Subspecies_Family_Summary_Overlap<-reactive({
  req(SubsSummary_Selected())
  req(FamilySummary_Selected())
  
  SubsSummary_Selected()%>%
  inner_join(FamilySummary_Selected(),by='Family')%>%
  select(Family,Subspecies_Variants)%>%
  unite(Overlaps,"Family","Subspecies_Variants",sep=" overlaps ")})

Subspecies_Genus_Summary_Overlap<-reactive({
      
  req(SubsSummary_Selected())
  req(GenusSummary_Selected())
  
  SubsSummary_Selected()%>%
  inner_join(GenusSummary_Selected(),by='Genus')%>%
  select(Genus,Subspecies_Variants)%>%
  unite(Overlaps,"Genus","Subspecies_Variants",sep=" overlaps ")})

Subspecies_Species_Summary_Overlap<-reactive({
      
  req(SubsSummary_Selected())
  req(SpeciesSummary_Selected())
  
  SubsSummary_Selected()%>%
  inner_join(SpeciesSummary_Selected(),by='Species')%>%
  select(Species,Subspecies_Variants)%>%
  unite(Overlaps,"Species","Subspecies_Variants",sep=" overlaps ")})

Group_Taxa_Summary_Overlap<-reactive({
  req(SummaryInputFishTaxa())
  
  GroupTaxa%>%
  filter(Group %in% SummaryInputFishTaxa())%>%
  filter(Taxa %in% SummaryInputFishTaxa_NoGroup())%>%
  unite(Overlaps,"Group","Taxa",sep=" overlaps ")%>%
  select(Overlaps)})

SummaryOverlaps<-reactive({
  PH<-as.list(bind_rows(Genus_Family_Summary_Overlap(),Species_Family_Summary_Overlap(),Species_Genus_Summary_Overlap(),Subspecies_Family_Summary_Overlap(),Subspecies_Genus_Summary_Overlap(),Subspecies_Species_Summary_Overlap(),Group_Taxa_Summary_Overlap()))
return(PH)
})

   SummaryOverlapTaxa_Warn<-reactive({
     as.list(as.character(unique(SummaryOverlaps()$Overlaps)))
     })
   
   Summary_Overlap_Warn<-reactive({
     paste(SummaryOverlapTaxa_Warn(),collapse=" & ")
     })

   output$Summary_OverlapFishWarning<-renderText({
    if(nchar(Summary_Overlap_Warn())>1){
      return(paste(as.character(actionLink(inputId = "Summary_Overlap_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input taxa include overlapping value attribution: </span><span style=\"color:red;font-weight:bold\">", Summary_Overlap_Warn(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Summary_Overlap_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Overlap of Input Fish Taxa"),
            h4(strong("Selected fish inputs contain overlapping taxa: ")),
            h4("Taxa can be attributed at multiple, overlapping taxanomic levels and therefore the associated values can result in overlap or double counting (ie. a user selects both 
               'Bluegill' (Species) and 'Lepomis' (Genus) harvest estimates, the harvest estimate attributable to 'Bluegill'(10) is also included within 'Lepomis'(30), meaning of the 30 'Lepomis' individuals harvested 10 of them are the 
               same as the 10 recorded in Bluegill, while 20 of them are from different 'Lepomis' taxa."),
            h4(strong("Recommendation: "),"We suggest avoiding overlapping taxa whereever possible to avoid double, triple, etc. counting of values. In order to do this select only non-overlapping taxa for inputs."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)


  SummaryUnattributedTarget_Taxa_Count<-reactive({
    if(is.null(Summary_UnattributedTarget_Taxa())){
      return(NULL)
    }else{
     Summary_UnattributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(Unattributed_Records,"Taxa","n",sep="-")
    }
     })

   SummaryUnattributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(SummaryUnattributedTarget_Taxa_Count()$Unattributed_Records))
     })
   
   SummaryUnattributedTarget_Taxa_Warn_Vals<-reactive({
     paste(SummaryUnattributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Summary_UnattributedTarget_TaxaWarning<-renderText({
    if(length(SummaryUnattributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Summary_Unattributed_Target_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include unattributed target taxa: </span><span style=\"color:red;font-weight:bold\">", SummaryUnattributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Summary_Unattributed_Target_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unattributed Target Taxa"),
            h4(strong("Selected surveys contain unattributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The list identifies which taxa have unattributed records in the dataset and how 
               many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a summarization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   # Attributed Taxa Suggestions ###
    Summary_Attributed_TargetGain<-reactive({
      if(is.null(Summary_UnattributedTarget_Taxa())){
        return(NULL)
      }else{
     return(Summary_UnattributedTarget_Taxa()%>%
     count(Attributed_Target_Taxa)%>%
     unite(GainedRecords,"Attributed_Target_Taxa","n",sep="-"))
      }
     })

   SummaryAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Summary_Attributed_TargetGain()$GainedRecords))
     })
   
   SummaryAttributedTarget_Taxa_Warn_Vals<-reactive({paste(SummaryAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")})

   output$Summary_AttributedTarget_TaxaWarning<-renderText({
    if(nchar(SummaryAttributedTarget_Taxa_Warn_Vals())>1){
      return(paste(as.character(actionLink(inputId = "Summary_AttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Consider replacing unattributed and partially attributed taxa with attributed taxa: </span><span style=\"color:green;font-weight:bold\">", SummaryAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Summary_AttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Alternative Attributed Target Taxa"),
            h4(strong("Alternatives to unattributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The species in this list show the taxa which were originall attributed 
               in the creel survey (ie. what level the taxa was initially recorded at) and the number of records for which this is the case."),
            h4(strong("Recommendation: "),"If possible replace the unattributed target taxa with the recommended attributed target taxa. Doing so will reduce the instances of 
               unattributed target taxa in the selected dataset/inputs. For example a user may wish to create a summarization related to 'Black Crappie' (Species), however if a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Summary_UnattributedTargetTBL_Pop<-reactive({
      length(SummaryUnattributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Summary_UnattributedTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Summary_UnattributedTarget_Taxa_TBL<-DT::renderDataTable(
    Summary_UnattributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
 SummaryPartiallyAttributedTarget_Taxa_Count<-reactive({
    if(is.null(Summary_PartiallyAttributedTarget_Taxa())){
      return(NULL)
    } else {
     Summary_PartiallyAttributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(PartiallyAttributed_Records,"Taxa","n",sep="-")
    }
     })

   SummaryPartiallyAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(SummaryPartiallyAttributedTarget_Taxa_Count()$PartiallyAttributed_Records))
     })
   
   SummaryPartiallyAttributedTarget_Taxa_Warn_Vals<-reactive({
     paste(SummaryPartiallyAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Summary_PartiallyAttributedFishTarget_TaxaWarning<-renderText({
    if(length(SummaryPartiallyAttributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Summary_PartiallyAttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include partially attributed target taxa: </span><span style=\"color:red;font-weight:bold\">", SummaryPartiallyAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })

    observeEvent(input$Summary_PartiallyAttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Partially Attributed Target Taxa"),
            h4(strong("Selected surveys contain partially attributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). Occasionally a survey may record data across multiple overlapping taxanomic 
               levels creating partially attributed taxa. In these cases a survey may contain values attributed to both 'Black Crappie' (species) and 'Crappie' (genus). In thise case the value attributed to 'Black 
               Crappie' represents some, but not necessarily all, of the 'Black Crappie' in the survey as some of the values associated with 'Crappie' (genus) may actually also be 'Black Crappie'. Because of this 
               surveys which include both 'Black Crappie' and  'Crappie' attributions are considered partial attributions (ie. we can not fully attribute the 'Black Crappie' values). The list identifies which taxa have 
               partially attributed records in the dataset and how many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a summarization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed or partially attributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Target Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip: "), "'Partially Attributed' taxa have both attributed and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset. Otherwise 
               partially attributed records will be included in the dataset but only include the directly attributed values without consideration of potential missing values from the unattributed portion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Summary_PartiallyAttributedTargetTBL_Pop<-reactive({
      length(SummaryPartiallyAttributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Summary_PartiallyAttributedTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Summary_PartiallyAttributedTarget_Taxa_TBL<-DT::renderDataTable(
    Summary_PartiallyAttributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Incomplete Groups #
   
     SummaryIncompleteAttributedTarget_Taxa_Count<-reactive({
    if(is.null(Summary_IncompleteAttributedTarget_Taxa())){
      return(NULL)
    }else{
     Summary_IncompleteAttributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(IncompleteAttributed_Records,"Taxa","n",sep="-")
    }
     })

   SummaryIncompleteAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(SummaryIncompleteAttributedTarget_Taxa_Count()$IncompleteAttributed_Records))
     })
   
   SummaryIncompleteAttributedTarget_Taxa_Warn_Vals<-reactive({
     paste(SummaryIncompleteAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Summary_IncompleteAttributedFishTarget_TaxaWarning<-renderText({
    if(length(SummaryIncompleteAttributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Summary_IncompleteAttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include groups with incomplete attribution of target taxa: </span><span style=\"color:red;font-weight:bold\">", SummaryIncompleteAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })  
   
  observeEvent(input$Summary_IncompleteAttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Incomplete Attribution of Target Taxa"),
            h4(strong("Selected surveys contain incompletely attributed target groups in inputs: ")),
            h4("Values for groups are typically generated either as a direct attribution of the group in the survey (ie. 'Panfish' estimates recorded directly), or by summing values for all component members 
            (ie. 'Trout' estimate generated by adding values from 'Rainbow Trout', 'Brook Trout', and 'Brown Trout'). Because groups are not monophyletic there can be cases when a group value may be incompletely 
            attributed due to component taxa which span within and outside group status (ie. a survey containing values attributed to the genus' 'Salvelinus' and 'Onchorynchus', while all values for 'Salvelinus' can 
            be (and therefore are) attributed to 'Trout', 'Onchorynchus'  includes both 'Trout' (Rainbow Trout, Cutthroat Trout...) and 'Non-Trout' (Chinook Salmon, Coho Salmon...), and therefore can not be attributed to 'Trout' 
            although some portion of those values may actually be 'Trout'.). In this case the records for 'Trout' are identified as 'Incomplete' meaning that some taxa are present within the record which may or may not be attributable 
            to the selected 'Group'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping incompletely attributed target group records by toggling the 'Incomplete Input Fish Groups'  
               switch from 'Retained' to 'Dropped'."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Summary_IncompleteTargetTBL_Pop<-reactive({
      
      length(SummaryIncompleteAttributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Summary_IncompleteTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Summary_IncompleteAttributedTarget_Taxa_TBL<-DT::renderDataTable(
    Summary_IncompleteAttributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )



   ### Overlapping Target Taxa Selection ###



TargetFamilySummary_Selected<-reactive({
  TaxaTable%>%filter(Family %in% SummaryInputTarget_Taxa())%>%select(Family)%>%unique()
  })
TargetGenusSummary_Selected<-reactive({
      
  TaxaTable%>%filter(Genus %in% SummaryInputTarget_Taxa())%>%select(Family,Genus)%>%unique()
  })
TargetSpeciesSummary_Selected<-reactive({
      
  TaxaTable%>%filter(Species %in% SummaryInputTarget_Taxa())%>%select(Family,Genus,Species)%>%unique()
  })
TargetSubsSummary_Selected<-reactive({
      
  TaxaTable%>%filter(Subspecies_Variants %in% SummaryInputTarget_Taxa())%>%select(Family,Genus,Species,Subspecies_Variants)%>%unique()
  })


TargetGenus_Family_Summary_Overlap<-reactive({
  req(TargetGenusSummary_Selected())
  req(TargetFamilySummary_Selected())
  
  TargetGenusSummary_Selected()%>%
  inner_join(TargetFamilySummary_Selected(),by='Family')%>%
  select(Family,Genus)%>%
  unite(Overlaps,"Family","Genus",sep=" overlaps ")
  })

TargetSpecies_Family_Summary_Overlap<-reactive({
  req(TargetSpeciesSummary_Selected())
  req(TargetFamilySummary_Selected())
  
  TargetSpeciesSummary_Selected()%>%
  inner_join(TargetFamilySummary_Selected(),by='Family')%>%
  select(Family,Species)%>%
  unite(Overlaps,"Family","Species",sep=" overlaps ")
  })

TargetSpecies_Genus_Summary_Overlap<-reactive({
  req(TargetSpeciesSummary_Selected())
  req(TargetGenusSummary_Selected())
  
  TargetSpeciesSummary_Selected()%>%
  inner_join(TargetGenusSummary_Selected(),by='Genus')%>%
  select(Genus,Species)%>%
  unite(Overlaps,"Genus","Species",sep=" overlaps ")
  })

TargetSubspecies_Family_Summary_Overlap<-reactive({
  req(TargetSubsSummary_Selected())
  req(TargetFamilySummary_Selected())
  
  TargetSubsSummary_Selected()%>%
  inner_join(TargetFamilySummary_Selected(),by='Family')%>%
  select(Family,Subspecies_Variants)%>%
  unite(Overlaps,"Family","Subspecies_Variants",sep=" overlaps ")
  })

TargetSubspecies_Genus_Summary_Overlap<-reactive({
  req(TargetSubsSummary_Selected())
  req(TargetGenusSummary_Selected())
  
  TargetSubsSummary_Selected()%>%
  inner_join(TargetGenusSummary_Selected(),by='Genus')%>%
  select(Genus,Subspecies_Variants)%>%
  unite(Overlaps,"Genus","Subspecies_Variants",sep=" overlaps ")
  })

TargetSubspecies_Species_Summary_Overlap<-reactive({
  req(TargetSubsSummary_Selected())
  req(TargetSpeciesSummary_Selected())
  
  TargetSubsSummary_Selected()%>%
  inner_join(TargetSpeciesSummary_Selected(),by='Species')%>%
  select(Species,Subspecies_Variants)%>%
  unite(Overlaps,"Species","Subspecies_Variants",sep=" overlaps ")
  })

TargetGroup_Taxa_Summary_Overlap<-reactive({
  req(SummaryInputTarget_Taxa())
  
    GroupTaxa%>%
  filter(Group %in% SummaryInputTarget_Taxa())%>%
  filter(Taxa %in% SummaryInputTarget_Taxa_NoGroup())%>%
  unite(Overlaps,"Group","Taxa",sep=" overlaps ")%>%
  select(Overlaps)
 
  })

TargetSummaryOverlaps<-reactive({
  PH<-as.list(bind_rows(TargetGenus_Family_Summary_Overlap(),TargetSpecies_Family_Summary_Overlap(),TargetSpecies_Genus_Summary_Overlap(),TargetSubspecies_Family_Summary_Overlap(),TargetSubspecies_Genus_Summary_Overlap(),TargetSubspecies_Species_Summary_Overlap(),TargetGroup_Taxa_Summary_Overlap()))
return(PH)
})

   TargetSummaryOverlapTaxa_Warn<-reactive({
     as.list(as.character(unique(TargetSummaryOverlaps()$Overlaps)))
     })
   
   TargetSummary_Overlap_Warn<-reactive({
     paste(TargetSummaryOverlapTaxa_Warn(),collapse=" & ")
     })

   output$Summary_OverlapTargetWarning<-renderText({
    if(nchar(TargetSummary_Overlap_Warn())>1){
      return(paste(as.character(actionLink(inputId = "TargetSummary_Overlap_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input target taxa include overlapping value attribution: </span><span style=\"color:red;font-weight:bold\">", TargetSummary_Overlap_Warn(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$TargetSummary_Overlap_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Overlap of Input Target Taxa"),
            h4(strong("Selected angler preference inputs contain overlapping target taxa: ")),
            h4("Taxa can be attributed at multiple, overlapping taxanomic levels and therefore the associated values can result in overlap or double counting (ie. a user selects both 
               'Bluegill' (Species) and 'Lepomis' (Genus) estimates, the estimate attributable to 'Bluegill'(10) is also included within 'Lepomis'(30), meaning of the 30 'Lepomis' values 10 of them are the 
               same as the 10 recorded in Bluegill, while 20 of them are from different 'Lepomis' taxa."),
            h4(strong("Recommendation: "),"We suggest avoiding overlapping taxa whereever possible to avoid double, triple, etc. counting of values. In order to do this select only non-overlapping target taxa for inputs."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)
 
 

  

  #### Data Warnings ####



#### Summarization Data Warnings ####
  
   Summary_WarningData<-reactive({
     CompiledSummaryInput_Dat_Raw()%>%select(Survey_ID)%>%left_join(Survey_Data)
     })


# Duration #
  Summary_DurationDifference<-reactive({
    req(Summary_WarningData())
    PH<-max(Summary_WarningData()$Duration,na.rm=TRUE)-min(Summary_WarningData()$Duration,na.rm=TRUE)
    })
  
  Summary_DurationDifferenceMin<-reactive({
    req(Summary_WarningData())
    PH<-min(Summary_WarningData()$Duration,na.rm=TRUE)
    })
  
  Summary_DurationDifferenceMax<-reactive({req(Summary_WarningData())
    PH<-max(Summary_WarningData()$Duration,na.rm=TRUE)
    })
  
  output$Summary_DurationWarning<-renderText({
    if(Summary_DurationDifference()>0){
      return(paste(as.character(actionLink(inputId = "Summary_DurationWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">The difference in duration of input surveys is </span><span style=\"color:red;font-weight:bold\">", Summary_DurationDifference(),"</span><span style=\"color:black\"> days: </span><span style=\"color:red;font-weight:bold\">",Summary_DurationDifferenceMin(),"to",Summary_DurationDifferenceMax()," days</span>"))
  }else if(Summary_DurationDifference()==0){
    return(paste(as.character(actionLink(inputId = "Summary_DurationWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys have the same duration:</span><span style=\"color:green;font-weight:bold\">",Summary_DurationDifferenceMin(),"</span><span style=\"color:black\"> days</span>"))
  } else {
      
    }
  })
  
  observeEvent(input$Summary_DurationWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Duration Warning"),
            h4(strong("Surveys span a range of durations: ")),
            h4("Creel surveys may be conducted for differing lengths of time. Expansions are typically calculated to generate estimates for the surveyed period. 
               Because of this care should be taken when comparing surveys with differences in duration."),
            h4(strong("Recommendation: "), "Select surveys with similar durations to minimize the impacts of comparing longer and shorter surveys."),
            h4(strong("Recommendation: "), "Select duration indepedent rate based metrics if surveys spanning a wide range of durations are to be used. Examples include 
               percentages of various metrics, or 'Per Day' estimates (Such as Harvest per Day)"),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
# Start and End Dates  
  Summary_StartDifferenceMin<-reactive({req(Summary_WarningData())
    PH<-month.name[min(as.numeric(format(Summary_WarningData()$Start_Date, '%m')),na.rm=TRUE)]})
  Summary_StartDifferenceMax<-reactive({req(Summary_WarningData())
    PH<-month.name[max(as.numeric(format(Summary_WarningData()$Start_Date, '%m')),na.rm=TRUE)]})
  Summary_EndDifferenceMin<-reactive({req(Summary_WarningData())
    PH<-month.name[min(as.numeric(format(Summary_WarningData()$End_Date, '%m')),na.rm=TRUE)]})
  Summary_EndDifferenceMax<-reactive({req(Summary_WarningData())
    PH<-month.name[max(as.numeric(format(Summary_WarningData()$End_Date, '%m')),na.rm=TRUE)]})
  
  output$Summary_StartWarning<-renderText({
    if(Summary_StartDifferenceMin()==Summary_StartDifferenceMax()){
      return(paste(as.character(actionLink(inputId = "Summary_StartWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All surveys begin in </span><span style=\"color:green;font-weight:bold\">", Summary_StartDifferenceMin(),"</span>"))
  }else {
    return(paste(as.character(actionLink(inputId = "Summary_StartWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Start dates for input surveys range from </span><span style=\"color:red;font-weight:bold\">",Summary_StartDifferenceMin(), "</span><span style=\"color:black\"> to </span><span style=\"color:red;font-weight:bold\">", Summary_StartDifferenceMax(), "</span>"))
  }
  })
  
    output$Summary_EndWarning<-renderText({
    if(Summary_EndDifferenceMin()==Summary_EndDifferenceMax()){
      return(paste(as.character(actionLink(inputId = "Summary_EndWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All surveys conclude in </span><span style=\"color:green;font-weight:bold\">", Summary_EndDifferenceMin(),".</span>"))
  }else {
    return(paste(as.character(actionLink(inputId = "Summary_EndWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Conclusion dates for input surveys range from </span><span style=\"color:red;font-weight:bold\">",Summary_EndDifferenceMin(), "</span><span style=\"color:black\"> to </span><span style=\"color:red;font-weight:bold\">", Summary_EndDifferenceMax(), "</span>"))
  }
  }) 
    

  
  observeEvent(input$Summary_StartWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may cover different periods of the year: ")),
            h4("Creel surveys may be conducted across a variety of time periods. Attention should be paid to the start and end dates of surveys (as well as duration) 
               in order to make sure selected surveys are valid for user defined applications. For example some surveys may cover the winter angling, while others may cover spring/summer, 
               while others still may generate annual estimates (or nearly)."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those matching desired time periods based on 'Start' and 'End' months and Duration."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Summary_EndWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may cover different periods of the year: ")),
            h4("Creel surveys may be conducted across a variety of time periods. Attention should be paid to the start and end dates of surveys (as well as duration) 
               in order to make sure selected surveys are valid for user defined applications. For example some surveys may cover the winter angling, while others may cover spring/summer, 
               while others still may generate annual estimates (or nearly)."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those matching desired time periods based on 'Start' and 'End' months and Duration."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  
    
# Survey Gaps #
    
    Summary_Survey_GapsWarn_Max<-reactive({req(Summary_WarningData())
      max(Summary_WarningData()$Lost_Duration,na.rm=TRUE)
      })
    
    output$Summary_Survey_GapsWarning<-renderText({
    if (Summary_Survey_GapsWarn_Max()>0){
      return(paste(as.character(actionLink(inputId = "Summary_Survey_GapsWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include those with gaps in the survey period. Maximum gap of: </span><span style=\"color:red;font-weight:bold\">", Summary_Survey_GapsWarn_Max(),"</span><span style=\"color:black\"> days.</span>"))
      } else {
    }
  })
    
  observeEvent(input$Summary_Survey_GapsWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Gap Warning"),
            h4(strong("Surveys may occasionally have a period of time between the start and end date when surveys (and associated expansions) do not occur: ")),
            h4("Creel surveys sometimes have periods of time for which the survey is suspended, often due to staffing issues. When documented we record both the lost duration 
               and months for which the survey was not taking place. This 'Lost Duration' is then substracted from the overall duration (End Date-Start Date) in order to provide an accurately 
               populate the 'Duration' field to reflect the number of days represented in survey estimates."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

# Survey Type #
    Summary_Survey_TypeWarn_Dat<-reactive({req(Summary_WarningData())
      as.list(as.character(unique(Summary_WarningData()$Survey_Type)))
      })
    
    Summary_Survey_TypeWarn_Vals<-reactive({req(Summary_Survey_TypeWarn_Dat())
      paste(Summary_Survey_TypeWarn_Dat(),collapse=" & ")
      })
    
    Summary_Survey_TypeWarn_Vals_3<-reactive({req(Summary_Survey_TypeWarn_Dat())
      paste(Summary_Survey_TypeWarn_Dat()[1:3],collapse=" & ")
      })
    
    Summary_Survey_TypeWarn_Count<-reactive({req(Summary_Survey_TypeWarn_Dat())
      paste(length(Summary_Survey_TypeWarn_Dat()),"Types;")
      })
    
  output$Summary_Survey_TypeWarning<-renderText({
    if(length(Summary_Survey_TypeWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Summary_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys are of the same type: </span><span style=\"color:green;font-weight:bold\">", Summary_Survey_TypeWarn_Dat(),"</span>"))
  }else if (length(Summary_Survey_TypeWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Summary_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple types: </span><span style=\"color:red;font-weight:bold\">", Summary_Survey_TypeWarn_Count(),Summary_Survey_TypeWarn_Vals_3(),as.character(actionLink(inputId = "Summary_Survey_TypeWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Summary_Survey_TypeWarn_Dat())<4&&length(Summary_Survey_TypeWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Summary_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple types: </span><span style=\"color:red;font-weight:bold\">", Summary_Survey_TypeWarn_Count(), Summary_Survey_TypeWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Summary_Survey_TypeWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Survey Methods"),
            HTML(paste(Summary_Survey_TypeWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Summary_Survey_TypeWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Types Warning"),
            h4(strong("Surveys may include multiple type classifications: ")),
            h4("While most of the surveys contained in CreelCat are creel surveys (angler interviews and counts conducted on-site) we also included other types of angler 
            surveys to provide a more complete picture of angler data, particularly for areas where traditional creel surveys are not conducted. Many (although not all) of the other survey 
               approaches included in CreelCat are Mail/Phone/Online surveys where licensed anglers responses are solicited from anglers about there activities remotely."),
            h4("Consideration should be given as to how the different survey methods may impact any inferences drawn from comparisons which include multiple survey types."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
    
# Interview Methods #
    Summary_Interview_MethodWarn_Dat<-reactive({req(Summary_WarningData())
      as.list(as.character(unique(Summary_WarningData()$Interview_Method)))
      })
    Summary_Interview_MethodWarn_Vals<-reactive({req(Summary_Interview_MethodWarn_Dat())
      paste(Summary_Interview_MethodWarn_Dat(),collapse=" & ")
      })
    
    Summary_Interview_MethodWarn_Vals_3<-reactive({req(Summary_Interview_MethodWarn_Dat())
      paste(Summary_Interview_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Summary_Interview_MethodWarn_Interview<-reactive({req(Summary_Interview_MethodWarn_Dat())
      paste(length(Summary_Interview_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Summary_Interview_MethodWarning<-renderText({
    if(length(Summary_Interview_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Summary_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same interview method: </span><span style=\"color:green;font-weight:bold\">", Summary_Interview_MethodWarn_Dat(),"</span>"))
  }else if (length(Summary_Interview_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Summary_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple interview methods: </span><span style=\"color:red;font-weight:bold\">", Summary_Interview_MethodWarn_Interview(),Summary_Interview_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Summary_Interview_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Summary_Interview_MethodWarn_Dat())<4&&length(Summary_Interview_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Summary_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple interview methods: </span><span style=\"color:red;font-weight:bold\">", Summary_Interview_MethodWarn_Interview(), Summary_Interview_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Summary_Interview_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Interview Methods"),
            HTML(paste(Summary_Interview_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Summary_Interview_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Interview Methods Warning"),
            h4(strong("Surveys may include multiple interview methodologies: ")),
            h4("Creel surveys can employ a variety of methods for interviewing anglers. This warning identifies the various interview methodology classifications 
               associated with your selected inputs."),
            h4("While differences in methods for conducting angler interviews is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Count Methods #
    Summary_Count_MethodWarn_Dat<-reactive({req(Summary_WarningData())
      as.list(as.character(unique(Summary_WarningData()$Count_Method)))
      })
    Summary_Count_MethodWarn_Vals<-reactive({req(Summary_Count_MethodWarn_Dat())
      paste(Summary_Count_MethodWarn_Dat(),collapse=" & ")
      })
    
    Summary_Count_MethodWarn_Vals_3<-reactive({req(Summary_Count_MethodWarn_Dat())
      paste(Summary_Count_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Summary_Count_MethodWarn_Count<-reactive({req(Summary_Count_MethodWarn_Dat())
      paste(length(Summary_Count_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Summary_Count_MethodWarning<-renderText({
    if(length(Summary_Count_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Summary_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same count method: </span><span style=\"color:green;font-weight:bold\">", Summary_Count_MethodWarn_Dat(),"</span>"))
  }else if (length(Summary_Count_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Summary_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple count methods: </span><span style=\"color:red;font-weight:bold\">", Summary_Count_MethodWarn_Count(),Summary_Count_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Summary_Count_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Summary_Count_MethodWarn_Dat())<4&&length(Summary_Count_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Summary_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple count methods: </span><span style=\"color:red;font-weight:bold\">", Summary_Count_MethodWarn_Count(), Summary_Count_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Summary_Count_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Count Methods"),
            HTML(paste(Summary_Count_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Summary_Count_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Count Methods Warning"),
            h4(strong("Surveys may include multiple count methodologies: ")),
            h4("Creel surveys can employ a variety of methods for counting the number of anglers. This warning identifies the various count methodology classifications 
               associated with your selected inputs."),
            h4("While differences in methods for conducting angler counts is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  

    
    
# Estimate Methods #
    Summary_Estimate_MethodWarn_Dat<-reactive({req(Summary_WarningData())
      as.list(as.character(unique(Summary_WarningData()$Estimate_Method)))
      })
    Summary_Estimate_MethodWarn_Vals<-reactive({req(Summary_Estimate_MethodWarn_Dat())
      paste(Summary_Estimate_MethodWarn_Dat(),collapse=" & ")
      })
    
    Summary_Estimate_MethodWarn_Vals_3<-reactive({req(Summary_Estimate_MethodWarn_Dat())
      paste(Summary_Estimate_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Summary_Estimate_MethodWarn_Estimate<-reactive({req(Summary_Estimate_MethodWarn_Dat())
      paste(length(Summary_Estimate_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Summary_Estimate_MethodWarning<-renderText({
    if(length(Summary_Estimate_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Summary_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same method for generating estimates: </span><span style=\"color:green;font-weight:bold\">", Summary_Estimate_MethodWarn_Dat(),"</span>"))
  }else if (length(Summary_Estimate_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Summary_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple methods for generating estimates: </span><span style=\"color:red;font-weight:bold\">", Summary_Estimate_MethodWarn_Estimate(),Summary_Estimate_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Summary_Estimate_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Summary_Estimate_MethodWarn_Dat())<4&&length(Summary_Estimate_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Summary_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple methods for generating estimates: </span><span style=\"color:red;font-weight:bold\">", Summary_Estimate_MethodWarn_Estimate(), Summary_Estimate_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Summary_Estimate_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Estimate Methods"),
            HTML(paste(Summary_Estimate_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Summary_Estimate_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Estimate Methods Warning"),
            h4(strong("Surveys may include multiple estimate methodologies: ")),
            h4("Creel surveys can employ a variety of methods for generating estimates. This warning identifies the various estimate methodology classifications 
               associated with your selected input surveys."),
            h4("While differences in methods for generating estimates is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    

# Focal Species #
    Summary_Focal_SpeciesWarn_Dat<-reactive({req(Summary_WarningData())
      as.list(as.character(unique(Summary_WarningData()$Focal_Species)))
      })
    Summary_Focal_SpeciesWarn_Vals<-reactive({req(Summary_Focal_SpeciesWarn_Dat())
      paste(Summary_Focal_SpeciesWarn_Dat(),collapse=" & ")
      })
    
    Summary_Focal_SpeciesWarn_Vals_3<-reactive({req(Summary_Focal_SpeciesWarn_Dat())
      paste(Summary_Focal_SpeciesWarn_Dat()[1:3],collapse=" & ")
      })
    
    Summary_Focal_SpeciesWarn_Estimate<-reactive({req(Summary_Focal_SpeciesWarn_Dat())
      paste(length(Summary_Focal_SpeciesWarn_Dat()),"Classes;")
      })
    
    
  output$Summary_Focal_SpeciesWarning<-renderText({
    if(length(Summary_Focal_SpeciesWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Summary_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys have the same classification for 'Focal Species': </span><span style=\"color:green;font-weight:bold\">", Summary_Focal_SpeciesWarn_Dat(),"</span>"))
  }else if (length(Summary_Focal_SpeciesWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Summary_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys have multiple classifications for 'Focal Species': </span><span style=\"color:red;font-weight:bold\">", Summary_Focal_SpeciesWarn_Estimate(),Summary_Focal_SpeciesWarn_Vals_3(),as.character(actionLink(inputId = "Summary_Focal_SpeciesWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Summary_Focal_SpeciesWarn_Dat())<4&&length(Summary_Focal_SpeciesWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Summary_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys have multiple classifications for 'Focal Species': </span><span style=\"color:red;font-weight:bold\">", Summary_Focal_SpeciesWarn_Estimate(), Summary_Focal_SpeciesWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Summary_Focal_SpeciesWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Focal Species Classifications"),
            HTML(paste(Summary_Focal_SpeciesWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Summary_Focal_SpeciesWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Focal Species Warning"),
            h4(strong("Surveys may include multiple classifications for focal species: ")),
            h4("Creel surveys typically assess the full range of species captured/targetted by anglers, however sometimes creel surveys may only consider certain focal species without consideration of others. This warning identifies what classifications of focal species are included within the pool of selected surveys."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those including those species you are analyzing. This can mean including only surveys focused on 'All' taxa, or if you are interested in a specific taxa only including surveys listed as either 'All' or your taxa of interest. You may use the button below in the warning panel to drop surveys which are not inclusive of 'All' taxa."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

# Waterbody Type #
    Summary_WB_TypeWarn_Dat<-reactive({req(Summary_WarningData())
      as.list(as.character(unique(Summary_WarningData()$WB_Type)))
      })
    Summary_WB_TypeWarn_Vals<-reactive({req(Summary_WB_TypeWarn_Dat())
      paste(Summary_WB_TypeWarn_Dat(),collapse=" & ")
      })
    
    Summary_WB_TypeWarn_Vals_3<-reactive({req(Summary_WB_TypeWarn_Dat())
      paste(Summary_WB_TypeWarn_Dat()[1:3],collapse=" & ")
      })
    
    Summary_WB_TypeWarn_Estimate<-reactive({req(Summary_WB_TypeWarn_Dat())
      paste(length(Summary_WB_TypeWarn_Dat()),"Classes;")
      })
    
    
  output$Summary_WB_TypeWarning<-renderText({
    if(length(Summary_WB_TypeWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Summary_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys are of the same waterbody type classification: </span><span style=\"color:green;font-weight:bold\">", Summary_WB_TypeWarn_Dat(),"</span>"))
  }else if (length(Summary_WB_TypeWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Summary_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys span multiple waterbody type classifications: </span><span style=\"color:red;font-weight:bold\">", Summary_WB_TypeWarn_Estimate(),Summary_WB_TypeWarn_Vals_3(),as.character(actionLink(inputId = "Summary_WB_TypeWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Summary_WB_TypeWarn_Dat())<4&&length(Summary_WB_TypeWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Summary_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys span multiple waterbody type classifications: </span><span style=\"color:red;font-weight:bold\">", Summary_WB_TypeWarn_Estimate(), Summary_WB_TypeWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Summary_WB_TypeWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Waterbody Type Classifications"),
            HTML(paste(Summary_WB_TypeWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Summary_WB_TypeWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Waterbody Type Warning"),
            h4(strong("Surveys may include multiple classifications for waterbody type: ")),
            h4("Creel surveys contained in CreelCat come from freshwater systems across the United States. We have done our best to classify waterbody types as either 'Lakes, Reservoirs, Ponds, and Tailraces' or 'Streams and Rivers'. This warning identifies what classifications of waterbody types exist within your selection of surveys."),
            h4("There is nothing necessarily problematic about including both types within an analysis, however users should be aware of the presence of both waterbody types when using the dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Flagged Warning Heading #
  output$Summary_FlaggedHeading<-renderText({
    if(Summary_Timing_WarnWarn_Count()>0||
       Summary_Location_WarnWarn_Count()>0||
       Summary_Extent_WarnWarn_Count()>0
       ){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Flagged Survey Issues: </span></h4>"))
  }else {

  }
  }) 
  
# Timing Uncertain #
    
    Summary_Timing_WarnWarn_Count<-reactive({req(Summary_WarningData())
      PH<-Summary_WarningData()%>%
        filter(., Timing_Warn=="Unknown"|Timing_Warn=="Uncertain")
     
       return(count(PH))
      
      })
    
    output$Summary_Timing_WarnWarning<-renderText({
    if(Summary_Timing_WarnWarn_Count()==0){

  }else if (Summary_Timing_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Summary_Timing_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
             "<span style=\"color:black\">Input surveys include those with survey timing uncertainties: </span><span style=\"color:red;font-weight:bold\">", Summary_Timing_WarnWarn_Count(),"Surveys</span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Summary_Timing_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may be missing critical information regarding the timing of the survey: ")),
            h4("Creel surveys included in CreelCat typically include both start and end dates which allows users to determine when the survey took place and how long it lasted. Surveys which are missing start and/or end dates have been flagged as either uncertain or unknown."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that ris sensitive to the timing or duration of input surveys, surveys flagged as having unknown or uncertain timing should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Location Uncertain #
  
      Summary_Location_WarnWarn_Count<-reactive({req(Summary_WarningData())
      PH<-Summary_WarningData()%>%
        filter(., Location_Warn=="Unknown"|Location_Warn=="Uncertain")
      
      return(count(PH))
      
      })
    
    output$Summary_Location_WarnWarning<-renderText({
    if(Summary_Location_WarnWarn_Count()==0){

  }else if (Summary_Location_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Summary_Location_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include those with survey location uncertainties: </span><span style=\"color:red;font-weight:bold\">", Summary_Location_WarnWarn_Count(),"Surveys </span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Summary_Location_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Location Warning"),
            h4(strong("Surveys may be missing critical information regarding the location of the survey: ")),
            h4("Creel surveys included in CreelCat typically identify the location of the waterbody being surveyed. Surveys which are missing the information needed to generate the location of the survey have been flagged as either uncertain (location assigned according to our best judgement despite lack of required documentation) or unknown (no location assigned for a given survey)."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that is sensitive to the location of input surveys or requires any spatial information, surveys flagged as having unknown or uncertain locations should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    

    
# Extent Warning #
  
      Summary_Extent_WarnWarn_Count<-reactive({req(Summary_WarningData())
      PH<-Summary_WarningData()%>%
        filter(., Extent_Warn=="Unknown"|Extent_Warn=="Uncertain")
      return(count(PH))
      })
    
    output$Summary_Extent_WarnWarning<-renderText({
    if(Summary_Extent_WarnWarn_Count()==0){

  }else if (Summary_Extent_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Summary_Extent_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include those with survey extent uncertainties: </span><span style=\"color:red;font-weight:bold\">", Summary_Extent_WarnWarn_Count(),"Surveys </span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Summary_Extent_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Extent Warning"),
            h4(strong("Surveys may be missing critical information regarding the extent of the survey: ")),
            h4("Creel surveys included in CreelCat typically identify the extent of the waterbody being surveyed. Surveys which are missing the information needed to generate the extent of the survey have been flagged as either uncertain (extent assigned according to our best judgement despite lack of required documentation) or unknown (no extent assigned for a given survey)."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that is sensitive to the extent of input surveys or requires any spatial information, surveys flagged as having unknown or uncertain extents should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)    

    
  
### Warning Tables ###
  
  
    Summary_WarningTBL_SurveyChar<-reactive({
      req(Summary_WarningData())
      Summary_WarningData()%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Duration','Survey_Gaps','Lost_Duration','Survey_Type','Interview_Method','Count_Method','Estimate_Method','Location_Warn','Extent_Warn','Timing_Warn')%>%
        droplevels()
      })   
  
   
   output$Summary_WarnTBL_SurveyChar<-DT::renderDataTable(
    Summary_WarningTBL_SurveyChar(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )   
   

    Summary_WarningTBL_Non_Creel<-reactive({
      req(Summary_WarningData())
      Summary_WarningData()%>%
        filter(Survey_Type!='Creel Survey')%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Survey_Type')%>%
        droplevels()
      })   
   
   output$Summary_WarnTBL_Non_Creel<-DT::renderDataTable(
    Summary_WarningTBL_Non_Creel(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )   
   

    Summary_WarningTBL_Timing<-reactive({
      req(Summary_WarningData())
      Summary_WarningData()%>%
        filter(Timing_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Timing_Warn')%>%
        droplevels()
      })

   output$Summary_WarnTBL_Timing<-DT::renderDataTable(
    Summary_WarningTBL_Timing(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Summary_WarningTBL_Location<-reactive({
      req(Summary_WarningData())
      Summary_WarningData()%>%
        filter(Location_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Location_Warn')%>%
        droplevels()
      })

   output$Summary_WarnTBL_Location<-DT::renderDataTable(
    Summary_WarningTBL_Location(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Summary_WarningTBL_Extent<-reactive({
      req(Summary_WarningData())
      Summary_WarningData()%>%
        filter(Extent_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Extent_Warn')%>%
        droplevels()
      })

   output$Summary_WarnTBL_Extent<-DT::renderDataTable(
    Summary_WarningTBL_Extent(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Summary_WarningTBL_FocalSpecies<-reactive({
      req(Summary_WarningData())
      Summary_WarningData()%>%
        filter(Focal_Species!='All')%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Focal_Species')%>%
        droplevels()
      })

   output$Summary_WarnTBL_FocalSpecies<-DT::renderDataTable(
    Summary_WarningTBL_FocalSpecies(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )      
 

    #### Zipped Data Download Handler ####
    output$FullDatasetDownload <- downloadHandler(
      filename = function(){
        paste("CreelCatData",Sys.Date(),".zip",sep="")},
      content = function(fname) {
        tmpdir <- tempdir()
        setwd(tempdir())
        print(tempdir())
        fs <- c("SurveyData.csv", "FishData.csv","DemographicData.csv","AnglerPreferenceData.csv","AnglerEffortData.csv","TaxaData.csv")
        write.csv(Survey_Data, file = "SurveyData.csv")
        write.csv(FishDataCompiled, file = "FishData.csv")
        write.csv(Demographic_Data, file = "DemographicData.csv")
        write.csv(AngPrefDataCompiled, file = "AnglerPreferenceData.csv")
        write.csv(AngEffort_Data, file = "AnglerEffortData.csv")
        write.csv(Taxa_Data, file = "TaxaData.csv")
        print (fs)
        zip(zipfile=fname, files=fs)
      },
      contentType = "application/zip"
    )

  
   
    #### Summary Data ####



    observe({
        SummaryFieldGroup_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.factor))
        SummaryFieldGroup_Choices<-list()
        SummaryFieldGroup_Choices[SummaryFieldGroup_ChoiceNames]<-SummaryFieldGroup_ChoiceNames
        updatePickerInput(session, "Survey_Summary_FieldGroup_Picker",choices=c("Year", SummaryFieldGroup_Choices),selected="None")
    })

    observe({
        SummaryFieldValue_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        SummaryFieldValue_Choices<-list()
        SummaryFieldValue_Choices[SummaryFieldValue_ChoiceNames]<-SummaryFieldValue_ChoiceNames
        updatePickerInput(session, "Survey_Summary_FieldValue_Picker", choices=c(SummaryFieldValue_Choices),selected="None")
    })


  output$CompiledSummary_Input<-DT::renderDataTable(
      Filtered_CompiledData(),
       extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#CompiledSummary_Input table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#CompiledSummary_Input table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

     CompiledSummaryInput_Dat_Raw<-reactive({
       req(input$CompiledSummary_Input_rows_selected)
      PH<-input$CompiledSummary_Input_rows_selected
      Filtered_CompiledData()[PH,]
    })
     
    output$CompiledSummary_SelectCount<-reactive({
          length(input$CompiledSummary_Input_rows_selected)
     })
    
    outputOptions(output,'CompiledSummary_SelectCount',suspendWhenHidden=FALSE)
    
    SummarizedData1<-reactive({
      Sum_Fun_List<-lapply(input$SummaryMetric,match.fun)
      names(Sum_Fun_List)<-input$SummaryMetric
      CompiledSummaryInput_Dat()%>%
        dplyr::group_by(across(all_of(SummaryGroups())))%>%
        summarize(across(all_of(FieldVals()), Sum_Fun_List,na.rm=TRUE))
    })
    
    SummarizedData2<-reactive({
      FieldVals<-input$Survey_Summary_FieldValue_Picker
      CompiledSummaryInput_Dat()%>%
        group_by(across(all_of(SummaryGroups())))%>%
        summarize(SurveyCount=n(),.groups="keep")
      
    })
    
    SummarizedData3<-reactive({
      left_join(SummarizedData2(),SummarizedData1(),by=setNames(SummaryGroups(),SummaryGroups()))
                })
    
    
    output$Compiled_Summary<-DT::renderDataTable(
      SummarizedData3(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Compiled_Summary table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Compiled_Summary table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

#### Visualization Server Code ####
    
    # Vis_Filters_Shared


  
output$Vis_Filters_Shared<-DT::renderDT(
    Filtered_CompiledData(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_Filters_Shared table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_Filters_Shared table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )


    
LinkedSelectionTBL<-reactive({
  req(input$CreelCatNavBar=='Visualize Data') ### Added Page req
  req(input$AF_LinkedSelection=="Yes")
  if(input$AF_VisNum_Selection=="2"){
    req(nrow(HighlightTrace_2Vis())>0)
    distinct(HighlightTrace_2Vis())
    }else if(input$AF_VisNum_Selection=="3"){
    req(nrow(HighlightTrace_3Vis())>0)
    distinct(HighlightTrace_3Vis())
    }else if(input$AF_VisNum_Selection=="4"){
    req(nrow(HighlightTrace_4Vis())>0)
    distinct(HighlightTrace_4Vis())}
}) # Missing an a req statement
    
    output$Vis_Linked_Selection_DT<-DT::renderDT(
      LinkedSelectionTBL(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_Linked_Selection_DT table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_Linked_Selection_DT table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
    
   output$Vis_1_Input<-DT::renderDT(
      Filtered_CompiledData(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_1_Input table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_1_Input table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
   output$Vis_2_Input<-DT::renderDT(
      Filtered_CompiledData(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_2_Input table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_2_Input table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
   output$Vis_3_Input<-DT::renderDT(
      Filtered_CompiledData(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_3_Input table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_3_Input table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
    
    output$Vis_4_Input<-DT::renderDT(
      Filtered_CompiledData(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_4_Input table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_4_Input table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

  
  
   Vis_1_SelectedTBL_Raw<-reactive({
     req(input$AF_VisNum_Selection)
      
      if(input$AF_VisNum_Selection!='1'){
        req(input$AF_SharedData)
      }
     
        Vis_1_Ids<-input$Vis_1_Input_rows_selected
        PH<-Filtered_CompiledData()[Vis_1_Ids,]
      
      return(PH)
      
    })
    
    Vis_2_SelectedTBL_Raw<-reactive({
      req(input$AF_VisNum_Selection>1)
      req(input$AF_SharedData)

        Vis_2_Ids<-input$Vis_2_Input_rows_selected
        PH<-Filtered_CompiledData()[Vis_2_Ids,]
      
        return(PH)
      
    })
    
    Vis_3_SelectedTBL_Raw<-reactive({
      req(input$AF_VisNum_Selection>2)
      req(input$AF_SharedData)

     
        Vis_3_Ids<-input$Vis_3_Input_rows_selected
        PH<-Filtered_CompiledData()[Vis_3_Ids,]
      
      return(PH)
      
    })    
    
    Vis_4_SelectedTBL_Raw<-reactive({
      req(input$AF_VisNum_Selection>3)
      req(input$AF_SharedData)

     
        Vis_4_Ids<-input$Vis_4_Input_rows_selected
        PH<-Filtered_CompiledData()[Vis_4_Ids,]
     
          return(PH)
    })
        
    Shared_SelectedTBL_Raw<-reactive({
      req(input$AF_VisNum_Selection>1)
      req(input$AF_SharedData)
      
        Shared_Ids<-input$Vis_Filters_Shared_rows_selected
        PH<-Filtered_CompiledData()[Shared_Ids,]
        
      return(PH)
    })
    



SharedSurveyData_2Vis<-reactive({
  
  req(input$AF_SharedData=='Yes')
  req(input$AF_VisNum_Selection==2)
  req(Shared_SelectedTBL_Raw())
  
  if(input$SelectVis1=="Nothing Selected"){
    Vis_1_NA<-Shared_SelectedTBL_Raw()
  }else if(input$SelectVis1=="Map"){
    if(is.null(input$Vis1_Map_CreelDisplayType)){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    }else if (input$Vis1_Map_CreelDisplayType=="Scaled Color"){
      if(input$Vis1_MapDisplayField=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_MapDisplayField)
      }
    }else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){
      if(input$Vis1_MapDisplayField_Size=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_MapDisplayField_Size)
      }
    }else if(input$Vis1_Map_CreelDisplayType=="Both"){
      if(input$Vis1_MapDisplayField=="Nothing Selected"||input$Vis1_MapDisplayField_Size=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_MapDisplayField)%>%
          drop_na(input$Vis1_MapDisplayField_Size)
      }
    } 
  }else if (input$SelectVis1=="Line Plot"){
    if(length(input$Vis1_Line_Number)==0){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    }else if (input$Vis1_Line_Number=="1"){
      if(input$Vis1_LineY1=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)
      }
    } else if(input$Vis1_Line_Number=="2"){
      if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)%>%
          drop_na(input$Vis1_LineY2)
      }
    }else if(input$Vis1_Line_Number=="3"){
      if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)%>%
          drop_na(input$Vis1_LineY2)%>%
          drop_na(input$Vis1_LineY3)
      }
    }else if(input$Vis1_Line_Number=="4"){
      if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"||input$Vis1_LineY4=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)%>%
          drop_na(input$Vis1_LineY2)%>%
          drop_na(input$Vis1_LineY3)%>%
          drop_na(input$Vis1_LineY4)
      }
    }else if(input$Vis1_Line_Number=="5"){
      if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"||input$Vis1_LineY4=="Nothing Selected"||input$Vis1_LineY5=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)%>%
          drop_na(input$Vis1_LineY2)%>%
          drop_na(input$Vis1_LineY3)%>%
          drop_na(input$Vis1_LineY4)%>%
          drop_na(input$Vis1_LineY5)
      }
    }
  }else if (input$SelectVis1=="Scatter Plot"){
    if(input$Vis1_ScatterX=="Nothing Selected"||input$Vis1_ScatterY=="Nothing Selected"){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    } else {
      Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
        drop_na(input$Vis1_ScatterX)%>%
        drop_na(input$Vis1_ScatterY)
    }
  }else if (input$SelectVis1=="Bar Chart"){
    if(length(input$Vis1_Bar_Number)==0){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    }else if (input$Vis1_Bar_Number=="1"){
      if(input$Vis1_BarY1=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)
      }
    } else if(input$Vis1_Bar_Number=="2"){
      if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)%>%
          drop_na(input$Vis1_BarY2)
      }
    }else if(input$Vis1_Bar_Number=="3"){
      if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)%>%
          drop_na(input$Vis1_BarY2)%>%
          drop_na(input$Vis1_BarY3)
      }
    }else if(input$Vis1_Bar_Number=="4"){
      if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"||input$Vis1_BarY4=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)%>%
          drop_na(input$Vis1_BarY2)%>%
          drop_na(input$Vis1_BarY3)%>%
          drop_na(input$Vis1_BarY4)
      }
    }else if(input$Vis1_Bar_Number=="5"){
      if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"||input$Vis1_BarY4=="Nothing Selected"||input$Vis1_BarY5=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)%>%
          drop_na(input$Vis1_BarY2)%>%
          drop_na(input$Vis1_BarY3)%>%
          drop_na(input$Vis1_BarY4)%>%
          drop_na(input$Vis1_BarY5)
      }
    }
  }else if (input$SelectVis1=="Pie Chart"){
    if(length(input$Vis1_Pie_CategoryType)==0){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    }else if (input$Vis1_Pie_CategoryType=="Surveys"){
      if(length(input$Vis1_Pie_Metrics_to_Sum)==0){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_Pie_Metrics_to_Sum)
      }
    } else if (input$Vis1_Pie_CategoryType=="Metrics"){
      if(length(input$Vis1_Pie_Metrics)==0){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_Pie_Metrics)
      }
    } 
  }

  if(input$SelectVis2=="Nothing Selected"){
    Vis_2_NA<-Vis_1_NA
  }else if(input$SelectVis2=="Map"){
    if(is.null(input$Vis2_Map_CreelDisplayType)){
      Vis_2_NA<-Vis_1_NA
    }else if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){
      if(input$Vis2_MapDisplayField=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_MapDisplayField)
      }
    }else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){
      if(input$Vis2_MapDisplayField_Size=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_MapDisplayField_Size)
      }
    }else if(input$Vis2_Map_CreelDisplayType=="Both"){
      if(input$Vis2_MapDisplayField=="Nothing Selected"||input$Vis2_MapDisplayField_Size=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_MapDisplayField)%>%
          drop_na(input$Vis2_MapDisplayField_Size)
      }
    }
  }else if (input$SelectVis2=="Line Plot"){
    if(length(input$Vis2_Line_Number)==0){
      Vis_2_NA<-Vis_1_NA
    }else if (input$Vis2_Line_Number=="1"){
      if(input$Vis2_LineY1=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)
      }
    } else if(input$Vis2_Line_Number=="2"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)
      }
    }else if(input$Vis2_Line_Number=="3"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)%>%
          drop_na(input$Vis2_LineY3)
      }
    }else if(input$Vis2_Line_Number=="4"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"||input$Vis2_LineY4=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)%>%
          drop_na(input$Vis2_LineY3)%>%
          drop_na(input$Vis2_LineY4)
      }
    }else if(input$Vis2_Line_Number=="5"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"||input$Vis2_LineY4=="Nothing Selected"||input$Vis2_LineY5=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)%>%
          drop_na(input$Vis2_LineY3)%>%
          drop_na(input$Vis2_LineY4)%>%
          drop_na(input$Vis2_LineY5)
      }
    }
  }else if (input$SelectVis2=="Scatter Plot"){
    if(input$Vis2_ScatterX=="Nothing Selected"||input$Vis2_ScatterY=="Nothing Selected"){
     Vis_2_NA<-Vis_1_NA
    } else {
      Vis_2_NA<-Vis_1_NA%>%
        drop_na(input$Vis2_ScatterX)%>%
        drop_na(input$Vis2_ScatterY)
    }
  }else if (input$SelectVis2=="Bar Chart"){
    if(length(input$Vis2_Bar_Number)==0){
      Vis_2_NA<-Vis_1_NA
    }else if (input$Vis2_Bar_Number=="1"){
      if(input$Vis2_BarY1=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)
      }
    } else if(input$Vis2_Bar_Number=="2"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)
      }
    }else if(input$Vis2_Bar_Number=="3"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)%>%
          drop_na(input$Vis2_BarY3)
      }
    }else if(input$Vis2_Bar_Number=="4"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"||input$Vis2_BarY4=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)%>%
          drop_na(input$Vis2_BarY3)%>%
          drop_na(input$Vis2_BarY4)
      }
    }else if(input$Vis2_Bar_Number=="5"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"||input$Vis2_BarY4=="Nothing Selected"||input$Vis2_BarY5=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)%>%
          drop_na(input$Vis2_BarY3)%>%
          drop_na(input$Vis2_BarY4)%>%
          drop_na(input$Vis2_BarY5)
      }
    }
  }else if (input$SelectVis2=="Pie Chart"){
    if(length(input$Vis2_Pie_CategoryType)==0){
      Vis_2_NA<-Vis_1_NA
    }else if (input$Vis2_Pie_CategoryType=="Surveys"){
      if(length(input$Vis2_Pie_Metrics_to_Sum)==0){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_Pie_Metrics_to_Sum)
      }
    } else if (input$Vis2_Pie_CategoryType=="Metrics"){
      if(length(input$Vis2_Pie_Metrics)==0){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_Pie_Metrics)
      }
    } 
  }
  
  return(Vis_2_NA)
})



SharedSurveyData_3Vis<-reactive({
  
  req(input$AF_SharedData=='Yes')
  req(input$AF_VisNum_Selection==3)
  
  if(input$SelectVis1=="Nothing Selected"){
    Vis_1_NA<-Shared_SelectedTBL_Raw()
  }else if(input$SelectVis1=="Map"){
    if(is.null(input$Vis1_Map_CreelDisplayType)){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    }else if (input$Vis1_Map_CreelDisplayType=="Scaled Color"){
      if(input$Vis1_MapDisplayField=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_MapDisplayField)
      }
    }else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){
      if(input$Vis1_MapDisplayField_Size=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_MapDisplayField_Size)
      }
    }else if(input$Vis1_Map_CreelDisplayType=="Both"){
      if(input$Vis1_MapDisplayField=="Nothing Selected"||input$Vis1_MapDisplayField_Size=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_MapDisplayField)%>%
          drop_na(input$Vis1_MapDisplayField_Size)
      }
    } 
  }else if (input$SelectVis1=="Line Plot"){
    if(length(input$Vis1_Line_Number)==0){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    }else if (input$Vis1_Line_Number=="1"){
      if(input$Vis1_LineY1=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)
      }
    } else if(input$Vis1_Line_Number=="2"){
      if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)%>%
          drop_na(input$Vis1_LineY2)
      }
    }else if(input$Vis1_Line_Number=="3"){
      if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)%>%
          drop_na(input$Vis1_LineY2)%>%
          drop_na(input$Vis1_LineY3)
      }
    }else if(input$Vis1_Line_Number=="4"){
      if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"||input$Vis1_LineY4=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)%>%
          drop_na(input$Vis1_LineY2)%>%
          drop_na(input$Vis1_LineY3)%>%
          drop_na(input$Vis1_LineY4)
      }
    }else if(input$Vis1_Line_Number=="5"){
      if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"||input$Vis1_LineY4=="Nothing Selected"||input$Vis1_LineY5=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)%>%
          drop_na(input$Vis1_LineY2)%>%
          drop_na(input$Vis1_LineY3)%>%
          drop_na(input$Vis1_LineY4)%>%
          drop_na(input$Vis1_LineY5)
      }
    }
  }else if (input$SelectVis1=="Scatter Plot"){
    if(input$Vis1_ScatterX=="Nothing Selected"||input$Vis1_ScatterY=="Nothing Selected"){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    } else {
      Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
        drop_na(input$Vis1_ScatterX)%>%
        drop_na(input$Vis1_ScatterY)
    }
  }else if (input$SelectVis1=="Bar Chart"){
    if(length(input$Vis1_Bar_Number)==0){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    }else if (input$Vis1_Bar_Number=="1"){
      if(input$Vis1_BarY1=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)
      }
    } else if(input$Vis1_Bar_Number=="2"){
      if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)%>%
          drop_na(input$Vis1_BarY2)
      }
    }else if(input$Vis1_Bar_Number=="3"){
      if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)%>%
          drop_na(input$Vis1_BarY2)%>%
          drop_na(input$Vis1_BarY3)
      }
    }else if(input$Vis1_Bar_Number=="4"){
      if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"||input$Vis1_BarY4=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)%>%
          drop_na(input$Vis1_BarY2)%>%
          drop_na(input$Vis1_BarY3)%>%
          drop_na(input$Vis1_BarY4)
      }
    }else if(input$Vis1_Bar_Number=="5"){
      if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"||input$Vis1_BarY4=="Nothing Selected"||input$Vis1_BarY5=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)%>%
          drop_na(input$Vis1_BarY2)%>%
          drop_na(input$Vis1_BarY3)%>%
          drop_na(input$Vis1_BarY4)%>%
          drop_na(input$Vis1_BarY5)
      }
    }
  }else if (input$SelectVis1=="Pie Chart"){
    if(length(input$Vis1_Pie_CategoryType)==0){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    }else if (input$Vis1_Pie_CategoryType=="Surveys"){
      if(length(input$Vis1_Pie_Metrics_to_Sum)==0){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_Pie_Metrics_to_Sum)
      }
    } else if (input$Vis1_Pie_CategoryType=="Metrics"){
      if(length(input$Vis1_Pie_Metrics)==0){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_Pie_Metrics)
      }
    } 
  }

  if(input$SelectVis2=="Nothing Selected"){
    Vis_2_NA<-Vis_1_NA
  }else if(input$SelectVis2=="Map"){
    if(is.null(input$Vis2_Map_CreelDisplayType)){
      Vis_2_NA<-Vis_1_NA
    }else if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){
      if(input$Vis2_MapDisplayField=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_MapDisplayField)
      }
    }else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){
      if(input$Vis2_MapDisplayField_Size=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_MapDisplayField_Size)
      }
    }else if(input$Vis2_Map_CreelDisplayType=="Both"){
      if(input$Vis2_MapDisplayField=="Nothing Selected"||input$Vis2_MapDisplayField_Size=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_MapDisplayField)%>%
          drop_na(input$Vis2_MapDisplayField_Size)
      }
    }
  }else if (input$SelectVis2=="Line Plot"){
    if(length(input$Vis2_Line_Number)==0){
      Vis_2_NA<-Vis_1_NA
    }else if (input$Vis2_Line_Number=="1"){
      if(input$Vis2_LineY1=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)
      }
    } else if(input$Vis2_Line_Number=="2"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)
      }
    }else if(input$Vis2_Line_Number=="3"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)%>%
          drop_na(input$Vis2_LineY3)
      }
    }else if(input$Vis2_Line_Number=="4"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"||input$Vis2_LineY4=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)%>%
          drop_na(input$Vis2_LineY3)%>%
          drop_na(input$Vis2_LineY4)
      }
    }else if(input$Vis2_Line_Number=="5"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"||input$Vis2_LineY4=="Nothing Selected"||input$Vis2_LineY5=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)%>%
          drop_na(input$Vis2_LineY3)%>%
          drop_na(input$Vis2_LineY4)%>%
          drop_na(input$Vis2_LineY5)
      }
    }
  }else if (input$SelectVis2=="Scatter Plot"){
    if(input$Vis2_ScatterX=="Nothing Selected"||input$Vis2_ScatterY=="Nothing Selected"){
     Vis_2_NA<-Vis_1_NA
    } else {
      Vis_2_NA<-Vis_1_NA%>%
        drop_na(input$Vis2_ScatterX)%>%
        drop_na(input$Vis2_ScatterY)
    }
  }else if (input$SelectVis2=="Bar Chart"){
    if(length(input$Vis2_Bar_Number)==0){
      Vis_2_NA<-Vis_1_NA
    }else if (input$Vis2_Bar_Number=="1"){
      if(input$Vis2_BarY1=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)
      }
    } else if(input$Vis2_Bar_Number=="2"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)
      }
    }else if(input$Vis2_Bar_Number=="3"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)%>%
          drop_na(input$Vis2_BarY3)
      }
    }else if(input$Vis2_Bar_Number=="4"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"||input$Vis2_BarY4=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)%>%
          drop_na(input$Vis2_BarY3)%>%
          drop_na(input$Vis2_BarY4)
      }
    }else if(input$Vis2_Bar_Number=="5"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"||input$Vis2_BarY4=="Nothing Selected"||input$Vis2_BarY5=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)%>%
          drop_na(input$Vis2_BarY3)%>%
          drop_na(input$Vis2_BarY4)%>%
          drop_na(input$Vis2_BarY5)
      }
    }
  }else if (input$SelectVis2=="Pie Chart"){
    if(length(input$Vis2_Pie_CategoryType)==0){
      Vis_2_NA<-Vis_1_NA
    }else if (input$Vis2_Pie_CategoryType=="Surveys"){
      if(length(input$Vis2_Pie_Metrics_to_Sum)==0){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_Pie_Metrics_to_Sum)
      }
    } else if (input$Vis2_Pie_CategoryType=="Metrics"){
      if(length(input$Vis2_Pie_Metrics)==0){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_Pie_Metrics)
      }
    } 
  }

      
  if(input$SelectVis3=="Nothing Selected"){
    Vis_3_NA<-Vis_2_NA
  }else if(input$SelectVis3=="Map"){
    if(is.null(input$Vis3_Map_CreelDisplayType)){
      Vis_3_NA<-Vis_2_NA
    }else if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){
      if(input$Vis3_MapDisplayField=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_MapDisplayField)
      }
    }else if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){
      if(input$Vis3_MapDisplayField_Size=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_MapDisplayField_Size)
      }
    }else if(input$Vis3_Map_CreelDisplayType=="Both"){
      if(input$Vis3_MapDisplayField=="Nothing Selected"||input$Vis3_MapDisplayField_Size=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_MapDisplayField)%>%
          drop_na(input$Vis3_MapDisplayField_Size)
      }
    }
  }else if (input$SelectVis3=="Line Plot"){
    if(length(input$Vis3_Line_Number)==0){
      Vis_3_NA<-Vis_2_NA
    }else if (input$Vis3_Line_Number=="1"){
      if(input$Vis3_LineY1=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_LineY1)
      }
    } else if(input$Vis3_Line_Number=="2"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_LineY1)%>%
          drop_na(input$Vis3_LineY2)
      }
    }else if(input$Vis3_Line_Number=="3"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_LineY1)%>%
          drop_na(input$Vis3_LineY2)%>%
          drop_na(input$Vis3_LineY3)
      }
    }else if(input$Vis3_Line_Number=="4"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"||input$Vis3_LineY4=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_LineY1)%>%
          drop_na(input$Vis3_LineY2)%>%
          drop_na(input$Vis3_LineY3)%>%
          drop_na(input$Vis3_LineY4)
      }
    }else if(input$Vis3_Line_Number=="5"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"||input$Vis3_LineY4=="Nothing Selected"||input$Vis3_LineY5=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_LineY1)%>%
          drop_na(input$Vis3_LineY2)%>%
          drop_na(input$Vis3_LineY3)%>%
          drop_na(input$Vis3_LineY4)%>%
          drop_na(input$Vis3_LineY5)
      }
    }
  }else if (input$SelectVis3=="Scatter Plot"){
    if(input$Vis3_ScatterX=="Nothing Selected"||input$Vis3_ScatterY=="Nothing Selected"){
      Vis_3_NA<-Vis_2_NA
    } else {
      Vis_3_NA<-Vis_2_NA%>%
        drop_na(input$Vis3_ScatterX)%>%
        drop_na(input$Vis3_ScatterY)
    }
  }else if (input$SelectVis3=="Bar Chart"){
    if(length(input$Vis3_Bar_Number)==0){
      Vis_3_NA<-Vis_2_NA
    }else if (input$Vis3_Bar_Number=="1"){
      if(input$Vis3_BarY1=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_BarY1)
      }
    } else if(input$Vis3_Bar_Number=="2"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_BarY1)%>%
          drop_na(input$Vis3_BarY2)
      }
    }else if(input$Vis3_Bar_Number=="3"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_BarY1)%>%
          drop_na(input$Vis3_BarY2)%>%
          drop_na(input$Vis3_BarY3)
      }
    }else if(input$Vis3_Bar_Number=="4"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"||input$Vis3_BarY4=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_BarY1)%>%
          drop_na(input$Vis3_BarY2)%>%
          drop_na(input$Vis3_BarY3)%>%
          drop_na(input$Vis3_BarY4)
      }
    }else if(input$Vis3_Bar_Number=="5"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"||input$Vis3_BarY4=="Nothing Selected"||input$Vis3_BarY5=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_BarY1)%>%
          drop_na(input$Vis3_BarY2)%>%
          drop_na(input$Vis3_BarY3)%>%
          drop_na(input$Vis3_BarY4)%>%
          drop_na(input$Vis3_BarY5)
      }
    }
  }else if (input$SelectVis3=="Pie Chart"){
    if(length(input$Vis3_Pie_CategoryType)==0){
      Vis_3_NA<-Vis_2_NA
    }else if (input$Vis3_Pie_CategoryType=="Surveys"){
      if(length(input$Vis3_Pie_Metrics_to_Sum)==0){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_Pie_Metrics_to_Sum)
      }
    } else if (input$Vis3_Pie_CategoryType=="Metrics"){
      if(length(input$Vis3_Pie_Metrics)==0){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_Pie_Metrics)
      }
    } 
  }

  return(Vis_3_NA)
})



SharedSurveyData_4Vis<-reactive({
  
  req(input$AF_SharedData=='Yes')
  req(input$AF_VisNum_Selection==4)
  
  if(input$SelectVis1=="Nothing Selected"){
    Vis_1_NA<-Shared_SelectedTBL_Raw()
  }else if(input$SelectVis1=="Map"){
    if(is.null(input$Vis1_Map_CreelDisplayType)){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    }else if (input$Vis1_Map_CreelDisplayType=="Scaled Color"){
      if(input$Vis1_MapDisplayField=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_MapDisplayField)
      }
    }else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){
      if(input$Vis1_MapDisplayField_Size=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_MapDisplayField_Size)
      }
    }else if(input$Vis1_Map_CreelDisplayType=="Both"){
      if(input$Vis1_MapDisplayField=="Nothing Selected"||input$Vis1_MapDisplayField_Size=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_MapDisplayField)%>%
          drop_na(input$Vis1_MapDisplayField_Size)
      }
    } 
  }else if (input$SelectVis1=="Line Plot"){
    if(length(input$Vis1_Line_Number)==0){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    }else if (input$Vis1_Line_Number=="1"){
      if(input$Vis1_LineY1=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)
      }
    } else if(input$Vis1_Line_Number=="2"){
      if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)%>%
          drop_na(input$Vis1_LineY2)
      }
    }else if(input$Vis1_Line_Number=="3"){
      if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)%>%
          drop_na(input$Vis1_LineY2)%>%
          drop_na(input$Vis1_LineY3)
      }
    }else if(input$Vis1_Line_Number=="4"){
      if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"||input$Vis1_LineY4=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)%>%
          drop_na(input$Vis1_LineY2)%>%
          drop_na(input$Vis1_LineY3)%>%
          drop_na(input$Vis1_LineY4)
      }
    }else if(input$Vis1_Line_Number=="5"){
      if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"||input$Vis1_LineY4=="Nothing Selected"||input$Vis1_LineY5=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_LineY1)%>%
          drop_na(input$Vis1_LineY2)%>%
          drop_na(input$Vis1_LineY3)%>%
          drop_na(input$Vis1_LineY4)%>%
          drop_na(input$Vis1_LineY5)
      }
    }
  }else if (input$SelectVis1=="Scatter Plot"){
    if(input$Vis1_ScatterX=="Nothing Selected"||input$Vis1_ScatterY=="Nothing Selected"){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    } else {
      Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
        drop_na(input$Vis1_ScatterX)%>%
        drop_na(input$Vis1_ScatterY)
    }
  }else if (input$SelectVis1=="Bar Chart"){
    if(length(input$Vis1_Bar_Number)==0){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    }else if (input$Vis1_Bar_Number=="1"){
      if(input$Vis1_BarY1=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)
      }
    } else if(input$Vis1_Bar_Number=="2"){
      if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)%>%
          drop_na(input$Vis1_BarY2)
      }
    }else if(input$Vis1_Bar_Number=="3"){
      if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)%>%
          drop_na(input$Vis1_BarY2)%>%
          drop_na(input$Vis1_BarY3)
      }
    }else if(input$Vis1_Bar_Number=="4"){
      if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"||input$Vis1_BarY4=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)%>%
          drop_na(input$Vis1_BarY2)%>%
          drop_na(input$Vis1_BarY3)%>%
          drop_na(input$Vis1_BarY4)
      }
    }else if(input$Vis1_Bar_Number=="5"){
      if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"||input$Vis1_BarY4=="Nothing Selected"||input$Vis1_BarY5=="Nothing Selected"){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_BarY1)%>%
          drop_na(input$Vis1_BarY2)%>%
          drop_na(input$Vis1_BarY3)%>%
          drop_na(input$Vis1_BarY4)%>%
          drop_na(input$Vis1_BarY5)
      }
    }
  }else if (input$SelectVis1=="Pie Chart"){
    if(length(input$Vis1_Pie_CategoryType)==0){
      Vis_1_NA<-Shared_SelectedTBL_Raw()
    }else if (input$Vis1_Pie_CategoryType=="Surveys"){
      if(length(input$Vis1_Pie_Metrics_to_Sum)==0){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_Pie_Metrics_to_Sum)
      }
    } else if (input$Vis1_Pie_CategoryType=="Metrics"){
      if(length(input$Vis1_Pie_Metrics)==0){
        Vis_1_NA<-Shared_SelectedTBL_Raw()
      } else {
        Vis_1_NA<-Shared_SelectedTBL_Raw()%>%
          drop_na(input$Vis1_Pie_Metrics)
      }
    } 
  }

  if(input$SelectVis2=="Nothing Selected"){
    Vis_2_NA<-Vis_1_NA
  }else if(input$SelectVis2=="Map"){
    if(is.null(input$Vis2_Map_CreelDisplayType)){
      Vis_2_NA<-Vis_1_NA
    }else if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){
      if(input$Vis2_MapDisplayField=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_MapDisplayField)
      }
    }else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){
      if(input$Vis2_MapDisplayField_Size=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_MapDisplayField_Size)
      }
    }else if(input$Vis2_Map_CreelDisplayType=="Both"){
      if(input$Vis2_MapDisplayField=="Nothing Selected"||input$Vis2_MapDisplayField_Size=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_MapDisplayField)%>%
          drop_na(input$Vis2_MapDisplayField_Size)
      }
    }
  }else if (input$SelectVis2=="Line Plot"){
    if(length(input$Vis2_Line_Number)==0){
      Vis_2_NA<-Vis_1_NA
    }else if (input$Vis2_Line_Number=="1"){
      if(input$Vis2_LineY1=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)
      }
    } else if(input$Vis2_Line_Number=="2"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)
      }
    }else if(input$Vis2_Line_Number=="3"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)%>%
          drop_na(input$Vis2_LineY3)
      }
    }else if(input$Vis2_Line_Number=="4"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"||input$Vis2_LineY4=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)%>%
          drop_na(input$Vis2_LineY3)%>%
          drop_na(input$Vis2_LineY4)
      }
    }else if(input$Vis2_Line_Number=="5"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"||input$Vis2_LineY4=="Nothing Selected"||input$Vis2_LineY5=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)%>%
          drop_na(input$Vis2_LineY3)%>%
          drop_na(input$Vis2_LineY4)%>%
          drop_na(input$Vis2_LineY5)
      }
    }
  }else if (input$SelectVis2=="Scatter Plot"){
    if(input$Vis2_ScatterX=="Nothing Selected"||input$Vis2_ScatterY=="Nothing Selected"){
     Vis_2_NA<-Vis_1_NA
    } else {
      Vis_2_NA<-Vis_1_NA%>%
        drop_na(input$Vis2_ScatterX)%>%
        drop_na(input$Vis2_ScatterY)
    }
  }else if (input$SelectVis2=="Bar Chart"){
    if(length(input$Vis2_Bar_Number)==0){
      Vis_2_NA<-Vis_1_NA
    }else if (input$Vis2_Bar_Number=="1"){
      if(input$Vis2_BarY1=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)
      }
    } else if(input$Vis2_Bar_Number=="2"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)
      }
    }else if(input$Vis2_Bar_Number=="3"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)%>%
          drop_na(input$Vis2_BarY3)
      }
    }else if(input$Vis2_Bar_Number=="4"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"||input$Vis2_BarY4=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)%>%
          drop_na(input$Vis2_BarY3)%>%
          drop_na(input$Vis2_BarY4)
      }
    }else if(input$Vis2_Bar_Number=="5"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"||input$Vis2_BarY4=="Nothing Selected"||input$Vis2_BarY5=="Nothing Selected"){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)%>%
          drop_na(input$Vis2_BarY3)%>%
          drop_na(input$Vis2_BarY4)%>%
          drop_na(input$Vis2_BarY5)
      }
    }
  }else if (input$SelectVis2=="Pie Chart"){
    if(length(input$Vis2_Pie_CategoryType)==0){
      Vis_2_NA<-Vis_1_NA
    }else if (input$Vis2_Pie_CategoryType=="Surveys"){
      if(length(input$Vis2_Pie_Metrics_to_Sum)==0){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_Pie_Metrics_to_Sum)
      }
    } else if (input$Vis2_Pie_CategoryType=="Metrics"){
      if(length(input$Vis2_Pie_Metrics)==0){
        Vis_2_NA<-Vis_1_NA
      } else {
        Vis_2_NA<-Vis_1_NA%>%
          drop_na(input$Vis2_Pie_Metrics)
      }
    } 
  }

      
  if(input$SelectVis3=="Nothing Selected"){
    Vis_3_NA<-Vis_2_NA
  }else if(input$SelectVis3=="Map"){
    if(is.null(input$Vis3_Map_CreelDisplayType)){
      Vis_3_NA<-Vis_2_NA
    }else if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){
      if(input$Vis3_MapDisplayField=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_MapDisplayField)
      }
    }else if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){
      if(input$Vis3_MapDisplayField_Size=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_MapDisplayField_Size)
      }
    }else if(input$Vis3_Map_CreelDisplayType=="Both"){
      if(input$Vis3_MapDisplayField=="Nothing Selected"||input$Vis3_MapDisplayField_Size=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_MapDisplayField)%>%
          drop_na(input$Vis3_MapDisplayField_Size)
      }
    }
  }else if (input$SelectVis3=="Line Plot"){
    if(length(input$Vis3_Line_Number)==0){
      Vis_3_NA<-Vis_2_NA
    }else if (input$Vis3_Line_Number=="1"){
      if(input$Vis3_LineY1=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_LineY1)
      }
    } else if(input$Vis3_Line_Number=="2"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_LineY1)%>%
          drop_na(input$Vis3_LineY2)
      }
    }else if(input$Vis3_Line_Number=="3"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_LineY1)%>%
          drop_na(input$Vis3_LineY2)%>%
          drop_na(input$Vis3_LineY3)
      }
    }else if(input$Vis3_Line_Number=="4"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"||input$Vis3_LineY4=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_LineY1)%>%
          drop_na(input$Vis3_LineY2)%>%
          drop_na(input$Vis3_LineY3)%>%
          drop_na(input$Vis3_LineY4)
      }
    }else if(input$Vis3_Line_Number=="5"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"||input$Vis3_LineY4=="Nothing Selected"||input$Vis3_LineY5=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_LineY1)%>%
          drop_na(input$Vis3_LineY2)%>%
          drop_na(input$Vis3_LineY3)%>%
          drop_na(input$Vis3_LineY4)%>%
          drop_na(input$Vis3_LineY5)
      }
    }
  }else if (input$SelectVis3=="Scatter Plot"){
    if(input$Vis3_ScatterX=="Nothing Selected"||input$Vis3_ScatterY=="Nothing Selected"){
      Vis_3_NA<-Vis_2_NA
    } else {
      Vis_3_NA<-Vis_2_NA%>%
        drop_na(input$Vis3_ScatterX)%>%
        drop_na(input$Vis3_ScatterY)
    }
  }else if (input$SelectVis3=="Bar Chart"){
    if(length(input$Vis3_Bar_Number)==0){
      Vis_3_NA<-Vis_2_NA
    }else if (input$Vis3_Bar_Number=="1"){
      if(input$Vis3_BarY1=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_BarY1)
      }
    } else if(input$Vis3_Bar_Number=="2"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_BarY1)%>%
          drop_na(input$Vis3_BarY2)
      }
    }else if(input$Vis3_Bar_Number=="3"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_BarY1)%>%
          drop_na(input$Vis3_BarY2)%>%
          drop_na(input$Vis3_BarY3)
      }
    }else if(input$Vis3_Bar_Number=="4"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"||input$Vis3_BarY4=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_BarY1)%>%
          drop_na(input$Vis3_BarY2)%>%
          drop_na(input$Vis3_BarY3)%>%
          drop_na(input$Vis3_BarY4)
      }
    }else if(input$Vis3_Bar_Number=="5"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"||input$Vis3_BarY4=="Nothing Selected"||input$Vis3_BarY5=="Nothing Selected"){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_BarY1)%>%
          drop_na(input$Vis3_BarY2)%>%
          drop_na(input$Vis3_BarY3)%>%
          drop_na(input$Vis3_BarY4)%>%
          drop_na(input$Vis3_BarY5)
      }
    }
  }else if (input$SelectVis3=="Pie Chart"){
    if(length(input$Vis3_Pie_CategoryType)==0){
      Vis_3_NA<-Vis_2_NA
    }else if (input$Vis3_Pie_CategoryType=="Surveys"){
      if(length(input$Vis3_Pie_Metrics_to_Sum)==0){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_Pie_Metrics_to_Sum)
      }
    } else if (input$Vis3_Pie_CategoryType=="Metrics"){
      if(length(input$Vis3_Pie_Metrics)==0){
        Vis_3_NA<-Vis_2_NA
      } else {
        Vis_3_NA<-Vis_2_NA%>%
          drop_na(input$Vis3_Pie_Metrics)
      }
    } 
  }
  
  if(input$SelectVis4=="Nothing Selected"){
    Vis_4_NA<-Vis_3_NA
  }else if(input$SelectVis4=="Map"){
    if(is.null(input$Vis4_Map_CreelDisplayType)){
      Vis_4_NA<-Vis_3_NA
    }else if(input$Vis4_Map_CreelDisplayType=="Scaled Color"){
      if(input$Vis4_MapDisplayField=="Nothing Selected"){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_MapDisplayField)
      }
    }else if(input$Vis4_Map_CreelDisplayType=="Scaled Size"){
      if(input$Vis4_MapDisplayField_Size=="Nothing Selected"){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_MapDisplayField_Size)
      }
    }else if(input$Vis4_Map_CreelDisplayType=="Both"){
      if(input$Vis4_MapDisplayField=="Nothing Selected"||input$Vis4_MapDisplayField_Size=="Nothing Selected"){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_MapDisplayField)%>%
          drop_na(input$Vis4_MapDisplayField_Size)
      }
    }
  }else if (input$SelectVis4=="Line Plot"){
    if(length(input$Vis4_Line_Number)==0){
      Vis_4_NA<-Vis_3_NA
    }else if (input$Vis4_Line_Number=="1"){
      if(input$Vis4_LineY1=="Nothing Selected"){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_LineY1)
      }
    } else if(input$Vis4_Line_Number=="2"){
      if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_LineY1)%>%
          drop_na(input$Vis4_LineY2)
      }
    }else if(input$Vis4_Line_Number=="3"){
      if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"||input$Vis4_LineY3=="Nothing Selected"){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_LineY1)%>%
          drop_na(input$Vis4_LineY2)%>%
          drop_na(input$Vis4_LineY3)
      }
    }else if(input$Vis4_Line_Number=="4"){
      if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"||input$Vis4_LineY3=="Nothing Selected"||input$Vis4_LineY4=="Nothing Selected"){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_LineY1)%>%
          drop_na(input$Vis4_LineY2)%>%
          drop_na(input$Vis4_LineY3)%>%
          drop_na(input$Vis4_LineY4)
      }
    }else if(input$Vis4_Line_Number=="5"){
      if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"||input$Vis4_LineY3=="Nothing Selected"||input$Vis4_LineY4=="Nothing Selected"||input$Vis4_LineY5=="Nothing Selected"){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_LineY1)%>%
          drop_na(input$Vis4_LineY2)%>%
          drop_na(input$Vis4_LineY3)%>%
          drop_na(input$Vis4_LineY4)%>%
          drop_na(input$Vis4_LineY5)
      }
    }
  }else if (input$SelectVis4=="Scatter Plot"){
    if(input$Vis4_ScatterX=="Nothing Selected"||input$Vis4_ScatterY=="Nothing Selected"){
      Vis_4_NA<-Vis_3_NA
    } else {
      Vis_4_NA<-Vis_3_NA%>%
        drop_na(input$Vis4_ScatterX)%>%
        drop_na(input$Vis4_ScatterY)
    }
  }else if (input$SelectVis4=="Bar Chart"){
    if(length(input$Vis4_Bar_Number)==0){
      Vis_4_NA<-Vis_3_NA
    }else if (input$Vis4_Bar_Number=="1"){
      if(input$Vis4_BarY1=="Nothing Selected"){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_BarY1)
      }
    } else if(input$Vis4_Bar_Number=="2"){
      if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_BarY1)%>%
          drop_na(input$Vis4_BarY2)
      }
    }else if(input$Vis4_Bar_Number=="3"){
      if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"||input$Vis4_BarY3=="Nothing Selected"){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_BarY1)%>%
          drop_na(input$Vis4_BarY2)%>%
          drop_na(input$Vis4_BarY3)
      }
    }else if(input$Vis4_Bar_Number=="4"){
      if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"||input$Vis4_BarY3=="Nothing Selected"||input$Vis4_BarY4=="Nothing Selected"){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_BarY1)%>%
          drop_na(input$Vis4_BarY2)%>%
          drop_na(input$Vis4_BarY3)%>%
          drop_na(input$Vis4_BarY4)
      }
    }else if(input$Vis4_Bar_Number=="5"){
      if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"||input$Vis4_BarY3=="Nothing Selected"||input$Vis4_BarY4=="Nothing Selected"||input$Vis4_BarY5=="Nothing Selected"){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_BarY1)%>%
          drop_na(input$Vis4_BarY2)%>%
          drop_na(input$Vis4_BarY3)%>%
          drop_na(input$Vis4_BarY4)%>%
          drop_na(input$Vis4_BarY5)
      }
    }
  }else if (input$SelectVis4=="Pie Chart"){
    if(length(input$Vis4_Pie_CategoryType)==0){
      Vis_4_NA<-Vis_3_NA
    }else if (input$Vis4_Pie_CategoryType=="Surveys"){
      if(length(input$Vis4_Pie_Metrics_to_Sum)==0){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_Pie_Metrics_to_Sum)
      }
    } else if (input$Vis4_Pie_CategoryType=="Metrics"){
      if(length(input$Vis4_Pie_Metrics)==0){
        Vis_4_NA<-Vis_3_NA
      } else {
        Vis_4_NA<-Vis_3_NA%>%
          drop_na(input$Vis4_Pie_Metrics)
      }
    } 
  }
  
  return(Vis_4_NA)
})

Shared_Selected_NA_TBL<-reactive({ 
  req(input$AF_VisNum_Selection)
  req(input$AF_SharedData=='Yes')
  
  if(input$AF_VisNum_Selection=='2'){
    PH<-SharedSurveyData_2Vis()
  } else if (input$AF_VisNum_Selection=='3'){
    PH<-SharedSurveyData_3Vis()
  } else if (input$AF_VisNum_Selection=='4'){
    PH<-SharedSurveyData_4Vis()
  }
  return(PH)
})

# Shared_Selected_NA_TBL<-reactiveVal()
# 
# observeEvent(c(
#   req(input$AF_SharedData=='Yes'),
#   req(input$AF_VisNum_Selection=='2'),
#   req(length(SharedSurveyData_Vis2())>0)
#   ),{
#     
#   PH<-SharedSurveyData_Vis2()%>%
#       droplevels()
# 
#   SharedSurveyData_NA_TBL(PH)
# 
# },ignoreInit=TRUE)
# 
# observeEvent(c(
#   req(input$AF_SharedData=='Yes'),
#   req(input$AF_VisNum_Selection=='3'),
#   req(length(SharedSurveyData_Vis3())>0)
#   ),{
#   PH<-SharedSurveyData_Vis3()%>%
#       droplevels()
# 
#   SharedSurveyData_NA_TBL(PH)
# 
# },ignoreInit=TRUE)
# 
# observeEvent(c(
#   req(input$AF_SharedData=='Yes'),
#   req(input$AF_VisNum_Selection=='4'),
#   req(length(SharedSurveyData_Vis4())>0)
#   ),{
#   PH<-SharedSurveyData_Vis4()%>%
#       droplevels()
# 
#   SharedSurveyData_NA_TBL(PH)
# 
# },ignoreInit=TRUE)
 

    Shared_SurveyWarnTBL<-reactive({
      req(Shared_WarningData())
     
      NonCreel_Retained<-if(input$NonCreel_Shared_Switch==TRUE){
        Shared_WarningData()%>%
          filter(.,Survey_Type=="Creel Survey")%>%
          select(Survey_ID)
        }else{
            Shared_WarningData()%>%
              select(Survey_ID)
        }

      Timing_Retained<-if(input$UnkTiming_Shared_Switch==TRUE){
        Shared_WarningData()%>%
          filter(.,!Timing_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Shared_WarningData()%>%
              select(Survey_ID)
        }

      Location_Retained<-if(input$UnkLocation_Shared_Switch==TRUE){
        Shared_WarningData()%>%
          filter(.,!Location_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Shared_WarningData()%>%
              select(Survey_ID)
        }

      Extent_Retained<-if(input$UnkExtent_Shared_Switch==TRUE){
        Shared_WarningData()%>%
          filter(.,!Extent_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Shared_WarningData()%>%
              select(Survey_ID)
        }

      FocalTaxa_Retained<-if(input$FocSpecies_Shared_Switch==TRUE){
        Shared_WarningData()%>%
          filter(.,Focal_Species==c("All"))%>%
          select(Survey_ID)
        }else{
            Shared_WarningData()%>%
              select(Survey_ID)
        }
      
       
        Shared_Survey_Filt<-NonCreel_Retained%>%
          semi_join(.,Timing_Retained,by='Survey_ID')%>%
          semi_join(.,Location_Retained,by='Survey_ID')%>%
          semi_join(.,Extent_Retained,by='Survey_ID')%>%
          semi_join(.,FocalTaxa_Retained,by='Survey_ID')%>%
          droplevels()

    return(Shared_Survey_Filt)

    })   
   
   Shared_TaxaWarnTBL<-reactive({
      req(Shared_SelectedTBL_Raw())
     
      SharedUnattributedSurveys_Retained<-if(is.null(Shared_UnattributedFishTaxa())){
        Shared_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$UnFish_Shared_Switch==TRUE){
        Shared_SelectedTBL_Raw()%>%
        anti_join(Shared_UnattributedFishTaxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Shared_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      SharedIncompleteSurveys_Retained<-if(is.null(Shared_IncompleteAttributedFishTaxa())){
        Shared_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$InFishGroup_Shared_Switch==TRUE){
        Shared_SelectedTBL_Raw()%>%
        anti_join(Shared_IncompleteAttributedFishTaxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Shared_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      SharedUnattributedTargetSurveys_Retained<-if(is.null(Shared_UnattributedTarget_Taxa())){
        Shared_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$UnTarget_Shared_Switch==TRUE){
        Shared_SelectedTBL_Raw()%>%
        anti_join(Shared_UnattributedTarget_Taxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Shared_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      SharedIncompleteTargetSurveys_Retained<-if(is.null(Shared_IncompleteAttributedTarget_Taxa())){
        Shared_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$InTargetGroup_Shared_Switch==TRUE){
        Shared_SelectedTBL_Raw()%>%
        anti_join(Shared_IncompleteAttributedTarget_Taxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Shared_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }
       
        Shared_Survey_Filt<-SharedUnattributedSurveys_Retained%>%
          semi_join(.,SharedIncompleteSurveys_Retained,by='Survey_ID')%>%
          semi_join(.,SharedUnattributedTargetSurveys_Retained,by='Survey_ID')%>%
          semi_join(.,SharedIncompleteTargetSurveys_Retained,by='Survey_ID')%>%
          droplevels()

    return(Shared_Survey_Filt)

    })   
   
Shared_SelectedTBL<-reactive({
  req(Shared_SurveyWarnTBL())
  req(Shared_TaxaWarnTBL())
  req(Shared_Selected_NA_TBL())
  
  Shared_Selected_NA_TBL()%>%
    semi_join(.,Shared_SurveyWarnTBL(),by='Survey_ID')%>%
    semi_join(.,Shared_TaxaWarnTBL(),by='Survey_ID')%>%
    droplevels()
  
})

Shared_Input_Variables_Vis1<-reactive({
  
     if(input$SelectVis1=="Nothing Selected"){
       
     }else if(input$SelectVis1=="Map"){
       if(is.null(input$Vis1_Map_CreelDisplayType)){
         
       }else if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){
           if(input$Vis1_MapDisplayField=="Nothing Selected"){
             
           } else {
              input$Vis1_MapDisplayField
           }
       }else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){
           if(input$Vis1_MapDisplayField_Size=="Nothing Selected"){
             
           } else {
           input$Vis1_MapDisplayField_Size
           }
       }else if(input$Vis1_Map_CreelDisplayType=="Both"){
           if(input$Vis1_MapDisplayField=="Nothing Selected"||input$Vis1_MapDisplayField_Size=="Nothing Selected"){
             
           } else {
           c(input$Vis1_MapDisplayField,input$Vis1_MapDisplayField_Size)
           }
       } 
     }else if (input$SelectVis1=="Line Plot"){
       if(length(input$Vis1_Line_Number)==0){
         
       }else if (input$Vis1_Line_Number=="1"){
         if(input$Vis1_LineY1=="Nothing Selected"){
          
         } else {
         input$Vis1_LineY1
         }
       } else if(input$Vis1_Line_Number=="2"){
         if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"){
           
         } else {
       c(input$Vis1_LineY1,
         input$Vis1_LineY2)
         }
       }else if(input$Vis1_Line_Number=="3"){
         if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"){
           
         } else {
       c(input$Vis1_LineY1,
         input$Vis1_LineY2,
         input$Vis1_LineY3)
       }
       }else if(input$Vis1_Line_Number=="4"){
         if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"||input$Vis1_LineY4=="Nothing Selected"){
           
         } else {
       c(input$Vis1_LineY1,
         input$Vis1_LineY2,
         input$Vis1_LineY3,
         input$Vis1_LineY4)
       }
       }else if(input$Vis1_Line_Number=="5"){
         if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"||input$Vis1_LineY4=="Nothing Selected"||input$Vis1_LineY5=="Nothing Selected"){
           
         } else {
       c(input$Vis1_LineY1,
         input$Vis1_LineY2,
         input$Vis1_LineY3,
         input$Vis1_LineY4,
         input$Vis1_LineY5)
       }
        }
     }else if (input$SelectVis1=="Scatter Plot"){
       if(input$Vis1_ScatterX=="Nothing Selected"||input$Vis1_ScatterY=="Nothing Selected"){
         
       } else {
       c(input$Vis1_ScatterX,
         input$Vis1_ScatterY)
       }
     }else if (input$SelectVis1=="Bar Chart"){
       if(length(input$Vis1_Bar_Number)==0){
         
       }else if (input$Vis1_Bar_Number=="1"){
         if(input$Vis1_BarY1=="Nothing Selected"){
           
         } else {
         c(input$Vis1_BarY1)
         }
       } else if(input$Vis1_Bar_Number=="2"){
         if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"){
           
         } else {
       c(input$Vis1_BarY1,
         input$Vis1_BarY2)
         }
       }else if(input$Vis1_Bar_Number=="3"){
         if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"){
           
         } else {
       c(input$Vis1_BarY1,
         input$Vis1_BarY2,
         input$Vis1_BarY3)
       }
       }else if(input$Vis1_Bar_Number=="4"){
         if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"||input$Vis1_BarY4=="Nothing Selected"){
           
         } else {
       c(input$Vis1_BarY1,
         input$Vis1_BarY2,
         input$Vis1_BarY3,
         input$Vis1_BarY4)
       }
       }else if(input$Vis1_Bar_Number=="5"){
         if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"||input$Vis1_BarY4=="Nothing Selected"||input$Vis1_BarY5=="Nothing Selected"){
           
         } else {
       c(input$Vis1_BarY1,
         input$Vis1_BarY2,
         input$Vis1_BarY3,
         input$Vis1_BarY4,
         input$Vis1_BarY5)
       }
        }
     }else if (input$SelectVis1=="Pie Chart"){
       if(length(input$Vis1_Pie_CategoryType)==0){
       }else if (input$Vis1_Pie_CategoryType=="Surveys"){
         if(length(input$Vis1_Pie_Metrics_to_Sum)==0){
           
         } else {
           input$Vis1_Pie_Metrics_to_Sum
         }
       } else if (input$Vis1_Pie_CategoryType=="Metrics"){
         if(length(input$Vis1_Pie_Metrics)==0){
           
         } else {
           input$Vis1_Pie_Metrics
         }
       } 
     }
   })

Shared_Input_Variables_Vis2<-reactive({

     if(input$SelectVis2=="Nothing Selected"){
       
     }else if(input$SelectVis2=="Map"){
       if(is.null(input$Vis2_Map_CreelDisplayType)){
         
       }else if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){
           if(input$Vis2_MapDisplayField=="Nothing Selected"){
             
           } else {
              input$Vis2_MapDisplayField
           }
       }else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){
           if(input$Vis2_MapDisplayField_Size=="Nothing Selected"){
             
           } else {
           input$Vis2_MapDisplayField_Size
           }
       }else if(input$Vis2_Map_CreelDisplayType=="Both"){
           if(input$Vis2_MapDisplayField=="Nothing Selected"||input$Vis2_MapDisplayField_Size=="Nothing Selected"){
             
           } else {
           c(input$Vis2_MapDisplayField,input$Vis2_MapDisplayField_Size)
           }
       } 
     }else if (input$SelectVis2=="Line Plot"){
       if(length(input$Vis2_Line_Number)==0){
         
       }else if (input$Vis2_Line_Number=="1"){
         if(input$Vis2_LineY1=="Nothing Selected"){
          
         } else {
         input$Vis2_LineY1
         }
       } else if(input$Vis2_Line_Number=="2"){
         if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"){
           
         } else {
       c(input$Vis2_LineY1,
         input$Vis2_LineY2)
         }
       }else if(input$Vis2_Line_Number=="3"){
         if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"){
           
         } else {
       c(input$Vis2_LineY1,
         input$Vis2_LineY2,
         input$Vis2_LineY3)
       }
       }else if(input$Vis2_Line_Number=="4"){
         if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"||input$Vis2_LineY4=="Nothing Selected"){
           
         } else {
       c(input$Vis2_LineY1,
         input$Vis2_LineY2,
         input$Vis2_LineY3,
         input$Vis2_LineY4)
       }
       }else if(input$Vis2_Line_Number=="5"){
         if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"||input$Vis2_LineY4=="Nothing Selected"||input$Vis2_LineY5=="Nothing Selected"){
           
         } else {
       c(input$Vis2_LineY1,
         input$Vis2_LineY2,
         input$Vis2_LineY3,
         input$Vis2_LineY4,
         input$Vis2_LineY5)
       }
        }
     }else if (input$SelectVis2=="Scatter Plot"){
       if(input$Vis2_ScatterX=="Nothing Selected"||input$Vis2_ScatterY=="Nothing Selected"){
         
       } else {
       c(input$Vis2_ScatterX,
         input$Vis2_ScatterY)
       }
     }else if (input$SelectVis2=="Bar Chart"){
       if(length(input$Vis2_Bar_Number)==0){
         
       }else if (input$Vis2_Bar_Number=="1"){
         if(input$Vis2_BarY1=="Nothing Selected"){
           
         } else {
         c(input$Vis2_BarY1)
         }
       } else if(input$Vis2_Bar_Number=="2"){
         if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"){
           
         } else {
       c(input$Vis2_BarY1,
         input$Vis2_BarY2)
         }
       }else if(input$Vis2_Bar_Number=="3"){
         if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"){
           
         } else {
       c(input$Vis2_BarY1,
         input$Vis2_BarY2,
         input$Vis2_BarY3)
       }
       }else if(input$Vis2_Bar_Number=="4"){
         if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"||input$Vis2_BarY4=="Nothing Selected"){
           
         } else {
       c(input$Vis2_BarY1,
         input$Vis2_BarY2,
         input$Vis2_BarY3,
         input$Vis2_BarY4)
       }
       }else if(input$Vis2_Bar_Number=="5"){
         if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"||input$Vis2_BarY4=="Nothing Selected"||input$Vis2_BarY5=="Nothing Selected"){
           
         } else {
       c(input$Vis2_BarY1,
         input$Vis2_BarY2,
         input$Vis2_BarY3,
         input$Vis2_BarY4,
         input$Vis2_BarY5)
       }
        }
     }else if (input$SelectVis2=="Pie Chart"){
       if(length(input$Vis2_Pie_CategoryType)==0){
       }else if (input$Vis2_Pie_CategoryType=="Surveys"){
         if(length(input$Vis2_Pie_Metrics_to_Sum)==0){
           
         } else {
           input$Vis2_Pie_Metrics_to_Sum
         }
       } else if (input$Vis2_Pie_CategoryType=="Metrics"){
         if(length(input$Vis2_Pie_Metrics)==0){
           
         } else {
           input$Vis2_Pie_Metrics
         }
       } 
     }
   })

Shared_Input_Variables_Vis3<-reactive({
  
  if(input$SelectVis3=="Nothing Selected"){
    
  }else if(input$SelectVis3=="Map"){
    if(is.null(input$Vis3_Map_CreelDisplayType)){
      
    }else if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){
      if(input$Vis3_MapDisplayField=="Nothing Selected"){
        
      } else {
        input$Vis3_MapDisplayField
      }
    }else if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){
      if(input$Vis3_MapDisplayField_Size=="Nothing Selected"){
        
      } else {
        input$Vis3_MapDisplayField_Size
      }
    }else if(input$Vis3_Map_CreelDisplayType=="Both"){
      if(input$Vis3_MapDisplayField=="Nothing Selected"||input$Vis3_MapDisplayField_Size=="Nothing Selected"){
        
      } else {
        c(input$Vis3_MapDisplayField,input$Vis3_MapDisplayField_Size)
      }
    } 
  }else if (input$SelectVis3=="Line Plot"){
    if(length(input$Vis3_Line_Number)==0){
      
    }else if (input$Vis3_Line_Number=="1"){
      if(input$Vis3_LineY1=="Nothing Selected"){
        
      } else {
        input$Vis3_LineY1
      }
    } else if(input$Vis3_Line_Number=="2"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"){
        
      } else {
        c(input$Vis3_LineY1,
          input$Vis3_LineY2)
      }
    }else if(input$Vis3_Line_Number=="3"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"){
        
      } else {
        c(input$Vis3_LineY1,
          input$Vis3_LineY2,
          input$Vis3_LineY3)
      }
    }else if(input$Vis3_Line_Number=="4"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"||input$Vis3_LineY4=="Nothing Selected"){
        
      } else {
        c(input$Vis3_LineY1,
          input$Vis3_LineY2,
          input$Vis3_LineY3,
          input$Vis3_LineY4)
      }
    }else if(input$Vis3_Line_Number=="5"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"||input$Vis3_LineY4=="Nothing Selected"||input$Vis3_LineY5=="Nothing Selected"){
        
      } else {
        c(input$Vis3_LineY1,
          input$Vis3_LineY2,
          input$Vis3_LineY3,
          input$Vis3_LineY4,
          input$Vis3_LineY5)
      }
    }
  }else if (input$SelectVis3=="Scatter Plot"){
    if(input$Vis3_ScatterX=="Nothing Selected"||input$Vis3_ScatterY=="Nothing Selected"){
      
    } else {
      c(input$Vis3_ScatterX,
        input$Vis3_ScatterY)
    }
  }else if (input$SelectVis3=="Bar Chart"){
    if(length(input$Vis3_Bar_Number)==0){
      
    }else if (input$Vis3_Bar_Number=="1"){
      if(input$Vis3_BarY1=="Nothing Selected"){
        
      } else {
        c(input$Vis3_BarY1)
      }
    } else if(input$Vis3_Bar_Number=="2"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"){
        
      } else {
        c(input$Vis3_BarY1,
          input$Vis3_BarY2)
      }
    }else if(input$Vis3_Bar_Number=="3"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"){
        
      } else {
        c(input$Vis3_BarY1,
          input$Vis3_BarY2,
          input$Vis3_BarY3)
      }
    }else if(input$Vis3_Bar_Number=="4"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"||input$Vis3_BarY4=="Nothing Selected"){
        
      } else {
        c(input$Vis3_BarY1,
          input$Vis3_BarY2,
          input$Vis3_BarY3,
          input$Vis3_BarY4)
      }
    }else if(input$Vis3_Bar_Number=="5"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"||input$Vis3_BarY4=="Nothing Selected"||input$Vis3_BarY5=="Nothing Selected"){
        
      } else {
        c(input$Vis3_BarY1,
          input$Vis3_BarY2,
          input$Vis3_BarY3,
          input$Vis3_BarY4,
          input$Vis3_BarY5)
      }
    }
  }else if (input$SelectVis3=="Pie Chart"){
    if(length(input$Vis3_Pie_CategoryType)==0){
    }else if (input$Vis3_Pie_CategoryType=="Surveys"){
      if(length(input$Vis3_Pie_Metrics_to_Sum)==0){
        
      } else {
        input$Vis3_Pie_Metrics_to_Sum
      }
    } else if (input$Vis3_Pie_CategoryType=="Metrics"){
      if(length(input$Vis3_Pie_Metrics)==0){
        
      } else {
        input$Vis3_Pie_Metrics
      }
    } 
  }
})

Shared_Input_Variables_Vis4<-reactive({
  
     if(input$SelectVis4=="Nothing Selected"){
       
     }else if(input$SelectVis4=="Map"){
       if(is.null(input$Vis4_Map_CreelDisplayType)){
         
       }else if(input$Vis4_Map_CreelDisplayType=="Scaled Color"){
           if(input$Vis4_MapDisplayField=="Nothing Selected"){
             
           } else {
              input$Vis4_MapDisplayField
           }
       }else if(input$Vis4_Map_CreelDisplayType=="Scaled Size"){
           if(input$Vis4_MapDisplayField_Size=="Nothing Selected"){
             
           } else {
           input$Vis4_MapDisplayField_Size
           }
       }else if(input$Vis4_Map_CreelDisplayType=="Both"){
           if(input$Vis4_MapDisplayField=="Nothing Selected"||input$Vis4_MapDisplayField_Size=="Nothing Selected"){
             
           } else {
           c(input$Vis4_MapDisplayField,input$Vis4_MapDisplayField_Size)
           }
       } 
     }else if (input$SelectVis4=="Line Plot"){
       if(length(input$Vis4_Line_Number)==0){
         
       }else if (input$Vis4_Line_Number=="1"){
         if(input$Vis4_LineY1=="Nothing Selected"){
          
         } else {
         input$Vis4_LineY1
         }
       } else if(input$Vis4_Line_Number=="2"){
         if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"){
           
         } else {
       c(input$Vis4_LineY1,
         input$Vis4_LineY2)
         }
       }else if(input$Vis4_Line_Number=="3"){
         if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"||input$Vis4_LineY3=="Nothing Selected"){
           
         } else {
       c(input$Vis4_LineY1,
         input$Vis4_LineY2,
         input$Vis4_LineY3)
       }
       }else if(input$Vis4_Line_Number=="4"){
         if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"||input$Vis4_LineY3=="Nothing Selected"||input$Vis4_LineY4=="Nothing Selected"){
           
         } else {
       c(input$Vis4_LineY1,
         input$Vis4_LineY2,
         input$Vis4_LineY3,
         input$Vis4_LineY4)
       }
       }else if(input$Vis4_Line_Number=="5"){
         if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"||input$Vis4_LineY3=="Nothing Selected"||input$Vis4_LineY4=="Nothing Selected"||input$Vis4_LineY5=="Nothing Selected"){
           
         } else {
       c(input$Vis4_LineY1,
         input$Vis4_LineY2,
         input$Vis4_LineY3,
         input$Vis4_LineY4,
         input$Vis4_LineY5)
       }
        }
     }else if (input$SelectVis4=="Scatter Plot"){
       if(input$Vis4_ScatterX=="Nothing Selected"||input$Vis4_ScatterY=="Nothing Selected"){
         
       } else {
       c(input$Vis4_ScatterX,
         input$Vis4_ScatterY)
       }
     }else if (input$SelectVis4=="Bar Chart"){
       if(length(input$Vis4_Bar_Number)==0){
         
       }else if (input$Vis4_Bar_Number=="1"){
         if(input$Vis4_BarY1=="Nothing Selected"){
           
         } else {
         c(input$Vis4_BarY1)
         }
       } else if(input$Vis4_Bar_Number=="2"){
         if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"){
           
         } else {
       c(input$Vis4_BarY1,
         input$Vis4_BarY2)
         }
       }else if(input$Vis4_Bar_Number=="3"){
         if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"||input$Vis4_BarY3=="Nothing Selected"){
           
         } else {
       c(input$Vis4_BarY1,
         input$Vis4_BarY2,
         input$Vis4_BarY3)
       }
       }else if(input$Vis4_Bar_Number=="4"){
         if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"||input$Vis4_BarY3=="Nothing Selected"||input$Vis4_BarY4=="Nothing Selected"){
           
         } else {
       c(input$Vis4_BarY1,
         input$Vis4_BarY2,
         input$Vis4_BarY3,
         input$Vis4_BarY4)
       }
       }else if(input$Vis4_Bar_Number=="5"){
         if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"||input$Vis4_BarY3=="Nothing Selected"||input$Vis4_BarY4=="Nothing Selected"||input$Vis4_BarY5=="Nothing Selected"){
           
         } else {
       c(input$Vis4_BarY1,
         input$Vis4_BarY2,
         input$Vis4_BarY3,
         input$Vis4_BarY4,
         input$Vis4_BarY5)
       }
        }
     }else if (input$SelectVis4=="Pie Chart"){
       if(length(input$Vis4_Pie_CategoryType)==0){
       }else if (input$Vis4_Pie_CategoryType=="Surveys"){
         if(length(input$Vis4_Pie_Metrics_to_Sum)==0){
           
         } else {
           input$Vis4_Pie_Metrics_to_Sum
         }
       } else if (input$Vis4_Pie_CategoryType=="Metrics"){
         if(length(input$Vis4_Pie_Metrics)==0){
           
         } else {
           input$Vis4_Pie_Metrics
         }
       } 
     }
   })

Shared_Input_Variables<-reactive({
     req(input$AF_VisNum_Selection)
  if(input$AF_VisNum_Selection=='2'){
      PH<-c(Shared_Input_Variables_Vis1(),Shared_Input_Variables_Vis2())
  } else if (input$AF_VisNum_Selection=='3'){
    PH<-c(Shared_Input_Variables_Vis1(),Shared_Input_Variables_Vis2(),Shared_Input_Variables_Vis3())
  } else if (input$AF_VisNum_Selection=='4'){
       PH<-c(Shared_Input_Variables_Vis1(),Shared_Input_Variables_Vis2(),Shared_Input_Variables_Vis3(),Shared_Input_Variables_Vis4())
  }
  return(PH)
})

# Shared_Input_Variables<-reactive({
#   if(input$AF_VisNum_Selection=='2'){
#       PH<-c(Shared_Input_Variables_Vis1(),Shared_Input_Variables_Vis2())
#   } else if (input$AF_VisNum_Selection=='3'){
#     PH<-c(Shared_Input_Variables_Vis1(),Shared_Input_Variables_Vis2(),Shared_Input_Variables_Vis3())
#   } else if (input$AF_VisNum_Selection=='4'){
#        PH<-c(Shared_Input_Variables_Vis1(),Shared_Input_Variables_Vis2(),Shared_Input_Variables_Vis3(),Shared_Input_Variables_Vis4())
#   } 
#   return(PH)
# })


   
   SharedInputFishTaxa<-reactive({
      Fish_Output<-trimws(sub(paste(FishMetricPick(), collapse = "|"), "", Shared_Input_Variables()[str_detect(Shared_Input_Variables(),paste(FishMetricPick(),collapse="|"))]) )
      return(Fish_Output)
  })
  
  SharedInputFishTaxa_NoGroup<-reactive({
    req(SharedInputFishTaxa())
    SharedInputFishTaxa()%>%
      .[.!=GrpPick()]
  })
 
  SharedInputTarget_Taxa<-reactive({
      Target_Output<-trimws(sub(paste(TargetMetricPick(), collapse = "|"), "", Shared_Input_Variables()[str_detect(Shared_Input_Variables(),paste(TargetMetricPick(),collapse="|"))]) )
      return(Target_Output)
  }) 
  
  SharedInputTarget_Taxa_NoGroup<-reactive({
    req(SharedInputTarget_Taxa())
    SharedInputTarget_Taxa()%>%
      .[.!=AngPref_GrpPick()]
  })

    Shared_UnattributedFishTaxa<-reactive({
     if(length(SharedInputFishTaxa())>0){
       return(
         Shared_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(UnattributedTaxa)%>%
       filter(Taxa%in%SharedInputFishTaxa())%>%
       select(!(UnattributedTaxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
      
  Shared_PartiallyAttributedFishTaxa<-reactive({
      if(length(SharedInputFishTaxa())>0){
       return(
         Shared_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(PartiallyAttributedTaxa)%>%
       filter(Taxa%in%SharedInputFishTaxa())%>%
       select(!(PartiallyAttributedTaxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
   
   Shared_IncompleteAttributedFishTaxa<-reactive({
      if(length(SharedInputFishTaxa())>0){
       return(
         Shared_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(IncompleteAttributedTaxa)%>%
       filter(Taxa%in%SharedInputFishTaxa())%>%
       select(!(Incomplete_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })

       Shared_UnattributedTarget_Taxa<-reactive({
     if(length(SharedInputTarget_Taxa())>0){
       return(
         Shared_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(UnattributedTarget_Taxa)%>%
       filter(Taxa%in%SharedInputTarget_Taxa())%>%
       select(!(UnattributedTarget_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
      
  Shared_PartiallyAttributedTarget_Taxa<-reactive({
      if(length(SharedInputTarget_Taxa())>0){
       return(
         Shared_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(PartiallyAttributedTarget_Taxa)%>%
       filter(Taxa%in%SharedInputTarget_Taxa())%>%
       select(!(PartiallyAttributedTarget_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
   
   Shared_IncompleteAttributedTarget_Taxa<-reactive({
      if(length(SharedInputTarget_Taxa())>0){
       return(
         Shared_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(IncompleteAttributedTarget_Taxa)%>%
       filter(Taxa%in%SharedInputTarget_Taxa())%>%
       select(!(Incomplete_Target_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })


    Shared_Retained_Surveys<-reactive({
      
      Shared_SelectedTBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
    })
    
    Shared_Dropped_Surveys<-reactive({
      
      Shared_SelectedTBL_Raw()%>%anti_join(Shared_SelectedTBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))%>%
        unique()
    })


   output$Shared_Dropped_TBL<-DT::renderDataTable(
    Shared_Dropped_Surveys(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

  output$Shared_Retained_TBL<-DT::renderDataTable(
    Shared_Retained_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
   Shared_Dropped_NA_Surveys<-reactive({
     req(Shared_Selected_NA_TBL(),
         Shared_SelectedTBL_Raw()
         )
     Shared_SelectedTBL_Raw()%>%
       anti_join(Shared_Selected_NA_TBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })
   
   Shared_Dropped_NA_Warn_Surveys<-reactive({
     req(Shared_Dropped_NA_Surveys())
     as.list(as.character(unique(Shared_Dropped_NA_Surveys()$Survey_ID)))
     })
   
   Shared_Dropped_NA_Warn_Surveys_Count<-reactive({
     length(Shared_Dropped_NA_Warn_Surveys())
     })
   
    Shared_Retained_NA_Surveys<-reactive({
      req(Shared_Selected_NA_TBL())
     Shared_Selected_NA_TBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })

   Shared_Retained_NA_Warn_Surveys<-reactive({
     req(Shared_Retained_NA_Surveys())
     as.list(as.character(unique(Shared_Retained_NA_Surveys()$Survey_ID)))
     })
   
   Shared_Retained_NA_Warn_Surveys_Count<-reactive({
     req(Shared_Retained_NA_Warn_Surveys())
     length(Shared_Retained_NA_Warn_Surveys())
     })
   
   output$Shared_Dropped_NA_Warning<-renderText({
    if(length(Shared_Dropped_NA_Warn_Surveys())>0){
      return(paste(as.character(actionLink(inputId = "Shared_NA_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Visualization input fields contain NA values. Surveys containing NA for a visualization input are automatically dropped. </span><span style=\"color:red;font-weight:bold\">", Shared_Dropped_NA_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been dropped;</><span style=\"color:green;font-weight:bold\">",Shared_Retained_NA_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been retained</>"))
  }else {
  } 
  })
      output$Shared_Survey_Char_Drop<-renderText({
        return(paste(as.character(actionLink(inputId = "SharedSurveyDropCharacteristicsTip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black;font-weight:bold\">Survey Characteristic Drops </span>"))
      })
      
      output$Shared_Taxa_Atr_Drop<-renderText({
        return(paste(as.character(actionLink(inputId = "SharedTaxaAttributionDropTip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black;font-weight:bold\">Taxa Attribution Issue Drops </span>"))
      })
  
  observeEvent(input$Shared_NA_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Dropped NA Inputs"),
            h4(strong("Selected surveys contain 'NA' values for inputs which are automatically dropped: ")),
            h4("Visualizations are unable to accomodate 'NA' values for any inputs and they are therefore automatically dropped."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
   
   output$Shared_Dropped_NA_TBL_Pop<-reactive({
      
      length(Shared_Dropped_NA_Warn_Surveys())
      })
    outputOptions(output,'Shared_Dropped_NA_TBL_Pop',suspendWhenHidden=FALSE)
   
   output$Shared_Dropped_NA_TBL<-DT::renderDataTable(
    Shared_Dropped_NA_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
  output$Shared_Retained_NA_TBL<-DT::renderDataTable(
    Shared_Retained_NA_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
  

   Shared_Dropped_All_Surveys<-reactive({
      
     req(Shared_SelectedTBL(),
         Shared_SelectedTBL_Raw()
         )
     
     Shared_SelectedTBL_Raw()%>%
       anti_join(Shared_SelectedTBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })
   
   
   Shared_Dropped_All_Warn_Surveys<-reactive({
     req(Shared_Dropped_All_Surveys())
     as.list(as.character(unique(Shared_Dropped_All_Surveys()$Survey_ID)))
     })
   
   Shared_Dropped_All_Warn_Surveys_Count<-reactive({
     length(Shared_Dropped_All_Warn_Surveys())
     })
   
    Shared_Retained_All_Surveys<-reactive({
      req(Shared_SelectedTBL())
     Shared_SelectedTBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })

   Shared_Retained_All_Warn_Surveys<-reactive({
     req(Shared_Retained_All_Surveys())
     as.list(as.character(unique(Shared_Retained_All_Surveys()$Survey_ID)))
     })
   
   Shared_Retained_All_Warn_Surveys_Count<-reactive({
     req(Shared_Retained_All_Warn_Surveys())
     length(Shared_Retained_All_Warn_Surveys())
     })
   
   output$Shared_Dropped_All_Warning<-renderText({
    if(length(Shared_Dropped_All_Warn_Surveys())>0){
      return(paste(as.character(actionLink(inputId = "Shared_Dropped_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Surveys containing NA for a visualization inputs or user-selected drop characteristics have been dropped; </span><span style=\"color:red;font-weight:bold\">", Shared_Dropped_All_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been dropped;</><span style=\"color:green;font-weight:bold\">",Shared_Retained_All_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been retained</>"))
  }else {
  } 
  })

  
  observeEvent(input$Shared_Dropped_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Dropped Surveys"),
            h4(strong("Selected surveys contain 'NA' values for inputs or characteristics which match user selected 'Drop' criteria from switches above: ")),
            h4("Visualizations are unable to accomodate 'NA' values for any inputs and they are therefore automatically dropped."),
            h4("Surveys sometimes contain undesireable attributes or contain input taxa with attribution issues which lead to the user to drop them from the visualizations by switching the toggles above."),
            h4("This warning reports the total number of surveys which were selected to be included in the visualization as well as the number of surveys which have been dropped either due to NA inputs, undesireable survey characteristics, or the presence of input taxa attribution issues."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$SharedSurveyDropCharacteristicsTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Drop Based on Survey Characteristics"),
            h4(strong("Undesireable Survey Characteristics: ")),
            h4("Surveys occasionally contain undesireable characteristics which may result in a user wishing to exclude/drop them from thier visualizations."),
            h4("By toggling the switches in this section users can decide whether they wish to retain or drop surveys with the following characteristcis."),
            h4(strong("Non-Creel Approaches: "), "Drops surveys which are not classified as 'Creel Survey'. These typically include things like Mail/Phone/Internet Surveys."),
            h4(strong("Unknown/Uncertain Timing: "), "Drops surveys for which are missing start and/or end dates"),
            h4(strong("Unknown/Uncertain Location: "), "Drops surveys for which the location of the waterbody being surveyed can not be confirmed."),
            h4(strong("Unknown/Uncertain Spatial Extent: "), "Drops surveys for which the spatial extent of a survey can not be confirmed."),
            h4(strong("Focal Species: "), "Drops surveys which focus on only a single or group of taxa rather than the entire community."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$SharedTaxaAttributionDropTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),title = strong("Drop Based on Taxa Attribution Issues"),
            h4(strong("Taxa attribution issues: ")),
            h4("Surveys occasionally contain issues with the attribution of values to taxa."),
            h4("By toggling the switches in this section users can decide whether they wish to retain or drop surveys with the following characteristics."),
            h4(strong("Unattributed Input Fish Taxa: "), "Drops surveys for which one of the visualization inputs contains a fish taxa which cannot be attributed 
               (see tip at unattributed taxa warning in the warning panel for more details). Note: For visualizations wholly unattributed taxa are 'Null' so they 
               are dropped automatically, however partially attributed data are contain both attributed values and potentially unattributed values and therefore require 
               toggling of this switch to drop in order to remove."),
            h4(strong("Incomplete Input Fish Groups: "), "Drops surveys for which one of the visualization inputs contains a fish groups which have incomplete attribution 
               (see tip at incomplete group warning in the warning panel for more details)."),
            h4(strong("Unattributed Input Target Taxa: "), "Drops surveys for which one of the visualization inputs contains a target taxa which cannot be attributed 
               (see tip at unattributed target taxa warning in the warning panel for more details). Note: For visualizations wholly unattributed target taxa are 'Null' so they 
               are dropped automatically, however partially attributed data are contain both attributed values and potentially unattributed values and therefore require 
               toggling of this switch to drop in order to remove."),
            h4(strong("Incomplete Input Target Groups: "), "Drops surveys for which one of the visualization inputs contains a target groups which have incomplete attribution 
               (see tip at incomplete group warning in the warning panel for more details)."),
        easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$SharedWarningTableTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("View Warning Tables"),
            h4(strong("Select whether you wish to view tables which summarize any of the listed warning attributes: ")),
            h4(strong("Retained Surveys: "), "Table showing surveys which were retained after surveys which contained 'NA' in at least one visualization input or contained undesireable survey characteristics or input taxa attribution issues were dropped."),
            h4(strong("Dropped Surveys: "), "Table showing surveys which were dropped due to the presence of an 'NA' in at least one visualization input or undesireable survey characteristics or taxa attribution issues."),
            h4(strong("Retained NA Surveys: "), "Table showing surveys which were retained after surveys which contained 'NA' in at least one visualization input were dropped."),
            h4(strong("Dropped NA Surveys: "), "Table showing surveys which were dropped due to the presence of an 'NA' in at least one visualization input."),
            h4(strong("Non-Creel Approaches: "), "Table showing surveys which used any approach not classified as a 'Creel Survey'."),
            h4(strong("Unknown/Uncertain Timing: "), "Table showing surveys which were flagged ashaving unknown or uncertain timing."),
            h4(strong("Unknown/Uncertain Location: "), "Table showing surveys which were flagged ashaving unknown or uncertain locations."),
            h4(strong("Unknown/Uncertain Spatial Extent: "), "Table showing surveys which were flagged ashaving unknown or uncertain spatial extents."),
            h4(strong("Focal Species: "), "Table showing surveys which were conducted based on a focal species rather than the full community."),
            h4(strong("Unattributed Taxa: "), "Table showing records containing unattributed input taxa."),
            h4(strong("Partially Attributed Taxa: "), "Table showing records containing partially attributed input taxa."),
            h4(strong("Incomplete Groups: "), "Table showing records containing incomplete attribution of input groups."),
            h4(strong("Unattributed Target Taxa: "), "Table showing records containing unattributed input target taxa."),
            h4(strong("Partially Attributed Target Taxa: "), "Table showing records containing partially attributed input target taxa."),
            h4(strong("Incomplete Target Groups: "), "Table showing records containing incomplete attribution of input target groups."),
        easyClose = TRUE
        ))
    },ignoreInit=TRUE)
   
   output$Shared_Dropped_All_TBL<-DT::renderDataTable(
    Shared_Dropped_All_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
  output$Shared_Retained_All_TBL<-DT::renderDataTable(
    Shared_Retained_All_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
  
   output$Shared_FishTaxaHeading<-renderText({
    if((length(SharedUnattributedTaxa_Warn_Taxa())>0)||
       (length(SharedIncompleteAttributedTaxa_Warn_Taxa())>0)||
       (nchar(Shared_Overlap_Warn())>1)){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Fish Taxa Input Attribution Issues: </span></h4>"))
  }else {

  }
  })  
   
   output$Shared_AngPrefTaxaHeading<-renderText({
    if((length(SharedUnattributedTarget_Taxa_Warn_Taxa())>0)||
       (length(SharedIncompleteAttributedTarget_Taxa_Warn_Taxa())>0)||
       (nchar(TargetShared_Overlap_Warn())>1)
       ){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Angler Preference Taxa Input Attribution Issues: </span></h4>"))
  }else {

  }
  })  
   
  SharedUnattributedTaxa_Count<-reactive({
    if(is.null(Shared_UnattributedFishTaxa())){
      return(NULL)
    }else{
     Shared_UnattributedFishTaxa()%>%
     count(Taxa)%>%
     unite(Unattributed_Records,"Taxa","n",sep="-")
    }
     })

   SharedUnattributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(SharedUnattributedTaxa_Count()$Unattributed_Records))
     })
   
   SharedUnattributedTaxa_Warn_Vals<-reactive({
     paste(SharedUnattributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Shared_UnattributedFishTaxaWarning<-renderText({
    if(length(SharedUnattributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Shared_Unattributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include unattributed taxa: </span><span style=\"color:red;font-weight:bold\">", SharedUnattributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })

  
  observeEvent(input$Shared_Unattributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unattributed Fish Taxa"),
            h4(strong("Selected surveys contain unattributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The list identifies which taxa have unattributed records in the dataset and how 
               many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


   output$Shared_UnattributedTBL_Pop<-reactive({
      length(SharedUnattributedTaxa_Warn_Taxa())
      })
   
    outputOptions(output,'Shared_UnattributedTBL_Pop',suspendWhenHidden=FALSE)

   output$Shared_UnattributedFishTaxa_TBL<-DT::renderDataTable(
    Shared_UnattributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Attributed Taxa Suggestions ###
    Shared_Attributed_Gain<-reactive({
    if(is.null(Shared_UnattributedFishTaxa())){return(NULL)}else{
     Shared_UnattributedFishTaxa()%>%
     count(Attributed_Taxa)%>%
     unite(GainedRecords,"Attributed_Taxa","n",sep="-")
    }
     })

   SharedAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Shared_Attributed_Gain()$GainedRecords))
     })
   
   SharedAttributedTaxa_Warn_Vals<-reactive({
     paste(SharedAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Shared_AttributedFishTaxaWarning<-renderText({
    if(length(SharedUnattributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Shared_Attributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Consider replacing unattributed and partially attributed taxa with attributed taxa: </span><span style=\"color:green;font-weight:bold\">", SharedAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Shared_Attributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Alternative Attributed Fish Taxa"),
            h4(strong("Alternatives to unattributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The species in this list show the taxa which were originall attributed 
               in the creel survey (ie. what level the taxa was initially recorded at) and the number of records for which this is the case."),
            h4(strong("Recommendation: "),"If possible replace the unattributed taxa with the recommended attributed taxa. Doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


# Partially Attributed Species #
   
   SharedPartiallyAttributedTaxa_Count<-reactive({
    if(is.null(Shared_PartiallyAttributedFishTaxa())){
      return(NULL)
    } else {
     Shared_PartiallyAttributedFishTaxa()%>%
     count(Taxa)%>%
     unite(PartiallyAttributed_Records,"Taxa","n",sep="-")
    }
     })

   SharedPartiallyAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(SharedPartiallyAttributedTaxa_Count()$PartiallyAttributed_Records))
     })
   
   SharedPartiallyAttributedTaxa_Warn_Vals<-reactive({
     paste(SharedPartiallyAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Shared_PartiallyAttributedFishTaxaWarning<-renderText({
    if(length(SharedPartiallyAttributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Shared_PartiallyAttributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include partially attributed taxa: </span><span style=\"color:red;font-weight:bold\">", SharedPartiallyAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Shared_PartiallyAttributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Partially Attributed Fish Taxa"),
            h4(strong("Selected surveys contain partially attributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). Occasionally a survey may record data across multiple overlapping taxanomic 
               levels creating partially attributed taxa. In these cases a survey may contain values attributed to both 'Black Crappie' (species) and 'Crappie' (genus). In thise case the value attributed to 'Black 
               Crappie' represents some, but not necessarily all, of the 'Black Crappie' in the survey as some of the values associated with 'Crappie' (genus) may actually also be 'Black Crappie'. Because of this 
               surveys which include both 'Black Crappie' and  'Crappie' attributions are considered partial attributions (ie. we can not fully attribute the 'Black Crappie' values). The list identifies which taxa have 
               partially attributed records in the dataset and how many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed or partially attributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip: "), "'Partially Attributed' taxa have both attributed and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset. Otherwise 
               partially attributed records will be included in the dataset but only include the directly attributed values without consideration of potential missing values from the unattributed portion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


   output$Shared_PartiallyAttributedTBL_Pop<-reactive({
      
      length(SharedPartiallyAttributedTaxa_Warn_Taxa())
      })
    outputOptions(output,'Shared_PartiallyAttributedTBL_Pop',suspendWhenHidden=FALSE)

   output$Shared_PartiallyAttributedFishTaxa_TBL<-DT::renderDataTable(
    Shared_PartiallyAttributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Incomplete Groups #
      
     SharedIncompleteAttributedTaxa_Count<-reactive({
    if(is.null(Shared_IncompleteAttributedFishTaxa())){
      return(NULL)
    }else{
     Shared_IncompleteAttributedFishTaxa()%>%
     count(Taxa)%>%
     unite(IncompleteAttributed_Records,"Taxa","n",sep="-")
    }
     })

   SharedIncompleteAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(SharedIncompleteAttributedTaxa_Count()$IncompleteAttributed_Records))
     })
   
   SharedIncompleteAttributedTaxa_Warn_Vals<-reactive({
     paste(SharedIncompleteAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Shared_IncompleteAttributedFishTaxaWarning<-renderText({
    if(length(SharedIncompleteAttributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Shared_IncompleteAttributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include groups with incomplete attribution of taxa: </span><span style=\"color:red;font-weight:bold\">", SharedIncompleteAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Shared_IncompleteAttributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Incomplete Attribution of Fish Taxa"),
            h4(strong("Selected surveys contain incompletely attributed fish groups in inputs: ")),
            h4("Values for groups are typically generated either as a direct attribution of the group in the survey (ie. 'Panfish' estimates recorded directly), or by summing values for all component members 
            (ie. 'Trout' estimate generated by adding values from 'Rainbow Trout', 'Brook Trout', and 'Brown Trout'). Because groups are not monophyletic there can be cases when a group value may be incompletely 
            attributed due to component taxa which span within and outside group status (ie. a survey containing values attributed to the genus' 'Salvelinus' and 'Onchorynchus', while all values for 'Salvelinus' can 
            be (and therefore are) attributed to 'Trout', 'Onchorynchus'  includes both 'Trout' (Rainbow Trout, Cutthroat Trout...) and 'Non-Trout' (Chinook Salmon, Coho Salmon...), and therefore can not be attributed to 'Trout' 
            although some portion of those values may actually be 'Trout'.). In this case the records for 'Trout' are identified as 'Incomplete' meaning that some taxa are present within the record which may or may not be attributable 
            to the selected 'Group'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping incompletely attributed fish group records by toggling the 'Incomplete Input Fish Groups'  
               switch from 'Retained' to 'Dropped'."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)



   output$Shared_IncompleteTBL_Pop<-reactive({
      
      length(SharedIncompleteAttributedTaxa_Warn_Taxa())
      })
    outputOptions(output,'Shared_IncompleteTBL_Pop',suspendWhenHidden=FALSE)

   output$Shared_IncompleteAttributedFishTaxa_TBL<-DT::renderDataTable(
    Shared_IncompleteAttributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )



   ### Overlapping Taxa Selection ###

FamilyShared_Selected<-reactive({
  TaxaTable%>%filter(Family %in% SharedInputFishTaxa())%>%select(Family)%>%unique()
  })

GenusShared_Selected<-reactive({
  TaxaTable%>%filter(Genus %in% SharedInputFishTaxa())%>%select(Family,Genus)%>%unique()
  })

SpeciesShared_Selected<-reactive({
  TaxaTable%>%filter(Species %in% SharedInputFishTaxa())%>%select(Family,Genus,Species)%>%unique()
  })

SubsShared_Selected<-reactive({
  TaxaTable%>%filter(Subspecies_Variants %in% SharedInputFishTaxa())%>%select(Family,Genus,Species,Subspecies_Variants)%>%unique()
  })


Genus_Family_Shared_Overlap<-reactive({
      
  req(GenusShared_Selected())
  req(FamilyShared_Selected())
  
  GenusShared_Selected()%>%
  inner_join(FamilyShared_Selected(),by='Family')%>%
  select(Family,Genus)%>%
  unite(Overlaps,"Family","Genus",sep=" overlaps ")})

Species_Family_Shared_Overlap<-reactive({
      
  req(SpeciesShared_Selected())
  req(FamilyShared_Selected())
  
  SpeciesShared_Selected()%>%
  inner_join(FamilyShared_Selected(),by='Family')%>%
  select(Family,Species)%>%
  unite(Overlaps,"Family","Species",sep=" overlaps ")})

Species_Genus_Shared_Overlap<-reactive({
      
  req(SpeciesShared_Selected())
  req(GenusShared_Selected())
  
  SpeciesShared_Selected()%>%
  inner_join(GenusShared_Selected(),by='Genus')%>%
  select(Genus,Species)%>%
  unite(Overlaps,"Genus","Species",sep=" overlaps ")})

Subspecies_Family_Shared_Overlap<-reactive({
  req(SubsShared_Selected())
  req(FamilyShared_Selected())
  
  SubsShared_Selected()%>%
  inner_join(FamilyShared_Selected(),by='Family')%>%
  select(Family,Subspecies_Variants)%>%
  unite(Overlaps,"Family","Subspecies_Variants",sep=" overlaps ")})

Subspecies_Genus_Shared_Overlap<-reactive({
      
  req(SubsShared_Selected())
  req(GenusShared_Selected())
  
  SubsShared_Selected()%>%
  inner_join(GenusShared_Selected(),by='Genus')%>%
  select(Genus,Subspecies_Variants)%>%
  unite(Overlaps,"Genus","Subspecies_Variants",sep=" overlaps ")})

Subspecies_Species_Shared_Overlap<-reactive({
      
  req(SubsShared_Selected())
  req(SpeciesShared_Selected())
  
  SubsShared_Selected()%>%
  inner_join(SpeciesShared_Selected(),by='Species')%>%
  select(Species,Subspecies_Variants)%>%
  unite(Overlaps,"Species","Subspecies_Variants",sep=" overlaps ")})

Group_Taxa_Shared_Overlap<-reactive({
      
 # req(input$AF_SharedData=="No"||is.null(input$AF_SharedData))
  req(SharedInputFishTaxa())
  
  GroupTaxa%>%
  filter(Group %in% SharedInputFishTaxa())%>%
  filter(Taxa %in% SharedInputFishTaxa_NoGroup())%>%
  unite(Overlaps,"Group","Taxa",sep=" overlaps ")%>%
  select(Overlaps)})

SharedOverlaps<-reactive({
  PH<-as.list(bind_rows(Genus_Family_Shared_Overlap(),Species_Family_Shared_Overlap(),Species_Genus_Shared_Overlap(),Subspecies_Family_Shared_Overlap(),Subspecies_Genus_Shared_Overlap(),Subspecies_Species_Shared_Overlap(),Group_Taxa_Shared_Overlap()))
return(PH)
})

   SharedOverlapTaxa_Warn<-reactive({
     as.list(as.character(unique(SharedOverlaps()$Overlaps)))
     })
   
   Shared_Overlap_Warn<-reactive({
     paste(SharedOverlapTaxa_Warn(),collapse=" & ")
     })

   output$Shared_OverlapFishWarning<-renderText({
    if(nchar(Shared_Overlap_Warn())>1){
      return(paste(as.character(actionLink(inputId = "Shared_Overlap_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input taxa include overlapping value attribution: </span><span style=\"color:red;font-weight:bold\">", Shared_Overlap_Warn(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Shared_Overlap_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Overlap of Input Fish Taxa"),
            h4(strong("Selected fish inputs contain overlapping taxa: ")),
            h4("Taxa can be attributed at multiple, overlapping taxanomic levels and therefore the associated values can result in overlap or double counting (ie. a user selects both 
               'Bluegill' (Species) and 'Lepomis' (Genus) harvest estimates, the harvest estimate attributable to 'Bluegill'(10) is also included within 'Lepomis'(30), meaning of the 30 'Lepomis' individuals harvested 10 of them are the 
               same as the 10 recorded in Bluegill, while 20 of them are from different 'Lepomis' taxa."),
            h4(strong("Recommendation: "),"We suggest avoiding overlapping taxa whereever possible to avoid double, triple, etc. counting of values. In order to do this select only non-overlapping taxa for inputs."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)


  SharedUnattributedTarget_Taxa_Count<-reactive({
    if(is.null(Shared_UnattributedTarget_Taxa())){
      return(NULL)
    }else{
     Shared_UnattributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(Unattributed_Records,"Taxa","n",sep="-")
    }
     })

   SharedUnattributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(SharedUnattributedTarget_Taxa_Count()$Unattributed_Records))
     })
   
   SharedUnattributedTarget_Taxa_Warn_Vals<-reactive({
     paste(SharedUnattributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Shared_UnattributedTarget_TaxaWarning<-renderText({
    if(length(SharedUnattributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Shared_Unattributed_Target_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include unattributed target taxa: </span><span style=\"color:red;font-weight:bold\">", SharedUnattributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Shared_Unattributed_Target_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unattributed Target Taxa"),
            h4(strong("Selected surveys contain unattributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The list identifies which taxa have unattributed records in the dataset and how 
               many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   # Attributed Taxa Suggestions ###
    Shared_Attributed_TargetGain<-reactive({
      if(is.null(Shared_UnattributedTarget_Taxa())){
        return(NULL)
      }else{
     return(Shared_UnattributedTarget_Taxa()%>%
     count(Attributed_Target_Taxa)%>%
     unite(GainedRecords,"Attributed_Target_Taxa","n",sep="-"))
      }
     })

   SharedAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Shared_Attributed_TargetGain()$GainedRecords))
     })
   
   SharedAttributedTarget_Taxa_Warn_Vals<-reactive({paste(SharedAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")})

   output$Shared_AttributedTarget_TaxaWarning<-renderText({
    if(nchar(SharedAttributedTarget_Taxa_Warn_Vals())>1){
      return(paste(as.character(actionLink(inputId = "Shared_AttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Consider replacing unattributed and partially attributed taxa with attributed taxa: </span><span style=\"color:green;font-weight:bold\">", SharedAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Shared_AttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Alternative Attributed Target Taxa"),
            h4(strong("Alternatives to unattributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The species in this list show the taxa which were originall attributed 
               in the creel survey (ie. what level the taxa was initially recorded at) and the number of records for which this is the case."),
            h4(strong("Recommendation: "),"If possible replace the unattributed target taxa with the recommended attributed target taxa. Doing so will reduce the instances of 
               unattributed target taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however if a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Shared_UnattributedTargetTBL_Pop<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
      length(SharedUnattributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Shared_UnattributedTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Shared_UnattributedTarget_Taxa_TBL<-DT::renderDataTable(
    Shared_UnattributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
 SharedPartiallyAttributedTarget_Taxa_Count<-reactive({
    if(is.null(Shared_PartiallyAttributedTarget_Taxa())){
      return(NULL)
    } else {
     Shared_PartiallyAttributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(PartiallyAttributed_Records,"Taxa","n",sep="-")
    }
     })

   SharedPartiallyAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(SharedPartiallyAttributedTarget_Taxa_Count()$PartiallyAttributed_Records))
     })
   
   SharedPartiallyAttributedTarget_Taxa_Warn_Vals<-reactive({
     paste(SharedPartiallyAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Shared_PartiallyAttributedFishTarget_TaxaWarning<-renderText({
    if(length(SharedPartiallyAttributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Shared_PartiallyAttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include partially attributed target taxa: </span><span style=\"color:red;font-weight:bold\">", SharedPartiallyAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })

    observeEvent(input$Shared_PartiallyAttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Partially Attributed Target Taxa"),
            h4(strong("Selected surveys contain partially attributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). Occasionally a survey may record data across multiple overlapping taxanomic 
               levels creating partially attributed taxa. In these cases a survey may contain values attributed to both 'Black Crappie' (species) and 'Crappie' (genus). In thise case the value attributed to 'Black 
               Crappie' represents some, but not necessarily all, of the 'Black Crappie' in the survey as some of the values associated with 'Crappie' (genus) may actually also be 'Black Crappie'. Because of this 
               surveys which include both 'Black Crappie' and  'Crappie' attributions are considered partial attributions (ie. we can not fully attribute the 'Black Crappie' values). The list identifies which taxa have 
               partially attributed records in the dataset and how many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed or partially attributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Target Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip: "), "'Partially Attributed' taxa have both attributed and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset. Otherwise 
               partially attributed records will be included in the dataset but only include the directly attributed values without consideration of potential missing values from the unattributed portion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Shared_PartiallyAttributedTargetTBL_Pop<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
      length(SharedPartiallyAttributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Shared_PartiallyAttributedTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Shared_PartiallyAttributedTarget_Taxa_TBL<-DT::renderDataTable(
    Shared_PartiallyAttributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Incomplete Groups #
   
     SharedIncompleteAttributedTarget_Taxa_Count<-reactive({
    if(is.null(Shared_IncompleteAttributedTarget_Taxa())){
      return(NULL)
    }else{
     Shared_IncompleteAttributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(IncompleteAttributed_Records,"Taxa","n",sep="-")
    }
     })

   SharedIncompleteAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(SharedIncompleteAttributedTarget_Taxa_Count()$IncompleteAttributed_Records))
     })
   
   SharedIncompleteAttributedTarget_Taxa_Warn_Vals<-reactive({
     paste(SharedIncompleteAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Shared_IncompleteAttributedFishTarget_TaxaWarning<-renderText({
    if(length(SharedIncompleteAttributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Shared_IncompleteAttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include groups with incomplete attribution of target taxa: </span><span style=\"color:red;font-weight:bold\">", SharedIncompleteAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })  
   
  observeEvent(input$Shared_IncompleteAttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Incomplete Attribution of Target Taxa"),
            h4(strong("Selected surveys contain incompletely attributed target groups in inputs: ")),
            h4("Values for groups are typically generated either as a direct attribution of the group in the survey (ie. 'Panfish' estimates recorded directly), or by summing values for all component members 
            (ie. 'Trout' estimate generated by adding values from 'Rainbow Trout', 'Brook Trout', and 'Brown Trout'). Because groups are not monophyletic there can be cases when a group value may be incompletely 
            attributed due to component taxa which span within and outside group status (ie. a survey containing values attributed to the genus' 'Salvelinus' and 'Onchorynchus', while all values for 'Salvelinus' can 
            be (and therefore are) attributed to 'Trout', 'Onchorynchus'  includes both 'Trout' (Rainbow Trout, Cutthroat Trout...) and 'Non-Trout' (Chinook Salmon, Coho Salmon...), and therefore can not be attributed to 'Trout' 
            although some portion of those values may actually be 'Trout'.). In this case the records for 'Trout' are identified as 'Incomplete' meaning that some taxa are present within the record which may or may not be attributable 
            to the selected 'Group'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping incompletely attributed target group records by toggling the 'Incomplete Input Fish Groups'  
               switch from 'Retained' to 'Dropped'."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Shared_IncompleteTargetTBL_Pop<-reactive({
      
      length(SharedIncompleteAttributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Shared_IncompleteTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Shared_IncompleteAttributedTarget_Taxa_TBL<-DT::renderDataTable(
    Shared_IncompleteAttributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )



   ### Overlapping Target Taxa Selection ###



TargetFamilyShared_Selected<-reactive({
  TaxaTable%>%filter(Family %in% SharedInputTarget_Taxa())%>%select(Family)%>%unique()
  })

TargetGenusShared_Selected<-reactive({
  TaxaTable%>%filter(Genus %in% SharedInputTarget_Taxa())%>%select(Family,Genus)%>%unique()
  })
TargetSpeciesShared_Selected<-reactive({
  TaxaTable%>%filter(Species %in% SharedInputTarget_Taxa())%>%select(Family,Genus,Species)%>%unique()
  })

TargetSubsShared_Selected<-reactive({
  TaxaTable%>%filter(Subspecies_Variants %in% SharedInputTarget_Taxa())%>%select(Family,Genus,Species,Subspecies_Variants)%>%unique()
  })


TargetGenus_Family_Shared_Overlap<-reactive({
  req(TargetGenusShared_Selected())
  req(TargetFamilyShared_Selected())
  
  TargetGenusShared_Selected()%>%
  inner_join(TargetFamilyShared_Selected(),by='Family')%>%
  select(Family,Genus)%>%
  unite(Overlaps,"Family","Genus",sep=" overlaps ")
  })

TargetSpecies_Family_Shared_Overlap<-reactive({
  req(TargetSpeciesShared_Selected())
  req(TargetFamilyShared_Selected())
  
  TargetSpeciesShared_Selected()%>%
  inner_join(TargetFamilyShared_Selected(),by='Family')%>%
  select(Family,Species)%>%
  unite(Overlaps,"Family","Species",sep=" overlaps ")
  })

TargetSpecies_Genus_Shared_Overlap<-reactive({
  req(TargetSpeciesShared_Selected())
  req(TargetGenusShared_Selected())
  
  TargetSpeciesShared_Selected()%>%
  inner_join(TargetGenusShared_Selected(),by='Genus')%>%
  select(Genus,Species)%>%
  unite(Overlaps,"Genus","Species",sep=" overlaps ")
  })

TargetSubspecies_Family_Shared_Overlap<-reactive({
  req(TargetSubsShared_Selected())
  req(TargetFamilyShared_Selected())
  
  TargetSubsShared_Selected()%>%
  inner_join(TargetFamilyShared_Selected(),by='Family')%>%
  select(Family,Subspecies_Variants)%>%
  unite(Overlaps,"Family","Subspecies_Variants",sep=" overlaps ")
  })

TargetSubspecies_Genus_Shared_Overlap<-reactive({
  req(TargetSubsShared_Selected())
  req(TargetGenusShared_Selected())
  
  TargetSubsShared_Selected()%>%
  inner_join(TargetGenusShared_Selected(),by='Genus')%>%
  select(Genus,Subspecies_Variants)%>%
  unite(Overlaps,"Genus","Subspecies_Variants",sep=" overlaps ")
  })

TargetSubspecies_Species_Shared_Overlap<-reactive({
  req(TargetSubsShared_Selected())
  req(TargetSpeciesShared_Selected())
  
  TargetSubsShared_Selected()%>%
  inner_join(TargetSpeciesShared_Selected(),by='Species')%>%
  select(Species,Subspecies_Variants)%>%
  unite(Overlaps,"Species","Subspecies_Variants",sep=" overlaps ")
  })

TargetGroup_Taxa_Shared_Overlap<-reactive({
  #req(input$AF_SharedData=="No"||is.null(input$AF_SharedData))
  req(SharedInputTarget_Taxa())
  
    GroupTaxa%>%
  filter(Group %in% SharedInputTarget_Taxa())%>%
  filter(Taxa %in% SharedInputTarget_Taxa_NoGroup())%>%
  unite(Overlaps,"Group","Taxa",sep=" overlaps ")%>%
  select(Overlaps)
 
  })

TargetSharedOverlaps<-reactive({
  PH<-as.list(bind_rows(TargetGenus_Family_Shared_Overlap(),TargetSpecies_Family_Shared_Overlap(),TargetSpecies_Genus_Shared_Overlap(),TargetSubspecies_Family_Shared_Overlap(),TargetSubspecies_Genus_Shared_Overlap(),TargetSubspecies_Species_Shared_Overlap(),TargetGroup_Taxa_Shared_Overlap()))
return(PH)
})

   TargetSharedOverlapTaxa_Warn<-reactive({
     as.list(as.character(unique(TargetSharedOverlaps()$Overlaps)))
     })
   
   TargetShared_Overlap_Warn<-reactive({
     paste(TargetSharedOverlapTaxa_Warn(),collapse=" & ")
     })

   output$Shared_OverlapTargetWarning<-renderText({
    if(nchar(TargetShared_Overlap_Warn())>1){
      return(paste(as.character(actionLink(inputId = "TargetShared_Overlap_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input target taxa include overlapping value attribution: </span><span style=\"color:red;font-weight:bold\">", TargetShared_Overlap_Warn(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$TargetShared_Overlap_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Overlap of Input Target Taxa"),
            h4(strong("Selected angler preference inputs contain overlapping target taxa: ")),
            h4("Taxa can be attributed at multiple, overlapping taxanomic levels and therefore the associated values can result in overlap or double counting (ie. a user selects both 
               'Bluegill' (Species) and 'Lepomis' (Genus) estimates, the estimate attributable to 'Bluegill'(10) is also included within 'Lepomis'(30), meaning of the 30 'Lepomis' values 10 of them are the 
               same as the 10 recorded in Bluegill, while 20 of them are from different 'Lepomis' taxa."),
            h4(strong("Recommendation: "),"We suggest avoiding overlapping taxa whereever possible to avoid double, triple, etc. counting of values. In order to do this select only non-overlapping target taxa for inputs."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  
   # Vis 1 #
   Vis_1_Selected_NA_TBL<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
     if(input$SelectVis1=="Nothing Selected"){
       Vis_1_SelectedTBL_Raw()
     }else if(input$SelectVis1=="Map"){
       if(is.null(input$Vis1_Map_CreelDisplayType)){
         Vis_1_SelectedTBL_Raw()
       }else if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){
           if(input$Vis1_MapDisplayField=="Nothing Selected"){
             Vis_1_SelectedTBL_Raw()
           } else {
           Vis_1_SelectedTBL_Raw()%>%
               drop_na(input$Vis1_MapDisplayField)
           }
       }else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){
           if(input$Vis1_MapDisplayField_Size=="Nothing Selected"){
             Vis_1_SelectedTBL_Raw()
           } else {
           Vis_1_SelectedTBL_Raw()%>%
               drop_na(input$Vis1_MapDisplayField_Size)
           }
       }else if(input$Vis1_Map_CreelDisplayType=="Both"){
           if(input$Vis1_MapDisplayField=="Nothing Selected"||input$Vis1_MapDisplayField_Size=="Nothing Selected"){
             Vis_1_SelectedTBL_Raw()
           } else {
           Vis_1_SelectedTBL_Raw()%>%
               drop_na(input$Vis1_MapDisplayField)%>%
               drop_na(input$Vis1_MapDisplayField_Size)
           }
       } 
     }else if (input$SelectVis1=="Line Plot"){
       if(length(input$Vis1_Line_Number)==0){
         Vis_1_SelectedTBL_Raw()
       }else if (input$Vis1_Line_Number=="1"){
         if(input$Vis1_LineY1=="Nothing Selected"){
           Vis_1_SelectedTBL_Raw()
         } else {
         Vis_1_SelectedTBL_Raw()%>%
         drop_na(input$Vis1_LineY1)
         }
       } else if(input$Vis1_Line_Number=="2"){
         if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"){
           Vis_1_SelectedTBL_Raw()
         } else {
       Vis_1_SelectedTBL_Raw()%>%
         drop_na(input$Vis1_LineY1)%>%
         drop_na(input$Vis1_LineY2)
         }
       }else if(input$Vis1_Line_Number=="3"){
         if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"){
           Vis_1_SelectedTBL_Raw()
         } else {
       Vis_1_SelectedTBL_Raw()%>%
         drop_na(input$Vis1_LineY1)%>%
         drop_na(input$Vis1_LineY2)%>%
         drop_na(input$Vis1_LineY3)
       }
       }else if(input$Vis1_Line_Number=="4"){
         if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"||input$Vis1_LineY4=="Nothing Selected"){
           Vis_1_SelectedTBL_Raw()
         } else {
       Vis_1_SelectedTBL_Raw()%>%
         drop_na(input$Vis1_LineY1)%>%
         drop_na(input$Vis1_LineY2)%>%
         drop_na(input$Vis1_LineY3)%>%
         drop_na(input$Vis1_LineY4)
       }
       }else if(input$Vis1_Line_Number=="5"){
         if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"||input$Vis1_LineY4=="Nothing Selected"||input$Vis1_LineY5=="Nothing Selected"){
           Vis_1_SelectedTBL_Raw()
         } else {
       Vis_1_SelectedTBL_Raw()%>%
         drop_na(input$Vis1_LineY1)%>%
         drop_na(input$Vis1_LineY2)%>%
         drop_na(input$Vis1_LineY3)%>%
         drop_na(input$Vis1_LineY4)%>%
         drop_na(input$Vis1_LineY5)
       }
        }
     }else if (input$SelectVis1=="Scatter Plot"){
       if(input$Vis1_ScatterX=="Nothing Selected"||input$Vis1_ScatterY=="Nothing Selected"){
         Vis_1_SelectedTBL_Raw()
       } else {
       Vis_1_SelectedTBL_Raw()%>%
         drop_na(input$Vis1_ScatterX)%>%
         drop_na(input$Vis1_ScatterY)
       }
     }else if (input$SelectVis1=="Bar Chart"){
       if(length(input$Vis1_Bar_Number)==0){
         Vis_1_SelectedTBL_Raw()
       }else if (input$Vis1_Bar_Number=="1"){
         if(input$Vis1_BarY1=="Nothing Selected"){
           Vis_1_SelectedTBL_Raw()
         } else {
         Vis_1_SelectedTBL_Raw()%>%
         drop_na(input$Vis1_BarY1)
         }
       } else if(input$Vis1_Bar_Number=="2"){
         if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"){
           Vis_1_SelectedTBL_Raw()
         } else {
       Vis_1_SelectedTBL_Raw()%>%
         drop_na(input$Vis1_BarY1)%>%
         drop_na(input$Vis1_BarY2)
         }
       }else if(input$Vis1_Bar_Number=="3"){
         if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"){
           Vis_1_SelectedTBL_Raw()
         } else {
       Vis_1_SelectedTBL_Raw()%>%
         drop_na(input$Vis1_BarY1)%>%
         drop_na(input$Vis1_BarY2)%>%
         drop_na(input$Vis1_BarY3)
       }
       }else if(input$Vis1_Bar_Number=="4"){
         if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"||input$Vis1_BarY4=="Nothing Selected"){
           Vis_1_SelectedTBL_Raw()
         } else {
       Vis_1_SelectedTBL_Raw()%>%
         drop_na(input$Vis1_BarY1)%>%
         drop_na(input$Vis1_BarY2)%>%
         drop_na(input$Vis1_BarY3)%>%
         drop_na(input$Vis1_BarY4)
       }
       }else if(input$Vis1_Bar_Number=="5"){
         if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"||input$Vis1_BarY4=="Nothing Selected"||input$Vis1_BarY5=="Nothing Selected"){
           Vis_1_SelectedTBL_Raw()
         } else {
       Vis_1_SelectedTBL_Raw()%>%
         drop_na(input$Vis1_BarY1)%>%
         drop_na(input$Vis1_BarY2)%>%
         drop_na(input$Vis1_BarY3)%>%
         drop_na(input$Vis1_BarY4)%>%
         drop_na(input$Vis1_BarY5)
       }
        }
     }else if (input$SelectVis1=="Pie Chart"){
       if(length(input$Vis1_Pie_CategoryType)==0){Vis_1_SelectedTBL_Raw()
       }else if (input$Vis1_Pie_CategoryType=="Surveys"){
         if(length(input$Vis1_Pie_Metrics_to_Sum)==0){
           Vis_1_SelectedTBL_Raw()
         } else {
           Vis_1_SelectedTBL_Raw()%>%
             drop_na(input$Vis1_Pie_Metrics_to_Sum)
         }
       } else if (input$Vis1_Pie_CategoryType=="Metrics"){
         if(length(input$Vis1_Pie_Metrics)==0){
           Vis_1_SelectedTBL_Raw()
         } else {
           Vis_1_SelectedTBL_Raw()%>%
             drop_na(input$Vis1_Pie_Metrics)
         }
       } 
     }
   })
    
##### New Filtered by Species #####
   
#### Shared #####
   

   
   
#### Vis 1 ######  
   
    Vis_1_SurveyWarnTBL<-reactive({
      req(Vis_1_WarningData())
     
      NonCreel_Retained<-if(input$NonCreel_Vis_1_Switch==TRUE){
        Vis_1_WarningData()%>%
          filter(.,Survey_Type=="Creel Survey")%>%
          select(Survey_ID)
        }else{
            Vis_1_WarningData()%>%
              select(Survey_ID)
        }

      Timing_Retained<-if(input$UnkTiming_Vis_1_Switch==TRUE){
        Vis_1_WarningData()%>%
          filter(.,!Timing_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Vis_1_WarningData()%>%
              select(Survey_ID)
        }

      Location_Retained<-if(input$UnkLocation_Vis_1_Switch==TRUE){
        Vis_1_WarningData()%>%
          filter(.,!Location_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Vis_1_WarningData()%>%
              select(Survey_ID)
        }

      Extent_Retained<-if(input$UnkExtent_Vis_1_Switch==TRUE){
        Vis_1_WarningData()%>%
          filter(.,!Extent_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Vis_1_WarningData()%>%
              select(Survey_ID)
        }

      FocalTaxa_Retained<-if(input$FocSpecies_Vis_1_Switch==TRUE){
        Vis_1_WarningData()%>%
          filter(.,Focal_Species==c("All"))%>%
          select(Survey_ID)
        }else{
            Vis_1_WarningData()%>%
              select(Survey_ID)
        }
      
       
        Vis_1_Survey_Filt<-NonCreel_Retained%>%
          semi_join(.,Timing_Retained,by='Survey_ID')%>%
          semi_join(.,Location_Retained,by='Survey_ID')%>%
          semi_join(.,Extent_Retained,by='Survey_ID')%>%
          semi_join(.,FocalTaxa_Retained,by='Survey_ID')%>%
          droplevels()

    return(Vis_1_Survey_Filt)

    })   
   
   Vis_1_TaxaWarnTBL<-reactive({
      req(Vis_1_SelectedTBL_Raw())
      Vis1UnattributedSurveys_Retained<-if(is.null(Vis1_UnattributedFishTaxa())){
        Vis_1_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$UnFish_Vis_1_Switch==TRUE){
        Vis_1_SelectedTBL_Raw()%>%
        anti_join(Vis1_UnattributedFishTaxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_1_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      Vis1IncompleteSurveys_Retained<-if(is.null(Vis1_IncompleteAttributedFishTaxa())){
        Vis_1_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$InFishGroup_Vis_1_Switch==TRUE){
        Vis_1_SelectedTBL_Raw()%>%
        anti_join(Vis1_IncompleteAttributedFishTaxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_1_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      Vis1UnattributedTargetSurveys_Retained<-if(is.null(Vis1_UnattributedTarget_Taxa())){
        Vis_1_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$UnTarget_Vis_1_Switch==TRUE){
        Vis_1_SelectedTBL_Raw()%>%
        anti_join(Vis1_UnattributedTarget_Taxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_1_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      Vis1IncompleteTargetSurveys_Retained<-if(is.null(Vis1_IncompleteAttributedTarget_Taxa())){
        Vis_1_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$InTargetGroup_Vis_1_Switch==TRUE){
        Vis_1_SelectedTBL_Raw()%>%
        anti_join(Vis1_IncompleteAttributedTarget_Taxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_1_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }
       
        Vis_1_Survey_Filt<-Vis1UnattributedSurveys_Retained%>%
          semi_join(.,Vis1IncompleteSurveys_Retained,by='Survey_ID')%>%
          semi_join(.,Vis1UnattributedTargetSurveys_Retained,by='Survey_ID')%>%
          semi_join(.,Vis1IncompleteTargetSurveys_Retained,by='Survey_ID')%>%
          droplevels()

    return(Vis_1_Survey_Filt)

    })   
   
Vis_1_SelectedTBL<-reactive({
  req(Vis_1_SurveyWarnTBL())
  req(Vis_1_TaxaWarnTBL())
  req(Vis_1_Selected_NA_TBL())
  
  Vis_1_Selected_NA_TBL()%>%
    semi_join(.,Vis_1_SurveyWarnTBL(),by='Survey_ID')%>%
    semi_join(.,Vis_1_TaxaWarnTBL(),by='Survey_ID')%>%
    droplevels()
  
})

   
   

Vis_1_Input_Variables<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
     if(input$SelectVis1=="Nothing Selected"){
       
     }else if(input$SelectVis1=="Map"){
       if(is.null(input$Vis1_Map_CreelDisplayType)){
         
       }else if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){
           if(input$Vis1_MapDisplayField=="Nothing Selected"){
             
           } else {
              input$Vis1_MapDisplayField
           }
       }else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){
           if(input$Vis1_MapDisplayField_Size=="Nothing Selected"){
             
           } else {
           input$Vis1_MapDisplayField_Size
           }
       }else if(input$Vis1_Map_CreelDisplayType=="Both"){
           if(input$Vis1_MapDisplayField=="Nothing Selected"||input$Vis1_MapDisplayField_Size=="Nothing Selected"){
             
           } else {
           c(input$Vis1_MapDisplayField,input$Vis1_MapDisplayField_Size)
           }
       } 
     }else if (input$SelectVis1=="Line Plot"){
       if(length(input$Vis1_Line_Number)==0){
         
       }else if (input$Vis1_Line_Number=="1"){
         if(input$Vis1_LineY1=="Nothing Selected"){
          
         } else {
         input$Vis1_LineY1
         }
       } else if(input$Vis1_Line_Number=="2"){
         if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"){
           
         } else {
       c(input$Vis1_LineY1,
         input$Vis1_LineY2)
         }
       }else if(input$Vis1_Line_Number=="3"){
         if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"){
           
         } else {
       c(input$Vis1_LineY1,
         input$Vis1_LineY2,
         input$Vis1_LineY3)
       }
       }else if(input$Vis1_Line_Number=="4"){
         if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"||input$Vis1_LineY4=="Nothing Selected"){
           
         } else {
       c(input$Vis1_LineY1,
         input$Vis1_LineY2,
         input$Vis1_LineY3,
         input$Vis1_LineY4)
       }
       }else if(input$Vis1_Line_Number=="5"){
         if(input$Vis1_LineY1=="Nothing Selected"||input$Vis1_LineY2=="Nothing Selected"||input$Vis1_LineY3=="Nothing Selected"||input$Vis1_LineY4=="Nothing Selected"||input$Vis1_LineY5=="Nothing Selected"){
           
         } else {
       c(input$Vis1_LineY1,
         input$Vis1_LineY2,
         input$Vis1_LineY3,
         input$Vis1_LineY4,
         input$Vis1_LineY5)
       }
        }
     }else if (input$SelectVis1=="Scatter Plot"){
       if(input$Vis1_ScatterX=="Nothing Selected"||input$Vis1_ScatterY=="Nothing Selected"){
         
       } else {
       c(input$Vis1_ScatterX,
         input$Vis1_ScatterY)
       }
     }else if (input$SelectVis1=="Bar Chart"){
       if(length(input$Vis1_Bar_Number)==0){
         
       }else if (input$Vis1_Bar_Number=="1"){
         if(input$Vis1_BarY1=="Nothing Selected"){
           
         } else {
         c(input$Vis1_BarY1)
         }
       } else if(input$Vis1_Bar_Number=="2"){
         if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"){
           
         } else {
       c(input$Vis1_BarY1,
         input$Vis1_BarY2)
         }
       }else if(input$Vis1_Bar_Number=="3"){
         if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"){
           
         } else {
       c(input$Vis1_BarY1,
         input$Vis1_BarY2,
         input$Vis1_BarY3)
       }
       }else if(input$Vis1_Bar_Number=="4"){
         if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"||input$Vis1_BarY4=="Nothing Selected"){
           
         } else {
       c(input$Vis1_BarY1,
         input$Vis1_BarY2,
         input$Vis1_BarY3,
         input$Vis1_BarY4)
       }
       }else if(input$Vis1_Bar_Number=="5"){
         if(input$Vis1_BarY1=="Nothing Selected"||input$Vis1_BarY2=="Nothing Selected"||input$Vis1_BarY3=="Nothing Selected"||input$Vis1_BarY4=="Nothing Selected"||input$Vis1_BarY5=="Nothing Selected"){
           
         } else {
       c(input$Vis1_BarY1,
         input$Vis1_BarY2,
         input$Vis1_BarY3,
         input$Vis1_BarY4,
         input$Vis1_BarY5)
       }
        }
     }else if (input$SelectVis1=="Pie Chart"){
       if(length(input$Vis1_Pie_CategoryType)==0){
       }else if (input$Vis1_Pie_CategoryType=="Surveys"){
         if(length(input$Vis1_Pie_Metrics_to_Sum)==0){
           
         } else {
           input$Vis1_Pie_Metrics_to_Sum
         }
       } else if (input$Vis1_Pie_CategoryType=="Metrics"){
         if(length(input$Vis1_Pie_Metrics)==0){
           
         } else {
           input$Vis1_Pie_Metrics
         }
       } 
     }
   })
   

  
  Vis1InputFishTaxa<-reactive({
      Fish_Output<-trimws(sub(paste(FishMetricPick(), collapse = "|"), "", Vis_1_Input_Variables()[str_detect(Vis_1_Input_Variables(),paste(FishMetricPick(),collapse="|"))]) )
      return(Fish_Output)
  })
  
  Vis1InputFishTaxa_NoGroup<-reactive({
    req(Vis1InputFishTaxa())
    Vis1InputFishTaxa()%>%
      .[.!=GrpPick()]
  })
 
  Vis1InputTarget_Taxa<-reactive({
      Target_Output<-trimws(sub(paste(TargetMetricPick(), collapse = "|"), "", Vis_1_Input_Variables()[str_detect(Vis_1_Input_Variables(),paste(TargetMetricPick(),collapse="|"))]) )
      return(Target_Output)
  }) 
  
  Vis1InputTarget_Taxa_NoGroup<-reactive({
    req(Vis1InputTarget_Taxa())
    Vis1InputTarget_Taxa()%>%
      .[.!=AngPref_GrpPick()]
  })

    Vis1_UnattributedFishTaxa<-reactive({
     if(length(Vis1InputFishTaxa())>0){
       return(
         Vis_1_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(UnattributedTaxa)%>%
       filter(Taxa%in%Vis1InputFishTaxa())%>%
       select(!(UnattributedTaxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
      
  Vis1_PartiallyAttributedFishTaxa<-reactive({
      if(length(Vis1InputFishTaxa())>0){
       return(
         Vis_1_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(PartiallyAttributedTaxa)%>%
       filter(Taxa%in%Vis1InputFishTaxa())%>%
       select(!(PartiallyAttributedTaxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
   
   Vis1_IncompleteAttributedFishTaxa<-reactive({
      if(length(Vis1InputFishTaxa())>0){
       return(
         Vis_1_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(IncompleteAttributedTaxa)%>%
       filter(Taxa%in%Vis1InputFishTaxa())%>%
       select(!(Incomplete_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })

       Vis1_UnattributedTarget_Taxa<-reactive({
     if(length(Vis1InputTarget_Taxa())>0){
       return(
         Vis_1_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(UnattributedTarget_Taxa)%>%
       filter(Taxa%in%Vis1InputTarget_Taxa())%>%
       select(!(UnattributedTarget_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
      
  Vis1_PartiallyAttributedTarget_Taxa<-reactive({
      if(length(Vis1InputTarget_Taxa())>0){
       return(
         Vis_1_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(PartiallyAttributedTarget_Taxa)%>%
       filter(Taxa%in%Vis1InputTarget_Taxa())%>%
       select(!(PartiallyAttributedTarget_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
   
   Vis1_IncompleteAttributedTarget_Taxa<-reactive({
      if(length(Vis1InputTarget_Taxa())>0){
       return(
         Vis_1_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(IncompleteAttributedTarget_Taxa)%>%
       filter(Taxa%in%Vis1InputTarget_Taxa())%>%
       select(!(Incomplete_Target_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })


    Vis1_Retained_Surveys<-reactive({
      
      Vis_1_SelectedTBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
    })
    
    Vis1_Dropped_Surveys<-reactive({
      
      Vis_1_SelectedTBL_Raw()%>%anti_join(Vis_1_SelectedTBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))%>%
        unique()
    })


   output$Vis1_Dropped_TBL<-DT::renderDataTable(
    Vis1_Dropped_Surveys(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

  output$Vis1_Retained_TBL<-DT::renderDataTable(
    Vis1_Retained_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
   Vis_1_Dropped_NA_Surveys<-reactive({
     req(Vis_1_Selected_NA_TBL(),
         Vis_1_SelectedTBL_Raw()
         )
     Vis_1_SelectedTBL_Raw()%>%
       anti_join(Vis_1_Selected_NA_TBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })
   
   Vis_1_Dropped_NA_Warn_Surveys<-reactive({
     req(Vis_1_Dropped_NA_Surveys())
     as.list(as.character(unique(Vis_1_Dropped_NA_Surveys()$Survey_ID)))
     })
   
   Vis_1_Dropped_NA_Warn_Surveys_Count<-reactive({
     length(Vis_1_Dropped_NA_Warn_Surveys())
     })
   
    Vis_1_Retained_NA_Surveys<-reactive({
      req(Vis_1_Selected_NA_TBL())
     Vis_1_Selected_NA_TBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })

   Vis_1_Retained_NA_Warn_Surveys<-reactive({
     req(Vis_1_Retained_NA_Surveys())
     as.list(as.character(unique(Vis_1_Retained_NA_Surveys()$Survey_ID)))
     })
   
   Vis_1_Retained_NA_Warn_Surveys_Count<-reactive({
     req(Vis_1_Retained_NA_Warn_Surveys())
     length(Vis_1_Retained_NA_Warn_Surveys())
     })
   
   output$Vis_1_Dropped_NA_Warning<-renderText({
    if(length(Vis_1_Dropped_NA_Warn_Surveys())>0){
      return(paste(as.character(actionLink(inputId = "Vis_1_NA_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Visualization input fields contain NA values. Surveys containing NA for a visualization input are automatically dropped. </span><span style=\"color:red;font-weight:bold\">", Vis_1_Dropped_NA_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been dropped;</><span style=\"color:green;font-weight:bold\">",Vis_1_Retained_NA_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been retained</>"))
  }else {
  } 
  })
      output$Vis_1_Survey_Char_Drop<-renderText({
        return(paste(as.character(actionLink(inputId = "Vis_1SurveyDropCharacteristicsTip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black;font-weight:bold\">Survey Characteristic Drops </span>"))
      })
      
      output$Vis_1_Taxa_Atr_Drop<-renderText({
        return(paste(as.character(actionLink(inputId = "Vis_1TaxaAttributionDropTip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black;font-weight:bold\">Taxa Attribution Issue Drops </span>"))
      })
  
  observeEvent(input$Vis_1_NA_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Dropped NA Inputs"),
            h4(strong("Selected surveys contain 'NA' values for inputs which are automatically dropped: ")),
            h4("Visualizations are unable to accomodate 'NA' values for any inputs and they are therefore automatically dropped."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
   
   output$Vis_1_Dropped_NA_TBL_Pop<-reactive({
      
      length(Vis_1_Dropped_NA_Warn_Surveys())
      })
    outputOptions(output,'Vis_1_Dropped_NA_TBL_Pop',suspendWhenHidden=FALSE)
   
   output$Vis_1_Dropped_NA_TBL<-DT::renderDataTable(
    Vis_1_Dropped_NA_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
  output$Vis_1_Retained_NA_TBL<-DT::renderDataTable(
    Vis_1_Retained_NA_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
  

   Vis_1_Dropped_All_Surveys<-reactive({
      
     req(Vis_1_SelectedTBL(),
         Vis_1_SelectedTBL_Raw()
         )
     
     Vis_1_SelectedTBL_Raw()%>%
       anti_join(Vis_1_SelectedTBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })
   
   
   Vis_1_Dropped_All_Warn_Surveys<-reactive({
     req(Vis_1_Dropped_All_Surveys())
     as.list(as.character(unique(Vis_1_Dropped_All_Surveys()$Survey_ID)))
     })
   
   Vis_1_Dropped_All_Warn_Surveys_Count<-reactive({
     length(Vis_1_Dropped_All_Warn_Surveys())
     })
   
    Vis_1_Retained_All_Surveys<-reactive({
      req(Vis_1_SelectedTBL())
     Vis_1_SelectedTBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })

   Vis_1_Retained_All_Warn_Surveys<-reactive({
     req(Vis_1_Retained_All_Surveys())
     as.list(as.character(unique(Vis_1_Retained_All_Surveys()$Survey_ID)))
     })
   
   Vis_1_Retained_All_Warn_Surveys_Count<-reactive({
     req(Vis_1_Retained_All_Warn_Surveys())
     length(Vis_1_Retained_All_Warn_Surveys())
     })
   
   output$Vis_1_Dropped_All_Warning<-renderText({
    if(length(Vis_1_Dropped_All_Warn_Surveys())>0){
      return(paste(as.character(actionLink(inputId = "Vis_1_Dropped_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Surveys containing NA for a visualization inputs or user-selected drop characteristics have been dropped. </span><span style=\"color:red;font-weight:bold\">", Vis_1_Dropped_All_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been dropped;</><span style=\"color:green;font-weight:bold\">",Vis_1_Retained_All_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been retained</>"))
  }else {
  } 
  })

  
  observeEvent(input$Vis_1_Dropped_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Dropped Surveys"),
            h4(strong("Selected surveys contain 'NA' values for inputs or characteristics which match user selected 'Drop' criteria from switches above: ")),
            h4("Visualizations are unable to accomodate 'NA' values for any inputs and they are therefore automatically dropped."),
            h4("Surveys sometimes contain undesireable attributes or contain input taxa with attribution issues which lead to the user to drop them from the visualizations by switching the toggles above."),
            h4("This warning reports the total number of surveys which were selected to be included in the visualization as well as the number of surveys which have been dropped either due to NA inputs, undesireable survey characteristics, or the presence of input taxa attribution issues."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$Vis_1SurveyDropCharacteristicsTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Drop Based on Survey Characteristics"),
            h4(strong("Undesireable Survey Characteristics: ")),
            h4("Surveys occasionally contain undesireable characteristics which may result in a user wishing to exclude/drop them from thier visualizations."),
            h4("By toggling the switches in this section users can decide whether they wish to retain or drop surveys with the following characteristcis."),
            h4(strong("Non-Creel Approaches: "), "Drops surveys which are not classified as 'Creel Survey'. These typically include things like Mail/Phone/Internet Surveys."),
            h4(strong("Unknown/Uncertain Timing: "), "Drops surveys for which are missing start and/or end dates"),
            h4(strong("Unknown/Uncertain Location: "), "Drops surveys for which the location of the waterbody being surveyed can not be confirmed."),
            h4(strong("Unknown/Uncertain Spatial Extent: "), "Drops surveys for which the spatial extent of a survey can not be confirmed."),
            h4(strong("Focal Species: "), "Drops surveys which focus on only a single or group of taxa rather than the entire community."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$Vis_1TaxaAttributionDropTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),title = strong("Drop Based on Taxa Attribution Issues"),
            h4(strong("Taxa attribution issues: ")),
            h4("Surveys occasionally contain issues with the attribution of values to taxa."),
            h4("By toggling the switches in this section users can decide whether they wish to retain or drop surveys with the following characteristics."),
            h4(strong("Unattributed Input Fish Taxa: "), "Drops surveys for which one of the visualization inputs contains a fish taxa which cannot be attributed 
               (see tip at unattributed taxa warning in the warning panel for more details). Note: For visualizations wholly unattributed taxa are 'Null' so they 
               are dropped automatically, however partially attributed data are contain both attributed values and potentially unattributed values and therefore require 
               toggling of this switch to drop in order to remove."),
            h4(strong("Incomplete Input Fish Groups: "), "Drops surveys for which one of the visualization inputs contains a fish groups which have incomplete attribution 
               (see tip at incomplete group warning in the warning panel for more details)."),
            h4(strong("Unattributed Input Target Taxa: "), "Drops surveys for which one of the visualization inputs contains a target taxa which cannot be attributed 
               (see tip at unattributed target taxa warning in the warning panel for more details). Note: For visualizations wholly unattributed target taxa are 'Null' so they 
               are dropped automatically, however partially attributed data are contain both attributed values and potentially unattributed values and therefore require 
               toggling of this switch to drop in order to remove."),
            h4(strong("Incomplete Input Target Groups: "), "Drops surveys for which one of the visualization inputs contains a target groups which have incomplete attribution 
               (see tip at incomplete group warning in the warning panel for more details)."),
        easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$Vis_1WarningTableTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("View Warning Tables"),
            h4(strong("Select whether you wish to view tables which summarize any of the listed warning attributes: ")),
            h4(strong("Retained Surveys: "), "Table showing surveys which were retained after surveys which contained 'NA' in at least one visualization input or contained undesireable survey characteristics or input taxa attribution issues were dropped."),
            h4(strong("Dropped Surveys: "), "Table showing surveys which were dropped due to the presence of an 'NA' in at least one visualization input or undesireable survey characteristics or taxa attribution issues."),
            h4(strong("Retained NA Surveys: "), "Table showing surveys which were retained after surveys which contained 'NA' in at least one visualization input were dropped."),
            h4(strong("Dropped NA Surveys: "), "Table showing surveys which were dropped due to the presence of an 'NA' in at least one visualization input."),
            h4(strong("Non-Creel Approaches: "), "Table showing surveys which used any approach not classified as a 'Creel Survey'."),
            h4(strong("Unknown/Uncertain Timing: "), "Table showing surveys which were flagged ashaving unknown or uncertain timing."),
            h4(strong("Unknown/Uncertain Location: "), "Table showing surveys which were flagged ashaving unknown or uncertain locations."),
            h4(strong("Unknown/Uncertain Spatial Extent: "), "Table showing surveys which were flagged ashaving unknown or uncertain spatial extents."),
            h4(strong("Focal Species: "), "Table showing surveys which were conducted based on a focal species rather than the full community."),
            h4(strong("Unattributed Taxa: "), "Table showing records containing unattributed input taxa."),
            h4(strong("Partially Attributed Taxa: "), "Table showing records containing partially attributed input taxa."),
            h4(strong("Incomplete Groups: "), "Table showing records containing incomplete attribution of input groups."),
            h4(strong("Unattributed Target Taxa: "), "Table showing records containing unattributed input target taxa."),
            h4(strong("Partially Attributed Target Taxa: "), "Table showing records containing partially attributed input target taxa."),
            h4(strong("Incomplete Target Groups: "), "Table showing records containing incomplete attribution of input target groups."),
        easyClose = TRUE
        ))
    },ignoreInit=TRUE)
   
   output$Vis_1_Dropped_All_TBL<-DT::renderDataTable(
    Vis_1_Dropped_All_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
  output$Vis_1_Retained_All_TBL<-DT::renderDataTable(
    Vis_1_Retained_All_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
  
   output$Vis_1_FishTaxaHeading<-renderText({
    if((length(Vis_1UnattributedTaxa_Warn_Taxa())>0)||
       (length(Vis_1IncompleteAttributedTaxa_Warn_Taxa())>0)||
       (nchar(Vis_1_Overlap_Warn())>1)){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Fish Taxa Input Attribution Issues: </span></h4>"))
  }else {

  }
  })  
   
   output$Vis_1_AngPrefTaxaHeading<-renderText({
    if((length(Vis_1UnattributedTarget_Taxa_Warn_Taxa())>0)||
       (length(Vis_1IncompleteAttributedTarget_Taxa_Warn_Taxa())>0)||
       (nchar(TargetVis_1_Overlap_Warn())>1)
       ){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Angler Preference Taxa Input Attribution Issues: </span></h4>"))
  }else {

  }
  })  
   
  Vis_1UnattributedTaxa_Count<-reactive({
    if(is.null(Vis1_UnattributedFishTaxa())){
      return(NULL)
    }else{
     Vis1_UnattributedFishTaxa()%>%
     count(Taxa)%>%
     unite(Unattributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_1UnattributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_1UnattributedTaxa_Count()$Unattributed_Records))
     })
   
   Vis_1UnattributedTaxa_Warn_Vals<-reactive({
     paste(Vis_1UnattributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_1_UnattributedFishTaxaWarning<-renderText({
    if(length(Vis_1UnattributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_1_Unattributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include unattributed taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_1UnattributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })

  
  observeEvent(input$Vis_1_Unattributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unattributed Fish Taxa"),
            h4(strong("Selected surveys contain unattributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The list identifies which taxa have unattributed records in the dataset and how 
               many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


   output$Vis_1_UnattributedTBL_Pop<-reactive({
      length(Vis_1UnattributedTaxa_Warn_Taxa())
      })
   
    outputOptions(output,'Vis_1_UnattributedTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis1_UnattributedFishTaxa_TBL<-DT::renderDataTable(
    Vis1_UnattributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Attributed Taxa Suggestions ###
    Vis_1_Attributed_Gain<-reactive({
    if(is.null(Vis1_UnattributedFishTaxa())){return(NULL)}else{
     Vis1_UnattributedFishTaxa()%>%
     count(Attributed_Taxa)%>%
     unite(GainedRecords,"Attributed_Taxa","n",sep="-")
    }
     })

   Vis_1AttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_1_Attributed_Gain()$GainedRecords))
     })
   
   Vis_1AttributedTaxa_Warn_Vals<-reactive({
     paste(Vis_1AttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_1_AttributedFishTaxaWarning<-renderText({
    if(length(Vis_1UnattributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_1_Attributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Consider replacing unattributed and partially attributed taxa with attributed taxa: </span><span style=\"color:green;font-weight:bold\">", Vis_1AttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_1_Attributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Alternative Attributed Fish Taxa"),
            h4(strong("Alternatives to unattributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The species in this list show the taxa which were originall attributed 
               in the creel survey (ie. what level the taxa was initially recorded at) and the number of records for which this is the case."),
            h4(strong("Recommendation: "),"If possible replace the unattributed taxa with the recommended attributed taxa. Doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


# Partially Attributed Species #
   
   Vis_1PartiallyAttributedTaxa_Count<-reactive({
    if(is.null(Vis1_PartiallyAttributedFishTaxa())){
      return(NULL)
    } else {
     Vis1_PartiallyAttributedFishTaxa()%>%
     count(Taxa)%>%
     unite(PartiallyAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_1PartiallyAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_1PartiallyAttributedTaxa_Count()$PartiallyAttributed_Records))
     })
   
   Vis_1PartiallyAttributedTaxa_Warn_Vals<-reactive({
     paste(Vis_1PartiallyAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_1_PartiallyAttributedFishTaxaWarning<-renderText({
    if(length(Vis_1PartiallyAttributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_1_PartiallyAttributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include partially attributed taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_1PartiallyAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_1_PartiallyAttributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Partially Attributed Fish Taxa"),
            h4(strong("Selected surveys contain partially attributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). Occasionally a survey may record data across multiple overlapping taxanomic 
               levels creating partially attributed taxa. In these cases a survey may contain values attributed to both 'Black Crappie' (species) and 'Crappie' (genus). In thise case the value attributed to 'Black 
               Crappie' represents some, but not necessarily all, of the 'Black Crappie' in the survey as some of the values associated with 'Crappie' (genus) may actually also be 'Black Crappie'. Because of this 
               surveys which include both 'Black Crappie' and  'Crappie' attributions are considered partial attributions (ie. we can not fully attribute the 'Black Crappie' values). The list identifies which taxa have 
               partially attributed records in the dataset and how many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed or partially attributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip: "), "'Partially Attributed' taxa have both attributed and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset. Otherwise 
               partially attributed records will be included in the dataset but only include the directly attributed values without consideration of potential missing values from the unattributed portion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


   output$Vis1_PartiallyAttributedTBL_Pop<-reactive({
      
      length(Vis_1PartiallyAttributedTaxa_Warn_Taxa())
      })
    outputOptions(output,'Vis1_PartiallyAttributedTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis1_PartiallyAttributedFishTaxa_TBL<-DT::renderDataTable(
    Vis1_PartiallyAttributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Incomplete Groups #
      
     Vis_1IncompleteAttributedTaxa_Count<-reactive({
    if(is.null(Vis1_IncompleteAttributedFishTaxa())){
      return(NULL)
    }else{
     Vis1_IncompleteAttributedFishTaxa()%>%
     count(Taxa)%>%
     unite(IncompleteAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_1IncompleteAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_1IncompleteAttributedTaxa_Count()$IncompleteAttributed_Records))
     })
   
   Vis_1IncompleteAttributedTaxa_Warn_Vals<-reactive({
     paste(Vis_1IncompleteAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_1_IncompleteAttributedFishTaxaWarning<-renderText({
    if(length(Vis_1IncompleteAttributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_1_IncompleteAttributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include groups with incomplete attribution of taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_1IncompleteAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_1_IncompleteAttributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Incomplete Attribution of Fish Taxa"),
            h4(strong("Selected surveys contain incompletely attributed fish groups in inputs: ")),
            h4("Values for groups are typically generated either as a direct attribution of the group in the survey (ie. 'Panfish' estimates recorded directly), or by summing values for all component members 
            (ie. 'Trout' estimate generated by adding values from 'Rainbow Trout', 'Brook Trout', and 'Brown Trout'). Because groups are not monophyletic there can be cases when a group value may be incompletely 
            attributed due to component taxa which span within and outside group status (ie. a survey containing values attributed to the genus' 'Salvelinus' and 'Onchorynchus', while all values for 'Salvelinus' can 
            be (and therefore are) attributed to 'Trout', 'Onchorynchus'  includes both 'Trout' (Rainbow Trout, Cutthroat Trout...) and 'Non-Trout' (Chinook Salmon, Coho Salmon...), and therefore can not be attributed to 'Trout' 
            although some portion of those values may actually be 'Trout'.). In this case the records for 'Trout' are identified as 'Incomplete' meaning that some taxa are present within the record which may or may not be attributable 
            to the selected 'Group'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping incompletely attributed fish group records by toggling the 'Incomplete Input Fish Groups'  
               switch from 'Retained' to 'Dropped'."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)



   output$Vis_1_IncompleteTBL_Pop<-reactive({
      
      length(Vis_1IncompleteAttributedTaxa_Warn_Taxa())
      })
    outputOptions(output,'Vis_1_IncompleteTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis1_IncompleteAttributedFishTaxa_TBL<-DT::renderDataTable(
    Vis1_IncompleteAttributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )



   ### Overlapping Taxa Selection ###

FamilyVis_1_Selected<-reactive({
  TaxaTable%>%filter(Family %in% Vis1InputFishTaxa())%>%select(Family)%>%unique()
  })
GenusVis_1_Selected<-reactive({
      
  TaxaTable%>%filter(Genus %in% Vis1InputFishTaxa())%>%select(Family,Genus)%>%unique()
  })
SpeciesVis_1_Selected<-reactive({
      
  TaxaTable%>%filter(Species %in% Vis1InputFishTaxa())%>%select(Family,Genus,Species)%>%unique()
  })
SubsVis_1_Selected<-reactive({
      
  TaxaTable%>%filter(Subspecies_Variants %in% Vis1InputFishTaxa())%>%select(Family,Genus,Species,Subspecies_Variants)%>%unique()
  })


Genus_Family_Vis_1_Overlap<-reactive({
      
  req(GenusVis_1_Selected())
  req(FamilyVis_1_Selected())
  
  GenusVis_1_Selected()%>%
  inner_join(FamilyVis_1_Selected(),by='Family')%>%
  select(Family,Genus)%>%
  unite(Overlaps,"Family","Genus",sep=" overlaps ")})

Species_Family_Vis_1_Overlap<-reactive({
      
  req(SpeciesVis_1_Selected())
  req(FamilyVis_1_Selected())
  
  SpeciesVis_1_Selected()%>%
  inner_join(FamilyVis_1_Selected(),by='Family')%>%
  select(Family,Species)%>%
  unite(Overlaps,"Family","Species",sep=" overlaps ")})

Species_Genus_Vis_1_Overlap<-reactive({
      
  req(SpeciesVis_1_Selected())
  req(GenusVis_1_Selected())
  
  SpeciesVis_1_Selected()%>%
  inner_join(GenusVis_1_Selected(),by='Genus')%>%
  select(Genus,Species)%>%
  unite(Overlaps,"Genus","Species",sep=" overlaps ")})

Subspecies_Family_Vis_1_Overlap<-reactive({
  req(SubsVis_1_Selected())
  req(FamilyVis_1_Selected())
  
  SubsVis_1_Selected()%>%
  inner_join(FamilyVis_1_Selected(),by='Family')%>%
  select(Family,Subspecies_Variants)%>%
  unite(Overlaps,"Family","Subspecies_Variants",sep=" overlaps ")})

Subspecies_Genus_Vis_1_Overlap<-reactive({
      
  req(SubsVis_1_Selected())
  req(GenusVis_1_Selected())
  
  SubsVis_1_Selected()%>%
  inner_join(GenusVis_1_Selected(),by='Genus')%>%
  select(Genus,Subspecies_Variants)%>%
  unite(Overlaps,"Genus","Subspecies_Variants",sep=" overlaps ")})

Subspecies_Species_Vis_1_Overlap<-reactive({
      
  req(SubsVis_1_Selected())
  req(SpeciesVis_1_Selected())
  
  SubsVis_1_Selected()%>%
  inner_join(SpeciesVis_1_Selected(),by='Species')%>%
  select(Species,Subspecies_Variants)%>%
  unite(Overlaps,"Species","Subspecies_Variants",sep=" overlaps ")})

Group_Taxa_Vis_1_Overlap<-reactive({
      
  req(input$AF_SharedData=="No"||is.null(input$AF_SharedData))
  req(Vis1InputFishTaxa())
  
  GroupTaxa%>%
  filter(Group %in% Vis1InputFishTaxa())%>%
  filter(Taxa %in% Vis1InputFishTaxa_NoGroup())%>%
  unite(Overlaps,"Group","Taxa",sep=" overlaps ")%>%
  select(Overlaps)})

Vis_1Overlaps<-reactive({
  PH<-as.list(bind_rows(Genus_Family_Vis_1_Overlap(),Species_Family_Vis_1_Overlap(),Species_Genus_Vis_1_Overlap(),Subspecies_Family_Vis_1_Overlap(),Subspecies_Genus_Vis_1_Overlap(),Subspecies_Species_Vis_1_Overlap(),Group_Taxa_Vis_1_Overlap()))
return(PH)
})

   Vis_1OverlapTaxa_Warn<-reactive({
     as.list(as.character(unique(Vis_1Overlaps()$Overlaps)))
     })
   
   Vis_1_Overlap_Warn<-reactive({
     paste(Vis_1OverlapTaxa_Warn(),collapse=" & ")
     })

   output$Vis_1_OverlapFishWarning<-renderText({
    if(nchar(Vis_1_Overlap_Warn())>1){
      return(paste(as.character(actionLink(inputId = "Vis_1_Overlap_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input taxa include overlapping value attribution: </span><span style=\"color:red;font-weight:bold\">", Vis_1_Overlap_Warn(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_1_Overlap_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Overlap of Input Fish Taxa"),
            h4(strong("Selected fish inputs contain overlapping taxa: ")),
            h4("Taxa can be attributed at multiple, overlapping taxanomic levels and therefore the associated values can result in overlap or double counting (ie. a user selects both 
               'Bluegill' (Species) and 'Lepomis' (Genus) harvest estimates, the harvest estimate attributable to 'Bluegill'(10) is also included within 'Lepomis'(30), meaning of the 30 'Lepomis' individuals harvested 10 of them are the 
               same as the 10 recorded in Bluegill, while 20 of them are from different 'Lepomis' taxa."),
            h4(strong("Recommendation: "),"We suggest avoiding overlapping taxa whereever possible to avoid double, triple, etc. counting of values. In order to do this select only non-overlapping taxa for inputs."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)


  Vis_1UnattributedTarget_Taxa_Count<-reactive({
    if(is.null(Vis1_UnattributedTarget_Taxa())){
      return(NULL)
    }else{
     Vis1_UnattributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(Unattributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_1UnattributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_1UnattributedTarget_Taxa_Count()$Unattributed_Records))
     })
   
   Vis_1UnattributedTarget_Taxa_Warn_Vals<-reactive({
     paste(Vis_1UnattributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_1_UnattributedTarget_TaxaWarning<-renderText({
    if(length(Vis_1UnattributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_1_Unattributed_Target_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include unattributed target taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_1UnattributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_1_Unattributed_Target_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unattributed Target Taxa"),
            h4(strong("Selected surveys contain unattributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The list identifies which taxa have unattributed records in the dataset and how 
               many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   # Attributed Taxa Suggestions ###
    Vis_1_Attributed_TargetGain<-reactive({
      if(is.null(Vis1_UnattributedTarget_Taxa())){
        return(NULL)
      }else{
     return(Vis1_UnattributedTarget_Taxa()%>%
     count(Attributed_Target_Taxa)%>%
     unite(GainedRecords,"Attributed_Target_Taxa","n",sep="-"))
      }
     })

   Vis_1AttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_1_Attributed_TargetGain()$GainedRecords))
     })
   
   Vis_1AttributedTarget_Taxa_Warn_Vals<-reactive({paste(Vis_1AttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")})

   output$Vis_1_AttributedTarget_TaxaWarning<-renderText({
    if(nchar(Vis_1AttributedTarget_Taxa_Warn_Vals())>1){
      return(paste(as.character(actionLink(inputId = "Vis_1_AttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Consider replacing unattributed and partially attributed taxa with attributed taxa: </span><span style=\"color:green;font-weight:bold\">", Vis_1AttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_1_AttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Alternative Attributed Target Taxa"),
            h4(strong("Alternatives to unattributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The species in this list show the taxa which were originall attributed 
               in the creel survey (ie. what level the taxa was initially recorded at) and the number of records for which this is the case."),
            h4(strong("Recommendation: "),"If possible replace the unattributed target taxa with the recommended attributed target taxa. Doing so will reduce the instances of 
               unattributed target taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however if a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Vis_1_UnattributedTargetTBL_Pop<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
      length(Vis_1UnattributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Vis_1_UnattributedTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis1_UnattributedTarget_Taxa_TBL<-DT::renderDataTable(
    Vis1_UnattributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
 Vis_1PartiallyAttributedTarget_Taxa_Count<-reactive({
    if(is.null(Vis1_PartiallyAttributedTarget_Taxa())){
      return(NULL)
    } else {
     Vis1_PartiallyAttributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(PartiallyAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_1PartiallyAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_1PartiallyAttributedTarget_Taxa_Count()$PartiallyAttributed_Records))
     })
   
   Vis_1PartiallyAttributedTarget_Taxa_Warn_Vals<-reactive({
     paste(Vis_1PartiallyAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_1_PartiallyAttributedFishTarget_TaxaWarning<-renderText({
    if(length(Vis_1PartiallyAttributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_1_PartiallyAttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include partially attributed target taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_1PartiallyAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })

    observeEvent(input$Vis_1_PartiallyAttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Partially Attributed Target Taxa"),
            h4(strong("Selected surveys contain partially attributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). Occasionally a survey may record data across multiple overlapping taxanomic 
               levels creating partially attributed taxa. In these cases a survey may contain values attributed to both 'Black Crappie' (species) and 'Crappie' (genus). In thise case the value attributed to 'Black 
               Crappie' represents some, but not necessarily all, of the 'Black Crappie' in the survey as some of the values associated with 'Crappie' (genus) may actually also be 'Black Crappie'. Because of this 
               surveys which include both 'Black Crappie' and  'Crappie' attributions are considered partial attributions (ie. we can not fully attribute the 'Black Crappie' values). The list identifies which taxa have 
               partially attributed records in the dataset and how many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed or partially attributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Target Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip: "), "'Partially Attributed' taxa have both attributed and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset. Otherwise 
               partially attributed records will be included in the dataset but only include the directly attributed values without consideration of potential missing values from the unattributed portion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Vis1_PartiallyAttributedTargetTBL_Pop<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
      length(Vis_1PartiallyAttributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Vis1_PartiallyAttributedTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis1_PartiallyAttributedTarget_Taxa_TBL<-DT::renderDataTable(
    Vis1_PartiallyAttributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Incomplete Groups #
   
     Vis_1IncompleteAttributedTarget_Taxa_Count<-reactive({
    if(is.null(Vis1_IncompleteAttributedTarget_Taxa())){
      return(NULL)
    }else{
     Vis1_IncompleteAttributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(IncompleteAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_1IncompleteAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_1IncompleteAttributedTarget_Taxa_Count()$IncompleteAttributed_Records))
     })
   
   Vis_1IncompleteAttributedTarget_Taxa_Warn_Vals<-reactive({
     paste(Vis_1IncompleteAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_1_IncompleteAttributedFishTarget_TaxaWarning<-renderText({
    if(length(Vis_1IncompleteAttributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_1_IncompleteAttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include groups with incomplete attribution of target taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_1IncompleteAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })  
   
  observeEvent(input$Vis_1_IncompleteAttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Incomplete Attribution of Target Taxa"),
            h4(strong("Selected surveys contain incompletely attributed target groups in inputs: ")),
            h4("Values for groups are typically generated either as a direct attribution of the group in the survey (ie. 'Panfish' estimates recorded directly), or by summing values for all component members 
            (ie. 'Trout' estimate generated by adding values from 'Rainbow Trout', 'Brook Trout', and 'Brown Trout'). Because groups are not monophyletic there can be cases when a group value may be incompletely 
            attributed due to component taxa which span within and outside group status (ie. a survey containing values attributed to the genus' 'Salvelinus' and 'Onchorynchus', while all values for 'Salvelinus' can 
            be (and therefore are) attributed to 'Trout', 'Onchorynchus'  includes both 'Trout' (Rainbow Trout, Cutthroat Trout...) and 'Non-Trout' (Chinook Salmon, Coho Salmon...), and therefore can not be attributed to 'Trout' 
            although some portion of those values may actually be 'Trout'.). In this case the records for 'Trout' are identified as 'Incomplete' meaning that some taxa are present within the record which may or may not be attributable 
            to the selected 'Group'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping incompletely attributed target group records by toggling the 'Incomplete Input Fish Groups'  
               switch from 'Retained' to 'Dropped'."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Vis_1_IncompleteTargetTBL_Pop<-reactive({
      
      length(Vis_1IncompleteAttributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Vis_1_IncompleteTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis1_IncompleteAttributedTarget_Taxa_TBL<-DT::renderDataTable(
    Vis1_IncompleteAttributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )



   ### Overlapping Target Taxa Selection ###



TargetFamilyVis_1_Selected<-reactive({
  TaxaTable%>%filter(Family %in% Vis1InputTarget_Taxa())%>%select(Family)%>%unique()
  })
TargetGenusVis_1_Selected<-reactive({
      
  TaxaTable%>%filter(Genus %in% Vis1InputTarget_Taxa())%>%select(Family,Genus)%>%unique()
  })
TargetSpeciesVis_1_Selected<-reactive({
      
  TaxaTable%>%filter(Species %in% Vis1InputTarget_Taxa())%>%select(Family,Genus,Species)%>%unique()
  })
TargetSubsVis_1_Selected<-reactive({
      
  TaxaTable%>%filter(Subspecies_Variants %in% Vis1InputTarget_Taxa())%>%select(Family,Genus,Species,Subspecies_Variants)%>%unique()
  })


TargetGenus_Family_Vis_1_Overlap<-reactive({
  req(TargetGenusVis_1_Selected())
  req(TargetFamilyVis_1_Selected())
  
  TargetGenusVis_1_Selected()%>%
  inner_join(TargetFamilyVis_1_Selected(),by='Family')%>%
  select(Family,Genus)%>%
  unite(Overlaps,"Family","Genus",sep=" overlaps ")
  })

TargetSpecies_Family_Vis_1_Overlap<-reactive({
  req(TargetSpeciesVis_1_Selected())
  req(TargetFamilyVis_1_Selected())
  
  TargetSpeciesVis_1_Selected()%>%
  inner_join(TargetFamilyVis_1_Selected(),by='Family')%>%
  select(Family,Species)%>%
  unite(Overlaps,"Family","Species",sep=" overlaps ")
  })

TargetSpecies_Genus_Vis_1_Overlap<-reactive({
  req(TargetSpeciesVis_1_Selected())
  req(TargetGenusVis_1_Selected())
  
  TargetSpeciesVis_1_Selected()%>%
  inner_join(TargetGenusVis_1_Selected(),by='Genus')%>%
  select(Genus,Species)%>%
  unite(Overlaps,"Genus","Species",sep=" overlaps ")
  })

TargetSubspecies_Family_Vis_1_Overlap<-reactive({
  req(TargetSubsVis_1_Selected())
  req(TargetFamilyVis_1_Selected())
  
  TargetSubsVis_1_Selected()%>%
  inner_join(TargetFamilyVis_1_Selected(),by='Family')%>%
  select(Family,Subspecies_Variants)%>%
  unite(Overlaps,"Family","Subspecies_Variants",sep=" overlaps ")
  })

TargetSubspecies_Genus_Vis_1_Overlap<-reactive({
  req(TargetSubsVis_1_Selected())
  req(TargetGenusVis_1_Selected())
  
  TargetSubsVis_1_Selected()%>%
  inner_join(TargetGenusVis_1_Selected(),by='Genus')%>%
  select(Genus,Subspecies_Variants)%>%
  unite(Overlaps,"Genus","Subspecies_Variants",sep=" overlaps ")
  })

TargetSubspecies_Species_Vis_1_Overlap<-reactive({
  req(TargetSubsVis_1_Selected())
  req(TargetSpeciesVis_1_Selected())
  
  TargetSubsVis_1_Selected()%>%
  inner_join(TargetSpeciesVis_1_Selected(),by='Species')%>%
  select(Species,Subspecies_Variants)%>%
  unite(Overlaps,"Species","Subspecies_Variants",sep=" overlaps ")
  })

TargetGroup_Taxa_Vis_1_Overlap<-reactive({
  req(input$AF_SharedData=="No"||is.null(input$AF_SharedData))
  req(Vis1InputTarget_Taxa())
  
    GroupTaxa%>%
  filter(Group %in% Vis1InputTarget_Taxa())%>%
  filter(Taxa %in% Vis1InputTarget_Taxa_NoGroup())%>%
  unite(Overlaps,"Group","Taxa",sep=" overlaps ")%>%
  select(Overlaps)
 
  })

TargetVis_1Overlaps<-reactive({
  PH<-as.list(bind_rows(TargetGenus_Family_Vis_1_Overlap(),TargetSpecies_Family_Vis_1_Overlap(),TargetSpecies_Genus_Vis_1_Overlap(),TargetSubspecies_Family_Vis_1_Overlap(),TargetSubspecies_Genus_Vis_1_Overlap(),TargetSubspecies_Species_Vis_1_Overlap(),TargetGroup_Taxa_Vis_1_Overlap()))
return(PH)
})

   TargetVis_1OverlapTaxa_Warn<-reactive({
     as.list(as.character(unique(TargetVis_1Overlaps()$Overlaps)))
     })
   
   TargetVis_1_Overlap_Warn<-reactive({
     paste(TargetVis_1OverlapTaxa_Warn(),collapse=" & ")
     })

   output$Vis_1_OverlapTargetWarning<-renderText({
    if(nchar(TargetVis_1_Overlap_Warn())>1){
      return(paste(as.character(actionLink(inputId = "TargetVis_1_Overlap_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input target taxa include overlapping value attribution: </span><span style=\"color:red;font-weight:bold\">", TargetVis_1_Overlap_Warn(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$TargetVis_1_Overlap_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Overlap of Input Target Taxa"),
            h4(strong("Selected angler preference inputs contain overlapping target taxa: ")),
            h4("Taxa can be attributed at multiple, overlapping taxanomic levels and therefore the associated values can result in overlap or double counting (ie. a user selects both 
               'Bluegill' (Species) and 'Lepomis' (Genus) estimates, the estimate attributable to 'Bluegill'(10) is also included within 'Lepomis'(30), meaning of the 30 'Lepomis' values 10 of them are the 
               same as the 10 recorded in Bluegill, while 20 of them are from different 'Lepomis' taxa."),
            h4(strong("Recommendation: "),"We suggest avoiding overlapping taxa whereever possible to avoid double, triple, etc. counting of values. In order to do this select only non-overlapping target taxa for inputs."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)
   
   
#### Drop surveys with NA in vis input ####

# Vis 2 #
Vis_2_Selected_NA_TBL<-reactive({
  req(input$CreelCatNavBar=='Visualize Data')
  if(input$SelectVis2=="Nothing Selected"){
    Vis_2_SelectedTBL_Raw()
  }else if(input$SelectVis2=="Map"){
    if(is.null(input$Vis2_Map_CreelDisplayType)){
      Vis_2_SelectedTBL_Raw()
    }else if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){
      if(input$Vis2_MapDisplayField=="Nothing Selected"){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_MapDisplayField)
      }
    }else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){
      if(input$Vis2_MapDisplayField_Size=="Nothing Selected"){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_MapDisplayField_Size)
      }
    }else if(input$Vis2_Map_CreelDisplayType=="Both"){
      if(input$Vis2_MapDisplayField=="Nothing Selected"||input$Vis2_MapDisplayField_Size=="Nothing Selected"){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_MapDisplayField)%>%
          drop_na(input$Vis2_MapDisplayField_Size)
      }
    } 
  }else if (input$SelectVis2=="Line Plot"){
    if(length(input$Vis2_Line_Number)==0){
      Vis_2_SelectedTBL_Raw()
    }else if (input$Vis2_Line_Number=="1"){
      if(input$Vis2_LineY1=="Nothing Selected"){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_LineY1)
      }
    } else if(input$Vis2_Line_Number=="2"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)
      }
    }else if(input$Vis2_Line_Number=="3"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)%>%
          drop_na(input$Vis2_LineY3)
      }
    }else if(input$Vis2_Line_Number=="4"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"||input$Vis2_LineY4=="Nothing Selected"){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)%>%
          drop_na(input$Vis2_LineY3)%>%
          drop_na(input$Vis2_LineY4)
      }
    }else if(input$Vis2_Line_Number=="5"){
      if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"||input$Vis2_LineY4=="Nothing Selected"||input$Vis2_LineY5=="Nothing Selected"){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_LineY1)%>%
          drop_na(input$Vis2_LineY2)%>%
          drop_na(input$Vis2_LineY3)%>%
          drop_na(input$Vis2_LineY4)%>%
          drop_na(input$Vis2_LineY5)
      }
    }
  }else if (input$SelectVis2=="Scatter Plot"){
    if(input$Vis2_ScatterX=="Nothing Selected"||input$Vis2_ScatterY=="Nothing Selected"){
      Vis_2_SelectedTBL_Raw()
    } else {
      Vis_2_SelectedTBL_Raw()%>%
        drop_na(input$Vis2_ScatterX)%>%
        drop_na(input$Vis2_ScatterY)
    }
  }else if (input$SelectVis2=="Bar Chart"){
    if(length(input$Vis2_Bar_Number)==0){
      Vis_2_SelectedTBL_Raw()
    }else if (input$Vis2_Bar_Number=="1"){
      if(input$Vis2_BarY1=="Nothing Selected"){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_BarY1)
      }
    } else if(input$Vis2_Bar_Number=="2"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)
      }
    }else if(input$Vis2_Bar_Number=="3"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)%>%
          drop_na(input$Vis2_BarY3)
      }
    }else if(input$Vis2_Bar_Number=="4"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"||input$Vis2_BarY4=="Nothing Selected"){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)%>%
          drop_na(input$Vis2_BarY3)%>%
          drop_na(input$Vis2_BarY4)
      }
    }else if(input$Vis2_Bar_Number=="5"){
      if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"||input$Vis2_BarY4=="Nothing Selected"||input$Vis2_BarY5=="Nothing Selected"){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_BarY1)%>%
          drop_na(input$Vis2_BarY2)%>%
          drop_na(input$Vis2_BarY3)%>%
          drop_na(input$Vis2_BarY4)%>%
          drop_na(input$Vis2_BarY5)
      }
    }
  }else if (input$SelectVis2=="Pie Chart"){
    if(length(input$Vis2_Pie_CategoryType)==0){Vis_2_SelectedTBL_Raw()
    }else if (input$Vis2_Pie_CategoryType=="Surveys"){
      if(length(input$Vis2_Pie_Metrics_to_Sum)==0){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_Pie_Metrics_to_Sum)
      }
    } else if (input$Vis2_Pie_CategoryType=="Metrics"){
      if(length(input$Vis2_Pie_Metrics)==0){
        Vis_2_SelectedTBL_Raw()
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          drop_na(input$Vis2_Pie_Metrics)
      }
    } 
  }
})

  
    Vis_2_SurveyWarnTBL<-reactive({
      req(Vis_2_WarningData())
     
      NonCreel_Retained<-if(input$NonCreel_Vis_2_Switch==TRUE){
        Vis_2_WarningData()%>%
          filter(.,Survey_Type=="Creel Survey")%>%
          select(Survey_ID)
        }else{
            Vis_2_WarningData()%>%
              select(Survey_ID)
        }

      Timing_Retained<-if(input$UnkTiming_Vis_2_Switch==TRUE){
        Vis_2_WarningData()%>%
          filter(.,!Timing_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Vis_2_WarningData()%>%
              select(Survey_ID)
        }

      Location_Retained<-if(input$UnkLocation_Vis_2_Switch==TRUE){
        Vis_2_WarningData()%>%
          filter(.,!Location_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Vis_2_WarningData()%>%
              select(Survey_ID)
        }

      Extent_Retained<-if(input$UnkExtent_Vis_2_Switch==TRUE){
        Vis_2_WarningData()%>%
          filter(.,!Extent_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Vis_2_WarningData()%>%
              select(Survey_ID)
        }

      FocalTaxa_Retained<-if(input$FocSpecies_Vis_2_Switch==TRUE){
        Vis_2_WarningData()%>%
          filter(.,Focal_Species==c("All"))%>%
          select(Survey_ID)
        }else{
            Vis_2_WarningData()%>%
              select(Survey_ID)
        }
      
       
        Vis_2_Survey_Filt<-NonCreel_Retained%>%
          semi_join(.,Timing_Retained,by='Survey_ID')%>%
          semi_join(.,Location_Retained,by='Survey_ID')%>%
          semi_join(.,Extent_Retained,by='Survey_ID')%>%
          semi_join(.,FocalTaxa_Retained,by='Survey_ID')%>%
          droplevels()

    return(Vis_2_Survey_Filt)

    })   
   
   Vis_2_TaxaWarnTBL<-reactive({
      req(Vis_2_SelectedTBL_Raw())
      Vis2UnattributedSurveys_Retained<-if(is.null(Vis2_UnattributedFishTaxa())){
        Vis_2_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$UnFish_Vis_2_Switch==TRUE){
        Vis_2_SelectedTBL_Raw()%>%
        anti_join(Vis2_UnattributedFishTaxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      Vis2IncompleteSurveys_Retained<-if(is.null(Vis2_IncompleteAttributedFishTaxa())){
        Vis_2_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$InFishGroup_Vis_2_Switch==TRUE){
        Vis_2_SelectedTBL_Raw()%>%
        anti_join(Vis2_IncompleteAttributedFishTaxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      Vis2UnattributedTargetSurveys_Retained<-if(is.null(Vis2_UnattributedTarget_Taxa())){
        Vis_2_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$UnTarget_Vis_2_Switch==TRUE){
        Vis_2_SelectedTBL_Raw()%>%
        anti_join(Vis2_UnattributedTarget_Taxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      Vis2IncompleteTargetSurveys_Retained<-if(is.null(Vis2_IncompleteAttributedTarget_Taxa())){
        Vis_2_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$InTargetGroup_Vis_2_Switch==TRUE){
        Vis_2_SelectedTBL_Raw()%>%
        anti_join(Vis2_IncompleteAttributedTarget_Taxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_2_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }
       
        Vis_2_Survey_Filt<-Vis2UnattributedSurveys_Retained%>%
          semi_join(.,Vis2IncompleteSurveys_Retained,by='Survey_ID')%>%
          semi_join(.,Vis2UnattributedTargetSurveys_Retained,by='Survey_ID')%>%
          semi_join(.,Vis2IncompleteTargetSurveys_Retained,by='Survey_ID')%>%
          droplevels()

    return(Vis_2_Survey_Filt)

    })   
   
Vis_2_SelectedTBL<-reactive({
  req(Vis_2_SurveyWarnTBL())
  req(Vis_2_TaxaWarnTBL())
  req(Vis_2_Selected_NA_TBL())
  
  Vis_2_Selected_NA_TBL()%>%
    semi_join(.,Vis_2_SurveyWarnTBL(),by='Survey_ID')%>%
    semi_join(.,Vis_2_TaxaWarnTBL(),by='Survey_ID')%>%
    droplevels()
  
})
   

Vis_2_Input_Variables<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
     if(input$SelectVis2=="Nothing Selected"){
       
     }else if(input$SelectVis2=="Map"){
       if(is.null(input$Vis2_Map_CreelDisplayType)){
         
       }else if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){
           if(input$Vis2_MapDisplayField=="Nothing Selected"){
             
           } else {
              input$Vis2_MapDisplayField
           }
       }else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){
           if(input$Vis2_MapDisplayField_Size=="Nothing Selected"){
             
           } else {
           input$Vis2_MapDisplayField_Size
           }
       }else if(input$Vis2_Map_CreelDisplayType=="Both"){
           if(input$Vis2_MapDisplayField=="Nothing Selected"||input$Vis2_MapDisplayField_Size=="Nothing Selected"){
             
           } else {
           c(input$Vis2_MapDisplayField,input$Vis2_MapDisplayField_Size)
           }
       } 
     }else if (input$SelectVis2=="Line Plot"){
       if(length(input$Vis2_Line_Number)==0){
         
       }else if (input$Vis2_Line_Number=="1"){
         if(input$Vis2_LineY1=="Nothing Selected"){
          
         } else {
         input$Vis2_LineY1
         }
       } else if(input$Vis2_Line_Number=="2"){
         if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"){
           
         } else {
       c(input$Vis2_LineY1,
         input$Vis2_LineY2)
         }
       }else if(input$Vis2_Line_Number=="3"){
         if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"){
           
         } else {
       c(input$Vis2_LineY1,
         input$Vis2_LineY2,
         input$Vis2_LineY3)
       }
       }else if(input$Vis2_Line_Number=="4"){
         if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"||input$Vis2_LineY4=="Nothing Selected"){
           
         } else {
       c(input$Vis2_LineY1,
         input$Vis2_LineY2,
         input$Vis2_LineY3,
         input$Vis2_LineY4)
       }
       }else if(input$Vis2_Line_Number=="5"){
         if(input$Vis2_LineY1=="Nothing Selected"||input$Vis2_LineY2=="Nothing Selected"||input$Vis2_LineY3=="Nothing Selected"||input$Vis2_LineY4=="Nothing Selected"||input$Vis2_LineY5=="Nothing Selected"){
           
         } else {
       c(input$Vis2_LineY1,
         input$Vis2_LineY2,
         input$Vis2_LineY3,
         input$Vis2_LineY4,
         input$Vis2_LineY5)
       }
        }
     }else if (input$SelectVis2=="Scatter Plot"){
       if(input$Vis2_ScatterX=="Nothing Selected"||input$Vis2_ScatterY=="Nothing Selected"){
         
       } else {
       c(input$Vis2_ScatterX,
         input$Vis2_ScatterY)
       }
     }else if (input$SelectVis2=="Bar Chart"){
       if(length(input$Vis2_Bar_Number)==0){
         
       }else if (input$Vis2_Bar_Number=="1"){
         if(input$Vis2_BarY1=="Nothing Selected"){
           
         } else {
         c(input$Vis2_BarY1)
         }
       } else if(input$Vis2_Bar_Number=="2"){
         if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"){
           
         } else {
       c(input$Vis2_BarY1,
         input$Vis2_BarY2)
         }
       }else if(input$Vis2_Bar_Number=="3"){
         if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"){
           
         } else {
       c(input$Vis2_BarY1,
         input$Vis2_BarY2,
         input$Vis2_BarY3)
       }
       }else if(input$Vis2_Bar_Number=="4"){
         if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"||input$Vis2_BarY4=="Nothing Selected"){
           
         } else {
       c(input$Vis2_BarY1,
         input$Vis2_BarY2,
         input$Vis2_BarY3,
         input$Vis2_BarY4)
       }
       }else if(input$Vis2_Bar_Number=="5"){
         if(input$Vis2_BarY1=="Nothing Selected"||input$Vis2_BarY2=="Nothing Selected"||input$Vis2_BarY3=="Nothing Selected"||input$Vis2_BarY4=="Nothing Selected"||input$Vis2_BarY5=="Nothing Selected"){
           
         } else {
       c(input$Vis2_BarY1,
         input$Vis2_BarY2,
         input$Vis2_BarY3,
         input$Vis2_BarY4,
         input$Vis2_BarY5)
       }
        }
     }else if (input$SelectVis2=="Pie Chart"){
       if(length(input$Vis2_Pie_CategoryType)==0){
       }else if (input$Vis2_Pie_CategoryType=="Surveys"){
         if(length(input$Vis2_Pie_Metrics_to_Sum)==0){
           
         } else {
           input$Vis2_Pie_Metrics_to_Sum
         }
       } else if (input$Vis2_Pie_CategoryType=="Metrics"){
         if(length(input$Vis2_Pie_Metrics)==0){
           
         } else {
           input$Vis2_Pie_Metrics
         }
       } 
     }
   })

   

  
  Vis2InputFishTaxa<-reactive({
      Fish_Output<-trimws(sub(paste(FishMetricPick(), collapse = "|"), "", Vis_2_Input_Variables()[str_detect(Vis_2_Input_Variables(),paste(FishMetricPick(),collapse="|"))]) )
      return(Fish_Output)
  })
  
  Vis2InputFishTaxa_NoGroup<-reactive({
    req(Vis2InputFishTaxa())
    Vis2InputFishTaxa()%>%
      .[.!=GrpPick()]
  })
 
  Vis2InputTarget_Taxa<-reactive({
      Target_Output<-trimws(sub(paste(TargetMetricPick(), collapse = "|"), "", Vis_2_Input_Variables()[str_detect(Vis_2_Input_Variables(),paste(TargetMetricPick(),collapse="|"))]) )
      return(Target_Output)
  }) 
  
  Vis2InputTarget_Taxa_NoGroup<-reactive({
    req(Vis2InputTarget_Taxa())
    Vis2InputTarget_Taxa()%>%
      .[.!=AngPref_GrpPick()]
  })

    Vis2_UnattributedFishTaxa<-reactive({
     if(length(Vis2InputFishTaxa())>0){
       return(
         Vis_2_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(UnattributedTaxa)%>%
       filter(Taxa%in%Vis2InputFishTaxa())%>%
       select(!(UnattributedTaxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
      
  Vis2_PartiallyAttributedFishTaxa<-reactive({
      if(length(Vis2InputFishTaxa())>0){
       return(
         Vis_2_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(PartiallyAttributedTaxa)%>%
       filter(Taxa%in%Vis2InputFishTaxa())%>%
       select(!(PartiallyAttributedTaxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
   
   Vis2_IncompleteAttributedFishTaxa<-reactive({
      if(length(Vis2InputFishTaxa())>0){
       return(
         Vis_2_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(IncompleteAttributedTaxa)%>%
       filter(Taxa%in%Vis2InputFishTaxa())%>%
       select(!(Incomplete_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })

       Vis2_UnattributedTarget_Taxa<-reactive({
     if(length(Vis2InputTarget_Taxa())>0){
       return(
         Vis_2_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(UnattributedTarget_Taxa)%>%
       filter(Taxa%in%Vis2InputTarget_Taxa())%>%
       select(!(UnattributedTarget_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
      
  Vis2_PartiallyAttributedTarget_Taxa<-reactive({
      if(length(Vis2InputTarget_Taxa())>0){
       return(
         Vis_2_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(PartiallyAttributedTarget_Taxa)%>%
       filter(Taxa%in%Vis2InputTarget_Taxa())%>%
       select(!(PartiallyAttributedTarget_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
   
   Vis2_IncompleteAttributedTarget_Taxa<-reactive({
      if(length(Vis2InputTarget_Taxa())>0){
       return(
         Vis_2_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(IncompleteAttributedTarget_Taxa)%>%
       filter(Taxa%in%Vis2InputTarget_Taxa())%>%
       select(!(Incomplete_Target_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })


    Vis2_Retained_Surveys<-reactive({
      
      Vis_2_SelectedTBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
    })
    
    Vis2_Dropped_Surveys<-reactive({
      
      Vis_2_SelectedTBL_Raw()%>%anti_join(Vis_2_SelectedTBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))%>%
        unique()
    })


   output$Vis2_Dropped_TBL<-DT::renderDataTable(
    Vis2_Dropped_Surveys(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

  output$Vis2_Retained_TBL<-DT::renderDataTable(
    Vis2_Retained_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
   Vis_2_Dropped_NA_Surveys<-reactive({
     req(Vis_2_Selected_NA_TBL(),
         Vis_2_SelectedTBL_Raw()
         )
     Vis_2_SelectedTBL_Raw()%>%
       anti_join(Vis_2_Selected_NA_TBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })
   
   Vis_2_Dropped_NA_Warn_Surveys<-reactive({
     req(Vis_2_Dropped_NA_Surveys())
     as.list(as.character(unique(Vis_2_Dropped_NA_Surveys()$Survey_ID)))
     })
   
   Vis_2_Dropped_NA_Warn_Surveys_Count<-reactive({
     length(Vis_2_Dropped_NA_Warn_Surveys())
     })
   
    Vis_2_Retained_NA_Surveys<-reactive({
      req(Vis_2_Selected_NA_TBL())
     Vis_2_Selected_NA_TBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })

   Vis_2_Retained_NA_Warn_Surveys<-reactive({
     req(Vis_2_Retained_NA_Surveys())
     as.list(as.character(unique(Vis_2_Retained_NA_Surveys()$Survey_ID)))
     })
   
   Vis_2_Retained_NA_Warn_Surveys_Count<-reactive({
     req(Vis_2_Retained_NA_Warn_Surveys())
     length(Vis_2_Retained_NA_Warn_Surveys())
     })
   
   output$Vis_2_Dropped_NA_Warning<-renderText({
    if(length(Vis_2_Dropped_NA_Warn_Surveys())>0){
      return(paste(as.character(actionLink(inputId = "Vis_2_NA_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Visualization input fields contain NA values. Surveys containing NA for a visualization input are automatically dropped. </span><span style=\"color:red;font-weight:bold\">", Vis_2_Dropped_NA_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been dropped;</><span style=\"color:green;font-weight:bold\">",Vis_2_Retained_NA_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been retained</>"))
  }else {
  } 
  })
      output$Vis_2_Survey_Char_Drop<-renderText({
        return(paste(as.character(actionLink(inputId = "Vis_2SurveyDropCharacteristicsTip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black;font-weight:bold\">Survey Characteristic Drops </span>"))
      })
      
      output$Vis_2_Taxa_Atr_Drop<-renderText({
        return(paste(as.character(actionLink(inputId = "Vis_2TaxaAttributionDropTip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black;font-weight:bold\">Taxa Attribution Issue Drops </span>"))
      })
  
  observeEvent(input$Vis_2_NA_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Dropped NA Inputs"),
            h4(strong("Selected surveys contain 'NA' values for inputs which are automatically dropped: ")),
            h4("Visualizations are unable to accomodate 'NA' values for any inputs and they are therefore automatically dropped."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
   
   output$Vis_2_Dropped_NA_TBL_Pop<-reactive({
      
      length(Vis_2_Dropped_NA_Warn_Surveys())
      })
    outputOptions(output,'Vis_2_Dropped_NA_TBL_Pop',suspendWhenHidden=FALSE)
   
   output$Vis_2_Dropped_NA_TBL<-DT::renderDataTable(
    Vis_2_Dropped_NA_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
  output$Vis_2_Retained_NA_TBL<-DT::renderDataTable(
    Vis_2_Retained_NA_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
  

   Vis_2_Dropped_All_Surveys<-reactive({
      
     req(Vis_2_SelectedTBL(),
         Vis_2_SelectedTBL_Raw()
         )
     
     Vis_2_SelectedTBL_Raw()%>%
       anti_join(Vis_2_SelectedTBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })
   
   
   Vis_2_Dropped_All_Warn_Surveys<-reactive({
     req(Vis_2_Dropped_All_Surveys())
     as.list(as.character(unique(Vis_2_Dropped_All_Surveys()$Survey_ID)))
     })
   
   Vis_2_Dropped_All_Warn_Surveys_Count<-reactive({
     length(Vis_2_Dropped_All_Warn_Surveys())
     })
   
    Vis_2_Retained_All_Surveys<-reactive({
      req(Vis_2_SelectedTBL())
     Vis_2_SelectedTBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })

   Vis_2_Retained_All_Warn_Surveys<-reactive({
     req(Vis_2_Retained_All_Surveys())
     as.list(as.character(unique(Vis_2_Retained_All_Surveys()$Survey_ID)))
     })
   
   Vis_2_Retained_All_Warn_Surveys_Count<-reactive({
     req(Vis_2_Retained_All_Warn_Surveys())
     length(Vis_2_Retained_All_Warn_Surveys())
     })
   
   output$Vis_2_Dropped_All_Warning<-renderText({
    if(length(Vis_2_Dropped_All_Warn_Surveys())>0){
      return(paste(as.character(actionLink(inputId = "Vis_2_Dropped_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Surveys containing NA for a visualization inputs or user-selected drop characteristics have been dropped. </span><span style=\"color:red;font-weight:bold\">", Vis_2_Dropped_All_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been dropped;</><span style=\"color:green;font-weight:bold\">",Vis_2_Retained_All_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been retained</>"))
  }else {
  } 
  })

  
  observeEvent(input$Vis_2_Dropped_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Dropped Surveys"),
            h4(strong("Selected surveys contain 'NA' values for inputs or characteristics which match user selected 'Drop' criteria from switches above: ")),
            h4("Visualizations are unable to accomodate 'NA' values for any inputs and they are therefore automatically dropped."),
            h4("Surveys sometimes contain undesireable attributes or contain input taxa with attribution issues which lead to the user to drop them from the visualizations by switching the toggles above."),
            h4("This warning reports the total number of surveys which were selected to be included in the visualization as well as the number of surveys which have been dropped either due to NA inputs, undesireable survey characteristics, or the presence of input taxa attribution issues."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$Vis_2SurveyDropCharacteristicsTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Drop Based on Survey Characteristics"),
            h4(strong("Undesireable Survey Characteristics: ")),
            h4("Surveys occasionally contain undesireable characteristics which may result in a user wishing to exclude/drop them from thier visualizations."),
            h4("By toggling the switches in this section users can decide whether they wish to retain or drop surveys with the following characteristcis."),
            h4(strong("Non-Creel Approaches: "), "Drops surveys which are not classified as 'Creel Survey'. These typically include things like Mail/Phone/Internet Surveys."),
            h4(strong("Unknown/Uncertain Timing: "), "Drops surveys for which are missing start and/or end dates"),
            h4(strong("Unknown/Uncertain Location: "), "Drops surveys for which the location of the waterbody being surveyed can not be confirmed."),
            h4(strong("Unknown/Uncertain Spatial Extent: "), "Drops surveys for which the spatial extent of a survey can not be confirmed."),
            h4(strong("Focal Species: "), "Drops surveys which focus on only a single or group of taxa rather than the entire community."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$Vis_2TaxaAttributionDropTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),title = strong("Drop Based on Taxa Attribution Issues"),
            h4(strong("Taxa attribution issues: ")),
            h4("Surveys occasionally contain issues with the attribution of values to taxa."),
            h4("By toggling the switches in this section users can decide whether they wish to retain or drop surveys with the following characteristics."),
            h4(strong("Unattributed Input Fish Taxa: "), "Drops surveys for which one of the visualization inputs contains a fish taxa which cannot be attributed 
               (see tip at unattributed taxa warning in the warning panel for more details). Note: For visualizations wholly unattributed taxa are 'Null' so they 
               are dropped automatically, however partially attributed data are contain both attributed values and potentially unattributed values and therefore require 
               toggling of this switch to drop in order to remove."),
            h4(strong("Incomplete Input Fish Groups: "), "Drops surveys for which one of the visualization inputs contains a fish groups which have incomplete attribution 
               (see tip at incomplete group warning in the warning panel for more details)."),
            h4(strong("Unattributed Input Target Taxa: "), "Drops surveys for which one of the visualization inputs contains a target taxa which cannot be attributed 
               (see tip at unattributed target taxa warning in the warning panel for more details). Note: For visualizations wholly unattributed target taxa are 'Null' so they 
               are dropped automatically, however partially attributed data are contain both attributed values and potentially unattributed values and therefore require 
               toggling of this switch to drop in order to remove."),
            h4(strong("Incomplete Input Target Groups: "), "Drops surveys for which one of the visualization inputs contains a target groups which have incomplete attribution 
               (see tip at incomplete group warning in the warning panel for more details)."),
        easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$Vis_2WarningTableTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("View Warning Tables"),
            h4(strong("Select whether you wish to view tables which summarize any of the listed warning attributes: ")),
            h4(strong("Retained Surveys: "), "Table showing surveys which were retained after surveys which contained 'NA' in at least one visualization input or contained undesireable survey characteristics or input taxa attribution issues were dropped."),
            h4(strong("Dropped Surveys: "), "Table showing surveys which were dropped due to the presence of an 'NA' in at least one visualization input or undesireable survey characteristics or taxa attribution issues."),
            h4(strong("Retained NA Surveys: "), "Table showing surveys which were retained after surveys which contained 'NA' in at least one visualization input were dropped."),
            h4(strong("Dropped NA Surveys: "), "Table showing surveys which were dropped due to the presence of an 'NA' in at least one visualization input."),
            h4(strong("Non-Creel Approaches: "), "Table showing surveys which used any approach not classified as a 'Creel Survey'."),
            h4(strong("Unknown/Uncertain Timing: "), "Table showing surveys which were flagged ashaving unknown or uncertain timing."),
            h4(strong("Unknown/Uncertain Location: "), "Table showing surveys which were flagged ashaving unknown or uncertain locations."),
            h4(strong("Unknown/Uncertain Spatial Extent: "), "Table showing surveys which were flagged ashaving unknown or uncertain spatial extents."),
            h4(strong("Focal Species: "), "Table showing surveys which were conducted based on a focal species rather than the full community."),
            h4(strong("Unattributed Taxa: "), "Table showing records containing unattributed input taxa."),
            h4(strong("Partially Attributed Taxa: "), "Table showing records containing partially attributed input taxa."),
            h4(strong("Incomplete Groups: "), "Table showing records containing incomplete attribution of input groups."),
            h4(strong("Unattributed Target Taxa: "), "Table showing records containing unattributed input target taxa."),
            h4(strong("Partially Attributed Target Taxa: "), "Table showing records containing partially attributed input target taxa."),
            h4(strong("Incomplete Target Groups: "), "Table showing records containing incomplete attribution of input target groups."),
        easyClose = TRUE
        ))
    },ignoreInit=TRUE)
   
   output$Vis_2_Dropped_All_TBL<-DT::renderDataTable(
    Vis_2_Dropped_All_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
  output$Vis_2_Retained_All_TBL<-DT::renderDataTable(
    Vis_2_Retained_All_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
  
   output$Vis_2_FishTaxaHeading<-renderText({
    if((length(Vis_2UnattributedTaxa_Warn_Taxa())>0)||
       (length(Vis_2IncompleteAttributedTaxa_Warn_Taxa())>0)||
       (nchar(Vis_2_Overlap_Warn())>1)){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Fish Taxa Input Attribution Issues: </span></h4>"))
  }else {

  }
  })  
   
   output$Vis_2_AngPrefTaxaHeading<-renderText({
    if((length(Vis_2UnattributedTarget_Taxa_Warn_Taxa())>0)||
       (length(Vis_2IncompleteAttributedTarget_Taxa_Warn_Taxa())>0)||
       (nchar(TargetVis_2_Overlap_Warn())>1)
       ){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Angler Preference Taxa Input Attribution Issues: </span></h4>"))
  }else {

  }
  })  
   
  Vis_2UnattributedTaxa_Count<-reactive({
    if(is.null(Vis2_UnattributedFishTaxa())){
      return(NULL)
    }else{
     Vis2_UnattributedFishTaxa()%>%
     count(Taxa)%>%
     unite(Unattributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_2UnattributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_2UnattributedTaxa_Count()$Unattributed_Records))
     })
   
   Vis_2UnattributedTaxa_Warn_Vals<-reactive({
     paste(Vis_2UnattributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_2_UnattributedFishTaxaWarning<-renderText({
    if(length(Vis_2UnattributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_2_Unattributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include unattributed taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_2UnattributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })

  
  observeEvent(input$Vis_2_Unattributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unattributed Fish Taxa"),
            h4(strong("Selected surveys contain unattributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The list identifies which taxa have unattributed records in the dataset and how 
               many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


   output$Vis_2_UnattributedTBL_Pop<-reactive({
      length(Vis_2UnattributedTaxa_Warn_Taxa())
      })
   
    outputOptions(output,'Vis_2_UnattributedTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis2_UnattributedFishTaxa_TBL<-DT::renderDataTable(
    Vis2_UnattributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Attributed Taxa Suggestions ###
    Vis_2_Attributed_Gain<-reactive({
    if(is.null(Vis2_UnattributedFishTaxa())){return(NULL)}else{
     Vis2_UnattributedFishTaxa()%>%
     count(Attributed_Taxa)%>%
     unite(GainedRecords,"Attributed_Taxa","n",sep="-")
    }
     })

   Vis_2AttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_2_Attributed_Gain()$GainedRecords))
     })
   
   Vis_2AttributedTaxa_Warn_Vals<-reactive({
     paste(Vis_2AttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_2_AttributedFishTaxaWarning<-renderText({
    if(length(Vis_2UnattributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_2_Attributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Consider replacing unattributed and partially attributed taxa with attributed taxa: </span><span style=\"color:green;font-weight:bold\">", Vis_2AttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_2_Attributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Alternative Attributed Fish Taxa"),
            h4(strong("Alternatives to unattributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The species in this list show the taxa which were originall attributed 
               in the creel survey (ie. what level the taxa was initially recorded at) and the number of records for which this is the case."),
            h4(strong("Recommendation: "),"If possible replace the unattributed taxa with the recommended attributed taxa. Doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


# Partially Attributed Species #
   
   Vis_2PartiallyAttributedTaxa_Count<-reactive({
    if(is.null(Vis2_PartiallyAttributedFishTaxa())){
      return(NULL)
    } else {
     Vis2_PartiallyAttributedFishTaxa()%>%
     count(Taxa)%>%
     unite(PartiallyAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_2PartiallyAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_2PartiallyAttributedTaxa_Count()$PartiallyAttributed_Records))
     })
   
   Vis_2PartiallyAttributedTaxa_Warn_Vals<-reactive({
     paste(Vis_2PartiallyAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_2_PartiallyAttributedFishTaxaWarning<-renderText({
    if(length(Vis_2PartiallyAttributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_2_PartiallyAttributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include partially attributed taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_2PartiallyAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_2_PartiallyAttributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Partially Attributed Fish Taxa"),
            h4(strong("Selected surveys contain partially attributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). Occasionally a survey may record data across multiple overlapping taxanomic 
               levels creating partially attributed taxa. In these cases a survey may contain values attributed to both 'Black Crappie' (species) and 'Crappie' (genus). In thise case the value attributed to 'Black 
               Crappie' represents some, but not necessarily all, of the 'Black Crappie' in the survey as some of the values associated with 'Crappie' (genus) may actually also be 'Black Crappie'. Because of this 
               surveys which include both 'Black Crappie' and  'Crappie' attributions are considered partial attributions (ie. we can not fully attribute the 'Black Crappie' values). The list identifies which taxa have 
               partially attributed records in the dataset and how many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed or partially attributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip: "), "'Partially Attributed' taxa have both attributed and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset. Otherwise 
               partially attributed records will be included in the dataset but only include the directly attributed values without consideration of potential missing values from the unattributed portion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


   output$Vis2_PartiallyAttributedTBL_Pop<-reactive({
      
      length(Vis_2PartiallyAttributedTaxa_Warn_Taxa())
      })
    outputOptions(output,'Vis2_PartiallyAttributedTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis2_PartiallyAttributedFishTaxa_TBL<-DT::renderDataTable(
    Vis2_PartiallyAttributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Incomplete Groups #
      
     Vis_2IncompleteAttributedTaxa_Count<-reactive({
    if(is.null(Vis2_IncompleteAttributedFishTaxa())){
      return(NULL)
    }else{
     Vis2_IncompleteAttributedFishTaxa()%>%
     count(Taxa)%>%
     unite(IncompleteAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_2IncompleteAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_2IncompleteAttributedTaxa_Count()$IncompleteAttributed_Records))
     })
   
   Vis_2IncompleteAttributedTaxa_Warn_Vals<-reactive({
     paste(Vis_2IncompleteAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_2_IncompleteAttributedFishTaxaWarning<-renderText({
    if(length(Vis_2IncompleteAttributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_2_IncompleteAttributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include groups with incomplete attribution of taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_2IncompleteAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_2_IncompleteAttributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Incomplete Attribution of Fish Taxa"),
            h4(strong("Selected surveys contain incompletely attributed fish groups in inputs: ")),
            h4("Values for groups are typically generated either as a direct attribution of the group in the survey (ie. 'Panfish' estimates recorded directly), or by summing values for all component members 
            (ie. 'Trout' estimate generated by adding values from 'Rainbow Trout', 'Brook Trout', and 'Brown Trout'). Because groups are not monophyletic there can be cases when a group value may be incompletely 
            attributed due to component taxa which span within and outside group status (ie. a survey containing values attributed to the genus' 'Salvelinus' and 'Onchorynchus', while all values for 'Salvelinus' can 
            be (and therefore are) attributed to 'Trout', 'Onchorynchus'  includes both 'Trout' (Rainbow Trout, Cutthroat Trout...) and 'Non-Trout' (Chinook Salmon, Coho Salmon...), and therefore can not be attributed to 'Trout' 
            although some portion of those values may actually be 'Trout'.). In this case the records for 'Trout' are identified as 'Incomplete' meaning that some taxa are present within the record which may or may not be attributable 
            to the selected 'Group'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping incompletely attributed fish group records by toggling the 'Incomplete Input Fish Groups'  
               switch from 'Retained' to 'Dropped'."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)



   output$Vis_2_IncompleteTBL_Pop<-reactive({
      
      length(Vis_2IncompleteAttributedTaxa_Warn_Taxa())
      })
    outputOptions(output,'Vis_2_IncompleteTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis2_IncompleteAttributedFishTaxa_TBL<-DT::renderDataTable(
    Vis2_IncompleteAttributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )



   ### Overlapping Taxa Selection ###

FamilyVis_2_Selected<-reactive({
  TaxaTable%>%filter(Family %in% Vis2InputFishTaxa())%>%select(Family)%>%unique()
  })
GenusVis_2_Selected<-reactive({
      
  TaxaTable%>%filter(Genus %in% Vis2InputFishTaxa())%>%select(Family,Genus)%>%unique()
  })
SpeciesVis_2_Selected<-reactive({
      
  TaxaTable%>%filter(Species %in% Vis2InputFishTaxa())%>%select(Family,Genus,Species)%>%unique()
  })
SubsVis_2_Selected<-reactive({
      
  TaxaTable%>%filter(Subspecies_Variants %in% Vis2InputFishTaxa())%>%select(Family,Genus,Species,Subspecies_Variants)%>%unique()
  })


Genus_Family_Vis_2_Overlap<-reactive({
      
  req(GenusVis_2_Selected())
  req(FamilyVis_2_Selected())
  
  GenusVis_2_Selected()%>%
  inner_join(FamilyVis_2_Selected(),by='Family')%>%
  select(Family,Genus)%>%
  unite(Overlaps,"Family","Genus",sep=" overlaps ")})

Species_Family_Vis_2_Overlap<-reactive({
      
  req(SpeciesVis_2_Selected())
  req(FamilyVis_2_Selected())
  
  SpeciesVis_2_Selected()%>%
  inner_join(FamilyVis_2_Selected(),by='Family')%>%
  select(Family,Species)%>%
  unite(Overlaps,"Family","Species",sep=" overlaps ")})

Species_Genus_Vis_2_Overlap<-reactive({
      
  req(SpeciesVis_2_Selected())
  req(GenusVis_2_Selected())
  
  SpeciesVis_2_Selected()%>%
  inner_join(GenusVis_2_Selected(),by='Genus')%>%
  select(Genus,Species)%>%
  unite(Overlaps,"Genus","Species",sep=" overlaps ")})

Subspecies_Family_Vis_2_Overlap<-reactive({
  req(SubsVis_2_Selected())
  req(FamilyVis_2_Selected())
  
  SubsVis_2_Selected()%>%
  inner_join(FamilyVis_2_Selected(),by='Family')%>%
  select(Family,Subspecies_Variants)%>%
  unite(Overlaps,"Family","Subspecies_Variants",sep=" overlaps ")})

Subspecies_Genus_Vis_2_Overlap<-reactive({
      
  req(SubsVis_2_Selected())
  req(GenusVis_2_Selected())
  
  SubsVis_2_Selected()%>%
  inner_join(GenusVis_2_Selected(),by='Genus')%>%
  select(Genus,Subspecies_Variants)%>%
  unite(Overlaps,"Genus","Subspecies_Variants",sep=" overlaps ")})

Subspecies_Species_Vis_2_Overlap<-reactive({
      
  req(SubsVis_2_Selected())
  req(SpeciesVis_2_Selected())
  
  SubsVis_2_Selected()%>%
  inner_join(SpeciesVis_2_Selected(),by='Species')%>%
  select(Species,Subspecies_Variants)%>%
  unite(Overlaps,"Species","Subspecies_Variants",sep=" overlaps ")})

Group_Taxa_Vis_2_Overlap<-reactive({
      
  req(input$AF_SharedData=="No"||is.null(input$AF_SharedData))
  req(Vis2InputFishTaxa())
  
  GroupTaxa%>%
  filter(Group %in% Vis2InputFishTaxa())%>%
  filter(Taxa %in% Vis2InputFishTaxa_NoGroup())%>%
  unite(Overlaps,"Group","Taxa",sep=" overlaps ")%>%
  select(Overlaps)})

Vis_2Overlaps<-reactive({
  PH<-as.list(bind_rows(Genus_Family_Vis_2_Overlap(),Species_Family_Vis_2_Overlap(),Species_Genus_Vis_2_Overlap(),Subspecies_Family_Vis_2_Overlap(),Subspecies_Genus_Vis_2_Overlap(),Subspecies_Species_Vis_2_Overlap(),Group_Taxa_Vis_2_Overlap()))
return(PH)
})

   Vis_2OverlapTaxa_Warn<-reactive({
     as.list(as.character(unique(Vis_2Overlaps()$Overlaps)))
     })
   
   Vis_2_Overlap_Warn<-reactive({
     paste(Vis_2OverlapTaxa_Warn(),collapse=" & ")
     })

   output$Vis_2_OverlapFishWarning<-renderText({
    if(nchar(Vis_2_Overlap_Warn())>1){
      return(paste(as.character(actionLink(inputId = "Vis_2_Overlap_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input taxa include overlapping value attribution: </span><span style=\"color:red;font-weight:bold\">", Vis_2_Overlap_Warn(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_2_Overlap_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Overlap of Input Fish Taxa"),
            h4(strong("Selected fish inputs contain overlapping taxa: ")),
            h4("Taxa can be attributed at multiple, overlapping taxanomic levels and therefore the associated values can result in overlap or double counting (ie. a user selects both 
               'Bluegill' (Species) and 'Lepomis' (Genus) harvest estimates, the harvest estimate attributable to 'Bluegill'(10) is also included within 'Lepomis'(30), meaning of the 30 'Lepomis' individuals harvested 10 of them are the 
               same as the 10 recorded in Bluegill, while 20 of them are from different 'Lepomis' taxa."),
            h4(strong("Recommendation: "),"We suggest avoiding overlapping taxa whereever possible to avoid double, triple, etc. counting of values. In order to do this select only non-overlapping taxa for inputs."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)


  Vis_2UnattributedTarget_Taxa_Count<-reactive({
    if(is.null(Vis2_UnattributedTarget_Taxa())){
      return(NULL)
    }else{
     Vis2_UnattributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(Unattributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_2UnattributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_2UnattributedTarget_Taxa_Count()$Unattributed_Records))
     })
   
   Vis_2UnattributedTarget_Taxa_Warn_Vals<-reactive({
     paste(Vis_2UnattributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_2_UnattributedTarget_TaxaWarning<-renderText({
    if(length(Vis_2UnattributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_2_Unattributed_Target_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include unattributed target taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_2UnattributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_2_Unattributed_Target_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unattributed Target Taxa"),
            h4(strong("Selected surveys contain unattributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The list identifies which taxa have unattributed records in the dataset and how 
               many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   # Attributed Taxa Suggestions ###
    Vis_2_Attributed_TargetGain<-reactive({
      if(is.null(Vis2_UnattributedTarget_Taxa())){
        return(NULL)
      }else{
     return(Vis2_UnattributedTarget_Taxa()%>%
     count(Attributed_Target_Taxa)%>%
     unite(GainedRecords,"Attributed_Target_Taxa","n",sep="-"))
      }
     })

   Vis_2AttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_2_Attributed_TargetGain()$GainedRecords))
     })
   
   Vis_2AttributedTarget_Taxa_Warn_Vals<-reactive({paste(Vis_2AttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")})

   output$Vis_2_AttributedTarget_TaxaWarning<-renderText({
    if(nchar(Vis_2AttributedTarget_Taxa_Warn_Vals())>1){
      return(paste(as.character(actionLink(inputId = "Vis_2_AttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Consider replacing unattributed and partially attributed taxa with attributed taxa: </span><span style=\"color:green;font-weight:bold\">", Vis_2AttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_2_AttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Alternative Attributed Target Taxa"),
            h4(strong("Alternatives to unattributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The species in this list show the taxa which were originall attributed 
               in the creel survey (ie. what level the taxa was initially recorded at) and the number of records for which this is the case."),
            h4(strong("Recommendation: "),"If possible replace the unattributed target taxa with the recommended attributed target taxa. Doing so will reduce the instances of 
               unattributed target taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however if a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Vis_2_UnattributedTargetTBL_Pop<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
      length(Vis_2UnattributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Vis_2_UnattributedTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis2_UnattributedTarget_Taxa_TBL<-DT::renderDataTable(
    Vis2_UnattributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
 Vis_2PartiallyAttributedTarget_Taxa_Count<-reactive({
    if(is.null(Vis2_PartiallyAttributedTarget_Taxa())){
      return(NULL)
    } else {
     Vis2_PartiallyAttributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(PartiallyAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_2PartiallyAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_2PartiallyAttributedTarget_Taxa_Count()$PartiallyAttributed_Records))
     })
   
   Vis_2PartiallyAttributedTarget_Taxa_Warn_Vals<-reactive({
     paste(Vis_2PartiallyAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_2_PartiallyAttributedFishTarget_TaxaWarning<-renderText({
    if(length(Vis_2PartiallyAttributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_2_PartiallyAttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include partially attributed target taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_2PartiallyAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })

    observeEvent(input$Vis_2_PartiallyAttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Partially Attributed Target Taxa"),
            h4(strong("Selected surveys contain partially attributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). Occasionally a survey may record data across multiple overlapping taxanomic 
               levels creating partially attributed taxa. In these cases a survey may contain values attributed to both 'Black Crappie' (species) and 'Crappie' (genus). In thise case the value attributed to 'Black 
               Crappie' represents some, but not necessarily all, of the 'Black Crappie' in the survey as some of the values associated with 'Crappie' (genus) may actually also be 'Black Crappie'. Because of this 
               surveys which include both 'Black Crappie' and  'Crappie' attributions are considered partial attributions (ie. we can not fully attribute the 'Black Crappie' values). The list identifies which taxa have 
               partially attributed records in the dataset and how many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed or partially attributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Target Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip: "), "'Partially Attributed' taxa have both attributed and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset. Otherwise 
               partially attributed records will be included in the dataset but only include the directly attributed values without consideration of potential missing values from the unattributed portion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Vis2_PartiallyAttributedTargetTBL_Pop<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
      length(Vis_2PartiallyAttributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Vis2_PartiallyAttributedTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis2_PartiallyAttributedTarget_Taxa_TBL<-DT::renderDataTable(
    Vis2_PartiallyAttributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Incomplete Groups #
   
     Vis_2IncompleteAttributedTarget_Taxa_Count<-reactive({
    if(is.null(Vis2_IncompleteAttributedTarget_Taxa())){
      return(NULL)
    }else{
     Vis2_IncompleteAttributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(IncompleteAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_2IncompleteAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_2IncompleteAttributedTarget_Taxa_Count()$IncompleteAttributed_Records))
     })
   
   Vis_2IncompleteAttributedTarget_Taxa_Warn_Vals<-reactive({
     paste(Vis_2IncompleteAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_2_IncompleteAttributedFishTarget_TaxaWarning<-renderText({
    if(length(Vis_2IncompleteAttributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_2_IncompleteAttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include groups with incomplete attribution of target taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_2IncompleteAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })  
   
  observeEvent(input$Vis_2_IncompleteAttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Incomplete Attribution of Target Taxa"),
            h4(strong("Selected surveys contain incompletely attributed target groups in inputs: ")),
            h4("Values for groups are typically generated either as a direct attribution of the group in the survey (ie. 'Panfish' estimates recorded directly), or by summing values for all component members 
            (ie. 'Trout' estimate generated by adding values from 'Rainbow Trout', 'Brook Trout', and 'Brown Trout'). Because groups are not monophyletic there can be cases when a group value may be incompletely 
            attributed due to component taxa which span within and outside group status (ie. a survey containing values attributed to the genus' 'Salvelinus' and 'Onchorynchus', while all values for 'Salvelinus' can 
            be (and therefore are) attributed to 'Trout', 'Onchorynchus'  includes both 'Trout' (Rainbow Trout, Cutthroat Trout...) and 'Non-Trout' (Chinook Salmon, Coho Salmon...), and therefore can not be attributed to 'Trout' 
            although some portion of those values may actually be 'Trout'.). In this case the records for 'Trout' are identified as 'Incomplete' meaning that some taxa are present within the record which may or may not be attributable 
            to the selected 'Group'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping incompletely attributed target group records by toggling the 'Incomplete Input Fish Groups'  
               switch from 'Retained' to 'Dropped'."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Vis_2_IncompleteTargetTBL_Pop<-reactive({
      
      length(Vis_2IncompleteAttributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Vis_2_IncompleteTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis2_IncompleteAttributedTarget_Taxa_TBL<-DT::renderDataTable(
    Vis2_IncompleteAttributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )



   ### Overlapping Target Taxa Selection ###



TargetFamilyVis_2_Selected<-reactive({
  TaxaTable%>%filter(Family %in% Vis2InputTarget_Taxa())%>%select(Family)%>%unique()
  })
TargetGenusVis_2_Selected<-reactive({
      
  TaxaTable%>%filter(Genus %in% Vis2InputTarget_Taxa())%>%select(Family,Genus)%>%unique()
  })
TargetSpeciesVis_2_Selected<-reactive({
      
  TaxaTable%>%filter(Species %in% Vis2InputTarget_Taxa())%>%select(Family,Genus,Species)%>%unique()
  })
TargetSubsVis_2_Selected<-reactive({
      
  TaxaTable%>%filter(Subspecies_Variants %in% Vis2InputTarget_Taxa())%>%select(Family,Genus,Species,Subspecies_Variants)%>%unique()
  })


TargetGenus_Family_Vis_2_Overlap<-reactive({
  req(TargetGenusVis_2_Selected())
  req(TargetFamilyVis_2_Selected())
  
  TargetGenusVis_2_Selected()%>%
  inner_join(TargetFamilyVis_2_Selected(),by='Family')%>%
  select(Family,Genus)%>%
  unite(Overlaps,"Family","Genus",sep=" overlaps ")
  })

TargetSpecies_Family_Vis_2_Overlap<-reactive({
  req(TargetSpeciesVis_2_Selected())
  req(TargetFamilyVis_2_Selected())
  
  TargetSpeciesVis_2_Selected()%>%
  inner_join(TargetFamilyVis_2_Selected(),by='Family')%>%
  select(Family,Species)%>%
  unite(Overlaps,"Family","Species",sep=" overlaps ")
  })

TargetSpecies_Genus_Vis_2_Overlap<-reactive({
  req(TargetSpeciesVis_2_Selected())
  req(TargetGenusVis_2_Selected())
  
  TargetSpeciesVis_2_Selected()%>%
  inner_join(TargetGenusVis_2_Selected(),by='Genus')%>%
  select(Genus,Species)%>%
  unite(Overlaps,"Genus","Species",sep=" overlaps ")
  })

TargetSubspecies_Family_Vis_2_Overlap<-reactive({
  req(TargetSubsVis_2_Selected())
  req(TargetFamilyVis_2_Selected())
  
  TargetSubsVis_2_Selected()%>%
  inner_join(TargetFamilyVis_2_Selected(),by='Family')%>%
  select(Family,Subspecies_Variants)%>%
  unite(Overlaps,"Family","Subspecies_Variants",sep=" overlaps ")
  })

TargetSubspecies_Genus_Vis_2_Overlap<-reactive({
  req(TargetSubsVis_2_Selected())
  req(TargetGenusVis_2_Selected())
  
  TargetSubsVis_2_Selected()%>%
  inner_join(TargetGenusVis_2_Selected(),by='Genus')%>%
  select(Genus,Subspecies_Variants)%>%
  unite(Overlaps,"Genus","Subspecies_Variants",sep=" overlaps ")
  })

TargetSubspecies_Species_Vis_2_Overlap<-reactive({
  req(TargetSubsVis_2_Selected())
  req(TargetSpeciesVis_2_Selected())
  
  TargetSubsVis_2_Selected()%>%
  inner_join(TargetSpeciesVis_2_Selected(),by='Species')%>%
  select(Species,Subspecies_Variants)%>%
  unite(Overlaps,"Species","Subspecies_Variants",sep=" overlaps ")
  })

TargetGroup_Taxa_Vis_2_Overlap<-reactive({
  req(input$AF_SharedData=="No"||is.null(input$AF_SharedData))
  req(Vis2InputTarget_Taxa())
  
    GroupTaxa%>%
  filter(Group %in% Vis2InputTarget_Taxa())%>%
  filter(Taxa %in% Vis2InputTarget_Taxa_NoGroup())%>%
  unite(Overlaps,"Group","Taxa",sep=" overlaps ")%>%
  select(Overlaps)
 
  })

TargetVis_2Overlaps<-reactive({
  PH<-as.list(bind_rows(TargetGenus_Family_Vis_2_Overlap(),TargetSpecies_Family_Vis_2_Overlap(),TargetSpecies_Genus_Vis_2_Overlap(),TargetSubspecies_Family_Vis_2_Overlap(),TargetSubspecies_Genus_Vis_2_Overlap(),TargetSubspecies_Species_Vis_2_Overlap(),TargetGroup_Taxa_Vis_2_Overlap()))
return(PH)
})

   TargetVis_2OverlapTaxa_Warn<-reactive({
     as.list(as.character(unique(TargetVis_2Overlaps()$Overlaps)))
     })
   
   TargetVis_2_Overlap_Warn<-reactive({
     paste(TargetVis_2OverlapTaxa_Warn(),collapse=" & ")
     })

   output$Vis_2_OverlapTargetWarning<-renderText({
    if(nchar(TargetVis_2_Overlap_Warn())>1){
      return(paste(as.character(actionLink(inputId = "TargetVis_2_Overlap_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input target taxa include overlapping value attribution: </span><span style=\"color:red;font-weight:bold\">", TargetVis_2_Overlap_Warn(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$TargetVis_2_Overlap_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Overlap of Input Target Taxa"),
            h4(strong("Selected angler preference inputs contain overlapping target taxa: ")),
            h4("Taxa can be attributed at multiple, overlapping taxanomic levels and therefore the associated values can result in overlap or double counting (ie. a user selects both 
               'Bluegill' (Species) and 'Lepomis' (Genus) estimates, the estimate attributable to 'Bluegill'(10) is also included within 'Lepomis'(30), meaning of the 30 'Lepomis' values 10 of them are the 
               same as the 10 recorded in Bluegill, while 20 of them are from different 'Lepomis' taxa."),
            h4(strong("Recommendation: "),"We suggest avoiding overlapping taxa whereever possible to avoid double, triple, etc. counting of values. In order to do this select only non-overlapping target taxa for inputs."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)

#### Drop surveys with NA in vis input ####

# Vis 3 #
Vis_3_Selected_NA_TBL<-reactive({
  req(input$CreelCatNavBar=='Visualize Data')
  if(input$SelectVis3=="Nothing Selected"){
    Vis_3_SelectedTBL_Raw()
  }else if(input$SelectVis3=="Map"){
    if(is.null(input$Vis3_Map_CreelDisplayType)){
      Vis_3_SelectedTBL_Raw()
    }else if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){
      if(input$Vis3_MapDisplayField=="Nothing Selected"){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_MapDisplayField)
      }
    }else if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){
      if(input$Vis3_MapDisplayField_Size=="Nothing Selected"){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_MapDisplayField_Size)
      }
    }else if(input$Vis3_Map_CreelDisplayType=="Both"){
      if(input$Vis3_MapDisplayField=="Nothing Selected"||input$Vis3_MapDisplayField_Size=="Nothing Selected"){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_MapDisplayField)%>%
          drop_na(input$Vis3_MapDisplayField_Size)
      }
    } 
  }else if (input$SelectVis3=="Line Plot"){
    if(length(input$Vis3_Line_Number)==0){
      Vis_3_SelectedTBL_Raw()
    }else if (input$Vis3_Line_Number=="1"){
      if(input$Vis3_LineY1=="Nothing Selected"){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_LineY1)
      }
    } else if(input$Vis3_Line_Number=="2"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_LineY1)%>%
          drop_na(input$Vis3_LineY2)
      }
    }else if(input$Vis3_Line_Number=="3"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_LineY1)%>%
          drop_na(input$Vis3_LineY2)%>%
          drop_na(input$Vis3_LineY3)
      }
    }else if(input$Vis3_Line_Number=="4"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"||input$Vis3_LineY4=="Nothing Selected"){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_LineY1)%>%
          drop_na(input$Vis3_LineY2)%>%
          drop_na(input$Vis3_LineY3)%>%
          drop_na(input$Vis3_LineY4)
      }
    }else if(input$Vis3_Line_Number=="5"){
      if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"||input$Vis3_LineY4=="Nothing Selected"||input$Vis3_LineY5=="Nothing Selected"){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_LineY1)%>%
          drop_na(input$Vis3_LineY2)%>%
          drop_na(input$Vis3_LineY3)%>%
          drop_na(input$Vis3_LineY4)%>%
          drop_na(input$Vis3_LineY5)
      }
    }
  }else if (input$SelectVis3=="Scatter Plot"){
    if(input$Vis3_ScatterX=="Nothing Selected"||input$Vis3_ScatterY=="Nothing Selected"){
      Vis_3_SelectedTBL_Raw()
    } else {
      Vis_3_SelectedTBL_Raw()%>%
        drop_na(input$Vis3_ScatterX)%>%
        drop_na(input$Vis3_ScatterY)
    }
  }else if (input$SelectVis3=="Bar Chart"){
    if(length(input$Vis3_Bar_Number)==0){
      Vis_3_SelectedTBL_Raw()
    }else if (input$Vis3_Bar_Number=="1"){
      if(input$Vis3_BarY1=="Nothing Selected"){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_BarY1)
      }
    } else if(input$Vis3_Bar_Number=="2"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_BarY1)%>%
          drop_na(input$Vis3_BarY2)
      }
    }else if(input$Vis3_Bar_Number=="3"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_BarY1)%>%
          drop_na(input$Vis3_BarY2)%>%
          drop_na(input$Vis3_BarY3)
      }
    }else if(input$Vis3_Bar_Number=="4"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"||input$Vis3_BarY4=="Nothing Selected"){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_BarY1)%>%
          drop_na(input$Vis3_BarY2)%>%
          drop_na(input$Vis3_BarY3)%>%
          drop_na(input$Vis3_BarY4)
      }
    }else if(input$Vis3_Bar_Number=="5"){
      if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"||input$Vis3_BarY4=="Nothing Selected"||input$Vis3_BarY5=="Nothing Selected"){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_BarY1)%>%
          drop_na(input$Vis3_BarY2)%>%
          drop_na(input$Vis3_BarY3)%>%
          drop_na(input$Vis3_BarY4)%>%
          drop_na(input$Vis3_BarY5)
      }
    }
  }else if (input$SelectVis3=="Pie Chart"){
    if(length(input$Vis3_Pie_CategoryType)==0){Vis_3_SelectedTBL_Raw()
    }else if (input$Vis3_Pie_CategoryType=="Surveys"){
      if(length(input$Vis3_Pie_Metrics_to_Sum)==0){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_Pie_Metrics_to_Sum)
      }
    } else if (input$Vis3_Pie_CategoryType=="Metrics"){
      if(length(input$Vis3_Pie_Metrics)==0){
        Vis_3_SelectedTBL_Raw()
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          drop_na(input$Vis3_Pie_Metrics)
      }
    } 
  }
})
  
   
  
    Vis_3_SurveyWarnTBL<-reactive({
      req(Vis_3_WarningData())
     
      NonCreel_Retained<-if(input$NonCreel_Vis_3_Switch==TRUE){
        Vis_3_WarningData()%>%
          filter(.,Survey_Type=="Creel Survey")%>%
          select(Survey_ID)
        }else{
            Vis_3_WarningData()%>%
              select(Survey_ID)
        }

      Timing_Retained<-if(input$UnkTiming_Vis_3_Switch==TRUE){
        Vis_3_WarningData()%>%
          filter(.,!Timing_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Vis_3_WarningData()%>%
              select(Survey_ID)
        }

      Location_Retained<-if(input$UnkLocation_Vis_3_Switch==TRUE){
        Vis_3_WarningData()%>%
          filter(.,!Location_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Vis_3_WarningData()%>%
              select(Survey_ID)
        }

      Extent_Retained<-if(input$UnkExtent_Vis_3_Switch==TRUE){
        Vis_3_WarningData()%>%
          filter(.,!Extent_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Vis_3_WarningData()%>%
              select(Survey_ID)
        }

      FocalTaxa_Retained<-if(input$FocSpecies_Vis_3_Switch==TRUE){
        Vis_3_WarningData()%>%
          filter(.,Focal_Species==c("All"))%>%
          select(Survey_ID)
        }else{
            Vis_3_WarningData()%>%
              select(Survey_ID)
        }
      
       
        Vis_3_Survey_Filt<-NonCreel_Retained%>%
          semi_join(.,Timing_Retained,by='Survey_ID')%>%
          semi_join(.,Location_Retained,by='Survey_ID')%>%
          semi_join(.,Extent_Retained,by='Survey_ID')%>%
          semi_join(.,FocalTaxa_Retained,by='Survey_ID')%>%
          droplevels()

    return(Vis_3_Survey_Filt)

    })   
   
   Vis_3_TaxaWarnTBL<-reactive({
      req(Vis_3_SelectedTBL_Raw())
      Vis3UnattributedSurveys_Retained<-if(is.null(Vis3_UnattributedFishTaxa())){
        Vis_3_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$UnFish_Vis_3_Switch==TRUE){
        Vis_3_SelectedTBL_Raw()%>%
        anti_join(Vis3_UnattributedFishTaxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      Vis3IncompleteSurveys_Retained<-if(is.null(Vis3_IncompleteAttributedFishTaxa())){
        Vis_3_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$InFishGroup_Vis_3_Switch==TRUE){
        Vis_3_SelectedTBL_Raw()%>%
        anti_join(Vis3_IncompleteAttributedFishTaxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      Vis3UnattributedTargetSurveys_Retained<-if(is.null(Vis3_UnattributedTarget_Taxa())){
        Vis_3_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$UnTarget_Vis_3_Switch==TRUE){
        Vis_3_SelectedTBL_Raw()%>%
        anti_join(Vis3_UnattributedTarget_Taxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      Vis3IncompleteTargetSurveys_Retained<-if(is.null(Vis3_IncompleteAttributedTarget_Taxa())){
        Vis_3_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$InTargetGroup_Vis_3_Switch==TRUE){
        Vis_3_SelectedTBL_Raw()%>%
        anti_join(Vis3_IncompleteAttributedTarget_Taxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_3_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }
       
        Vis_3_Survey_Filt<-Vis3UnattributedSurveys_Retained%>%
          semi_join(.,Vis3IncompleteSurveys_Retained,by='Survey_ID')%>%
          semi_join(.,Vis3UnattributedTargetSurveys_Retained,by='Survey_ID')%>%
          semi_join(.,Vis3IncompleteTargetSurveys_Retained,by='Survey_ID')%>%
          droplevels()

    return(Vis_3_Survey_Filt)

    })   
   
Vis_3_SelectedTBL<-reactive({
  req(Vis_3_SurveyWarnTBL())
  req(Vis_3_TaxaWarnTBL())
  req(Vis_3_Selected_NA_TBL())
  
  Vis_3_Selected_NA_TBL()%>%
    semi_join(.,Vis_3_SurveyWarnTBL(),by='Survey_ID')%>%
    semi_join(.,Vis_3_TaxaWarnTBL(),by='Survey_ID')%>%
    droplevels()
  
})  

Vis_3_Input_Variables<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
     if(input$SelectVis3=="Nothing Selected"){
       
     }else if(input$SelectVis3=="Map"){
       if(is.null(input$Vis3_Map_CreelDisplayType)){
         
       }else if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){
           if(input$Vis3_MapDisplayField=="Nothing Selected"){
             
           } else {
              input$Vis3_MapDisplayField
           }
       }else if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){
           if(input$Vis3_MapDisplayField_Size=="Nothing Selected"){
             
           } else {
           input$Vis3_MapDisplayField_Size
           }
       }else if(input$Vis3_Map_CreelDisplayType=="Both"){
           if(input$Vis3_MapDisplayField=="Nothing Selected"||input$Vis3_MapDisplayField_Size=="Nothing Selected"){
             
           } else {
           c(input$Vis3_MapDisplayField,input$Vis3_MapDisplayField_Size)
           }
       } 
     }else if (input$SelectVis3=="Line Plot"){
       if(length(input$Vis3_Line_Number)==0){
         
       }else if (input$Vis3_Line_Number=="1"){
         if(input$Vis3_LineY1=="Nothing Selected"){
          
         } else {
         input$Vis3_LineY1
         }
       } else if(input$Vis3_Line_Number=="2"){
         if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"){
           
         } else {
       c(input$Vis3_LineY1,
         input$Vis3_LineY2)
         }
       }else if(input$Vis3_Line_Number=="3"){
         if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"){
           
         } else {
       c(input$Vis3_LineY1,
         input$Vis3_LineY2,
         input$Vis3_LineY3)
       }
       }else if(input$Vis3_Line_Number=="4"){
         if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"||input$Vis3_LineY4=="Nothing Selected"){
           
         } else {
       c(input$Vis3_LineY1,
         input$Vis3_LineY2,
         input$Vis3_LineY3,
         input$Vis3_LineY4)
       }
       }else if(input$Vis3_Line_Number=="5"){
         if(input$Vis3_LineY1=="Nothing Selected"||input$Vis3_LineY2=="Nothing Selected"||input$Vis3_LineY3=="Nothing Selected"||input$Vis3_LineY4=="Nothing Selected"||input$Vis3_LineY5=="Nothing Selected"){
           
         } else {
       c(input$Vis3_LineY1,
         input$Vis3_LineY2,
         input$Vis3_LineY3,
         input$Vis3_LineY4,
         input$Vis3_LineY5)
       }
        }
     }else if (input$SelectVis3=="Scatter Plot"){
       if(input$Vis3_ScatterX=="Nothing Selected"||input$Vis3_ScatterY=="Nothing Selected"){
         
       } else {
       c(input$Vis3_ScatterX,
         input$Vis3_ScatterY)
       }
     }else if (input$SelectVis3=="Bar Chart"){
       if(length(input$Vis3_Bar_Number)==0){
         
       }else if (input$Vis3_Bar_Number=="1"){
         if(input$Vis3_BarY1=="Nothing Selected"){
           
         } else {
         c(input$Vis3_BarY1)
         }
       } else if(input$Vis3_Bar_Number=="2"){
         if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"){
           
         } else {
       c(input$Vis3_BarY1,
         input$Vis3_BarY2)
         }
       }else if(input$Vis3_Bar_Number=="3"){
         if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"){
           
         } else {
       c(input$Vis3_BarY1,
         input$Vis3_BarY2,
         input$Vis3_BarY3)
       }
       }else if(input$Vis3_Bar_Number=="4"){
         if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"||input$Vis3_BarY4=="Nothing Selected"){
           
         } else {
       c(input$Vis3_BarY1,
         input$Vis3_BarY2,
         input$Vis3_BarY3,
         input$Vis3_BarY4)
       }
       }else if(input$Vis3_Bar_Number=="5"){
         if(input$Vis3_BarY1=="Nothing Selected"||input$Vis3_BarY2=="Nothing Selected"||input$Vis3_BarY3=="Nothing Selected"||input$Vis3_BarY4=="Nothing Selected"||input$Vis3_BarY5=="Nothing Selected"){
           
         } else {
       c(input$Vis3_BarY1,
         input$Vis3_BarY2,
         input$Vis3_BarY3,
         input$Vis3_BarY4,
         input$Vis3_BarY5)
       }
        }
     }else if (input$SelectVis3=="Pie Chart"){
       if(length(input$Vis3_Pie_CategoryType)==0){
       }else if (input$Vis3_Pie_CategoryType=="Surveys"){
         if(length(input$Vis3_Pie_Metrics_to_Sum)==0){
           
         } else {
           input$Vis3_Pie_Metrics_to_Sum
         }
       } else if (input$Vis3_Pie_CategoryType=="Metrics"){
         if(length(input$Vis3_Pie_Metrics)==0){
           
         } else {
           input$Vis3_Pie_Metrics
         }
       } 
     }
   })

   

  
  Vis3InputFishTaxa<-reactive({
      Fish_Output<-trimws(sub(paste(FishMetricPick(), collapse = "|"), "", Vis_3_Input_Variables()[str_detect(Vis_3_Input_Variables(),paste(FishMetricPick(),collapse="|"))]) )
      return(Fish_Output)
  })
  
  Vis3InputFishTaxa_NoGroup<-reactive({
    req(Vis3InputFishTaxa())
    Vis3InputFishTaxa()%>%
      .[.!=GrpPick()]
  })
 
  Vis3InputTarget_Taxa<-reactive({
      Target_Output<-trimws(sub(paste(TargetMetricPick(), collapse = "|"), "", Vis_3_Input_Variables()[str_detect(Vis_3_Input_Variables(),paste(TargetMetricPick(),collapse="|"))]) )
      return(Target_Output)
  }) 
  
  Vis3InputTarget_Taxa_NoGroup<-reactive({
    req(Vis3InputTarget_Taxa())
    Vis3InputTarget_Taxa()%>%
      .[.!=AngPref_GrpPick()]
  })

    Vis3_UnattributedFishTaxa<-reactive({
     if(length(Vis3InputFishTaxa())>0){
       return(
         Vis_3_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(UnattributedTaxa)%>%
       filter(Taxa%in%Vis3InputFishTaxa())%>%
       select(!(UnattributedTaxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
      
  Vis3_PartiallyAttributedFishTaxa<-reactive({
      if(length(Vis3InputFishTaxa())>0){
       return(
         Vis_3_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(PartiallyAttributedTaxa)%>%
       filter(Taxa%in%Vis3InputFishTaxa())%>%
       select(!(PartiallyAttributedTaxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
   
   Vis3_IncompleteAttributedFishTaxa<-reactive({
      if(length(Vis3InputFishTaxa())>0){
       return(
         Vis_3_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(IncompleteAttributedTaxa)%>%
       filter(Taxa%in%Vis3InputFishTaxa())%>%
       select(!(Incomplete_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })

       Vis3_UnattributedTarget_Taxa<-reactive({
     if(length(Vis3InputTarget_Taxa())>0){
       return(
         Vis_3_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(UnattributedTarget_Taxa)%>%
       filter(Taxa%in%Vis3InputTarget_Taxa())%>%
       select(!(UnattributedTarget_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
      
  Vis3_PartiallyAttributedTarget_Taxa<-reactive({
      if(length(Vis3InputTarget_Taxa())>0){
       return(
         Vis_3_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(PartiallyAttributedTarget_Taxa)%>%
       filter(Taxa%in%Vis3InputTarget_Taxa())%>%
       select(!(PartiallyAttributedTarget_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
   
   Vis3_IncompleteAttributedTarget_Taxa<-reactive({
      if(length(Vis3InputTarget_Taxa())>0){
       return(
         Vis_3_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(IncompleteAttributedTarget_Taxa)%>%
       filter(Taxa%in%Vis3InputTarget_Taxa())%>%
       select(!(Incomplete_Target_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })


    Vis3_Retained_Surveys<-reactive({
      
      Vis_3_SelectedTBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
    })
    
    Vis3_Dropped_Surveys<-reactive({
      
      Vis_3_SelectedTBL_Raw()%>%anti_join(Vis_3_SelectedTBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))%>%
        unique()
    })


   output$Vis3_Dropped_TBL<-DT::renderDataTable(
    Vis3_Dropped_Surveys(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

  output$Vis3_Retained_TBL<-DT::renderDataTable(
    Vis3_Retained_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
   Vis_3_Dropped_NA_Surveys<-reactive({
     req(Vis_3_Selected_NA_TBL(),
         Vis_3_SelectedTBL_Raw()
         )
     Vis_3_SelectedTBL_Raw()%>%
       anti_join(Vis_3_Selected_NA_TBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })
   
   Vis_3_Dropped_NA_Warn_Surveys<-reactive({
     req(Vis_3_Dropped_NA_Surveys())
     as.list(as.character(unique(Vis_3_Dropped_NA_Surveys()$Survey_ID)))
     })
   
   Vis_3_Dropped_NA_Warn_Surveys_Count<-reactive({
     length(Vis_3_Dropped_NA_Warn_Surveys())
     })
   
    Vis_3_Retained_NA_Surveys<-reactive({
      req(Vis_3_Selected_NA_TBL())
     Vis_3_Selected_NA_TBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })

   Vis_3_Retained_NA_Warn_Surveys<-reactive({
     req(Vis_3_Retained_NA_Surveys())
     as.list(as.character(unique(Vis_3_Retained_NA_Surveys()$Survey_ID)))
     })
   
   Vis_3_Retained_NA_Warn_Surveys_Count<-reactive({
     req(Vis_3_Retained_NA_Warn_Surveys())
     length(Vis_3_Retained_NA_Warn_Surveys())
     })
   
   output$Vis_3_Dropped_NA_Warning<-renderText({
    if(length(Vis_3_Dropped_NA_Warn_Surveys())>0){
      return(paste(as.character(actionLink(inputId = "Vis_3_NA_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Visualization input fields contain NA values. Surveys containing NA for a visualization input are automatically dropped. </span><span style=\"color:red;font-weight:bold\">", Vis_3_Dropped_NA_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been dropped;</><span style=\"color:green;font-weight:bold\">",Vis_3_Retained_NA_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been retained</>"))
  }else {
  } 
  })
      output$Vis_3_Survey_Char_Drop<-renderText({
        return(paste(as.character(actionLink(inputId = "Vis_3SurveyDropCharacteristicsTip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black;font-weight:bold\">Survey Characteristic Drops </span>"))
      })
      
      output$Vis_3_Taxa_Atr_Drop<-renderText({
        return(paste(as.character(actionLink(inputId = "Vis_3TaxaAttributionDropTip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black;font-weight:bold\">Taxa Attribution Issue Drops </span>"))
      })
  
  observeEvent(input$Vis_3_NA_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Dropped NA Inputs"),
            h4(strong("Selected surveys contain 'NA' values for inputs which are automatically dropped: ")),
            h4("Visualizations are unable to accomodate 'NA' values for any inputs and they are therefore automatically dropped."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
   
   output$Vis_3_Dropped_NA_TBL_Pop<-reactive({
      
      length(Vis_3_Dropped_NA_Warn_Surveys())
      })
    outputOptions(output,'Vis_3_Dropped_NA_TBL_Pop',suspendWhenHidden=FALSE)
   
   output$Vis_3_Dropped_NA_TBL<-DT::renderDataTable(
    Vis_3_Dropped_NA_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
  output$Vis_3_Retained_NA_TBL<-DT::renderDataTable(
    Vis_3_Retained_NA_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
  

   Vis_3_Dropped_All_Surveys<-reactive({
      
     req(Vis_3_SelectedTBL(),
         Vis_3_SelectedTBL_Raw()
         )
     
     Vis_3_SelectedTBL_Raw()%>%
       anti_join(Vis_3_SelectedTBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })
   
   
   Vis_3_Dropped_All_Warn_Surveys<-reactive({
     req(Vis_3_Dropped_All_Surveys())
     as.list(as.character(unique(Vis_3_Dropped_All_Surveys()$Survey_ID)))
     })
   
   Vis_3_Dropped_All_Warn_Surveys_Count<-reactive({
     length(Vis_3_Dropped_All_Warn_Surveys())
     })
   
    Vis_3_Retained_All_Surveys<-reactive({
      req(Vis_3_SelectedTBL())
     Vis_3_SelectedTBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })

   Vis_3_Retained_All_Warn_Surveys<-reactive({
     req(Vis_3_Retained_All_Surveys())
     as.list(as.character(unique(Vis_3_Retained_All_Surveys()$Survey_ID)))
     })
   
   Vis_3_Retained_All_Warn_Surveys_Count<-reactive({
     req(Vis_3_Retained_All_Warn_Surveys())
     length(Vis_3_Retained_All_Warn_Surveys())
     })
   
   output$Vis_3_Dropped_All_Warning<-renderText({
    if(length(Vis_3_Dropped_All_Warn_Surveys())>0){
      return(paste(as.character(actionLink(inputId = "Vis_3_Dropped_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Surveys containing NA for a visualization inputs or user-selected drop characteristics have been dropped. </span><span style=\"color:red;font-weight:bold\">", Vis_3_Dropped_All_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been dropped;</><span style=\"color:green;font-weight:bold\">",Vis_3_Retained_All_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been retained</>"))
  }else {
  } 
  })

  
  observeEvent(input$Vis_3_Dropped_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Dropped Surveys"),
            h4(strong("Selected surveys contain 'NA' values for inputs or characteristics which match user selected 'Drop' criteria from switches above: ")),
            h4("Visualizations are unable to accomodate 'NA' values for any inputs and they are therefore automatically dropped."),
            h4("Surveys sometimes contain undesireable attributes or contain input taxa with attribution issues which lead to the user to drop them from the visualizations by switching the toggles above."),
            h4("This warning reports the total number of surveys which were selected to be included in the visualization as well as the number of surveys which have been dropped either due to NA inputs, undesireable survey characteristics, or the presence of input taxa attribution issues."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$Vis_3SurveyDropCharacteristicsTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Drop Based on Survey Characteristics"),
            h4(strong("Undesireable Survey Characteristics: ")),
            h4("Surveys occasionally contain undesireable characteristics which may result in a user wishing to exclude/drop them from thier visualizations."),
            h4("By toggling the switches in this section users can decide whether they wish to retain or drop surveys with the following characteristcis."),
            h4(strong("Non-Creel Approaches: "), "Drops surveys which are not classified as 'Creel Survey'. These typically include things like Mail/Phone/Internet Surveys."),
            h4(strong("Unknown/Uncertain Timing: "), "Drops surveys for which are missing start and/or end dates"),
            h4(strong("Unknown/Uncertain Location: "), "Drops surveys for which the location of the waterbody being surveyed can not be confirmed."),
            h4(strong("Unknown/Uncertain Spatial Extent: "), "Drops surveys for which the spatial extent of a survey can not be confirmed."),
            h4(strong("Focal Species: "), "Drops surveys which focus on only a single or group of taxa rather than the entire community."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$Vis_3TaxaAttributionDropTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),title = strong("Drop Based on Taxa Attribution Issues"),
            h4(strong("Taxa attribution issues: ")),
            h4("Surveys occasionally contain issues with the attribution of values to taxa."),
            h4("By toggling the switches in this section users can decide whether they wish to retain or drop surveys with the following characteristics."),
            h4(strong("Unattributed Input Fish Taxa: "), "Drops surveys for which one of the visualization inputs contains a fish taxa which cannot be attributed 
               (see tip at unattributed taxa warning in the warning panel for more details). Note: For visualizations wholly unattributed taxa are 'Null' so they 
               are dropped automatically, however partially attributed data are contain both attributed values and potentially unattributed values and therefore require 
               toggling of this switch to drop in order to remove."),
            h4(strong("Incomplete Input Fish Groups: "), "Drops surveys for which one of the visualization inputs contains a fish groups which have incomplete attribution 
               (see tip at incomplete group warning in the warning panel for more details)."),
            h4(strong("Unattributed Input Target Taxa: "), "Drops surveys for which one of the visualization inputs contains a target taxa which cannot be attributed 
               (see tip at unattributed target taxa warning in the warning panel for more details). Note: For visualizations wholly unattributed target taxa are 'Null' so they 
               are dropped automatically, however partially attributed data are contain both attributed values and potentially unattributed values and therefore require 
               toggling of this switch to drop in order to remove."),
            h4(strong("Incomplete Input Target Groups: "), "Drops surveys for which one of the visualization inputs contains a target groups which have incomplete attribution 
               (see tip at incomplete group warning in the warning panel for more details)."),
        easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$Vis_3WarningTableTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("View Warning Tables"),
            h4(strong("Select whether you wish to view tables which summarize any of the listed warning attributes: ")),
            h4(strong("Retained Surveys: "), "Table showing surveys which were retained after surveys which contained 'NA' in at least one visualization input or contained undesireable survey characteristics or input taxa attribution issues were dropped."),
            h4(strong("Dropped Surveys: "), "Table showing surveys which were dropped due to the presence of an 'NA' in at least one visualization input or undesireable survey characteristics or taxa attribution issues."),
            h4(strong("Retained NA Surveys: "), "Table showing surveys which were retained after surveys which contained 'NA' in at least one visualization input were dropped."),
            h4(strong("Dropped NA Surveys: "), "Table showing surveys which were dropped due to the presence of an 'NA' in at least one visualization input."),
            h4(strong("Non-Creel Approaches: "), "Table showing surveys which used any approach not classified as a 'Creel Survey'."),
            h4(strong("Unknown/Uncertain Timing: "), "Table showing surveys which were flagged ashaving unknown or uncertain timing."),
            h4(strong("Unknown/Uncertain Location: "), "Table showing surveys which were flagged ashaving unknown or uncertain locations."),
            h4(strong("Unknown/Uncertain Spatial Extent: "), "Table showing surveys which were flagged ashaving unknown or uncertain spatial extents."),
            h4(strong("Focal Species: "), "Table showing surveys which were conducted based on a focal species rather than the full community."),
            h4(strong("Unattributed Taxa: "), "Table showing records containing unattributed input taxa."),
            h4(strong("Partially Attributed Taxa: "), "Table showing records containing partially attributed input taxa."),
            h4(strong("Incomplete Groups: "), "Table showing records containing incomplete attribution of input groups."),
            h4(strong("Unattributed Target Taxa: "), "Table showing records containing unattributed input target taxa."),
            h4(strong("Partially Attributed Target Taxa: "), "Table showing records containing partially attributed input target taxa."),
            h4(strong("Incomplete Target Groups: "), "Table showing records containing incomplete attribution of input target groups."),
        easyClose = TRUE
        ))
    },ignoreInit=TRUE)
   
   output$Vis_3_Dropped_All_TBL<-DT::renderDataTable(
    Vis_3_Dropped_All_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
  output$Vis_3_Retained_All_TBL<-DT::renderDataTable(
    Vis_3_Retained_All_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
  
   output$Vis_3_FishTaxaHeading<-renderText({
    if((length(Vis_3UnattributedTaxa_Warn_Taxa())>0)||
       (length(Vis_3IncompleteAttributedTaxa_Warn_Taxa())>0)||
       (nchar(Vis_3_Overlap_Warn())>1)){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Fish Taxa Input Attribution Issues: </span></h4>"))
  }else {

  }
  })  
   
   output$Vis_3_AngPrefTaxaHeading<-renderText({
    if((length(Vis_3UnattributedTarget_Taxa_Warn_Taxa())>0)||
       (length(Vis_3IncompleteAttributedTarget_Taxa_Warn_Taxa())>0)||
       (nchar(TargetVis_3_Overlap_Warn())>1)
       ){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Angler Preference Taxa Input Attribution Issues: </span></h4>"))
  }else {

  }
  })  
   
  Vis_3UnattributedTaxa_Count<-reactive({
    if(is.null(Vis3_UnattributedFishTaxa())){
      return(NULL)
    }else{
     Vis3_UnattributedFishTaxa()%>%
     count(Taxa)%>%
     unite(Unattributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_3UnattributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_3UnattributedTaxa_Count()$Unattributed_Records))
     })
   
   Vis_3UnattributedTaxa_Warn_Vals<-reactive({
     paste(Vis_3UnattributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_3_UnattributedFishTaxaWarning<-renderText({
    if(length(Vis_3UnattributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_3_Unattributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include unattributed taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_3UnattributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })

  
  observeEvent(input$Vis_3_Unattributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unattributed Fish Taxa"),
            h4(strong("Selected surveys contain unattributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The list identifies which taxa have unattributed records in the dataset and how 
               many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


   output$Vis_3_UnattributedTBL_Pop<-reactive({
      length(Vis_3UnattributedTaxa_Warn_Taxa())
      })
   
    outputOptions(output,'Vis_3_UnattributedTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis3_UnattributedFishTaxa_TBL<-DT::renderDataTable(
    Vis3_UnattributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Attributed Taxa Suggestions ###
    Vis_3_Attributed_Gain<-reactive({
    if(is.null(Vis3_UnattributedFishTaxa())){return(NULL)}else{
     Vis3_UnattributedFishTaxa()%>%
     count(Attributed_Taxa)%>%
     unite(GainedRecords,"Attributed_Taxa","n",sep="-")
    }
     })

   Vis_3AttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_3_Attributed_Gain()$GainedRecords))
     })
   
   Vis_3AttributedTaxa_Warn_Vals<-reactive({
     paste(Vis_3AttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_3_AttributedFishTaxaWarning<-renderText({
    if(length(Vis_3UnattributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_3_Attributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Consider replacing unattributed and partially attributed taxa with attributed taxa: </span><span style=\"color:green;font-weight:bold\">", Vis_3AttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_3_Attributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Alternative Attributed Fish Taxa"),
            h4(strong("Alternatives to unattributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The species in this list show the taxa which were originall attributed 
               in the creel survey (ie. what level the taxa was initially recorded at) and the number of records for which this is the case."),
            h4(strong("Recommendation: "),"If possible replace the unattributed taxa with the recommended attributed taxa. Doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


# Partially Attributed Species #
   
   Vis_3PartiallyAttributedTaxa_Count<-reactive({
    if(is.null(Vis3_PartiallyAttributedFishTaxa())){
      return(NULL)
    } else {
     Vis3_PartiallyAttributedFishTaxa()%>%
     count(Taxa)%>%
     unite(PartiallyAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_3PartiallyAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_3PartiallyAttributedTaxa_Count()$PartiallyAttributed_Records))
     })
   
   Vis_3PartiallyAttributedTaxa_Warn_Vals<-reactive({
     paste(Vis_3PartiallyAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_3_PartiallyAttributedFishTaxaWarning<-renderText({
    if(length(Vis_3PartiallyAttributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_3_PartiallyAttributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include partially attributed taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_3PartiallyAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_3_PartiallyAttributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Partially Attributed Fish Taxa"),
            h4(strong("Selected surveys contain partially attributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). Occasionally a survey may record data across multiple overlapping taxanomic 
               levels creating partially attributed taxa. In these cases a survey may contain values attributed to both 'Black Crappie' (species) and 'Crappie' (genus). In thise case the value attributed to 'Black 
               Crappie' represents some, but not necessarily all, of the 'Black Crappie' in the survey as some of the values associated with 'Crappie' (genus) may actually also be 'Black Crappie'. Because of this 
               surveys which include both 'Black Crappie' and  'Crappie' attributions are considered partial attributions (ie. we can not fully attribute the 'Black Crappie' values). The list identifies which taxa have 
               partially attributed records in the dataset and how many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed or partially attributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip: "), "'Partially Attributed' taxa have both attributed and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset. Otherwise 
               partially attributed records will be included in the dataset but only include the directly attributed values without consideration of potential missing values from the unattributed portion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


   output$Vis3_PartiallyAttributedTBL_Pop<-reactive({
      
      length(Vis_3PartiallyAttributedTaxa_Warn_Taxa())
      })
    outputOptions(output,'Vis3_PartiallyAttributedTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis3_PartiallyAttributedFishTaxa_TBL<-DT::renderDataTable(
    Vis3_PartiallyAttributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Incomplete Groups #
      
     Vis_3IncompleteAttributedTaxa_Count<-reactive({
    if(is.null(Vis3_IncompleteAttributedFishTaxa())){
      return(NULL)
    }else{
     Vis3_IncompleteAttributedFishTaxa()%>%
     count(Taxa)%>%
     unite(IncompleteAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_3IncompleteAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_3IncompleteAttributedTaxa_Count()$IncompleteAttributed_Records))
     })
   
   Vis_3IncompleteAttributedTaxa_Warn_Vals<-reactive({
     paste(Vis_3IncompleteAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_3_IncompleteAttributedFishTaxaWarning<-renderText({
    if(length(Vis_3IncompleteAttributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_3_IncompleteAttributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include groups with incomplete attribution of taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_3IncompleteAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_3_IncompleteAttributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Incomplete Attribution of Fish Taxa"),
            h4(strong("Selected surveys contain incompletely attributed fish groups in inputs: ")),
            h4("Values for groups are typically generated either as a direct attribution of the group in the survey (ie. 'Panfish' estimates recorded directly), or by summing values for all component members 
            (ie. 'Trout' estimate generated by adding values from 'Rainbow Trout', 'Brook Trout', and 'Brown Trout'). Because groups are not monophyletic there can be cases when a group value may be incompletely 
            attributed due to component taxa which span within and outside group status (ie. a survey containing values attributed to the genus' 'Salvelinus' and 'Onchorynchus', while all values for 'Salvelinus' can 
            be (and therefore are) attributed to 'Trout', 'Onchorynchus'  includes both 'Trout' (Rainbow Trout, Cutthroat Trout...) and 'Non-Trout' (Chinook Salmon, Coho Salmon...), and therefore can not be attributed to 'Trout' 
            although some portion of those values may actually be 'Trout'.). In this case the records for 'Trout' are identified as 'Incomplete' meaning that some taxa are present within the record which may or may not be attributable 
            to the selected 'Group'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping incompletely attributed fish group records by toggling the 'Incomplete Input Fish Groups'  
               switch from 'Retained' to 'Dropped'."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)



   output$Vis_3_IncompleteTBL_Pop<-reactive({
      
      length(Vis_3IncompleteAttributedTaxa_Warn_Taxa())
      })
    outputOptions(output,'Vis_3_IncompleteTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis3_IncompleteAttributedFishTaxa_TBL<-DT::renderDataTable(
    Vis3_IncompleteAttributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )



   ### Overlapping Taxa Selection ###

FamilyVis_3_Selected<-reactive({
  TaxaTable%>%filter(Family %in% Vis3InputFishTaxa())%>%select(Family)%>%unique()
  })
GenusVis_3_Selected<-reactive({
      
  TaxaTable%>%filter(Genus %in% Vis3InputFishTaxa())%>%select(Family,Genus)%>%unique()
  })
SpeciesVis_3_Selected<-reactive({
      
  TaxaTable%>%filter(Species %in% Vis3InputFishTaxa())%>%select(Family,Genus,Species)%>%unique()
  })
SubsVis_3_Selected<-reactive({
      
  TaxaTable%>%filter(Subspecies_Variants %in% Vis3InputFishTaxa())%>%select(Family,Genus,Species,Subspecies_Variants)%>%unique()
  })


Genus_Family_Vis_3_Overlap<-reactive({
      
  req(GenusVis_3_Selected())
  req(FamilyVis_3_Selected())
  
  GenusVis_3_Selected()%>%
  inner_join(FamilyVis_3_Selected(),by='Family')%>%
  select(Family,Genus)%>%
  unite(Overlaps,"Family","Genus",sep=" overlaps ")})

Species_Family_Vis_3_Overlap<-reactive({
      
  req(SpeciesVis_3_Selected())
  req(FamilyVis_3_Selected())
  
  SpeciesVis_3_Selected()%>%
  inner_join(FamilyVis_3_Selected(),by='Family')%>%
  select(Family,Species)%>%
  unite(Overlaps,"Family","Species",sep=" overlaps ")})

Species_Genus_Vis_3_Overlap<-reactive({
      
  req(SpeciesVis_3_Selected())
  req(GenusVis_3_Selected())
  
  SpeciesVis_3_Selected()%>%
  inner_join(GenusVis_3_Selected(),by='Genus')%>%
  select(Genus,Species)%>%
  unite(Overlaps,"Genus","Species",sep=" overlaps ")})

Subspecies_Family_Vis_3_Overlap<-reactive({
  req(SubsVis_3_Selected())
  req(FamilyVis_3_Selected())
  
  SubsVis_3_Selected()%>%
  inner_join(FamilyVis_3_Selected(),by='Family')%>%
  select(Family,Subspecies_Variants)%>%
  unite(Overlaps,"Family","Subspecies_Variants",sep=" overlaps ")})

Subspecies_Genus_Vis_3_Overlap<-reactive({
      
  req(SubsVis_3_Selected())
  req(GenusVis_3_Selected())
  
  SubsVis_3_Selected()%>%
  inner_join(GenusVis_3_Selected(),by='Genus')%>%
  select(Genus,Subspecies_Variants)%>%
  unite(Overlaps,"Genus","Subspecies_Variants",sep=" overlaps ")})

Subspecies_Species_Vis_3_Overlap<-reactive({
      
  req(SubsVis_3_Selected())
  req(SpeciesVis_3_Selected())
  
  SubsVis_3_Selected()%>%
  inner_join(SpeciesVis_3_Selected(),by='Species')%>%
  select(Species,Subspecies_Variants)%>%
  unite(Overlaps,"Species","Subspecies_Variants",sep=" overlaps ")})

Group_Taxa_Vis_3_Overlap<-reactive({
      
  req(input$AF_SharedData=="No"||is.null(input$AF_SharedData))
  req(Vis3InputFishTaxa())
  
  GroupTaxa%>%
  filter(Group %in% Vis3InputFishTaxa())%>%
  filter(Taxa %in% Vis3InputFishTaxa_NoGroup())%>%
  unite(Overlaps,"Group","Taxa",sep=" overlaps ")%>%
  select(Overlaps)})

Vis_3Overlaps<-reactive({
  PH<-as.list(bind_rows(Genus_Family_Vis_3_Overlap(),Species_Family_Vis_3_Overlap(),Species_Genus_Vis_3_Overlap(),Subspecies_Family_Vis_3_Overlap(),Subspecies_Genus_Vis_3_Overlap(),Subspecies_Species_Vis_3_Overlap(),Group_Taxa_Vis_3_Overlap()))
return(PH)
})

   Vis_3OverlapTaxa_Warn<-reactive({
     as.list(as.character(unique(Vis_3Overlaps()$Overlaps)))
     })
   
   Vis_3_Overlap_Warn<-reactive({
     paste(Vis_3OverlapTaxa_Warn(),collapse=" & ")
     })

   output$Vis_3_OverlapFishWarning<-renderText({
    if(nchar(Vis_3_Overlap_Warn())>1){
      return(paste(as.character(actionLink(inputId = "Vis_3_Overlap_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input taxa include overlapping value attribution: </span><span style=\"color:red;font-weight:bold\">", Vis_3_Overlap_Warn(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_3_Overlap_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Overlap of Input Fish Taxa"),
            h4(strong("Selected fish inputs contain overlapping taxa: ")),
            h4("Taxa can be attributed at multiple, overlapping taxanomic levels and therefore the associated values can result in overlap or double counting (ie. a user selects both 
               'Bluegill' (Species) and 'Lepomis' (Genus) harvest estimates, the harvest estimate attributable to 'Bluegill'(10) is also included within 'Lepomis'(30), meaning of the 30 'Lepomis' individuals harvested 10 of them are the 
               same as the 10 recorded in Bluegill, while 20 of them are from different 'Lepomis' taxa."),
            h4(strong("Recommendation: "),"We suggest avoiding overlapping taxa whereever possible to avoid double, triple, etc. counting of values. In order to do this select only non-overlapping taxa for inputs."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)


  Vis_3UnattributedTarget_Taxa_Count<-reactive({
    if(is.null(Vis3_UnattributedTarget_Taxa())){
      return(NULL)
    }else{
     Vis3_UnattributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(Unattributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_3UnattributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_3UnattributedTarget_Taxa_Count()$Unattributed_Records))
     })
   
   Vis_3UnattributedTarget_Taxa_Warn_Vals<-reactive({
     paste(Vis_3UnattributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_3_UnattributedTarget_TaxaWarning<-renderText({
    if(length(Vis_3UnattributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_3_Unattributed_Target_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include unattributed target taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_3UnattributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_3_Unattributed_Target_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unattributed Target Taxa"),
            h4(strong("Selected surveys contain unattributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The list identifies which taxa have unattributed records in the dataset and how 
               many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   # Attributed Taxa Suggestions ###
    Vis_3_Attributed_TargetGain<-reactive({
      if(is.null(Vis3_UnattributedTarget_Taxa())){
        return(NULL)
      }else{
     return(Vis3_UnattributedTarget_Taxa()%>%
     count(Attributed_Target_Taxa)%>%
     unite(GainedRecords,"Attributed_Target_Taxa","n",sep="-"))
      }
     })

   Vis_3AttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_3_Attributed_TargetGain()$GainedRecords))
     })
   
   Vis_3AttributedTarget_Taxa_Warn_Vals<-reactive({paste(Vis_3AttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")})

   output$Vis_3_AttributedTarget_TaxaWarning<-renderText({
    if(nchar(Vis_3AttributedTarget_Taxa_Warn_Vals())>1){
      return(paste(as.character(actionLink(inputId = "Vis_3_AttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Consider replacing unattributed and partially attributed taxa with attributed taxa: </span><span style=\"color:green;font-weight:bold\">", Vis_3AttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_3_AttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Alternative Attributed Target Taxa"),
            h4(strong("Alternatives to unattributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The species in this list show the taxa which were originall attributed 
               in the creel survey (ie. what level the taxa was initially recorded at) and the number of records for which this is the case."),
            h4(strong("Recommendation: "),"If possible replace the unattributed target taxa with the recommended attributed target taxa. Doing so will reduce the instances of 
               unattributed target taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however if a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Vis_3_UnattributedTargetTBL_Pop<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
      length(Vis_3UnattributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Vis_3_UnattributedTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis3_UnattributedTarget_Taxa_TBL<-DT::renderDataTable(
    Vis3_UnattributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
 Vis_3PartiallyAttributedTarget_Taxa_Count<-reactive({
    if(is.null(Vis3_PartiallyAttributedTarget_Taxa())){
      return(NULL)
    } else {
     Vis3_PartiallyAttributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(PartiallyAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_3PartiallyAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_3PartiallyAttributedTarget_Taxa_Count()$PartiallyAttributed_Records))
     })
   
   Vis_3PartiallyAttributedTarget_Taxa_Warn_Vals<-reactive({
     paste(Vis_3PartiallyAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_3_PartiallyAttributedFishTarget_TaxaWarning<-renderText({
    if(length(Vis_3PartiallyAttributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_3_PartiallyAttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include partially attributed target taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_3PartiallyAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })

    observeEvent(input$Vis_3_PartiallyAttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Partially Attributed Target Taxa"),
            h4(strong("Selected surveys contain partially attributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). Occasionally a survey may record data across multiple overlapping taxanomic 
               levels creating partially attributed taxa. In these cases a survey may contain values attributed to both 'Black Crappie' (species) and 'Crappie' (genus). In thise case the value attributed to 'Black 
               Crappie' represents some, but not necessarily all, of the 'Black Crappie' in the survey as some of the values associated with 'Crappie' (genus) may actually also be 'Black Crappie'. Because of this 
               surveys which include both 'Black Crappie' and  'Crappie' attributions are considered partial attributions (ie. we can not fully attribute the 'Black Crappie' values). The list identifies which taxa have 
               partially attributed records in the dataset and how many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed or partially attributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Target Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip: "), "'Partially Attributed' taxa have both attributed and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset. Otherwise 
               partially attributed records will be included in the dataset but only include the directly attributed values without consideration of potential missing values from the unattributed portion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Vis3_PartiallyAttributedTargetTBL_Pop<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
      length(Vis_3PartiallyAttributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Vis3_PartiallyAttributedTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis3_PartiallyAttributedTarget_Taxa_TBL<-DT::renderDataTable(
    Vis3_PartiallyAttributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Incomplete Groups #
   
     Vis_3IncompleteAttributedTarget_Taxa_Count<-reactive({
    if(is.null(Vis3_IncompleteAttributedTarget_Taxa())){
      return(NULL)
    }else{
     Vis3_IncompleteAttributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(IncompleteAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_3IncompleteAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_3IncompleteAttributedTarget_Taxa_Count()$IncompleteAttributed_Records))
     })
   
   Vis_3IncompleteAttributedTarget_Taxa_Warn_Vals<-reactive({
     paste(Vis_3IncompleteAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_3_IncompleteAttributedFishTarget_TaxaWarning<-renderText({
    if(length(Vis_3IncompleteAttributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_3_IncompleteAttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include groups with incomplete attribution of target taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_3IncompleteAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })  
   
  observeEvent(input$Vis_3_IncompleteAttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Incomplete Attribution of Target Taxa"),
            h4(strong("Selected surveys contain incompletely attributed target groups in inputs: ")),
            h4("Values for groups are typically generated either as a direct attribution of the group in the survey (ie. 'Panfish' estimates recorded directly), or by summing values for all component members 
            (ie. 'Trout' estimate generated by adding values from 'Rainbow Trout', 'Brook Trout', and 'Brown Trout'). Because groups are not monophyletic there can be cases when a group value may be incompletely 
            attributed due to component taxa which span within and outside group status (ie. a survey containing values attributed to the genus' 'Salvelinus' and 'Onchorynchus', while all values for 'Salvelinus' can 
            be (and therefore are) attributed to 'Trout', 'Onchorynchus'  includes both 'Trout' (Rainbow Trout, Cutthroat Trout...) and 'Non-Trout' (Chinook Salmon, Coho Salmon...), and therefore can not be attributed to 'Trout' 
            although some portion of those values may actually be 'Trout'.). In this case the records for 'Trout' are identified as 'Incomplete' meaning that some taxa are present within the record which may or may not be attributable 
            to the selected 'Group'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping incompletely attributed target group records by toggling the 'Incomplete Input Fish Groups'  
               switch from 'Retained' to 'Dropped'."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Vis_3_IncompleteTargetTBL_Pop<-reactive({
      
      length(Vis_3IncompleteAttributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Vis_3_IncompleteTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis3_IncompleteAttributedTarget_Taxa_TBL<-DT::renderDataTable(
    Vis3_IncompleteAttributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )



   ### Overlapping Target Taxa Selection ###



TargetFamilyVis_3_Selected<-reactive({
  TaxaTable%>%filter(Family %in% Vis3InputTarget_Taxa())%>%select(Family)%>%unique()
  })
TargetGenusVis_3_Selected<-reactive({
      
  TaxaTable%>%filter(Genus %in% Vis3InputTarget_Taxa())%>%select(Family,Genus)%>%unique()
  })
TargetSpeciesVis_3_Selected<-reactive({
      
  TaxaTable%>%filter(Species %in% Vis3InputTarget_Taxa())%>%select(Family,Genus,Species)%>%unique()
  })
TargetSubsVis_3_Selected<-reactive({
      
  TaxaTable%>%filter(Subspecies_Variants %in% Vis3InputTarget_Taxa())%>%select(Family,Genus,Species,Subspecies_Variants)%>%unique()
  })


TargetGenus_Family_Vis_3_Overlap<-reactive({
  req(TargetGenusVis_3_Selected())
  req(TargetFamilyVis_3_Selected())
  
  TargetGenusVis_3_Selected()%>%
  inner_join(TargetFamilyVis_3_Selected(),by='Family')%>%
  select(Family,Genus)%>%
  unite(Overlaps,"Family","Genus",sep=" overlaps ")
  })

TargetSpecies_Family_Vis_3_Overlap<-reactive({
  req(TargetSpeciesVis_3_Selected())
  req(TargetFamilyVis_3_Selected())
  
  TargetSpeciesVis_3_Selected()%>%
  inner_join(TargetFamilyVis_3_Selected(),by='Family')%>%
  select(Family,Species)%>%
  unite(Overlaps,"Family","Species",sep=" overlaps ")
  })

TargetSpecies_Genus_Vis_3_Overlap<-reactive({
  req(TargetSpeciesVis_3_Selected())
  req(TargetGenusVis_3_Selected())
  
  TargetSpeciesVis_3_Selected()%>%
  inner_join(TargetGenusVis_3_Selected(),by='Genus')%>%
  select(Genus,Species)%>%
  unite(Overlaps,"Genus","Species",sep=" overlaps ")
  })

TargetSubspecies_Family_Vis_3_Overlap<-reactive({
  req(TargetSubsVis_3_Selected())
  req(TargetFamilyVis_3_Selected())
  
  TargetSubsVis_3_Selected()%>%
  inner_join(TargetFamilyVis_3_Selected(),by='Family')%>%
  select(Family,Subspecies_Variants)%>%
  unite(Overlaps,"Family","Subspecies_Variants",sep=" overlaps ")
  })

TargetSubspecies_Genus_Vis_3_Overlap<-reactive({
  req(TargetSubsVis_3_Selected())
  req(TargetGenusVis_3_Selected())
  
  TargetSubsVis_3_Selected()%>%
  inner_join(TargetGenusVis_3_Selected(),by='Genus')%>%
  select(Genus,Subspecies_Variants)%>%
  unite(Overlaps,"Genus","Subspecies_Variants",sep=" overlaps ")
  })

TargetSubspecies_Species_Vis_3_Overlap<-reactive({
  req(TargetSubsVis_3_Selected())
  req(TargetSpeciesVis_3_Selected())
  
  TargetSubsVis_3_Selected()%>%
  inner_join(TargetSpeciesVis_3_Selected(),by='Species')%>%
  select(Species,Subspecies_Variants)%>%
  unite(Overlaps,"Species","Subspecies_Variants",sep=" overlaps ")
  })

TargetGroup_Taxa_Vis_3_Overlap<-reactive({
  req(input$AF_SharedData=="No"||is.null(input$AF_SharedData))
  req(Vis3InputTarget_Taxa())
  
    GroupTaxa%>%
  filter(Group %in% Vis3InputTarget_Taxa())%>%
  filter(Taxa %in% Vis3InputTarget_Taxa_NoGroup())%>%
  unite(Overlaps,"Group","Taxa",sep=" overlaps ")%>%
  select(Overlaps)
 
  })

TargetVis_3Overlaps<-reactive({
  PH<-as.list(bind_rows(TargetGenus_Family_Vis_3_Overlap(),TargetSpecies_Family_Vis_3_Overlap(),TargetSpecies_Genus_Vis_3_Overlap(),TargetSubspecies_Family_Vis_3_Overlap(),TargetSubspecies_Genus_Vis_3_Overlap(),TargetSubspecies_Species_Vis_3_Overlap(),TargetGroup_Taxa_Vis_3_Overlap()))
return(PH)
})

   TargetVis_3OverlapTaxa_Warn<-reactive({
     as.list(as.character(unique(TargetVis_3Overlaps()$Overlaps)))
     })
   
   TargetVis_3_Overlap_Warn<-reactive({
     paste(TargetVis_3OverlapTaxa_Warn(),collapse=" & ")
     })

   output$Vis_3_OverlapTargetWarning<-renderText({
    if(nchar(TargetVis_3_Overlap_Warn())>1){
      return(paste(as.character(actionLink(inputId = "TargetVis_3_Overlap_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input target taxa include overlapping value attribution: </span><span style=\"color:red;font-weight:bold\">", TargetVis_3_Overlap_Warn(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$TargetVis_3_Overlap_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Overlap of Input Target Taxa"),
            h4(strong("Selected angler preference inputs contain overlapping target taxa: ")),
            h4("Taxa can be attributed at multiple, overlapping taxanomic levels and therefore the associated values can result in overlap or double counting (ie. a user selects both 
               'Bluegill' (Species) and 'Lepomis' (Genus) estimates, the estimate attributable to 'Bluegill'(10) is also included within 'Lepomis'(30), meaning of the 30 'Lepomis' values 10 of them are the 
               same as the 10 recorded in Bluegill, while 20 of them are from different 'Lepomis' taxa."),
            h4(strong("Recommendation: "),"We suggest avoiding overlapping taxa whereever possible to avoid double, triple, etc. counting of values. In order to do this select only non-overlapping target taxa for inputs."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)

#### Drop surveys with NA in vis input ####

# Vis 4 #
Vis_4_Selected_NA_TBL<-reactive({
  req(input$CreelCatNavBar=='Visualize Data')
  if(input$SelectVis4=="Nothing Selected"){
    Vis_4_SelectedTBL_Raw()
  }else if(input$SelectVis4=="Map"){
    if(is.null(input$Vis4_Map_CreelDisplayType)){
      Vis_4_SelectedTBL_Raw()
    }else if(input$Vis4_Map_CreelDisplayType=="Scaled Color"){
      if(input$Vis4_MapDisplayField=="Nothing Selected"){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_MapDisplayField)
      }
    }else if(input$Vis4_Map_CreelDisplayType=="Scaled Size"){
      if(input$Vis4_MapDisplayField_Size=="Nothing Selected"){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_MapDisplayField_Size)
      }
    }else if(input$Vis4_Map_CreelDisplayType=="Both"){
      if(input$Vis4_MapDisplayField=="Nothing Selected"||input$Vis4_MapDisplayField_Size=="Nothing Selected"){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_MapDisplayField)%>%
          drop_na(input$Vis4_MapDisplayField_Size)
      }
    } 
  }else if (input$SelectVis4=="Line Plot"){
    if(length(input$Vis4_Line_Number)==0){
      Vis_4_SelectedTBL_Raw()
    }else if (input$Vis4_Line_Number=="1"){
      if(input$Vis4_LineY1=="Nothing Selected"){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_LineY1)
      }
    } else if(input$Vis4_Line_Number=="2"){
      if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_LineY1)%>%
          drop_na(input$Vis4_LineY2)
      }
    }else if(input$Vis4_Line_Number=="3"){
      if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"||input$Vis4_LineY3=="Nothing Selected"){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_LineY1)%>%
          drop_na(input$Vis4_LineY2)%>%
          drop_na(input$Vis4_LineY3)
      }
    }else if(input$Vis4_Line_Number=="4"){
      if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"||input$Vis4_LineY3=="Nothing Selected"||input$Vis4_LineY4=="Nothing Selected"){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_LineY1)%>%
          drop_na(input$Vis4_LineY2)%>%
          drop_na(input$Vis4_LineY3)%>%
          drop_na(input$Vis4_LineY4)
      }
    }else if(input$Vis4_Line_Number=="5"){
      if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"||input$Vis4_LineY3=="Nothing Selected"||input$Vis4_LineY4=="Nothing Selected"||input$Vis4_LineY5=="Nothing Selected"){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_LineY1)%>%
          drop_na(input$Vis4_LineY2)%>%
          drop_na(input$Vis4_LineY3)%>%
          drop_na(input$Vis4_LineY4)%>%
          drop_na(input$Vis4_LineY5)
      }
    }
  }else if (input$SelectVis4=="Scatter Plot"){
    if(input$Vis4_ScatterX=="Nothing Selected"||input$Vis4_ScatterY=="Nothing Selected"){
      Vis_4_SelectedTBL_Raw()
    } else {
      Vis_4_SelectedTBL_Raw()%>%
        drop_na(input$Vis4_ScatterX)%>%
        drop_na(input$Vis4_ScatterY)
    }
  }else if (input$SelectVis4=="Bar Chart"){
    if(length(input$Vis4_Bar_Number)==0){
      Vis_4_SelectedTBL_Raw()
    }else if (input$Vis4_Bar_Number=="1"){
      if(input$Vis4_BarY1=="Nothing Selected"){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_BarY1)
      }
    } else if(input$Vis4_Bar_Number=="2"){
      if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_BarY1)%>%
          drop_na(input$Vis4_BarY2)
      }
    }else if(input$Vis4_Bar_Number=="3"){
      if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"||input$Vis4_BarY3=="Nothing Selected"){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_BarY1)%>%
          drop_na(input$Vis4_BarY2)%>%
          drop_na(input$Vis4_BarY3)
      }
    }else if(input$Vis4_Bar_Number=="4"){
      if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"||input$Vis4_BarY3=="Nothing Selected"||input$Vis4_BarY4=="Nothing Selected"){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_BarY1)%>%
          drop_na(input$Vis4_BarY2)%>%
          drop_na(input$Vis4_BarY3)%>%
          drop_na(input$Vis4_BarY4)
      }
    }else if(input$Vis4_Bar_Number=="5"){
      if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"||input$Vis4_BarY3=="Nothing Selected"||input$Vis4_BarY4=="Nothing Selected"||input$Vis4_BarY5=="Nothing Selected"){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_BarY1)%>%
          drop_na(input$Vis4_BarY2)%>%
          drop_na(input$Vis4_BarY3)%>%
          drop_na(input$Vis4_BarY4)%>%
          drop_na(input$Vis4_BarY5)
      }
    }
  }else if (input$SelectVis4=="Pie Chart"){
    if(length(input$Vis4_Pie_CategoryType)==0){Vis_4_SelectedTBL_Raw()
    }else if (input$Vis4_Pie_CategoryType=="Surveys"){
      if(length(input$Vis4_Pie_Metrics_to_Sum)==0){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_Pie_Metrics_to_Sum)
      }
    } else if (input$Vis4_Pie_CategoryType=="Metrics"){
      if(length(input$Vis4_Pie_Metrics)==0){
        Vis_4_SelectedTBL_Raw()
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          drop_na(input$Vis4_Pie_Metrics)
      }
    } 
  }
}) 
  
    
    Vis_4_SurveyWarnTBL<-reactive({
      req(Vis_4_WarningData())
     
      NonCreel_Retained<-if(input$NonCreel_Vis_4_Switch==TRUE){
        Vis_4_WarningData()%>%
          filter(.,Survey_Type=="Creel Survey")%>%
          select(Survey_ID)
        }else{
            Vis_4_WarningData()%>%
              select(Survey_ID)
        }

      Timing_Retained<-if(input$UnkTiming_Vis_4_Switch==TRUE){
        Vis_4_WarningData()%>%
          filter(.,!Timing_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Vis_4_WarningData()%>%
              select(Survey_ID)
        }

      Location_Retained<-if(input$UnkLocation_Vis_4_Switch==TRUE){
        Vis_4_WarningData()%>%
          filter(.,!Location_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Vis_4_WarningData()%>%
              select(Survey_ID)
        }

      Extent_Retained<-if(input$UnkExtent_Vis_4_Switch==TRUE){
        Vis_4_WarningData()%>%
          filter(.,!Extent_Warn%in%c("Unknown","Uncertain"))%>%
          select(Survey_ID)
        }else{
            Vis_4_WarningData()%>%
              select(Survey_ID)
        }

      FocalTaxa_Retained<-if(input$FocSpecies_Vis_4_Switch==TRUE){
        Vis_4_WarningData()%>%
          filter(.,Focal_Species==c("All"))%>%
          select(Survey_ID)
        }else{
            Vis_4_WarningData()%>%
              select(Survey_ID)
        }
      
       
        Vis_4_Survey_Filt<-NonCreel_Retained%>%
          semi_join(.,Timing_Retained,by='Survey_ID')%>%
          semi_join(.,Location_Retained,by='Survey_ID')%>%
          semi_join(.,Extent_Retained,by='Survey_ID')%>%
          semi_join(.,FocalTaxa_Retained,by='Survey_ID')%>%
          droplevels()

    return(Vis_4_Survey_Filt)

    })   
   
   Vis_4_TaxaWarnTBL<-reactive({
      req(Vis_4_SelectedTBL_Raw())
     
      Vis4UnattributedSurveys_Retained<-if(is.null(Vis4_UnattributedFishTaxa())){
        Vis_4_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$UnFish_Vis_4_Switch==TRUE){
        Vis_4_SelectedTBL_Raw()%>%
        anti_join(Vis4_UnattributedFishTaxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      Vis4IncompleteSurveys_Retained<-if(is.null(Vis4_IncompleteAttributedFishTaxa())){
        Vis_4_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$InFishGroup_Vis_4_Switch==TRUE){
        Vis_4_SelectedTBL_Raw()%>%
        anti_join(Vis4_IncompleteAttributedFishTaxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      Vis4UnattributedTargetSurveys_Retained<-if(is.null(Vis4_UnattributedTarget_Taxa())){
        Vis_4_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$UnTarget_Vis_4_Switch==TRUE){
        Vis_4_SelectedTBL_Raw()%>%
        anti_join(Vis4_UnattributedTarget_Taxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }

      Vis4IncompleteTargetSurveys_Retained<-if(is.null(Vis4_IncompleteAttributedTarget_Taxa())){
        Vis_4_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }else if(input$InTargetGroup_Vis_4_Switch==TRUE){
        Vis_4_SelectedTBL_Raw()%>%
        anti_join(Vis4_IncompleteAttributedTarget_Taxa(),by='Survey_ID')%>%
          select(Survey_ID)
      } else {
        Vis_4_SelectedTBL_Raw()%>%
          select(Survey_ID)
      }
       
        Vis_4_Survey_Filt<-Vis4UnattributedSurveys_Retained%>%
          semi_join(.,Vis4IncompleteSurveys_Retained,by='Survey_ID')%>%
          semi_join(.,Vis4UnattributedTargetSurveys_Retained,by='Survey_ID')%>%
          semi_join(.,Vis4IncompleteTargetSurveys_Retained,by='Survey_ID')%>%
          droplevels()

    return(Vis_4_Survey_Filt)

    })   
   
Vis_4_SelectedTBL<-reactive({
  req(Vis_4_SurveyWarnTBL())
  req(Vis_4_TaxaWarnTBL())
  req(Vis_4_Selected_NA_TBL())
  
  Vis_4_Selected_NA_TBL()%>%
    semi_join(.,Vis_4_SurveyWarnTBL(),by='Survey_ID')%>%
    semi_join(.,Vis_4_TaxaWarnTBL(),by='Survey_ID')%>%
    droplevels()
  
})  

  
  
   

Vis_4_Input_Variables<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
     if(input$SelectVis4=="Nothing Selected"){
       
     }else if(input$SelectVis4=="Map"){
       if(is.null(input$Vis4_Map_CreelDisplayType)){
         
       }else if(input$Vis4_Map_CreelDisplayType=="Scaled Color"){
           if(input$Vis4_MapDisplayField=="Nothing Selected"){
             
           } else {
              input$Vis4_MapDisplayField
           }
       }else if(input$Vis4_Map_CreelDisplayType=="Scaled Size"){
           if(input$Vis4_MapDisplayField_Size=="Nothing Selected"){
             
           } else {
           input$Vis4_MapDisplayField_Size
           }
       }else if(input$Vis4_Map_CreelDisplayType=="Both"){
           if(input$Vis4_MapDisplayField=="Nothing Selected"||input$Vis4_MapDisplayField_Size=="Nothing Selected"){
             
           } else {
           c(input$Vis4_MapDisplayField,input$Vis4_MapDisplayField_Size)
           }
       } 
     }else if (input$SelectVis4=="Line Plot"){
       if(length(input$Vis4_Line_Number)==0){
         
       }else if (input$Vis4_Line_Number=="1"){
         if(input$Vis4_LineY1=="Nothing Selected"){
          
         } else {
         input$Vis4_LineY1
         }
       } else if(input$Vis4_Line_Number=="2"){
         if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"){
           
         } else {
       c(input$Vis4_LineY1,
         input$Vis4_LineY2)
         }
       }else if(input$Vis4_Line_Number=="3"){
         if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"||input$Vis4_LineY3=="Nothing Selected"){
           
         } else {
       c(input$Vis4_LineY1,
         input$Vis4_LineY2,
         input$Vis4_LineY3)
       }
       }else if(input$Vis4_Line_Number=="4"){
         if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"||input$Vis4_LineY3=="Nothing Selected"||input$Vis4_LineY4=="Nothing Selected"){
           
         } else {
       c(input$Vis4_LineY1,
         input$Vis4_LineY2,
         input$Vis4_LineY3,
         input$Vis4_LineY4)
       }
       }else if(input$Vis4_Line_Number=="5"){
         if(input$Vis4_LineY1=="Nothing Selected"||input$Vis4_LineY2=="Nothing Selected"||input$Vis4_LineY3=="Nothing Selected"||input$Vis4_LineY4=="Nothing Selected"||input$Vis4_LineY5=="Nothing Selected"){
           
         } else {
       c(input$Vis4_LineY1,
         input$Vis4_LineY2,
         input$Vis4_LineY3,
         input$Vis4_LineY4,
         input$Vis4_LineY5)
       }
        }
     }else if (input$SelectVis4=="Scatter Plot"){
       if(input$Vis4_ScatterX=="Nothing Selected"||input$Vis4_ScatterY=="Nothing Selected"){
         
       } else {
       c(input$Vis4_ScatterX,
         input$Vis4_ScatterY)
       }
     }else if (input$SelectVis4=="Bar Chart"){
       if(length(input$Vis4_Bar_Number)==0){
         
       }else if (input$Vis4_Bar_Number=="1"){
         if(input$Vis4_BarY1=="Nothing Selected"){
           
         } else {
         c(input$Vis4_BarY1)
         }
       } else if(input$Vis4_Bar_Number=="2"){
         if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"){
           
         } else {
       c(input$Vis4_BarY1,
         input$Vis4_BarY2)
         }
       }else if(input$Vis4_Bar_Number=="3"){
         if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"||input$Vis4_BarY3=="Nothing Selected"){
           
         } else {
       c(input$Vis4_BarY1,
         input$Vis4_BarY2,
         input$Vis4_BarY3)
       }
       }else if(input$Vis4_Bar_Number=="4"){
         if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"||input$Vis4_BarY3=="Nothing Selected"||input$Vis4_BarY4=="Nothing Selected"){
           
         } else {
       c(input$Vis4_BarY1,
         input$Vis4_BarY2,
         input$Vis4_BarY3,
         input$Vis4_BarY4)
       }
       }else if(input$Vis4_Bar_Number=="5"){
         if(input$Vis4_BarY1=="Nothing Selected"||input$Vis4_BarY2=="Nothing Selected"||input$Vis4_BarY3=="Nothing Selected"||input$Vis4_BarY4=="Nothing Selected"||input$Vis4_BarY5=="Nothing Selected"){
           
         } else {
       c(input$Vis4_BarY1,
         input$Vis4_BarY2,
         input$Vis4_BarY3,
         input$Vis4_BarY4,
         input$Vis4_BarY5)
       }
        }
     }else if (input$SelectVis4=="Pie Chart"){
       if(length(input$Vis4_Pie_CategoryType)==0){
       }else if (input$Vis4_Pie_CategoryType=="Surveys"){
         if(length(input$Vis4_Pie_Metrics_to_Sum)==0){
           
         } else {
           input$Vis4_Pie_Metrics_to_Sum
         }
       } else if (input$Vis4_Pie_CategoryType=="Metrics"){
         if(length(input$Vis4_Pie_Metrics)==0){
           
         } else {
           input$Vis4_Pie_Metrics
         }
       } 
     }
   })

   

  
  Vis4InputFishTaxa<-reactive({
      Fish_Output<-trimws(sub(paste(FishMetricPick(), collapse = "|"), "", Vis_4_Input_Variables()[str_detect(Vis_4_Input_Variables(),paste(FishMetricPick(),collapse="|"))]) )
      return(Fish_Output)
  })
  
  Vis4InputFishTaxa_NoGroup<-reactive({
    req(Vis4InputFishTaxa())
    Vis4InputFishTaxa()%>%
      .[.!=GrpPick()]
  })
 
  Vis4InputTarget_Taxa<-reactive({
      Target_Output<-trimws(sub(paste(TargetMetricPick(), collapse = "|"), "", Vis_4_Input_Variables()[str_detect(Vis_4_Input_Variables(),paste(TargetMetricPick(),collapse="|"))]) )
      return(Target_Output)
  }) 
  
  Vis4InputTarget_Taxa_NoGroup<-reactive({
    req(Vis4InputTarget_Taxa())
    Vis4InputTarget_Taxa()%>%
      .[.!=AngPref_GrpPick()]
  })

    Vis4_UnattributedFishTaxa<-reactive({
     if(length(Vis4InputFishTaxa())>0){
       return(
         Vis_4_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(UnattributedTaxa)%>%
       filter(Taxa%in%Vis4InputFishTaxa())%>%
       select(!(UnattributedTaxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
      
  Vis4_PartiallyAttributedFishTaxa<-reactive({
      if(length(Vis4InputFishTaxa())>0){
       return(
         Vis_4_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(PartiallyAttributedTaxa)%>%
       filter(Taxa%in%Vis4InputFishTaxa())%>%
       select(!(PartiallyAttributedTaxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
   
   Vis4_IncompleteAttributedFishTaxa<-reactive({
      if(length(Vis4InputFishTaxa())>0){
       return(
         Vis_4_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(IncompleteAttributedTaxa)%>%
       filter(Taxa%in%Vis4InputFishTaxa())%>%
       select(!(Incomplete_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })

       Vis4_UnattributedTarget_Taxa<-reactive({
     if(length(Vis4InputTarget_Taxa())>0){
       return(
         Vis_4_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(UnattributedTarget_Taxa)%>%
       filter(Taxa%in%Vis4InputTarget_Taxa())%>%
       select(!(UnattributedTarget_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
      
  Vis4_PartiallyAttributedTarget_Taxa<-reactive({
      if(length(Vis4InputTarget_Taxa())>0){
       return(
         Vis_4_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(PartiallyAttributedTarget_Taxa)%>%
       filter(Taxa%in%Vis4InputTarget_Taxa())%>%
       select(!(PartiallyAttributedTarget_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })
   
   Vis4_IncompleteAttributedTarget_Taxa<-reactive({
      if(length(Vis4InputTarget_Taxa())>0){
       return(
         Vis_4_SelectedTBL_Raw()%>%
       select(Survey_ID,State,Year,Waterbody_Name_Unique)%>%
       left_join(IncompleteAttributedTarget_Taxa)%>%
       filter(Taxa%in%Vis4InputTarget_Taxa())%>%
       select(!(Incomplete_Target_Taxa))%>%
       unique()
       )
     } else{
       return(NULL)
     }
     })


    Vis4_Retained_Surveys<-reactive({
      
      Vis_4_SelectedTBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
    })
    
    Vis4_Dropped_Surveys<-reactive({
      
      Vis_4_SelectedTBL_Raw()%>%anti_join(Vis_4_SelectedTBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))%>%
        unique()
    })


   output$Vis4_Dropped_TBL<-DT::renderDataTable(
    Vis4_Dropped_Surveys(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

  output$Vis4_Retained_TBL<-DT::renderDataTable(
    Vis4_Retained_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
   Vis_4_Dropped_NA_Surveys<-reactive({
     req(Vis_4_Selected_NA_TBL(),
         Vis_4_SelectedTBL_Raw()
         )
     Vis_4_SelectedTBL_Raw()%>%
       anti_join(Vis_4_Selected_NA_TBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })
   
   Vis_4_Dropped_NA_Warn_Surveys<-reactive({
     req(Vis_4_Dropped_NA_Surveys())
     as.list(as.character(unique(Vis_4_Dropped_NA_Surveys()$Survey_ID)))
     })
   
   Vis_4_Dropped_NA_Warn_Surveys_Count<-reactive({
     length(Vis_4_Dropped_NA_Warn_Surveys())
     })
   
    Vis_4_Retained_NA_Surveys<-reactive({
      req(Vis_4_Selected_NA_TBL())
     Vis_4_Selected_NA_TBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })

   Vis_4_Retained_NA_Warn_Surveys<-reactive({
     req(Vis_4_Retained_NA_Surveys())
     as.list(as.character(unique(Vis_4_Retained_NA_Surveys()$Survey_ID)))
     })
   
   Vis_4_Retained_NA_Warn_Surveys_Count<-reactive({
     req(Vis_4_Retained_NA_Warn_Surveys())
     length(Vis_4_Retained_NA_Warn_Surveys())
     })
   
   output$Vis_4_Dropped_NA_Warning<-renderText({
    if(length(Vis_4_Dropped_NA_Warn_Surveys())>0){
      return(paste(as.character(actionLink(inputId = "Vis_4_NA_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Visualization input fields contain NA values. Surveys containing NA for a visualization input are automatically dropped. </span><span style=\"color:red;font-weight:bold\">", Vis_4_Dropped_NA_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been dropped;</><span style=\"color:green;font-weight:bold\">",Vis_4_Retained_NA_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been retained</>"))
  }else {
  } 
  })
      output$Vis_4_Survey_Char_Drop<-renderText({
        return(paste(as.character(actionLink(inputId = "Vis_4SurveyDropCharacteristicsTip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black;font-weight:bold\">Survey Characteristic Drops </span>"))
      })
      
      output$Vis_4_Taxa_Atr_Drop<-renderText({
        return(paste(as.character(actionLink(inputId = "Vis_4TaxaAttributionDropTip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black;font-weight:bold\">Taxa Attribution Issue Drops </span>"))
      })
  
  observeEvent(input$Vis_4_NA_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Dropped NA Inputs"),
            h4(strong("Selected surveys contain 'NA' values for inputs which are automatically dropped: ")),
            h4("Visualizations are unable to accomodate 'NA' values for any inputs and they are therefore automatically dropped."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
   
   output$Vis_4_Dropped_NA_TBL_Pop<-reactive({
      
      length(Vis_4_Dropped_NA_Warn_Surveys())
      })
    outputOptions(output,'Vis_4_Dropped_NA_TBL_Pop',suspendWhenHidden=FALSE)
   
   output$Vis_4_Dropped_NA_TBL<-DT::renderDataTable(
    Vis_4_Dropped_NA_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
  output$Vis_4_Retained_NA_TBL<-DT::renderDataTable(
    Vis_4_Retained_NA_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
  

   Vis_4_Dropped_All_Surveys<-reactive({
      
     req(Vis_4_SelectedTBL(),
         Vis_4_SelectedTBL_Raw()
         )
     
     Vis_4_SelectedTBL_Raw()%>%
       anti_join(Vis_4_SelectedTBL(),by=c("Survey_ID"))%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })
   
   
   Vis_4_Dropped_All_Warn_Surveys<-reactive({
     req(Vis_4_Dropped_All_Surveys())
     as.list(as.character(unique(Vis_4_Dropped_All_Surveys()$Survey_ID)))
     })
   
   Vis_4_Dropped_All_Warn_Surveys_Count<-reactive({
     length(Vis_4_Dropped_All_Warn_Surveys())
     })
   
    Vis_4_Retained_All_Surveys<-reactive({
      req(Vis_4_SelectedTBL())
     Vis_4_SelectedTBL()%>%
       select(c("Survey_ID","State","Year","Waterbody_Name_Unique"))
   })

   Vis_4_Retained_All_Warn_Surveys<-reactive({
     req(Vis_4_Retained_All_Surveys())
     as.list(as.character(unique(Vis_4_Retained_All_Surveys()$Survey_ID)))
     })
   
   Vis_4_Retained_All_Warn_Surveys_Count<-reactive({
     req(Vis_4_Retained_All_Warn_Surveys())
     length(Vis_4_Retained_All_Warn_Surveys())
     })
   
   output$Vis_4_Dropped_All_Warning<-renderText({
    if(length(Vis_4_Dropped_All_Warn_Surveys())>0){
      return(paste(as.character(actionLink(inputId = "Vis_4_Dropped_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Surveys containing NA for a visualization inputs or user-selected drop characteristics have been dropped. </span><span style=\"color:red;font-weight:bold\">", Vis_4_Dropped_All_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been dropped;</><span style=\"color:green;font-weight:bold\">",Vis_4_Retained_All_Warn_Surveys_Count(),"</span><span style=\"color:black\"> surveys have been retained</>"))
  }else {
  } 
  })

  
  observeEvent(input$Vis_4_Dropped_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Dropped Surveys"),
            h4(strong("Selected surveys contain 'NA' values for inputs or characteristics which match user selected 'Drop' criteria from switches above: ")),
            h4("Visualizations are unable to accomodate 'NA' values for any inputs and they are therefore automatically dropped."),
            h4("Surveys sometimes contain undesireable attributes or contain input taxa with attribution issues which lead to the user to drop them from the visualizations by switching the toggles above."),
            h4("This warning reports the total number of surveys which were selected to be included in the visualization as well as the number of surveys which have been dropped either due to NA inputs, undesireable survey characteristics, or the presence of input taxa attribution issues."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$Vis_4SurveyDropCharacteristicsTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Drop Based on Survey Characteristics"),
            h4(strong("Undesireable Survey Characteristics: ")),
            h4("Surveys occasionally contain undesireable characteristics which may result in a user wishing to exclude/drop them from thier visualizations."),
            h4("By toggling the switches in this section users can decide whether they wish to retain or drop surveys with the following characteristcis."),
            h4(strong("Non-Creel Approaches: "), "Drops surveys which are not classified as 'Creel Survey'. These typically include things like Mail/Phone/Internet Surveys."),
            h4(strong("Unknown/Uncertain Timing: "), "Drops surveys for which are missing start and/or end dates"),
            h4(strong("Unknown/Uncertain Location: "), "Drops surveys for which the location of the waterbody being surveyed can not be confirmed."),
            h4(strong("Unknown/Uncertain Spatial Extent: "), "Drops surveys for which the spatial extent of a survey can not be confirmed."),
            h4(strong("Focal Species: "), "Drops surveys which focus on only a single or group of taxa rather than the entire community."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$Vis_4TaxaAttributionDropTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),title = strong("Drop Based on Taxa Attribution Issues"),
            h4(strong("Taxa attribution issues: ")),
            h4("Surveys occasionally contain issues with the attribution of values to taxa."),
            h4("By toggling the switches in this section users can decide whether they wish to retain or drop surveys with the following characteristics."),
            h4(strong("Unattributed Input Fish Taxa: "), "Drops surveys for which one of the visualization inputs contains a fish taxa which cannot be attributed 
               (see tip at unattributed taxa warning in the warning panel for more details). Note: For visualizations wholly unattributed taxa are 'Null' so they 
               are dropped automatically, however partially attributed data are contain both attributed values and potentially unattributed values and therefore require 
               toggling of this switch to drop in order to remove."),
            h4(strong("Incomplete Input Fish Groups: "), "Drops surveys for which one of the visualization inputs contains a fish groups which have incomplete attribution 
               (see tip at incomplete group warning in the warning panel for more details)."),
            h4(strong("Unattributed Input Target Taxa: "), "Drops surveys for which one of the visualization inputs contains a target taxa which cannot be attributed 
               (see tip at unattributed target taxa warning in the warning panel for more details). Note: For visualizations wholly unattributed target taxa are 'Null' so they 
               are dropped automatically, however partially attributed data are contain both attributed values and potentially unattributed values and therefore require 
               toggling of this switch to drop in order to remove."),
            h4(strong("Incomplete Input Target Groups: "), "Drops surveys for which one of the visualization inputs contains a target groups which have incomplete attribution 
               (see tip at incomplete group warning in the warning panel for more details)."),
        easyClose = TRUE
        ))
    },ignoreInit=TRUE)  
  
  observeEvent(input$Vis_4WarningTableTip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("View Warning Tables"),
            h4(strong("Select whether you wish to view tables which summarize any of the listed warning attributes: ")),
            h4(strong("Retained Surveys: "), "Table showing surveys which were retained after surveys which contained 'NA' in at least one visualization input or contained undesireable survey characteristics or input taxa attribution issues were dropped."),
            h4(strong("Dropped Surveys: "), "Table showing surveys which were dropped due to the presence of an 'NA' in at least one visualization input or undesireable survey characteristics or taxa attribution issues."),
            h4(strong("Retained NA Surveys: "), "Table showing surveys which were retained after surveys which contained 'NA' in at least one visualization input were dropped."),
            h4(strong("Dropped NA Surveys: "), "Table showing surveys which were dropped due to the presence of an 'NA' in at least one visualization input."),
            h4(strong("Non-Creel Approaches: "), "Table showing surveys which used any approach not classified as a 'Creel Survey'."),
            h4(strong("Unknown/Uncertain Timing: "), "Table showing surveys which were flagged ashaving unknown or uncertain timing."),
            h4(strong("Unknown/Uncertain Location: "), "Table showing surveys which were flagged ashaving unknown or uncertain locations."),
            h4(strong("Unknown/Uncertain Spatial Extent: "), "Table showing surveys which were flagged ashaving unknown or uncertain spatial extents."),
            h4(strong("Focal Species: "), "Table showing surveys which were conducted based on a focal species rather than the full community."),
            h4(strong("Unattributed Taxa: "), "Table showing records containing unattributed input taxa."),
            h4(strong("Partially Attributed Taxa: "), "Table showing records containing partially attributed input taxa."),
            h4(strong("Incomplete Groups: "), "Table showing records containing incomplete attribution of input groups."),
            h4(strong("Unattributed Target Taxa: "), "Table showing records containing unattributed input target taxa."),
            h4(strong("Partially Attributed Target Taxa: "), "Table showing records containing partially attributed input target taxa."),
            h4(strong("Incomplete Target Groups: "), "Table showing records containing incomplete attribution of input target groups."),
        easyClose = TRUE
        ))
    },ignoreInit=TRUE)
   
   output$Vis_4_Dropped_All_TBL<-DT::renderDataTable(
    Vis_4_Dropped_All_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
  output$Vis_4_Retained_All_TBL<-DT::renderDataTable(
    Vis_4_Retained_All_Surveys(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
  
   output$Vis_4_FishTaxaHeading<-renderText({
    if((length(Vis_4UnattributedTaxa_Warn_Taxa())>0)||
       (length(Vis_4IncompleteAttributedTaxa_Warn_Taxa())>0)||
       (nchar(Vis_4_Overlap_Warn())>1)){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Fish Taxa Input Attribution Issues: </span></h4>"))
  }else {

  }
  })  
   
   output$Vis_4_AngPrefTaxaHeading<-renderText({
    if((length(Vis_4UnattributedTarget_Taxa_Warn_Taxa())>0)||
       (length(Vis_4IncompleteAttributedTarget_Taxa_Warn_Taxa())>0)||
       (nchar(TargetVis_4_Overlap_Warn())>1)
       ){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Angler Preference Taxa Input Attribution Issues: </span></h4>"))
  }else {

  }
  })  
   
  Vis_4UnattributedTaxa_Count<-reactive({
    if(is.null(Vis4_UnattributedFishTaxa())){
      return(NULL)
    }else{
     Vis4_UnattributedFishTaxa()%>%
     count(Taxa)%>%
     unite(Unattributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_4UnattributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_4UnattributedTaxa_Count()$Unattributed_Records))
     })
   
   Vis_4UnattributedTaxa_Warn_Vals<-reactive({
     paste(Vis_4UnattributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_4_UnattributedFishTaxaWarning<-renderText({
    if(length(Vis_4UnattributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_4_Unattributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include unattributed taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_4UnattributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })

  
  observeEvent(input$Vis_4_Unattributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unattributed Fish Taxa"),
            h4(strong("Selected surveys contain unattributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The list identifies which taxa have unattributed records in the dataset and how 
               many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


   output$Vis_4_UnattributedTBL_Pop<-reactive({
      length(Vis_4UnattributedTaxa_Warn_Taxa())
      })
   
    outputOptions(output,'Vis_4_UnattributedTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis4_UnattributedFishTaxa_TBL<-DT::renderDataTable(
    Vis4_UnattributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Attributed Taxa Suggestions ###
    Vis_4_Attributed_Gain<-reactive({
    if(is.null(Vis4_UnattributedFishTaxa())){return(NULL)}else{
     Vis4_UnattributedFishTaxa()%>%
     count(Attributed_Taxa)%>%
     unite(GainedRecords,"Attributed_Taxa","n",sep="-")
    }
     })

   Vis_4AttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_4_Attributed_Gain()$GainedRecords))
     })
   
   Vis_4AttributedTaxa_Warn_Vals<-reactive({
     paste(Vis_4AttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_4_AttributedFishTaxaWarning<-renderText({
    if(length(Vis_4UnattributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_4_Attributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Consider replacing unattributed and partially attributed taxa with attributed taxa: </span><span style=\"color:green;font-weight:bold\">", Vis_4AttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_4_Attributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Alternative Attributed Fish Taxa"),
            h4(strong("Alternatives to unattributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The species in this list show the taxa which were originall attributed 
               in the creel survey (ie. what level the taxa was initially recorded at) and the number of records for which this is the case."),
            h4(strong("Recommendation: "),"If possible replace the unattributed taxa with the recommended attributed taxa. Doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


# Partially Attributed Species #
   
   Vis_4PartiallyAttributedTaxa_Count<-reactive({
    if(is.null(Vis4_PartiallyAttributedFishTaxa())){
      return(NULL)
    } else {
     Vis4_PartiallyAttributedFishTaxa()%>%
     count(Taxa)%>%
     unite(PartiallyAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_4PartiallyAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_4PartiallyAttributedTaxa_Count()$PartiallyAttributed_Records))
     })
   
   Vis_4PartiallyAttributedTaxa_Warn_Vals<-reactive({
     paste(Vis_4PartiallyAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_4_PartiallyAttributedFishTaxaWarning<-renderText({
    if(length(Vis_4PartiallyAttributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_4_PartiallyAttributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include partially attributed taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_4PartiallyAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_4_PartiallyAttributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Partially Attributed Fish Taxa"),
            h4(strong("Selected surveys contain partially attributed fish taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). Occasionally a survey may record data across multiple overlapping taxanomic 
               levels creating partially attributed taxa. In these cases a survey may contain values attributed to both 'Black Crappie' (species) and 'Crappie' (genus). In thise case the value attributed to 'Black 
               Crappie' represents some, but not necessarily all, of the 'Black Crappie' in the survey as some of the values associated with 'Crappie' (genus) may actually also be 'Black Crappie'. Because of this 
               surveys which include both 'Black Crappie' and  'Crappie' attributions are considered partial attributions (ie. we can not fully attribute the 'Black Crappie' values). The list identifies which taxa have 
               partially attributed records in the dataset and how many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed or partially attributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip: "), "'Partially Attributed' taxa have both attributed and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset. Otherwise 
               partially attributed records will be included in the dataset but only include the directly attributed values without consideration of potential missing values from the unattributed portion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)


   output$Vis4_PartiallyAttributedTBL_Pop<-reactive({
      
      length(Vis_4PartiallyAttributedTaxa_Warn_Taxa())
      })
    outputOptions(output,'Vis4_PartiallyAttributedTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis4_PartiallyAttributedFishTaxa_TBL<-DT::renderDataTable(
    Vis4_PartiallyAttributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Incomplete Groups #
      
     Vis_4IncompleteAttributedTaxa_Count<-reactive({
    if(is.null(Vis4_IncompleteAttributedFishTaxa())){
      return(NULL)
    }else{
     Vis4_IncompleteAttributedFishTaxa()%>%
     count(Taxa)%>%
     unite(IncompleteAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_4IncompleteAttributedTaxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_4IncompleteAttributedTaxa_Count()$IncompleteAttributed_Records))
     })
   
   Vis_4IncompleteAttributedTaxa_Warn_Vals<-reactive({
     paste(Vis_4IncompleteAttributedTaxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_4_IncompleteAttributedFishTaxaWarning<-renderText({
    if(length(Vis_4IncompleteAttributedTaxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_4_IncompleteAttributed_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include groups with incomplete attribution of taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_4IncompleteAttributedTaxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_4_IncompleteAttributed_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Incomplete Attribution of Fish Taxa"),
            h4(strong("Selected surveys contain incompletely attributed fish groups in inputs: ")),
            h4("Values for groups are typically generated either as a direct attribution of the group in the survey (ie. 'Panfish' estimates recorded directly), or by summing values for all component members 
            (ie. 'Trout' estimate generated by adding values from 'Rainbow Trout', 'Brook Trout', and 'Brown Trout'). Because groups are not monophyletic there can be cases when a group value may be incompletely 
            attributed due to component taxa which span within and outside group status (ie. a survey containing values attributed to the genus' 'Salvelinus' and 'Onchorynchus', while all values for 'Salvelinus' can 
            be (and therefore are) attributed to 'Trout', 'Onchorynchus'  includes both 'Trout' (Rainbow Trout, Cutthroat Trout...) and 'Non-Trout' (Chinook Salmon, Coho Salmon...), and therefore can not be attributed to 'Trout' 
            although some portion of those values may actually be 'Trout'.). In this case the records for 'Trout' are identified as 'Incomplete' meaning that some taxa are present within the record which may or may not be attributable 
            to the selected 'Group'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping incompletely attributed fish group records by toggling the 'Incomplete Input Fish Groups'  
               switch from 'Retained' to 'Dropped'."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)



   output$Vis_4_IncompleteTBL_Pop<-reactive({
      
      length(Vis_4IncompleteAttributedTaxa_Warn_Taxa())
      })
    outputOptions(output,'Vis_4_IncompleteTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis4_IncompleteAttributedFishTaxa_TBL<-DT::renderDataTable(
    Vis4_IncompleteAttributedFishTaxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )



   ### Overlapping Taxa Selection ###

FamilyVis_4_Selected<-reactive({
  TaxaTable%>%filter(Family %in% Vis4InputFishTaxa())%>%select(Family)%>%unique()
  })
GenusVis_4_Selected<-reactive({
      
  TaxaTable%>%filter(Genus %in% Vis4InputFishTaxa())%>%select(Family,Genus)%>%unique()
  })
SpeciesVis_4_Selected<-reactive({
      
  TaxaTable%>%filter(Species %in% Vis4InputFishTaxa())%>%select(Family,Genus,Species)%>%unique()
  })
SubsVis_4_Selected<-reactive({
      
  TaxaTable%>%filter(Subspecies_Variants %in% Vis4InputFishTaxa())%>%select(Family,Genus,Species,Subspecies_Variants)%>%unique()
  })


Genus_Family_Vis_4_Overlap<-reactive({
      
  req(GenusVis_4_Selected())
  req(FamilyVis_4_Selected())
  
  GenusVis_4_Selected()%>%
  inner_join(FamilyVis_4_Selected(),by='Family')%>%
  select(Family,Genus)%>%
  unite(Overlaps,"Family","Genus",sep=" overlaps ")})

Species_Family_Vis_4_Overlap<-reactive({
      
  req(SpeciesVis_4_Selected())
  req(FamilyVis_4_Selected())
  
  SpeciesVis_4_Selected()%>%
  inner_join(FamilyVis_4_Selected(),by='Family')%>%
  select(Family,Species)%>%
  unite(Overlaps,"Family","Species",sep=" overlaps ")})

Species_Genus_Vis_4_Overlap<-reactive({
      
  req(SpeciesVis_4_Selected())
  req(GenusVis_4_Selected())
  
  SpeciesVis_4_Selected()%>%
  inner_join(GenusVis_4_Selected(),by='Genus')%>%
  select(Genus,Species)%>%
  unite(Overlaps,"Genus","Species",sep=" overlaps ")})

Subspecies_Family_Vis_4_Overlap<-reactive({
  req(SubsVis_4_Selected())
  req(FamilyVis_4_Selected())
  
  SubsVis_4_Selected()%>%
  inner_join(FamilyVis_4_Selected(),by='Family')%>%
  select(Family,Subspecies_Variants)%>%
  unite(Overlaps,"Family","Subspecies_Variants",sep=" overlaps ")})

Subspecies_Genus_Vis_4_Overlap<-reactive({
      
  req(SubsVis_4_Selected())
  req(GenusVis_4_Selected())
  
  SubsVis_4_Selected()%>%
  inner_join(GenusVis_4_Selected(),by='Genus')%>%
  select(Genus,Subspecies_Variants)%>%
  unite(Overlaps,"Genus","Subspecies_Variants",sep=" overlaps ")})

Subspecies_Species_Vis_4_Overlap<-reactive({
      
  req(SubsVis_4_Selected())
  req(SpeciesVis_4_Selected())
  
  SubsVis_4_Selected()%>%
  inner_join(SpeciesVis_4_Selected(),by='Species')%>%
  select(Species,Subspecies_Variants)%>%
  unite(Overlaps,"Species","Subspecies_Variants",sep=" overlaps ")})

Group_Taxa_Vis_4_Overlap<-reactive({
      
  req(input$AF_SharedData=="No"||is.null(input$AF_SharedData))
  req(Vis4InputFishTaxa())
  
  GroupTaxa%>%
  filter(Group %in% Vis4InputFishTaxa())%>%
  filter(Taxa %in% Vis4InputFishTaxa_NoGroup())%>%
  unite(Overlaps,"Group","Taxa",sep=" overlaps ")%>%
  select(Overlaps)})

Vis_4Overlaps<-reactive({
  PH<-as.list(bind_rows(Genus_Family_Vis_4_Overlap(),Species_Family_Vis_4_Overlap(),Species_Genus_Vis_4_Overlap(),Subspecies_Family_Vis_4_Overlap(),Subspecies_Genus_Vis_4_Overlap(),Subspecies_Species_Vis_4_Overlap(),Group_Taxa_Vis_4_Overlap()))
return(PH)
})

   Vis_4OverlapTaxa_Warn<-reactive({
     as.list(as.character(unique(Vis_4Overlaps()$Overlaps)))
     })
   
   Vis_4_Overlap_Warn<-reactive({
     paste(Vis_4OverlapTaxa_Warn(),collapse=" & ")
     })

   output$Vis_4_OverlapFishWarning<-renderText({
    if(nchar(Vis_4_Overlap_Warn())>1){
      return(paste(as.character(actionLink(inputId = "Vis_4_Overlap_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input taxa include overlapping value attribution: </span><span style=\"color:red;font-weight:bold\">", Vis_4_Overlap_Warn(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_4_Overlap_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Overlap of Input Fish Taxa"),
            h4(strong("Selected fish inputs contain overlapping taxa: ")),
            h4("Taxa can be attributed at multiple, overlapping taxanomic levels and therefore the associated values can result in overlap or double counting (ie. a user selects both 
               'Bluegill' (Species) and 'Lepomis' (Genus) harvest estimates, the harvest estimate attributable to 'Bluegill'(10) is also included within 'Lepomis'(30), meaning of the 30 'Lepomis' individuals harvested 10 of them are the 
               same as the 10 recorded in Bluegill, while 20 of them are from different 'Lepomis' taxa."),
            h4(strong("Recommendation: "),"We suggest avoiding overlapping taxa whereever possible to avoid double, triple, etc. counting of values. In order to do this select only non-overlapping taxa for inputs."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)


  Vis_4UnattributedTarget_Taxa_Count<-reactive({
    if(is.null(Vis4_UnattributedTarget_Taxa())){
      return(NULL)
    }else{
     Vis4_UnattributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(Unattributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_4UnattributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_4UnattributedTarget_Taxa_Count()$Unattributed_Records))
     })
   
   Vis_4UnattributedTarget_Taxa_Warn_Vals<-reactive({
     paste(Vis_4UnattributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_4_UnattributedTarget_TaxaWarning<-renderText({
    if(length(Vis_4UnattributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_4_Unattributed_Target_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include unattributed target taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_4UnattributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_4_Unattributed_Target_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Unattributed Target Taxa"),
            h4(strong("Selected surveys contain unattributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The list identifies which taxa have unattributed records in the dataset and how 
               many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Fish Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip"), "Because unattributed taxa are not attributed they are stored as 'Null' values in the dataset and are automatically dropped. However 'Partially Attributed' taxa have both attributed 
               and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   # Attributed Taxa Suggestions ###
    Vis_4_Attributed_TargetGain<-reactive({
      if(is.null(Vis4_UnattributedTarget_Taxa())){
        return(NULL)
      }else{
     return(Vis4_UnattributedTarget_Taxa()%>%
     count(Attributed_Target_Taxa)%>%
     unite(GainedRecords,"Attributed_Target_Taxa","n",sep="-"))
      }
     })

   Vis_4AttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_4_Attributed_TargetGain()$GainedRecords))
     })
   
   Vis_4AttributedTarget_Taxa_Warn_Vals<-reactive({paste(Vis_4AttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")})

   output$Vis_4_AttributedTarget_TaxaWarning<-renderText({
    if(nchar(Vis_4AttributedTarget_Taxa_Warn_Vals())>1){
      return(paste(as.character(actionLink(inputId = "Vis_4_AttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Consider replacing unattributed and partially attributed taxa with attributed taxa: </span><span style=\"color:green;font-weight:bold\">", Vis_4AttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$Vis_4_AttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Alternative Attributed Target Taxa"),
            h4(strong("Alternatives to unattributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). The species in this list show the taxa which were originall attributed 
               in the creel survey (ie. what level the taxa was initially recorded at) and the number of records for which this is the case."),
            h4(strong("Recommendation: "),"If possible replace the unattributed target taxa with the recommended attributed target taxa. Doing so will reduce the instances of 
               unattributed target taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however if a large number of records 
               are unattributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Vis_4_UnattributedTargetTBL_Pop<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
      length(Vis_4UnattributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Vis_4_UnattributedTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis4_UnattributedTarget_Taxa_TBL<-DT::renderDataTable(
    Vis4_UnattributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
 Vis_4PartiallyAttributedTarget_Taxa_Count<-reactive({
    if(is.null(Vis4_PartiallyAttributedTarget_Taxa())){
      return(NULL)
    } else {
     Vis4_PartiallyAttributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(PartiallyAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_4PartiallyAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_4PartiallyAttributedTarget_Taxa_Count()$PartiallyAttributed_Records))
     })
   
   Vis_4PartiallyAttributedTarget_Taxa_Warn_Vals<-reactive({
     paste(Vis_4PartiallyAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_4_PartiallyAttributedFishTarget_TaxaWarning<-renderText({
    if(length(Vis_4PartiallyAttributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_4_PartiallyAttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include partially attributed target taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_4PartiallyAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })

    observeEvent(input$Vis_4_PartiallyAttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Partially Attributed Target Taxa"),
            h4(strong("Selected surveys contain partially attributed target taxa in inputs: ")),
            h4("Taxa are classified at various levels in creel surveys ranging from subspecies to families to non-taxanomic groups such as 'Panfish'. The CreelCat dataset 
               automatically populates values at higher taxanomic levels by summing all lower level taxa (ie. estimates for 'Crappie (Genus)' are derived by summing estimates for 'Black Crappie' 
               and 'White Crappie', or for 'Trout (Group)' all component taxa can be summed 'Rainbow Trout', 'Brook Trout', 'Brown Trout'... ). However, when taxa are recorded 
               at a higher taxanomic level values are not available at lower taxanomic levels (ie. estimates attributed to 'Black Bass' can not be broken down and split into lower level 
               taxa 'Largemouth Bass', 'Smallmouth Bass', etc.). Therefore if a user selects a taxa that has been attributed at a higher taxanomic level and therefore can not be attributed 
               at the selected level those records will be identified as containing unattributed taxa (ie. User wished to view species level estimates of 'Bluegill' however surveys 
               recorded values at the genus level 'Lepomis', and therefore it is possible that some or all of the 'Lepomis' value are actually 'Bluegill' but we are unable to attribute them as such 
               since some or all of those values could be attributable to other taxa ('Redear Sunfish', 'Green Sunfish'...). Occasionally a survey may record data across multiple overlapping taxanomic 
               levels creating partially attributed taxa. In these cases a survey may contain values attributed to both 'Black Crappie' (species) and 'Crappie' (genus). In thise case the value attributed to 'Black 
               Crappie' represents some, but not necessarily all, of the 'Black Crappie' in the survey as some of the values associated with 'Crappie' (genus) may actually also be 'Black Crappie'. Because of this 
               surveys which include both 'Black Crappie' and  'Crappie' attributions are considered partial attributions (ie. we can not fully attribute the 'Black Crappie' values). The list identifies which taxa have 
               partially attributed records in the dataset and how many such records exist."),
            h4(strong("Recommendation: "),"View the  recommended replacement taxa in green below the warning, if it is possible to proceed with the recommended taxa doing so will reduce the instances of 
               unattributed taxa in the selected dataset/inputs. For example a user may wish to create a visualization related to 'Black Crappie' (Species), however a large number of records 
               are unattributed or partially attributed due to attribution at the genus level 'Crappie', a user may decide that attributing data at the genus level is sufficient and may therefore increase the number of useful 
               records by replacing 'Black Crappie' with 'Crappie'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping unattributed and partially attributed records by toggling the 'Unattributed 
               Input Target Taxa' from 'Retained' to 'Dropped'."),
            h4(strong("Tip: "), "'Partially Attributed' taxa have both attributed and potentially unattributed components and will therefore require manual toggling of the drop switch to remove them from the input dataset. Otherwise 
               partially attributed records will be included in the dataset but only include the directly attributed values without consideration of potential missing values from the unattributed portion."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Vis4_PartiallyAttributedTargetTBL_Pop<-reactive({
     req(input$CreelCatNavBar=='Visualize Data')
      length(Vis_4PartiallyAttributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Vis4_PartiallyAttributedTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis4_PartiallyAttributedTarget_Taxa_TBL<-DT::renderDataTable(
    Vis4_PartiallyAttributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )

# Incomplete Groups #
   
     Vis_4IncompleteAttributedTarget_Taxa_Count<-reactive({
    if(is.null(Vis4_IncompleteAttributedTarget_Taxa())){
      return(NULL)
    }else{
     Vis4_IncompleteAttributedTarget_Taxa()%>%
     count(Taxa)%>%
     unite(IncompleteAttributed_Records,"Taxa","n",sep="-")
    }
     })

   Vis_4IncompleteAttributedTarget_Taxa_Warn_Taxa<-reactive({
     as.list(as.character(Vis_4IncompleteAttributedTarget_Taxa_Count()$IncompleteAttributed_Records))
     })
   
   Vis_4IncompleteAttributedTarget_Taxa_Warn_Vals<-reactive({
     paste(Vis_4IncompleteAttributedTarget_Taxa_Warn_Taxa(),collapse=" & ")
     })

   output$Vis_4_IncompleteAttributedFishTarget_TaxaWarning<-renderText({
    if(length(Vis_4IncompleteAttributedTarget_Taxa_Warn_Taxa())>0){
      return(paste(as.character(actionLink(inputId = "Vis_4_IncompleteAttributedTarget_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include groups with incomplete attribution of target taxa: </span><span style=\"color:red;font-weight:bold\">", Vis_4IncompleteAttributedTarget_Taxa_Warn_Vals(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })  
   
  observeEvent(input$Vis_4_IncompleteAttributedTarget_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Incomplete Attribution of Target Taxa"),
            h4(strong("Selected surveys contain incompletely attributed target groups in inputs: ")),
            h4("Values for groups are typically generated either as a direct attribution of the group in the survey (ie. 'Panfish' estimates recorded directly), or by summing values for all component members 
            (ie. 'Trout' estimate generated by adding values from 'Rainbow Trout', 'Brook Trout', and 'Brown Trout'). Because groups are not monophyletic there can be cases when a group value may be incompletely 
            attributed due to component taxa which span within and outside group status (ie. a survey containing values attributed to the genus' 'Salvelinus' and 'Onchorynchus', while all values for 'Salvelinus' can 
            be (and therefore are) attributed to 'Trout', 'Onchorynchus'  includes both 'Trout' (Rainbow Trout, Cutthroat Trout...) and 'Non-Trout' (Chinook Salmon, Coho Salmon...), and therefore can not be attributed to 'Trout' 
            although some portion of those values may actually be 'Trout'.). In this case the records for 'Trout' are identified as 'Incomplete' meaning that some taxa are present within the record which may or may not be attributable 
            to the selected 'Group'."),
            h4(strong("Recommendation: "),"From the 'Drop Surveys' section below in the warning menu we recommend dropping incompletely attributed target group records by toggling the 'Incomplete Input Fish Groups'  
               switch from 'Retained' to 'Dropped'."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)

   output$Vis_4_IncompleteTargetTBL_Pop<-reactive({
      
      length(Vis_4IncompleteAttributedTarget_Taxa_Warn_Taxa())
      })
    outputOptions(output,'Vis_4_IncompleteTargetTBL_Pop',suspendWhenHidden=FALSE)

   output$Vis4_IncompleteAttributedTarget_Taxa_TBL<-DT::renderDataTable(
    Vis4_IncompleteAttributedTarget_Taxa(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )



   ### Overlapping Target Taxa Selection ###



TargetFamilyVis_4_Selected<-reactive({
  TaxaTable%>%filter(Family %in% Vis4InputTarget_Taxa())%>%select(Family)%>%unique()
  })
TargetGenusVis_4_Selected<-reactive({
      
  TaxaTable%>%filter(Genus %in% Vis4InputTarget_Taxa())%>%select(Family,Genus)%>%unique()
  })
TargetSpeciesVis_4_Selected<-reactive({
      
  TaxaTable%>%filter(Species %in% Vis4InputTarget_Taxa())%>%select(Family,Genus,Species)%>%unique()
  })
TargetSubsVis_4_Selected<-reactive({
      
  TaxaTable%>%filter(Subspecies_Variants %in% Vis4InputTarget_Taxa())%>%select(Family,Genus,Species,Subspecies_Variants)%>%unique()
  })


TargetGenus_Family_Vis_4_Overlap<-reactive({
  req(TargetGenusVis_4_Selected())
  req(TargetFamilyVis_4_Selected())
  
  TargetGenusVis_4_Selected()%>%
  inner_join(TargetFamilyVis_4_Selected(),by='Family')%>%
  select(Family,Genus)%>%
  unite(Overlaps,"Family","Genus",sep=" overlaps ")
  })

TargetSpecies_Family_Vis_4_Overlap<-reactive({
  req(TargetSpeciesVis_4_Selected())
  req(TargetFamilyVis_4_Selected())
  
  TargetSpeciesVis_4_Selected()%>%
  inner_join(TargetFamilyVis_4_Selected(),by='Family')%>%
  select(Family,Species)%>%
  unite(Overlaps,"Family","Species",sep=" overlaps ")
  })

TargetSpecies_Genus_Vis_4_Overlap<-reactive({
  req(TargetSpeciesVis_4_Selected())
  req(TargetGenusVis_4_Selected())
  
  TargetSpeciesVis_4_Selected()%>%
  inner_join(TargetGenusVis_4_Selected(),by='Genus')%>%
  select(Genus,Species)%>%
  unite(Overlaps,"Genus","Species",sep=" overlaps ")
  })

TargetSubspecies_Family_Vis_4_Overlap<-reactive({
  req(TargetSubsVis_4_Selected())
  req(TargetFamilyVis_4_Selected())
  
  TargetSubsVis_4_Selected()%>%
  inner_join(TargetFamilyVis_4_Selected(),by='Family')%>%
  select(Family,Subspecies_Variants)%>%
  unite(Overlaps,"Family","Subspecies_Variants",sep=" overlaps ")
  })

TargetSubspecies_Genus_Vis_4_Overlap<-reactive({
  req(TargetSubsVis_4_Selected())
  req(TargetGenusVis_4_Selected())
  
  TargetSubsVis_4_Selected()%>%
  inner_join(TargetGenusVis_4_Selected(),by='Genus')%>%
  select(Genus,Subspecies_Variants)%>%
  unite(Overlaps,"Genus","Subspecies_Variants",sep=" overlaps ")
  })

TargetSubspecies_Species_Vis_4_Overlap<-reactive({
  req(TargetSubsVis_4_Selected())
  req(TargetSpeciesVis_4_Selected())
  
  TargetSubsVis_4_Selected()%>%
  inner_join(TargetSpeciesVis_4_Selected(),by='Species')%>%
  select(Species,Subspecies_Variants)%>%
  unite(Overlaps,"Species","Subspecies_Variants",sep=" overlaps ")
  })

TargetGroup_Taxa_Vis_4_Overlap<-reactive({
  req(input$AF_SharedData=="No"||is.null(input$AF_SharedData))
  req(Vis4InputTarget_Taxa())
  
    GroupTaxa%>%
  filter(Group %in% Vis4InputTarget_Taxa())%>%
  filter(Taxa %in% Vis4InputTarget_Taxa_NoGroup())%>%
  unite(Overlaps,"Group","Taxa",sep=" overlaps ")%>%
  select(Overlaps)
 
  })

TargetVis_4Overlaps<-reactive({
  PH<-as.list(bind_rows(TargetGenus_Family_Vis_4_Overlap(),TargetSpecies_Family_Vis_4_Overlap(),TargetSpecies_Genus_Vis_4_Overlap(),TargetSubspecies_Family_Vis_4_Overlap(),TargetSubspecies_Genus_Vis_4_Overlap(),TargetSubspecies_Species_Vis_4_Overlap(),TargetGroup_Taxa_Vis_4_Overlap()))
return(PH)
})

   TargetVis_4OverlapTaxa_Warn<-reactive({
     as.list(as.character(unique(TargetVis_4Overlaps()$Overlaps)))
     })
   
   TargetVis_4_Overlap_Warn<-reactive({
     paste(TargetVis_4OverlapTaxa_Warn(),collapse=" & ")
     })

   output$Vis_4_OverlapTargetWarning<-renderText({
    if(nchar(TargetVis_4_Overlap_Warn())>1){
      return(paste(as.character(actionLink(inputId = "TargetVis_4_Overlap_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input target taxa include overlapping value attribution: </span><span style=\"color:red;font-weight:bold\">", TargetVis_4_Overlap_Warn(),"</span><span style=\"color:blue;font-weight:bold\">","</span>"))
  }else {

  }
  })
   
  observeEvent(input$TargetVis_4_Overlap_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Overlap of Input Target Taxa"),
            h4(strong("Selected angler preference inputs contain overlapping target taxa: ")),
            h4("Taxa can be attributed at multiple, overlapping taxanomic levels and therefore the associated values can result in overlap or double counting (ie. a user selects both 
               'Bluegill' (Species) and 'Lepomis' (Genus) estimates, the estimate attributable to 'Bluegill'(10) is also included within 'Lepomis'(30), meaning of the 30 'Lepomis' values 10 of them are the 
               same as the 10 recorded in Bluegill, while 20 of them are from different 'Lepomis' taxa."),
            h4(strong("Recommendation: "),"We suggest avoiding overlapping taxa whereever possible to avoid double, triple, etc. counting of values. In order to do this select only non-overlapping target taxa for inputs."),
          easyClose = TRUE
        ))
    },ignoreInit=TRUE)
   
#### Final Visualization Input Data ####
  
  Data_1_1<-reactiveVal(NULL)
  Data_2_1_Selected<-reactiveVal(NULL)
  Data_2_1_Complete<-reactiveVal(NULL)
  Data_2_2_Selected<-reactiveVal(NULL)
  Data_2_2_Complete<-reactiveVal(NULL)
  Data_3_1_Selected<-reactiveVal(NULL)
  Data_3_1_Complete<-reactiveVal(NULL)
  Data_3_2_Selected<-reactiveVal(NULL)
  Data_3_2_Complete<-reactiveVal(NULL)
  Data_3_3_Selected<-reactiveVal(NULL)
  Data_3_3_Complete<-reactiveVal(NULL)
  Data_4_1_Selected<-reactiveVal(NULL)
  Data_4_1_Complete<-reactiveVal(NULL)
  Data_4_2_Selected<-reactiveVal(NULL)
  Data_4_2_Complete<-reactiveVal(NULL)
  Data_4_3_Selected<-reactiveVal(NULL)
  Data_4_3_Complete<-reactiveVal(NULL)
  Data_4_4_Selected<-reactiveVal(NULL)
  Data_4_4_Complete<-reactiveVal(NULL)
  
  observeEvent(c(
   Vis_1_SelectedTBL()
  ),{
    req(length(Vis_1_SelectedTBL())>0)
    req(input$AF_VisNum_Selection==1)
    
    PH<-Vis_1_SelectedTBL()%>%
        droplevels()
    Data_1_1(PH)
  },ignoreInit=TRUE)
  

 
  observeEvent(c(
    Vis_1_SelectedTBL()
   ),{
     req(length(Vis_1_SelectedTBL())>0)
     req(input$AF_SharedData=="No")
     
    PH<-Vis_1_SelectedTBL()%>%
        droplevels()
    
    Data_2_1_Selected(PH)
    Data_3_1_Selected(PH)
    Data_4_1_Selected(PH)
    
    Data_2_1_Complete(PH)
    Data_3_1_Complete(PH)
    Data_4_1_Complete(PH)
  },ignoreInit=TRUE)
  
  observeEvent(c(
    Vis_2_SelectedTBL()
   ),{
     req(length(Vis_2_SelectedTBL())>0)
     req(input$AF_SharedData=="No")
     
    PH<-Vis_2_SelectedTBL()%>%
        droplevels()
    
    Data_2_2_Selected(PH)
    Data_3_2_Selected(PH)
    Data_4_2_Selected(PH)
    
    Data_2_2_Complete(PH)
    Data_3_2_Complete(PH)
    Data_4_2_Complete(PH)
  },ignoreInit=TRUE)
  
  observeEvent(c(
    Vis_3_SelectedTBL()
   ),{
     req(length(Vis_3_SelectedTBL())>0)
     req(input$AF_SharedData=="No")
     
    PH<-Vis_3_SelectedTBL()%>%
        droplevels()
    
    Data_3_3_Selected(PH)
    Data_4_3_Selected(PH)
    
    Data_3_3_Complete(PH)
    Data_4_3_Complete(PH)
  },ignoreInit=TRUE)
  
  observeEvent(c(
    Vis_4_SelectedTBL()
   ),{
     req(length(Vis_4_SelectedTBL())>0)
     req(input$AF_SharedData=="No")
     
    PH<-Vis_4_SelectedTBL()%>%
        droplevels()
    
    Data_4_4_Selected(PH)
    
    Data_4_4_Complete(PH)
  },ignoreInit=TRUE)
  
    observeEvent(c(
    input$AF_SharedData
  ),{
    req(input$AF_VisNum_Selection)
    req(input$AF_SharedData=="No")

    if(input$AF_VisNum_Selection==2){
      PH_2_1<-Vis_1_SelectedTBL()%>%
        droplevels()
      PH_2_2<-Vis_2_SelectedTBL()%>%
        droplevels()

      Data_2_1_Selected(PH_2_1)
      Data_2_2_Selected(PH_2_2)
    }

    if(input$AF_VisNum_Selection==3){
      PH_3_1<-Vis_1_SelectedTBL()%>%
        droplevels()
      PH_3_2<-Vis_2_SelectedTBL()%>%
        droplevels()
      PH_3_3<-Vis_3_SelectedTBL()%>%
        droplevels()

      Data_3_1_Selected(PH_3_1)
      Data_3_2_Selected(PH_3_2)
      Data_3_3_Selected(PH_3_3)

    }

    if(input$AF_VisNum_Selection==4){
      PH_4_1<-Vis_1_SelectedTBL()%>%
        droplevels()
      PH_4_2<-Vis_2_SelectedTBL()%>%
        droplevels()
      PH_4_3<-Vis_3_SelectedTBL()%>%
        droplevels()
      PH_4_4<-Vis_4_SelectedTBL()%>%
        droplevels()

      Data_4_1_Selected(PH_4_1)
      Data_4_2_Selected(PH_4_2)
      Data_4_3_Selected(PH_4_3)
      Data_4_4_Selected(PH_4_4)
    }


  },ignoreInit=TRUE)

  
  observeEvent(c(
    input$AF_SharedData,
    Shared_SelectedTBL()
   ),{
     req(length(Shared_SelectedTBL())>0)
     req(input$AF_SharedData=="Yes")
     
    PH<-Shared_SelectedTBL()%>%
        droplevels()
    
    Data_2_1_Complete(PH)
    Data_3_1_Complete(PH)
    Data_4_1_Complete(PH)
    
    Data_2_2_Complete(PH)
    Data_3_2_Complete(PH)
    Data_4_2_Complete(PH)
    
    Data_3_3_Complete(PH)
    Data_4_3_Complete(PH)
    
    Data_4_4_Complete(PH)
  },ignoreInit=TRUE)
  
  observeEvent(c(
    input$AF_SharedData,
    Shared_SelectedTBL(),
    input$AF_LinkedSelection
   ),{
     req(length(Shared_SelectedTBL())>0)
     req(input$AF_SharedData=="Yes")
     req(input$AF_LinkedSelection=="No")

    PH<-Shared_SelectedTBL()%>%
        droplevels()

    Data_2_1_Selected(PH)
    Data_3_1_Selected(PH)
    Data_4_1_Selected(PH)

    Data_2_2_Selected(PH)
    Data_3_2_Selected(PH)
    Data_4_2_Selected(PH)

    Data_3_3_Selected(PH)
    Data_4_3_Selected(PH)

    Data_4_4_Selected(PH)

  },ignoreInit=TRUE)
  
  observeEvent(c(
    HighlightTrace_2Vis()
   ),{
     req(nrow(HighlightTrace_2Vis())>0)
     req(input$AF_SharedData=="Yes")
     req(input$AF_LinkedSelection=="Yes")
     
    PH<-HighlightTrace_2Vis()%>%
        droplevels()
    
    Data_2_1_Selected(PH)
    Data_2_2_Selected(PH)
  },ignoreInit=TRUE)
  
  observeEvent(c(
    HighlightTrace_3Vis()
   ),{
     req(nrow(HighlightTrace_3Vis())>0)
     req(input$AF_SharedData=="Yes")
     req(input$AF_LinkedSelection=="Yes")
     
    PH<-HighlightTrace_3Vis()%>%
        droplevels()
    
    Data_3_1_Selected(PH)
    Data_3_2_Selected(PH)
    Data_3_3_Selected(PH)
  },ignoreInit=TRUE)
  
  
  observeEvent(c(
    HighlightTrace_4Vis()
   ),{
     req(nrow(HighlightTrace_4Vis())>0)
     req(input$AF_SharedData=="Yes")
     req(input$AF_LinkedSelection=="Yes")
     
    PH<-HighlightTrace_4Vis()%>%
        droplevels()
    
    Data_4_1_Selected(PH)
    Data_4_2_Selected(PH)
    Data_4_3_Selected(PH)
    Data_4_4_Selected(PH)
  },ignoreInit=TRUE)
    
  

  
    

  
   #### Shared Warning ####
    
  Shared_WarningData<-reactive({
      Shared_SelectedTBL_Raw()%>%select(Survey_ID)%>%left_join(Survey_Data)
    })

# Duration #
  Shared_DurationDifference<-reactive({
    req(Shared_WarningData())
    PH<-max(Shared_WarningData()$Duration,na.rm=TRUE)-min(Shared_WarningData()$Duration,na.rm=TRUE)
    })
  
  Shared_DurationDifferenceMin<-reactive({
    req(Shared_WarningData())
    PH<-min(Shared_WarningData()$Duration,na.rm=TRUE)
    })
  
  Shared_DurationDifferenceMax<-reactive({req(Shared_WarningData())
    PH<-max(Shared_WarningData()$Duration,na.rm=TRUE)
    })
  
  output$Shared_DurationWarning<-renderText({
    if(Shared_DurationDifference()>0){
      return(paste(as.character(actionLink(inputId = "Shared_DurationWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">The difference in duration of input surveys is </span><span style=\"color:red;font-weight:bold\">", Shared_DurationDifference(),"</span><span style=\"color:black\"> days: </span><span style=\"color:red;font-weight:bold\">",Shared_DurationDifferenceMin(),"to",Shared_DurationDifferenceMax()," days</span>"))
  }else if(Shared_DurationDifference()==0){
    return(paste(as.character(actionLink(inputId = "Shared_DurationWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys have the same duration:</span><span style=\"color:green;font-weight:bold\">",Shared_DurationDifferenceMin(),"</span><span style=\"color:black\"> days</span>"))
  } else {
      
    }
  })
  
  observeEvent(input$Shared_DurationWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Duration Warning"),
            h4(strong("Surveys span a range of durations: ")),
            h4("Creel surveys may be conducted for differing lengths of time. Expansions are typically calculated to generate estimates for the surveyed period. 
               Because of this care should be taken when comparing surveys with differences in duration."),
            h4(strong("Recommendation: "), "Select surveys with similar durations to minimize the impacts of comparing longer and shorter surveys."),
            h4(strong("Recommendation: "), "Select duration indepedent rate based metrics if surveys spanning a wide range of durations are to be used. Examples include 
               percentages of various metrics, or 'Per Day' estimates (Such as Harvest per Day)"),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
# Start and End Dates  
  Shared_StartDifferenceMin<-reactive({req(Shared_WarningData())
    PH<-month.name[min(as.numeric(format(Shared_WarningData()$Start_Date, '%m')),na.rm=TRUE)]})
  Shared_StartDifferenceMax<-reactive({req(Shared_WarningData())
    PH<-month.name[max(as.numeric(format(Shared_WarningData()$Start_Date, '%m')),na.rm=TRUE)]})
  Shared_EndDifferenceMin<-reactive({req(Shared_WarningData())
    PH<-month.name[min(as.numeric(format(Shared_WarningData()$End_Date, '%m')),na.rm=TRUE)]})
  Shared_EndDifferenceMax<-reactive({req(Shared_WarningData())
    PH<-month.name[max(as.numeric(format(Shared_WarningData()$End_Date, '%m')),na.rm=TRUE)]})
  
  output$Shared_StartWarning<-renderText({
    req(Shared_StartDifferenceMin())
    req(Shared_StartDifferenceMax())
    if(Shared_StartDifferenceMin()==Shared_StartDifferenceMax()){
      return(paste(as.character(actionLink(inputId = "Shared_StartWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All surveys begin in </span><span style=\"color:green;font-weight:bold\">", Shared_StartDifferenceMin(),"</span>"))
  }else {
    return(paste(as.character(actionLink(inputId = "Shared_StartWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Start dates for input surveys range from </span><span style=\"color:red;font-weight:bold\">",Shared_StartDifferenceMin(), "</span><span style=\"color:black\"> to </span><span style=\"color:red;font-weight:bold\">", Shared_StartDifferenceMax(), "</span>"))
  }
  })
  
    output$Shared_EndWarning<-renderText({
    req(Shared_EndDifferenceMin())
    req(Shared_EndDifferenceMax())
    if(Shared_EndDifferenceMin()==Shared_EndDifferenceMax()){
      return(paste(as.character(actionLink(inputId = "Shared_EndWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All surveys conclude in </span><span style=\"color:green;font-weight:bold\">", Shared_EndDifferenceMin(),".</span>"))
  }else {
    return(paste(as.character(actionLink(inputId = "Shared_EndWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Conclusion dates for input surveys range from </span><span style=\"color:red;font-weight:bold\">",Shared_EndDifferenceMin(), "</span><span style=\"color:black\"> to </span><span style=\"color:red;font-weight:bold\">", Shared_EndDifferenceMax(), "</span>"))
  }
  }) 
    

  
  observeEvent(input$Shared_StartWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may cover different periods of the year: ")),
            h4("Creel surveys may be conducted across a variety of time periods. Attention should be paid to the start and end dates of surveys (as well as duration) 
               in order to make sure selected surveys are valid for user defined applications. For example some surveys may cover the winter angling, while others may cover spring/summer, 
               while others still may generate annual estimates (or nearly)."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those matching desired time periods based on 'Start' and 'End' months and Duration."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Shared_EndWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may cover different periods of the year: ")),
            h4("Creel surveys may be conducted across a variety of time periods. Attention should be paid to the start and end dates of surveys (as well as duration) 
               in order to make sure selected surveys are valid for user defined applications. For example some surveys may cover the winter angling, while others may cover spring/summer, 
               while others still may generate annual estimates (or nearly)."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those matching desired time periods based on 'Start' and 'End' months and Duration."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  
    
# Survey Gaps #
    
    Shared_Survey_GapsWarn_Max<-reactive({req(Shared_WarningData())
      max(Shared_WarningData()$Lost_Duration,na.rm=TRUE)
      })
    
    output$Shared_Survey_GapsWarning<-renderText({
    if (Shared_Survey_GapsWarn_Max()>0){
      return(paste(as.character(actionLink(inputId = "Shared_Survey_GapsWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include those with gaps in the survey period. Maximum gap of: </span><span style=\"color:red;font-weight:bold\">", Shared_Survey_GapsWarn_Max(),"</span><span style=\"color:black\"> days.</span>"))
      } else {
    }
  })
    
  observeEvent(input$Shared_Survey_GapsWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Gap Warning"),
            h4(strong("Surveys may occasionally have a period of time between the start and end date when surveys (and associated expansions) do not occur: ")),
            h4("Creel surveys sometimes have periods of time for which the survey is suspended, often due to staffing issues. When documented we record both the lost duration 
               and months for which the survey was not taking place. This 'Lost Duration' is then substracted from the overall duration (End Date-Start Date) in order to provide an accurately 
               populate the 'Duration' field to reflect the number of days represented in survey estimates."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

# Survey Type #
    Shared_Survey_TypeWarn_Dat<-reactive({req(Shared_WarningData())
      as.list(as.character(unique(Shared_WarningData()$Survey_Type)))
      })
    
    Shared_Survey_TypeWarn_Vals<-reactive({req(Shared_Survey_TypeWarn_Dat())
      paste(Shared_Survey_TypeWarn_Dat(),collapse=" & ")
      })
    
    Shared_Survey_TypeWarn_Vals_3<-reactive({req(Shared_Survey_TypeWarn_Dat())
      paste(Shared_Survey_TypeWarn_Dat()[1:3],collapse=" & ")
      })
    
    Shared_Survey_TypeWarn_Count<-reactive({req(Shared_Survey_TypeWarn_Dat())
      paste(length(Shared_Survey_TypeWarn_Dat()),"Types;")
      })
    
  output$Shared_Survey_TypeWarning<-renderText({
    if(length(Shared_Survey_TypeWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Shared_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys are of the same type: </span><span style=\"color:green;font-weight:bold\">", Shared_Survey_TypeWarn_Dat(),"</span>"))
  }else if (length(Shared_Survey_TypeWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Shared_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple types: </span><span style=\"color:red;font-weight:bold\">", Shared_Survey_TypeWarn_Count(),Shared_Survey_TypeWarn_Vals_3(),as.character(actionLink(inputId = "Shared_Survey_TypeWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Shared_Survey_TypeWarn_Dat())<4&&length(Shared_Survey_TypeWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Shared_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple types: </span><span style=\"color:red;font-weight:bold\">", Shared_Survey_TypeWarn_Count(), Shared_Survey_TypeWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Shared_Survey_TypeWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Survey Methods"),
            HTML(paste(Shared_Survey_TypeWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Shared_Survey_TypeWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Types Warning"),
            h4(strong("Surveys may include multiple type classifications: ")),
            h4("While most of the surveys contained in CreelCat are creel surveys (angler interviews and counts conducted on-site) we also included other types of angler 
            surveys to provide a more complete picture of angler data, particularly for areas where traditional creel surveys are not conducted. Many (although not all) of the other survey 
               approaches included in CreelCat are Mail/Phone/Online surveys where licensed anglers responses are solicited from anglers about there activities remotely."),
            h4("Consideration should be given as to how the different survey methods may impact any inferences drawn from comparisons which include multiple survey types."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
    
# Interview Methods #
    Shared_Interview_MethodWarn_Dat<-reactive({req(Shared_WarningData())
      as.list(as.character(unique(Shared_WarningData()$Interview_Method)))
      })
    Shared_Interview_MethodWarn_Vals<-reactive({req(Shared_Interview_MethodWarn_Dat())
      paste(Shared_Interview_MethodWarn_Dat(),collapse=" & ")
      })
    
    Shared_Interview_MethodWarn_Vals_3<-reactive({req(Shared_Interview_MethodWarn_Dat())
      paste(Shared_Interview_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Shared_Interview_MethodWarn_Interview<-reactive({req(Shared_Interview_MethodWarn_Dat())
      paste(length(Shared_Interview_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Shared_Interview_MethodWarning<-renderText({
    if(length(Shared_Interview_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Shared_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same interview method: </span><span style=\"color:green;font-weight:bold\">", Shared_Interview_MethodWarn_Dat(),"</span>"))
  }else if (length(Shared_Interview_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Shared_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple interview methods: </span><span style=\"color:red;font-weight:bold\">", Shared_Interview_MethodWarn_Interview(),Shared_Interview_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Shared_Interview_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Shared_Interview_MethodWarn_Dat())<4&&length(Shared_Interview_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Shared_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple interview methods: </span><span style=\"color:red;font-weight:bold\">", Shared_Interview_MethodWarn_Interview(), Shared_Interview_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Shared_Interview_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Interview Methods"),
            HTML(paste(Shared_Interview_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Shared_Interview_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Interview Methods Warning"),
            h4(strong("Surveys may include multiple interview methodologies: ")),
            h4("Creel surveys can employ a variety of methods for interviewing anglers. This warning identifies the various interview methodology classifications 
               associated with your selected inputs."),
            h4("While differences in methods for conducting angler interviews is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Count Methods #
    Shared_Count_MethodWarn_Dat<-reactive({req(Shared_WarningData())
      as.list(as.character(unique(Shared_WarningData()$Count_Method)))
      })
    Shared_Count_MethodWarn_Vals<-reactive({req(Shared_Count_MethodWarn_Dat())
      paste(Shared_Count_MethodWarn_Dat(),collapse=" & ")
      })
    
    Shared_Count_MethodWarn_Vals_3<-reactive({req(Shared_Count_MethodWarn_Dat())
      paste(Shared_Count_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Shared_Count_MethodWarn_Count<-reactive({req(Shared_Count_MethodWarn_Dat())
      paste(length(Shared_Count_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Shared_Count_MethodWarning<-renderText({
    if(length(Shared_Count_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Shared_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same count method: </span><span style=\"color:green;font-weight:bold\">", Shared_Count_MethodWarn_Dat(),"</span>"))
  }else if (length(Shared_Count_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Shared_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple count methods: </span><span style=\"color:red;font-weight:bold\">", Shared_Count_MethodWarn_Count(),Shared_Count_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Shared_Count_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Shared_Count_MethodWarn_Dat())<4&&length(Shared_Count_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Shared_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple count methods: </span><span style=\"color:red;font-weight:bold\">", Shared_Count_MethodWarn_Count(), Shared_Count_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Shared_Count_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Count Methods"),
            HTML(paste(Shared_Count_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Shared_Count_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Count Methods Warning"),
            h4(strong("Surveys may include multiple count methodologies: ")),
            h4("Creel surveys can employ a variety of methods for counting the number of anglers. This warning identifies the various count methodology classifications 
               associated with your selected inputs."),
            h4("While differences in methods for conducting angler counts is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  

    
    
# Estimate Methods #
    Shared_Estimate_MethodWarn_Dat<-reactive({req(Shared_WarningData())
      as.list(as.character(unique(Shared_WarningData()$Estimate_Method)))
      })
    Shared_Estimate_MethodWarn_Vals<-reactive({req(Shared_Estimate_MethodWarn_Dat())
      paste(Shared_Estimate_MethodWarn_Dat(),collapse=" & ")
      })
    
    Shared_Estimate_MethodWarn_Vals_3<-reactive({req(Shared_Estimate_MethodWarn_Dat())
      paste(Shared_Estimate_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Shared_Estimate_MethodWarn_Estimate<-reactive({req(Shared_Estimate_MethodWarn_Dat())
      paste(length(Shared_Estimate_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Shared_Estimate_MethodWarning<-renderText({
    if(length(Shared_Estimate_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Shared_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same method for generating estimates: </span><span style=\"color:green;font-weight:bold\">", Shared_Estimate_MethodWarn_Dat(),"</span>"))
  }else if (length(Shared_Estimate_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Shared_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple methods for generating estimates: </span><span style=\"color:red;font-weight:bold\">", Shared_Estimate_MethodWarn_Estimate(),Shared_Estimate_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Shared_Estimate_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Shared_Estimate_MethodWarn_Dat())<4&&length(Shared_Estimate_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Shared_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple methods for generating estimates: </span><span style=\"color:red;font-weight:bold\">", Shared_Estimate_MethodWarn_Estimate(), Shared_Estimate_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Shared_Estimate_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Estimate Methods"),
            HTML(paste(Shared_Estimate_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Shared_Estimate_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Estimate Methods Warning"),
            h4(strong("Surveys may include multiple estimate methodologies: ")),
            h4("Creel surveys can employ a variety of methods for generating estimates. This warning identifies the various estimate methodology classifications 
               associated with your selected input surveys."),
            h4("While differences in methods for generating estimates is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    

# Focal Species #
    Shared_Focal_SpeciesWarn_Dat<-reactive({req(Shared_WarningData())
      as.list(as.character(unique(Shared_WarningData()$Focal_Species)))
      })
    Shared_Focal_SpeciesWarn_Vals<-reactive({req(Shared_Focal_SpeciesWarn_Dat())
      paste(Shared_Focal_SpeciesWarn_Dat(),collapse=" & ")
      })
    
    Shared_Focal_SpeciesWarn_Vals_3<-reactive({req(Shared_Focal_SpeciesWarn_Dat())
      paste(Shared_Focal_SpeciesWarn_Dat()[1:3],collapse=" & ")
      })
    
    Shared_Focal_SpeciesWarn_Estimate<-reactive({req(Shared_Focal_SpeciesWarn_Dat())
      paste(length(Shared_Focal_SpeciesWarn_Dat()),"Classes;")
      })
    
    
  output$Shared_Focal_SpeciesWarning<-renderText({
    if(length(Shared_Focal_SpeciesWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Shared_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys have the same classification for 'Focal Species': </span><span style=\"color:green;font-weight:bold\">", Shared_Focal_SpeciesWarn_Dat(),"</span>"))
  }else if (length(Shared_Focal_SpeciesWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Shared_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys have multiple classifications for 'Focal Species': </span><span style=\"color:red;font-weight:bold\">", Shared_Focal_SpeciesWarn_Estimate(),Shared_Focal_SpeciesWarn_Vals_3(),as.character(actionLink(inputId = "Shared_Focal_SpeciesWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Shared_Focal_SpeciesWarn_Dat())<4&&length(Shared_Focal_SpeciesWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Shared_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys have multiple classifications for 'Focal Species': </span><span style=\"color:red;font-weight:bold\">", Shared_Focal_SpeciesWarn_Estimate(), Shared_Focal_SpeciesWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Shared_Focal_SpeciesWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Focal Species Classifications"),
            HTML(paste(Shared_Focal_SpeciesWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Shared_Focal_SpeciesWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Focal Species Warning"),
            h4(strong("Surveys may include multiple classifications for focal species: ")),
            h4("Creel surveys typically assess the full range of species captured/targetted by anglers, however sometimes creel surveys may only consider certain focal species without consideration of others. This warning identifies what classifications of focal species are included within the pool of selected surveys."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those including those species you are analyzing. This can mean including only surveys focused on 'All' taxa, or if you are interested in a specific taxa only including surveys listed as either 'All' or your taxa of interest. You may use the button below in the warning panel to drop surveys which are not inclusive of 'All' taxa."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

# Waterbody Type #
    Shared_WB_TypeWarn_Dat<-reactive({req(Shared_WarningData())
      as.list(as.character(unique(Shared_WarningData()$WB_Type)))
      })
    Shared_WB_TypeWarn_Vals<-reactive({req(Shared_WB_TypeWarn_Dat())
      paste(Shared_WB_TypeWarn_Dat(),collapse=" & ")
      })
    
    Shared_WB_TypeWarn_Vals_3<-reactive({req(Shared_WB_TypeWarn_Dat())
      paste(Shared_WB_TypeWarn_Dat()[1:3],collapse=" & ")
      })
    
    Shared_WB_TypeWarn_Estimate<-reactive({req(Shared_WB_TypeWarn_Dat())
      paste(length(Shared_WB_TypeWarn_Dat()),"Classes;")
      })
    
    
  output$Shared_WB_TypeWarning<-renderText({
    if(length(Shared_WB_TypeWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Shared_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys are of the same waterbody type classification: </span><span style=\"color:green;font-weight:bold\">", Shared_WB_TypeWarn_Dat(),"</span>"))
  }else if (length(Shared_WB_TypeWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Shared_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys span multiple waterbody type classifications: </span><span style=\"color:red;font-weight:bold\">", Shared_WB_TypeWarn_Estimate(),Shared_WB_TypeWarn_Vals_3(),as.character(actionLink(inputId = "Shared_WB_TypeWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Shared_WB_TypeWarn_Dat())<4&&length(Shared_WB_TypeWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Shared_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys span multiple waterbody type classifications: </span><span style=\"color:red;font-weight:bold\">", Shared_WB_TypeWarn_Estimate(), Shared_WB_TypeWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Shared_WB_TypeWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Waterbody Type Classifications"),
            HTML(paste(Shared_WB_TypeWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Shared_WB_TypeWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Waterbody Type Warning"),
            h4(strong("Surveys may include multiple classifications for waterbody type: ")),
            h4("Creel surveys contained in CreelCat come from freshwater systems across the United States. We have done our best to classify waterbody types as either 'Lakes, Reservoirs, Ponds, and Tailraces' or 'Streams and Rivers'. This warning identifies what classifications of waterbody types exist within your selection of surveys."),
            h4("There is nothing necessarily problematic about including both types within an analysis, however users should be aware of the presence of both waterbody types when using the dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Flagged Warning Heading #
  output$Shared_FlaggedHeading<-renderText({
    if(Shared_Timing_WarnWarn_Count()>0||
       Shared_Location_WarnWarn_Count()>0||
       Shared_Extent_WarnWarn_Count()>0
       ){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Flagged Survey Issues: </span></h4>"))
  }else {

  }
  }) 
  
# Timing Uncertain #
    
    Shared_Timing_WarnWarn_Count<-reactive({req(Shared_WarningData())
      PH<-Shared_WarningData()%>%
        filter(., Timing_Warn=="Unknown"|Timing_Warn=="Uncertain")
     
       return(count(PH))
      
      })
    
    output$Shared_Timing_WarnWarning<-renderText({
    if(Shared_Timing_WarnWarn_Count()==0){

  }else if (Shared_Timing_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Shared_Timing_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
             "<span style=\"color:black\">Input surveys include those with survey timing uncertainties: </span><span style=\"color:red;font-weight:bold\">", Shared_Timing_WarnWarn_Count(),"Surveys</span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Shared_Timing_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may be missing critical information regarding the timing of the survey: ")),
            h4("Creel surveys included in CreelCat typically include both start and end dates which allows users to determine when the survey took place and how long it lasted. Surveys which are missing start and/or end dates have been flagged as either uncertain or unknown."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that ris sensitive to the timing or duration of input surveys, surveys flagged as having unknown or uncertain timing should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Location Uncertain #
  
      Shared_Location_WarnWarn_Count<-reactive({req(Shared_WarningData())
      PH<-Shared_WarningData()%>%
        filter(., Location_Warn=="Unknown"|Location_Warn=="Uncertain")
      
      return(count(PH))
      
      })
    
    output$Shared_Location_WarnWarning<-renderText({
    if(Shared_Location_WarnWarn_Count()==0){

  }else if (Shared_Location_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Shared_Location_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include those with survey location uncertainties: </span><span style=\"color:red;font-weight:bold\">", Shared_Location_WarnWarn_Count(),"Surveys </span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Shared_Location_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Location Warning"),
            h4(strong("Surveys may be missing critical information regarding the location of the survey: ")),
            h4("Creel surveys included in CreelCat typically identify the location of the waterbody being surveyed. Surveys which are missing the information needed to generate the location of the survey have been flagged as either uncertain (location assigned according to our best judgement despite lack of required documentation) or unknown (no location assigned for a given survey)."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that is sensitive to the location of input surveys or requires any spatial information, surveys flagged as having unknown or uncertain locations should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    

    
# Extent Warning #
  
      Shared_Extent_WarnWarn_Count<-reactive({req(Shared_WarningData())
      PH<-Shared_WarningData()%>%
        filter(., Extent_Warn=="Unknown"|Extent_Warn=="Uncertain")
      return(count(PH))
      })
    
    output$Shared_Extent_WarnWarning<-renderText({
    if(Shared_Extent_WarnWarn_Count()==0){

  }else if (Shared_Extent_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Shared_Extent_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include those with survey extent uncertainties: </span><span style=\"color:red;font-weight:bold\">", Shared_Extent_WarnWarn_Count(),"Surveys </span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Shared_Extent_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Extent Warning"),
            h4(strong("Surveys may be missing critical information regarding the extent of the survey: ")),
            h4("Creel surveys included in CreelCat typically identify the extent of the waterbody being surveyed. Surveys which are missing the information needed to generate the extent of the survey have been flagged as either uncertain (extent assigned according to our best judgement despite lack of required documentation) or unknown (no extent assigned for a given survey)."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that is sensitive to the extent of input surveys or requires any spatial information, surveys flagged as having unknown or uncertain extents should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)    

    
  
### Warning Tables ###
  
  
    Shared_WarningTBL_SurveyChar<-reactive({
      req(Shared_WarningData())
      Shared_WarningData()%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Duration','Survey_Gaps','Lost_Duration','Survey_Type','Interview_Method','Count_Method','Estimate_Method','Location_Warn','Extent_Warn','Timing_Warn')%>%
        droplevels()
      })   
  
   
   output$Shared_WarnTBL_SurveyChar<-DT::renderDataTable(
    Shared_WarningTBL_SurveyChar(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )   
   

    Shared_WarningTBL_Non_Creel<-reactive({
      req(Shared_WarningData())
      Shared_WarningData()%>%
        filter(Survey_Type!='Creel Survey')%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Survey_Type')%>%
        droplevels()
      })   
   
   output$Shared_WarnTBL_Non_Creel<-DT::renderDataTable(
    Shared_WarningTBL_Non_Creel(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )   
   

    Shared_WarningTBL_Timing<-reactive({
      req(Shared_WarningData())
      Shared_WarningData()%>%
        filter(Timing_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Timing_Warn')%>%
        droplevels()
      })

   output$Shared_WarnTBL_Timing<-DT::renderDataTable(
    Shared_WarningTBL_Timing(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Shared_WarningTBL_Location<-reactive({
      req(Shared_WarningData())
      Shared_WarningData()%>%
        filter(Location_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Location_Warn')%>%
        droplevels()
      })

   output$Shared_WarnTBL_Location<-DT::renderDataTable(
    Shared_WarningTBL_Location(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Shared_WarningTBL_Extent<-reactive({
      req(Shared_WarningData())
      Shared_WarningData()%>%
        filter(Extent_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Extent_Warn')%>%
        droplevels()
      })

   output$Shared_WarnTBL_Extent<-DT::renderDataTable(
    Shared_WarningTBL_Extent(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Shared_WarningTBL_FocalSpecies<-reactive({
      req(Shared_WarningData())
      Shared_WarningData()%>%
        filter(Focal_Species!='All')%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Focal_Species')%>%
        droplevels()
      })

   output$Shared_WarnTBL_FocalSpecies<-DT::renderDataTable(
    Shared_WarningTBL_FocalSpecies(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )  
   
   #### Vis 1 Warning ####
    
  Vis_1_WarningData<-reactive({
      Vis_1_SelectedTBL_Raw()%>%select(Survey_ID)%>%left_join(Survey_Data)
    })

# Duration #
  Vis_1_DurationDifference<-reactive({
    req(Vis_1_WarningData())
    PH<-max(Vis_1_WarningData()$Duration,na.rm=TRUE)-min(Vis_1_WarningData()$Duration,na.rm=TRUE)
    })
  
  Vis_1_DurationDifferenceMin<-reactive({
    req(Vis_1_WarningData())
    PH<-min(Vis_1_WarningData()$Duration,na.rm=TRUE)
    })
  
  Vis_1_DurationDifferenceMax<-reactive({req(Vis_1_WarningData())
    PH<-max(Vis_1_WarningData()$Duration,na.rm=TRUE)
    })
  
  output$Vis_1_DurationWarning<-renderText({
    if(Vis_1_DurationDifference()>0){
      return(paste(as.character(actionLink(inputId = "Vis_1_DurationWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">The difference in duration of input surveys is </span><span style=\"color:red;font-weight:bold\">", Vis_1_DurationDifference(),"</span><span style=\"color:black\"> days: </span><span style=\"color:red;font-weight:bold\">",Vis_1_DurationDifferenceMin(),"to",Vis_1_DurationDifferenceMax()," days</span>"))
  }else if(Vis_1_DurationDifference()==0){
    return(paste(as.character(actionLink(inputId = "Vis_1_DurationWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys have the same duration:</span><span style=\"color:green;font-weight:bold\">",Vis_1_DurationDifferenceMin(),"</span><span style=\"color:black\"> days</span>"))
  } else {
      
    }
  })
  
  observeEvent(input$Vis_1_DurationWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Duration Warning"),
            h4(strong("Surveys span a range of durations: ")),
            h4("Creel surveys may be conducted for differing lengths of time. Expansions are typically calculated to generate estimates for the surveyed period. 
               Because of this care should be taken when comparing surveys with differences in duration."),
            h4(strong("Recommendation: "), "Select surveys with similar durations to minimize the impacts of comparing longer and shorter surveys."),
            h4(strong("Recommendation: "), "Select duration indepedent rate based metrics if surveys spanning a wide range of durations are to be used. Examples include 
               percentages of various metrics, or 'Per Day' estimates (Such as Harvest per Day)"),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
# Start and End Dates  
  Vis_1_StartDifferenceMin<-reactive({req(Vis_1_WarningData())
    PH<-month.name[min(as.numeric(format(Vis_1_WarningData()$Start_Date, '%m')),na.rm=TRUE)]})
  Vis_1_StartDifferenceMax<-reactive({req(Vis_1_WarningData())
    PH<-month.name[max(as.numeric(format(Vis_1_WarningData()$Start_Date, '%m')),na.rm=TRUE)]})
  Vis_1_EndDifferenceMin<-reactive({req(Vis_1_WarningData())
    PH<-month.name[min(as.numeric(format(Vis_1_WarningData()$End_Date, '%m')),na.rm=TRUE)]})
  Vis_1_EndDifferenceMax<-reactive({req(Vis_1_WarningData())
    PH<-month.name[max(as.numeric(format(Vis_1_WarningData()$End_Date, '%m')),na.rm=TRUE)]})
  
  output$Vis_1_StartWarning<-renderText({
    req(Vis_1_StartDifferenceMin())
    req(Vis_1_StartDifferenceMax())
    if(Vis_1_StartDifferenceMin()==Vis_1_StartDifferenceMax()){
      return(paste(as.character(actionLink(inputId = "Vis_1_StartWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All surveys begin in </span><span style=\"color:green;font-weight:bold\">", Vis_1_StartDifferenceMin(),"</span>"))
  }else {
    return(paste(as.character(actionLink(inputId = "Vis_1_StartWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Start dates for input surveys range from </span><span style=\"color:red;font-weight:bold\">",Vis_1_StartDifferenceMin(), "</span><span style=\"color:black\"> to </span><span style=\"color:red;font-weight:bold\">", Vis_1_StartDifferenceMax(), "</span>"))
  }
  })
  
    output$Vis_1_EndWarning<-renderText({
    req(Vis_1_EndDifferenceMin())
    req(Vis_1_EndDifferenceMax())
    if(Vis_1_EndDifferenceMin()==Vis_1_EndDifferenceMax()){
      return(paste(as.character(actionLink(inputId = "Vis_1_EndWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All surveys conclude in </span><span style=\"color:green;font-weight:bold\">", Vis_1_EndDifferenceMin(),".</span>"))
  }else {
    return(paste(as.character(actionLink(inputId = "Vis_1_EndWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Conclusion dates for input surveys range from </span><span style=\"color:red;font-weight:bold\">",Vis_1_EndDifferenceMin(), "</span><span style=\"color:black\"> to </span><span style=\"color:red;font-weight:bold\">", Vis_1_EndDifferenceMax(), "</span>"))
  }
  }) 
    

  
  observeEvent(input$Vis_1_StartWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may cover different periods of the year: ")),
            h4("Creel surveys may be conducted across a variety of time periods. Attention should be paid to the start and end dates of surveys (as well as duration) 
               in order to make sure selected surveys are valid for user defined applications. For example some surveys may cover the winter angling, while others may cover spring/summer, 
               while others still may generate annual estimates (or nearly)."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those matching desired time periods based on 'Start' and 'End' months and Duration."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_1_EndWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may cover different periods of the year: ")),
            h4("Creel surveys may be conducted across a variety of time periods. Attention should be paid to the start and end dates of surveys (as well as duration) 
               in order to make sure selected surveys are valid for user defined applications. For example some surveys may cover the winter angling, while others may cover spring/summer, 
               while others still may generate annual estimates (or nearly)."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those matching desired time periods based on 'Start' and 'End' months and Duration."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  
    
# Survey Gaps #
    
    Vis_1_Survey_GapsWarn_Max<-reactive({req(Vis_1_WarningData())
      max(Vis_1_WarningData()$Lost_Duration,na.rm=TRUE)
      })
    
    output$Vis_1_Survey_GapsWarning<-renderText({
    if (Vis_1_Survey_GapsWarn_Max()>0){
      return(paste(as.character(actionLink(inputId = "Vis_1_Survey_GapsWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include those with gaps in the survey period. Maximum gap of: </span><span style=\"color:red;font-weight:bold\">", Vis_1_Survey_GapsWarn_Max(),"</span><span style=\"color:black\"> days.</span>"))
      } else {
    }
  })
    
  observeEvent(input$Vis_1_Survey_GapsWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Gap Warning"),
            h4(strong("Surveys may occasionally have a period of time between the start and end date when surveys (and associated expansions) do not occur: ")),
            h4("Creel surveys sometimes have periods of time for which the survey is suspended, often due to staffing issues. When documented we record both the lost duration 
               and months for which the survey was not taking place. This 'Lost Duration' is then substracted from the overall duration (End Date-Start Date) in order to provide an accurately 
               populate the 'Duration' field to reflect the number of days represented in survey estimates."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

# Survey Type #
    Vis_1_Survey_TypeWarn_Dat<-reactive({req(Vis_1_WarningData())
      as.list(as.character(unique(Vis_1_WarningData()$Survey_Type)))
      })
    
    Vis_1_Survey_TypeWarn_Vals<-reactive({req(Vis_1_Survey_TypeWarn_Dat())
      paste(Vis_1_Survey_TypeWarn_Dat(),collapse=" & ")
      })
    
    Vis_1_Survey_TypeWarn_Vals_3<-reactive({req(Vis_1_Survey_TypeWarn_Dat())
      paste(Vis_1_Survey_TypeWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_1_Survey_TypeWarn_Count<-reactive({req(Vis_1_Survey_TypeWarn_Dat())
      paste(length(Vis_1_Survey_TypeWarn_Dat()),"Types;")
      })
    
  output$Vis_1_Survey_TypeWarning<-renderText({
    if(length(Vis_1_Survey_TypeWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_1_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys are of the same type: </span><span style=\"color:green;font-weight:bold\">", Vis_1_Survey_TypeWarn_Dat(),"</span>"))
  }else if (length(Vis_1_Survey_TypeWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_1_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple types: </span><span style=\"color:red;font-weight:bold\">", Vis_1_Survey_TypeWarn_Count(),Vis_1_Survey_TypeWarn_Vals_3(),as.character(actionLink(inputId = "Vis_1_Survey_TypeWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_1_Survey_TypeWarn_Dat())<4&&length(Vis_1_Survey_TypeWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_1_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple types: </span><span style=\"color:red;font-weight:bold\">", Vis_1_Survey_TypeWarn_Count(), Vis_1_Survey_TypeWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_1_Survey_TypeWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Survey Methods"),
            HTML(paste(Vis_1_Survey_TypeWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_1_Survey_TypeWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Types Warning"),
            h4(strong("Surveys may include multiple type classifications: ")),
            h4("While most of the surveys contained in CreelCat are creel surveys (angler interviews and counts conducted on-site) we also included other types of angler 
            surveys to provide a more complete picture of angler data, particularly for areas where traditional creel surveys are not conducted. Many (although not all) of the other survey 
               approaches included in CreelCat are Mail/Phone/Online surveys where licensed anglers responses are solicited from anglers about there activities remotely."),
            h4("Consideration should be given as to how the different survey methods may impact any inferences drawn from comparisons which include multiple survey types."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
    
# Interview Methods #
    Vis_1_Interview_MethodWarn_Dat<-reactive({req(Vis_1_WarningData())
      as.list(as.character(unique(Vis_1_WarningData()$Interview_Method)))
      })
    Vis_1_Interview_MethodWarn_Vals<-reactive({req(Vis_1_Interview_MethodWarn_Dat())
      paste(Vis_1_Interview_MethodWarn_Dat(),collapse=" & ")
      })
    
    Vis_1_Interview_MethodWarn_Vals_3<-reactive({req(Vis_1_Interview_MethodWarn_Dat())
      paste(Vis_1_Interview_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_1_Interview_MethodWarn_Interview<-reactive({req(Vis_1_Interview_MethodWarn_Dat())
      paste(length(Vis_1_Interview_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_1_Interview_MethodWarning<-renderText({
    if(length(Vis_1_Interview_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_1_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same interview method: </span><span style=\"color:green;font-weight:bold\">", Vis_1_Interview_MethodWarn_Dat(),"</span>"))
  }else if (length(Vis_1_Interview_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_1_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple interview methods: </span><span style=\"color:red;font-weight:bold\">", Vis_1_Interview_MethodWarn_Interview(),Vis_1_Interview_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Vis_1_Interview_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_1_Interview_MethodWarn_Dat())<4&&length(Vis_1_Interview_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_1_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple interview methods: </span><span style=\"color:red;font-weight:bold\">", Vis_1_Interview_MethodWarn_Interview(), Vis_1_Interview_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_1_Interview_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Interview Methods"),
            HTML(paste(Vis_1_Interview_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_1_Interview_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Interview Methods Warning"),
            h4(strong("Surveys may include multiple interview methodologies: ")),
            h4("Creel surveys can employ a variety of methods for interviewing anglers. This warning identifies the various interview methodology classifications 
               associated with your selected inputs."),
            h4("While differences in methods for conducting angler interviews is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Count Methods #
    Vis_1_Count_MethodWarn_Dat<-reactive({req(Vis_1_WarningData())
      as.list(as.character(unique(Vis_1_WarningData()$Count_Method)))
      })
    Vis_1_Count_MethodWarn_Vals<-reactive({req(Vis_1_Count_MethodWarn_Dat())
      paste(Vis_1_Count_MethodWarn_Dat(),collapse=" & ")
      })
    
    Vis_1_Count_MethodWarn_Vals_3<-reactive({req(Vis_1_Count_MethodWarn_Dat())
      paste(Vis_1_Count_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_1_Count_MethodWarn_Count<-reactive({req(Vis_1_Count_MethodWarn_Dat())
      paste(length(Vis_1_Count_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_1_Count_MethodWarning<-renderText({
    if(length(Vis_1_Count_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_1_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same count method: </span><span style=\"color:green;font-weight:bold\">", Vis_1_Count_MethodWarn_Dat(),"</span>"))
  }else if (length(Vis_1_Count_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_1_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple count methods: </span><span style=\"color:red;font-weight:bold\">", Vis_1_Count_MethodWarn_Count(),Vis_1_Count_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Vis_1_Count_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_1_Count_MethodWarn_Dat())<4&&length(Vis_1_Count_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_1_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple count methods: </span><span style=\"color:red;font-weight:bold\">", Vis_1_Count_MethodWarn_Count(), Vis_1_Count_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_1_Count_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Count Methods"),
            HTML(paste(Vis_1_Count_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_1_Count_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Count Methods Warning"),
            h4(strong("Surveys may include multiple count methodologies: ")),
            h4("Creel surveys can employ a variety of methods for counting the number of anglers. This warning identifies the various count methodology classifications 
               associated with your selected inputs."),
            h4("While differences in methods for conducting angler counts is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  

    
    
# Estimate Methods #
    Vis_1_Estimate_MethodWarn_Dat<-reactive({req(Vis_1_WarningData())
      as.list(as.character(unique(Vis_1_WarningData()$Estimate_Method)))
      })
    Vis_1_Estimate_MethodWarn_Vals<-reactive({req(Vis_1_Estimate_MethodWarn_Dat())
      paste(Vis_1_Estimate_MethodWarn_Dat(),collapse=" & ")
      })
    
    Vis_1_Estimate_MethodWarn_Vals_3<-reactive({req(Vis_1_Estimate_MethodWarn_Dat())
      paste(Vis_1_Estimate_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_1_Estimate_MethodWarn_Estimate<-reactive({req(Vis_1_Estimate_MethodWarn_Dat())
      paste(length(Vis_1_Estimate_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_1_Estimate_MethodWarning<-renderText({
    if(length(Vis_1_Estimate_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_1_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same method for generating estimates: </span><span style=\"color:green;font-weight:bold\">", Vis_1_Estimate_MethodWarn_Dat(),"</span>"))
  }else if (length(Vis_1_Estimate_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_1_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple methods for generating estimates: </span><span style=\"color:red;font-weight:bold\">", Vis_1_Estimate_MethodWarn_Estimate(),Vis_1_Estimate_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Vis_1_Estimate_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_1_Estimate_MethodWarn_Dat())<4&&length(Vis_1_Estimate_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_1_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple methods for generating estimates: </span><span style=\"color:red;font-weight:bold\">", Vis_1_Estimate_MethodWarn_Estimate(), Vis_1_Estimate_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_1_Estimate_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Estimate Methods"),
            HTML(paste(Vis_1_Estimate_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_1_Estimate_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Estimate Methods Warning"),
            h4(strong("Surveys may include multiple estimate methodologies: ")),
            h4("Creel surveys can employ a variety of methods for generating estimates. This warning identifies the various estimate methodology classifications 
               associated with your selected input surveys."),
            h4("While differences in methods for generating estimates is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    

# Focal Species #
    Vis_1_Focal_SpeciesWarn_Dat<-reactive({req(Vis_1_WarningData())
      as.list(as.character(unique(Vis_1_WarningData()$Focal_Species)))
      })
    Vis_1_Focal_SpeciesWarn_Vals<-reactive({req(Vis_1_Focal_SpeciesWarn_Dat())
      paste(Vis_1_Focal_SpeciesWarn_Dat(),collapse=" & ")
      })
    
    Vis_1_Focal_SpeciesWarn_Vals_3<-reactive({req(Vis_1_Focal_SpeciesWarn_Dat())
      paste(Vis_1_Focal_SpeciesWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_1_Focal_SpeciesWarn_Estimate<-reactive({req(Vis_1_Focal_SpeciesWarn_Dat())
      paste(length(Vis_1_Focal_SpeciesWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_1_Focal_SpeciesWarning<-renderText({
    if(length(Vis_1_Focal_SpeciesWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_1_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys have the same classification for 'Focal Species': </span><span style=\"color:green;font-weight:bold\">", Vis_1_Focal_SpeciesWarn_Dat(),"</span>"))
  }else if (length(Vis_1_Focal_SpeciesWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_1_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys have multiple classifications for 'Focal Species': </span><span style=\"color:red;font-weight:bold\">", Vis_1_Focal_SpeciesWarn_Estimate(),Vis_1_Focal_SpeciesWarn_Vals_3(),as.character(actionLink(inputId = "Vis_1_Focal_SpeciesWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_1_Focal_SpeciesWarn_Dat())<4&&length(Vis_1_Focal_SpeciesWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_1_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys have multiple classifications for 'Focal Species': </span><span style=\"color:red;font-weight:bold\">", Vis_1_Focal_SpeciesWarn_Estimate(), Vis_1_Focal_SpeciesWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_1_Focal_SpeciesWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Focal Species Classifications"),
            HTML(paste(Vis_1_Focal_SpeciesWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_1_Focal_SpeciesWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Focal Species Warning"),
            h4(strong("Surveys may include multiple classifications for focal species: ")),
            h4("Creel surveys typically assess the full range of species captured/targetted by anglers, however sometimes creel surveys may only consider certain focal species without consideration of others. This warning identifies what classifications of focal species are included within the pool of selected surveys."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those including those species you are analyzing. This can mean including only surveys focused on 'All' taxa, or if you are interested in a specific taxa only including surveys listed as either 'All' or your taxa of interest. You may use the button below in the warning panel to drop surveys which are not inclusive of 'All' taxa."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

# Waterbody Type #
    Vis_1_WB_TypeWarn_Dat<-reactive({req(Vis_1_WarningData())
      as.list(as.character(unique(Vis_1_WarningData()$WB_Type)))
      })
    Vis_1_WB_TypeWarn_Vals<-reactive({req(Vis_1_WB_TypeWarn_Dat())
      paste(Vis_1_WB_TypeWarn_Dat(),collapse=" & ")
      })
    
    Vis_1_WB_TypeWarn_Vals_3<-reactive({req(Vis_1_WB_TypeWarn_Dat())
      paste(Vis_1_WB_TypeWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_1_WB_TypeWarn_Estimate<-reactive({req(Vis_1_WB_TypeWarn_Dat())
      paste(length(Vis_1_WB_TypeWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_1_WB_TypeWarning<-renderText({
    if(length(Vis_1_WB_TypeWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_1_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys are of the same waterbody type classification: </span><span style=\"color:green;font-weight:bold\">", Vis_1_WB_TypeWarn_Dat(),"</span>"))
  }else if (length(Vis_1_WB_TypeWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_1_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys span multiple waterbody type classifications: </span><span style=\"color:red;font-weight:bold\">", Vis_1_WB_TypeWarn_Estimate(),Vis_1_WB_TypeWarn_Vals_3(),as.character(actionLink(inputId = "Vis_1_WB_TypeWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_1_WB_TypeWarn_Dat())<4&&length(Vis_1_WB_TypeWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_1_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys span multiple waterbody type classifications: </span><span style=\"color:red;font-weight:bold\">", Vis_1_WB_TypeWarn_Estimate(), Vis_1_WB_TypeWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_1_WB_TypeWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Waterbody Type Classifications"),
            HTML(paste(Vis_1_WB_TypeWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_1_WB_TypeWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Waterbody Type Warning"),
            h4(strong("Surveys may include multiple classifications for waterbody type: ")),
            h4("Creel surveys contained in CreelCat come from freshwater systems across the United States. We have done our best to classify waterbody types as either 'Lakes, Reservoirs, Ponds, and Tailraces' or 'Streams and Rivers'. This warning identifies what classifications of waterbody types exist within your selection of surveys."),
            h4("There is nothing necessarily problematic about including both types within an analysis, however users should be aware of the presence of both waterbody types when using the dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Flagged Warning Heading #
  output$Vis_1_FlaggedHeading<-renderText({
    if(Vis_1_Timing_WarnWarn_Count()>0||
       Vis_1_Location_WarnWarn_Count()>0||
       Vis_1_Extent_WarnWarn_Count()>0
       ){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Flagged Survey Issues: </span></h4>"))
  }else {

  }
  }) 
  
# Timing Uncertain #
    
    Vis_1_Timing_WarnWarn_Count<-reactive({req(Vis_1_WarningData())
      PH<-Vis_1_WarningData()%>%
        filter(., Timing_Warn=="Unknown"|Timing_Warn=="Uncertain")
     
       return(count(PH))
      
      })
    
    output$Vis_1_Timing_WarnWarning<-renderText({
    if(Vis_1_Timing_WarnWarn_Count()==0){

  }else if (Vis_1_Timing_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Vis_1_Timing_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
             "<span style=\"color:black\">Input surveys include those with survey timing uncertainties: </span><span style=\"color:red;font-weight:bold\">", Vis_1_Timing_WarnWarn_Count(),"Surveys</span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Vis_1_Timing_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may be missing critical information regarding the timing of the survey: ")),
            h4("Creel surveys included in CreelCat typically include both start and end dates which allows users to determine when the survey took place and how long it lasted. Surveys which are missing start and/or end dates have been flagged as either uncertain or unknown."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that ris sensitive to the timing or duration of input surveys, surveys flagged as having unknown or uncertain timing should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Location Uncertain #
  
      Vis_1_Location_WarnWarn_Count<-reactive({req(Vis_1_WarningData())
      PH<-Vis_1_WarningData()%>%
        filter(., Location_Warn=="Unknown"|Location_Warn=="Uncertain")
      
      return(count(PH))
      
      })
    
    output$Vis_1_Location_WarnWarning<-renderText({
    if(Vis_1_Location_WarnWarn_Count()==0){

  }else if (Vis_1_Location_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Vis_1_Location_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include those with survey location uncertainties: </span><span style=\"color:red;font-weight:bold\">", Vis_1_Location_WarnWarn_Count(),"Surveys </span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Vis_1_Location_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Location Warning"),
            h4(strong("Surveys may be missing critical information regarding the location of the survey: ")),
            h4("Creel surveys included in CreelCat typically identify the location of the waterbody being surveyed. Surveys which are missing the information needed to generate the location of the survey have been flagged as either uncertain (location assigned according to our best judgement despite lack of required documentation) or unknown (no location assigned for a given survey)."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that is sensitive to the location of input surveys or requires any spatial information, surveys flagged as having unknown or uncertain locations should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    

    
# Extent Warning #
  
      Vis_1_Extent_WarnWarn_Count<-reactive({req(Vis_1_WarningData())
      PH<-Vis_1_WarningData()%>%
        filter(., Extent_Warn=="Unknown"|Extent_Warn=="Uncertain")
      return(count(PH))
      })
    
    output$Vis_1_Extent_WarnWarning<-renderText({
    if(Vis_1_Extent_WarnWarn_Count()==0){

  }else if (Vis_1_Extent_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Vis_1_Extent_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include those with survey extent uncertainties: </span><span style=\"color:red;font-weight:bold\">", Vis_1_Extent_WarnWarn_Count(),"Surveys </span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Vis_1_Extent_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Extent Warning"),
            h4(strong("Surveys may be missing critical information regarding the extent of the survey: ")),
            h4("Creel surveys included in CreelCat typically identify the extent of the waterbody being surveyed. Surveys which are missing the information needed to generate the extent of the survey have been flagged as either uncertain (extent assigned according to our best judgement despite lack of required documentation) or unknown (no extent assigned for a given survey)."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that is sensitive to the extent of input surveys or requires any spatial information, surveys flagged as having unknown or uncertain extents should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)    

    
  
### Warning Tables ###
  
  
    Vis_1_WarningTBL_SurveyChar<-reactive({
      req(Vis_1_WarningData())
      Vis_1_WarningData()%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Duration','Survey_Gaps','Lost_Duration','Survey_Type','Interview_Method','Count_Method','Estimate_Method','Location_Warn','Extent_Warn','Timing_Warn')%>%
        droplevels()
      })   
  
   
   output$Vis_1_WarnTBL_SurveyChar<-DT::renderDataTable(
    Vis_1_WarningTBL_SurveyChar(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )   
   

    Vis_1_WarningTBL_Non_Creel<-reactive({
      req(Vis_1_WarningData())
      Vis_1_WarningData()%>%
        filter(Survey_Type!='Creel Survey')%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Survey_Type')%>%
        droplevels()
      })   
   
   output$Vis_1_WarnTBL_Non_Creel<-DT::renderDataTable(
    Vis_1_WarningTBL_Non_Creel(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )   
   

    Vis_1_WarningTBL_Timing<-reactive({
      req(Vis_1_WarningData())
      Vis_1_WarningData()%>%
        filter(Timing_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Timing_Warn')%>%
        droplevels()
      })

   output$Vis_1_WarnTBL_Timing<-DT::renderDataTable(
    Vis_1_WarningTBL_Timing(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Vis_1_WarningTBL_Location<-reactive({
      req(Vis_1_WarningData())
      Vis_1_WarningData()%>%
        filter(Location_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Location_Warn')%>%
        droplevels()
      })

   output$Vis_1_WarnTBL_Location<-DT::renderDataTable(
    Vis_1_WarningTBL_Location(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Vis_1_WarningTBL_Extent<-reactive({
      req(Vis_1_WarningData())
      Vis_1_WarningData()%>%
        filter(Extent_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Extent_Warn')%>%
        droplevels()
      })

   output$Vis_1_WarnTBL_Extent<-DT::renderDataTable(
    Vis_1_WarningTBL_Extent(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Vis_1_WarningTBL_FocalSpecies<-reactive({
      req(Vis_1_WarningData())
      Vis_1_WarningData()%>%
        filter(Focal_Species!='All')%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Focal_Species')%>%
        droplevels()
      })

   output$Vis_1_WarnTBL_FocalSpecies<-DT::renderDataTable(
    Vis_1_WarningTBL_FocalSpecies(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
    
   #### Vis 2 Warning ####
    
  Vis_2_WarningData<-reactive({
      Vis_2_SelectedTBL_Raw()%>%select(Survey_ID)%>%left_join(Survey_Data)
    })

# Duration #
  Vis_2_DurationDifference<-reactive({
    req(Vis_2_WarningData())
    PH<-max(Vis_2_WarningData()$Duration,na.rm=TRUE)-min(Vis_2_WarningData()$Duration,na.rm=TRUE)
    })
  
  Vis_2_DurationDifferenceMin<-reactive({
    req(Vis_2_WarningData())
    PH<-min(Vis_2_WarningData()$Duration,na.rm=TRUE)
    })
  
  Vis_2_DurationDifferenceMax<-reactive({req(Vis_2_WarningData())
    PH<-max(Vis_2_WarningData()$Duration,na.rm=TRUE)
    })
  
  output$Vis_2_DurationWarning<-renderText({
    if(Vis_2_DurationDifference()>0){
      return(paste(as.character(actionLink(inputId = "Vis_2_DurationWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">The difference in duration of input surveys is </span><span style=\"color:red;font-weight:bold\">", Vis_2_DurationDifference(),"</span><span style=\"color:black\"> days: </span><span style=\"color:red;font-weight:bold\">",Vis_2_DurationDifferenceMin(),"to",Vis_2_DurationDifferenceMax()," days</span>"))
  }else if(Vis_2_DurationDifference()==0){
    return(paste(as.character(actionLink(inputId = "Vis_2_DurationWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys have the same duration:</span><span style=\"color:green;font-weight:bold\">",Vis_2_DurationDifferenceMin(),"</span><span style=\"color:black\"> days</span>"))
  } else {
      
    }
  })
  
  observeEvent(input$Vis_2_DurationWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Duration Warning"),
            h4(strong("Surveys span a range of durations: ")),
            h4("Creel surveys may be conducted for differing lengths of time. Expansions are typically calculated to generate estimates for the surveyed period. 
               Because of this care should be taken when comparing surveys with differences in duration."),
            h4(strong("Recommendation: "), "Select surveys with similar durations to minimize the impacts of comparing longer and shorter surveys."),
            h4(strong("Recommendation: "), "Select duration indepedent rate based metrics if surveys spanning a wide range of durations are to be used. Examples include 
               percentages of various metrics, or 'Per Day' estimates (Such as Harvest per Day)"),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
# Start and End Dates  
  Vis_2_StartDifferenceMin<-reactive({req(Vis_2_WarningData())
    PH<-month.name[min(as.numeric(format(Vis_2_WarningData()$Start_Date, '%m')),na.rm=TRUE)]})
  Vis_2_StartDifferenceMax<-reactive({req(Vis_2_WarningData())
    PH<-month.name[max(as.numeric(format(Vis_2_WarningData()$Start_Date, '%m')),na.rm=TRUE)]})
  Vis_2_EndDifferenceMin<-reactive({req(Vis_2_WarningData())
    PH<-month.name[min(as.numeric(format(Vis_2_WarningData()$End_Date, '%m')),na.rm=TRUE)]})
  Vis_2_EndDifferenceMax<-reactive({req(Vis_2_WarningData())
    PH<-month.name[max(as.numeric(format(Vis_2_WarningData()$End_Date, '%m')),na.rm=TRUE)]})
  
  output$Vis_2_StartWarning<-renderText({
    req(Vis_2_StartDifferenceMin())
    req(Vis_2_StartDifferenceMax())
    if(Vis_2_StartDifferenceMin()==Vis_2_StartDifferenceMax()){
      return(paste(as.character(actionLink(inputId = "Vis_2_StartWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All surveys begin in </span><span style=\"color:green;font-weight:bold\">", Vis_2_StartDifferenceMin(),"</span>"))
  }else {
    return(paste(as.character(actionLink(inputId = "Vis_2_StartWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Start dates for input surveys range from </span><span style=\"color:red;font-weight:bold\">",Vis_2_StartDifferenceMin(), "</span><span style=\"color:black\"> to </span><span style=\"color:red;font-weight:bold\">", Vis_2_StartDifferenceMax(), "</span>"))
  }
  })
  
    output$Vis_2_EndWarning<-renderText({
    req(Vis_2_EndDifferenceMin())
    req(Vis_2_EndDifferenceMax())
    if(Vis_2_EndDifferenceMin()==Vis_2_EndDifferenceMax()){
      return(paste(as.character(actionLink(inputId = "Vis_2_EndWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All surveys conclude in </span><span style=\"color:green;font-weight:bold\">", Vis_2_EndDifferenceMin(),".</span>"))
  }else {
    return(paste(as.character(actionLink(inputId = "Vis_2_EndWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Conclusion dates for input surveys range from </span><span style=\"color:red;font-weight:bold\">",Vis_2_EndDifferenceMin(), "</span><span style=\"color:black\"> to </span><span style=\"color:red;font-weight:bold\">", Vis_2_EndDifferenceMax(), "</span>"))
  }
  }) 
    

  
  observeEvent(input$Vis_2_StartWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may cover different periods of the year: ")),
            h4("Creel surveys may be conducted across a variety of time periods. Attention should be paid to the start and end dates of surveys (as well as duration) 
               in order to make sure selected surveys are valid for user defined applications. For example some surveys may cover the winter angling, while others may cover spring/summer, 
               while others still may generate annual estimates (or nearly)."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those matching desired time periods based on 'Start' and 'End' months and Duration."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_2_EndWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may cover different periods of the year: ")),
            h4("Creel surveys may be conducted across a variety of time periods. Attention should be paid to the start and end dates of surveys (as well as duration) 
               in order to make sure selected surveys are valid for user defined applications. For example some surveys may cover the winter angling, while others may cover spring/summer, 
               while others still may generate annual estimates (or nearly)."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those matching desired time periods based on 'Start' and 'End' months and Duration."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  
    
# Survey Gaps #
    
    Vis_2_Survey_GapsWarn_Max<-reactive({req(Vis_2_WarningData())
      max(Vis_2_WarningData()$Lost_Duration,na.rm=TRUE)
      })
    
    output$Vis_2_Survey_GapsWarning<-renderText({
    if (Vis_2_Survey_GapsWarn_Max()>0){
      return(paste(as.character(actionLink(inputId = "Vis_2_Survey_GapsWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include those with gaps in the survey period. Maximum gap of: </span><span style=\"color:red;font-weight:bold\">", Vis_2_Survey_GapsWarn_Max(),"</span><span style=\"color:black\"> days.</span>"))
      } else {
    }
  })
    
  observeEvent(input$Vis_2_Survey_GapsWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Gap Warning"),
            h4(strong("Surveys may occasionally have a period of time between the start and end date when surveys (and associated expansions) do not occur: ")),
            h4("Creel surveys sometimes have periods of time for which the survey is suspended, often due to staffing issues. When documented we record both the lost duration 
               and months for which the survey was not taking place. This 'Lost Duration' is then substracted from the overall duration (End Date-Start Date) in order to provide an accurately 
               populate the 'Duration' field to reflect the number of days represented in survey estimates."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

# Survey Type #
    Vis_2_Survey_TypeWarn_Dat<-reactive({req(Vis_2_WarningData())
      as.list(as.character(unique(Vis_2_WarningData()$Survey_Type)))
      })
    
    Vis_2_Survey_TypeWarn_Vals<-reactive({req(Vis_2_Survey_TypeWarn_Dat())
      paste(Vis_2_Survey_TypeWarn_Dat(),collapse=" & ")
      })
    
    Vis_2_Survey_TypeWarn_Vals_3<-reactive({req(Vis_2_Survey_TypeWarn_Dat())
      paste(Vis_2_Survey_TypeWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_2_Survey_TypeWarn_Count<-reactive({req(Vis_2_Survey_TypeWarn_Dat())
      paste(length(Vis_2_Survey_TypeWarn_Dat()),"Types;")
      })
    
  output$Vis_2_Survey_TypeWarning<-renderText({
    if(length(Vis_2_Survey_TypeWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_2_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys are of the same type: </span><span style=\"color:green;font-weight:bold\">", Vis_2_Survey_TypeWarn_Dat(),"</span>"))
  }else if (length(Vis_2_Survey_TypeWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_2_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple types: </span><span style=\"color:red;font-weight:bold\">", Vis_2_Survey_TypeWarn_Count(),Vis_2_Survey_TypeWarn_Vals_3(),as.character(actionLink(inputId = "Vis_2_Survey_TypeWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_2_Survey_TypeWarn_Dat())<4&&length(Vis_2_Survey_TypeWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_2_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple types: </span><span style=\"color:red;font-weight:bold\">", Vis_2_Survey_TypeWarn_Count(), Vis_2_Survey_TypeWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_2_Survey_TypeWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Survey Methods"),
            HTML(paste(Vis_2_Survey_TypeWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_2_Survey_TypeWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Types Warning"),
            h4(strong("Surveys may include multiple type classifications: ")),
            h4("While most of the surveys contained in CreelCat are creel surveys (angler interviews and counts conducted on-site) we also included other types of angler 
            surveys to provide a more complete picture of angler data, particularly for areas where traditional creel surveys are not conducted. Many (although not all) of the other survey 
               approaches included in CreelCat are Mail/Phone/Online surveys where licensed anglers responses are solicited from anglers about there activities remotely."),
            h4("Consideration should be given as to how the different survey methods may impact any inferences drawn from comparisons which include multiple survey types."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
    
# Interview Methods #
    Vis_2_Interview_MethodWarn_Dat<-reactive({req(Vis_2_WarningData())
      as.list(as.character(unique(Vis_2_WarningData()$Interview_Method)))
      })
    Vis_2_Interview_MethodWarn_Vals<-reactive({req(Vis_2_Interview_MethodWarn_Dat())
      paste(Vis_2_Interview_MethodWarn_Dat(),collapse=" & ")
      })
    
    Vis_2_Interview_MethodWarn_Vals_3<-reactive({req(Vis_2_Interview_MethodWarn_Dat())
      paste(Vis_2_Interview_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_2_Interview_MethodWarn_Interview<-reactive({req(Vis_2_Interview_MethodWarn_Dat())
      paste(length(Vis_2_Interview_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_2_Interview_MethodWarning<-renderText({
    if(length(Vis_2_Interview_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_2_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same interview method: </span><span style=\"color:green;font-weight:bold\">", Vis_2_Interview_MethodWarn_Dat(),"</span>"))
  }else if (length(Vis_2_Interview_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_2_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple interview methods: </span><span style=\"color:red;font-weight:bold\">", Vis_2_Interview_MethodWarn_Interview(),Vis_2_Interview_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Vis_2_Interview_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_2_Interview_MethodWarn_Dat())<4&&length(Vis_2_Interview_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_2_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple interview methods: </span><span style=\"color:red;font-weight:bold\">", Vis_2_Interview_MethodWarn_Interview(), Vis_2_Interview_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_2_Interview_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Interview Methods"),
            HTML(paste(Vis_2_Interview_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_2_Interview_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Interview Methods Warning"),
            h4(strong("Surveys may include multiple interview methodologies: ")),
            h4("Creel surveys can employ a variety of methods for interviewing anglers. This warning identifies the various interview methodology classifications 
               associated with your selected inputs."),
            h4("While differences in methods for conducting angler interviews is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Count Methods #
    Vis_2_Count_MethodWarn_Dat<-reactive({req(Vis_2_WarningData())
      as.list(as.character(unique(Vis_2_WarningData()$Count_Method)))
      })
    Vis_2_Count_MethodWarn_Vals<-reactive({req(Vis_2_Count_MethodWarn_Dat())
      paste(Vis_2_Count_MethodWarn_Dat(),collapse=" & ")
      })
    
    Vis_2_Count_MethodWarn_Vals_3<-reactive({req(Vis_2_Count_MethodWarn_Dat())
      paste(Vis_2_Count_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_2_Count_MethodWarn_Count<-reactive({req(Vis_2_Count_MethodWarn_Dat())
      paste(length(Vis_2_Count_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_2_Count_MethodWarning<-renderText({
    if(length(Vis_2_Count_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_2_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same count method: </span><span style=\"color:green;font-weight:bold\">", Vis_2_Count_MethodWarn_Dat(),"</span>"))
  }else if (length(Vis_2_Count_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_2_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple count methods: </span><span style=\"color:red;font-weight:bold\">", Vis_2_Count_MethodWarn_Count(),Vis_2_Count_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Vis_2_Count_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_2_Count_MethodWarn_Dat())<4&&length(Vis_2_Count_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_2_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple count methods: </span><span style=\"color:red;font-weight:bold\">", Vis_2_Count_MethodWarn_Count(), Vis_2_Count_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_2_Count_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Count Methods"),
            HTML(paste(Vis_2_Count_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_2_Count_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Count Methods Warning"),
            h4(strong("Surveys may include multiple count methodologies: ")),
            h4("Creel surveys can employ a variety of methods for counting the number of anglers. This warning identifies the various count methodology classifications 
               associated with your selected inputs."),
            h4("While differences in methods for conducting angler counts is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  

    
    
# Estimate Methods #
    Vis_2_Estimate_MethodWarn_Dat<-reactive({req(Vis_2_WarningData())
      as.list(as.character(unique(Vis_2_WarningData()$Estimate_Method)))
      })
    Vis_2_Estimate_MethodWarn_Vals<-reactive({req(Vis_2_Estimate_MethodWarn_Dat())
      paste(Vis_2_Estimate_MethodWarn_Dat(),collapse=" & ")
      })
    
    Vis_2_Estimate_MethodWarn_Vals_3<-reactive({req(Vis_2_Estimate_MethodWarn_Dat())
      paste(Vis_2_Estimate_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_2_Estimate_MethodWarn_Estimate<-reactive({req(Vis_2_Estimate_MethodWarn_Dat())
      paste(length(Vis_2_Estimate_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_2_Estimate_MethodWarning<-renderText({
    if(length(Vis_2_Estimate_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_2_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same method for generating estimates: </span><span style=\"color:green;font-weight:bold\">", Vis_2_Estimate_MethodWarn_Dat(),"</span>"))
  }else if (length(Vis_2_Estimate_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_2_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple methods for generating estimates: </span><span style=\"color:red;font-weight:bold\">", Vis_2_Estimate_MethodWarn_Estimate(),Vis_2_Estimate_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Vis_2_Estimate_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_2_Estimate_MethodWarn_Dat())<4&&length(Vis_2_Estimate_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_2_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple methods for generating estimates: </span><span style=\"color:red;font-weight:bold\">", Vis_2_Estimate_MethodWarn_Estimate(), Vis_2_Estimate_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_2_Estimate_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Estimate Methods"),
            HTML(paste(Vis_2_Estimate_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_2_Estimate_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Estimate Methods Warning"),
            h4(strong("Surveys may include multiple estimate methodologies: ")),
            h4("Creel surveys can employ a variety of methods for generating estimates. This warning identifies the various estimate methodology classifications 
               associated with your selected input surveys."),
            h4("While differences in methods for generating estimates is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    

# Focal Species #
    Vis_2_Focal_SpeciesWarn_Dat<-reactive({req(Vis_2_WarningData())
      as.list(as.character(unique(Vis_2_WarningData()$Focal_Species)))
      })
    Vis_2_Focal_SpeciesWarn_Vals<-reactive({req(Vis_2_Focal_SpeciesWarn_Dat())
      paste(Vis_2_Focal_SpeciesWarn_Dat(),collapse=" & ")
      })
    
    Vis_2_Focal_SpeciesWarn_Vals_3<-reactive({req(Vis_2_Focal_SpeciesWarn_Dat())
      paste(Vis_2_Focal_SpeciesWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_2_Focal_SpeciesWarn_Estimate<-reactive({req(Vis_2_Focal_SpeciesWarn_Dat())
      paste(length(Vis_2_Focal_SpeciesWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_2_Focal_SpeciesWarning<-renderText({
    if(length(Vis_2_Focal_SpeciesWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_2_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys have the same classification for 'Focal Species': </span><span style=\"color:green;font-weight:bold\">", Vis_2_Focal_SpeciesWarn_Dat(),"</span>"))
  }else if (length(Vis_2_Focal_SpeciesWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_2_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys have multiple classifications for 'Focal Species': </span><span style=\"color:red;font-weight:bold\">", Vis_2_Focal_SpeciesWarn_Estimate(),Vis_2_Focal_SpeciesWarn_Vals_3(),as.character(actionLink(inputId = "Vis_2_Focal_SpeciesWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_2_Focal_SpeciesWarn_Dat())<4&&length(Vis_2_Focal_SpeciesWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_2_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys have multiple classifications for 'Focal Species': </span><span style=\"color:red;font-weight:bold\">", Vis_2_Focal_SpeciesWarn_Estimate(), Vis_2_Focal_SpeciesWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_2_Focal_SpeciesWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Focal Species Classifications"),
            HTML(paste(Vis_2_Focal_SpeciesWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_2_Focal_SpeciesWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Focal Species Warning"),
            h4(strong("Surveys may include multiple classifications for focal species: ")),
            h4("Creel surveys typically assess the full range of species captured/targetted by anglers, however sometimes creel surveys may only consider certain focal species without consideration of others. This warning identifies what classifications of focal species are included within the pool of selected surveys."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those including those species you are analyzing. This can mean including only surveys focused on 'All' taxa, or if you are interested in a specific taxa only including surveys listed as either 'All' or your taxa of interest. You may use the button below in the warning panel to drop surveys which are not inclusive of 'All' taxa."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

# Waterbody Type #
    Vis_2_WB_TypeWarn_Dat<-reactive({req(Vis_2_WarningData())
      as.list(as.character(unique(Vis_2_WarningData()$WB_Type)))
      })
    Vis_2_WB_TypeWarn_Vals<-reactive({req(Vis_2_WB_TypeWarn_Dat())
      paste(Vis_2_WB_TypeWarn_Dat(),collapse=" & ")
      })
    
    Vis_2_WB_TypeWarn_Vals_3<-reactive({req(Vis_2_WB_TypeWarn_Dat())
      paste(Vis_2_WB_TypeWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_2_WB_TypeWarn_Estimate<-reactive({req(Vis_2_WB_TypeWarn_Dat())
      paste(length(Vis_2_WB_TypeWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_2_WB_TypeWarning<-renderText({
    if(length(Vis_2_WB_TypeWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_2_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys are of the same waterbody type classification: </span><span style=\"color:green;font-weight:bold\">", Vis_2_WB_TypeWarn_Dat(),"</span>"))
  }else if (length(Vis_2_WB_TypeWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_2_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys span multiple waterbody type classifications: </span><span style=\"color:red;font-weight:bold\">", Vis_2_WB_TypeWarn_Estimate(),Vis_2_WB_TypeWarn_Vals_3(),as.character(actionLink(inputId = "Vis_2_WB_TypeWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_2_WB_TypeWarn_Dat())<4&&length(Vis_2_WB_TypeWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_2_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys span multiple waterbody type classifications: </span><span style=\"color:red;font-weight:bold\">", Vis_2_WB_TypeWarn_Estimate(), Vis_2_WB_TypeWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_2_WB_TypeWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Waterbody Type Classifications"),
            HTML(paste(Vis_2_WB_TypeWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_2_WB_TypeWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Waterbody Type Warning"),
            h4(strong("Surveys may include multiple classifications for waterbody type: ")),
            h4("Creel surveys contained in CreelCat come from freshwater systems across the United States. We have done our best to classify waterbody types as either 'Lakes, Reservoirs, Ponds, and Tailraces' or 'Streams and Rivers'. This warning identifies what classifications of waterbody types exist within your selection of surveys."),
            h4("There is nothing necessarily problematic about including both types within an analysis, however users should be aware of the presence of both waterbody types when using the dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Flagged Warning Heading #
  output$Vis_2_FlaggedHeading<-renderText({
    if(Vis_2_Timing_WarnWarn_Count()>0||
       Vis_2_Location_WarnWarn_Count()>0||
       Vis_2_Extent_WarnWarn_Count()>0
       ){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Flagged Survey Issues: </span></h4>"))
  }else {

  }
  }) 
  
# Timing Uncertain #
    
    Vis_2_Timing_WarnWarn_Count<-reactive({req(Vis_2_WarningData())
      PH<-Vis_2_WarningData()%>%
        filter(., Timing_Warn=="Unknown"|Timing_Warn=="Uncertain")
     
       return(count(PH))
      
      })
    
    output$Vis_2_Timing_WarnWarning<-renderText({
    if(Vis_2_Timing_WarnWarn_Count()==0){

  }else if (Vis_2_Timing_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Vis_2_Timing_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
             "<span style=\"color:black\">Input surveys include those with survey timing uncertainties: </span><span style=\"color:red;font-weight:bold\">", Vis_2_Timing_WarnWarn_Count(),"Surveys</span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Vis_2_Timing_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may be missing critical information regarding the timing of the survey: ")),
            h4("Creel surveys included in CreelCat typically include both start and end dates which allows users to determine when the survey took place and how long it lasted. Surveys which are missing start and/or end dates have been flagged as either uncertain or unknown."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that ris sensitive to the timing or duration of input surveys, surveys flagged as having unknown or uncertain timing should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Location Uncertain #
  
      Vis_2_Location_WarnWarn_Count<-reactive({req(Vis_2_WarningData())
      PH<-Vis_2_WarningData()%>%
        filter(., Location_Warn=="Unknown"|Location_Warn=="Uncertain")
      
      return(count(PH))
      
      })
    
    output$Vis_2_Location_WarnWarning<-renderText({
    if(Vis_2_Location_WarnWarn_Count()==0){

  }else if (Vis_2_Location_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Vis_2_Location_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include those with survey location uncertainties: </span><span style=\"color:red;font-weight:bold\">", Vis_2_Location_WarnWarn_Count(),"Surveys </span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Vis_2_Location_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Location Warning"),
            h4(strong("Surveys may be missing critical information regarding the location of the survey: ")),
            h4("Creel surveys included in CreelCat typically identify the location of the waterbody being surveyed. Surveys which are missing the information needed to generate the location of the survey have been flagged as either uncertain (location assigned according to our best judgement despite lack of required documentation) or unknown (no location assigned for a given survey)."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that is sensitive to the location of input surveys or requires any spatial information, surveys flagged as having unknown or uncertain locations should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    

    
# Extent Warning #
  
      Vis_2_Extent_WarnWarn_Count<-reactive({req(Vis_2_WarningData())
      PH<-Vis_2_WarningData()%>%
        filter(., Extent_Warn=="Unknown"|Extent_Warn=="Uncertain")
      return(count(PH))
      })
    
    output$Vis_2_Extent_WarnWarning<-renderText({
    if(Vis_2_Extent_WarnWarn_Count()==0){

  }else if (Vis_2_Extent_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Vis_2_Extent_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include those with survey extent uncertainties: </span><span style=\"color:red;font-weight:bold\">", Vis_2_Extent_WarnWarn_Count(),"Surveys </span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Vis_2_Extent_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Extent Warning"),
            h4(strong("Surveys may be missing critical information regarding the extent of the survey: ")),
            h4("Creel surveys included in CreelCat typically identify the extent of the waterbody being surveyed. Surveys which are missing the information needed to generate the extent of the survey have been flagged as either uncertain (extent assigned according to our best judgement despite lack of required documentation) or unknown (no extent assigned for a given survey)."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that is sensitive to the extent of input surveys or requires any spatial information, surveys flagged as having unknown or uncertain extents should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)    

    
  
### Warning Tables ###
  
  
    Vis_2_WarningTBL_SurveyChar<-reactive({
      req(Vis_2_WarningData())
      Vis_2_WarningData()%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Duration','Survey_Gaps','Lost_Duration','Survey_Type','Interview_Method','Count_Method','Estimate_Method','Location_Warn','Extent_Warn','Timing_Warn')%>%
        droplevels()
      })   
  
   
   output$Vis_2_WarnTBL_SurveyChar<-DT::renderDataTable(
    Vis_2_WarningTBL_SurveyChar(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )   
   

    Vis_2_WarningTBL_Non_Creel<-reactive({
      req(Vis_2_WarningData())
      Vis_2_WarningData()%>%
        filter(Survey_Type!='Creel Survey')%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Survey_Type')%>%
        droplevels()
      })   
   
   output$Vis_2_WarnTBL_Non_Creel<-DT::renderDataTable(
    Vis_2_WarningTBL_Non_Creel(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )   
   

    Vis_2_WarningTBL_Timing<-reactive({
      req(Vis_2_WarningData())
      Vis_2_WarningData()%>%
        filter(Timing_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Timing_Warn')%>%
        droplevels()
      })

   output$Vis_2_WarnTBL_Timing<-DT::renderDataTable(
    Vis_2_WarningTBL_Timing(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Vis_2_WarningTBL_Location<-reactive({
      req(Vis_2_WarningData())
      Vis_2_WarningData()%>%
        filter(Location_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Location_Warn')%>%
        droplevels()
      })

   output$Vis_2_WarnTBL_Location<-DT::renderDataTable(
    Vis_2_WarningTBL_Location(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Vis_2_WarningTBL_Extent<-reactive({
      req(Vis_2_WarningData())
      Vis_2_WarningData()%>%
        filter(Extent_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Extent_Warn')%>%
        droplevels()
      })

   output$Vis_2_WarnTBL_Extent<-DT::renderDataTable(
    Vis_2_WarningTBL_Extent(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Vis_2_WarningTBL_FocalSpecies<-reactive({
      req(Vis_2_WarningData())
      Vis_2_WarningData()%>%
        filter(Focal_Species!='All')%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Focal_Species')%>%
        droplevels()
      })

   output$Vis_2_WarnTBL_FocalSpecies<-DT::renderDataTable(
    Vis_2_WarningTBL_FocalSpecies(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
    
   #### Vis 3 Warning ####
    
  Vis_3_WarningData<-reactive({
      Vis_3_SelectedTBL_Raw()%>%select(Survey_ID)%>%left_join(Survey_Data)
    })

# Duration #
  Vis_3_DurationDifference<-reactive({
    req(Vis_3_WarningData())
    PH<-max(Vis_3_WarningData()$Duration,na.rm=TRUE)-min(Vis_3_WarningData()$Duration,na.rm=TRUE)
    })
  
  Vis_3_DurationDifferenceMin<-reactive({
    req(Vis_3_WarningData())
    PH<-min(Vis_3_WarningData()$Duration,na.rm=TRUE)
    })
  
  Vis_3_DurationDifferenceMax<-reactive({req(Vis_3_WarningData())
    PH<-max(Vis_3_WarningData()$Duration,na.rm=TRUE)
    })
  
  output$Vis_3_DurationWarning<-renderText({
    if(Vis_3_DurationDifference()>0){
      return(paste(as.character(actionLink(inputId = "Vis_3_DurationWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">The difference in duration of input surveys is </span><span style=\"color:red;font-weight:bold\">", Vis_3_DurationDifference(),"</span><span style=\"color:black\"> days: </span><span style=\"color:red;font-weight:bold\">",Vis_3_DurationDifferenceMin(),"to",Vis_3_DurationDifferenceMax()," days</span>"))
  }else if(Vis_3_DurationDifference()==0){
    return(paste(as.character(actionLink(inputId = "Vis_3_DurationWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys have the same duration:</span><span style=\"color:green;font-weight:bold\">",Vis_3_DurationDifferenceMin(),"</span><span style=\"color:black\"> days</span>"))
  } else {
      
    }
  })
  
  observeEvent(input$Vis_3_DurationWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Duration Warning"),
            h4(strong("Surveys span a range of durations: ")),
            h4("Creel surveys may be conducted for differing lengths of time. Expansions are typically calculated to generate estimates for the surveyed period. 
               Because of this care should be taken when comparing surveys with differences in duration."),
            h4(strong("Recommendation: "), "Select surveys with similar durations to minimize the impacts of comparing longer and shorter surveys."),
            h4(strong("Recommendation: "), "Select duration indepedent rate based metrics if surveys spanning a wide range of durations are to be used. Examples include 
               percentages of various metrics, or 'Per Day' estimates (Such as Harvest per Day)"),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
# Start and End Dates  
  Vis_3_StartDifferenceMin<-reactive({req(Vis_3_WarningData())
    PH<-month.name[min(as.numeric(format(Vis_3_WarningData()$Start_Date, '%m')),na.rm=TRUE)]})
  Vis_3_StartDifferenceMax<-reactive({req(Vis_3_WarningData())
    PH<-month.name[max(as.numeric(format(Vis_3_WarningData()$Start_Date, '%m')),na.rm=TRUE)]})
  Vis_3_EndDifferenceMin<-reactive({req(Vis_3_WarningData())
    PH<-month.name[min(as.numeric(format(Vis_3_WarningData()$End_Date, '%m')),na.rm=TRUE)]})
  Vis_3_EndDifferenceMax<-reactive({req(Vis_3_WarningData())
    PH<-month.name[max(as.numeric(format(Vis_3_WarningData()$End_Date, '%m')),na.rm=TRUE)]})
  
  output$Vis_3_StartWarning<-renderText({
    req(Vis_3_StartDifferenceMin())
    req(Vis_3_StartDifferenceMax())
    
    if(Vis_3_StartDifferenceMin()==Vis_3_StartDifferenceMax()){
      return(paste(as.character(actionLink(inputId = "Vis_3_StartWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All surveys begin in </span><span style=\"color:green;font-weight:bold\">", Vis_3_StartDifferenceMin(),"</span>"))
  }else {
    return(paste(as.character(actionLink(inputId = "Vis_3_StartWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Start dates for input surveys range from </span><span style=\"color:red;font-weight:bold\">",Vis_3_StartDifferenceMin(), "</span><span style=\"color:black\"> to </span><span style=\"color:red;font-weight:bold\">", Vis_3_StartDifferenceMax(), "</span>"))
  }
  })
  
    output$Vis_3_EndWarning<-renderText({
    req(Vis_3_EndDifferenceMin())
    req(Vis_3_EndDifferenceMax())
    if(Vis_3_EndDifferenceMin()==Vis_3_EndDifferenceMax()){
      return(paste(as.character(actionLink(inputId = "Vis_3_EndWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All surveys conclude in </span><span style=\"color:green;font-weight:bold\">", Vis_3_EndDifferenceMin(),".</span>"))
  }else {
    return(paste(as.character(actionLink(inputId = "Vis_3_EndWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Conclusion dates for input surveys range from </span><span style=\"color:red;font-weight:bold\">",Vis_3_EndDifferenceMin(), "</span><span style=\"color:black\"> to </span><span style=\"color:red;font-weight:bold\">", Vis_3_EndDifferenceMax(), "</span>"))
  }
  }) 
    

  
  observeEvent(input$Vis_3_StartWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may cover different periods of the year: ")),
            h4("Creel surveys may be conducted across a variety of time periods. Attention should be paid to the start and end dates of surveys (as well as duration) 
               in order to make sure selected surveys are valid for user defined applications. For example some surveys may cover the winter angling, while others may cover spring/summer, 
               while others still may generate annual estimates (or nearly)."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those matching desired time periods based on 'Start' and 'End' months and Duration."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_3_EndWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may cover different periods of the year: ")),
            h4("Creel surveys may be conducted across a variety of time periods. Attention should be paid to the start and end dates of surveys (as well as duration) 
               in order to make sure selected surveys are valid for user defined applications. For example some surveys may cover the winter angling, while others may cover spring/summer, 
               while others still may generate annual estimates (or nearly)."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those matching desired time periods based on 'Start' and 'End' months and Duration."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  
    
# Survey Gaps #
    
    Vis_3_Survey_GapsWarn_Max<-reactive({req(Vis_3_WarningData())
      max(Vis_3_WarningData()$Lost_Duration,na.rm=TRUE)
      })
    
    output$Vis_3_Survey_GapsWarning<-renderText({
    if (Vis_3_Survey_GapsWarn_Max()>0){
      return(paste(as.character(actionLink(inputId = "Vis_3_Survey_GapsWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include those with gaps in the survey period. Maximum gap of: </span><span style=\"color:red;font-weight:bold\">", Vis_3_Survey_GapsWarn_Max(),"</span><span style=\"color:black\"> days.</span>"))
      } else {
    }
  })
    
  observeEvent(input$Vis_3_Survey_GapsWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Gap Warning"),
            h4(strong("Surveys may occasionally have a period of time between the start and end date when surveys (and associated expansions) do not occur: ")),
            h4("Creel surveys sometimes have periods of time for which the survey is suspended, often due to staffing issues. When documented we record both the lost duration 
               and months for which the survey was not taking place. This 'Lost Duration' is then substracted from the overall duration (End Date-Start Date) in order to provide an accurately 
               populate the 'Duration' field to reflect the number of days represented in survey estimates."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

# Survey Type #
    Vis_3_Survey_TypeWarn_Dat<-reactive({req(Vis_3_WarningData())
      as.list(as.character(unique(Vis_3_WarningData()$Survey_Type)))
      })
    
    Vis_3_Survey_TypeWarn_Vals<-reactive({req(Vis_3_Survey_TypeWarn_Dat())
      paste(Vis_3_Survey_TypeWarn_Dat(),collapse=" & ")
      })
    
    Vis_3_Survey_TypeWarn_Vals_3<-reactive({req(Vis_3_Survey_TypeWarn_Dat())
      paste(Vis_3_Survey_TypeWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_3_Survey_TypeWarn_Count<-reactive({req(Vis_3_Survey_TypeWarn_Dat())
      paste(length(Vis_3_Survey_TypeWarn_Dat()),"Types;")
      })
    
  output$Vis_3_Survey_TypeWarning<-renderText({
    if(length(Vis_3_Survey_TypeWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_3_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys are of the same type: </span><span style=\"color:green;font-weight:bold\">", Vis_3_Survey_TypeWarn_Dat(),"</span>"))
  }else if (length(Vis_3_Survey_TypeWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_3_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple types: </span><span style=\"color:red;font-weight:bold\">", Vis_3_Survey_TypeWarn_Count(),Vis_3_Survey_TypeWarn_Vals_3(),as.character(actionLink(inputId = "Vis_3_Survey_TypeWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_3_Survey_TypeWarn_Dat())<4&&length(Vis_3_Survey_TypeWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_3_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple types: </span><span style=\"color:red;font-weight:bold\">", Vis_3_Survey_TypeWarn_Count(), Vis_3_Survey_TypeWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_3_Survey_TypeWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Survey Methods"),
            HTML(paste(Vis_3_Survey_TypeWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_3_Survey_TypeWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Types Warning"),
            h4(strong("Surveys may include multiple type classifications: ")),
            h4("While most of the surveys contained in CreelCat are creel surveys (angler interviews and counts conducted on-site) we also included other types of angler 
            surveys to provide a more complete picture of angler data, particularly for areas where traditional creel surveys are not conducted. Many (although not all) of the other survey 
               approaches included in CreelCat are Mail/Phone/Online surveys where licensed anglers responses are solicited from anglers about there activities remotely."),
            h4("Consideration should be given as to how the different survey methods may impact any inferences drawn from comparisons which include multiple survey types."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
    
# Interview Methods #
    Vis_3_Interview_MethodWarn_Dat<-reactive({req(Vis_3_WarningData())
      as.list(as.character(unique(Vis_3_WarningData()$Interview_Method)))
      })
    Vis_3_Interview_MethodWarn_Vals<-reactive({req(Vis_3_Interview_MethodWarn_Dat())
      paste(Vis_3_Interview_MethodWarn_Dat(),collapse=" & ")
      })
    
    Vis_3_Interview_MethodWarn_Vals_3<-reactive({req(Vis_3_Interview_MethodWarn_Dat())
      paste(Vis_3_Interview_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_3_Interview_MethodWarn_Interview<-reactive({req(Vis_3_Interview_MethodWarn_Dat())
      paste(length(Vis_3_Interview_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_3_Interview_MethodWarning<-renderText({
    if(length(Vis_3_Interview_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_3_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same interview method: </span><span style=\"color:green;font-weight:bold\">", Vis_3_Interview_MethodWarn_Dat(),"</span>"))
  }else if (length(Vis_3_Interview_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_3_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple interview methods: </span><span style=\"color:red;font-weight:bold\">", Vis_3_Interview_MethodWarn_Interview(),Vis_3_Interview_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Vis_3_Interview_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_3_Interview_MethodWarn_Dat())<4&&length(Vis_3_Interview_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_3_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple interview methods: </span><span style=\"color:red;font-weight:bold\">", Vis_3_Interview_MethodWarn_Interview(), Vis_3_Interview_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_3_Interview_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Interview Methods"),
            HTML(paste(Vis_3_Interview_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_3_Interview_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Interview Methods Warning"),
            h4(strong("Surveys may include multiple interview methodologies: ")),
            h4("Creel surveys can employ a variety of methods for interviewing anglers. This warning identifies the various interview methodology classifications 
               associated with your selected inputs."),
            h4("While differences in methods for conducting angler interviews is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Count Methods #
    Vis_3_Count_MethodWarn_Dat<-reactive({req(Vis_3_WarningData())
      as.list(as.character(unique(Vis_3_WarningData()$Count_Method)))
      })
    Vis_3_Count_MethodWarn_Vals<-reactive({req(Vis_3_Count_MethodWarn_Dat())
      paste(Vis_3_Count_MethodWarn_Dat(),collapse=" & ")
      })
    
    Vis_3_Count_MethodWarn_Vals_3<-reactive({req(Vis_3_Count_MethodWarn_Dat())
      paste(Vis_3_Count_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_3_Count_MethodWarn_Count<-reactive({req(Vis_3_Count_MethodWarn_Dat())
      paste(length(Vis_3_Count_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_3_Count_MethodWarning<-renderText({
    if(length(Vis_3_Count_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_3_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same count method: </span><span style=\"color:green;font-weight:bold\">", Vis_3_Count_MethodWarn_Dat(),"</span>"))
  }else if (length(Vis_3_Count_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_3_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple count methods: </span><span style=\"color:red;font-weight:bold\">", Vis_3_Count_MethodWarn_Count(),Vis_3_Count_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Vis_3_Count_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_3_Count_MethodWarn_Dat())<4&&length(Vis_3_Count_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_3_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple count methods: </span><span style=\"color:red;font-weight:bold\">", Vis_3_Count_MethodWarn_Count(), Vis_3_Count_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_3_Count_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Count Methods"),
            HTML(paste(Vis_3_Count_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_3_Count_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Count Methods Warning"),
            h4(strong("Surveys may include multiple count methodologies: ")),
            h4("Creel surveys can employ a variety of methods for counting the number of anglers. This warning identifies the various count methodology classifications 
               associated with your selected inputs."),
            h4("While differences in methods for conducting angler counts is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  

    
    
# Estimate Methods #
    Vis_3_Estimate_MethodWarn_Dat<-reactive({req(Vis_3_WarningData())
      as.list(as.character(unique(Vis_3_WarningData()$Estimate_Method)))
      })
    Vis_3_Estimate_MethodWarn_Vals<-reactive({req(Vis_3_Estimate_MethodWarn_Dat())
      paste(Vis_3_Estimate_MethodWarn_Dat(),collapse=" & ")
      })
    
    Vis_3_Estimate_MethodWarn_Vals_3<-reactive({req(Vis_3_Estimate_MethodWarn_Dat())
      paste(Vis_3_Estimate_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_3_Estimate_MethodWarn_Estimate<-reactive({req(Vis_3_Estimate_MethodWarn_Dat())
      paste(length(Vis_3_Estimate_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_3_Estimate_MethodWarning<-renderText({
    if(length(Vis_3_Estimate_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_3_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same method for generating estimates: </span><span style=\"color:green;font-weight:bold\">", Vis_3_Estimate_MethodWarn_Dat(),"</span>"))
  }else if (length(Vis_3_Estimate_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_3_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple methods for generating estimates: </span><span style=\"color:red;font-weight:bold\">", Vis_3_Estimate_MethodWarn_Estimate(),Vis_3_Estimate_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Vis_3_Estimate_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_3_Estimate_MethodWarn_Dat())<4&&length(Vis_3_Estimate_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_3_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple methods for generating estimates: </span><span style=\"color:red;font-weight:bold\">", Vis_3_Estimate_MethodWarn_Estimate(), Vis_3_Estimate_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_3_Estimate_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Estimate Methods"),
            HTML(paste(Vis_3_Estimate_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_3_Estimate_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Estimate Methods Warning"),
            h4(strong("Surveys may include multiple estimate methodologies: ")),
            h4("Creel surveys can employ a variety of methods for generating estimates. This warning identifies the various estimate methodology classifications 
               associated with your selected input surveys."),
            h4("While differences in methods for generating estimates is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    

# Focal Species #
    Vis_3_Focal_SpeciesWarn_Dat<-reactive({req(Vis_3_WarningData())
      as.list(as.character(unique(Vis_3_WarningData()$Focal_Species)))
      })
    Vis_3_Focal_SpeciesWarn_Vals<-reactive({req(Vis_3_Focal_SpeciesWarn_Dat())
      paste(Vis_3_Focal_SpeciesWarn_Dat(),collapse=" & ")
      })
    
    Vis_3_Focal_SpeciesWarn_Vals_3<-reactive({req(Vis_3_Focal_SpeciesWarn_Dat())
      paste(Vis_3_Focal_SpeciesWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_3_Focal_SpeciesWarn_Estimate<-reactive({req(Vis_3_Focal_SpeciesWarn_Dat())
      paste(length(Vis_3_Focal_SpeciesWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_3_Focal_SpeciesWarning<-renderText({
    if(length(Vis_3_Focal_SpeciesWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_3_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys have the same classification for 'Focal Species': </span><span style=\"color:green;font-weight:bold\">", Vis_3_Focal_SpeciesWarn_Dat(),"</span>"))
  }else if (length(Vis_3_Focal_SpeciesWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_3_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys have multiple classifications for 'Focal Species': </span><span style=\"color:red;font-weight:bold\">", Vis_3_Focal_SpeciesWarn_Estimate(),Vis_3_Focal_SpeciesWarn_Vals_3(),as.character(actionLink(inputId = "Vis_3_Focal_SpeciesWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_3_Focal_SpeciesWarn_Dat())<4&&length(Vis_3_Focal_SpeciesWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_3_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys have multiple classifications for 'Focal Species': </span><span style=\"color:red;font-weight:bold\">", Vis_3_Focal_SpeciesWarn_Estimate(), Vis_3_Focal_SpeciesWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_3_Focal_SpeciesWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Focal Species Classifications"),
            HTML(paste(Vis_3_Focal_SpeciesWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_3_Focal_SpeciesWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Focal Species Warning"),
            h4(strong("Surveys may include multiple classifications for focal species: ")),
            h4("Creel surveys typically assess the full range of species captured/targetted by anglers, however sometimes creel surveys may only consider certain focal species without consideration of others. This warning identifies what classifications of focal species are included within the pool of selected surveys."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those including those species you are analyzing. This can mean including only surveys focused on 'All' taxa, or if you are interested in a specific taxa only including surveys listed as either 'All' or your taxa of interest. You may use the button below in the warning panel to drop surveys which are not inclusive of 'All' taxa."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

# Waterbody Type #
    Vis_3_WB_TypeWarn_Dat<-reactive({req(Vis_3_WarningData())
      as.list(as.character(unique(Vis_3_WarningData()$WB_Type)))
      })
    Vis_3_WB_TypeWarn_Vals<-reactive({req(Vis_3_WB_TypeWarn_Dat())
      paste(Vis_3_WB_TypeWarn_Dat(),collapse=" & ")
      })
    
    Vis_3_WB_TypeWarn_Vals_3<-reactive({req(Vis_3_WB_TypeWarn_Dat())
      paste(Vis_3_WB_TypeWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_3_WB_TypeWarn_Estimate<-reactive({req(Vis_3_WB_TypeWarn_Dat())
      paste(length(Vis_3_WB_TypeWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_3_WB_TypeWarning<-renderText({
    if(length(Vis_3_WB_TypeWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_3_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys are of the same waterbody type classification: </span><span style=\"color:green;font-weight:bold\">", Vis_3_WB_TypeWarn_Dat(),"</span>"))
  }else if (length(Vis_3_WB_TypeWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_3_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys span multiple waterbody type classifications: </span><span style=\"color:red;font-weight:bold\">", Vis_3_WB_TypeWarn_Estimate(),Vis_3_WB_TypeWarn_Vals_3(),as.character(actionLink(inputId = "Vis_3_WB_TypeWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_3_WB_TypeWarn_Dat())<4&&length(Vis_3_WB_TypeWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_3_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys span multiple waterbody type classifications: </span><span style=\"color:red;font-weight:bold\">", Vis_3_WB_TypeWarn_Estimate(), Vis_3_WB_TypeWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_3_WB_TypeWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Waterbody Type Classifications"),
            HTML(paste(Vis_3_WB_TypeWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_3_WB_TypeWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Waterbody Type Warning"),
            h4(strong("Surveys may include multiple classifications for waterbody type: ")),
            h4("Creel surveys contained in CreelCat come from freshwater systems across the United States. We have done our best to classify waterbody types as either 'Lakes, Reservoirs, Ponds, and Tailraces' or 'Streams and Rivers'. This warning identifies what classifications of waterbody types exist within your selection of surveys."),
            h4("There is nothing necessarily problematic about including both types within an analysis, however users should be aware of the presence of both waterbody types when using the dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Flagged Warning Heading #
  output$Vis_3_FlaggedHeading<-renderText({
    if(Vis_3_Timing_WarnWarn_Count()>0||
       Vis_3_Location_WarnWarn_Count()>0||
       Vis_3_Extent_WarnWarn_Count()>0
       ){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Flagged Survey Issues: </span></h4>"))
  }else {

  }
  }) 
  
# Timing Uncertain #
    
    Vis_3_Timing_WarnWarn_Count<-reactive({req(Vis_3_WarningData())
      PH<-Vis_3_WarningData()%>%
        filter(., Timing_Warn=="Unknown"|Timing_Warn=="Uncertain")
     
       return(count(PH))
      
      })
    
    output$Vis_3_Timing_WarnWarning<-renderText({
    if(Vis_3_Timing_WarnWarn_Count()==0){

  }else if (Vis_3_Timing_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Vis_3_Timing_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
             "<span style=\"color:black\">Input surveys include those with survey timing uncertainties: </span><span style=\"color:red;font-weight:bold\">", Vis_3_Timing_WarnWarn_Count(),"Surveys</span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Vis_3_Timing_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may be missing critical information regarding the timing of the survey: ")),
            h4("Creel surveys included in CreelCat typically include both start and end dates which allows users to determine when the survey took place and how long it lasted. Surveys which are missing start and/or end dates have been flagged as either uncertain or unknown."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that ris sensitive to the timing or duration of input surveys, surveys flagged as having unknown or uncertain timing should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Location Uncertain #
  
      Vis_3_Location_WarnWarn_Count<-reactive({req(Vis_3_WarningData())
      PH<-Vis_3_WarningData()%>%
        filter(., Location_Warn=="Unknown"|Location_Warn=="Uncertain")
      
      return(count(PH))
      
      })
    
    output$Vis_3_Location_WarnWarning<-renderText({
    if(Vis_3_Location_WarnWarn_Count()==0){

  }else if (Vis_3_Location_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Vis_3_Location_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include those with survey location uncertainties: </span><span style=\"color:red;font-weight:bold\">", Vis_3_Location_WarnWarn_Count(),"Surveys </span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Vis_3_Location_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Location Warning"),
            h4(strong("Surveys may be missing critical information regarding the location of the survey: ")),
            h4("Creel surveys included in CreelCat typically identify the location of the waterbody being surveyed. Surveys which are missing the information needed to generate the location of the survey have been flagged as either uncertain (location assigned according to our best judgement despite lack of required documentation) or unknown (no location assigned for a given survey)."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that is sensitive to the location of input surveys or requires any spatial information, surveys flagged as having unknown or uncertain locations should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    

    
# Extent Warning #
  
      Vis_3_Extent_WarnWarn_Count<-reactive({req(Vis_3_WarningData())
      PH<-Vis_3_WarningData()%>%
        filter(., Extent_Warn=="Unknown"|Extent_Warn=="Uncertain")
      return(count(PH))
      })
    
    output$Vis_3_Extent_WarnWarning<-renderText({
    if(Vis_3_Extent_WarnWarn_Count()==0){

  }else if (Vis_3_Extent_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Vis_3_Extent_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include those with survey extent uncertainties: </span><span style=\"color:red;font-weight:bold\">", Vis_3_Extent_WarnWarn_Count(),"Surveys </span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Vis_3_Extent_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Extent Warning"),
            h4(strong("Surveys may be missing critical information regarding the extent of the survey: ")),
            h4("Creel surveys included in CreelCat typically identify the extent of the waterbody being surveyed. Surveys which are missing the information needed to generate the extent of the survey have been flagged as either uncertain (extent assigned according to our best judgement despite lack of required documentation) or unknown (no extent assigned for a given survey)."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that is sensitive to the extent of input surveys or requires any spatial information, surveys flagged as having unknown or uncertain extents should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)    

    
  
### Warning Tables ###
  
  
    Vis_3_WarningTBL_SurveyChar<-reactive({
      req(Vis_3_WarningData())
      Vis_3_WarningData()%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Duration','Survey_Gaps','Lost_Duration','Survey_Type','Interview_Method','Count_Method','Estimate_Method','Location_Warn','Extent_Warn','Timing_Warn')%>%
        droplevels()
      })   
  
   
   output$Vis_3_WarnTBL_SurveyChar<-DT::renderDataTable(
    Vis_3_WarningTBL_SurveyChar(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )   
   

    Vis_3_WarningTBL_Non_Creel<-reactive({
      req(Vis_3_WarningData())
      Vis_3_WarningData()%>%
        filter(Survey_Type!='Creel Survey')%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Survey_Type')%>%
        droplevels()
      })   
   
   output$Vis_3_WarnTBL_Non_Creel<-DT::renderDataTable(
    Vis_3_WarningTBL_Non_Creel(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )   
   

    Vis_3_WarningTBL_Timing<-reactive({
      req(Vis_3_WarningData())
      Vis_3_WarningData()%>%
        filter(Timing_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Timing_Warn')%>%
        droplevels()
      })

   output$Vis_3_WarnTBL_Timing<-DT::renderDataTable(
    Vis_3_WarningTBL_Timing(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Vis_3_WarningTBL_Location<-reactive({
      req(Vis_3_WarningData())
      Vis_3_WarningData()%>%
        filter(Location_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Location_Warn')%>%
        droplevels()
      })

   output$Vis_3_WarnTBL_Location<-DT::renderDataTable(
    Vis_3_WarningTBL_Location(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Vis_3_WarningTBL_Extent<-reactive({
      req(Vis_3_WarningData())
      Vis_3_WarningData()%>%
        filter(Extent_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Extent_Warn')%>%
        droplevels()
      })

   output$Vis_3_WarnTBL_Extent<-DT::renderDataTable(
    Vis_3_WarningTBL_Extent(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Vis_3_WarningTBL_FocalSpecies<-reactive({
      req(Vis_3_WarningData())
      Vis_3_WarningData()%>%
        filter(Focal_Species!='All')%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Focal_Species')%>%
        droplevels()
      })

   output$Vis_3_WarnTBL_FocalSpecies<-DT::renderDataTable(
    Vis_3_WarningTBL_FocalSpecies(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )    
 
    
   #### Vis 4 Warning ####
    
    
  Vis_4_WarningData<-reactive({
      Vis_4_SelectedTBL_Raw()%>%select(Survey_ID)%>%left_join(Survey_Data)
    })

# Duration #
  Vis_4_DurationDifference<-reactive({
    req(Vis_4_WarningData())
    PH<-max(Vis_4_WarningData()$Duration,na.rm=TRUE)-min(Vis_4_WarningData()$Duration,na.rm=TRUE)
    })
  
  Vis_4_DurationDifferenceMin<-reactive({
    req(Vis_4_WarningData())
    PH<-min(Vis_4_WarningData()$Duration,na.rm=TRUE)
    })
  
  Vis_4_DurationDifferenceMax<-reactive({req(Vis_4_WarningData())
    PH<-max(Vis_4_WarningData()$Duration,na.rm=TRUE)
    })
  
  output$Vis_4_DurationWarning<-renderText({
    if(Vis_4_DurationDifference()>0){
      return(paste(as.character(actionLink(inputId = "Vis_4_DurationWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">The difference in duration of input surveys is </span><span style=\"color:red;font-weight:bold\">", Vis_4_DurationDifference(),"</span><span style=\"color:black\"> days: </span><span style=\"color:red;font-weight:bold\">",Vis_4_DurationDifferenceMin(),"to",Vis_4_DurationDifferenceMax()," days</span>"))
  }else if(Vis_4_DurationDifference()==0){
    return(paste(as.character(actionLink(inputId = "Vis_4_DurationWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys have the same duration:</span><span style=\"color:green;font-weight:bold\">",Vis_4_DurationDifferenceMin(),"</span><span style=\"color:black\"> days</span>"))
  } else {
      
    }
  })
  
  observeEvent(input$Vis_4_DurationWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Duration Warning"),
            h4(strong("Surveys span a range of durations: ")),
            h4("Creel surveys may be conducted for differing lengths of time. Expansions are typically calculated to generate estimates for the surveyed period. 
               Because of this care should be taken when comparing surveys with differences in duration."),
            h4(strong("Recommendation: "), "Select surveys with similar durations to minimize the impacts of comparing longer and shorter surveys."),
            h4(strong("Recommendation: "), "Select duration indepedent rate based metrics if surveys spanning a wide range of durations are to be used. Examples include 
               percentages of various metrics, or 'Per Day' estimates (Such as Harvest per Day)"),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
# Start and End Dates  
  Vis_4_StartDifferenceMin<-reactive({req(Vis_4_WarningData())
    PH<-month.name[min(as.numeric(format(Vis_4_WarningData()$Start_Date, '%m')),na.rm=TRUE)]})
  Vis_4_StartDifferenceMax<-reactive({req(Vis_4_WarningData())
    PH<-month.name[max(as.numeric(format(Vis_4_WarningData()$Start_Date, '%m')),na.rm=TRUE)]})
  Vis_4_EndDifferenceMin<-reactive({req(Vis_4_WarningData())
    PH<-month.name[min(as.numeric(format(Vis_4_WarningData()$End_Date, '%m')),na.rm=TRUE)]})
  Vis_4_EndDifferenceMax<-reactive({req(Vis_4_WarningData())
    PH<-month.name[max(as.numeric(format(Vis_4_WarningData()$End_Date, '%m')),na.rm=TRUE)]})
  
  output$Vis_4_StartWarning<-renderText({
    req(Vis_4_StartDifferenceMin())
    req(Vis_4_StartDifferenceMax())
    
    if(Vis_4_StartDifferenceMin()==Vis_4_StartDifferenceMax()){
      return(paste(as.character(actionLink(inputId = "Vis_4_StartWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All surveys begin in </span><span style=\"color:green;font-weight:bold\">", Vis_4_StartDifferenceMin(),"</span>"))
  }else {
    return(paste(as.character(actionLink(inputId = "Vis_4_StartWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Start dates for input surveys range from </span><span style=\"color:red;font-weight:bold\">",Vis_4_StartDifferenceMin(), "</span><span style=\"color:black\"> to </span><span style=\"color:red;font-weight:bold\">", Vis_4_StartDifferenceMax(), "</span>"))
  }
  })
  
    output$Vis_4_EndWarning<-renderText({
    req(Vis_4_EndDifferenceMin())
    req(Vis_4_EndDifferenceMax())
    if(Vis_4_EndDifferenceMin()==Vis_4_EndDifferenceMax()){
      return(paste(as.character(actionLink(inputId = "Vis_4_EndWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All surveys conclude in </span><span style=\"color:green;font-weight:bold\">", Vis_4_EndDifferenceMin(),".</span>"))
  }else {
    return(paste(as.character(actionLink(inputId = "Vis_4_EndWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Conclusion dates for input surveys range from </span><span style=\"color:red;font-weight:bold\">",Vis_4_EndDifferenceMin(), "</span><span style=\"color:black\"> to </span><span style=\"color:red;font-weight:bold\">", Vis_4_EndDifferenceMax(), "</span>"))
  }
  }) 
    

  
  observeEvent(input$Vis_4_StartWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may cover different periods of the year: ")),
            h4("Creel surveys may be conducted across a variety of time periods. Attention should be paid to the start and end dates of surveys (as well as duration) 
               in order to make sure selected surveys are valid for user defined applications. For example some surveys may cover the winter angling, while others may cover spring/summer, 
               while others still may generate annual estimates (or nearly)."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those matching desired time periods based on 'Start' and 'End' months and Duration."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_4_EndWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may cover different periods of the year: ")),
            h4("Creel surveys may be conducted across a variety of time periods. Attention should be paid to the start and end dates of surveys (as well as duration) 
               in order to make sure selected surveys are valid for user defined applications. For example some surveys may cover the winter angling, while others may cover spring/summer, 
               while others still may generate annual estimates (or nearly)."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those matching desired time periods based on 'Start' and 'End' months and Duration."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  
    
# Survey Gaps #
    
    Vis_4_Survey_GapsWarn_Max<-reactive({req(Vis_4_WarningData())
      max(Vis_4_WarningData()$Lost_Duration,na.rm=TRUE)
      })
    
    output$Vis_4_Survey_GapsWarning<-renderText({
    if (Vis_4_Survey_GapsWarn_Max()>0){
      return(paste(as.character(actionLink(inputId = "Vis_4_Survey_GapsWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include those with gaps in the survey period. Maximum gap of: </span><span style=\"color:red;font-weight:bold\">", Vis_4_Survey_GapsWarn_Max(),"</span><span style=\"color:black\"> days.</span>"))
      } else {
    }
  })
    
  observeEvent(input$Vis_4_Survey_GapsWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Gap Warning"),
            h4(strong("Surveys may occasionally have a period of time between the start and end date when surveys (and associated expansions) do not occur: ")),
            h4("Creel surveys sometimes have periods of time for which the survey is suspended, often due to staffing issues. When documented we record both the lost duration 
               and months for which the survey was not taking place. This 'Lost Duration' is then substracted from the overall duration (End Date-Start Date) in order to provide an accurately 
               populate the 'Duration' field to reflect the number of days represented in survey estimates."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

# Survey Type #
    Vis_4_Survey_TypeWarn_Dat<-reactive({req(Vis_4_WarningData())
      as.list(as.character(unique(Vis_4_WarningData()$Survey_Type)))
      })
    
    Vis_4_Survey_TypeWarn_Vals<-reactive({req(Vis_4_Survey_TypeWarn_Dat())
      paste(Vis_4_Survey_TypeWarn_Dat(),collapse=" & ")
      })
    
    Vis_4_Survey_TypeWarn_Vals_3<-reactive({req(Vis_4_Survey_TypeWarn_Dat())
      paste(Vis_4_Survey_TypeWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_4_Survey_TypeWarn_Count<-reactive({req(Vis_4_Survey_TypeWarn_Dat())
      paste(length(Vis_4_Survey_TypeWarn_Dat()),"Types;")
      })
    
  output$Vis_4_Survey_TypeWarning<-renderText({
    if(length(Vis_4_Survey_TypeWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_4_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys are of the same type: </span><span style=\"color:green;font-weight:bold\">", Vis_4_Survey_TypeWarn_Dat(),"</span>"))
  }else if (length(Vis_4_Survey_TypeWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_4_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple types: </span><span style=\"color:red;font-weight:bold\">", Vis_4_Survey_TypeWarn_Count(),Vis_4_Survey_TypeWarn_Vals_3(),as.character(actionLink(inputId = "Vis_4_Survey_TypeWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_4_Survey_TypeWarn_Dat())<4&&length(Vis_4_Survey_TypeWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_4_Survey_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple types: </span><span style=\"color:red;font-weight:bold\">", Vis_4_Survey_TypeWarn_Count(), Vis_4_Survey_TypeWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_4_Survey_TypeWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Survey Methods"),
            HTML(paste(Vis_4_Survey_TypeWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_4_Survey_TypeWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Types Warning"),
            h4(strong("Surveys may include multiple type classifications: ")),
            h4("While most of the surveys contained in CreelCat are creel surveys (angler interviews and counts conducted on-site) we also included other types of angler 
            surveys to provide a more complete picture of angler data, particularly for areas where traditional creel surveys are not conducted. Many (although not all) of the other survey 
               approaches included in CreelCat are Mail/Phone/Online surveys where licensed anglers responses are solicited from anglers about there activities remotely."),
            h4("Consideration should be given as to how the different survey methods may impact any inferences drawn from comparisons which include multiple survey types."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
    
# Interview Methods #
    Vis_4_Interview_MethodWarn_Dat<-reactive({req(Vis_4_WarningData())
      as.list(as.character(unique(Vis_4_WarningData()$Interview_Method)))
      })
    Vis_4_Interview_MethodWarn_Vals<-reactive({req(Vis_4_Interview_MethodWarn_Dat())
      paste(Vis_4_Interview_MethodWarn_Dat(),collapse=" & ")
      })
    
    Vis_4_Interview_MethodWarn_Vals_3<-reactive({req(Vis_4_Interview_MethodWarn_Dat())
      paste(Vis_4_Interview_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_4_Interview_MethodWarn_Interview<-reactive({req(Vis_4_Interview_MethodWarn_Dat())
      paste(length(Vis_4_Interview_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_4_Interview_MethodWarning<-renderText({
    if(length(Vis_4_Interview_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_4_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same interview method: </span><span style=\"color:green;font-weight:bold\">", Vis_4_Interview_MethodWarn_Dat(),"</span>"))
  }else if (length(Vis_4_Interview_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_4_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple interview methods: </span><span style=\"color:red;font-weight:bold\">", Vis_4_Interview_MethodWarn_Interview(),Vis_4_Interview_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Vis_4_Interview_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_4_Interview_MethodWarn_Dat())<4&&length(Vis_4_Interview_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_4_Interview_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple interview methods: </span><span style=\"color:red;font-weight:bold\">", Vis_4_Interview_MethodWarn_Interview(), Vis_4_Interview_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_4_Interview_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Interview Methods"),
            HTML(paste(Vis_4_Interview_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_4_Interview_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Interview Methods Warning"),
            h4(strong("Surveys may include multiple interview methodologies: ")),
            h4("Creel surveys can employ a variety of methods for interviewing anglers. This warning identifies the various interview methodology classifications 
               associated with your selected inputs."),
            h4("While differences in methods for conducting angler interviews is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Count Methods #
    Vis_4_Count_MethodWarn_Dat<-reactive({req(Vis_4_WarningData())
      as.list(as.character(unique(Vis_4_WarningData()$Count_Method)))
      })
    Vis_4_Count_MethodWarn_Vals<-reactive({req(Vis_4_Count_MethodWarn_Dat())
      paste(Vis_4_Count_MethodWarn_Dat(),collapse=" & ")
      })
    
    Vis_4_Count_MethodWarn_Vals_3<-reactive({req(Vis_4_Count_MethodWarn_Dat())
      paste(Vis_4_Count_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_4_Count_MethodWarn_Count<-reactive({req(Vis_4_Count_MethodWarn_Dat())
      paste(length(Vis_4_Count_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_4_Count_MethodWarning<-renderText({
    if(length(Vis_4_Count_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_4_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same count method: </span><span style=\"color:green;font-weight:bold\">", Vis_4_Count_MethodWarn_Dat(),"</span>"))
  }else if (length(Vis_4_Count_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_4_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple count methods: </span><span style=\"color:red;font-weight:bold\">", Vis_4_Count_MethodWarn_Count(),Vis_4_Count_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Vis_4_Count_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_4_Count_MethodWarn_Dat())<4&&length(Vis_4_Count_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_4_Count_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple count methods: </span><span style=\"color:red;font-weight:bold\">", Vis_4_Count_MethodWarn_Count(), Vis_4_Count_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_4_Count_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Count Methods"),
            HTML(paste(Vis_4_Count_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_4_Count_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Count Methods Warning"),
            h4(strong("Surveys may include multiple count methodologies: ")),
            h4("Creel surveys can employ a variety of methods for counting the number of anglers. This warning identifies the various count methodology classifications 
               associated with your selected inputs."),
            h4("While differences in methods for conducting angler counts is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  

    
    
# Estimate Methods #
    Vis_4_Estimate_MethodWarn_Dat<-reactive({req(Vis_4_WarningData())
      as.list(as.character(unique(Vis_4_WarningData()$Estimate_Method)))
      })
    Vis_4_Estimate_MethodWarn_Vals<-reactive({req(Vis_4_Estimate_MethodWarn_Dat())
      paste(Vis_4_Estimate_MethodWarn_Dat(),collapse=" & ")
      })
    
    Vis_4_Estimate_MethodWarn_Vals_3<-reactive({req(Vis_4_Estimate_MethodWarn_Dat())
      paste(Vis_4_Estimate_MethodWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_4_Estimate_MethodWarn_Estimate<-reactive({req(Vis_4_Estimate_MethodWarn_Dat())
      paste(length(Vis_4_Estimate_MethodWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_4_Estimate_MethodWarning<-renderText({
    if(length(Vis_4_Estimate_MethodWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_4_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys use the same method for generating estimates: </span><span style=\"color:green;font-weight:bold\">", Vis_4_Estimate_MethodWarn_Dat(),"</span>"))
  }else if (length(Vis_4_Estimate_MethodWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_4_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple methods for generating estimates: </span><span style=\"color:red;font-weight:bold\">", Vis_4_Estimate_MethodWarn_Estimate(),Vis_4_Estimate_MethodWarn_Vals_3(),as.character(actionLink(inputId = "Vis_4_Estimate_MethodWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_4_Estimate_MethodWarn_Dat())<4&&length(Vis_4_Estimate_MethodWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_4_Estimate_MethodWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys include multiple methods for generating estimates: </span><span style=\"color:red;font-weight:bold\">", Vis_4_Estimate_MethodWarn_Estimate(), Vis_4_Estimate_MethodWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_4_Estimate_MethodWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Estimate Methods"),
            HTML(paste(Vis_4_Estimate_MethodWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_4_Estimate_MethodWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Estimate Methods Warning"),
            h4(strong("Surveys may include multiple estimate methodologies: ")),
            h4("Creel surveys can employ a variety of methods for generating estimates. This warning identifies the various estimate methodology classifications 
               associated with your selected input surveys."),
            h4("While differences in methods for generating estimates is not necessarily problematic, users may wish to consider this factor when evaluating potential 
               sources of variability within input surveys."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    

# Focal Species #
    Vis_4_Focal_SpeciesWarn_Dat<-reactive({req(Vis_4_WarningData())
      as.list(as.character(unique(Vis_4_WarningData()$Focal_Species)))
      })
    Vis_4_Focal_SpeciesWarn_Vals<-reactive({req(Vis_4_Focal_SpeciesWarn_Dat())
      paste(Vis_4_Focal_SpeciesWarn_Dat(),collapse=" & ")
      })
    
    Vis_4_Focal_SpeciesWarn_Vals_3<-reactive({req(Vis_4_Focal_SpeciesWarn_Dat())
      paste(Vis_4_Focal_SpeciesWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_4_Focal_SpeciesWarn_Estimate<-reactive({req(Vis_4_Focal_SpeciesWarn_Dat())
      paste(length(Vis_4_Focal_SpeciesWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_4_Focal_SpeciesWarning<-renderText({
    if(length(Vis_4_Focal_SpeciesWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_4_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys have the same classification for 'Focal Species': </span><span style=\"color:green;font-weight:bold\">", Vis_4_Focal_SpeciesWarn_Dat(),"</span>"))
  }else if (length(Vis_4_Focal_SpeciesWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_4_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys have multiple classifications for 'Focal Species': </span><span style=\"color:red;font-weight:bold\">", Vis_4_Focal_SpeciesWarn_Estimate(),Vis_4_Focal_SpeciesWarn_Vals_3(),as.character(actionLink(inputId = "Vis_4_Focal_SpeciesWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_4_Focal_SpeciesWarn_Dat())<4&&length(Vis_4_Focal_SpeciesWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_4_Focal_SpeciesWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys have multiple classifications for 'Focal Species': </span><span style=\"color:red;font-weight:bold\">", Vis_4_Focal_SpeciesWarn_Estimate(), Vis_4_Focal_SpeciesWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_4_Focal_SpeciesWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Focal Species Classifications"),
            HTML(paste(Vis_4_Focal_SpeciesWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_4_Focal_SpeciesWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Focal Species Warning"),
            h4(strong("Surveys may include multiple classifications for focal species: ")),
            h4("Creel surveys typically assess the full range of species captured/targetted by anglers, however sometimes creel surveys may only consider certain focal species without consideration of others. This warning identifies what classifications of focal species are included within the pool of selected surveys."),
            h4(strong("Recommendation: "), "Consider filtering surveys to only those including those species you are analyzing. This can mean including only surveys focused on 'All' taxa, or if you are interested in a specific taxa only including surveys listed as either 'All' or your taxa of interest. You may use the button below in the warning panel to drop surveys which are not inclusive of 'All' taxa."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)

# Waterbody Type #
    Vis_4_WB_TypeWarn_Dat<-reactive({req(Vis_4_WarningData())
      as.list(as.character(unique(Vis_4_WarningData()$WB_Type)))
      })
    Vis_4_WB_TypeWarn_Vals<-reactive({req(Vis_4_WB_TypeWarn_Dat())
      paste(Vis_4_WB_TypeWarn_Dat(),collapse=" & ")
      })
    
    Vis_4_WB_TypeWarn_Vals_3<-reactive({req(Vis_4_WB_TypeWarn_Dat())
      paste(Vis_4_WB_TypeWarn_Dat()[1:3],collapse=" & ")
      })
    
    Vis_4_WB_TypeWarn_Estimate<-reactive({req(Vis_4_WB_TypeWarn_Dat())
      paste(length(Vis_4_WB_TypeWarn_Dat()),"Classes;")
      })
    
    
  output$Vis_4_WB_TypeWarning<-renderText({
    if(length(Vis_4_WB_TypeWarn_Dat())==1){
      return(paste(as.character(actionLink(inputId = "Vis_4_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">All input surveys are of the same waterbody type classification: </span><span style=\"color:green;font-weight:bold\">", Vis_4_WB_TypeWarn_Dat(),"</span>"))
  }else if (length(Vis_4_WB_TypeWarn_Dat())>3){
    return(paste(as.character(actionLink(inputId = "Vis_4_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys span multiple waterbody type classifications: </span><span style=\"color:red;font-weight:bold\">", Vis_4_WB_TypeWarn_Estimate(),Vis_4_WB_TypeWarn_Vals_3(),as.character(actionLink(inputId = "Vis_4_WB_TypeWarn_Expand", HTML('... Click Here To View All'))),"</span>"))
  } else if (length(Vis_4_WB_TypeWarn_Dat())<4&&length(Vis_4_WB_TypeWarn_Dat())>1){
    return(paste(as.character(actionLink(inputId = "Vis_4_WB_TypeWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),"<span style=\"color:black\">Input surveys span multiple waterbody type classifications: </span><span style=\"color:red;font-weight:bold\">", Vis_4_WB_TypeWarn_Estimate(), Vis_4_WB_TypeWarn_Vals(),"</span>"))
  } else {
    }
  })
  
  observeEvent(input$Vis_4_WB_TypeWarn_Expand,{
        showModal(modalDialog(
            footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Full List of Waterbody Type Classifications"),
            HTML(paste(Vis_4_WB_TypeWarn_Dat(),collapse="<br/>")),
            br(),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
  
  observeEvent(input$Vis_4_WB_TypeWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Waterbody Type Warning"),
            h4(strong("Surveys may include multiple classifications for waterbody type: ")),
            h4("Creel surveys contained in CreelCat come from freshwater systems across the United States. We have done our best to classify waterbody types as either 'Lakes, Reservoirs, Ponds, and Tailraces' or 'Streams and Rivers'. This warning identifies what classifications of waterbody types exist within your selection of surveys."),
            h4("There is nothing necessarily problematic about including both types within an analysis, however users should be aware of the presence of both waterbody types when using the dataset."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Flagged Warning Heading #
  output$Vis_4_FlaggedHeading<-renderText({
    if(Vis_4_Timing_WarnWarn_Count()>0||
       Vis_4_Location_WarnWarn_Count()>0||
       Vis_4_Extent_WarnWarn_Count()>0
       ){
      return(paste("<h4><span style=\"color:black;font-weight:bold\">Flagged Survey Issues: </span></h4>"))
  }else {

  }
  }) 
  
# Timing Uncertain #
    
    Vis_4_Timing_WarnWarn_Count<-reactive({req(Vis_4_WarningData())
      PH<-Vis_4_WarningData()%>%
        filter(., Timing_Warn=="Unknown"|Timing_Warn=="Uncertain")
     
       return(count(PH))
      
      })
    
    output$Vis_4_Timing_WarnWarning<-renderText({
    if(Vis_4_Timing_WarnWarn_Count()==0){

  }else if (Vis_4_Timing_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Vis_4_Timing_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
             "<span style=\"color:black\">Input surveys include those with survey timing uncertainties: </span><span style=\"color:red;font-weight:bold\">", Vis_4_Timing_WarnWarn_Count(),"Surveys</span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Vis_4_Timing_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Timing Warning"),
            h4(strong("Surveys may be missing critical information regarding the timing of the survey: ")),
            h4("Creel surveys included in CreelCat typically include both start and end dates which allows users to determine when the survey took place and how long it lasted. Surveys which are missing start and/or end dates have been flagged as either uncertain or unknown."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that ris sensitive to the timing or duration of input surveys, surveys flagged as having unknown or uncertain timing should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    
# Location Uncertain #
  
      Vis_4_Location_WarnWarn_Count<-reactive({req(Vis_4_WarningData())
      PH<-Vis_4_WarningData()%>%
        filter(., Location_Warn=="Unknown"|Location_Warn=="Uncertain")
      
      return(count(PH))
      
      })
    
    output$Vis_4_Location_WarnWarning<-renderText({
    if(Vis_4_Location_WarnWarn_Count()==0){

  }else if (Vis_4_Location_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Vis_4_Location_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include those with survey location uncertainties: </span><span style=\"color:red;font-weight:bold\">", Vis_4_Location_WarnWarn_Count(),"Surveys </span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Vis_4_Location_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Location Warning"),
            h4(strong("Surveys may be missing critical information regarding the location of the survey: ")),
            h4("Creel surveys included in CreelCat typically identify the location of the waterbody being surveyed. Surveys which are missing the information needed to generate the location of the survey have been flagged as either uncertain (location assigned according to our best judgement despite lack of required documentation) or unknown (no location assigned for a given survey)."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that is sensitive to the location of input surveys or requires any spatial information, surveys flagged as having unknown or uncertain locations should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)
    

    
# Extent Warning #
  
      Vis_4_Extent_WarnWarn_Count<-reactive({req(Vis_4_WarningData())
      PH<-Vis_4_WarningData()%>%
        filter(., Extent_Warn=="Unknown"|Extent_Warn=="Uncertain")
      return(count(PH))
      })
    
    output$Vis_4_Extent_WarnWarning<-renderText({
    if(Vis_4_Extent_WarnWarn_Count()==0){

  }else if (Vis_4_Extent_WarnWarn_Count()>0){
      return(paste(as.character(actionLink(inputId = "Vis_4_Extent_WarnWarn_Tip", HTML('<i class="fas fa-info-circle"></i>'))),
                   "<span style=\"color:black\">Input surveys include those with survey extent uncertainties: </span><span style=\"color:red;font-weight:bold\">", Vis_4_Extent_WarnWarn_Count(),"Surveys </span>")
             )
  } else {
  }
    })
  
  observeEvent(input$Vis_4_Extent_WarnWarn_Tip,{
        showModal(modalDialog(
     footer=list(modalButton(label="Close")),
            size=c("l"),
            title = strong("Survey Extent Warning"),
            h4(strong("Surveys may be missing critical information regarding the extent of the survey: ")),
            h4("Creel surveys included in CreelCat typically identify the extent of the waterbody being surveyed. Surveys which are missing the information needed to generate the extent of the survey have been flagged as either uncertain (extent assigned according to our best judgement despite lack of required documentation) or unknown (no extent assigned for a given survey)."),
            h4(strong("Recommendation: "), "If the user wishes to use a dataset in a way that is sensitive to the extent of input surveys or requires any spatial information, surveys flagged as having unknown or uncertain extents should be dropped using the button below (within the warning panel)."),
            easyClose = TRUE
        ))
    },ignoreInit=TRUE)    

    
  
### Warning Tables ###
  
  
    Vis_4_WarningTBL_SurveyChar<-reactive({
      req(Vis_4_WarningData())
      Vis_4_WarningData()%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Duration','Survey_Gaps','Lost_Duration','Survey_Type','Interview_Method','Count_Method','Estimate_Method','Location_Warn','Extent_Warn','Timing_Warn')%>%
        droplevels()
      })   
  
   
   output$Vis_4_WarnTBL_SurveyChar<-DT::renderDataTable(
    Vis_4_WarningTBL_SurveyChar(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )   
   

    Vis_4_WarningTBL_Non_Creel<-reactive({
      req(Vis_4_WarningData())
      Vis_4_WarningData()%>%
        filter(Survey_Type!='Creel Survey')%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Survey_Type')%>%
        droplevels()
      })   
   
   output$Vis_4_WarnTBL_Non_Creel<-DT::renderDataTable(
    Vis_4_WarningTBL_Non_Creel(), 
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )   
   

    Vis_4_WarningTBL_Timing<-reactive({
      req(Vis_4_WarningData())
      Vis_4_WarningData()%>%
        filter(Timing_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Timing_Warn')%>%
        droplevels()
      })

   output$Vis_4_WarnTBL_Timing<-DT::renderDataTable(
    Vis_4_WarningTBL_Timing(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Vis_4_WarningTBL_Location<-reactive({
      req(Vis_4_WarningData())
      Vis_4_WarningData()%>%
        filter(Location_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Location_Warn')%>%
        droplevels()
      })

   output$Vis_4_WarnTBL_Location<-DT::renderDataTable(
    Vis_4_WarningTBL_Location(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Vis_4_WarningTBL_Extent<-reactive({
      req(Vis_4_WarningData())
      Vis_4_WarningData()%>%
        filter(Extent_Warn%in%c("Uncertain","Unknown"))%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Extent_Warn')%>%
        droplevels()
      })

   output$Vis_4_WarnTBL_Extent<-DT::renderDataTable(
    Vis_4_WarningTBL_Extent(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
   
    Vis_4_WarningTBL_FocalSpecies<-reactive({
      req(Vis_4_WarningData())
      Vis_4_WarningData()%>%
        filter(Focal_Species!='All')%>%
        select('Survey_ID','Waterbody_Name_Unique','State','Year','Start_Date','End_Date','Focal_Species')%>%
        droplevels()
      })

   output$Vis_4_WarnTBL_FocalSpecies<-DT::renderDataTable(
    Vis_4_WarningTBL_FocalSpecies(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list('selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
 
 
    #### Visualizations ####
    
# Turn off linked selection when no shared data #
    observeEvent(input$AF_SharedData,{
      if(input$AF_SharedData=="No"){
        updateRadioGroupButtons(session, "AF_LinkedSelection", selected="No")
      }
    },ignoreInit=TRUE)
    
# Display appropriate visualization tables #   
    observeEvent(
      c(input$AF_VisNum_Selection,
        input$AF_SharedData,
        input$AF_LinkedSelection
      ),
      {
        if(
          is.null(input$AF_VisNum_Selection) ||
          (input$AF_VisNum_Selection!="1"&&((is.null(input$AF_SharedData))||(input$AF_SharedData=="Yes"&&is.null(input$AF_LinkedSelection))))
        ){
          hideTab(inputId = "VisDataTabsetPanels", target = "Input Data")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selected Data")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 1)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 1)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 2)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 2)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 3)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 3)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 4)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 4)")
        }else if (
          input$AF_VisNum_Selection=="1"
        ){
          hideTab(inputId = "VisDataTabsetPanels", target = "Input Data")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selected Data")
          showTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 1)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 1)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 2)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 2)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 3)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 3)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 4)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 4)")
        }else if(
          input$AF_SharedData=="Yes" && input$AF_LinkedSelection=="Yes"
        ){
          showTab(inputId = "VisDataTabsetPanels", target = "Input Data")
          showTab(inputId = "VisDataTabsetPanels", target = "Selected Data")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 1)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 1)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 2)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 2)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 3)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 3)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 4)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 4)")
        }else if (
          input$AF_SharedData=="Yes" && input$AF_LinkedSelection=="No" &&input$AF_VisNum_Selection=="2"
        ){
          showTab(inputId = "VisDataTabsetPanels", target = "Input Data")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selected Data")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 1)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 1)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 2)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 2)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 3)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 3)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 4)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 4)")
        }else if (
          input$AF_SharedData=="Yes" && input$AF_LinkedSelection=="No" &&input$AF_VisNum_Selection=="3"
        ){
          showTab(inputId = "VisDataTabsetPanels", target = "Input Data")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selected Data")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 1)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 1)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 2)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 2)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 3)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 3)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 4)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 4)")
        }else if (
          input$AF_SharedData=="Yes" && input$AF_LinkedSelection=="No" &&input$AF_VisNum_Selection=="4"
        ){
          showTab(inputId = "VisDataTabsetPanels", target = "Input Data")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selected Data")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 1)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 1)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 2)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 2)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 3)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 3)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 4)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 4)")
        }else if (
          input$AF_SharedData=="No"&&input$AF_VisNum_Selection=="2"
        ){
          hideTab(inputId = "VisDataTabsetPanels", target = "Input Data")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selected Data")
          showTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 1)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 1)")
          showTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 2)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 2)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 3)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 3)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 4)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 4)")
        }else if (
          input$AF_SharedData=="No"&&input$AF_VisNum_Selection=="3"
        ){
          hideTab(inputId = "VisDataTabsetPanels", target = "Input Data")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selected Data")
          showTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 1)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 1)")
          showTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 2)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 2)")
          showTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 3)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 3)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 4)")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 4)")
        }else if (
          input$AF_SharedData=="No"&&input$AF_VisNum_Selection=="4"
        ){
          hideTab(inputId = "VisDataTabsetPanels", target = "Input Data")
          hideTab(inputId = "VisDataTabsetPanels", target = "Selected Data")
          showTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 1)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 1)")
          showTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 2)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 2)")
          showTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 3)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 3)")
          showTab(inputId = "VisDataTabsetPanels", target = "Input (Vis. 4)")
          showTab(inputId = "VisDataTabsetPanels", target = "Selection (Vis. 4)")
        }
      },ignoreInit=TRUE
    )


    

#### Pie Server ####
    #### Vis 1 Pie Inputs ####
    observe({
      Vis1_Pie_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis1_Pie_Choices<-list()
      Vis1_Pie_Choices[Vis1_Pie_ChoiceNames]<-Vis1_Pie_ChoiceNames
      updatePickerInput(session, "Vis1_Pie_Metrics", choices=c(Vis1_Pie_Choices),selected="")
    })
    
    observe({
      Vis1_PieCat_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis1_PieCat_Choices<-list()
      Vis1_PieCat_Choices[Vis1_PieCat_ChoiceNames]<-Vis1_PieCat_ChoiceNames
      updatePickerInput(session, "Vis1_Pie_Metrics_to_Sum", choices=c(Vis1_PieCat_Choices),selected="")
    })
    
  #### Vis 2 Pie Inputs ####
    observe({
      Vis2_Pie_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis2_Pie_Choices<-list()
      Vis2_Pie_Choices[Vis2_Pie_ChoiceNames]<-Vis2_Pie_ChoiceNames
      updatePickerInput(session, "Vis2_Pie_Metrics", choices=c(Vis2_Pie_Choices),selected="")
    })
    
    observe({
      Vis2_PieCat_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis2_PieCat_Choices<-list()
      Vis2_PieCat_Choices[Vis2_PieCat_ChoiceNames]<-Vis2_PieCat_ChoiceNames
      updatePickerInput(session, "Vis2_Pie_Metrics_to_Sum", choices=c(Vis2_PieCat_Choices),selected="")
    })
    
    Vis2_Pie_Title<-reactive(input$Vis2_PieTitle)
    Vis2_Pie_HideLegend<-reactive({input$Vis2_Pie_HideLegend})
    #### Vis 3 Pie Inputs ####
    observe({
      Vis3_Pie_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis3_Pie_Choices<-list()
      Vis3_Pie_Choices[Vis3_Pie_ChoiceNames]<-Vis3_Pie_ChoiceNames
      updatePickerInput(session, "Vis3_Pie_Metrics", choices=c(Vis3_Pie_Choices),selected="")
    })
    
    observe({
      Vis3_PieCat_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis3_PieCat_Choices<-list()
      Vis3_PieCat_Choices[Vis3_PieCat_ChoiceNames]<-Vis3_PieCat_ChoiceNames
      updatePickerInput(session, "Vis3_Pie_Metrics_to_Sum", choices=c(Vis3_PieCat_Choices),selected="")
    })
    
    Vis3_Pie_Title<-reactive(input$Vis3_PieTitle)
    Vis3_Pie_HideLegend<-reactive({input$Vis3_Pie_HideLegend})
    #### Vis 4 Pie Inputs ####
    observe({
      Vis4_Pie_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis4_Pie_Choices<-list()
      Vis4_Pie_Choices[Vis4_Pie_ChoiceNames]<-Vis4_Pie_ChoiceNames
      updatePickerInput(session, "Vis4_Pie_Metrics", choices=c(Vis4_Pie_Choices),selected="")
    })
    
    observe({
      Vis4_PieCat_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis4_PieCat_Choices<-list()
      Vis4_PieCat_Choices[Vis4_PieCat_ChoiceNames]<-Vis4_PieCat_ChoiceNames
      updatePickerInput(session, "Vis4_Pie_Metrics_to_Sum", choices=c(Vis4_PieCat_Choices),selected="")
    })
    
    Vis4_Pie_Title<-reactive(input$Vis4_PieTitle)
    Vis4_Pie_HideLegend<-reactive({input$Vis4_Pie_HideLegend})
  #### Vis 1_1 Pie ####
  
  Vis_1_1_PieData_Metrics<-reactive({
    req(length(Data_1_1())>0)
      Data_1_1()%>%select(input$Vis1_Pie_Metrics)
    })
  
  Vis_1_1_PieData_Surveys<-reactive({
    req(length(Data_1_1())>0)
    Data_1_1()%>%select(c("Survey_ID",input$Vis1_Pie_Metrics_to_Sum))
  })
     
  Vis_1_1_PieLabels_Metrics<-reactive({
    colnames(Vis_1_1_PieData_Metrics())
  })
  
  Vis_1_1_PieLabels_Surveys<-reactive({
    req(length(Data_1_1())>0)
    paste(Data_1_1()$Waterbody_Name_Unique,Data_1_1()$Year, Data_1_1()$Survey_ID,sep="\n")
  })
   
      
  Vis_1_1_PieValues_Metrics<-reactive({
    PH<-colSums(Vis_1_1_PieData_Metrics())
    PH[sort(names(PH))]
    return(PH)
    })
  
  Vis_1_1_PieValues_Surveys<-reactive({
    rowSums(Vis_1_1_PieData_Surveys()%>%select(-c("Survey_ID")))
  })
  

  output$Vis_1_1_Pie_Metrics<-renderPlotly({
    Vis_1_1_Pie_Metrics <- plot_ly(type='pie', sort=FALSE, labels=Vis_1_1_PieLabels_Metrics(), values=Vis_1_1_PieValues_Metrics(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis1_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis1_PieX,y=input$Vis1_PieY,orientation=input$Vis1_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis1_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_1_1_Pie_Metrics
  })
  
  


  
  output$Vis_1_1_Pie_Surveys<-renderPlotly({
    Vis_1_1_Pie_Surveys <- plot_ly(type='pie', sort=FALSE, labels=Vis_1_1_PieLabels_Surveys(), values=Vis_1_1_PieValues_Surveys(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis1_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis1_PieX,y=input$Vis1_PieY,orientation=input$Vis1_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis1_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_1_1_Pie_Surveys
  })
  
  
  #### Vis 2_1 Pie ####

  Vis_2_1_PieData_Metrics<-reactive({
    req(length(Data_2_1_Selected())>0)
      Data_2_1_Selected()%>%select(input$Vis1_Pie_Metrics)
    })

  Vis_2_1_PieData_Surveys<-reactive({
    req(length(Data_2_1_Selected())>0)
    Data_2_1_Selected()%>%select(c("Survey_ID",input$Vis1_Pie_Metrics_to_Sum))
  })
     
  Vis_2_1_PieLabels_Metrics<-reactive({
    colnames(Vis_2_1_PieData_Metrics())
  })
  
  Vis_2_1_PieLabels_Surveys<-reactive({
    req(length(Data_2_1_Selected())>0)
    paste(Data_2_1_Selected()$Waterbody_Name_Unique,Data_2_1_Selected()$Year, Data_2_1_Selected()$Survey_ID,sep="\n")
  })
   
      
  Vis_2_1_PieValues_Metrics<-reactive({
    PH<-colSums(Vis_2_1_PieData_Metrics())
    PH[sort(names(PH))]
    return(PH)
    })
  
  Vis_2_1_PieValues_Surveys<-reactive({
    rowSums(Vis_2_1_PieData_Surveys()%>%select(-c("Survey_ID")))
  })
  

  output$Vis_2_1_Pie_Metrics<-renderPlotly({
    Vis_2_1_Pie_Metrics <- plot_ly(type='pie', sort=FALSE, labels=Vis_2_1_PieLabels_Metrics(), values=Vis_2_1_PieValues_Metrics(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis1_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis1_PieX,y=input$Vis1_PieY,orientation=input$Vis1_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis1_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_2_1_Pie_Metrics
  })
  
  output$Vis_2_1_Pie_Surveys<-renderPlotly({
    Vis_2_1_Pie_Surveys <- plot_ly(type='pie', sort=FALSE, labels=Vis_2_1_PieLabels_Surveys(), values=Vis_2_1_PieValues_Surveys(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis1_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis1_PieX,y=input$Vis1_PieY,orientation=input$Vis1_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis1_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_2_1_Pie_Surveys
  })
  

  
  
  
  
  #### Vis 3_1 Pie ####

  Vis_3_1_PieData_Metrics<-reactive({
    req(length(Data_3_1_Selected())>0)
      Data_3_1_Selected()%>%select(input$Vis1_Pie_Metrics)
    })

  Vis_3_1_PieData_Surveys<-reactive({
    req(length(Data_3_1_Selected())>0)
    Data_3_1_Selected()%>%select(c("Survey_ID",input$Vis1_Pie_Metrics_to_Sum))
  })
     
  Vis_3_1_PieLabels_Metrics<-reactive({
    colnames(Vis_3_1_PieData_Metrics())
  })
  
  Vis_3_1_PieLabels_Surveys<-reactive({
    req(length(Data_3_1_Selected())>0)
    paste(Data_3_1_Selected()$Waterbody_Name_Unique,Data_3_1_Selected()$Year, Data_3_1_Selected()$Survey_ID,sep="\n")
  })
   
      
  Vis_3_1_PieValues_Metrics<-reactive({
    PH<-colSums(Vis_3_1_PieData_Metrics())
    PH[sort(names(PH))]
    return(PH)
    })
  
  Vis_3_1_PieValues_Surveys<-reactive({
    rowSums(Vis_3_1_PieData_Surveys()%>%select(-c("Survey_ID")))
  })
  

  output$Vis_3_1_Pie_Metrics<-renderPlotly({
    Vis_3_1_Pie_Metrics <- plot_ly(type='pie', sort=FALSE, labels=Vis_3_1_PieLabels_Metrics(), values=Vis_3_1_PieValues_Metrics(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis1_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis1_PieX,y=input$Vis1_PieY,orientation=input$Vis1_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis1_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_3_1_Pie_Metrics
  })
  
  output$Vis_3_1_Pie_Surveys<-renderPlotly({
    Vis_3_1_Pie_Surveys <- plot_ly(type='pie', sort=FALSE, labels=Vis_3_1_PieLabels_Surveys(), values=Vis_3_1_PieValues_Surveys(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis1_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis1_PieX,y=input$Vis1_PieY,orientation=input$Vis1_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis1_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_3_1_Pie_Surveys
  })
  #### Vis 4_1 Pie ####

  Vis_4_1_PieData_Metrics<-reactive({
    req(length(Data_4_1_Selected())>0)
      Data_4_1_Selected()%>%select(input$Vis1_Pie_Metrics)
    })

  Vis_4_1_PieData_Surveys<-reactive({
    req(length(Data_4_1_Selected())>0)
    Data_4_1_Selected()%>%select(c("Survey_ID",input$Vis1_Pie_Metrics_to_Sum))
  })
     
  Vis_4_1_PieLabels_Metrics<-reactive({
    colnames(Vis_4_1_PieData_Metrics())
  })
  
  Vis_4_1_PieLabels_Surveys<-reactive({
    req(length(Data_4_1_Selected())>0)
    paste(Data_4_1_Selected()$Waterbody_Name_Unique,Data_4_1_Selected()$Year, Data_4_1_Selected()$Survey_ID,sep="\n")
  })
   
      
  Vis_4_1_PieValues_Metrics<-reactive({
    PH<-colSums(Vis_4_1_PieData_Metrics())
    PH[sort(names(PH))]
    return(PH)
    })
  
  Vis_4_1_PieValues_Surveys<-reactive({
    rowSums(Vis_4_1_PieData_Surveys()%>%select(-c("Survey_ID")))
  })
  

  output$Vis_4_1_Pie_Metrics<-renderPlotly({
    Vis_4_1_Pie_Metrics <- plot_ly(type='pie', sort=FALSE, labels=Vis_4_1_PieLabels_Metrics(), values=Vis_4_1_PieValues_Metrics(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis1_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis1_PieX,y=input$Vis1_PieY,orientation=input$Vis1_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis1_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_4_1_Pie_Metrics
  })
  
  output$Vis_4_1_Pie_Surveys<-renderPlotly({
    Vis_4_1_Pie_Surveys <- plot_ly(type='pie', sort=FALSE, labels=Vis_4_1_PieLabels_Surveys(), values=Vis_4_1_PieValues_Surveys(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis1_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis1_PieX,y=input$Vis1_PieY,orientation=input$Vis1_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis1_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_4_1_Pie_Surveys
  })
  
  #### Vis 2_2 Pie ####

  Vis_2_2_PieData_Metrics<-reactive({
    req(length(Data_2_2_Selected())>0)
      Data_2_2_Selected()%>%select(input$Vis2_Pie_Metrics)
    })

  Vis_2_2_PieData_Surveys<-reactive({
    req(length(Data_2_2_Selected())>0)
    Data_2_2_Selected()%>%select(c("Survey_ID",input$Vis2_Pie_Metrics_to_Sum))
  })
     
  Vis_2_2_PieLabels_Metrics<-reactive({
    colnames(Vis_2_2_PieData_Metrics())
  })
  
  Vis_2_2_PieLabels_Surveys<-reactive({
    req(length(Data_2_2_Selected())>0)
    paste(Data_2_2_Selected()$Waterbody_Name_Unique,Data_2_2_Selected()$Year, Data_2_2_Selected()$Survey_ID,sep="\n")
  })
   
      
  Vis_2_2_PieValues_Metrics<-reactive({
    PH<-colSums(Vis_2_2_PieData_Metrics())
    PH[sort(names(PH))]
    return(PH)
    })
  
  Vis_2_2_PieValues_Surveys<-reactive({
    rowSums(Vis_2_2_PieData_Surveys()%>%select(-c("Survey_ID")))
  })
  

  output$Vis_2_2_Pie_Metrics<-renderPlotly({
    Vis_2_2_Pie_Metrics <- plot_ly(type='pie', sort=FALSE, labels=Vis_2_2_PieLabels_Metrics(), values=Vis_2_2_PieValues_Metrics(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis2_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis2_PieX,y=input$Vis2_PieY,orientation=input$Vis2_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis2_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_2_2_Pie_Metrics
  })
  
  output$Vis_2_2_Pie_Surveys<-renderPlotly({
    Vis_2_2_Pie_Surveys <- plot_ly(type='pie', sort=FALSE, labels=Vis_2_2_PieLabels_Surveys(), values=Vis_2_2_PieValues_Surveys(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis2_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis2_PieX,y=input$Vis2_PieY,orientation=input$Vis2_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis2_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_2_2_Pie_Surveys
  })
  
  #### Vis 3_2 Pie ####

  Vis_3_2_PieData_Metrics<-reactive({
    req(length(Data_3_2_Selected())>0)
      Data_3_2_Selected()%>%select(input$Vis2_Pie_Metrics)
    })

  Vis_3_2_PieData_Surveys<-reactive({
    req(length(Data_3_2_Selected())>0)
    Data_3_2_Selected()%>%select(c("Survey_ID",input$Vis2_Pie_Metrics_to_Sum))
  })
     
  Vis_3_2_PieLabels_Metrics<-reactive({
    colnames(Vis_3_2_PieData_Metrics())
  })
  
  Vis_3_2_PieLabels_Surveys<-reactive({
    req(length(Data_3_2_Selected())>0)
    paste(Data_3_2_Selected()$Waterbody_Name_Unique,Data_3_2_Selected()$Year, Data_3_2_Selected()$Survey_ID,sep="\n")
  })
   
      
  Vis_3_2_PieValues_Metrics<-reactive({
    PH<-colSums(Vis_3_2_PieData_Metrics())
    PH[sort(names(PH))]
    return(PH)
    })
  
  Vis_3_2_PieValues_Surveys<-reactive({
    rowSums(Vis_3_2_PieData_Surveys()%>%select(-c("Survey_ID")))
  })
  

  output$Vis_3_2_Pie_Metrics<-renderPlotly({
    Vis_3_2_Pie_Metrics <- plot_ly(type='pie', sort=FALSE, labels=Vis_3_2_PieLabels_Metrics(), values=Vis_3_2_PieValues_Metrics(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis2_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis2_PieX,y=input$Vis2_PieY,orientation=input$Vis2_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis2_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_3_2_Pie_Metrics
  })
  
  output$Vis_3_2_Pie_Surveys<-renderPlotly({
    Vis_3_2_Pie_Surveys <- plot_ly(type='pie', sort=FALSE, labels=Vis_3_2_PieLabels_Surveys(), values=Vis_3_2_PieValues_Surveys(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis2_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis2_PieX,y=input$Vis2_PieY,orientation=input$Vis2_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis2_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_3_2_Pie_Surveys
  })
  #### Vis 4_2 Pie ####

  Vis_4_2_PieData_Metrics<-reactive({
    req(length(Data_4_2_Selected())>0)
    req(length(Data_4_2_Selected())>0)
      Data_4_2_Selected()%>%select(input$Vis2_Pie_Metrics)
    })

  Vis_4_2_PieData_Surveys<-reactive({
    req(length(Data_4_2_Selected())>0)
    req(length(Data_4_2_Selected())>0)
    Data_4_2_Selected()%>%select(c("Survey_ID",input$Vis2_Pie_Metrics_to_Sum))
  })
     
  Vis_4_2_PieLabels_Metrics<-reactive({
    colnames(Vis_4_2_PieData_Metrics())
  })
  
  Vis_4_2_PieLabels_Surveys<-reactive({
    req(length(Data_4_2_Selected())>0)
    paste(Data_4_2_Selected()$Waterbody_Name_Unique,Data_4_2_Selected()$Year, Data_4_2_Selected()$Survey_ID,sep="\n")
  })
   
      
  Vis_4_2_PieValues_Metrics<-reactive({
    PH<-colSums(Vis_4_2_PieData_Metrics())
    PH[sort(names(PH))]
    return(PH)
    })
  
  Vis_4_2_PieValues_Surveys<-reactive({
    rowSums(Vis_4_2_PieData_Surveys()%>%select(-c("Survey_ID")))
  })
  

  output$Vis_4_2_Pie_Metrics<-renderPlotly({
    Vis_4_2_Pie_Metrics <- plot_ly(type='pie', sort=FALSE, labels=Vis_4_2_PieLabels_Metrics(), values=Vis_4_2_PieValues_Metrics(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis2_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis2_PieX,y=input$Vis2_PieY,orientation=input$Vis2_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis2_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_4_2_Pie_Metrics
  })
  
  output$Vis_4_2_Pie_Surveys<-renderPlotly({
    Vis_4_2_Pie_Surveys <- plot_ly(type='pie', sort=FALSE, labels=Vis_4_2_PieLabels_Surveys(), values=Vis_4_2_PieValues_Surveys(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis2_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis2_PieX,y=input$Vis2_PieY,orientation=input$Vis2_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis2_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_4_2_Pie_Surveys
  })
  
  #### Vis 3_3 Pie ####

  Vis_3_3_PieData_Metrics<-reactive({
    req(length(Data_3_3_Selected())>0)
      Data_3_3_Selected()%>%select(input$Vis3_Pie_Metrics)
    })

  Vis_3_3_PieData_Surveys<-reactive({
    req(length(Data_3_3_Selected())>0)
    Data_3_3_Selected()%>%select(c("Survey_ID",input$Vis3_Pie_Metrics_to_Sum))
  })
     
  Vis_3_3_PieLabels_Metrics<-reactive({
    colnames(Vis_3_3_PieData_Metrics())
  })
  
  Vis_3_3_PieLabels_Surveys<-reactive({
    req(length(Data_3_3_Selected())>0)
    paste(Data_3_3_Selected()$Waterbody_Name_Unique,Data_3_3_Selected()$Year, Data_3_3_Selected()$Survey_ID,sep="\n")
  })
   
      
  Vis_3_3_PieValues_Metrics<-reactive({
    PH<-colSums(Vis_3_3_PieData_Metrics())
    PH[sort(names(PH))]
    return(PH)
    })
  
  Vis_3_3_PieValues_Surveys<-reactive({
    rowSums(Vis_3_3_PieData_Surveys()%>%select(-c("Survey_ID")))
  })
  

  output$Vis_3_3_Pie_Metrics<-renderPlotly({
    Vis_3_3_Pie_Metrics <- plot_ly(type='pie', sort=FALSE, labels=Vis_3_3_PieLabels_Metrics(), values=Vis_3_3_PieValues_Metrics(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis3_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis3_PieX,y=input$Vis3_PieY,orientation=input$Vis3_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis3_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_3_3_Pie_Metrics
  })
  
  output$Vis_3_3_Pie_Surveys<-renderPlotly({
    Vis_3_3_Pie_Surveys <- plot_ly(type='pie', sort=FALSE, labels=Vis_3_3_PieLabels_Surveys(), values=Vis_3_3_PieValues_Surveys(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis3_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis3_PieX,y=input$Vis3_PieY,orientation=input$Vis3_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis3_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_3_3_Pie_Surveys
  })
  
  
  #### Vis 4_3 Pie ####

  Vis_4_3_PieData_Metrics<-reactive({
    req(length(Data_4_3_Selected())>0)
      Data_4_3_Selected()%>%select(input$Vis3_Pie_Metrics)
    })

  Vis_4_3_PieData_Surveys<-reactive({
    req(length(Data_4_3_Selected())>0)
    Data_4_3_Selected()%>%select(c("Survey_ID",input$Vis3_Pie_Metrics_to_Sum))
  })
     
  Vis_4_3_PieLabels_Metrics<-reactive({
    colnames(Vis_4_3_PieData_Metrics())
  })
  
  Vis_4_3_PieLabels_Surveys<-reactive({
    req(length(Data_4_3_Selected())>0)
    paste(Data_4_3_Selected()$Waterbody_Name_Unique,Data_4_3_Selected()$Year, Data_4_3_Selected()$Survey_ID,sep="\n")
  })
   
      
  Vis_4_3_PieValues_Metrics<-reactive({
    PH<-colSums(Vis_4_3_PieData_Metrics())
    PH[sort(names(PH))]
    return(PH)
    })
  
  Vis_4_3_PieValues_Surveys<-reactive({
    rowSums(Vis_4_3_PieData_Surveys()%>%select(-c("Survey_ID")))
  })
  

  output$Vis_4_3_Pie_Metrics<-renderPlotly({
    Vis_4_3_Pie_Metrics <- plot_ly(type='pie', sort=FALSE, labels=Vis_4_3_PieLabels_Metrics(), values=Vis_4_3_PieValues_Metrics(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis3_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis3_PieX,y=input$Vis3_PieY,orientation=input$Vis3_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis3_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_4_3_Pie_Metrics
  })
  
  output$Vis_4_3_Pie_Surveys<-renderPlotly({
    Vis_4_3_Pie_Surveys <- plot_ly(type='pie', sort=FALSE, labels=Vis_4_3_PieLabels_Surveys(), values=Vis_4_3_PieValues_Surveys(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis3_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis3_PieX,y=input$Vis3_PieY,orientation=input$Vis3_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis3_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_4_3_Pie_Surveys
  })
  
  #### Vis 4_4 Pie ####

  Vis_4_4_PieData_Metrics<-reactive({
    req(length(Data_4_4_Selected())>0)
      Data_4_4_Selected()%>%select(input$Vis4_Pie_Metrics)
    })

  Vis_4_4_PieData_Surveys<-reactive({
    req(length(Data_4_4_Selected())>0)
    Data_4_4_Selected()%>%select(c("Survey_ID",input$Vis4_Pie_Metrics_to_Sum))
  })
     
  Vis_4_4_PieLabels_Metrics<-reactive({
    colnames(Vis_4_4_PieData_Metrics())
  })
  
  Vis_4_4_PieLabels_Surveys<-reactive({
    req(length(Data_4_4_Selected())>0)
    paste(Data_4_4_Selected()$Waterbody_Name_Unique,Data_4_4_Selected()$Year, Data_4_4_Selected()$Survey_ID,sep="\n")
  })
   
      
  Vis_4_4_PieValues_Metrics<-reactive({
    PH<-colSums(Vis_4_4_PieData_Metrics())
    PH[sort(names(PH))]
    return(PH)
    })
  
  Vis_4_4_PieValues_Surveys<-reactive({
    rowSums(Vis_4_4_PieData_Surveys()%>%select(-c("Survey_ID")))
  })
  

  output$Vis_4_4_Pie_Metrics<-renderPlotly({
    Vis_4_4_Pie_Metrics <- plot_ly(type='pie', sort=FALSE, labels=Vis_4_4_PieLabels_Metrics(), values=Vis_4_4_PieValues_Metrics(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis4_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis4_PieX,y=input$Vis4_PieY,orientation=input$Vis4_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis4_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_4_4_Pie_Metrics
  })
  
  output$Vis_4_4_Pie_Surveys<-renderPlotly({
    Vis_4_4_Pie_Surveys <- plot_ly(type='pie', sort=FALSE, labels=Vis_4_4_PieLabels_Surveys(), values=Vis_4_4_PieValues_Surveys(),
                           textinfo='percent',
                           insidetextorientation='radial',
                           automargin=TRUE)%>%
      layout(title=list(text=input$Vis4_PieTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             legend=list(x=input$Vis4_PieX,y=input$Vis4_PieY,orientation=input$Vis4_Pie_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
             showlegend=input$Vis4_Pie_HideLegend,paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
             annotations =
                 list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                      showarrow = F, xref='paper', yref='paper',
                      xanchor='left', yanchor='top', xshift=0, yshift=0,
                      font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    Vis_4_4_Pie_Surveys
  })
  
#### Bar Plots Server ####  
  
    Vis1_Line_Number<-reactive(as.integer(input$Vis1_Line_Number))
    Vis1_Line_Width<-reactive(input$Vis1_Line_Width)
    Vis1_Line_Point_Color<-reactive(input$Vis1_Line_Point_Color)
    Vis1_Line_Point_Size<-reactive(input$Vis1_Line_Point_Size)
    Vis1_Line_LegendX<-reactive(input$Vis1_Line_LegendX)
    Vis1_Line_LegendY<-reactive(input$Vis1_Line_LegendY)
    Vis1_Line_HideLegend<-reactive(input$Vis1_Line_HideLegend)
    
    Vis2_Line_Number<-reactive(as.integer(input$Vis2_Line_Number))
    Vis2_Line_Width<-reactive(input$Vis2_Line_Width)
    Vis2_Line_Point_Color<-reactive(input$Vis2_Line_Point_Color)
    Vis2_Line_Point_Size<-reactive(input$Vis2_Line_Point_Size)
    Vis2_Line_LegendX<-reactive(input$Vis2_Line_LegendX)
    Vis2_Line_LegendY<-reactive(input$Vis2_Line_LegendY)
    Vis2_Line_HideLegend<-reactive(input$Vis2_Line_HideLegend)
    
    Vis3_Line_Number<-reactive(as.integer(input$Vis3_Line_Number))
    Vis3_Line_Width<-reactive(input$Vis3_Line_Width)
    Vis3_Line_Point_Color<-reactive(input$Vis3_Line_Point_Color)
    Vis3_Line_Point_Size<-reactive(input$Vis3_Line_Point_Size)
    Vis3_Line_LegendX<-reactive(input$Vis3_Line_LegendX)
    Vis3_Line_LegendY<-reactive(input$Vis3_Line_LegendY)
    Vis3_Line_HideLegend<-reactive(input$Vis3_Line_HideLegend)
    
    Vis4_Line_Number<-reactive(as.integer(input$Vis4_Line_Number))
    Vis4_Line_Width<-reactive(input$Vis4_Line_Width)
    Vis4_Line_Point_Color<-reactive(input$Vis4_Line_Point_Color)
    Vis4_Line_Point_Size<-reactive(input$Vis4_Line_Point_Size)
    Vis4_Line_LegendX<-reactive(input$Vis4_Line_LegendX)
    Vis4_Line_LegendY<-reactive(input$Vis4_Line_LegendY)
    Vis4_Line_HideLegend<-reactive(input$Vis4_Line_HideLegend)

    
    
observeEvent(c(
  input$SelectVis1,
  Filtered_CompiledData()
  ),{
  req(input$SelectVis1=="Bar Chart")
  
  Vis1_Bar_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
  Vis1_Bar_Choices<-list()
  Vis1_Bar_Choices[Vis1_Bar_ChoiceNames]<-Vis1_Bar_ChoiceNames
  
  updatePickerInput(session, "Vis1_BarY1", choices=c("Nothing Selected",Vis1_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis1_BarY2", choices=c("Nothing Selected",Vis1_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis1_BarY3", choices=c("Nothing Selected",Vis1_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis1_BarY4", choices=c("Nothing Selected",Vis1_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis1_BarY5", choices=c("Nothing Selected",Vis1_Bar_Choices),selected="Nothing Selected")

},ignoreInit=TRUE)

observeEvent(c(
  input$SelectVis2,
  Filtered_CompiledData()
  ),{
  req(input$SelectVis2=="Bar Chart")
  
  Vis2_Bar_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
  Vis2_Bar_Choices<-list()
  Vis2_Bar_Choices[Vis2_Bar_ChoiceNames]<-Vis2_Bar_ChoiceNames
  
  updatePickerInput(session, "Vis2_BarY1", choices=c("Nothing Selected",Vis2_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis2_BarY2", choices=c("Nothing Selected",Vis2_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis2_BarY3", choices=c("Nothing Selected",Vis2_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis2_BarY4", choices=c("Nothing Selected",Vis2_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis2_BarY5", choices=c("Nothing Selected",Vis2_Bar_Choices),selected="Nothing Selected")

},ignoreInit=TRUE)

observeEvent(c(
  input$SelectVis3,
  Filtered_CompiledData()
  ),{
  req(input$SelectVis3=="Bar Chart")
  
  Vis3_Bar_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
  Vis3_Bar_Choices<-list()
  Vis3_Bar_Choices[Vis3_Bar_ChoiceNames]<-Vis3_Bar_ChoiceNames
  
  updatePickerInput(session, "Vis3_BarY1", choices=c("Nothing Selected",Vis3_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis3_BarY2", choices=c("Nothing Selected",Vis3_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis3_BarY3", choices=c("Nothing Selected",Vis3_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis3_BarY4", choices=c("Nothing Selected",Vis3_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis3_BarY5", choices=c("Nothing Selected",Vis3_Bar_Choices),selected="Nothing Selected")

},ignoreInit=TRUE)

observeEvent(c(
  input$SelectVis4,
  Filtered_CompiledData()
  ),{
  req(input$SelectVis4=="Bar Chart")
  
  Vis4_Bar_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
  Vis4_Bar_Choices<-list()
  Vis4_Bar_Choices[Vis4_Bar_ChoiceNames]<-Vis4_Bar_ChoiceNames
  
  updatePickerInput(session, "Vis4_BarY1", choices=c("Nothing Selected",Vis4_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis4_BarY2", choices=c("Nothing Selected",Vis4_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis4_BarY3", choices=c("Nothing Selected",Vis4_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis4_BarY4", choices=c("Nothing Selected",Vis4_Bar_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis4_BarY5", choices=c("Nothing Selected",Vis4_Bar_Choices),selected="Nothing Selected")

},ignoreInit=TRUE)  
    
   Vis1_Bar_Number<-reactive({req(input$Vis1_Bar_Number)
     input$Vis1_Bar_Number})
   Vis1_BarY1_Color<-reactive({req(input$Vis1_BarY1_Color)
     input$Vis1_BarY1_Color})
   Vis1_BarY2_Color<-reactive({req(input$Vis1_BarY2_Color)
     input$Vis1_BarY2_Color})
   Vis1_BarY3_Color<-reactive({req(input$Vis1_BarY3_Color)
     input$Vis1_BarY3_Color})
   Vis1_BarY4_Color<-reactive({req(input$Vis1_BarY4_Color)
     input$Vis1_BarY4_Color})
   Vis1_BarY5_Color<-reactive({req(input$Vis1_BarY5_Color)
     input$Vis1_BarY5_Color})
   Vis1_Bar_LegendX<-reactive({req(input$Vis1_Bar_LegendX)
     input$Vis1_Bar_LegendX})
   Vis1_Bar_LegendY<-reactive({req(input$Vis1_Bar_LegendY)
                                   input$Vis1_Bar_LegendY})
   Vis1_Bar_HideLegend<-reactive({req(input$Vis1_BarY1)
     input$Vis1_Bar_HideLegend})
   
   
 
    
    
    
   Vis2_Bar_Number<-reactive({req(input$Vis2_Bar_Number)
     input$Vis2_Bar_Number})
   Vis2_BarY1_Color<-reactive({req(input$Vis2_BarY1_Color)
     input$Vis2_BarY1_Color})
   Vis2_BarY2_Color<-reactive({req(input$Vis2_BarY2_Color)
     input$Vis2_BarY2_Color})
   Vis2_BarY3_Color<-reactive({req(input$Vis2_BarY3_Color)
     input$Vis2_BarY3_Color})
   Vis2_BarY4_Color<-reactive({req(input$Vis2_BarY4_Color)
     input$Vis2_BarY4_Color})
   Vis2_BarY5_Color<-reactive({req(input$Vis2_BarY5_Color)
     input$Vis2_BarY5_Color})
   Vis2_Bar_LegendX<-reactive({req(input$Vis2_Bar_LegendX)
     input$Vis2_Bar_LegendX})
   Vis2_Bar_LegendY<-reactive({req(input$Vis2_Bar_LegendY)
                                   input$Vis2_Bar_LegendY})
   Vis2_Bar_HideLegend<-reactive({req(input$Vis2_BarY1)
     input$Vis2_Bar_HideLegend})   
   
 
    
   Vis3_Bar_Number<-reactive({req(input$Vis3_Bar_Number)
     input$Vis3_Bar_Number})
   Vis3_BarY1_Color<-reactive({req(input$Vis3_BarY1_Color)
     input$Vis3_BarY1_Color})
   Vis3_BarY2_Color<-reactive({req(input$Vis3_BarY2_Color)
     input$Vis3_BarY2_Color})
   Vis3_BarY3_Color<-reactive({req(input$Vis3_BarY3_Color)
     input$Vis3_BarY3_Color})
   Vis3_BarY4_Color<-reactive({req(input$Vis3_BarY4_Color)
     input$Vis3_BarY4_Color})
   Vis3_BarY5_Color<-reactive({req(input$Vis3_BarY5_Color)
     input$Vis3_BarY5_Color})
   Vis3_Bar_LegendX<-reactive({req(input$Vis3_Bar_LegendX)
     input$Vis3_Bar_LegendX})
   Vis3_Bar_LegendY<-reactive({req(input$Vis3_Bar_LegendY)
                                   input$Vis3_Bar_LegendY})
   Vis3_Bar_HideLegend<-reactive({req(input$Vis3_BarY1)
     input$Vis3_Bar_HideLegend})   
   
    
   Vis4_Bar_Number<-reactive({req(input$Vis4_Bar_Number)
     input$Vis4_Bar_Number})
   Vis4_BarY1_Color<-reactive({req(input$Vis4_BarY1_Color)
     input$Vis4_BarY1_Color})
   Vis4_BarY2_Color<-reactive({req(input$Vis4_BarY2_Color)
     input$Vis4_BarY2_Color})
   Vis4_BarY3_Color<-reactive({req(input$Vis4_BarY3_Color)
     input$Vis4_BarY3_Color})
   Vis4_BarY4_Color<-reactive({req(input$Vis4_BarY4_Color)
     input$Vis4_BarY4_Color})
   Vis4_BarY5_Color<-reactive({req(input$Vis4_BarY5_Color)
     input$Vis4_BarY5_Color})
   Vis4_Bar_LegendX<-reactive({req(input$Vis4_Bar_LegendX)
     input$Vis4_Bar_LegendX})
   Vis4_Bar_LegendY<-reactive({req(input$Vis4_Bar_LegendY)
                                   input$Vis4_Bar_LegendY})
   Vis4_Bar_HideLegend<-reactive({req(input$Vis4_BarY1)
     input$Vis4_Bar_HideLegend})   
   
   
  #### 1_1_Bar ####          
    Vis_1_1_Bar_1Y<-reactive({
      req(Data_1_1())
      plot_ly(
          Data_1_1(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_1_1_Bar',
          key=~Survey_ID)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    })
   

   
    
    Vis_1_1_Bar_2Y<-reactive({
      req(Data_1_1())
      plot_ly(
          Data_1_1(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_1_1_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis1_BarY2),marker=list(color=~Vis1_BarY2_Color()),name=input$Vis1_BarY2)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    })
    
   Vis_1_1_Bar_3Y<-reactive({
      req(Data_1_1())
      plot_ly(
          Data_1_1(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_1_1_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis1_BarY2),marker=list(color=~Vis1_BarY2_Color()),name=input$Vis1_BarY2)%>%
            add_trace(y=~get(input$Vis1_BarY3),marker=list(color=~Vis1_BarY3_Color()),name=input$Vis1_BarY3)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    })
    
   Vis_1_1_Bar_4Y<-reactive({
      req(Data_1_1())
      plot_ly(
          Data_1_1(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_1_1_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis1_BarY2),marker=list(color=~Vis1_BarY2_Color()),name=input$Vis1_BarY2)%>%
            add_trace(y=~get(input$Vis1_BarY3),marker=list(color=~Vis1_BarY3_Color()),name=input$Vis1_BarY3)%>%
            add_trace(y=~get(input$Vis1_BarY4),marker=list(color=~Vis1_BarY4_Color()),name=input$Vis1_BarY4)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    })
   

    
    Vis_1_1_Bar_5Y<-reactive({
      req(Data_1_1())
      plot_ly(
          Data_1_1(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_1_1_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis1_BarY2),marker=list(color=~Vis1_BarY2_Color()),name=input$Vis1_BarY2)%>%
            add_trace(y=~get(input$Vis1_BarY3),marker=list(color=~Vis1_BarY3_Color()),name=input$Vis1_BarY3)%>%
            add_trace(y=~get(input$Vis1_BarY4),marker=list(color=~Vis1_BarY4_Color()),name=input$Vis1_BarY4)%>%
            add_trace(y=~get(input$Vis1_BarY5),marker=list(color=~Vis1_BarY5_Color()),name=input$Vis1_BarY5)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
    })
    
    
      
   output$Vis_1_1_Bar<-renderPlotly({
      if(Vis1_Bar_Number()=="1"){
      Vis_1_1_Bar_1Y()
      } else if (Vis1_Bar_Number()=="2"){
      Vis_1_1_Bar_2Y()  
      } else if (Vis1_Bar_Number()=="3"){
      Vis_1_1_Bar_3Y()  
      } else if (Vis1_Bar_Number()=="4"){
      Vis_1_1_Bar_4Y()  
      } else if (Vis1_Bar_Number()=="5"){
       Vis_1_1_Bar_5Y() 
      }
   })
 
   
  #### 2_1_Bar ####    
   Vis_2_1_Bar_1Y<-reactive({
      req(Data_2_1_Selected())
      plot_ly(
          Data_2_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_2_1_Bar',
          key=~Survey_ID)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

    Vis_2_1_Bar_2Y<-reactive({
      req(Data_2_1_Selected())
      plot_ly(
          Data_2_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_2_1_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis1_BarY2),marker=list(color=~Vis1_BarY2_Color()),name=input$Vis1_BarY2)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_2_1_Bar_3Y<-reactive({
      req(Data_2_1_Selected())
      plot_ly(
          Data_2_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_2_1_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis1_BarY2),marker=list(color=~Vis1_BarY2_Color()),name=input$Vis1_BarY2)%>%
            add_trace(y=~get(input$Vis1_BarY3),marker=list(color=~Vis1_BarY3_Color()),name=input$Vis1_BarY3)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_2_1_Bar_4Y<-reactive({
      req(Data_2_1_Selected())
      plot_ly(
          Data_2_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_2_1_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis1_BarY2),marker=list(color=~Vis1_BarY2_Color()),name=input$Vis1_BarY2)%>%
            add_trace(y=~get(input$Vis1_BarY3),marker=list(color=~Vis1_BarY3_Color()),name=input$Vis1_BarY3)%>%
            add_trace(y=~get(input$Vis1_BarY4),marker=list(color=~Vis1_BarY4_Color()),name=input$Vis1_BarY4)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })



    Vis_2_1_Bar_5Y<-reactive({
      req(Data_2_1_Selected())
      plot_ly(
          Data_2_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_2_1_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis1_BarY2),marker=list(color=~Vis1_BarY2_Color()),name=input$Vis1_BarY2)%>%
            add_trace(y=~get(input$Vis1_BarY3),marker=list(color=~Vis1_BarY3_Color()),name=input$Vis1_BarY3)%>%
            add_trace(y=~get(input$Vis1_BarY4),marker=list(color=~Vis1_BarY4_Color()),name=input$Vis1_BarY4)%>%
            add_trace(y=~get(input$Vis1_BarY5),marker=list(color=~Vis1_BarY5_Color()),name=input$Vis1_BarY5)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })
  




 output$Vis_2_1_Bar<-renderPlotly({
      if(Vis1_Bar_Number()=="1"){
      Vis_2_1_Bar_1Y()
      } else if (Vis1_Bar_Number()=="2"){
      Vis_2_1_Bar_2Y()  
      } else if (Vis1_Bar_Number()=="3"){
      Vis_2_1_Bar_3Y()  
      } else if (Vis1_Bar_Number()=="4"){
      Vis_2_1_Bar_4Y()  
      } else if (Vis1_Bar_Number()=="5"){
       Vis_2_1_Bar_5Y() 
      }
    })

 
  #### 3_1_Bar ####  
    Vis_3_1_Bar_1Y<-reactive({
      req(Data_3_1_Selected())
      plot_ly(
          Data_3_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_1_Bar',
          key=~Survey_ID)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })
    Vis_3_1_Bar_2Y<-reactive({
      req(Data_3_1_Selected())
      plot_ly(
          Data_3_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_1_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis1_BarY2),marker=list(color=~Vis1_BarY2_Color()),name=input$Vis1_BarY2)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })
   Vis_3_1_Bar_3Y<-reactive({
      req(Data_3_1_Selected())
      plot_ly(
          Data_3_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_1_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis1_BarY2),marker=list(color=~Vis1_BarY2_Color()),name=input$Vis1_BarY2)%>%
            add_trace(y=~get(input$Vis1_BarY3),marker=list(color=~Vis1_BarY3_Color()),name=input$Vis1_BarY3)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_3_1_Bar_4Y<-reactive({
      req(Data_3_1_Selected())
      plot_ly(
          Data_3_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_1_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis1_BarY2),marker=list(color=~Vis1_BarY2_Color()),name=input$Vis1_BarY2)%>%
            add_trace(y=~get(input$Vis1_BarY3),marker=list(color=~Vis1_BarY3_Color()),name=input$Vis1_BarY3)%>%
            add_trace(y=~get(input$Vis1_BarY4),marker=list(color=~Vis1_BarY4_Color()),name=input$Vis1_BarY4)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

    Vis_3_1_Bar_5Y<-reactive({
      req(Data_3_1_Selected())
      plot_ly(
          Data_3_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_1_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis1_BarY2),marker=list(color=~Vis1_BarY2_Color()),name=input$Vis1_BarY2)%>%
            add_trace(y=~get(input$Vis1_BarY3),marker=list(color=~Vis1_BarY3_Color()),name=input$Vis1_BarY3)%>%
            add_trace(y=~get(input$Vis1_BarY4),marker=list(color=~Vis1_BarY4_Color()),name=input$Vis1_BarY4)%>%
            add_trace(y=~get(input$Vis1_BarY5),marker=list(color=~Vis1_BarY5_Color()),name=input$Vis1_BarY5)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })
  
   


 output$Vis_3_1_Bar<-renderPlotly({
      if(Vis1_Bar_Number()=="1"){
      Vis_3_1_Bar_1Y()
      } else if (Vis1_Bar_Number()=="2"){
      Vis_3_1_Bar_2Y()  
      } else if (Vis1_Bar_Number()=="3"){
      Vis_3_1_Bar_3Y()  
      } else if (Vis1_Bar_Number()=="4"){
      Vis_3_1_Bar_4Y()  
      } else if (Vis1_Bar_Number()=="5"){
       Vis_3_1_Bar_5Y() 
      }
   })
 
 
  #### 4_1_Bar #### 
    Vis_4_1_Bar_1Y<-reactive({
      req(Data_4_1_Selected())
      plot_ly(
          Data_4_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_1_Bar',
          key=~Survey_ID)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

    Vis_4_1_Bar_2Y<-reactive({
      req(Data_4_1_Selected())
      plot_ly(
          Data_4_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_1_Bar',
          key=~Survey_ID)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })
    
    
   Vis_4_1_Bar_3Y<-reactive({
      req(Data_4_1_Selected())
      plot_ly(
          Data_4_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_1_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis1_BarY2),marker=list(color=~Vis1_BarY2_Color()),name=input$Vis1_BarY2)%>%
            add_trace(y=~get(input$Vis1_BarY3),marker=list(color=~Vis1_BarY3_Color()),name=input$Vis1_BarY3)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_4_1_Bar_4Y<-reactive({
      req(Data_4_1_Selected())
      plot_ly(
          Data_4_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_1_Bar',
          key=~Survey_ID)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })



    Vis_4_1_Bar_5Y<-reactive({
      req(Data_4_1_Selected())
      plot_ly(
          Data_4_1_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis1_BarY1),
          marker=list(color=~Vis1_BarY1_Color()),
          name=input$Vis1_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_1_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis1_BarY2),marker=list(color=~Vis1_BarY2_Color()),name=input$Vis1_BarY2)%>%
            add_trace(y=~get(input$Vis1_BarY3),marker=list(color=~Vis1_BarY3_Color()),name=input$Vis1_BarY3)%>%
            add_trace(y=~get(input$Vis1_BarY4),marker=list(color=~Vis1_BarY4_Color()),name=input$Vis1_BarY4)%>%
            add_trace(y=~get(input$Vis1_BarY5),marker=list(color=~Vis1_BarY5_Color()),name=input$Vis1_BarY5)%>%
              layout(legend=list(x=Vis1_Bar_LegendX(),y=Vis1_Bar_LegendY(),orientation=input$Vis1BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis1_Bar_HideLegend()),
                     title=list(
                       text=input$Vis1_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })
  

 output$Vis_4_1_Bar<-renderPlotly({
      if(Vis1_Bar_Number()=="1"){
      Vis_4_1_Bar_1Y()
      } else if (Vis1_Bar_Number()=="2"){
      Vis_4_1_Bar_2Y()  
      } else if (Vis1_Bar_Number()=="3"){
      Vis_4_1_Bar_3Y()  
      } else if (Vis1_Bar_Number()=="4"){
      Vis_4_1_Bar_4Y()  
      } else if (Vis1_Bar_Number()=="5"){
       Vis_4_1_Bar_5Y() 
      }
   })

 
 
  #### 2_2_Bar #### 
    Vis_2_2_Bar_1Y<-reactive({
      req(Data_2_2_Selected())
      plot_ly(
          Data_2_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_2_2_Bar',
          key=~Survey_ID)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

    Vis_2_2_Bar_2Y<-reactive({
      req(Data_2_2_Selected())
      plot_ly(
          Data_2_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_2_2_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis2_BarY2),marker=list(color=~Vis2_BarY2_Color()),name=input$Vis2_BarY2)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_2_2_Bar_3Y<-reactive({
      req(Data_2_2_Selected())
      plot_ly(
          Data_2_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_2_2_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis2_BarY2),marker=list(color=~Vis2_BarY2_Color()),name=input$Vis2_BarY2)%>%
            add_trace(y=~get(input$Vis2_BarY3),marker=list(color=~Vis2_BarY3_Color()),name=input$Vis2_BarY3)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_2_2_Bar_4Y<-reactive({
      req(Data_2_2_Selected())
      plot_ly(
          Data_2_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_2_2_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis2_BarY2),marker=list(color=~Vis2_BarY2_Color()),name=input$Vis2_BarY2)%>%
            add_trace(y=~get(input$Vis2_BarY3),marker=list(color=~Vis2_BarY3_Color()),name=input$Vis2_BarY3)%>%
            add_trace(y=~get(input$Vis2_BarY4),marker=list(color=~Vis2_BarY4_Color()),name=input$Vis2_BarY4)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })



    Vis_2_2_Bar_5Y<-reactive({
      req(Data_2_2_Selected())
      plot_ly(
          Data_2_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_2_2_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis2_BarY2),marker=list(color=~Vis2_BarY2_Color()),name=input$Vis2_BarY2)%>%
            add_trace(y=~get(input$Vis2_BarY3),marker=list(color=~Vis2_BarY3_Color()),name=input$Vis2_BarY3)%>%
            add_trace(y=~get(input$Vis2_BarY4),marker=list(color=~Vis2_BarY4_Color()),name=input$Vis2_BarY4)%>%
            add_trace(y=~get(input$Vis2_BarY5),marker=list(color=~Vis2_BarY5_Color()),name=input$Vis2_BarY5)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })
  
    

 output$Vis_2_2_Bar<-renderPlotly({
      if(Vis2_Bar_Number()=="1"){
      Vis_2_2_Bar_1Y()
      } else if (Vis2_Bar_Number()=="2"){
      Vis_2_2_Bar_2Y()  
      } else if (Vis2_Bar_Number()=="3"){
      Vis_2_2_Bar_3Y()  
      } else if (Vis2_Bar_Number()=="4"){
      Vis_2_2_Bar_4Y()  
      } else if (Vis2_Bar_Number()=="5"){
       Vis_2_2_Bar_5Y() 
      }
   })
 
  #### 3_2_Bar ####
    Vis_3_2_Bar_1Y<-reactive({
      req(Data_3_2_Selected())
      plot_ly(
          Data_3_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_2_Bar',
          key=~Survey_ID)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

    Vis_3_2_Bar_2Y<-reactive({
      req(Data_3_2_Selected())
      plot_ly(
          Data_3_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_2_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis2_BarY2),marker=list(color=~Vis2_BarY2_Color()),name=input$Vis2_BarY2)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_3_2_Bar_3Y<-reactive({
      req(Data_3_2_Selected())
      plot_ly(
          Data_3_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_2_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis2_BarY2),marker=list(color=~Vis2_BarY2_Color()),name=input$Vis2_BarY2)%>%
            add_trace(y=~get(input$Vis2_BarY3),marker=list(color=~Vis2_BarY3_Color()),name=input$Vis2_BarY3)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_3_2_Bar_4Y<-reactive({
      req(Data_3_2_Selected())
      plot_ly(
          Data_3_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_2_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis2_BarY2),marker=list(color=~Vis2_BarY2_Color()),name=input$Vis2_BarY2)%>%
            add_trace(y=~get(input$Vis2_BarY3),marker=list(color=~Vis2_BarY3_Color()),name=input$Vis2_BarY3)%>%
            add_trace(y=~get(input$Vis2_BarY4),marker=list(color=~Vis2_BarY4_Color()),name=input$Vis2_BarY4)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })



    Vis_3_2_Bar_5Y<-reactive({
      req(Data_3_2_Selected())
      plot_ly(
          Data_3_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_2_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis2_BarY2),marker=list(color=~Vis2_BarY2_Color()),name=input$Vis2_BarY2)%>%
            add_trace(y=~get(input$Vis2_BarY3),marker=list(color=~Vis2_BarY3_Color()),name=input$Vis2_BarY3)%>%
            add_trace(y=~get(input$Vis2_BarY4),marker=list(color=~Vis2_BarY4_Color()),name=input$Vis2_BarY4)%>%
            add_trace(y=~get(input$Vis2_BarY5),marker=list(color=~Vis2_BarY5_Color()),name=input$Vis2_BarY5)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })
    
 output$Vis_3_2_Bar<-renderPlotly({
      if(Vis2_Bar_Number()=="1"){
      Vis_3_2_Bar_1Y()
      } else if (Vis2_Bar_Number()=="2"){
      Vis_3_2_Bar_2Y()  
      } else if (Vis2_Bar_Number()=="3"){
      Vis_3_2_Bar_3Y()  
      } else if (Vis2_Bar_Number()=="4"){
      Vis_3_2_Bar_4Y()  
      } else if (Vis2_Bar_Number()=="5"){
       Vis_3_2_Bar_5Y() 
      }
   })

 
  #### 4_2_Bar####
     Vis_4_2_Bar_1Y<-reactive({
      req(Data_4_2_Selected())
      plot_ly(
          Data_4_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_2_Bar',
          key=~Survey_ID)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

    Vis_4_2_Bar_2Y<-reactive({
      req(Data_4_2_Selected())
      plot_ly(
          Data_4_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_2_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis2_BarY2),marker=list(color=~Vis2_BarY2_Color()),name=input$Vis2_BarY2)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_4_2_Bar_3Y<-reactive({
      req(Data_4_2_Selected())
      plot_ly(
          Data_4_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_2_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis2_BarY2),marker=list(color=~Vis2_BarY2_Color()),name=input$Vis2_BarY2)%>%
            add_trace(y=~get(input$Vis2_BarY3),marker=list(color=~Vis2_BarY3_Color()),name=input$Vis2_BarY3)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_4_2_Bar_4Y<-reactive({
      req(Data_4_2_Selected())
      plot_ly(
          Data_4_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_2_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis2_BarY2),marker=list(color=~Vis2_BarY2_Color()),name=input$Vis2_BarY2)%>%
            add_trace(y=~get(input$Vis2_BarY3),marker=list(color=~Vis2_BarY3_Color()),name=input$Vis2_BarY3)%>%
            add_trace(y=~get(input$Vis2_BarY4),marker=list(color=~Vis2_BarY4_Color()),name=input$Vis2_BarY4)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })



    Vis_4_2_Bar_5Y<-reactive({
      req(Data_4_2_Selected())
      plot_ly(
          Data_4_2_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis2_BarY1),
          marker=list(color=~Vis2_BarY1_Color()),
          name=input$Vis2_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_2_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis2_BarY2),marker=list(color=~Vis2_BarY2_Color()),name=input$Vis2_BarY2)%>%
            add_trace(y=~get(input$Vis2_BarY3),marker=list(color=~Vis2_BarY3_Color()),name=input$Vis2_BarY3)%>%
            add_trace(y=~get(input$Vis2_BarY4),marker=list(color=~Vis2_BarY4_Color()),name=input$Vis2_BarY4)%>%
            add_trace(y=~get(input$Vis2_BarY5),marker=list(color=~Vis2_BarY5_Color()),name=input$Vis2_BarY5)%>%
              layout(legend=list(x=Vis2_Bar_LegendX(),y=Vis2_Bar_LegendY(),orientation=input$Vis2BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis2_Bar_HideLegend()),
                     title=list(
                       text=input$Vis2_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })
  
    

 output$Vis_4_2_Bar<-renderPlotly({
      if(Vis2_Bar_Number()=="1"){
      Vis_4_2_Bar_1Y()
      } else if (Vis2_Bar_Number()=="2"){
      Vis_4_2_Bar_2Y()  
      } else if (Vis2_Bar_Number()=="3"){
      Vis_4_2_Bar_3Y()  
      } else if (Vis2_Bar_Number()=="4"){
      Vis_4_2_Bar_4Y()  
      } else if (Vis2_Bar_Number()=="5"){
       Vis_4_2_Bar_5Y() 
      }
   })
 
 
 
 
  #### 3_3_Bar####
      Vis_3_3_Bar_1Y<-reactive({
      req(Data_3_3_Selected())
      plot_ly(
          Data_3_3_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis3_BarY1),
          marker=list(color=~Vis3_BarY1_Color()),
          name=input$Vis3_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_3_Bar',
          key=~Survey_ID)%>%
              layout(legend=list(x=Vis3_Bar_LegendX(),y=Vis3_Bar_LegendY(),orientation=input$Vis3BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis3_Bar_HideLegend()),
                     title=list(
                       text=input$Vis3_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

    Vis_3_3_Bar_2Y<-reactive({
      req(Data_3_3_Selected())
      plot_ly(
          Data_3_3_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis3_BarY1),
          marker=list(color=~Vis3_BarY1_Color()),
          name=input$Vis3_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_3_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis3_BarY2),marker=list(color=~Vis3_BarY2_Color()),name=input$Vis3_BarY2)%>%
              layout(legend=list(x=Vis3_Bar_LegendX(),y=Vis3_Bar_LegendY(),orientation=input$Vis3BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis3_Bar_HideLegend()),
                     title=list(
                       text=input$Vis3_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_3_3_Bar_3Y<-reactive({
      req(Data_3_3_Selected())
      plot_ly(
          Data_3_3_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis3_BarY1),
          marker=list(color=~Vis3_BarY1_Color()),
          name=input$Vis3_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_3_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis3_BarY2),marker=list(color=~Vis3_BarY2_Color()),name=input$Vis3_BarY2)%>%
            add_trace(y=~get(input$Vis3_BarY3),marker=list(color=~Vis3_BarY3_Color()),name=input$Vis3_BarY3)%>%
              layout(legend=list(x=Vis3_Bar_LegendX(),y=Vis3_Bar_LegendY(),orientation=input$Vis3BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis3_Bar_HideLegend()),
                     title=list(
                       text=input$Vis3_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_3_3_Bar_4Y<-reactive({
      req(Data_3_3_Selected())
      plot_ly(
          Data_3_3_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis3_BarY1),
          marker=list(color=~Vis3_BarY1_Color()),
          name=input$Vis3_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_3_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis3_BarY2),marker=list(color=~Vis3_BarY2_Color()),name=input$Vis3_BarY2)%>%
            add_trace(y=~get(input$Vis3_BarY3),marker=list(color=~Vis3_BarY3_Color()),name=input$Vis3_BarY3)%>%
            add_trace(y=~get(input$Vis3_BarY4),marker=list(color=~Vis3_BarY4_Color()),name=input$Vis3_BarY4)%>%
              layout(legend=list(x=Vis3_Bar_LegendX(),y=Vis3_Bar_LegendY(),orientation=input$Vis3BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis3_Bar_HideLegend()),
                     title=list(
                       text=input$Vis3_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })



    Vis_3_3_Bar_5Y<-reactive({
      req(Data_3_3_Selected())
      plot_ly(
          Data_3_3_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis3_BarY1),
          marker=list(color=~Vis3_BarY1_Color()),
          name=input$Vis3_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_3_3_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis3_BarY2),marker=list(color=~Vis3_BarY2_Color()),name=input$Vis3_BarY2)%>%
            add_trace(y=~get(input$Vis3_BarY3),marker=list(color=~Vis3_BarY3_Color()),name=input$Vis3_BarY3)%>%
            add_trace(y=~get(input$Vis3_BarY4),marker=list(color=~Vis3_BarY4_Color()),name=input$Vis3_BarY4)%>%
            add_trace(y=~get(input$Vis3_BarY5),marker=list(color=~Vis3_BarY5_Color()),name=input$Vis3_BarY5)%>%
              layout(legend=list(x=Vis3_Bar_LegendX(),y=Vis3_Bar_LegendY(),orientation=input$Vis3BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis3_Bar_HideLegend()),
                     title=list(
                       text=input$Vis3_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })
  

 output$Vis_3_3_Bar<-renderPlotly({
      if(Vis3_Bar_Number()=="1"){
      Vis_3_3_Bar_1Y()
      } else if (Vis3_Bar_Number()=="2"){
      Vis_3_3_Bar_2Y()  
      } else if (Vis3_Bar_Number()=="3"){
      Vis_3_3_Bar_3Y()  
      } else if (Vis3_Bar_Number()=="4"){
      Vis_3_3_Bar_4Y()  
      } else if (Vis3_Bar_Number()=="5"){
       Vis_3_3_Bar_5Y() 
      }
   })
 
 
 
  #### 4_3_Bar ####
 
      Vis_4_3_Bar_1Y<-reactive({
      req(Data_4_3_Selected())
      plot_ly(
          Data_4_3_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis3_BarY1),
          marker=list(color=~Vis3_BarY1_Color()),
          name=input$Vis3_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_3_Bar',
          key=~Survey_ID)%>%
              layout(legend=list(x=Vis3_Bar_LegendX(),y=Vis3_Bar_LegendY(),orientation=input$Vis3BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis3_Bar_HideLegend()),
                     title=list(
                       text=input$Vis3_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })
      
    Vis_4_3_Bar_2Y<-reactive({
      req(Data_4_3_Selected())
      plot_ly(
          Data_4_3_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis3_BarY1),
          marker=list(color=~Vis3_BarY1_Color()),
          name=input$Vis3_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_3_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis3_BarY2),marker=list(color=~Vis3_BarY2_Color()),name=input$Vis3_BarY2)%>%
              layout(legend=list(x=Vis3_Bar_LegendX(),y=Vis3_Bar_LegendY(),orientation=input$Vis3BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis3_Bar_HideLegend()),
                     title=list(
                       text=input$Vis3_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_4_3_Bar_3Y<-reactive({
      req(Data_4_3_Selected())
      plot_ly(
          Data_4_3_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis3_BarY1),
          marker=list(color=~Vis3_BarY1_Color()),
          name=input$Vis3_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_3_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis3_BarY2),marker=list(color=~Vis3_BarY2_Color()),name=input$Vis3_BarY2)%>%
            add_trace(y=~get(input$Vis3_BarY3),marker=list(color=~Vis3_BarY3_Color()),name=input$Vis3_BarY3)%>%
              layout(legend=list(x=Vis3_Bar_LegendX(),y=Vis3_Bar_LegendY(),orientation=input$Vis3BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis3_Bar_HideLegend()),
                     title=list(
                       text=input$Vis3_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_4_3_Bar_4Y<-reactive({
      req(Data_4_3_Selected())
      plot_ly(
          Data_4_3_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis3_BarY1),
          marker=list(color=~Vis3_BarY1_Color()),
          name=input$Vis3_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_3_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis3_BarY2),marker=list(color=~Vis3_BarY2_Color()),name=input$Vis3_BarY2)%>%
            add_trace(y=~get(input$Vis3_BarY3),marker=list(color=~Vis3_BarY3_Color()),name=input$Vis3_BarY3)%>%
            add_trace(y=~get(input$Vis3_BarY4),marker=list(color=~Vis3_BarY4_Color()),name=input$Vis3_BarY4)%>%
              layout(legend=list(x=Vis3_Bar_LegendX(),y=Vis3_Bar_LegendY(),orientation=input$Vis3BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis3_Bar_HideLegend()),
                     title=list(
                       text=input$Vis3_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })



    Vis_4_3_Bar_5Y<-reactive({
      req(Data_4_3_Selected())
      plot_ly(
          Data_4_3_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis3_BarY1),
          marker=list(color=~Vis3_BarY1_Color()),
          name=input$Vis3_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_3_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis3_BarY2),marker=list(color=~Vis3_BarY2_Color()),name=input$Vis3_BarY2)%>%
            add_trace(y=~get(input$Vis3_BarY3),marker=list(color=~Vis3_BarY3_Color()),name=input$Vis3_BarY3)%>%
            add_trace(y=~get(input$Vis3_BarY4),marker=list(color=~Vis3_BarY4_Color()),name=input$Vis3_BarY4)%>%
            add_trace(y=~get(input$Vis3_BarY5),marker=list(color=~Vis3_BarY5_Color()),name=input$Vis3_BarY5)%>%
              layout(legend=list(x=Vis3_Bar_LegendX(),y=Vis3_Bar_LegendY(),orientation=input$Vis3BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis3_Bar_HideLegend()),
                     title=list(
                       text=input$Vis3_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

 output$Vis_4_3_Bar<-renderPlotly({
      if(Vis3_Bar_Number()=="1"){
      Vis_4_3_Bar_1Y()
      } else if (Vis3_Bar_Number()=="2"){
      Vis_4_3_Bar_2Y()  
      } else if (Vis3_Bar_Number()=="3"){
      Vis_4_3_Bar_3Y()  
      } else if (Vis3_Bar_Number()=="4"){
      Vis_4_3_Bar_4Y()  
      } else if (Vis3_Bar_Number()=="5"){
       Vis_4_3_Bar_5Y() 
      }
   })
   
 
  #### 4_4_Bar ####
 
 Vis_4_4_Bar_1Y<-reactive({
        req(Data_4_4_Selected())
        plot_ly(
          Data_4_4_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis4_BarY1),
          marker=list(color=~Vis4_BarY1_Color()),
          name=input$Vis4_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_4_Bar',
          key=~Survey_ID)%>%
              layout(legend=list(x=Vis4_Bar_LegendX(),y=Vis4_Bar_LegendY(),orientation=input$Vis4BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis4_Bar_HideLegend()),
                     title=list(
                       text=input$Vis4_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis4_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis4_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

    Vis_4_4_Bar_2Y<-reactive({
        req(Data_4_4_Selected())
        plot_ly(
          Data_4_4_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis4_BarY1),
          marker=list(color=~Vis4_BarY1_Color()),
          name=input$Vis4_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_4_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis4_BarY2),marker=list(color=~Vis4_BarY2_Color()),name=input$Vis4_BarY2)%>%
              layout(legend=list(x=Vis4_Bar_LegendX(),y=Vis4_Bar_LegendY(),orientation=input$Vis4BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis4_Bar_HideLegend()),
                     title=list(
                       text=input$Vis4_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis4_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis4_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_4_4_Bar_3Y<-reactive({
        req(Data_4_4_Selected())
        plot_ly(
          Data_4_4_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis4_BarY1),
          marker=list(color=~Vis4_BarY1_Color()),
          name=input$Vis4_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_4_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis4_BarY2),marker=list(color=~Vis4_BarY2_Color()),name=input$Vis4_BarY2)%>%
            add_trace(y=~get(input$Vis4_BarY3),marker=list(color=~Vis4_BarY3_Color()),name=input$Vis4_BarY3)%>%
              layout(legend=list(x=Vis4_Bar_LegendX(),y=Vis4_Bar_LegendY(),orientation=input$Vis4BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis4_Bar_HideLegend()),
                     title=list(
                       text=input$Vis4_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis4_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis4_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })

   Vis_4_4_Bar_4Y<-reactive({
        req(Data_4_4_Selected())
        plot_ly(
          Data_4_4_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis4_BarY1),
          marker=list(color=~Vis4_BarY1_Color()),
          name=input$Vis4_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_4_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis4_BarY2),marker=list(color=~Vis4_BarY2_Color()),name=input$Vis4_BarY2)%>%
            add_trace(y=~get(input$Vis4_BarY3),marker=list(color=~Vis4_BarY3_Color()),name=input$Vis4_BarY3)%>%
            add_trace(y=~get(input$Vis4_BarY4),marker=list(color=~Vis4_BarY4_Color()),name=input$Vis4_BarY4)%>%
              layout(legend=list(x=Vis4_Bar_LegendX(),y=Vis4_Bar_LegendY(),orientation=input$Vis4BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis4_Bar_HideLegend()),
                     title=list(
                       text=input$Vis4_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis4_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis4_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })



    Vis_4_4_Bar_5Y<-reactive({
        req(Data_4_4_Selected())
        plot_ly(
          Data_4_4_Selected(),
          x=~Survey_ID,
          y=~get(input$Vis4_BarY1),
          marker=list(color=~Vis4_BarY1_Color()),
          name=input$Vis4_BarY1,
          hovertemplate=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>%{x}','<br>%{y}'),
          type='bar',
          source='Vis_4_4_Bar',
          key=~Survey_ID)%>%
            add_trace(y=~get(input$Vis4_BarY2),marker=list(color=~Vis4_BarY2_Color()),name=input$Vis4_BarY2)%>%
            add_trace(y=~get(input$Vis4_BarY3),marker=list(color=~Vis4_BarY3_Color()),name=input$Vis4_BarY3)%>%
            add_trace(y=~get(input$Vis4_BarY4),marker=list(color=~Vis4_BarY4_Color()),name=input$Vis4_BarY4)%>%
            add_trace(y=~get(input$Vis4_BarY5),marker=list(color=~Vis4_BarY5_Color()),name=input$Vis4_BarY5)%>%
              layout(legend=list(x=Vis4_Bar_LegendX(),y=Vis4_Bar_LegendY(),orientation=input$Vis4BarLegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"),
                     showlegend=c(Vis4_Bar_HideLegend()),
                     title=list(
                       text=input$Vis4_BarTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis4_BarXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis4_BarYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))%>%
    config(modeBarButtonsToRemove=if(input$AF_LinkedSelection=='Yes'){c("select2d","lasso2d")}else{c()})
    })
 

 output$Vis_4_4_Bar<-renderPlotly({
      if(Vis4_Bar_Number()=="1"){
      Vis_4_4_Bar_1Y()
      } else if (Vis4_Bar_Number()=="2"){
      Vis_4_4_Bar_2Y()  
      } else if (Vis4_Bar_Number()=="3"){
      Vis_4_4_Bar_3Y()  
      } else if (Vis4_Bar_Number()=="4"){
      Vis_4_4_Bar_4Y()  
      } else if (Vis4_Bar_Number()=="5"){
       Vis_4_4_Bar_5Y() 
      }
   })
 
 
 
 
 
 
 
 


    #### Vis 1 Scatter ####

    ##### Shared Inputs #####
    Vis1_Scatter_LegendX<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_LegendX})
    Vis1_Scatter_LegendY<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_LegendY})
    Vis1_Scatter_HideLegend<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_HideLegend})
    Vis1_Scatter_Color<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_Color})
    Vis1_Scatter_Symbol<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_Symbol})
    Vis1_Scatter_MarkerSizeSwitch<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_MarkerSizeSwitch})
    Vis1_Scatter_MarkerSize<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_MarkerSize})
    Vis1_Scatter_MarkerScaleSize<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_MarkerScaleSize})
    Vis1_Scatter_ColorGroupSwitch<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_ColorGroupSwitch})
    Vis1_Scatter_MarkerColorNumeric<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_MarkerColor_Numeric})
    Vis1_Scatter_MarkerColorFactors<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_MarkerColor_Factors})
    Vis1_Scatter_TrendlineSwitch<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_TrendlineSwitch})
    Vis1_Scatter_TrendlineColor<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_TrendlineColor})
    Vis1_Scatter_TrendlineWidth<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_TrendlineWidth})
    
    Vis1_Scatter_ColPal_Factor<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_ColorPal_Factors})
    
    Vis1_Scatter_ColPal_Numeric<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      input$Vis1_Scatter_ColorPal_Numeric})
    
       

    Vis1_Scatter_Pal_N<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_ColorPal_Factors)
      if(input$Vis1_Scatter_ColorPal_Factors=='Reds'||input$Vis1_Scatter_ColorPal_Factors=='Purples'||input$Vis1_Scatter_ColorPal_Factors=='Greens'||input$Vis1_Scatter_ColorPal_Factors=='Blues'||input$Vis1_Scatter_ColorPal_Factors=='Greys'||input$Vis1_Scatter_ColorPal_Factors=='Set1'||input$Vis1_Scatter_ColorPal_Factors=='Pastel1'){
        9
      } else if(input$Vis1_Scatter_ColorPal_Factors=='Accent'||input$Vis1_Scatter_ColorPal_Factors=='Dark2'||input$Vis1_Scatter_ColorPal_Factors=='Pastel2'||input$Vis1_Scatter_ColorPal_Factors=='Set2'){
        8
      } else if(input$Vis1_Scatter_ColorPal_Factors=='Paired'||input$Vis1_Scatter_ColorPal_Factors=='Set3'){
        12
      } else{11}
      })
   
  observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis1=="Scatter Plot"
  )
      },{
    Vis1_ScatterX_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis1_ScatterX_Choices<-list()
        Vis1_ScatterX_Choices[Vis1_ScatterX_ChoiceNames]<-Vis1_ScatterX_ChoiceNames
        updatePickerInput(session, "Vis1_ScatterX", choices=c("Nothing Selected",Vis1_ScatterX_Choices),selected="Nothing Selected")
    },ignoreInit=TRUE)    
    
  observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis1=="Scatter Plot"
  )
      },{
    Vis1_ScatterY_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis1_ScatterY_Choices<-list()
        Vis1_ScatterY_Choices[Vis1_ScatterY_ChoiceNames]<-Vis1_ScatterY_ChoiceNames
        updatePickerInput(session, "Vis1_ScatterY", choices=c("Nothing Selected",Vis1_ScatterY_Choices),selected="Nothing Selected")
    },ignoreInit=TRUE)


observeEvent({c(
    Filtered_CompiledData(),
    input$Vis1_ScatterX
  )
      },{
    Vis1_ScatterXvar<-input$Vis1_ScatterX
        updateTextInput(session,"Vis1_ScatterXlab",value=paste(Vis1_ScatterXvar))
        },ignoreInit=TRUE)
    
observeEvent({c(
    Filtered_CompiledData(),
    input$Vis1_ScatterY
  )
      },{
    Vis1_ScatterYvar<-input$Vis1_ScatterY
        updateTextInput(session,"Vis1_ScatterYlab",value=paste(Vis1_ScatterYvar))
        },ignoreInit=TRUE)
  

observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis1=="Scatter Plot"
  )
      },{
   Vis1_ScatterSize_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis1_ScatterSize_Choices<-list()
        Vis1_ScatterSize_Choices[Vis1_ScatterSize_ChoiceNames]<-Vis1_ScatterSize_ChoiceNames
        updatePickerInput(session, "Vis1_Scatter_MarkerScaleSize",choices=c("Nothing Selected", Vis1_ScatterSize_Choices),selected="Nothing Selected")
     },ignoreInit=TRUE)
  
observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis1=="Scatter Plot"
  )
      },{
   Vis1_ScatterColor_ChoiceNames_Numeric<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis1_ScatterColor_Choices_Numeric<-list()
        Vis1_ScatterColor_Choices_Numeric[Vis1_ScatterColor_ChoiceNames_Numeric]<-Vis1_ScatterColor_ChoiceNames_Numeric
        updatePickerInput(session, "Vis1_Scatter_MarkerColor_Numeric", choices=c("Nothing Selected", Vis1_ScatterColor_Choices_Numeric),selected="Nothing Selected")
    },ignoreInit=TRUE)
    
observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis1=="Scatter Plot"
  )
      },{
   Vis1_ScatterColor_ChoiceNames_Factors<-names(dplyr::select_if(Filtered_CompiledData(),is.factor))
        Vis1_ScatterColor_Choices_Factors<-list()
        Vis1_ScatterColor_Choices_Factors[Vis1_ScatterColor_ChoiceNames_Factors]<-Vis1_ScatterColor_ChoiceNames_Factors
        updatePickerInput(session, "Vis1_Scatter_MarkerColor_Factors", choices=c(Vis1_ScatterColor_Choices_Factors),selected="State")
    },ignoreInit=TRUE)


    #### Vis 2 Scatter ####

    ##### Shared Inputs #####
    Vis2_Scatter_LegendX<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_LegendX})
    Vis2_Scatter_LegendY<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_LegendY})
    Vis2_Scatter_HideLegend<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_HideLegend})
    Vis2_Scatter_Color<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_Color})
    Vis2_Scatter_Symbol<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_Symbol})
    Vis2_Scatter_MarkerSizeSwitch<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_MarkerSizeSwitch})
    Vis2_Scatter_MarkerSize<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_MarkerSize})
    Vis2_Scatter_MarkerScaleSize<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_MarkerScaleSize})
    Vis2_Scatter_ColorGroupSwitch<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_ColorGroupSwitch})
    Vis2_Scatter_MarkerColorNumeric<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_MarkerColor_Numeric})
    Vis2_Scatter_MarkerColorFactors<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_MarkerColor_Factors})
    Vis2_Scatter_TrendlineSwitch<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_TrendlineSwitch})
    Vis2_Scatter_TrendlineColor<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_TrendlineColor})
    Vis2_Scatter_TrendlineWidth<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_TrendlineWidth})
    
    Vis2_Scatter_ColPal_Factor<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_ColorPal_Factors})
    Vis2_Scatter_ColPal_Numeric<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      input$Vis2_Scatter_ColorPal_Numeric})
    
       

    Vis2_Scatter_Pal_N<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_ColorPal_Factors)
      if(input$Vis2_Scatter_ColorPal_Factors=='Reds'||input$Vis2_Scatter_ColorPal_Factors=='Purples'||input$Vis2_Scatter_ColorPal_Factors=='Greens'||input$Vis2_Scatter_ColorPal_Factors=='Blues'||input$Vis2_Scatter_ColorPal_Factors=='Greys'||input$Vis2_Scatter_ColorPal_Factors=='Set1'||input$Vis2_Scatter_ColorPal_Factors=='Pastel1'){
        9
      } else if(input$Vis2_Scatter_ColorPal_Factors=='Accent'||input$Vis2_Scatter_ColorPal_Factors=='Dark2'||input$Vis2_Scatter_ColorPal_Factors=='Pastel2'||input$Vis2_Scatter_ColorPal_Factors=='Set2'){
        8
      } else if(input$Vis2_Scatter_ColorPal_Factors=='Paired'||input$Vis2_Scatter_ColorPal_Factors=='Set3'){
        12
      } else{11}
      })
   
  observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis2=="Scatter Plot"
  )
      },{
    Vis2_ScatterX_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis2_ScatterX_Choices<-list()
        Vis2_ScatterX_Choices[Vis2_ScatterX_ChoiceNames]<-Vis2_ScatterX_ChoiceNames
        updatePickerInput(session, "Vis2_ScatterX", choices=c("Nothing Selected",Vis2_ScatterX_Choices),selected="Nothing Selected")
    },ignoreInit=TRUE)    
    
  observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis2=="Scatter Plot"
  )
      },{
    Vis2_ScatterY_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis2_ScatterY_Choices<-list()
        Vis2_ScatterY_Choices[Vis2_ScatterY_ChoiceNames]<-Vis2_ScatterY_ChoiceNames
        updatePickerInput(session, "Vis2_ScatterY", choices=c("Nothing Selected",Vis2_ScatterY_Choices),selected="Nothing Selected")
    },ignoreInit=TRUE)


observeEvent({c(
    Filtered_CompiledData(),
    input$Vis2_ScatterX
  )
      },{
    Vis2_ScatterXvar<-input$Vis2_ScatterX
        updateTextInput(session,"Vis2_ScatterXlab",value=paste(Vis2_ScatterXvar))
        },ignoreInit=TRUE)
    
observeEvent({c(
    Filtered_CompiledData(),
    input$Vis2_ScatterY
  )
      },{
    Vis2_ScatterYvar<-input$Vis2_ScatterY
        updateTextInput(session,"Vis2_ScatterYlab",value=paste(Vis2_ScatterYvar))
        },ignoreInit=TRUE)
  

observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis2=="Scatter Plot"
  )
      },{
   Vis2_ScatterSize_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis2_ScatterSize_Choices<-list()
        Vis2_ScatterSize_Choices[Vis2_ScatterSize_ChoiceNames]<-Vis2_ScatterSize_ChoiceNames
        updatePickerInput(session, "Vis2_Scatter_MarkerScaleSize", choices=c("Nothing Selected", Vis2_ScatterSize_Choices),selected="Nothing Selected")
     },ignoreInit=TRUE)
  
observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis2=="Scatter Plot"
  )
      },{
   Vis2_ScatterColor_ChoiceNames_Numeric<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis2_ScatterColor_Choices_Numeric<-list()
        Vis2_ScatterColor_Choices_Numeric[Vis2_ScatterColor_ChoiceNames_Numeric]<-Vis2_ScatterColor_ChoiceNames_Numeric
        updatePickerInput(session, "Vis2_Scatter_MarkerColor_Numeric", choices=c("Nothing Selected", Vis2_ScatterColor_Choices_Numeric),selected="Nothing Selected")
    },ignoreInit=TRUE)
    
observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis2=="Scatter Plot"
  )
      },{
   Vis2_ScatterColor_ChoiceNames_Factors<-names(dplyr::select_if(Filtered_CompiledData(),is.factor))
        Vis2_ScatterColor_Choices_Factors<-list()
        Vis2_ScatterColor_Choices_Factors[Vis2_ScatterColor_ChoiceNames_Factors]<-Vis2_ScatterColor_ChoiceNames_Factors
        updatePickerInput(session, "Vis2_Scatter_MarkerColor_Factors", choices=c(Vis2_ScatterColor_Choices_Factors),selected="State")
    },ignoreInit=TRUE)




    #### Vis 3 Scatter ####

    ##### Shared Inputs #####
    Vis3_Scatter_LegendX<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_LegendX})
    Vis3_Scatter_LegendY<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_LegendY})
    Vis3_Scatter_HideLegend<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_HideLegend})
    Vis3_Scatter_Color<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_Color})
    Vis3_Scatter_Symbol<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_Symbol})
    Vis3_Scatter_MarkerSizeSwitch<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_MarkerSizeSwitch})
    Vis3_Scatter_MarkerSize<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_MarkerSize})
    Vis3_Scatter_MarkerScaleSize<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_MarkerScaleSize})
    Vis3_Scatter_ColorGroupSwitch<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_ColorGroupSwitch})
    Vis3_Scatter_MarkerColorNumeric<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_MarkerColor_Numeric})
    Vis3_Scatter_MarkerColorFactors<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_MarkerColor_Factors})
    Vis3_Scatter_TrendlineSwitch<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_TrendlineSwitch})
    Vis3_Scatter_TrendlineColor<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_TrendlineColor})
    Vis3_Scatter_TrendlineWidth<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_TrendlineWidth})
    
    Vis3_Scatter_ColPal_Factor<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_ColorPal_Factors})
    Vis3_Scatter_ColPal_Numeric<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      input$Vis3_Scatter_ColorPal_Numeric})
    
       

    Vis3_Scatter_Pal_N<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_ColorPal_Factors)
      if(input$Vis3_Scatter_ColorPal_Factors=='Reds'||input$Vis3_Scatter_ColorPal_Factors=='Purples'||input$Vis3_Scatter_ColorPal_Factors=='Greens'||input$Vis3_Scatter_ColorPal_Factors=='Blues'||input$Vis3_Scatter_ColorPal_Factors=='Greys'||input$Vis3_Scatter_ColorPal_Factors=='Set1'||input$Vis3_Scatter_ColorPal_Factors=='Pastel1'){
        9
      } else if(input$Vis3_Scatter_ColorPal_Factors=='Accent'||input$Vis3_Scatter_ColorPal_Factors=='Dark2'||input$Vis3_Scatter_ColorPal_Factors=='Pastel2'||input$Vis3_Scatter_ColorPal_Factors=='Set2'){
        8
      } else if(input$Vis3_Scatter_ColorPal_Factors=='Paired'||input$Vis3_Scatter_ColorPal_Factors=='Set3'){
        12
      } else{11}
      })
   
  observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis3=="Scatter Plot"
  )
      },{
    Vis3_ScatterX_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis3_ScatterX_Choices<-list()
        Vis3_ScatterX_Choices[Vis3_ScatterX_ChoiceNames]<-Vis3_ScatterX_ChoiceNames
        updatePickerInput(session, "Vis3_ScatterX", choices=c("Nothing Selected",Vis3_ScatterX_Choices),selected="Nothing Selected")
    },ignoreInit=TRUE)    
    
  observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis3=="Scatter Plot"
  )
      },{
    Vis3_ScatterY_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis3_ScatterY_Choices<-list()
        Vis3_ScatterY_Choices[Vis3_ScatterY_ChoiceNames]<-Vis3_ScatterY_ChoiceNames
        updatePickerInput(session, "Vis3_ScatterY", choices=c("Nothing Selected",Vis3_ScatterY_Choices),selected="Nothing Selected")
    },ignoreInit=TRUE)


observeEvent({c(
    Filtered_CompiledData(),
    input$Vis3_ScatterX
  )
      },{
    Vis3_ScatterXvar<-input$Vis3_ScatterX
        updateTextInput(session,"Vis3_ScatterXlab",value=paste(Vis3_ScatterXvar))
        },ignoreInit=TRUE)
    
observeEvent({c(
    Filtered_CompiledData(),
    input$Vis3_ScatterY
  )
      },{
    Vis3_ScatterYvar<-input$Vis3_ScatterY
        updateTextInput(session,"Vis3_ScatterYlab",value=paste(Vis3_ScatterYvar))
        },ignoreInit=TRUE)
  

observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis3=="Scatter Plot"
  )
      },{
   Vis3_ScatterSize_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis3_ScatterSize_Choices<-list()
        Vis3_ScatterSize_Choices[Vis3_ScatterSize_ChoiceNames]<-Vis3_ScatterSize_ChoiceNames
        updatePickerInput(session, "Vis3_Scatter_MarkerScaleSize", choices=c("Nothing Selected", Vis3_ScatterSize_Choices),selected="Nothing Selected")
     },ignoreInit=TRUE)
  
observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis3=="Scatter Plot"
  )
      },{
   Vis3_ScatterColor_ChoiceNames_Numeric<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis3_ScatterColor_Choices_Numeric<-list()
        Vis3_ScatterColor_Choices_Numeric[Vis3_ScatterColor_ChoiceNames_Numeric]<-Vis3_ScatterColor_ChoiceNames_Numeric
        updatePickerInput(session, "Vis3_Scatter_MarkerColor_Numeric", choices=c("Nothing Selected", Vis3_ScatterColor_Choices_Numeric),selected="Nothing Selected")
    },ignoreInit=TRUE)
    
observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis3=="Scatter Plot"
  )
      },{
   Vis3_ScatterColor_ChoiceNames_Factors<-names(dplyr::select_if(Filtered_CompiledData(),is.factor))
        Vis3_ScatterColor_Choices_Factors<-list()
        Vis3_ScatterColor_Choices_Factors[Vis3_ScatterColor_ChoiceNames_Factors]<-Vis3_ScatterColor_ChoiceNames_Factors
        updatePickerInput(session, "Vis3_Scatter_MarkerColor_Factors", choices=c(Vis3_ScatterColor_Choices_Factors),selected="State")
    },ignoreInit=TRUE)


    #### Vis 1 Scatter ####

    ##### Shared Inputs #####
    Vis4_Scatter_LegendX<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_LegendX})
    Vis4_Scatter_LegendY<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_LegendY})
    Vis4_Scatter_HideLegend<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_HideLegend})
    Vis4_Scatter_Color<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_Color})
    Vis4_Scatter_Symbol<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_Symbol})
    Vis4_Scatter_MarkerSizeSwitch<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_MarkerSizeSwitch})
    Vis4_Scatter_MarkerSize<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_MarkerSize})
    Vis4_Scatter_MarkerScaleSize<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_MarkerScaleSize})
    Vis4_Scatter_ColorGroupSwitch<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_ColorGroupSwitch})
    Vis4_Scatter_MarkerColorNumeric<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_MarkerColor_Numeric})
    Vis4_Scatter_MarkerColorFactors<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_MarkerColor_Factors})
    Vis4_Scatter_TrendlineSwitch<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_TrendlineSwitch})
    Vis4_Scatter_TrendlineColor<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_TrendlineColor})
    Vis4_Scatter_TrendlineWidth<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_TrendlineWidth})
    
    Vis4_Scatter_ColPal_Factor<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_ColorPal_Factors})
    Vis4_Scatter_ColPal_Numeric<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      input$Vis4_Scatter_ColorPal_Numeric})
    
       

    Vis4_Scatter_Pal_N<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      req(input$Vis4_Scatter_ColorPal_Factors)
      if(input$Vis4_Scatter_ColorPal_Factors=='Reds'||input$Vis4_Scatter_ColorPal_Factors=='Purples'||input$Vis4_Scatter_ColorPal_Factors=='Greens'||input$Vis4_Scatter_ColorPal_Factors=='Blues'||input$Vis4_Scatter_ColorPal_Factors=='Greys'||input$Vis4_Scatter_ColorPal_Factors=='Set1'||input$Vis4_Scatter_ColorPal_Factors=='Pastel1'){
        9
      } else if(input$Vis4_Scatter_ColorPal_Factors=='Accent'||input$Vis4_Scatter_ColorPal_Factors=='Dark2'||input$Vis4_Scatter_ColorPal_Factors=='Pastel2'||input$Vis4_Scatter_ColorPal_Factors=='Set2'){
        8
      } else if(input$Vis4_Scatter_ColorPal_Factors=='Paired'||input$Vis4_Scatter_ColorPal_Factors=='Set3'){
        12
      } else{11}
      })
   
  observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis4=="Scatter Plot"
  )
      },{
    Vis4_ScatterX_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis4_ScatterX_Choices<-list()
        Vis4_ScatterX_Choices[Vis4_ScatterX_ChoiceNames]<-Vis4_ScatterX_ChoiceNames
        updatePickerInput(session, "Vis4_ScatterX", choices=c("Nothing Selected",Vis4_ScatterX_Choices),selected="Nothing Selected")
    },ignoreInit=TRUE)    
    
  observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis4=="Scatter Plot"
  )
      },{
    Vis4_ScatterY_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis4_ScatterY_Choices<-list()
        Vis4_ScatterY_Choices[Vis4_ScatterY_ChoiceNames]<-Vis4_ScatterY_ChoiceNames
        updatePickerInput(session, "Vis4_ScatterY", choices=c("Nothing Selected",Vis4_ScatterY_Choices),selected="Nothing Selected")
    },ignoreInit=TRUE)


observeEvent({c(
    Filtered_CompiledData(),
    input$Vis4_ScatterX
  )
      },{
    Vis4_ScatterXvar<-input$Vis4_ScatterX
        updateTextInput(session,"Vis4_ScatterXlab",value=paste(Vis4_ScatterXvar))
        },ignoreInit=TRUE)
    
observeEvent({c(
    Filtered_CompiledData(),
    input$Vis4_ScatterY
  )
      },{
    Vis4_ScatterYvar<-input$Vis4_ScatterY
        updateTextInput(session,"Vis4_ScatterYlab",value=paste(Vis4_ScatterYvar))
        },ignoreInit=TRUE)
  

observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis4=="Scatter Plot"
  )
      },{
   Vis4_ScatterSize_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis4_ScatterSize_Choices<-list()
        Vis4_ScatterSize_Choices[Vis4_ScatterSize_ChoiceNames]<-Vis4_ScatterSize_ChoiceNames
        updatePickerInput(session, "Vis4_Scatter_MarkerScaleSize", choices=c("Nothing Selected", Vis4_ScatterSize_Choices),selected="Nothing Selected")
     },ignoreInit=TRUE)
  
observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis4=="Scatter Plot"
  )
      },{
   Vis4_ScatterColor_ChoiceNames_Numeric<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
        Vis4_ScatterColor_Choices_Numeric<-list()
        Vis4_ScatterColor_Choices_Numeric[Vis4_ScatterColor_ChoiceNames_Numeric]<-Vis4_ScatterColor_ChoiceNames_Numeric
        updatePickerInput(session, "Vis4_Scatter_MarkerColor_Numeric", choices=c("Nothing Selected", Vis4_ScatterColor_Choices_Numeric),selected="Nothing Selected")
    },ignoreInit=TRUE)
    
observeEvent({c(
    Filtered_CompiledData(),
    input$SelectVis4=="Scatter Plot"
  )
      },{
   Vis4_ScatterColor_ChoiceNames_Factors<-names(dplyr::select_if(Filtered_CompiledData(),is.factor))
        Vis4_ScatterColor_Choices_Factors<-list()
        Vis4_ScatterColor_Choices_Factors[Vis4_ScatterColor_ChoiceNames_Factors]<-Vis4_ScatterColor_ChoiceNames_Factors
        updatePickerInput(session, "Vis4_Scatter_MarkerColor_Factors", choices=c(Vis4_ScatterColor_Choices_Factors),selected="State")
    },ignoreInit=TRUE)




       
       
     ##### 1_1 Scatter #####
    
  Vis_1_1_MarkerSizeField<-eventReactive(input$Vis1_Scatter_MarkerScaleSize,{
    input$Vis1_Scatter_MarkerScaleSize
    })
    
  Vis_1_1_MarkerSizeMin<-eventReactive(c(
    req(length(Data_1_1())>0),
    input$Vis1_Scatter_MarkerScaleSize),{
    PH<-Data_1_1()%>%
      pull(input$Vis1_Scatter_MarkerScaleSize)
      return(min(PH,na.rm=TRUE))
      })
  
  Vis_1_1_MarkerSizeMax<-eventReactive(c(
    req(length(Data_1_1())>0),
    input$Vis1_Scatter_MarkerScaleSize),{
      PH<-Data_1_1()%>%
        pull(input$Vis1_Scatter_MarkerScaleSize)
        return(max(PH,na.rm=TRUE))
      })
  
  Vis_1_1_Marker_SizeRange<-eventReactive(input$Vis1_Scatter_MarkerSizeSlider,{
    input$Vis1_Scatter_MarkerSizeSlider*5
    })
  
 
    Vis_1_1_MarkerSizeScaleText<-eventReactive(c(
    req(length(Data_1_1())>0),
    input$Vis1_Scatter_MarkerScaleSize),{
     paste("Marker Size: \n" ,
             "Field: ",Vis_1_1_MarkerSizeField(),'\n',
            "Min: ", Vis_1_1_MarkerSizeMin(),'\n',
            "Max: ", Vis_1_1_MarkerSizeMax())
    })
  
  
    Vis_1_1_Scatter_Fit<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis1_ScatterY) ~ get(input$Vis1_ScatterX),data=Data_1_1())
      })
    
    Vis_1_1_Scatter_Fit_r2<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_1_1_Scatter_Fit())$r.squared
          return(round(PH,2))
      })
    Vis_1_1_Scatter_Fit_slope<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_1_1_Scatter_Fit())[[2]]
                                         return(round(PH,2))
    })
    Vis_1_1_Scatter_Fit_intercept<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_1_1_Scatter_Fit())[[1]]
                                         return(round(PH,2))
    })
    
    Vis_1_1_Scatter_Hover<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      paste("Linear Model Fit: \n" ,
             "Slope: ",Vis_1_1_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_1_1_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_1_1_Scatter_Fit_r2())
    })
      
    Vis_1_1_Scatter_Fit_Selected<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis1_ScatterY) ~ get(input$Vis1_ScatterX),data=Sel_SurveysScatter_Vis_1_1_UL())
      })
   
     Vis_1_1_Scatter_Fit_Selected_r2<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_1_1_Scatter_Fit_Selected())$r.squared
      return(round(PH,2))
      })
    Vis_1_1_Scatter_Fit_Selected_slope<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_1_1_Scatter_Fit_Selected())[[2]]
                                         return(round(PH,2))
    })
    Vis_1_1_Scatter_Fit_Selected_intercept<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_1_1_Scatter_Fit_Selected())[[1]]
                                         return(round(PH,2))
    })
    Vis_1_1_Scatter_Selected_Hover<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      paste("Fit: All Points \n" ,
            "Slope: ",Vis_1_1_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_1_1_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_1_1_Scatter_Fit_r2(),'\n',
            '\n',
            "Fit: Selected Points \n" ,
             "Slope: ",Vis_1_1_Scatter_Fit_Selected_slope(),'\n',
            "Intercept: ", Vis_1_1_Scatter_Fit_Selected_intercept(),'\n',
            "R-Squared: ", Vis_1_1_Scatter_Fit_Selected_r2())
    })
    
    Vis_1_1_Scatter_Factor_Count<-reactive({
      req(length(Data_1_1())>0)
      req(input$Vis1_Scatter_MarkerColor_Factors!='Nothing Selected')
      req(length(Vis_1_SelectedTBL())>0)
      
      Vis_1_PalData<-Vis_1_SelectedTBL()
      
      PH<-Vis_1_PalData%>%
        droplevels()%>%
        select(input$Vis1_Scatter_MarkerColor_Factors)
      PH2<-n_distinct(PH[1])
      return(PH2)
      
    })
            

    Vis_1_1_Scatter_Factor_Palette<-reactive({
      req(length(Vis_1_1_Scatter_Factor_Count())>0)
      colorRampPalette(brewer.pal(Vis1_Scatter_Pal_N(),input$Vis1_Scatter_ColorPal_Factors))(Vis_1_1_Scatter_Factor_Count())
    })
      


  observeEvent(
    req(
      input$Vis1_Scatter_ColorPal_Factors,
      length(Vis_1_1_Scatter_Factor_Palette())>0,
      input$Vis1_Scatter_MarkerColor_Factors!='Nothing Selected',
      length(Data_1_1())>0
    ),{
      
      PH<-Vis_1_SelectedTBL()%>%
        select(input$Vis1_Scatter_MarkerColor_Factors)%>%
        droplevels()

      PH2<-distinct(PH)
      PH3<-bind_cols(PH2,data.frame(FactorColor=Vis_1_1_Scatter_Factor_Palette()))

      PH4<-Vis_1_SelectedTBL()%>%
        left_join(PH3,by=c(input$Vis1_Scatter_MarkerColor_Factors))

      Data_1_1(PH4)

    },ignoreInit=TRUE
    )
  


   
      Vis_1_1_Scatter_UUYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        req(!is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_1_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                    data=Sel_SurveysScatter_Vis_1_1_UL(),
                    x=~get(input$Vis1_ScatterX),
                    y=~get(input$Vis1_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    showlegend=FALSE,
                    opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_1_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_1_1_Scatter_UUYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        req(is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        
         plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
                )
              }
        )
      
     Vis_1_1_Scatter_UUNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        req(!is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(
                    data=Sel_SurveysScatter_Vis_1_1_UL(),
                    x=~get(input$Vis1_ScatterX),
                    y=~get(input$Vis1_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_1_1_Scatter_UUNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        req(is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_1_1_Scatter_USYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        req(!is.null(Sel_SurveysScatter_Vis_1_1_UL()))
            
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_1_1_Marker_SizeRange(),
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=Sel_SurveysScatter_Vis_1_1_UL(),
                    x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
            data=Data_1_1(),
            x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_1_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
            data=Sel_SurveysScatter_Vis_1_1_UL(),
                    x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_1_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
    
      Vis_1_1_Scatter_USYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        req(is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_1_1_Marker_SizeRange(),
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_1_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_1_1_Scatter_USNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        req(!is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_1_1_Marker_SizeRange(),
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=Sel_SurveysScatter_Vis_1_1_UL(),
                    x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_1_1_Scatter_USNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        req(is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_1_1_Marker_SizeRange(),
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
        
      
#### Factors ####      
      Vis_1_1_Scatter_FUYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        req(!is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_1_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                data=Sel_SurveysScatter_Vis_1_1_UL(),
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_1_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_1_1_Scatter_FUYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        req(is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        
         plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_1_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_1_1_Scatter_FUNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        req(!is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(
                data=Sel_SurveysScatter_Vis_1_1_UL(),
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_1_1_Scatter_FUNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        req(is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
      


      Vis_1_1_Scatter_FSYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        req(!is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_1_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=Sel_SurveysScatter_Vis_1_1_UL(),
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
              data=Data_1_1(),
              x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_1_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
         add_trace(
           data=Sel_SurveysScatter_Vis_1_1_UL(),
           x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_1_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})

                     )
                     )
            )
                   }
        )

      Vis_1_1_Scatter_FSYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        req(is.null(Sel_SurveysScatter_Vis_1_1_UL()))
          plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_1_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),

                              hovertemplate=Vis_1_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                     )
            )
            )
                   }
        )

     Vis_1_1_Scatter_FSNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        req(!is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_1_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=Sel_SurveysScatter_Vis_1_1_UL(),
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_1_1_Scatter_FSNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        req(is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_1_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
#### Numeric ####      
      Vis_1_1_Scatter_CUYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        req(!is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_1_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                data=Sel_SurveysScatter_Vis_1_1_UL(),
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_1_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_1_1_Scatter_CUYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        req(is.null(Sel_SurveysScatter_Vis_1_1_UL()))
          plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_1_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_1_1_Scatter_CUNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        req(!is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity)%>%
            add_trace(
                data=Sel_SurveysScatter_Vis_1_1_UL(),
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_1_1_Scatter_CUNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        req(is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(
                    orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_1_1_Scatter_CSYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        req(!is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_1_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_1_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_1_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                data=Sel_SurveysScatter_Vis_1_1_UL(),
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_1_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                     )
            )
                   }
        )
    
      Vis_1_1_Scatter_CSYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        req(is.null(Sel_SurveysScatter_Vis_1_1_UL()))
          plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_1_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_1_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                             
                              hovertemplate=Vis_1_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_1_1_Scatter_CSNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        req(!is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_1_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_1_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(
                data=Sel_SurveysScatter_Vis_1_1_UL(),
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_1_1_Scatter_CSNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_1_1())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        req(is.null(Sel_SurveysScatter_Vis_1_1_UL()))
        plot_ly(
                Data_1_1(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_1_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_1_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_1_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )    
      
       output$Vis_1_1_Scatter<-renderPlotly({
      if(Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_UUYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_UUYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_UUNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_UUNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_USYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_USYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_USNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_USNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_FUYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_FUYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_FUNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_FUNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_FSYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_FSYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_FSNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_FSNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_CUYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_CUYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_CUNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_CUNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_CSYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_CSYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_CSNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(Sel_SurveysScatter_Vis_1_1_UL())){
      Vis_1_1_Scatter_CSNN()
      }
   })              
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
       
    ##### 2_1 Scatter #####
    
  Vis_2_1_MarkerSizeField<-eventReactive(input$Vis1_Scatter_MarkerScaleSize,{
    input$Vis1_Scatter_MarkerScaleSize
    })
    
  Vis_2_1_MarkerSizeMin<-eventReactive(c(
    req(length(Data_2_1_Complete())>0),
    input$Vis1_Scatter_MarkerScaleSize),{
    PH<-Data_2_1_Complete()%>%
      pull(input$Vis1_Scatter_MarkerScaleSize)
      return(min(PH,na.rm=TRUE))
      })
  
  Vis_2_1_MarkerSizeMax<-eventReactive(c(
    req(length(Data_2_1_Complete())>0),
    input$Vis1_Scatter_MarkerScaleSize),{
      PH<-Data_2_1_Complete()%>%
        pull(input$Vis1_Scatter_MarkerScaleSize)
        return(max(PH,na.rm=TRUE))
      })
  
  Vis_2_1_Marker_SizeRange<-eventReactive(input$Vis1_Scatter_MarkerSizeSlider,{
    input$Vis1_Scatter_MarkerSizeSlider*5
    })
  
 
    Vis_2_1_MarkerSizeScaleText<-eventReactive(c(
    req(length(Data_2_1_Complete())>0),
    input$Vis1_Scatter_MarkerScaleSize),{
     paste("Marker Size: \n" ,
             "Field: ",Vis_2_1_MarkerSizeField(),'\n',
            "Min: ", Vis_2_1_MarkerSizeMin(),'\n',
            "Max: ", Vis_2_1_MarkerSizeMax())
    })
  
  
    Vis_2_1_Scatter_Fit<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis1_ScatterY) ~ get(input$Vis1_ScatterX),data=Data_2_1_Complete())
      })
    
    Vis_2_1_Scatter_Fit_r2<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_2_1_Scatter_Fit())$r.squared
          return(round(PH,2))
      })
    Vis_2_1_Scatter_Fit_slope<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_2_1_Scatter_Fit())[[2]]
                                         return(round(PH,2))
    })
    Vis_2_1_Scatter_Fit_intercept<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_2_1_Scatter_Fit())[[1]]
                                         return(round(PH,2))
    })
    
    Vis_2_1_Scatter_Hover<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      paste("Linear Model Fit: \n" ,
             "Slope: ",Vis_2_1_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_2_1_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_2_1_Scatter_Fit_r2())
    })
      
    Vis_2_1_Scatter_Fit_Selected<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis1_ScatterY) ~ get(input$Vis1_ScatterX),data=if(input$AF_LinkedSelection=="No"){Sel_SurveysScatter_Vis_2_1_UL()} else {HighlightTrace_2Vis()})
      })
   
     Vis_2_1_Scatter_Fit_Selected_r2<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_2_1_Scatter_Fit_Selected())$r.squared
      return(round(PH,2))
      })
    Vis_2_1_Scatter_Fit_Selected_slope<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_2_1_Scatter_Fit_Selected())[[2]]
                                         return(round(PH,2))
    })
    Vis_2_1_Scatter_Fit_Selected_intercept<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_2_1_Scatter_Fit_Selected())[[1]]
                                         return(round(PH,2))
    })
    Vis_2_1_Scatter_Selected_Hover<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      paste("Fit: All Points \n" ,
            "Slope: ",Vis_2_1_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_2_1_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_2_1_Scatter_Fit_r2(),'\n',
            '\n',
            "Fit: Selected Points \n" ,
             "Slope: ",Vis_2_1_Scatter_Fit_Selected_slope(),'\n',
            "Intercept: ", Vis_2_1_Scatter_Fit_Selected_intercept(),'\n',
            "R-Squared: ", Vis_2_1_Scatter_Fit_Selected_r2())
    })
    
    Vis_2_1_Scatter_Factor_Count<-reactive({
      req(length(Data_2_1_Complete())>0)
      req(input$Vis1_Scatter_MarkerColor_Factors!='Nothing Selected')
      
      if(input$AF_SharedData=="Yes"){req(length(Shared_SelectedTBL())>0)}else{req(length(Vis_1_SelectedTBL())>0)}
      
      Vis_1_PalData<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_1_SelectedTBL()}
      
      PH<-Vis_1_PalData%>%
        droplevels()%>%
        select(input$Vis1_Scatter_MarkerColor_Factors)
      PH2<-n_distinct(PH[1])
      return(PH2)
      
    })
            

    Vis_2_1_Scatter_Factor_Palette<-reactive({
      req(length(Vis_2_1_Scatter_Factor_Count())>0)
      colorRampPalette(brewer.pal(Vis1_Scatter_Pal_N(),input$Vis1_Scatter_ColorPal_Factors))(Vis_2_1_Scatter_Factor_Count())
    })
      


  observeEvent(
    req(
      input$Vis1_Scatter_ColorPal_Factors,
      length(Vis_2_1_Scatter_Factor_Palette())>0,
      input$Vis1_Scatter_MarkerColor_Factors!='Nothing Selected',
      length(Data_2_1_Complete())>0
    ),{

      Vis_1_Data_TBL<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_1_SelectedTBL()}

      PH<-Vis_1_Data_TBL%>%
        select(input$Vis1_Scatter_MarkerColor_Factors)%>%
        droplevels()

      PH2<-distinct(PH)
      PH3<-bind_cols(PH2,data.frame(FactorColor=Vis_2_1_Scatter_Factor_Palette()))

      PH4<-Vis_1_Data_TBL%>%
        left_join(PH3,by=c(input$Vis1_Scatter_MarkerColor_Factors))

      Data_2_1_Complete(PH4)

    },ignoreInit=TRUE
    )
  
  HighlightTrace_Vis_2_1<-reactiveVal()
  
  observeEvent(
    c(HighlightTrace_2Vis()),{
      req(nrow(HighlightTrace_2Vis())>0)
      req(nrow(Data_2_1_Complete())>0)
      
      HT_2Vis_SelSurveys<-HighlightTrace_2Vis()%>%
        select("Survey_ID")

      PH<-left_join(HT_2Vis_SelSurveys,Data_2_1_Complete(),by=c("Survey_ID"="Survey_ID"))

      HighlightTrace_Vis_2_1(PH)

    },ignoreInit=TRUE
    )
    


   
      Vis_2_1_Scatter_UUYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_2_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                    y=~get(input$Vis1_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    showlegend=FALSE,
                    opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_2_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_2_1_Scatter_UUYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
          plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
                )
              }
        )
      
     Vis_2_1_Scatter_UUNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                    y=~get(input$Vis1_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_2_1_Scatter_UUNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_2_1_Scatter_USYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_2_1_Marker_SizeRange(),
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
            data=Data_2_1_Complete(),
            x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_2_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
            data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_2_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
    
      Vis_2_1_Scatter_USYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
          plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_2_1_Marker_SizeRange(),
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_2_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_2_1_Scatter_USNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_2_1_Marker_SizeRange(),
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_2_1_Scatter_USNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_2_1_Marker_SizeRange(),
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
        
      
#### Factors ####      
      Vis_2_1_Scatter_FUYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_2_1()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_2_1()} else {Sel_SurveysScatter_Vis_2_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_2_1_Scatter_FUYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_2_1()))}else{req(is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
          plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_2_1_Scatter_FUNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_2_1()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_2_1()} else {Sel_SurveysScatter_Vis_2_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_2_1_Scatter_FUNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_2_1()))}else{req(is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
      


      Vis_2_1_Scatter_FSYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_2_1()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_2_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_2_1()} else {Sel_SurveysScatter_Vis_2_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
              data=Data_2_1_Complete(),
              x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_2_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
         add_trace(
           data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_2_1()} else {Sel_SurveysScatter_Vis_2_1_UL()},
           x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_2_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})

                     )
                     )
            )
                   }
        )

      Vis_2_1_Scatter_FSYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_2_1()))}else{req(is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
          plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_2_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),

                              hovertemplate=Vis_2_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                     )
            )
            )
                   }
        )

     Vis_2_1_Scatter_FSNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_2_1()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_2_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_2_1()} else {Sel_SurveysScatter_Vis_2_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_2_1_Scatter_FSNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_2_1()))}else{req(is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_2_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
#### Numeric ####      
      Vis_2_1_Scatter_CUYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_2_1_Scatter_CUYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
          plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_2_1_Scatter_CUNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity)%>%
            add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_2_1_Scatter_CUNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_2_1_Scatter_CSYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_2_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_1_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                     )
            )
                   }
        )
    
      Vis_2_1_Scatter_CSYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
          plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_2_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_2_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                             
                              hovertemplate=Vis_2_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_2_1_Scatter_CSNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_2_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_1_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_2_1_Scatter_CSNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_2_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_1_UL()))}
        plot_ly(
                Data_2_1_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_2_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_2_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_2_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )    
      
       output$Vis_2_1_Scatter<-renderPlotly({
      if(Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_UUYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_UUYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_UUNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_UUNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_USYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_USYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_USNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_USNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_FUYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_FUYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_FUNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_FUNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_FSYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_FSYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_FSNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_FSNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_CUYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_CUYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_CUNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_CUNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_CSYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_CSYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_CSNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_1_UL()})){
      Vis_2_1_Scatter_CSNN()
      }
   })              
       
       
       
       
    ##### 3_1 Scatter #####
    
  Vis_3_1_MarkerSizeField<-eventReactive(input$Vis1_Scatter_MarkerScaleSize,{
    input$Vis1_Scatter_MarkerScaleSize
    })
    
  Vis_3_1_MarkerSizeMin<-eventReactive(c(
    req(length(Data_3_1_Complete())>0),
    input$Vis1_Scatter_MarkerScaleSize),{
    PH<-Data_3_1_Complete()%>%
      pull(input$Vis1_Scatter_MarkerScaleSize)
      return(min(PH,na.rm=TRUE))
      })
  
  Vis_3_1_MarkerSizeMax<-eventReactive(c(
    req(length(Data_3_1_Complete())>0),
    input$Vis1_Scatter_MarkerScaleSize),{
      PH<-Data_3_1_Complete()%>%
        pull(input$Vis1_Scatter_MarkerScaleSize)
        return(max(PH,na.rm=TRUE))
      })
  
  Vis_3_1_Marker_SizeRange<-eventReactive(input$Vis1_Scatter_MarkerSizeSlider,{
    input$Vis1_Scatter_MarkerSizeSlider*5
    })
  
 
    Vis_3_1_MarkerSizeScaleText<-eventReactive(c(
    req(length(Data_3_1_Complete())>0),
    input$Vis1_Scatter_MarkerScaleSize),{
     paste("Marker Size: \n" ,
             "Field: ",Vis_3_1_MarkerSizeField(),'\n',
            "Min: ", Vis_3_1_MarkerSizeMin(),'\n',
            "Max: ", Vis_3_1_MarkerSizeMax())
    })
  
  
    Vis_3_1_Scatter_Fit<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis1_ScatterY) ~ get(input$Vis1_ScatterX),data=Data_3_1_Complete())
      })
    
    Vis_3_1_Scatter_Fit_r2<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_3_1_Scatter_Fit())$r.squared
          return(round(PH,2))
      })
    Vis_3_1_Scatter_Fit_slope<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_3_1_Scatter_Fit())[[2]]
                                         return(round(PH,2))
    })
    Vis_3_1_Scatter_Fit_intercept<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_3_1_Scatter_Fit())[[1]]
                                         return(round(PH,2))
    })
    
    Vis_3_1_Scatter_Hover<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      paste("Linear Model Fit: \n" ,
             "Slope: ",Vis_3_1_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_3_1_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_3_1_Scatter_Fit_r2())
    })
      
    Vis_3_1_Scatter_Fit_Selected<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis1_ScatterY) ~ get(input$Vis1_ScatterX),data=if(input$AF_LinkedSelection=="No"){Sel_SurveysScatter_Vis_3_1_UL()} else {HighlightTrace_3Vis()})
      })
   
     Vis_3_1_Scatter_Fit_Selected_r2<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_3_1_Scatter_Fit_Selected())$r.squared
      return(round(PH,2))
      })
    Vis_3_1_Scatter_Fit_Selected_slope<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_3_1_Scatter_Fit_Selected())[[2]]
                                         return(round(PH,2))
    })
    Vis_3_1_Scatter_Fit_Selected_intercept<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_3_1_Scatter_Fit_Selected())[[1]]
                                         return(round(PH,2))
    })
    Vis_3_1_Scatter_Selected_Hover<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      paste("Fit: All Points \n" ,
            "Slope: ",Vis_3_1_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_3_1_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_3_1_Scatter_Fit_r2(),'\n',
            '\n',
            "Fit: Selected Points \n" ,
             "Slope: ",Vis_3_1_Scatter_Fit_Selected_slope(),'\n',
            "Intercept: ", Vis_3_1_Scatter_Fit_Selected_intercept(),'\n',
            "R-Squared: ", Vis_3_1_Scatter_Fit_Selected_r2())
    })
    
    Vis_3_1_Scatter_Factor_Count<-reactive({
      req(length(Data_3_1_Complete())>0)
      req(input$Vis1_Scatter_MarkerColor_Factors!='Nothing Selected')
      if(input$AF_SharedData=="Yes"){req(length(Shared_SelectedTBL())>0)}else{req(length(Vis_1_SelectedTBL())>0)}
      
      Vis_1_PalData<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_1_SelectedTBL()}
      
      PH<-Vis_1_PalData%>%
        droplevels()%>%
        select(input$Vis1_Scatter_MarkerColor_Factors)
      PH2<-n_distinct(PH[1])
      return(PH2)
    })
            

    Vis_3_1_Scatter_Factor_Palette<-reactive({
      req(length(Vis_3_1_Scatter_Factor_Count())>0)
      colorRampPalette(brewer.pal(Vis1_Scatter_Pal_N(),input$Vis1_Scatter_ColorPal_Factors))(Vis_3_1_Scatter_Factor_Count())
    })
      


  observeEvent(
    req(
      input$Vis1_Scatter_ColorPal_Factors,
      length(Vis_3_1_Scatter_Factor_Palette())>0,
      input$Vis1_Scatter_MarkerColor_Factors!='Nothing Selected',
      length(Data_3_1_Complete())>0
    ),{
      
      Vis_1_Data_TBL<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_1_SelectedTBL()}
      
      PH<-Vis_1_Data_TBL%>%
        select(input$Vis1_Scatter_MarkerColor_Factors)%>%
        droplevels()

      PH2<-distinct(PH)
      PH3<-bind_cols(PH2,data.frame(FactorColor=Vis_3_1_Scatter_Factor_Palette()))

      PH4<-Vis_1_Data_TBL%>%
        left_join(PH3,by=c(input$Vis1_Scatter_MarkerColor_Factors))

      Data_3_1_Complete(PH4)

    },ignoreInit=TRUE
    )
  
  HighlightTrace_Vis_3_1<-reactiveVal()
  
  observeEvent(
    c(HighlightTrace_3Vis()),{
      req(nrow(HighlightTrace_3Vis())>0)
      req(nrow(Data_3_1_Complete())>0)
      
      HT_3Vis_SelSurveys<-HighlightTrace_3Vis()%>%
        select("Survey_ID")

      PH<-left_join(HT_3Vis_SelSurveys,Data_3_1_Complete(),by=c("Survey_ID"="Survey_ID"))

      HighlightTrace_Vis_3_1(PH)

    },ignoreInit=TRUE
    )
    


   
      Vis_3_1_Scatter_UUYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_3_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                    y=~get(input$Vis1_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    showlegend=FALSE,
                    opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_3_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_3_1_Scatter_UUYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
          plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
                )
              }
        )
      
     Vis_3_1_Scatter_UUNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                    y=~get(input$Vis1_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_3_1_Scatter_UUNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_3_1_Scatter_USYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_3_1_Marker_SizeRange(),
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
            data=Data_3_1_Complete(),
            x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_3_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
            data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_3_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
    
      Vis_3_1_Scatter_USYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
          plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_3_1_Marker_SizeRange(),
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_3_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_3_1_Scatter_USNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_3_1_Marker_SizeRange(),
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_3_1_Scatter_USNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_3_1_Marker_SizeRange(),
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
        
      
#### Factors ####      
      Vis_3_1_Scatter_FUYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_3_1()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_1()} else {Sel_SurveysScatter_Vis_3_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_3_1_Scatter_FUYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_3_1()))}else{req(is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
          plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_3_1_Scatter_FUNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_3_1()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_1()} else {Sel_SurveysScatter_Vis_3_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_3_1_Scatter_FUNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_3_1()))}else{req(is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
      


      Vis_3_1_Scatter_FSYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_3_1()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_3_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_1()} else {Sel_SurveysScatter_Vis_3_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
              data=Data_3_1_Complete(),
              x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_3_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
         add_trace(
           data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_1()} else {Sel_SurveysScatter_Vis_3_1_UL()},
           x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_3_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})

                     )
                     )
            )
                   }
        )

      Vis_3_1_Scatter_FSYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_3_1()))}else{req(is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
          plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_3_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),

                              hovertemplate=Vis_3_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                     )
            )
            )
                   }
        )

     Vis_3_1_Scatter_FSNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_3_1()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_3_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_1()} else {Sel_SurveysScatter_Vis_3_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_3_1_Scatter_FSNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_3_1()))}else{req(is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_3_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
#### Numeric ####      
      Vis_3_1_Scatter_CUYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_3_1_Scatter_CUYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
          plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_3_1_Scatter_CUNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity)%>%
            add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_3_1_Scatter_CUNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_3_1_Scatter_CSYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_3_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_1_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                     )
            )
                   }
        )
    
      Vis_3_1_Scatter_CSYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
          plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_3_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_3_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                             
                              hovertemplate=Vis_3_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_3_1_Scatter_CSNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_3_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_1_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_3_1_Scatter_CSNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_3_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_1_UL()))}
        plot_ly(
                Data_3_1_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_3_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_3_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_3_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )    
      
       output$Vis_3_1_Scatter<-renderPlotly({
      if(Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_UUYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_UUYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_UUNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_UUNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_USYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_USYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_USNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_USNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_FUYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_FUYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_FUNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_FUNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_FSYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_FSYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_FSNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_FSNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_CUYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_CUYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_CUNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_CUNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_CSYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_CSYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_CSNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_1_UL()})){
      Vis_3_1_Scatter_CSNN()
      }
   })        
       
       
       
     ##### 4_1 Scatter #####
    
  Vis_4_1_MarkerSizeField<-eventReactive(input$Vis1_Scatter_MarkerScaleSize,{
    input$Vis1_Scatter_MarkerScaleSize
    })
    
  Vis_4_1_MarkerSizeMin<-eventReactive(c(
    req(length(Data_4_1_Complete())>0),
    input$Vis1_Scatter_MarkerScaleSize),{
    PH<-Data_4_1_Complete()%>%
      pull(input$Vis1_Scatter_MarkerScaleSize)
      return(min(PH,na.rm=TRUE))
      })
  
  Vis_4_1_MarkerSizeMax<-eventReactive(c(
    req(length(Data_4_1_Complete())>0),
    input$Vis1_Scatter_MarkerScaleSize),{
      PH<-Data_4_1_Complete()%>%
        pull(input$Vis1_Scatter_MarkerScaleSize)
        return(max(PH,na.rm=TRUE))
      })
  
  Vis_4_1_Marker_SizeRange<-eventReactive(input$Vis1_Scatter_MarkerSizeSlider,{
    input$Vis1_Scatter_MarkerSizeSlider*5
    })
  


    Vis_4_1_MarkerSizeScaleText<-eventReactive(c(
    req(length(Data_4_1_Complete())>0),
    input$Vis1_Scatter_MarkerScaleSize),{
     paste("Marker Size: \n" ,
             "Field: ",Vis_4_1_MarkerSizeField(),'\n',
            "Min: ", Vis_4_1_MarkerSizeMin(),'\n',
            "Max: ", Vis_4_1_MarkerSizeMax())
    })
  
  
    Vis_4_1_Scatter_Fit<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis1_ScatterY) ~ get(input$Vis1_ScatterX),data=Data_4_1_Complete())
      })
    
    Vis_4_1_Scatter_Fit_r2<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_4_1_Scatter_Fit())$r.squared
          return(round(PH,2))
      })
    Vis_4_1_Scatter_Fit_slope<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_1_Scatter_Fit())[[2]]
                                         return(round(PH,2))
    })
    Vis_4_1_Scatter_Fit_intercept<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_1_Scatter_Fit())[[1]]
                                         return(round(PH,2))
    })
    
    Vis_4_1_Scatter_Hover<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      paste("Linear Model Fit: \n" ,
             "Slope: ",Vis_4_1_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_4_1_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_4_1_Scatter_Fit_r2())
    })
      
    Vis_4_1_Scatter_Fit_Selected<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis1_ScatterY) ~ get(input$Vis1_ScatterX),data=if(input$AF_LinkedSelection=="No"){Sel_SurveysScatter_Vis_4_1_UL()} else {HighlightTrace_4Vis()})
      })
   
     Vis_4_1_Scatter_Fit_Selected_r2<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_4_1_Scatter_Fit_Selected())$r.squared
      return(round(PH,2))
      })
    Vis_4_1_Scatter_Fit_Selected_slope<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_1_Scatter_Fit_Selected())[[2]]
                                         return(round(PH,2))
    })
    Vis_4_1_Scatter_Fit_Selected_intercept<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_1_Scatter_Fit_Selected())[[1]]
                                         return(round(PH,2))
    })
    Vis_4_1_Scatter_Selected_Hover<-reactive({
      req(input$SelectVis1=="Scatter Plot")
      req(input$Vis1_Scatter_TrendlineSwitch=="Yes")
      paste("Fit: All Points \n" ,
            "Slope: ",Vis_4_1_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_4_1_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_4_1_Scatter_Fit_r2(),'\n',
            '\n',
            "Fit: Selected Points \n" ,
             "Slope: ",Vis_4_1_Scatter_Fit_Selected_slope(),'\n',
            "Intercept: ", Vis_4_1_Scatter_Fit_Selected_intercept(),'\n',
            "R-Squared: ", Vis_4_1_Scatter_Fit_Selected_r2())
    })
    
    Vis_4_1_Scatter_Factor_Count<-reactive({
      req(length(Data_4_1_Complete())>0)
      req(input$Vis1_Scatter_MarkerColor_Factors!='Nothing Selected')
      if(input$AF_SharedData=="Yes"){req(length(Shared_SelectedTBL())>0)}else{req(length(Vis_1_SelectedTBL())>0)}
      
      Vis_1_PalData<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_1_SelectedTBL()}
      
      PH<-Vis_1_PalData%>%
        droplevels()%>%
        select(input$Vis1_Scatter_MarkerColor_Factors)
      PH2<-n_distinct(PH[1])
      return(PH2)
    })
            

    Vis_4_1_Scatter_Factor_Palette<-reactive({
      req(length(Vis_4_1_Scatter_Factor_Count())>0)
      colorRampPalette(brewer.pal(Vis1_Scatter_Pal_N(),input$Vis1_Scatter_ColorPal_Factors))(Vis_4_1_Scatter_Factor_Count())
    })
      


  observeEvent(
    req(
      input$Vis1_Scatter_ColorPal_Factors,
      length(Vis_4_1_Scatter_Factor_Palette())>0,
      input$Vis1_Scatter_MarkerColor_Factors!='Nothing Selected',
      length(Data_4_1_Complete())>0
    ),{
      
      Vis_1_Data_TBL<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_1_SelectedTBL()}
      
      PH<-Vis_1_Data_TBL%>%
        select(input$Vis1_Scatter_MarkerColor_Factors)%>%
        droplevels()

      PH2<-distinct(PH)
      PH3<-bind_cols(PH2,data.frame(FactorColor=Vis_4_1_Scatter_Factor_Palette()))

      PH4<-Vis_1_Data_TBL%>%
        left_join(PH3,by=c(input$Vis1_Scatter_MarkerColor_Factors))

      Data_4_1_Complete(PH4)

    },ignoreInit=TRUE
    )
  
  HighlightTrace_Vis_4_1<-reactiveVal()
  
  observeEvent(
    c(HighlightTrace_4Vis()),{
      req(nrow(HighlightTrace_4Vis())>0)
      req(nrow(Data_4_1_Complete())>0)
      
      HT_4Vis_SelSurveys<-HighlightTrace_4Vis()%>%
        select("Survey_ID")

      PH<-left_join(HT_4Vis_SelSurveys,Data_4_1_Complete(),by=c("Survey_ID"="Survey_ID"))

      HighlightTrace_Vis_4_1(PH)

    },ignoreInit=TRUE
    )
    


   
      Vis_4_1_Scatter_UUYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_4_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                    y=~get(input$Vis1_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    showlegend=FALSE,
                    opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_4_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_4_1_Scatter_UUYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
          plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
                )
              }
        )
      
     Vis_4_1_Scatter_UUNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                    y=~get(input$Vis1_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_4_1_Scatter_UUNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(color=~Vis1_Scatter_Color(),
                             size=Vis1_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_4_1_Scatter_USYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_4_1_Marker_SizeRange(),
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
            data=Data_4_1_Complete(),
            x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
            data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
    
      Vis_4_1_Scatter_USYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
          plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_4_1_Marker_SizeRange(),
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_4_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_4_1_Scatter_USNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_4_1_Marker_SizeRange(),
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_1_UL()},
                    x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_4_1_Scatter_USNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_4_1_Marker_SizeRange(),
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis1_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
        
      
#### Factors ####      
      Vis_4_1_Scatter_FUYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_1()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_1()} else {Sel_SurveysScatter_Vis_4_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50),
                paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_4_1_Scatter_FUYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_1()))}else{req(is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
          plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_4_1_Scatter_FUNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_1()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_1()} else {Sel_SurveysScatter_Vis_4_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_4_1_Scatter_FUNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_1()))}else{req(is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
      


      Vis_4_1_Scatter_FSYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_1()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_4_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_1()} else {Sel_SurveysScatter_Vis_4_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
              data=Data_4_1_Complete(),
              x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
         add_trace(
           data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_1()} else {Sel_SurveysScatter_Vis_4_1_UL()},
           x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})

                     )
                     )
            )
                   }
        )

      Vis_4_1_Scatter_FSYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_1()))}else{req(is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
          plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_4_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),

                              hovertemplate=Vis_4_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                     )
            )
            )
                   }
        )

     Vis_4_1_Scatter_FSNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_1()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_4_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_1_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_1()} else {Sel_SurveysScatter_Vis_4_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_4_1_Scatter_FSNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_1()))}else{req(is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter",
                name=~get(input$Vis1_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_4_1_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis1_Scatter_HideLegend()),
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
#### Numeric ####      
      Vis_4_1_Scatter_CUYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_4_1_Scatter_CUYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
          plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_4_1_Scatter_CUNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity)%>%
            add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_4_1_Scatter_CUNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis1_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_4_1_Scatter_CSYY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_4_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_1_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_1_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_1_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_1_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                     )
            )
                   }
        )
    
      Vis_4_1_Scatter_CSYN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
          plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_4_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis1_ScatterX),
                              y=fitted(Vis_4_1_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis1_Scatter_TrendlineColor(),
                                        width=Vis1_Scatter_TrendlineWidth()),
                             
                              hovertemplate=Vis_4_1_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_4_1_Scatter_CSNY<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_4_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_1_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_1_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_1_UL()},
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_4_1_Scatter_CSNN<-reactive({
        req(input$SelectVis1=="Scatter Plot")
        req(length(Data_4_1_Complete())>0)
        req(Vis1_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis1_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis1_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_1_UL()))}
        plot_ly(
                Data_4_1_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis1_Scatter_MarkerScaleSize),
                sizes=~Vis_4_1_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_1_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis1_ScatterX),
                y=~get(input$Vis1_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis1_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis1_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis1_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis1_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis1_Scatter_PalToggle,
                  showscale=c(Vis1_Scatter_HideLegend()),
                  colorscale=Vis1_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis1_Scatter_Orientation,x=input$Vis1_Scatter_LegendX, y=input$Vis1_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis1_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis1_Scatter_HideLegend()=="TRUE"){Vis_4_1_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )    
      
       output$Vis_4_1_Scatter<-renderPlotly({
      if(Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_UUYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_UUYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_UUNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_UUNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_USYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_USYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_USNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Uniform"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_USNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_FUYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_FUYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_FUNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_FUNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_FSYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_FSYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_FSNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Factors"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_FSNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_CUYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_CUYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_CUNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_CUNN()
      } else if(Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_CSYY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_CSYN()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_CSNY()
      } else if (Vis1_Scatter_ColorGroupSwitch()=="Numeric"&&Vis1_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis1_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_1_UL()})){
      Vis_4_1_Scatter_CSNN()
      }
   })       
       

       
       
    ##### 2_2 Scatter #####
    
  Vis_2_2_MarkerSizeField<-eventReactive(input$Vis2_Scatter_MarkerScaleSize,{
    input$Vis2_Scatter_MarkerScaleSize
    })
    
  Vis_2_2_MarkerSizeMin<-eventReactive(c(
    req(length(Data_2_2_Complete())>0),
    input$Vis2_Scatter_MarkerScaleSize),{
    PH<-Data_2_2_Complete()%>%
      pull(input$Vis2_Scatter_MarkerScaleSize)
      return(min(PH,na.rm=TRUE))
      })
  
  Vis_2_2_MarkerSizeMax<-eventReactive(c(
    req(length(Data_2_2_Complete())>0),
    input$Vis2_Scatter_MarkerScaleSize),{
      PH<-Data_2_2_Complete()%>%
        pull(input$Vis2_Scatter_MarkerScaleSize)
        return(max(PH,na.rm=TRUE))
      })
  
  Vis_2_2_Marker_SizeRange<-eventReactive(input$Vis2_Scatter_MarkerSizeSlider,{
    input$Vis2_Scatter_MarkerSizeSlider*5
    })
  
  

    Vis_2_2_MarkerSizeScaleText<-eventReactive(c(
    req(length(Data_2_2_Complete())>0),
    input$Vis2_Scatter_MarkerScaleSize),{
     paste("Marker Size: \n" ,
             "Field: ",Vis_2_2_MarkerSizeField(),'\n',
            "Min: ", Vis_2_2_MarkerSizeMin(),'\n',
            "Max: ", Vis_2_2_MarkerSizeMax())
    })
  
  
    Vis_2_2_Scatter_Fit<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis2_ScatterY) ~ get(input$Vis2_ScatterX),data=Data_2_2_Complete())
      })
    
    Vis_2_2_Scatter_Fit_r2<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_2_2_Scatter_Fit())$r.squared
          return(round(PH,2))
      })
    Vis_2_2_Scatter_Fit_slope<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_2_2_Scatter_Fit())[[2]]
                                         return(round(PH,2))
    })
    Vis_2_2_Scatter_Fit_intercept<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_2_2_Scatter_Fit())[[1]]
                                         return(round(PH,2))
    })
    
    Vis_2_2_Scatter_Hover<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      paste("Linear Model Fit: \n" ,
             "Slope: ",Vis_2_2_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_2_2_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_2_2_Scatter_Fit_r2())
    })
      
    Vis_2_2_Scatter_Fit_Selected<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis2_ScatterY) ~ get(input$Vis2_ScatterX),data=if(input$AF_LinkedSelection=="No"){Sel_SurveysScatter_Vis_2_2_UL()} else {HighlightTrace_2Vis()})
      })
   
     Vis_2_2_Scatter_Fit_Selected_r2<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_2_2_Scatter_Fit_Selected())$r.squared
      return(round(PH,2))
      })
    Vis_2_2_Scatter_Fit_Selected_slope<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_2_2_Scatter_Fit_Selected())[[2]]
                                         return(round(PH,2))
    })
    Vis_2_2_Scatter_Fit_Selected_intercept<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_2_2_Scatter_Fit_Selected())[[1]]
                                         return(round(PH,2))
    })
    Vis_2_2_Scatter_Selected_Hover<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      paste("Fit: All Points \n" ,
            "Slope: ",Vis_2_2_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_2_2_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_2_2_Scatter_Fit_r2(),'\n',
            '\n',
            "Fit: Selected Points \n" ,
             "Slope: ",Vis_2_2_Scatter_Fit_Selected_slope(),'\n',
            "Intercept: ", Vis_2_2_Scatter_Fit_Selected_intercept(),'\n',
            "R-Squared: ", Vis_2_2_Scatter_Fit_Selected_r2())
    })
    
    Vis_2_2_Scatter_Factor_Count<-reactive({
      req(length(Data_2_2_Complete())>0)
      req(input$Vis2_Scatter_MarkerColor_Factors!='Nothing Selected')
      if(input$AF_SharedData=="Yes"){req(length(Shared_SelectedTBL())>0)}else{req(length(Vis_2_SelectedTBL())>0)}
      
      Vis_2_PalData<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_2_SelectedTBL()}
      
      PH<-Vis_2_PalData%>%
        droplevels()%>%
        select(input$Vis2_Scatter_MarkerColor_Factors)
      PH2<-n_distinct(PH[1])
      return(PH2)

    })
            

    Vis_2_2_Scatter_Factor_Palette<-reactive({
      req(length(Vis_2_2_Scatter_Factor_Count())>0)
      colorRampPalette(brewer.pal(Vis2_Scatter_Pal_N(),input$Vis2_Scatter_ColorPal_Factors))(Vis_2_2_Scatter_Factor_Count())
    })
      


  observeEvent(
    req(
      input$Vis2_Scatter_ColorPal_Factors,
      length(Vis_2_2_Scatter_Factor_Palette())>0,
      input$Vis2_Scatter_MarkerColor_Factors!='Nothing Selected',
      length(Data_2_2_Complete())>0
    ),{
      
      Vis_2_Data_TBL<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_2_SelectedTBL()}
      
      PH<-Vis_2_Data_TBL%>%
        select(input$Vis2_Scatter_MarkerColor_Factors)%>%
        droplevels()

      PH2<-distinct(PH)
      PH3<-bind_cols(PH2,data.frame(FactorColor=Vis_2_2_Scatter_Factor_Palette()))

      PH4<-Vis_2_Data_TBL%>%
        left_join(PH3,by=c(input$Vis2_Scatter_MarkerColor_Factors))

      Data_2_2_Complete(PH4)

    },ignoreInit=TRUE
    )
  
  HighlightTrace_Vis_2_2<-reactiveVal()
  
  observeEvent(
    c(HighlightTrace_2Vis()),{
      req(nrow(HighlightTrace_2Vis())>0)
      req(nrow(Data_2_2_Complete())>0)
      
      HT_2Vis_SelSurveys<-HighlightTrace_2Vis()%>%
        select("Survey_ID")

      PH<-left_join(HT_2Vis_SelSurveys,Data_2_2_Complete(),by=c("Survey_ID"="Survey_ID"))

      HighlightTrace_Vis_2_2(PH)

    },ignoreInit=TRUE
    )
    


   
      Vis_2_2_Scatter_UUYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_2_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                    y=~get(input$Vis2_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    showlegend=FALSE,
                    opacity=1
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_2_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_2_2_Scatter_UUYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
          plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
                )
              }
        )
      
     Vis_2_2_Scatter_UUNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                    y=~get(input$Vis2_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_2_2_Scatter_UUNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_2_2_Scatter_USYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_2_2_Marker_SizeRange(),
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_2_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
            data=Data_2_2_Complete(),
            x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_2_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
            data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_2_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
    
      Vis_2_2_Scatter_USYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
          plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_2_2_Marker_SizeRange(),
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_2_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_2_2_Scatter_USNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_2_2_Marker_SizeRange(),
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_2_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_2_2_Scatter_USNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_2_2_Marker_SizeRange(),
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
        
      
#### Factors ####      
      Vis_2_2_Scatter_FUYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_2_2()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_2_2()} else {Sel_SurveysScatter_Vis_2_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_2_2_Scatter_FUYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_2_2()))}else{req(is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
          plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_2_2_Scatter_FUNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_2_2()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_2_2()} else {Sel_SurveysScatter_Vis_2_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_2_2_Scatter_FUNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_2_2()))}else{req(is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
      


      Vis_2_2_Scatter_FSYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_2_2()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter",
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_2_2_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_2_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_2_2()} else {Sel_SurveysScatter_Vis_2_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
              data=Data_2_2_Complete(),
              x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_2_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
         add_trace(
           data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_2_2()} else {Sel_SurveysScatter_Vis_2_2_UL()},
           x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_2_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})

                     )
                     )
            )
                   }
        )

      Vis_2_2_Scatter_FSYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_2_2()))}else{req(is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
          plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter",
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_2_2_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),

                              hovertemplate=Vis_2_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                     )
            )
            )
                   }
        )

     Vis_2_2_Scatter_FSNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_2_2()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter",
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_2_2_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_2_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_2_2()} else {Sel_SurveysScatter_Vis_2_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_2_2_Scatter_FSNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_2_2()))}else{req(is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter",
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_2_2_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
#### Numeric ####      
      Vis_2_2_Scatter_CUYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_2_2_Scatter_CUYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
          plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_2_2_Scatter_CUNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity)%>%
            add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_2_2_Scatter_CUNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_2_2_Scatter_CSYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_2_2_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_2_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_2_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                     )
            )
                   }
        )
    
      Vis_2_2_Scatter_CSYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
          plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_2_2_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_2_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                             
                              hovertemplate=Vis_2_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_2_2_Scatter_CSNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_2Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_2_2_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_2_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()} else {Sel_SurveysScatter_Vis_2_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_2_2_Scatter_CSNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_2_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_2Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_2_2_UL()))}
        plot_ly(
                Data_2_2_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_2_2_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_2_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_2_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )    
      
       output$Vis_2_2_Scatter<-renderPlotly({
      if(Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_UUYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_UUYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_UUNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_UUNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_USYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_USYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_USNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_USNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_FUYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_FUYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_FUNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_FUNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_FSYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_FSYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_FSNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_FSNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_CUYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_CUYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_CUNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_CUNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_CSYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_CSYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_CSNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_2Vis()}else{Sel_SurveysScatter_Vis_2_2_UL()})){
      Vis_2_2_Scatter_CSNN()
      }
   })       
       
       
    ##### 3_2 Scatter #####
    
  Vis_3_2_MarkerSizeField<-eventReactive(input$Vis2_Scatter_MarkerScaleSize,{
    input$Vis2_Scatter_MarkerScaleSize
    })
    
  Vis_3_2_MarkerSizeMin<-eventReactive(c(
    req(length(Data_3_2_Complete())>0),
    input$Vis2_Scatter_MarkerScaleSize),{
    PH<-Data_3_2_Complete()%>%
      pull(input$Vis2_Scatter_MarkerScaleSize)
      return(min(PH,na.rm=TRUE))
      })
  
  Vis_3_2_MarkerSizeMax<-eventReactive(c(
    req(length(Data_3_2_Complete())>0),
    input$Vis2_Scatter_MarkerScaleSize),{
      PH<-Data_3_2_Complete()%>%
        pull(input$Vis2_Scatter_MarkerScaleSize)
        return(max(PH,na.rm=TRUE))
      })
  
  Vis_3_2_Marker_SizeRange<-eventReactive(input$Vis2_Scatter_MarkerSizeSlider,{
    input$Vis2_Scatter_MarkerSizeSlider*5
    })
  
 
    Vis_3_2_MarkerSizeScaleText<-eventReactive(c(
    req(length(Data_3_2_Complete())>0),
    input$Vis2_Scatter_MarkerScaleSize),{
     paste("Marker Size: \n" ,
             "Field: ",Vis_3_2_MarkerSizeField(),'\n',
            "Min: ", Vis_3_2_MarkerSizeMin(),'\n',
            "Max: ", Vis_3_2_MarkerSizeMax())
    })
  
  
    Vis_3_2_Scatter_Fit<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis2_ScatterY) ~ get(input$Vis2_ScatterX),data=Data_3_2_Complete())
      })
    
    Vis_3_2_Scatter_Fit_r2<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_3_2_Scatter_Fit())$r.squared
          return(round(PH,2))
      })
    Vis_3_2_Scatter_Fit_slope<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_3_2_Scatter_Fit())[[2]]
                                         return(round(PH,2))
    })
    Vis_3_2_Scatter_Fit_intercept<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_3_2_Scatter_Fit())[[1]]
                                         return(round(PH,2))
    })
    
    Vis_3_2_Scatter_Hover<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      paste("Linear Model Fit: \n" ,
             "Slope: ",Vis_3_2_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_3_2_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_3_2_Scatter_Fit_r2())
    })
      
    Vis_3_2_Scatter_Fit_Selected<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis2_ScatterY) ~ get(input$Vis2_ScatterX),data=if(input$AF_LinkedSelection=="No"){Sel_SurveysScatter_Vis_3_2_UL()} else {HighlightTrace_3Vis()})
      })
   
     Vis_3_2_Scatter_Fit_Selected_r2<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_3_2_Scatter_Fit_Selected())$r.squared
      return(round(PH,2))
      })
    Vis_3_2_Scatter_Fit_Selected_slope<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_3_2_Scatter_Fit_Selected())[[2]]
                                         return(round(PH,2))
    })
    Vis_3_2_Scatter_Fit_Selected_intercept<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_3_2_Scatter_Fit_Selected())[[1]]
                                         return(round(PH,2))
    })
    Vis_3_2_Scatter_Selected_Hover<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      paste("Fit: All Points \n" ,
            "Slope: ",Vis_3_2_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_3_2_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_3_2_Scatter_Fit_r2(),'\n',
            '\n',
            "Fit: Selected Points \n" ,
             "Slope: ",Vis_3_2_Scatter_Fit_Selected_slope(),'\n',
            "Intercept: ", Vis_3_2_Scatter_Fit_Selected_intercept(),'\n',
            "R-Squared: ", Vis_3_2_Scatter_Fit_Selected_r2())
    })
    
    Vis_3_2_Scatter_Factor_Count<-reactive({
      req(length(Data_3_2_Complete())>0)
      req(input$Vis2_Scatter_MarkerColor_Factors!='Nothing Selected')
      if(input$AF_SharedData=="Yes"){req(length(Shared_SelectedTBL())>0)}else{req(length(Vis_2_SelectedTBL())>0)}
      
      Vis_2_PalData<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_2_SelectedTBL()}
      
      PH<-Vis_2_PalData%>%
        droplevels()%>%
        select(input$Vis2_Scatter_MarkerColor_Factors)
      PH2<-n_distinct(PH[1])
      return(PH2)
    })
            

    Vis_3_2_Scatter_Factor_Palette<-reactive({
      req(length(Vis_3_2_Scatter_Factor_Count())>0)
      colorRampPalette(brewer.pal(Vis2_Scatter_Pal_N(),input$Vis2_Scatter_ColorPal_Factors))(Vis_3_2_Scatter_Factor_Count())
    })
      


  observeEvent(
    req(
      input$Vis2_Scatter_ColorPal_Factors,
      length(Vis_3_2_Scatter_Factor_Palette())>0,
      input$Vis2_Scatter_MarkerColor_Factors!='Nothing Selected',
      length(Data_3_2_Complete())>0
    ),{
      
      Vis_2_Data_TBL<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_2_SelectedTBL()}
      
      PH<-Vis_2_Data_TBL%>%
        select(input$Vis2_Scatter_MarkerColor_Factors)%>%
        droplevels()

      PH2<-distinct(PH)
      PH3<-bind_cols(PH2,data.frame(FactorColor=Vis_3_2_Scatter_Factor_Palette()))

      PH4<-Vis_2_Data_TBL%>%
        left_join(PH3,by=c(input$Vis2_Scatter_MarkerColor_Factors))

      Data_3_2_Complete(PH4)

    },ignoreInit=TRUE
    )
  
  HighlightTrace_Vis_3_2<-reactiveVal()
  
  observeEvent(
    c(HighlightTrace_3Vis()),{
      req(nrow(HighlightTrace_3Vis())>0)
      req(nrow(Data_3_2_Complete())>0)
      
      HT_3Vis_SelSurveys<-HighlightTrace_3Vis()%>%
        select("Survey_ID")

      PH<-left_join(HT_3Vis_SelSurveys,Data_3_2_Complete(),by=c("Survey_ID"="Survey_ID"))

      HighlightTrace_Vis_3_2(PH)

    },ignoreInit=TRUE
    )
    


   
      Vis_3_2_Scatter_UUYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_3_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                    y=~get(input$Vis2_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    showlegend=FALSE,
                    opacity=1
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_3_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_3_2_Scatter_UUYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
          plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
                )
              }
        )
      
     Vis_3_2_Scatter_UUNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                    y=~get(input$Vis2_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_3_2_Scatter_UUNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_3_2_Scatter_USYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_3_2_Marker_SizeRange(),
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_2_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
            data=Data_3_2_Complete(),
            x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_3_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
            data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_3_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
    
      Vis_3_2_Scatter_USYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
          plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_3_2_Marker_SizeRange(),
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_3_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_3_2_Scatter_USNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_3_2_Marker_SizeRange(),
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_2_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_3_2_Scatter_USNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_3_2_Marker_SizeRange(),
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
        
      
#### Factors ####      
      Vis_3_2_Scatter_FUYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_3_2()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_2()} else {Sel_SurveysScatter_Vis_3_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_3_2_Scatter_FUYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_3_2()))}else{req(is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
          plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_3_2_Scatter_FUNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_3_2()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_2()} else {Sel_SurveysScatter_Vis_3_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_3_2_Scatter_FUNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_3_2()))}else{req(is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
      


      Vis_3_2_Scatter_FSYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_3_2()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter",
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_3_2_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_2_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_2()} else {Sel_SurveysScatter_Vis_3_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
              data=Data_3_2_Complete(),
              x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_3_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
         add_trace(
           data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_2()} else {Sel_SurveysScatter_Vis_3_2_UL()},
           x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_3_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})

                     )
                     )
            )
                   }
        )

      Vis_3_2_Scatter_FSYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_3_2()))}else{req(is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
          plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter",
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_3_2_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),

                              hovertemplate=Vis_3_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                     )
            )
            )
                   }
        )

     Vis_3_2_Scatter_FSNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_3_2()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter",
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_3_2_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_2_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_2()} else {Sel_SurveysScatter_Vis_3_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_3_2_Scatter_FSNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_3_2()))}else{req(is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter",
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_3_2_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
#### Numeric ####      
      Vis_3_2_Scatter_CUYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_3_2_Scatter_CUYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
          plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_3_2_Scatter_CUNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity)%>%
            add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_3_2_Scatter_CUNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_3_2_Scatter_CSYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_3_2_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_2_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                     )
            )
                   }
        )
    
      Vis_3_2_Scatter_CSYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
          plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_3_2_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_3_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                             
                              hovertemplate=Vis_3_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_3_2_Scatter_CSNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_3_2_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_2_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_3_2_Scatter_CSNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_3_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_2_UL()))}
        plot_ly(
                Data_3_2_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_3_2_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_3_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_3_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )    
      
       output$Vis_3_2_Scatter<-renderPlotly({
      if(Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_UUYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_UUYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_UUNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_UUNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_USYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_USYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_USNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_USNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_FUYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_FUYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_FUNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_FUNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_FSYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_FSYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_FSNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_FSNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_CUYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_CUYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_CUNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_CUNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_CSYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_CSYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_CSNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_2_UL()})){
      Vis_3_2_Scatter_CSNN()
      }
   })       
       
    ##### 4_2 Scatter #####
    
  Vis_4_2_MarkerSizeField<-eventReactive(input$Vis2_Scatter_MarkerScaleSize,{
    input$Vis2_Scatter_MarkerScaleSize
    })
    
  Vis_4_2_MarkerSizeMin<-eventReactive(c(
    req(length(Data_4_2_Complete())>0),
    input$Vis2_Scatter_MarkerScaleSize),{
    PH<-Data_4_2_Complete()%>%
      pull(input$Vis2_Scatter_MarkerScaleSize)
      return(min(PH,na.rm=TRUE))
      })
  
  Vis_4_2_MarkerSizeMax<-eventReactive(c(
    req(length(Data_4_2_Complete())>0),
    input$Vis2_Scatter_MarkerScaleSize),{
      PH<-Data_4_2_Complete()%>%
        pull(input$Vis2_Scatter_MarkerScaleSize)
        return(max(PH,na.rm=TRUE))
      })
  
  Vis_4_2_Marker_SizeRange<-eventReactive(input$Vis2_Scatter_MarkerSizeSlider,{
    input$Vis2_Scatter_MarkerSizeSlider*5
    })
  
  

    Vis_4_2_MarkerSizeScaleText<-eventReactive(c(
    req(length(Data_4_2_Complete())>0),
    input$Vis2_Scatter_MarkerScaleSize),{
     paste("Marker Size: \n" ,
             "Field: ",Vis_4_2_MarkerSizeField(),'\n',
            "Min: ", Vis_4_2_MarkerSizeMin(),'\n',
            "Max: ", Vis_4_2_MarkerSizeMax())
    })
  
  
    Vis_4_2_Scatter_Fit<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis2_ScatterY) ~ get(input$Vis2_ScatterX),data=Data_4_2_Complete())
      })
    
    Vis_4_2_Scatter_Fit_r2<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_4_2_Scatter_Fit())$r.squared
          return(round(PH,2))
      })
    Vis_4_2_Scatter_Fit_slope<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_2_Scatter_Fit())[[2]]
                                         return(round(PH,2))
    })
    Vis_4_2_Scatter_Fit_intercept<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_2_Scatter_Fit())[[1]]
                                         return(round(PH,2))
    })
    
    Vis_4_2_Scatter_Hover<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      paste("Linear Model Fit: \n" ,
             "Slope: ",Vis_4_2_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_4_2_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_4_2_Scatter_Fit_r2())
    })
      
    Vis_4_2_Scatter_Fit_Selected<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis2_ScatterY) ~ get(input$Vis2_ScatterX),data=if(input$AF_LinkedSelection=="No"){Sel_SurveysScatter_Vis_4_2_UL()} else {HighlightTrace_4Vis()})
      })
   
     Vis_4_2_Scatter_Fit_Selected_r2<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_4_2_Scatter_Fit_Selected())$r.squared
      return(round(PH,2))
      })
    Vis_4_2_Scatter_Fit_Selected_slope<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_2_Scatter_Fit_Selected())[[2]]
                                         return(round(PH,2))
    })
    Vis_4_2_Scatter_Fit_Selected_intercept<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_2_Scatter_Fit_Selected())[[1]]
                                         return(round(PH,2))
    })
    Vis_4_2_Scatter_Selected_Hover<-reactive({
      req(input$SelectVis2=="Scatter Plot")
      req(input$Vis2_Scatter_TrendlineSwitch=="Yes")
      paste("Fit: All Points \n" ,
            "Slope: ",Vis_4_2_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_4_2_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_4_2_Scatter_Fit_r2(),'\n',
            '\n',
            "Fit: Selected Points \n" ,
             "Slope: ",Vis_4_2_Scatter_Fit_Selected_slope(),'\n',
            "Intercept: ", Vis_4_2_Scatter_Fit_Selected_intercept(),'\n',
            "R-Squared: ", Vis_4_2_Scatter_Fit_Selected_r2())
    })
    
    Vis_4_2_Scatter_Factor_Count<-reactive({
      req(length(Data_4_2_Complete())>0)
      req(input$Vis2_Scatter_MarkerColor_Factors!='Nothing Selected')
      if(input$AF_SharedData=="Yes"){req(length(Shared_SelectedTBL())>0)}else{req(length(Vis_2_SelectedTBL())>0)}
      
      Vis_2_PalData<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_2_SelectedTBL()}
      
      PH<-Vis_2_PalData%>%
        droplevels()%>%
        select(input$Vis2_Scatter_MarkerColor_Factors)
      PH2<-n_distinct(PH[1])
      return(PH2)
    })
            

    Vis_4_2_Scatter_Factor_Palette<-reactive({
      req(length(Vis_4_2_Scatter_Factor_Count())>0)
      colorRampPalette(brewer.pal(Vis2_Scatter_Pal_N(),input$Vis2_Scatter_ColorPal_Factors))(Vis_4_2_Scatter_Factor_Count())
    })
      


  observeEvent(
    req(
      input$Vis2_Scatter_ColorPal_Factors,
      length(Vis_4_2_Scatter_Factor_Palette())>0,
      input$Vis2_Scatter_MarkerColor_Factors!='Nothing Selected',
      length(Data_4_2_Complete())>0
    ),{
      
      Vis_2_Data_TBL<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_2_SelectedTBL()}
      
      PH<-Vis_2_Data_TBL%>%
        select(input$Vis2_Scatter_MarkerColor_Factors)%>%
        droplevels()

      PH2<-distinct(PH)
      PH3<-bind_cols(PH2,data.frame(FactorColor=Vis_4_2_Scatter_Factor_Palette()))

      PH4<-Vis_2_Data_TBL%>%
        left_join(PH3,by=c(input$Vis2_Scatter_MarkerColor_Factors))

      Data_4_2_Complete(PH4)

    },ignoreInit=TRUE
    )
  
  HighlightTrace_Vis_4_2<-reactiveVal()
  
  observeEvent(
    c(HighlightTrace_4Vis()),{
      req(nrow(HighlightTrace_4Vis())>0)
      req(nrow(Data_4_2_Complete())>0)
      
      HT_4Vis_SelSurveys<-HighlightTrace_4Vis()%>%
        select("Survey_ID")

      PH<-left_join(HT_4Vis_SelSurveys,Data_4_2_Complete(),by=c("Survey_ID"="Survey_ID"))

      HighlightTrace_Vis_4_2(PH)

    },ignoreInit=TRUE
    )
    


   
      Vis_4_2_Scatter_UUYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_4_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                    y=~get(input$Vis2_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    showlegend=FALSE,
                    opacity=1
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_4_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_4_2_Scatter_UUYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
          plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
                )
              }
        )
      
     Vis_4_2_Scatter_UUNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                    y=~get(input$Vis2_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_4_2_Scatter_UUNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(color=~Vis2_Scatter_Color(),
                             size=Vis2_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_4_2_Scatter_USYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_4_2_Marker_SizeRange(),
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_2_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
            data=Data_4_2_Complete(),
            x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
            data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
    
      Vis_4_2_Scatter_USYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
          plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_4_2_Marker_SizeRange(),
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_4_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_4_2_Scatter_USNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_4_2_Marker_SizeRange(),
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_2_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_2_UL()},
                    x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_4_2_Scatter_USNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_4_2_Marker_SizeRange(),
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis2_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
        
      
#### Factors ####      
      Vis_4_2_Scatter_FUYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_2()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_2()} else {Sel_SurveysScatter_Vis_4_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_4_2_Scatter_FUYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_2()))}else{req(is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
          plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_4_2_Scatter_FUNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_2()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_2()} else {Sel_SurveysScatter_Vis_4_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_4_2_Scatter_FUNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_2()))}else{req(is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
      


      Vis_4_2_Scatter_FSYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_2()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter",
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_4_2_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_2_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_2()} else {Sel_SurveysScatter_Vis_4_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
              data=Data_4_2_Complete(),
              x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
         add_trace(
           data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_2()} else {Sel_SurveysScatter_Vis_4_2_UL()},
           x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})

                     )
                     )
            )
                   }
        )

      Vis_4_2_Scatter_FSYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_2()))}else{req(is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
          plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter",
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_4_2_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),

                              hovertemplate=Vis_4_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                     )
            )
            )
                   }
        )

     Vis_4_2_Scatter_FSNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_2()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter",
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_4_2_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_2_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_2()} else {Sel_SurveysScatter_Vis_4_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_4_2_Scatter_FSNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_2()))}else{req(is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter",
                name=~get(input$Vis2_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_4_2_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis2_Scatter_HideLegend()),
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
#### Numeric ####      
      Vis_4_2_Scatter_CUYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_4_2_Scatter_CUYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
          plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_4_2_Scatter_CUNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity)%>%
            add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_4_2_Scatter_CUNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis2_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_4_2_Scatter_CSYY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_4_2_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_2_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_2_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_2_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_2_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                     )
            )
                   }
        )
    
      Vis_4_2_Scatter_CSYN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
          plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_4_2_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis2_ScatterX),
                              y=fitted(Vis_4_2_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis2_Scatter_TrendlineColor(),
                                        width=Vis2_Scatter_TrendlineWidth()),
                             
                              hovertemplate=Vis_4_2_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_4_2_Scatter_CSNY<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_4_2_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_2_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_2_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_2_UL()},
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_4_2_Scatter_CSNN<-reactive({
        req(input$SelectVis2=="Scatter Plot")
        req(length(Data_4_2_Complete())>0)
        req(Vis2_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis2_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis2_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_2_UL()))}
        plot_ly(
                Data_4_2_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis2_Scatter_MarkerScaleSize),
                sizes=~Vis_4_2_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_2_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis2_ScatterX),
                y=~get(input$Vis2_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis2_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis2_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis2_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis2_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis2_Scatter_PalToggle,
                  showscale=c(Vis2_Scatter_HideLegend()),
                  colorscale=Vis2_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis2_Scatter_Orientation,x=input$Vis2_Scatter_LegendX, y=input$Vis2_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis2_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis2_Scatter_HideLegend()=="TRUE"){Vis_4_2_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )    
      
       output$Vis_4_2_Scatter<-renderPlotly({
      if(Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_UUYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_UUYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_UUNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_UUNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_USYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_USYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_USNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Uniform"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_USNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_FUYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_FUYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_FUNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_FUNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_FSYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_FSYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_FSNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Factors"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_FSNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_CUYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_CUYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_CUNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_CUNN()
      } else if(Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_CSYY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_CSYN()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_CSNY()
      } else if (Vis2_Scatter_ColorGroupSwitch()=="Numeric"&&Vis2_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis2_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_2_UL()})){
      Vis_4_2_Scatter_CSNN()
      }
   })              
       
       
    ##### 3_3 Scatter #####
    
  Vis_3_3_MarkerSizeField<-eventReactive(input$Vis3_Scatter_MarkerScaleSize,{
    input$Vis3_Scatter_MarkerScaleSize
    })
    
  Vis_3_3_MarkerSizeMin<-eventReactive(c(
    req(length(Data_3_3_Complete())>0),
    input$Vis3_Scatter_MarkerScaleSize),{
    PH<-Data_3_3_Complete()%>%
      pull(input$Vis3_Scatter_MarkerScaleSize)
      return(min(PH,na.rm=TRUE))
      })
  
  Vis_3_3_MarkerSizeMax<-eventReactive(c(
    req(length(Data_3_3_Complete())>0),
    input$Vis3_Scatter_MarkerScaleSize),{
      PH<-Data_3_3_Complete()%>%
        pull(input$Vis3_Scatter_MarkerScaleSize)
        return(max(PH,na.rm=TRUE))
      })
  
  Vis_3_3_Marker_SizeRange<-eventReactive(input$Vis3_Scatter_MarkerSizeSlider,{
    input$Vis3_Scatter_MarkerSizeSlider*5
    })
  
 
    Vis_3_3_MarkerSizeScaleText<-eventReactive(c(
    req(length(Data_3_3_Complete())>0),
    input$Vis3_Scatter_MarkerScaleSize),{
     paste("Marker Size: \n" ,
             "Field: ",Vis_3_3_MarkerSizeField(),'\n',
            "Min: ", Vis_3_3_MarkerSizeMin(),'\n',
            "Max: ", Vis_3_3_MarkerSizeMax())
    })
  
  
    Vis_3_3_Scatter_Fit<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis3_ScatterY) ~ get(input$Vis3_ScatterX),data=Data_3_3_Complete())
      })
    
    Vis_3_3_Scatter_Fit_r2<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_3_3_Scatter_Fit())$r.squared
          return(round(PH,2))
      })
    Vis_3_3_Scatter_Fit_slope<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_3_3_Scatter_Fit())[[2]]
                                         return(round(PH,2))
    })
    Vis_3_3_Scatter_Fit_intercept<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_3_3_Scatter_Fit())[[1]]
                                         return(round(PH,2))
    })
    
    Vis_3_3_Scatter_Hover<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      paste("Linear Model Fit: \n" ,
             "Slope: ",Vis_3_3_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_3_3_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_3_3_Scatter_Fit_r2())
    })
      
    Vis_3_3_Scatter_Fit_Selected<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis3_ScatterY) ~ get(input$Vis3_ScatterX),data=if(input$AF_LinkedSelection=="No"){Sel_SurveysScatter_Vis_3_3_UL()} else {HighlightTrace_3Vis()})
      })
   
     Vis_3_3_Scatter_Fit_Selected_r2<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_3_3_Scatter_Fit_Selected())$r.squared
      return(round(PH,2))
      })
    Vis_3_3_Scatter_Fit_Selected_slope<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_3_3_Scatter_Fit_Selected())[[2]]
                                         return(round(PH,2))
    })
    Vis_3_3_Scatter_Fit_Selected_intercept<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_3_3_Scatter_Fit_Selected())[[1]]
                                         return(round(PH,2))
    })
    Vis_3_3_Scatter_Selected_Hover<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      paste("Fit: All Points \n" ,
            "Slope: ",Vis_3_3_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_3_3_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_3_3_Scatter_Fit_r2(),'\n',
            '\n',
            "Fit: Selected Points \n" ,
             "Slope: ",Vis_3_3_Scatter_Fit_Selected_slope(),'\n',
            "Intercept: ", Vis_3_3_Scatter_Fit_Selected_intercept(),'\n',
            "R-Squared: ", Vis_3_3_Scatter_Fit_Selected_r2())
    })
    
    Vis_3_3_Scatter_Factor_Count<-reactive({
      req(length(Data_3_3_Complete())>0)
      req(input$Vis3_Scatter_MarkerColor_Factors!='Nothing Selected')
      if(input$AF_SharedData=="Yes"){req(length(Shared_SelectedTBL())>0)}else{req(length(Vis_3_SelectedTBL())>0)}
      
      Vis_3_PalData<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_3_SelectedTBL()}
      
      PH<-Vis_3_PalData%>%
        droplevels()%>%
        select(input$Vis3_Scatter_MarkerColor_Factors)
      PH2<-n_distinct(PH[1])
      return(PH2)
    })
            

    Vis_3_3_Scatter_Factor_Palette<-reactive({
      req(length(Vis_3_3_Scatter_Factor_Count())>0)
      colorRampPalette(brewer.pal(Vis3_Scatter_Pal_N(),input$Vis3_Scatter_ColorPal_Factors))(Vis_3_3_Scatter_Factor_Count())
    })
      


  observeEvent(
    req(
      input$Vis3_Scatter_ColorPal_Factors,
      length(Vis_3_3_Scatter_Factor_Palette())>0,
      input$Vis3_Scatter_MarkerColor_Factors!='Nothing Selected',
      length(Data_3_3_Complete())>0
    ),{
      
      Vis_3_Data_TBL<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_3_SelectedTBL()}
      
      PH<-Vis_3_Data_TBL%>%
        select(input$Vis3_Scatter_MarkerColor_Factors)%>%
        droplevels()

      PH2<-distinct(PH)
      PH3<-bind_cols(PH2,data.frame(FactorColor=Vis_3_3_Scatter_Factor_Palette()))

      PH4<-Vis_3_Data_TBL%>%
        left_join(PH3,by=c(input$Vis3_Scatter_MarkerColor_Factors))

      Data_3_3_Complete(PH4)

    },ignoreInit=TRUE
    )
  
  HighlightTrace_Vis_3_3<-reactiveVal()
  
  observeEvent(
    c(HighlightTrace_3Vis()),{
      req(nrow(HighlightTrace_3Vis())>0)
      req(nrow(Data_3_3_Complete())>0)
      
      HT_3Vis_SelSurveys<-HighlightTrace_3Vis()%>%
        select("Survey_ID")

      PH<-left_join(HT_3Vis_SelSurveys,Data_3_3_Complete(),by=c("Survey_ID"="Survey_ID"))

      HighlightTrace_Vis_3_3(PH)

    },ignoreInit=TRUE
    )
    


   
      Vis_3_3_Scatter_UUYY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(color=~Vis3_Scatter_Color(),
                             size=Vis3_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_3_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_3_3_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_3_ScatterOpacity)%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_3_UL()},
                    x=~get(input$Vis3_ScatterX),
                    y=~get(input$Vis3_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis3_Scatter_Color(),
                             size=Vis3_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    showlegend=FALSE,
                    opacity=1
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_3_3_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_3_3_Scatter_UUYN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
          plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(color=~Vis3_Scatter_Color(),
                             size=Vis3_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
                )
              }
        )
      
     Vis_3_3_Scatter_UUNY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(color=~Vis3_Scatter_Color(),
                             size=Vis3_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_3_ScatterOpacity
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_3_UL()},
                    x=~get(input$Vis3_ScatterX),
                    y=~get(input$Vis3_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis3_Scatter_Color(),
                             size=Vis3_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_3_3_Scatter_UUNN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(color=~Vis3_Scatter_Color(),
                             size=Vis3_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_3_3_Scatter_USYY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_3_3_Marker_SizeRange(),
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis3_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_3_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_3_UL()},
                    x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis3_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
            data=Data_3_3_Complete(),
            x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_3_3_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_3_ScatterOpacity)%>%
          add_trace(
            data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_3_UL()},
                    x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_3_3_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
    
      Vis_3_3_Scatter_USYN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
          plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_3_3_Marker_SizeRange(),
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis3_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_3_3_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_3_3_Scatter_USNY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_3_3_Marker_SizeRange(),
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis3_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_3_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_3_UL()},
                    x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis3_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_3_3_Scatter_USNN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_3_3_Marker_SizeRange(),
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis3_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
        
      
#### Factors ####      
      Vis_3_3_Scatter_FUYY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_3_3()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_3_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_3_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_3_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_3()} else {Sel_SurveysScatter_Vis_3_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1)%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_3_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_3_3_Scatter_FUYN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_3_3()))}else{req(is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
          plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_3_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_3_3_Scatter_FUNY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_3_3()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_3_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_3()} else {Sel_SurveysScatter_Vis_3_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_3_3_Scatter_FUNN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_3_3()))}else{req(is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
      


      Vis_3_3_Scatter_FSYY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_3_3()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter",
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_3_3_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_3_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_3()} else {Sel_SurveysScatter_Vis_3_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
              data=Data_3_3_Complete(),
              x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_3_3_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_3_ScatterOpacity)%>%
         add_trace(
           data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_3()} else {Sel_SurveysScatter_Vis_3_3_UL()},
           x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_3_3_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})

                     )
                     )
            )
                   }
        )

      Vis_3_3_Scatter_FSYN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_3_3()))}else{req(is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
          plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter",
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_3_3_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),

                              hovertemplate=Vis_3_3_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                     )
            )
            )
                   }
        )

     Vis_3_3_Scatter_FSNY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_3_3()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter",
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_3_3_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_3_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_3_3()} else {Sel_SurveysScatter_Vis_3_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_3_3_Scatter_FSNN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_3_3()))}else{req(is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter",
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_3_3_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
#### Numeric ####      
      Vis_3_3_Scatter_CUYY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_3_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_3_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_3_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_3_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_3_3_Scatter_CUYN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
          plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_3_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_3_3_Scatter_CUNY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_3_ScatterOpacity)%>%
            add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_3_3_Scatter_CUNN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_3_3_Scatter_CSYY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_3_3_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_3_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_3_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_3_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_3_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_3_3_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                     )
            )
                   }
        )
    
      Vis_3_3_Scatter_CSYN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
          plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_3_3_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_3_3_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                             
                              hovertemplate=Vis_3_3_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_3_3_Scatter_CSNY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_3Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_3_3_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_3_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_3_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()} else {Sel_SurveysScatter_Vis_3_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_3_3_Scatter_CSNN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_3_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_3Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_3_3_UL()))}
        plot_ly(
                Data_3_3_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_3_3_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_3_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_3_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )    
      
       output$Vis_3_3_Scatter<-renderPlotly({
      if(Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_UUYY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_UUYN()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_UUNY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_UUNN()
      } else if(Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_USYY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_USYN()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_USNY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_USNN()
      } else if(Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_FUYY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_FUYN()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_FUNY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_FUNN()
      } else if(Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_FSYY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_FSYN()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_FSNY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_FSNN()
      } else if(Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_CUYY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_CUYN()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_CUNY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_CUNN()
      } else if(Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_CSYY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_CSYN()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_CSNY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_3Vis()}else{Sel_SurveysScatter_Vis_3_3_UL()})){
      Vis_3_3_Scatter_CSNN()
      }
   })              
       
       
    ##### 4_3 Scatter #####
    
  Vis_4_3_MarkerSizeField<-eventReactive(input$Vis3_Scatter_MarkerScaleSize,{
    input$Vis3_Scatter_MarkerScaleSize
    })
    
  Vis_4_3_MarkerSizeMin<-eventReactive(c(
    req(length(Data_4_3_Complete())>0),
    input$Vis3_Scatter_MarkerScaleSize),{
    PH<-Data_4_3_Complete()%>%
      pull(input$Vis3_Scatter_MarkerScaleSize)
      return(min(PH,na.rm=TRUE))
      })
  
  Vis_4_3_MarkerSizeMax<-eventReactive(c(
    req(length(Data_4_3_Complete())>0),
    input$Vis3_Scatter_MarkerScaleSize),{
      PH<-Data_4_3_Complete()%>%
        pull(input$Vis3_Scatter_MarkerScaleSize)
        return(max(PH,na.rm=TRUE))
      })
  
  Vis_4_3_Marker_SizeRange<-eventReactive(input$Vis3_Scatter_MarkerSizeSlider,{
    input$Vis3_Scatter_MarkerSizeSlider*5
    })
  
 
    Vis_4_3_MarkerSizeScaleText<-eventReactive(c(
    req(length(Data_4_3_Complete())>0),
    input$Vis3_Scatter_MarkerScaleSize),{
     paste("Marker Size: \n" ,
             "Field: ",Vis_4_3_MarkerSizeField(),'\n',
            "Min: ", Vis_4_3_MarkerSizeMin(),'\n',
            "Max: ", Vis_4_3_MarkerSizeMax())
    })
  
  
    Vis_4_3_Scatter_Fit<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis3_ScatterY) ~ get(input$Vis3_ScatterX),data=Data_4_3_Complete())
      })
    
    Vis_4_3_Scatter_Fit_r2<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_4_3_Scatter_Fit())$r.squared
          return(round(PH,2))
      })
    Vis_4_3_Scatter_Fit_slope<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_3_Scatter_Fit())[[2]]
                                         return(round(PH,2))
    })
    Vis_4_3_Scatter_Fit_intercept<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_3_Scatter_Fit())[[1]]
                                         return(round(PH,2))
    })
    
    Vis_4_3_Scatter_Hover<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      paste("Linear Model Fit: \n" ,
             "Slope: ",Vis_4_3_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_4_3_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_4_3_Scatter_Fit_r2())
    })
      
    Vis_4_3_Scatter_Fit_Selected<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis3_ScatterY) ~ get(input$Vis3_ScatterX),data=if(input$AF_LinkedSelection=="No"){Sel_SurveysScatter_Vis_4_3_UL()} else {HighlightTrace_4Vis()})
      })
   
     Vis_4_3_Scatter_Fit_Selected_r2<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_4_3_Scatter_Fit_Selected())$r.squared
      return(round(PH,2))
      })
    Vis_4_3_Scatter_Fit_Selected_slope<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_3_Scatter_Fit_Selected())[[2]]
                                         return(round(PH,2))
    })
    Vis_4_3_Scatter_Fit_Selected_intercept<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_3_Scatter_Fit_Selected())[[1]]
                                         return(round(PH,2))
    })
    Vis_4_3_Scatter_Selected_Hover<-reactive({
      req(input$SelectVis3=="Scatter Plot")
      req(input$Vis3_Scatter_TrendlineSwitch=="Yes")
      paste("Fit: All Points \n" ,
            "Slope: ",Vis_4_3_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_4_3_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_4_3_Scatter_Fit_r2(),'\n',
            '\n',
            "Fit: Selected Points \n" ,
             "Slope: ",Vis_4_3_Scatter_Fit_Selected_slope(),'\n',
            "Intercept: ", Vis_4_3_Scatter_Fit_Selected_intercept(),'\n',
            "R-Squared: ", Vis_4_3_Scatter_Fit_Selected_r2())
    })
    
    Vis_4_3_Scatter_Factor_Count<-reactive({
      req(length(Data_4_3_Complete())>0)
      req(input$Vis3_Scatter_MarkerColor_Factors!='Nothing Selected')
      if(input$AF_SharedData=="Yes"){req(length(Shared_SelectedTBL())>0)}else{req(length(Vis_3_SelectedTBL())>0)}
      
      Vis_3_PalData<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_3_SelectedTBL()}
      
      PH<-Vis_3_PalData%>%
        droplevels()%>%
        select(input$Vis3_Scatter_MarkerColor_Factors)
      PH2<-n_distinct(PH[1])
      return(PH2)
    })
            

    Vis_4_3_Scatter_Factor_Palette<-reactive({
      req(length(Vis_4_3_Scatter_Factor_Count())>0)
      colorRampPalette(brewer.pal(Vis3_Scatter_Pal_N(),input$Vis3_Scatter_ColorPal_Factors))(Vis_4_3_Scatter_Factor_Count())
    })
      


  observeEvent(
    req(
      input$Vis3_Scatter_ColorPal_Factors,
      length(Vis_4_3_Scatter_Factor_Palette())>0,
      input$Vis3_Scatter_MarkerColor_Factors!='Nothing Selected',
      length(Data_4_3_Complete())>0
    ),{
      
      Vis_3_Data_TBL<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_3_SelectedTBL()}
      
      PH<-Vis_3_Data_TBL%>%
        select(input$Vis3_Scatter_MarkerColor_Factors)%>%
        droplevels()

      PH2<-distinct(PH)
      PH3<-bind_cols(PH2,data.frame(FactorColor=Vis_4_3_Scatter_Factor_Palette()))

      PH4<-Vis_3_Data_TBL%>%
        left_join(PH3,by=c(input$Vis3_Scatter_MarkerColor_Factors))

      Data_4_3_Complete(PH4)

    },ignoreInit=TRUE
    )
  
  HighlightTrace_Vis_4_3<-reactiveVal()
  
  
  
  observeEvent(c(
    HighlightTrace_4Vis()),{
      req(nrow(HighlightTrace_4Vis())>0)
      req(nrow(Data_4_3_Complete())>0)
      
      HT_4Vis_SelSurveys<-HighlightTrace_4Vis()%>%
        select("Survey_ID")

      PH<-left_join(HT_4Vis_SelSurveys,Data_4_3_Complete(),by=c("Survey_ID"="Survey_ID"))

      HighlightTrace_Vis_4_3(PH)

    },ignoreInit=TRUE
    )
    


   
      Vis_4_3_Scatter_UUYY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(color=~Vis3_Scatter_Color(),
                             size=Vis3_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_3_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_4_3_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_3_ScatterOpacity)%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_3_UL()},
                    x=~get(input$Vis3_ScatterX),
                    y=~get(input$Vis3_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis3_Scatter_Color(),
                             size=Vis3_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    showlegend=FALSE,
                    opacity=1
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_4_3_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_4_3_Scatter_UUYN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
          plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(color=~Vis3_Scatter_Color(),
                             size=Vis3_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
                )
              }
        )
      
     Vis_4_3_Scatter_UUNY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(color=~Vis3_Scatter_Color(),
                             size=Vis3_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_3_ScatterOpacity
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_3_UL()},
                    x=~get(input$Vis3_ScatterX),
                    y=~get(input$Vis3_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis3_Scatter_Color(),
                             size=Vis3_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_4_3_Scatter_UUNN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(color=~Vis3_Scatter_Color(),
                             size=Vis3_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_4_3_Scatter_USYY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_4_3_Marker_SizeRange(),
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis3_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_3_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_3_UL()},
                    x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis3_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
            data=Data_4_3_Complete(),
            x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_3_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_3_ScatterOpacity)%>%
          add_trace(
            data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_3_UL()},
                    x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_3_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
    
      Vis_4_3_Scatter_USYN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
          plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_4_3_Marker_SizeRange(),
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis3_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_4_3_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_4_3_Scatter_USNY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_4_3_Marker_SizeRange(),
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis3_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_3_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_3_UL()},
                    x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis3_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_4_3_Scatter_USNN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_4_3_Marker_SizeRange(),
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis3_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
        
      
#### Factors ####      
      Vis_4_3_Scatter_FUYY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_3()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_3_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_3_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_3_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_3()} else {Sel_SurveysScatter_Vis_4_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1)%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_3_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_4_3_Scatter_FUYN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_3()))}else{req(is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
          plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_3_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_4_3_Scatter_FUNY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_3()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_3_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_3()} else {Sel_SurveysScatter_Vis_4_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_4_3_Scatter_FUNN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_3()))}else{req(is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
      


      Vis_4_3_Scatter_FSYY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_3()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter",
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_4_3_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_3_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_3()} else {Sel_SurveysScatter_Vis_4_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
              data=Data_4_3_Complete(),
              x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_3_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_3_ScatterOpacity)%>%
         add_trace(
           data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_3()} else {Sel_SurveysScatter_Vis_4_3_UL()},
           x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_3_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})

                     )
                     )
            )
                   }
        )

      Vis_4_3_Scatter_FSYN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_3()))}else{req(is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
          plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter",
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_4_3_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),

                              hovertemplate=Vis_4_3_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                     )
            )
            )
                   }
        )

     Vis_4_3_Scatter_FSNY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_3()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter",
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_4_3_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_3_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_3()} else {Sel_SurveysScatter_Vis_4_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_4_3_Scatter_FSNN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_3()))}else{req(is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter",
                name=~get(input$Vis3_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_4_3_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis3_Scatter_HideLegend()),
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
#### Numeric ####      
      Vis_4_3_Scatter_CUYY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_3_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_3_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_3_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_3_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_4_3_Scatter_CUYN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
          plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_3_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_4_3_Scatter_CUNY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_3_ScatterOpacity)%>%
            add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_4_3_Scatter_CUNN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis3_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_4_3_Scatter_CSYY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_4_3_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_3_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_3_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_3_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_3_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_3_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                     )
            )
                   }
        )
    
      Vis_4_3_Scatter_CSYN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
          plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_4_3_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis3_ScatterX),
                              y=fitted(Vis_4_3_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis3_Scatter_TrendlineColor(),
                                        width=Vis3_Scatter_TrendlineWidth()),
                             
                              hovertemplate=Vis_4_3_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_4_3_Scatter_CSNY<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_4_3_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_3_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_3_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_3_UL()},
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_4_3_Scatter_CSNN<-reactive({
        req(input$SelectVis3=="Scatter Plot")
        req(length(Data_4_3_Complete())>0)
        req(Vis3_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis3_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis3_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_3_UL()))}
        plot_ly(
                Data_4_3_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis3_Scatter_MarkerScaleSize),
                sizes=~Vis_4_3_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_3_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis3_ScatterX),
                y=~get(input$Vis3_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis3_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis3_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis3_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis3_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis3_Scatter_PalToggle,
                  showscale=c(Vis3_Scatter_HideLegend()),
                  colorscale=Vis3_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis3_Scatter_Orientation,x=input$Vis3_Scatter_LegendX, y=input$Vis3_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis3_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis3_Scatter_HideLegend()=="TRUE"){Vis_4_3_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )    
      
       output$Vis_4_3_Scatter<-renderPlotly({
      if(Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_UUYY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_UUYN()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_UUNY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_UUNN()
      } else if(Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_USYY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_USYN()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_USNY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Uniform"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_USNN()
      } else if(Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_FUYY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_FUYN()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_FUNY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_FUNN()
      } else if(Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_FSYY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_FSYN()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_FSNY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Factors"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_FSNN()
      } else if(Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_CUYY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_CUYN()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_CUNY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis3_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_CUNN()
      } else if(Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_CSYY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_CSYN()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_CSNY()
      } else if (Vis3_Scatter_ColorGroupSwitch()=="Numeric"&&Vis3_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis3_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_3_UL()})){
      Vis_4_3_Scatter_CSNN()
      }
   })        
       
       
    ##### 4_4 Scatter #####
    
  Vis_4_4_MarkerSizeField<-eventReactive(input$Vis4_Scatter_MarkerScaleSize,{
    input$Vis4_Scatter_MarkerScaleSize
    })
    
  Vis_4_4_MarkerSizeMin<-eventReactive(c(
    req(length(Data_4_4_Complete())>0),
    input$Vis4_Scatter_MarkerScaleSize),{
    PH<-Data_4_4_Complete()%>%
      pull(input$Vis4_Scatter_MarkerScaleSize)
      return(min(PH,na.rm=TRUE))
      })
  
  Vis_4_4_MarkerSizeMax<-eventReactive(c(
    req(length(Data_4_4_Complete())>0),
    input$Vis4_Scatter_MarkerScaleSize),{
      PH<-Data_4_4_Complete()%>%
        pull(input$Vis4_Scatter_MarkerScaleSize)
        return(max(PH,na.rm=TRUE))
      })
  
  Vis_4_4_Marker_SizeRange<-eventReactive(input$Vis4_Scatter_MarkerSizeSlider,{
    input$Vis4_Scatter_MarkerSizeSlider*5
    })
  
 Vis_4_4_MarkerSizeScaleText<-eventReactive(c(
    req(length(Data_4_4_Complete())>0),
    input$Vis4_Scatter_MarkerScaleSize),{
     paste("Marker Size: \n" ,
             "Field: ",Vis_4_4_MarkerSizeField(),'\n',
            "Min: ", Vis_4_4_MarkerSizeMin(),'\n',
            "Max: ", Vis_4_4_MarkerSizeMax())
    })
  
  
    Vis_4_4_Scatter_Fit<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      req(input$Vis4_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis4_ScatterY) ~ get(input$Vis4_ScatterX),data=Data_4_4_Complete())
      })
    
    Vis_4_4_Scatter_Fit_r2<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      req(input$Vis4_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_4_4_Scatter_Fit())$r.squared
          return(round(PH,2))
      })
    Vis_4_4_Scatter_Fit_slope<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      req(input$Vis4_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_4_Scatter_Fit())[[2]]
                                         return(round(PH,2))
    })
    Vis_4_4_Scatter_Fit_intercept<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      req(input$Vis4_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_4_Scatter_Fit())[[1]]
                                         return(round(PH,2))
    })
    
    Vis_4_4_Scatter_Hover<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      req(input$Vis4_Scatter_TrendlineSwitch=="Yes")
      paste("Linear Model Fit: \n" ,
             "Slope: ",Vis_4_4_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_4_4_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_4_4_Scatter_Fit_r2())
    })
      
    Vis_4_4_Scatter_Fit_Selected<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      req(input$Vis4_Scatter_TrendlineSwitch=="Yes")
      lm(get(input$Vis4_ScatterY) ~ get(input$Vis4_ScatterX),data=if(input$AF_LinkedSelection=="No"){Sel_SurveysScatter_Vis_4_4_UL()} else {HighlightTrace_4Vis()})
      })
   
     Vis_4_4_Scatter_Fit_Selected_r2<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      req(input$Vis4_Scatter_TrendlineSwitch=="Yes")
      PH<-summary(Vis_4_4_Scatter_Fit_Selected())$r.squared
      return(round(PH,2))
      })
    Vis_4_4_Scatter_Fit_Selected_slope<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      req(input$Vis4_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_4_Scatter_Fit_Selected())[[2]]
                                         return(round(PH,2))
    })
    Vis_4_4_Scatter_Fit_Selected_intercept<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      req(input$Vis4_Scatter_TrendlineSwitch=="Yes")
      PH<-coef(Vis_4_4_Scatter_Fit_Selected())[[1]]
                                         return(round(PH,2))
    })
    Vis_4_4_Scatter_Selected_Hover<-reactive({
      req(input$SelectVis4=="Scatter Plot")
      req(input$Vis4_Scatter_TrendlineSwitch=="Yes")
      paste("Fit: All Points \n" ,
            "Slope: ",Vis_4_4_Scatter_Fit_slope(),'\n',
            "Intercept: ", Vis_4_4_Scatter_Fit_intercept(),'\n',
            "R-Squared: ", Vis_4_4_Scatter_Fit_r2(),'\n',
            '\n',
            "Fit: Selected Points \n" ,
             "Slope: ",Vis_4_4_Scatter_Fit_Selected_slope(),'\n',
            "Intercept: ", Vis_4_4_Scatter_Fit_Selected_intercept(),'\n',
            "R-Squared: ", Vis_4_4_Scatter_Fit_Selected_r2())
    })
    
    Vis_4_4_Scatter_Factor_Count<-reactive({
      req(length(Data_4_4_Complete())>0)
      req(input$Vis4_Scatter_MarkerColor_Factors!='Nothing Selected')
      if(input$AF_SharedData=="Yes"){req(length(Shared_SelectedTBL())>0)}else{req(length(Vis_4_SelectedTBL())>0)}
      
      Vis_4_PalData<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_4_SelectedTBL()}
      
      PH<-Vis_4_PalData%>%
        droplevels()%>%
        select(input$Vis4_Scatter_MarkerColor_Factors)
      PH2<-n_distinct(PH[1])
      return(PH2)
    })
            

    Vis_4_4_Scatter_Factor_Palette<-reactive({
      req(length(Vis_4_4_Scatter_Factor_Count())>0)
      colorRampPalette(brewer.pal(Vis4_Scatter_Pal_N(),input$Vis4_Scatter_ColorPal_Factors))(Vis_4_4_Scatter_Factor_Count())
    })
      


  observeEvent(
    req(
      input$Vis4_Scatter_ColorPal_Factors,
      length(Vis_4_4_Scatter_Factor_Palette())>0,
      input$Vis4_Scatter_MarkerColor_Factors!='Nothing Selected',
      length(Data_4_4_Complete())>0
    ),{
      
      Vis_4_Data_TBL<-if(input$AF_SharedData=="Yes"){Shared_SelectedTBL()}else{Vis_4_SelectedTBL()}
      
      PH<-Vis_4_Data_TBL%>%
        select(input$Vis4_Scatter_MarkerColor_Factors)%>%
        droplevels()

      PH2<-distinct(PH)
      PH3<-bind_cols(PH2,data.frame(FactorColor=Vis_4_4_Scatter_Factor_Palette()))

      PH4<-Vis_4_Data_TBL%>%
        left_join(PH3,by=c(input$Vis4_Scatter_MarkerColor_Factors))

      Data_4_4_Complete(PH4)

    },ignoreInit=TRUE
    )
  
  HighlightTrace_Vis_4_4<-reactiveVal()
  
    observeEvent(
    c(HighlightTrace_4Vis()),{
      req(nrow(HighlightTrace_4Vis())>0)
      req(nrow(Data_4_4_Complete())>0)
      
      HT_4Vis_SelSurveys<-HighlightTrace_4Vis()%>%
        select("Survey_ID")

      PH<-left_join(HT_4Vis_SelSurveys,Data_4_4_Complete(),by=c("Survey_ID"="Survey_ID"))

      HighlightTrace_Vis_4_4(PH)

    },ignoreInit=TRUE
    )
    


   
      Vis_4_4_Scatter_UUYY<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis4_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(color=~Vis4_Scatter_Color(),
                             size=Vis4_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_4_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_4_4_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_4_ScatterOpacity)%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_4_UL()},
                    x=~get(input$Vis4_ScatterX),
                    y=~get(input$Vis4_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis4_Scatter_Color(),
                             size=Vis4_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    showlegend=FALSE,
                    opacity=1
            )%>%
          add_trace(x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_4_4_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_4_4_Scatter_UUYN<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis4_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
          plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(color=~Vis4_Scatter_Color(),
                             size=Vis4_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                  list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
                )
              }
        )
      
     Vis_4_4_Scatter_UUNY<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis4_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(color=~Vis4_Scatter_Color(),
                             size=Vis4_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=input$Vis_4_ScatterOpacity
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_4_UL()},
                    x=~get(input$Vis4_ScatterX),
                    y=~get(input$Vis4_ScatterY),
                    mode='markers',
                    marker=list(color=~Vis4_Scatter_Color(),
                             size=Vis4_Scatter_MarkerSize()
                             ),
                    text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_4_4_Scatter_UUNN<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis4_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(color=~Vis4_Scatter_Color(),
                             size=Vis4_Scatter_MarkerSize()
                             ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE,
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_4_4_Scatter_USYY<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis4_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis4_Scatter_MarkerScaleSize),
                sizes=~Vis_4_4_Marker_SizeRange(),
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis4_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_4_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_4_UL()},
                    x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis4_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
            data=Data_4_4_Complete(),
            x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_4_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_4_ScatterOpacity)%>%
          add_trace(
            data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_4_UL()},
                    x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_4_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
    
      Vis_4_4_Scatter_USYN<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis4_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
          plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis4_Scatter_MarkerScaleSize),
                sizes=~Vis_4_4_Marker_SizeRange(),
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis4_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()),
                              hovertemplate=Vis_4_4_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_4_4_Scatter_USNY<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis4_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis4_Scatter_MarkerScaleSize),
                sizes=~Vis_4_4_Marker_SizeRange(),
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis4_Scatter_Color(),
                            line=list(width=0),
                            opacity=input$Vis_4_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
          add_trace(
                    data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_4_UL()},
                    x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis4_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_4_4_Scatter_USNN<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Uniform")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis4_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                size=~get(input$Vis4_Scatter_MarkerScaleSize),
                sizes=~Vis_4_4_Marker_SizeRange(),
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                            color=~Vis4_Scatter_Color(),
                            line=list(width=0),
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                showlegend=FALSE
            )%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
        
      
#### Factors ####      
      Vis_4_4_Scatter_FUYY<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis4_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_4()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis4_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis4_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_4_ScatterOpacity
            )%>%
          add_trace(x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_4_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_4_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_4()} else {Sel_SurveysScatter_Vis_4_4_UL()},
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis4_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis4_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1)%>%
          add_trace(x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_4_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_4_4_Scatter_FUYN<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis4_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_4()))}else{req(is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
          plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis4_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis4_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_4_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_4_4_Scatter_FUNY<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis4_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_4()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis4_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis4_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_4_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_4()} else {Sel_SurveysScatter_Vis_4_4_UL()},
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis4_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis4_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                    opacity=1
            )%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_4_4_Scatter_FUNN<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis4_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_4()))}else{req(is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                color=~I(FactorColor),
                name=~get(input$Vis4_Scatter_MarkerColor_Factors),
                marker=list(
                    size=~Vis4_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
      


      Vis_4_4_Scatter_FSYY<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis4_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_4()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter",
                name=~get(input$Vis4_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis4_Scatter_MarkerScaleSize),
                sizes=~Vis_4_4_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_4_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_4()} else {Sel_SurveysScatter_Vis_4_4_UL()},
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
              data=Data_4_4_Complete(),
              x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_4_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_4_ScatterOpacity)%>%
         add_trace(
           data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_4()} else {Sel_SurveysScatter_Vis_4_4_UL()},
           x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()
                                        ),
                              hovertemplate=Vis_4_4_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 0.15, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                     list(x = 1, y = 1, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})

                     )
                     )
            )
                   }
        )

      Vis_4_4_Scatter_FSYN<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis4_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_4()))}else{req(is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
          plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter",
                name=~get(input$Vis4_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis4_Scatter_MarkerScaleSize),
                sizes=~Vis_4_4_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()),

                              hovertemplate=Vis_4_4_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 1, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                     )
            )
            )
                   }
        )

     Vis_4_4_Scatter_FSNY<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis4_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_Vis_4_4()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter",
                name=~get(input$Vis4_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis4_Scatter_MarkerScaleSize),
                sizes=~Vis_4_4_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                            opacity=input$Vis_4_ScatterOpacity
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_Vis_4_4()} else {Sel_SurveysScatter_Vis_4_4_UL()},
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_4_4_Scatter_FSNN<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Factors")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis4_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_Vis_4_4()))}else{req(is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter",
                name=~get(input$Vis4_Scatter_MarkerColor_Factors),
                color=~I(FactorColor),
                size=~get(input$Vis4_Scatter_MarkerScaleSize),
                sizes=~Vis_4_4_Marker_SizeRange()
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                            opacity=1
                              ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID)
            )%>%
            layout(
                showlegend=c(Vis4_Scatter_HideLegend()),
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                legend=list(
                  itemclick="toggle",
                  itemdoubleclick="toggleothers",
                  itemsizing="constant",orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY, bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          ),
                      list(x = 1, y = 1, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
#### Numeric ####      
      Vis_4_4_Scatter_CUYY<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis4_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis4_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis4_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_4_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_4_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_4_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_4_UL()},
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis4_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis4_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_4_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis4_Scatter_PalToggle,
                  showscale=c(Vis4_Scatter_HideLegend()),
                  colorscale=Vis4_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis4_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
    
      Vis_4_4_Scatter_CUYN<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis4_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
          plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis4_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis4_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_4_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis4_Scatter_PalToggle,
                  showscale=c(Vis4_Scatter_HideLegend()),
                  colorscale=Vis4_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis4_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
            )
                   }
        )
      
     Vis_4_4_Scatter_CUNY<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis4_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis4_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis4_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_4_ScatterOpacity)%>%
            add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_4_UL()},
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis4_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis4_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis4_Scatter_PalToggle,
                  showscale=c(Vis4_Scatter_HideLegend()),
                  colorscale=Vis4_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis4_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )

      Vis_4_4_Scatter_CUNN<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Uniform")
        req(Vis4_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis4_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  size=~Vis4_Scatter_MarkerSize()
                        ),
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis4_Scatter_PalToggle,
                  showscale=c(Vis4_Scatter_HideLegend()),
                  colorscale=Vis4_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis4_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})))
                   }
        )
        
      
      Vis_4_4_Scatter_CSYY<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis4_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis4_Scatter_MarkerScaleSize),
                sizes=~Vis_4_4_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis4_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_4_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_4_ScatterOpacity)%>%
          add_trace(x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit()),
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_4_Scatter_Hover(),
                              showlegend=FALSE,
                              opacity=input$Vis_4_ScatterOpacity)%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_4_UL()},
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis4_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
          add_trace(x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit_Selected()),
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()),
                              
                              hovertemplate=Vis_4_4_Scatter_Selected_Hover(),
                              showlegend=FALSE,
                              opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis4_Scatter_PalToggle,
                  showscale=c(Vis4_Scatter_HideLegend()),
                  colorscale=Vis4_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis4_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_Scatter_Selected_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                     )
            )
                   }
        )
    
      Vis_4_4_Scatter_CSYN<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis4_Scatter_TrendlineSwitch()=="Yes")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
          plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis4_Scatter_MarkerScaleSize),
                sizes=~Vis_4_4_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis4_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
          add_trace(x=~get(input$Vis4_ScatterX),
                              y=fitted(Vis_4_4_Scatter_Fit()),
                              type='scatter',
                              mode='lines',
                              line=list(color=Vis4_Scatter_TrendlineColor(),
                                        width=Vis4_Scatter_TrendlineWidth()),
                             
                              hovertemplate=Vis_4_4_Scatter_Hover(),
                              showlegend=FALSE)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis4_Scatter_PalToggle,
                  showscale=c(Vis4_Scatter_HideLegend()),
                  colorscale=Vis4_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis4_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                     list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                     list(x = 1, y = 0.15, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_Scatter_Hover()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='bottom', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )
      
     Vis_4_4_Scatter_CSNY<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis4_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(!is.null(HighlightTrace_4Vis()))}else{req(!is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis4_Scatter_MarkerScaleSize),
                sizes=~Vis_4_4_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis4_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=input$Vis_4_ScatterOpacity
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=input$Vis_4_ScatterOpacity
            )%>%
          add_trace(
                data=if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()} else {Sel_SurveysScatter_Vis_4_4_UL()},
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis4_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1)%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis4_Scatter_PalToggle,
                  showscale=c(Vis4_Scatter_HideLegend()),
                  colorscale=Vis4_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis4_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )

      Vis_4_4_Scatter_CSNN<-reactive({
        req(input$SelectVis4=="Scatter Plot")
        req(length(Data_4_4_Complete())>0)
        req(Vis4_Scatter_ColorGroupSwitch()=="Numeric")
        req(Vis4_Scatter_MarkerSizeSwitch()=="Scaled")
        req(Vis4_Scatter_TrendlineSwitch()=="No")
        if(input$AF_LinkedSelection=="Yes"){req(is.null(HighlightTrace_4Vis()))}else{req(is.null(Sel_SurveysScatter_Vis_4_4_UL()))}
        plot_ly(
                Data_4_4_Complete(),
                type='scatter',
                mode='lines+markers',
                size=~get(input$Vis4_Scatter_MarkerScaleSize),
                sizes=~Vis_4_4_Marker_SizeRange(),
                key=~Survey_ID,
                source="Vis_4_4_Scatter"
            )%>%
            add_trace(
                x=~get(input$Vis4_ScatterX),
                y=~get(input$Vis4_ScatterY),
                mode='markers',
                marker=list(
                  color=~get(input$Vis4_Scatter_MarkerColor_Numeric),
                  coloraxis='coloraxis',
                  line=list(width=0),
                  opacity=1
                 ),   
                text=~paste(State,'<br>', Year,'<br>',Waterbody_Name_Unique,'<br>',Survey_ID),
                opacity=1
            )%>%
            layout(
                showlegend=FALSE,
                title=list(text=input$Vis4_ScatterTitle,y=1,pad=list(t=10),color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                xaxis=list(title=input$Vis4_ScatterXlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                yaxis=list(title=input$Vis4_ScatterYlab,showline=T,zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}),
                margin=list(b=50), paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'}, plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                coloraxis=list(reversescale=input$Vis4_Scatter_PalToggle,
                  showscale=c(Vis4_Scatter_HideLegend()),
                  colorscale=Vis4_Scatter_ColPal_Numeric(),
                  colorbar=list(orientation=input$Vis4_Scatter_Orientation,x=input$Vis4_Scatter_LegendX, y=input$Vis4_Scatter_LegendY,xanchor="left",yanchor="top",
                    title=list(
                      text=Vis4_Scatter_MarkerColorNumeric()
                     )
                    )
                  ),
                annotations =
                     list(
                       list(x = 0, y = 1.0, text = "Source: CreelCat App", opacity=0.75,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='left', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})),
                      list(x = 1, y = 1, text = if(Vis4_Scatter_HideLegend()=="TRUE"){Vis_4_4_MarkerSizeScaleText()}else{''}, opacity=1,
                          showarrow = F, xref='paper', yref='paper',
                          xanchor='right', yanchor='top', xshift=0, yshift=0,
                          font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'})
                          )
                      )
            )
          }
        )    
      
       output$Vis_4_4_Scatter<-renderPlotly({
      if(Vis4_Scatter_ColorGroupSwitch()=="Uniform"&&Vis4_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis4_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_UUYY()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Uniform"&&Vis4_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis4_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_UUYN()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Uniform"&&Vis4_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis4_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_UUNY()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Uniform"&&Vis4_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis4_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_UUNN()
      } else if(Vis4_Scatter_ColorGroupSwitch()=="Uniform"&&Vis4_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis4_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_USYY()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Uniform"&&Vis4_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis4_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_USYN()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Uniform"&&Vis4_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis4_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_USNY()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Uniform"&&Vis4_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis4_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_USNN()
      } else if(Vis4_Scatter_ColorGroupSwitch()=="Factors"&&Vis4_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis4_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_FUYY()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Factors"&&Vis4_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis4_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_FUYN()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Factors"&&Vis4_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis4_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_FUNY()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Factors"&&Vis4_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis4_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_FUNN()
      } else if(Vis4_Scatter_ColorGroupSwitch()=="Factors"&&Vis4_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis4_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_FSYY()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Factors"&&Vis4_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis4_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_FSYN()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Factors"&&Vis4_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis4_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_FSNY()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Factors"&&Vis4_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis4_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_FSNN()
      } else if(Vis4_Scatter_ColorGroupSwitch()=="Numeric"&&Vis4_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis4_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_CUYY()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Numeric"&&Vis4_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis4_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_CUYN()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Numeric"&&Vis4_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis4_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_CUNY()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Numeric"&&Vis4_Scatter_MarkerSizeSwitch()=="Uniform"&&Vis4_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_CUNN()
      } else if(Vis4_Scatter_ColorGroupSwitch()=="Numeric"&&Vis4_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis4_Scatter_TrendlineSwitch()=="Yes"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_CSYY()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Numeric"&&Vis4_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis4_Scatter_TrendlineSwitch()=="Yes"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_CSYN()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Numeric"&&Vis4_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis4_Scatter_TrendlineSwitch()=="No"&&!is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_CSNY()
      } else if (Vis4_Scatter_ColorGroupSwitch()=="Numeric"&&Vis4_Scatter_MarkerSizeSwitch()=="Scaled"&&Vis4_Scatter_TrendlineSwitch()=="No"&&is.null(if(input$AF_LinkedSelection=="Yes"){HighlightTrace_4Vis()}else{Sel_SurveysScatter_Vis_4_4_UL()})){
      Vis_4_4_Scatter_CSNN()
      }
   })        
       
       
       
       
       
       

 



   #### Line Plot ####

    Vis1_Line_Number<-reactive(as.integer(input$Vis1_Line_Number))
    Vis1_Line_Width<-reactive(input$Vis1_Line_Width)
    Vis1_Line_Point_Color<-reactive(input$Vis1_Line_Point_Color)
    Vis1_Line_Point_Size<-reactive(input$Vis1_Line_Point_Size)
    Vis1_Line_LegendX<-reactive(input$Vis1_Line_LegendX)
    Vis1_Line_LegendY<-reactive(input$Vis1_Line_LegendY)
    Vis1_Line_HideLegend<-reactive(input$Vis1_Line_HideLegend)
    
    Vis2_Line_Number<-reactive(as.integer(input$Vis2_Line_Number))
    Vis2_Line_Width<-reactive(input$Vis2_Line_Width)
    Vis2_Line_Point_Color<-reactive(input$Vis2_Line_Point_Color)
    Vis2_Line_Point_Size<-reactive(input$Vis2_Line_Point_Size)
    Vis2_Line_LegendX<-reactive(input$Vis2_Line_LegendX)
    Vis2_Line_LegendY<-reactive(input$Vis2_Line_LegendY)
    Vis2_Line_HideLegend<-reactive(input$Vis2_Line_HideLegend)
    
    Vis3_Line_Number<-reactive(as.integer(input$Vis3_Line_Number))
    Vis3_Line_Width<-reactive(input$Vis3_Line_Width)
    Vis3_Line_Point_Color<-reactive(input$Vis3_Line_Point_Color)
    Vis3_Line_Point_Size<-reactive(input$Vis3_Line_Point_Size)
    Vis3_Line_LegendX<-reactive(input$Vis3_Line_LegendX)
    Vis3_Line_LegendY<-reactive(input$Vis3_Line_LegendY)
    Vis3_Line_HideLegend<-reactive(input$Vis3_Line_HideLegend)
    
    Vis4_Line_Number<-reactive(as.integer(input$Vis4_Line_Number))
    Vis4_Line_Width<-reactive(input$Vis4_Line_Width)
    Vis4_Line_Point_Color<-reactive(input$Vis4_Line_Point_Color)
    Vis4_Line_Point_Size<-reactive(input$Vis4_Line_Point_Size)
    Vis4_Line_LegendX<-reactive(input$Vis4_Line_LegendX)
    Vis4_Line_LegendY<-reactive(input$Vis4_Line_LegendY)
    Vis4_Line_HideLegend<-reactive(input$Vis4_Line_HideLegend)

    
    
observeEvent(c(
  input$SelectVis1,
  Filtered_CompiledData()
  ),{
  req(input$SelectVis1=="Line Plot")
  
  Vis1_Line_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
  Vis1_Line_Choices<-list()
  Vis1_Line_Choices[Vis1_Line_ChoiceNames]<-Vis1_Line_ChoiceNames
  
  updatePickerInput(session, "Vis1_LineY1",  choices=c("Nothing Selected",Vis1_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis1_LineY2", choices=c("Nothing Selected",Vis1_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis1_LineY3",  choices=c("Nothing Selected",Vis1_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis1_LineY4", choices=c("Nothing Selected",Vis1_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis1_LineY5", choices=c("Nothing Selected",Vis1_Line_Choices),selected="Nothing Selected")

},ignoreInit=TRUE)

observeEvent(c(
  input$SelectVis2,
  Filtered_CompiledData()
  ),{
  req(input$SelectVis2=="Line Plot")
  
  Vis2_Line_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
  Vis2_Line_Choices<-list()
  Vis2_Line_Choices[Vis2_Line_ChoiceNames]<-Vis2_Line_ChoiceNames
  
  updatePickerInput(session, "Vis2_LineY1", choices=c("Nothing Selected",Vis2_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis2_LineY2", choices=c("Nothing Selected",Vis2_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis2_LineY3", choices=c("Nothing Selected",Vis2_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis2_LineY4", choices=c("Nothing Selected",Vis2_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis2_LineY5", choices=c("Nothing Selected",Vis2_Line_Choices),selected="Nothing Selected")

},ignoreInit=TRUE)

observeEvent(c(
  input$SelectVis3,
  Filtered_CompiledData()
  ),{
  req(input$SelectVis3=="Line Plot")
  
  Vis3_Line_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
  Vis3_Line_Choices<-list()
  Vis3_Line_Choices[Vis3_Line_ChoiceNames]<-Vis3_Line_ChoiceNames
  
  updatePickerInput(session, "Vis3_LineY1", choices=c("Nothing Selected",Vis3_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis3_LineY2", choices=c("Nothing Selected",Vis3_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis3_LineY3", choices=c("Nothing Selected",Vis3_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis3_LineY4", choices=c("Nothing Selected",Vis3_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis3_LineY5", choices=c("Nothing Selected",Vis3_Line_Choices),selected="Nothing Selected")

},ignoreInit=TRUE)

observeEvent(c(
  input$SelectVis4,
  Filtered_CompiledData()
  ),{
  req(input$SelectVis4=="Line Plot")
  
  Vis4_Line_ChoiceNames<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
  Vis4_Line_Choices<-list()
  Vis4_Line_Choices[Vis4_Line_ChoiceNames]<-Vis4_Line_ChoiceNames
  
  updatePickerInput(session, "Vis4_LineY1", choices=c("Nothing Selected",Vis4_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis4_LineY2", choices=c("Nothing Selected",Vis4_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis4_LineY3", choices=c("Nothing Selected",Vis4_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis4_LineY4", choices=c("Nothing Selected",Vis4_Line_Choices),selected="Nothing Selected")
  updatePickerInput(session, "Vis4_LineY5", choices=c("Nothing Selected",Vis4_Line_Choices),selected="Nothing Selected")

},ignoreInit=TRUE)


    Vis_1_Line_Pal_N<-reactive({
      req(input$Vis1_LineY1)
      if(input$Vis1_Line_ColPal=='Reds'||input$Vis1_Line_ColPal=='Purples'||input$Vis1_Line_ColPal=='Greens'||input$Vis1_Line_ColPal=='Blues'||input$Vis1_Line_ColPal=='Greys'||input$Vis1_Line_ColPal=='Set1'||input$Vis1_Line_ColPal=='Pastel1'){
        9
      } else if(input$Vis1_Line_ColPal=='Accent'||input$Vis1_Line_ColPal=='Dark2'||input$Vis1_Line_ColPal=='Pastel2'||input$Vis1_Line_ColPal=='Set2'){
        8
      } else if(input$Vis1_Line_ColPal=='Paired'||input$Vis1_Line_ColPal=='Set3'){
        12
      } else{11}
      })
    
    Vis_2_Line_Pal_N<-reactive({
      req(input$Vis2_LineY1)
      if(input$Vis2_Line_ColPal=='Reds'||input$Vis2_Line_ColPal=='Purples'||input$Vis2_Line_ColPal=='Greens'||input$Vis2_Line_ColPal=='Blues'||input$Vis2_Line_ColPal=='Greys'||input$Vis2_Line_ColPal=='Set1'||input$Vis2_Line_ColPal=='Pastel1'){
        9
      } else if(input$Vis2_Line_ColPal=='Accent'||input$Vis2_Line_ColPal=='Dark2'||input$Vis2_Line_ColPal=='Pastel2'||input$Vis2_Line_ColPal=='Set2'){
        8
      } else if(input$Vis2_Line_ColPal=='Paired'||input$Vis2_Line_ColPal=='Set3'){
        12
      } else{11}
      })
    
    Vis_3_Line_Pal_N<-reactive({
      req(input$Vis3_LineY1)
      if(input$Vis3_Line_ColPal=='Reds'||input$Vis3_Line_ColPal=='Purples'||input$Vis3_Line_ColPal=='Greens'||input$Vis3_Line_ColPal=='Blues'||input$Vis3_Line_ColPal=='Greys'||input$Vis3_Line_ColPal=='Set1'||input$Vis3_Line_ColPal=='Pastel1'){
        9
      } else if(input$Vis3_Line_ColPal=='Accent'||input$Vis3_Line_ColPal=='Dark2'||input$Vis3_Line_ColPal=='Pastel2'||input$Vis3_Line_ColPal=='Set2'){
        8
      } else if(input$Vis3_Line_ColPal=='Paired'||input$Vis3_Line_ColPal=='Set3'){
        12
      } else{11}
      })
    
    Vis_4_Line_Pal_N<-reactive({
      req(input$Vis4_LineY1)
      if(input$Vis4_Line_ColPal=='Reds'||input$Vis4_Line_ColPal=='Purples'||input$Vis4_Line_ColPal=='Greens'||input$Vis4_Line_ColPal=='Blues'||input$Vis4_Line_ColPal=='Greys'||input$Vis4_Line_ColPal=='Set1'||input$Vis4_Line_ColPal=='Pastel1'){
        9
      } else if(input$Vis4_Line_ColPal=='Accent'||input$Vis4_Line_ColPal=='Dark2'||input$Vis4_Line_ColPal=='Pastel2'||input$Vis4_Line_ColPal=='Set2'){
        8
      } else if(input$Vis4_Line_ColPal=='Paired'||input$Vis4_Line_ColPal=='Set3'){
        12
      } else{11}
      })
    
    Vis_1_1_Line_Palette<-reactive({
      req(length(Data_1_1())>0)
      colorRampPalette(brewer.pal(Vis_1_Line_Pal_N(),input$Vis1_Line_ColPal))(n_distinct(Data_1_1()$WB_ID))
    })
   
    Vis_2_1_Line_Palette<-reactive({
      req(length(Data_2_1_Selected())>0)
      colorRampPalette(brewer.pal(Vis_1_Line_Pal_N(),input$Vis1_Line_ColPal))(n_distinct(Data_2_1_Selected()$WB_ID))
    })
   
    Vis_3_1_Line_Palette<-reactive({
      req(length(Data_3_1_Selected())>0)
      colorRampPalette(brewer.pal(Vis_1_Line_Pal_N(),input$Vis1_Line_ColPal))(n_distinct(Data_3_1_Selected()$WB_ID))
    })
   
    Vis_4_1_Line_Palette<-reactive({
      req(length(Data_4_1_Selected())>0)
      colorRampPalette(brewer.pal(Vis_1_Line_Pal_N(),input$Vis1_Line_ColPal))(n_distinct(Data_4_1_Selected()$WB_ID))
    })
   
    Vis_2_2_Line_Palette<-reactive({
      req(length(Data_2_2_Selected())>0)
      colorRampPalette(brewer.pal(Vis_2_Line_Pal_N(),input$Vis2_Line_ColPal))(n_distinct(Data_2_2_Selected()$WB_ID))
    })
   
    Vis_3_2_Line_Palette<-reactive({
      req(length(Data_3_2_Selected())>0)
      colorRampPalette(brewer.pal(Vis_2_Line_Pal_N(),input$Vis2_Line_ColPal))(n_distinct(Data_3_2_Selected()$WB_ID))
    })
   
    Vis_4_2_Line_Palette<-reactive({
      req(length(Data_4_2_Selected())>0)
      colorRampPalette(brewer.pal(Vis_2_Line_Pal_N(),input$Vis2_Line_ColPal))(n_distinct(Data_4_2_Selected()$WB_ID))
    })
   
    Vis_3_3_Line_Palette<-reactive({
      req(length(Data_3_3_Selected())>0)
      colorRampPalette(brewer.pal(Vis_3_Line_Pal_N(),input$Vis3_Line_ColPal))(n_distinct(Data_3_3_Selected()$WB_ID))
    })
   
    Vis_4_3_Line_Palette<-reactive({
      req(length(Data_4_3_Selected())>0)
      colorRampPalette(brewer.pal(Vis_3_Line_Pal_N(),input$Vis3_Line_ColPal))(n_distinct(Data_4_3_Selected()$WB_ID))
    })
   
    Vis_4_4_Line_Palette<-reactive({
      req(length(Data_4_4_Selected())>0)
      colorRampPalette(brewer.pal(Vis_4_Line_Pal_N(),input$Vis4_Line_ColPal))(n_distinct(Data_4_4_Selected()$WB_ID))
    })
    
    
   
    
    ##### 1_1 Line #####
      Vis_1_1_Line_1Y<-reactive({
      req(Data_1_1())
        plot_ly(
          Data_1_1(),
          source="Vis_1_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(),name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
             layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

 
    
    Vis_1_1_Line_2Y<-reactive({
      req(Data_1_1())
        plot_ly(
          Data_1_1(),
          source="Vis_1_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
              layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

        
     Vis_1_1_Line_3Y<-reactive({
      req(Data_1_1())
        plot_ly(
          Data_1_1(),
          source="Vis_1_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY3),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate =~paste(input$Vis1_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

            
  Vis_1_1_Line_4Y<-reactive({
      req(Data_1_1())
        plot_ly(
          Data_1_1(),
          source="Vis_1_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY3),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate =~paste(input$Vis1_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY4),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate =~paste(input$Vis1_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   


  
    Vis_1_1_Line_5Y<-reactive({
      req(Data_1_1())
        plot_ly(
          Data_1_1(),
          source="Vis_1_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY3),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate =~paste(input$Vis1_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY4),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate =~paste(input$Vis1_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY5),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_1_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY5),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash5))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY5),hovertemplate =~paste(input$Vis1_LineY5,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   



   output$Vis_1_1_Line<-renderPlotly({
      if(Vis1_Line_Number()=="1"){
      Vis_1_1_Line_1Y()
      } else if (Vis1_Line_Number()=="2"){
      Vis_1_1_Line_2Y()
      } else if (Vis1_Line_Number()=="3"){
      Vis_1_1_Line_3Y()
      } else if (Vis1_Line_Number()=="4"){
      Vis_1_1_Line_4Y()
      } else if (Vis1_Line_Number()=="5"){
       Vis_1_1_Line_5Y()
      }
   })

    ##### 2_1 Line #####
      Vis_2_1_Line_1Y<-reactive({
      req(Data_2_1_Selected())
        plot_ly(
          Data_2_1_Selected(),
          source="Vis_2_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(),name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
             layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

 
    
    Vis_2_1_Line_2Y<-reactive({
      req(Data_2_1_Selected())
        plot_ly(
          Data_2_1_Selected(),
          source="Vis_2_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
              layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

        
     Vis_2_1_Line_3Y<-reactive({
      req(Data_2_1_Selected())
        plot_ly(
          Data_2_1_Selected(),
          source="Vis_2_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY3),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate =~paste(input$Vis1_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

            
  Vis_2_1_Line_4Y<-reactive({
      req(Data_2_1_Selected())
        plot_ly(
          Data_2_1_Selected(),
          source="Vis_2_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY3),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate =~paste(input$Vis1_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY4),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate =~paste(input$Vis1_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   


  
    Vis_2_1_Line_5Y<-reactive({
      req(Data_2_1_Selected())
        plot_ly(
          Data_2_1_Selected(),
          source="Vis_2_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY3),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate =~paste(input$Vis1_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY4),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate =~paste(input$Vis1_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY5),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY5),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash5))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY5),hovertemplate =~paste(input$Vis1_LineY5,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   



   output$Vis_2_1_Line<-renderPlotly({
      if(Vis1_Line_Number()=="1"){
      Vis_2_1_Line_1Y()
      } else if (Vis1_Line_Number()=="2"){
      Vis_2_1_Line_2Y()
      } else if (Vis1_Line_Number()=="3"){
      Vis_2_1_Line_3Y()
      } else if (Vis1_Line_Number()=="4"){
      Vis_2_1_Line_4Y()
      } else if (Vis1_Line_Number()=="5"){
       Vis_2_1_Line_5Y()
      }
   })

    ##### 3_1 Line #####
      Vis_3_1_Line_1Y<-reactive({
      req(Data_3_1_Selected())
        plot_ly(
          Data_3_1_Selected(),
          source="Vis_3_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(),name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
             layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

 
    
    Vis_3_1_Line_2Y<-reactive({
      req(Data_3_1_Selected())
        plot_ly(
          Data_3_1_Selected(),
          source="Vis_3_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
              layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

        
     Vis_3_1_Line_3Y<-reactive({
      req(Data_3_1_Selected())
        plot_ly(
          Data_3_1_Selected(),
          source="Vis_3_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY3),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate =~paste(input$Vis1_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

            
  Vis_3_1_Line_4Y<-reactive({
      req(Data_3_1_Selected())
        plot_ly(
          Data_3_1_Selected(),
          source="Vis_3_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY3),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate =~paste(input$Vis1_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY4),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate =~paste(input$Vis1_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   


  
    Vis_3_1_Line_5Y<-reactive({
      req(Data_3_1_Selected())
        plot_ly(
          Data_3_1_Selected(),
          source="Vis_3_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY3),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate =~paste(input$Vis1_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY4),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate =~paste(input$Vis1_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY5),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY5),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash5))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY5),hovertemplate =~paste(input$Vis1_LineY5,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   



   output$Vis_3_1_Line<-renderPlotly({
      if(Vis1_Line_Number()=="1"){
      Vis_3_1_Line_1Y()
      } else if (Vis1_Line_Number()=="2"){
      Vis_3_1_Line_2Y()
      } else if (Vis1_Line_Number()=="3"){
      Vis_3_1_Line_3Y()
      } else if (Vis1_Line_Number()=="4"){
      Vis_3_1_Line_4Y()
      } else if (Vis1_Line_Number()=="5"){
       Vis_3_1_Line_5Y()
      }
   })  
   
    ##### 4_1 Line #####
      Vis_4_1_Line_1Y<-reactive({
      req(Data_4_1_Selected())
        plot_ly(
          Data_4_1_Selected(),
          source="Vis_4_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(),name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
             layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

 
    
    Vis_4_1_Line_2Y<-reactive({
      req(Data_4_1_Selected())
        plot_ly(
          Data_4_1_Selected(),
          source="Vis_4_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
              layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

        
     Vis_4_1_Line_3Y<-reactive({
      req(Data_4_1_Selected())
        plot_ly(
          Data_4_1_Selected(),
          source="Vis_4_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY3),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate =~paste(input$Vis1_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

            
  Vis_4_1_Line_4Y<-reactive({
      req(Data_4_1_Selected())
        plot_ly(
          Data_4_1_Selected(),
          source="Vis_4_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY3),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate =~paste(input$Vis1_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY4),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate =~paste(input$Vis1_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   


  
    Vis_4_1_Line_5Y<-reactive({
      req(Data_4_1_Selected())
        plot_ly(
          Data_4_1_Selected(),
          source="Vis_4_1_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY1),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY1),hovertemplate =~paste(input$Vis1_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY2),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY2),hovertemplate =~paste(input$Vis1_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY3),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY3),hovertemplate =~paste(input$Vis1_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY4),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY4),hovertemplate =~paste(input$Vis1_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis1_LineY5),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_1_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis1_LineY5),line=list(width=~Vis1_Line_Width(),dash=input$Vis1_Linedash5))%>%
          add_markers(x=~Year,y=~get(input$Vis1_LineY5),hovertemplate =~paste(input$Vis1_LineY5,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis1_Line_Point_Color(), size=~Vis1_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis1_Line_LegendX(),
                        y=Vis1_Line_LegendY(), orientation=input$Vis1_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis1_Line_HideLegend()),
                     title=list(
                       text=input$Vis1_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis1_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis1_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   



   output$Vis_4_1_Line<-renderPlotly({
      if(Vis1_Line_Number()=="1"){
      Vis_4_1_Line_1Y()
      } else if (Vis1_Line_Number()=="2"){
      Vis_4_1_Line_2Y()
      } else if (Vis1_Line_Number()=="3"){
      Vis_4_1_Line_3Y()
      } else if (Vis1_Line_Number()=="4"){
      Vis_4_1_Line_4Y()
      } else if (Vis1_Line_Number()=="5"){
       Vis_4_1_Line_5Y()
      }
   })
   
    ##### 2_2 Line #####
      Vis_2_2_Line_1Y<-reactive({
      req(Data_2_2_Selected())
        plot_ly(
          Data_2_2_Selected(),
          source="Vis_2_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(),name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
             layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

 
    
    Vis_2_2_Line_2Y<-reactive({
      req(Data_2_2_Selected())
        plot_ly(
          Data_2_2_Selected(),
          source="Vis_2_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY2),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate =~paste(input$Vis2_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
              layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

        
     Vis_2_2_Line_3Y<-reactive({
      req(Data_2_2_Selected())
        plot_ly(
          Data_2_2_Selected(),
          source="Vis_2_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY2),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate =~paste(input$Vis2_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY3),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate =~paste(input$Vis2_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

            
  Vis_2_2_Line_4Y<-reactive({
      req(Data_2_2_Selected())
        plot_ly(
          Data_2_2_Selected(),
          source="Vis_2_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY2),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate =~paste(input$Vis2_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY3),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate =~paste(input$Vis2_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY4),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY4),hovertemplate =~paste(input$Vis2_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   


  
    Vis_2_2_Line_5Y<-reactive({
      req(Data_2_2_Selected())
        plot_ly(
          Data_2_2_Selected(),
          source="Vis_2_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY2),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate =~paste(input$Vis2_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY3),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate =~paste(input$Vis2_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY4),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY4),hovertemplate =~paste(input$Vis2_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY5),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_2_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY5),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash5))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY5),hovertemplate =~paste(input$Vis2_LineY5,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   



   output$Vis_2_2_Line<-renderPlotly({
      if(Vis2_Line_Number()=="1"){
      Vis_2_2_Line_1Y()
      } else if (Vis2_Line_Number()=="2"){
      Vis_2_2_Line_2Y()
      } else if (Vis2_Line_Number()=="3"){
      Vis_2_2_Line_3Y()
      } else if (Vis2_Line_Number()=="4"){
      Vis_2_2_Line_4Y()
      } else if (Vis2_Line_Number()=="5"){
       Vis_2_2_Line_5Y()
      }
   })
   
    ##### 3_2 Line #####
      Vis_3_2_Line_1Y<-reactive({
      req(Data_3_2_Selected())
        plot_ly(
          Data_3_2_Selected(),
          source="Vis_3_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(),name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
             layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

 
    
    Vis_3_2_Line_2Y<-reactive({
      req(Data_3_2_Selected())
        plot_ly(
          Data_3_2_Selected(),
          source="Vis_3_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY2),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate =~paste(input$Vis2_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
              layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

        
     Vis_3_2_Line_3Y<-reactive({
      req(Data_3_2_Selected())
        plot_ly(
          Data_3_2_Selected(),
          source="Vis_3_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY2),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate =~paste(input$Vis2_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY3),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate =~paste(input$Vis2_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

            
  Vis_3_2_Line_4Y<-reactive({
      req(Data_3_2_Selected())
        plot_ly(
          Data_3_2_Selected(),
          source="Vis_3_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY2),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate =~paste(input$Vis2_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY3),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate =~paste(input$Vis2_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY4),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY4),hovertemplate =~paste(input$Vis2_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   


  
    Vis_3_2_Line_5Y<-reactive({
      req(Data_3_2_Selected())
        plot_ly(
          Data_3_2_Selected(),
          source="Vis_3_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY2),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate =~paste(input$Vis2_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY3),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate =~paste(input$Vis2_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY4),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY4),hovertemplate =~paste(input$Vis2_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY5),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY5),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash5))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY5),hovertemplate =~paste(input$Vis2_LineY5,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   



   output$Vis_3_2_Line<-renderPlotly({
      if(Vis2_Line_Number()=="1"){
      Vis_3_2_Line_1Y()
      } else if (Vis2_Line_Number()=="2"){
      Vis_3_2_Line_2Y()
      } else if (Vis2_Line_Number()=="3"){
      Vis_3_2_Line_3Y()
      } else if (Vis2_Line_Number()=="4"){
      Vis_3_2_Line_4Y()
      } else if (Vis2_Line_Number()=="5"){
       Vis_3_2_Line_5Y()
      }
   })   
   
    ##### 4_2 Line #####
      Vis_4_2_Line_1Y<-reactive({
      req(Data_4_2_Selected())
        plot_ly(
          Data_4_2_Selected(),
          source="Vis_4_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(),name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
             layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

 
    
    Vis_4_2_Line_2Y<-reactive({
      req(Data_4_2_Selected())
        plot_ly(
          Data_4_2_Selected(),
          source="Vis_4_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY2),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate =~paste(input$Vis2_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
              layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

        
     Vis_4_2_Line_3Y<-reactive({
      req(Data_4_2_Selected())
        plot_ly(
          Data_4_2_Selected(),
          source="Vis_4_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY2),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate =~paste(input$Vis2_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY3),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate =~paste(input$Vis2_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

            
  Vis_4_2_Line_4Y<-reactive({
      req(Data_4_2_Selected())
        plot_ly(
          Data_4_2_Selected(),
          source="Vis_4_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY2),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate =~paste(input$Vis2_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY3),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate =~paste(input$Vis2_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY4),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY4),hovertemplate =~paste(input$Vis2_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   


  
    Vis_4_2_Line_5Y<-reactive({
      req(Data_4_2_Selected())
        plot_ly(
          Data_4_2_Selected(),
          source="Vis_4_2_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY1),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY1),hovertemplate =~paste(input$Vis2_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY2),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY2),hovertemplate =~paste(input$Vis2_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY3),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY3),hovertemplate =~paste(input$Vis2_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY4),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY4),hovertemplate =~paste(input$Vis2_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis2_LineY5),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_2_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis2_LineY5),line=list(width=~Vis2_Line_Width(),dash=input$Vis2_Linedash5))%>%
          add_markers(x=~Year,y=~get(input$Vis2_LineY5),hovertemplate =~paste(input$Vis2_LineY5,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis2_Line_Point_Color(), size=~Vis2_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis2_Line_LegendX(),
                        y=Vis2_Line_LegendY(), orientation=input$Vis2_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis2_Line_HideLegend()),
                     title=list(
                       text=input$Vis2_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis2_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis2_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   



   output$Vis_4_2_Line<-renderPlotly({
      if(Vis2_Line_Number()=="1"){
      Vis_4_2_Line_1Y()
      } else if (Vis2_Line_Number()=="2"){
      Vis_4_2_Line_2Y()
      } else if (Vis2_Line_Number()=="3"){
      Vis_4_2_Line_3Y()
      } else if (Vis2_Line_Number()=="4"){
      Vis_4_2_Line_4Y()
      } else if (Vis2_Line_Number()=="5"){
       Vis_4_2_Line_5Y()
      }
   })
   
    ##### 3_3 Line #####
      Vis_3_3_Line_1Y<-reactive({
      req(Data_3_3_Selected())
        plot_ly(
          Data_3_3_Selected(),
          source="Vis_3_3_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(),name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY1),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate =~paste(input$Vis3_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
             layout(legend=list(
                        x=Vis3_Line_LegendX(),
                        y=Vis3_Line_LegendY(), orientation=input$Vis3_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis3_Line_HideLegend()),
                     title=list(
                       text=input$Vis3_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

 
    
    Vis_3_3_Line_2Y<-reactive({
      req(Data_3_3_Selected())
        plot_ly(
          Data_3_3_Selected(),
          source="Vis_3_3_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY1),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate =~paste(input$Vis3_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY2),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate =~paste(input$Vis3_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
              layout(legend=list(
                        x=Vis3_Line_LegendX(),
                        y=Vis3_Line_LegendY(), orientation=input$Vis3_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis3_Line_HideLegend()),
                     title=list(
                       text=input$Vis3_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

        
     Vis_3_3_Line_3Y<-reactive({
      req(Data_3_3_Selected())
        plot_ly(
          Data_3_3_Selected(),
          source="Vis_3_3_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY1),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate =~paste(input$Vis3_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY2),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate =~paste(input$Vis3_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY3),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY3),hovertemplate =~paste(input$Vis3_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis3_Line_LegendX(),
                        y=Vis3_Line_LegendY(), orientation=input$Vis3_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis3_Line_HideLegend()),
                     title=list(
                       text=input$Vis3_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

            
  Vis_3_3_Line_4Y<-reactive({
      req(Data_3_3_Selected())
        plot_ly(
          Data_3_3_Selected(),
          source="Vis_3_3_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY1),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate =~paste(input$Vis3_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY2),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate =~paste(input$Vis3_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY3),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY3),hovertemplate =~paste(input$Vis3_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY4),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY4),hovertemplate =~paste(input$Vis3_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis3_Line_LegendX(),
                        y=Vis3_Line_LegendY(), orientation=input$Vis3_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis3_Line_HideLegend()),
                     title=list(
                       text=input$Vis3_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   


  
    Vis_3_3_Line_5Y<-reactive({
      req(Data_3_3_Selected())
        plot_ly(
          Data_3_3_Selected(),
          source="Vis_3_3_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY1),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate =~paste(input$Vis3_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY2),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate =~paste(input$Vis3_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY3),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY3),hovertemplate =~paste(input$Vis3_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY4),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY4),hovertemplate =~paste(input$Vis3_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY5),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_3_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY5),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash5))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY5),hovertemplate =~paste(input$Vis3_LineY5,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis3_Line_LegendX(),
                        y=Vis3_Line_LegendY(), orientation=input$Vis3_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis3_Line_HideLegend()),
                     title=list(
                       text=input$Vis3_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   



   output$Vis_3_3_Line<-renderPlotly({
      if(Vis3_Line_Number()=="1"){
      Vis_3_3_Line_1Y()
      } else if (Vis3_Line_Number()=="2"){
      Vis_3_3_Line_2Y()
      } else if (Vis3_Line_Number()=="3"){
      Vis_3_3_Line_3Y()
      } else if (Vis3_Line_Number()=="4"){
      Vis_3_3_Line_4Y()
      } else if (Vis3_Line_Number()=="5"){
       Vis_3_3_Line_5Y()
      }
   }) 
   
    ##### 4_3 Line #####
      Vis_4_3_Line_1Y<-reactive({
      req(Data_4_3_Selected())
        plot_ly(
          Data_4_3_Selected(),
          source="Vis_4_3_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(),name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY1),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate =~paste(input$Vis3_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
             layout(legend=list(
                        x=Vis3_Line_LegendX(),
                        y=Vis3_Line_LegendY(), orientation=input$Vis3_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis3_Line_HideLegend()),
                     title=list(
                       text=input$Vis3_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

 
    
    Vis_4_3_Line_2Y<-reactive({
      req(Data_4_3_Selected())
        plot_ly(
          Data_4_3_Selected(),
          source="Vis_4_3_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY1),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate =~paste(input$Vis3_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY2),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate =~paste(input$Vis3_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
              layout(legend=list(
                        x=Vis3_Line_LegendX(),
                        y=Vis3_Line_LegendY(), orientation=input$Vis3_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis3_Line_HideLegend()),
                     title=list(
                       text=input$Vis3_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

        
     Vis_4_3_Line_3Y<-reactive({
      req(Data_4_3_Selected())
        plot_ly(
          Data_4_3_Selected(),
          source="Vis_4_3_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY1),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate =~paste(input$Vis3_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY2),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate =~paste(input$Vis3_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY3),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY3),hovertemplate =~paste(input$Vis3_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis3_Line_LegendX(),
                        y=Vis3_Line_LegendY(), orientation=input$Vis3_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis3_Line_HideLegend()),
                     title=list(
                       text=input$Vis3_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

            
  Vis_4_3_Line_4Y<-reactive({
      req(Data_4_3_Selected())
        plot_ly(
          Data_4_3_Selected(),
          source="Vis_4_3_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY1),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate =~paste(input$Vis3_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY2),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate =~paste(input$Vis3_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY3),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY3),hovertemplate =~paste(input$Vis3_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY4),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY4),hovertemplate =~paste(input$Vis3_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis3_Line_LegendX(),
                        y=Vis3_Line_LegendY(), orientation=input$Vis3_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis3_Line_HideLegend()),
                     title=list(
                       text=input$Vis3_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   


  
    Vis_4_3_Line_5Y<-reactive({
      req(Data_4_3_Selected())
        plot_ly(
          Data_4_3_Selected(),
          source="Vis_4_3_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY1),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY1),hovertemplate =~paste(input$Vis3_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY2),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY2),hovertemplate =~paste(input$Vis3_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY3),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY3),hovertemplate =~paste(input$Vis3_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY4),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY4),hovertemplate =~paste(input$Vis3_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis3_LineY5),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_3_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis3_LineY5),line=list(width=~Vis3_Line_Width(),dash=input$Vis3_Linedash5))%>%
          add_markers(x=~Year,y=~get(input$Vis3_LineY5),hovertemplate =~paste(input$Vis3_LineY5,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis3_Line_Point_Color(), size=~Vis3_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis3_Line_LegendX(),
                        y=Vis3_Line_LegendY(), orientation=input$Vis3_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis3_Line_HideLegend()),
                     title=list(
                       text=input$Vis3_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis3_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis3_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   



   output$Vis_4_3_Line<-renderPlotly({
      if(Vis3_Line_Number()=="1"){
      Vis_4_3_Line_1Y()
      } else if (Vis3_Line_Number()=="2"){
      Vis_4_3_Line_2Y()
      } else if (Vis3_Line_Number()=="3"){
      Vis_4_3_Line_3Y()
      } else if (Vis3_Line_Number()=="4"){
      Vis_4_3_Line_4Y()
      } else if (Vis3_Line_Number()=="5"){
       Vis_4_3_Line_5Y()
      }
   })  
   
    ##### 4_4 Line #####
      Vis_4_4_Line_1Y<-reactive({
      req(Data_4_4_Selected())
        plot_ly(
          Data_4_4_Selected(),
          source="Vis_4_4_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(),name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY1),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY1),hovertemplate =~paste(input$Vis4_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
             layout(legend=list(
                        x=Vis4_Line_LegendX(),
                        y=Vis4_Line_LegendY(), orientation=input$Vis4_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis4_Line_HideLegend()),
                     title=list(
                       text=input$Vis4_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis4_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis4_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

 
    
    Vis_4_4_Line_2Y<-reactive({
      req(Data_4_4_Selected())
        plot_ly(
          Data_4_4_Selected(),
          source="Vis_4_4_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY1),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY1),hovertemplate =~paste(input$Vis4_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY2),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY2),hovertemplate =~paste(input$Vis4_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
              layout(legend=list(
                        x=Vis4_Line_LegendX(),
                        y=Vis4_Line_LegendY(), orientation=input$Vis4_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis4_Line_HideLegend()),
                     title=list(
                       text=input$Vis4_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis4_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis4_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

        
     Vis_4_4_Line_3Y<-reactive({
      req(Data_4_4_Selected())
        plot_ly(
          Data_4_4_Selected(),
          source="Vis_4_4_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY1),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY1),hovertemplate =~paste(input$Vis4_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY2),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY2),hovertemplate =~paste(input$Vis4_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY3),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY3),hovertemplate =~paste(input$Vis4_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis4_Line_LegendX(),
                        y=Vis4_Line_LegendY(), orientation=input$Vis4_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis4_Line_HideLegend()),
                     title=list(
                       text=input$Vis4_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis4_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis4_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   

            
  Vis_4_4_Line_4Y<-reactive({
      req(Data_4_4_Selected())
        plot_ly(
          Data_4_4_Selected(),
          source="Vis_4_4_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY1),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY1),hovertemplate =~paste(input$Vis4_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY2),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY2),hovertemplate =~paste(input$Vis4_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY3),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY3),hovertemplate =~paste(input$Vis4_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY4),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY4),hovertemplate =~paste(input$Vis4_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis4_Line_LegendX(),
                        y=Vis4_Line_LegendY(), orientation=input$Vis4_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis4_Line_HideLegend()),
                     title=list(
                       text=input$Vis4_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis4_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis4_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   


  
    Vis_4_4_Line_5Y<-reactive({
      req(Data_4_4_Selected())
        plot_ly(
          Data_4_4_Selected(),
          source="Vis_4_4_Line",
          key=~Survey_ID,
          x=~Year)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY1),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY1),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash1))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY1),hovertemplate =~paste(input$Vis4_LineY1,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY2),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY2),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash2))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY2),hovertemplate =~paste(input$Vis4_LineY2,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY3),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY3),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash3))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY3),hovertemplate =~paste(input$Vis4_LineY3,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY4),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY4),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash4))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY4),hovertemplate =~paste(input$Vis4_LineY4,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
          add_lines(x=~Year,y=~get(input$Vis4_LineY5),hovertemplate="skip",color=~Waterbody_Name_Unique,colors=Vis_4_4_Line_Palette(), name=~paste(Waterbody_Name_Unique,'_',input$Vis4_LineY5),line=list(width=~Vis4_Line_Width(),dash=input$Vis4_Linedash5))%>%
          add_markers(x=~Year,y=~get(input$Vis4_LineY5),hovertemplate =~paste(input$Vis4_LineY5,'<br>',"%{y}",'<br>',Waterbody_Name_Unique,'<br>',State,'<br>',Year,'<br>',Survey_ID),marker=list(color=~Vis4_Line_Point_Color(), size=~Vis4_Line_Point_Size()), showlegend = FALSE)%>%
               layout(legend=list(
                        x=Vis4_Line_LegendX(),
                        y=Vis4_Line_LegendY(), orientation=input$Vis4_Line_LegendOrient,bgcolor = 'rgba(0,0,0,0)',xanchor="left",yanchor="top"
                        ),
                     showlegend=c(Vis4_Line_HideLegend()),
                     title=list(
                       text=input$Vis4_LineTitle,
                       y=1,
                       pad=list(t=10),
                       color=if(input$DarkMode=='Dark'){'white'}else{'black'}
                       ),
                     xaxis=list(title=input$Vis4_LineXlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     yaxis=list(title=input$Vis4_LineYlab,
                                showline=T,
                                zerolinecolor=if(input$DarkMode=='Dark'){'#f1f0f0'}else{'#323232'},
                                gridcolor =if(input$DarkMode=='Dark'){'#323232'}else{'#f1f0f0'}
                                ),
                     margin=list(b=50),
                     paper_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     plot_bgcolor=if(input$DarkMode=='Dark'){'black'}else{'white'},
                     font=list(color=if(input$DarkMode=='Dark'){'white'}else{'black'}),
                     annotations =
                           list(x = 0, y = 1.05, text = "Source: CreelCat App", opacity=0.5,
                                showarrow = F, xref='paper', yref='paper',
                                xanchor='left', yanchor='top', xshift=0, yshift=0,
                                font=list(size=10, color=if(input$DarkMode=='Dark'){'white'}else{'black'}))
                     )
    })   



   output$Vis_4_4_Line<-renderPlotly({
      if(Vis4_Line_Number()=="1"){
      Vis_4_4_Line_1Y()
      } else if (Vis4_Line_Number()=="2"){
      Vis_4_4_Line_2Y()
      } else if (Vis4_Line_Number()=="3"){
      Vis_4_4_Line_3Y()
      } else if (Vis4_Line_Number()=="4"){
      Vis_4_4_Line_4Y()
      } else if (Vis4_Line_Number()=="5"){
       Vis_4_4_Line_5Y()
      }
   })


 #### Map Server Info ####
   
    GetURL <- function(service, host = "basemap.nationalmap.gov") {
      sprintf("https://%s/arcgis/services/%s/MapServer/WmsServer", host, service)
    }

     observe({
      Vis1_MapDisplayField<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis1_MapDisplayField_Choices<-list()
      Vis1_MapDisplayField_Choices[Vis1_MapDisplayField]<-Vis1_MapDisplayField
      updatePickerInput(session, "Vis1_MapDisplayField", choices=c("Nothing Selected",Vis1_MapDisplayField_Choices),selected="Nothing Selected")
    })
    
    observe({
      Vis1_MapSizeField<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis1_MapSizeField_Choices<-list()
      Vis1_MapSizeField_Choices[Vis1_MapSizeField]<-Vis1_MapSizeField
      updatePickerInput(session, "Vis1_MapDisplayField_Size", choices=c("Nothing Selected",Vis1_MapSizeField_Choices),selected="Nothing Selected")
    })
    
     observe({
      Vis2_MapDisplayField<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis2_MapDisplayField_Choices<-list()
      Vis2_MapDisplayField_Choices[Vis2_MapDisplayField]<-Vis2_MapDisplayField
      updatePickerInput(session, "Vis2_MapDisplayField", choices=c("Nothing Selected",Vis2_MapDisplayField_Choices),selected="Nothing Selected")
    })
    
    observe({
      Vis2_MapSizeField<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis2_MapSizeField_Choices<-list()
      Vis2_MapSizeField_Choices[Vis2_MapSizeField]<-Vis2_MapSizeField
      updatePickerInput(session, "Vis2_MapDisplayField_Size", choices=c("Nothing Selected",Vis2_MapSizeField_Choices),selected="Nothing Selected")
    })
    
    observe({
      Vis3_MapDisplayField<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis3_MapDisplayField_Choices<-list()
      Vis3_MapDisplayField_Choices[Vis3_MapDisplayField]<-Vis3_MapDisplayField
      updatePickerInput(session, "Vis3_MapDisplayField", choices=c("Nothing Selected",Vis3_MapDisplayField_Choices),selected="Nothing Selected")
    })
    
    observe({
      Vis3_MapSizeField<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis3_MapSizeField_Choices<-list()
      Vis3_MapSizeField_Choices[Vis3_MapSizeField]<-Vis3_MapSizeField
      updatePickerInput(session, "Vis3_MapDisplayField_Size", choices=c("Nothing Selected",Vis3_MapSizeField_Choices),selected="Nothing Selected")
    })
    
     observe({
      Vis4_MapDisplayField<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis4_MapDisplayField_Choices<-list()
      Vis4_MapDisplayField_Choices[Vis4_MapDisplayField]<-Vis4_MapDisplayField
      updatePickerInput(session, "Vis4_MapDisplayField", choices=c("Nothing Selected",Vis4_MapDisplayField_Choices),selected="Nothing Selected")
    })
    
    observe({
      Vis4_MapSizeField<-names(dplyr::select_if(Filtered_CompiledData(),is.numeric))
      Vis4_MapSizeField_Choices<-list()
      Vis4_MapSizeField_Choices[Vis4_MapSizeField]<-Vis4_MapSizeField
      updatePickerInput(session, "Vis4_MapDisplayField_Size", choices=c("Nothing Selected",Vis4_MapSizeField_Choices),selected="Nothing Selected")
    })
    
    observeEvent(c(
      input$Vis1_ZoomToState,
      input$SelectVis1=="Map"
      ),{
      StateChoice<-CountyBoundaries_SHP[CountyBoundaries_SHP$State==input$Vis1_ZoomToState,]
      CountyChoices<-as.character(StateChoice%>%as.data.frame%>%arrange(County)%>%distinct(County)%>%pull())
      updatePickerInput(session, "Vis1_ZoomToCounty", choices=c("Statewide", CountyChoices),selected="Statewide")
    },ignoreInit=TRUE)
    
    observeEvent(c(
      input$Vis2_ZoomToState,
      input$SelectVis2=="Map"
      ),{
      StateChoice<-CountyBoundaries_SHP[CountyBoundaries_SHP$State==input$Vis2_ZoomToState,]
      CountyChoices<-as.character(StateChoice%>%as.data.frame%>%arrange(County)%>%distinct(County)%>%pull())
      updatePickerInput(session, "Vis2_ZoomToCounty", choices=c("Statewide", CountyChoices),selected="Statewide")
    },ignoreInit=TRUE)
    
    observeEvent(c(
      input$Vis3_ZoomToState,
      input$SelectVis3=="Map"
      ),{
      StateChoice<-CountyBoundaries_SHP[CountyBoundaries_SHP$State==input$Vis3_ZoomToState,]
      CountyChoices<-as.character(StateChoice%>%as.data.frame%>%arrange(County)%>%distinct(County)%>%pull())
      updatePickerInput(session, "Vis3_ZoomToCounty", choices=c("Statewide", CountyChoices),selected="Statewide")
    },ignoreInit=TRUE)
    
    observeEvent(c(
      input$Vis4_ZoomToState,
      input$SelectVis4=="Map"
      ),{
      StateChoice<-CountyBoundaries_SHP[CountyBoundaries_SHP$State==input$Vis4_ZoomToState,]
      CountyChoices<-as.character(StateChoice%>%as.data.frame%>%arrange(County)%>%distinct(County)%>%pull())
      updatePickerInput(session, "Vis4_ZoomToCounty", choices=c("Statewide", CountyChoices),selected="Statewide")
    },ignoreInit=TRUE)
    
  observeEvent(input$DisplayCreel_Map_Vis_1, {
    shinyjs::hide("DisplayCreel_Map_Vis_1")
  },ignoreInit=TRUE)
    
  observeEvent(input$AF_VisNum_Selection, {
    shinyjs::show("DisplayCreel_Map_Vis_1")
  },ignoreInit=TRUE)

  observeEvent(input$DisplayCreel_Map_Vis_2, {
    shinyjs::hide("DisplayCreel_Map_Vis_2")
  },ignoreInit=TRUE)
    
  observeEvent(input$AF_VisNum_Selection, {
    shinyjs::show("DisplayCreel_Map_Vis_2")
  },ignoreInit=TRUE)
  
  observeEvent(input$DisplayCreel_Map_Vis_3, {
    shinyjs::hide("DisplayCreel_Map_Vis_3")
  },ignoreInit=TRUE)
    
  observeEvent(input$AF_VisNum_Selection, {
    shinyjs::show("DisplayCreel_Map_Vis_3")
  },ignoreInit=TRUE)  
  
  observeEvent(input$DisplayCreel_Map_Vis_4, {
    shinyjs::hide("DisplayCreel_Map_Vis_4")
  },ignoreInit=TRUE)
    
  observeEvent(input$AF_VisNum_Selection, {
    shinyjs::show("DisplayCreel_Map_Vis_4")
  },ignoreInit=TRUE)  
  
  
  

  
  
   #### Vis 1_1 Map ####

    
  Map_1_1_Title<-eventReactive(c(input$Map_Vis1_Title_Text),{
     PH<-input$Map_Vis1_Title_Text
     return(paste("<span style=\"color:grey50,background-color:rgba(255,255,255,0)\"><strong>",PH,"</span>"))
   })
   
   
   Data_1_1_Percentiles<-reactiveVal(NULL)
   
   observeEvent(c(
     Data_1_1(),
     input$DisplayCreel_Map_Vis_1,
     input$Vis1_MapDisplayField,
     input$Vis1_MapDisplayField_Size,
     input$AF_VisNum_Selection
   ),{
     req(input$AF_VisNum_Selection==1)
     req(length(input$Vis_1_Input_rows_selected)>0)
     req(Data_1_1())

      if(length(input$Vis_1_Input_rows_selected)>1){
       PH<-Data_1_1()%>%
        {if(input$Vis1_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis1=percent_rank(get(input$Vis1_MapDisplayField))*100) else .}%>%
        {if(input$Vis1_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis1=percent_rank(get(input$Vis1_MapDisplayField_Size))*100) else .}
    }else{
      PH<-Data_1_1()%>%
        {if(input$Vis1_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis1=50) else .}%>%
        {if(input$Vis1_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis1=50) else .}
    } 
  
      Data_1_1_Percentiles(PH)
     
   },ignoreInit=TRUE)


    Creel_SHP_Vis1_1<-eventReactive(Data_1_1_Percentiles(),{
      req(length(Data_1_1_Percentiles())>0)
      req(input$SelectVis1=="Map")
      req(input$AF_VisNum_Selection==1)
      
      sp::merge(x=CreelWaterbodies_SHP,y=Data_1_1_Percentiles(),by.x="WB_ID",by.y="WB_ID",all.x=FALSE)%>%
        st_jitter(amount=0.002)
      })

  Vis_1_1_MapSizeField<-eventReactive(input$Vis1_MapDisplayField_Size,{
    input$Vis1_MapDisplayField_Size
    })

  Vis_1_1_MapSizeMin<-eventReactive(c(input$Vis1_MapDisplayField_Size,input$Vis_1_Input_rows_selected),{
    req(length(Creel_SHP_Vis1_1())>0)
    PH<-Creel_SHP_Vis1_1()%>%
      pull(input$Vis1_MapDisplayField_Size)
      return(min(PH,na.rm=TRUE))
      })

  Vis_1_1_MapSizeMax<-eventReactive(
    c(input$Vis1_MapDisplayField_Size,input$Vis_1_Input_rows_selected),{
        req(length(Creel_SHP_Vis1_1())>0)
      PH<-Creel_SHP_Vis1_1()%>%
        pull(input$Vis1_MapDisplayField_Size)
        return(max(PH,na.rm=TRUE))
      })

  Vis_1_1_MapSizeMinPix<-eventReactive(input$Vis1_MapDisplayField_SizeSlider,{
    input$Vis1_MapDisplayField_SizeSlider[1]
    })

  Vis_1_1_MapSizeMaxPix<-eventReactive(input$Vis1_MapDisplayField_SizeSlider,{
    input$Vis1_MapDisplayField_SizeSlider[2]
    })

  Vis_1_1_MapPix_Dif<-eventReactive(c(Vis_1_1_MapSizeMaxPix(),Vis_1_1_MapSizeMinPix()),{
    Vis_1_1_MapSizeMaxPix()-Vis_1_1_MapSizeMinPix()
    })

  Vis_1_1_MapSizeDenom<-eventReactive(c(Vis_1_1_MapSizeMax(),Vis_1_1_MapSizeMin()),{
    
    req(length(Creel_SHP_Vis1_1())>0)
    
    (Vis_1_1_MapSizeMax()-Vis_1_1_MapSizeMin())
    })

  Vis_1_1_MapSizeSingle<-eventReactive(input$Vis1_MapDisplayField_SizeSliderSingle,{
    input$Vis1_MapDisplayField_SizeSliderSingle
    })

  Vis_1_1_MapColorSolid<-eventReactive(input$Vis1_MapColorSolid,{
    input$Vis1_MapColorSolid
    })

    MapVis1_1_PalRange<-reactive({
     
    req(length(Creel_SHP_Vis1_1())>0)
    
      req(input$Vis1_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis1_1()%>%
        select(input$Vis1_MapDisplayField)
      })

   MapVis1_1_PercentilesPalRange<-reactive({
      req(length(Creel_SHP_Vis1_1())>0)
      req(input$Vis1_MapDisplayField!="Nothing Selected")
      req(Creel_SHP_Vis1_1()$ColorPercentile_Vis1)
      
      Creel_SHP_Vis1_1()%>%
        select(ColorPercentile_Vis1)
      
      })


    output$MapVis1_1 <- renderLeaflet({
      MapVis1_1_Requirement<-HTML(
       "<span style=\"color:red;background-color:white\"><strong>Click 'Display Creel Data on Map' from sidebar to add your creel data to the map.</span>"
   )


      CreelMap <- leaflet()%>%
        addMapPane("SelectedWBs",zIndex=440)%>%
        addMapPane("CreelData",zIndex=430)%>%
        addMapPane("SelectedArea",zIndex=420)%>%
        addMapPane("SupplementaryData",zIndex=410)%>%
        addProviderTiles("CartoDB.DarkMatter",group="Dark")%>%
        addProviderTiles("CartoDB.Positron",group="Light")%>%
        addWMSTiles(GetURL("USGSImageryTopo"),group="Imagery Topo Hybrid",layers="0")%>%
        addWMSTiles(GetURL("USGSTopo"),group="Topo",layers="0")%>%
        addWMSTiles(GetURL("USGSImageryOnly"),group="Imagery",layers="0")%>%
        addWMSTiles(GetURL("USGSShadedReliefOnly"),group="Shaded Relief",layers="0")%>%
        addWMSTiles(GetURL("USGSHydroCached"),group="Hydrography",layers="0",options =list(format="image/png",transparent=TRUE))%>%
        addPolygons(data=StateBoundaries_SHP,
                    group="State Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 2,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=StateBoundaries_SHP$STUSPS,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE),
        )%>%
        addPolygons(data=CountyBoundaries_SHP,
                    group="County Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 1.5,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=CountyBoundaries_SHP$County_ID,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE)
        )%>%
        addLayersControl(
          baseGroups=isolate(if(input$DarkMode=='Dark'){c("Dark","Light","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}else{c("Light","Dark","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}),
          overlayGroups =c("Creel Data", "State Boundaries","County Boundaries","Hydrography"),
          options = layersControlOptions(collapsed = TRUE))%>%
        hideGroup("County Boundaries")%>%
        hideGroup("Hydrography")%>%
        addMeasure()%>%
        addMiniMap(position="bottomleft",minimized=TRUE,toggleDisplay=TRUE)%>%
        addEasyButton(easyButton(
          icon="fa-globe", title="Zoom to Level 1",
          onClick=JS("function(btn, map){ map.setZoom(3); }")))%>%
        addEasyButton(easyButton(
          icon="fa-crosshairs", title="Locate Me",
          onClick=JS("function(btn, map){ map.locate({setView: true, maxZoom: 10}); }")))%>%
        onRender(
          "function(el, x) {
            L.easyPrint({
              sizeModes: ['Current', 'A4Landscape', 'A4Portrait'],
              filename: 'MyMap',
              exportOnly: true,
              hideControlContainer: false
            }).addTo(this);
            }"
        )%>%
      addControl(MapVis1_1_Requirement,position="topright",layerId="ShowCreelMessage")
    })
    
  observeEvent(c(
    input$DarkMode,
    input$AF_VisNum_Selection
  ),{
    req(length(Creel_SHP_Vis1_1())>0)
    if(input$DarkMode=="Dark"){
      leafletProxy("MapVis1_1",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Light")%>%
        showGroup("Dark")
    }
    if(input$DarkMode=="Light"){
      leafletProxy("MapVis1_1",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Dark")%>%
        showGroup("Light")
    }
  },ignoreInit=TRUE)  

  observeEvent(c(
    MapVis1_1_SelectedWB_SHP(),
    MapVis1_1_PercentilesPalRange(),
    input$DisplayCreel_Map_Vis_1,
     input$Vis1_MapColorPalette,
     input$Vis1_Map_PalToggle,
     input$Vis1_Map_CreelColorscalePer,
     input$Vis1_MapDisplayField_SizeSlider,
     input$Vis1_MapColorSolid,
     input$Vis1_MapDisplayField_SizeSliderSingle,
     input$Vis1_Map_CreelSizescalePer,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis1_1())>0)
      req(input$Vis1_Map_CreelDisplayType)
    
      
        
      req(is.null(MapVis1_1_SelectedWB_SHP()))
      
      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }


      Vis1_Map_Popup<- if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis1_1()[[input$Vis1_MapDisplayField]],Creel_SHP_Vis1_1()$Waterbody_Name_Unique,Creel_SHP_Vis1_1()$Year,Creel_SHP_Vis1_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField_Size,Creel_SHP_Vis1_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis1_1()$Waterbody_Name_Unique,Creel_SHP_Vis1_1()$Year,Creel_SHP_Vis1_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis1_1()[[input$Vis1_MapDisplayField]],input$Vis1_MapDisplayField_Size,Creel_SHP_Vis1_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis1_1()$Waterbody_Name_Unique,Creel_SHP_Vis1_1()$Year,Creel_SHP_Vis1_1()$Survey_ID)%>% lapply(htmltools::HTML)
      }

        pal <- colorNumeric(input$Vis1_MapColorPalette,MapVis1_1_PalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
        pal2 <-colorNumeric(input$Vis1_MapColorPalette,MapVis1_1_PercentilesPalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
        
       leafletProxy("MapVis1_1",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis1_1(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis1_1()$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 1,
                fillOpacity=1,
                stroke=FALSE,
                fillColor =if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){Vis_1_1_MapColorSolid()}else{if(input$Vis1_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis1_MapDisplayField))}else{~pal2(ColorPercentile_Vis1)}},
                radius=if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){Vis_1_1_MapSizeSingle()}else{if(input$Vis1_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis1_MapDisplayField_Size)-Vis_1_1_MapSizeMin())*Vis_1_1_MapPix_Dif())/Vis_1_1_MapSizeDenom())+Vis_1_1_MapSizeMinPix()))}else{~(((SizePercentile_Vis1*Vis_1_1_MapPix_Dif())/100)+Vis_1_1_MapSizeMinPix())}},
               label=Vis1_Map_Popup
      )

      },ignoreInit=TRUE)

  observeEvent(c(
    MapVis1_1_SelectedWB_SHP(),
    input$DisplayCreel_Map_Vis_1,
    input$Vis1_MapColorPalette,
    MapVis1_1_PercentilesPalRange(),
    input$Vis1_Map_PalToggle,
    input$Vis1_Map_CreelColorscalePer,
    input$Vis1_MapDisplayField_SizeSlider,
    input$Vis1_MapColorSolid,
    input$Vis1_MapDisplayField_SizeSliderSingle,
    input$Vis1_Map_CreelSizescalePer,
    input$Vis1_FillOpacity,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis1_1())>0)
      req(input$Vis1_Map_CreelDisplayType)
      req(!is.null(MapVis1_1_SelectedWB_SHP()))

      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }


      Vis1_Map_Popup<- if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis1_1()[[input$Vis1_MapDisplayField]],Creel_SHP_Vis1_1()$Waterbody_Name_Unique,Creel_SHP_Vis1_1()$Year,Creel_SHP_Vis1_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField_Size,Creel_SHP_Vis1_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis1_1()$Waterbody_Name_Unique,Creel_SHP_Vis1_1()$Year,Creel_SHP_Vis1_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis1_1()[[input$Vis1_MapDisplayField]],input$Vis1_MapDisplayField_Size,Creel_SHP_Vis1_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis1_1()$Waterbody_Name_Unique,Creel_SHP_Vis1_1()$Year,Creel_SHP_Vis1_1()$Survey_ID)%>% lapply(htmltools::HTML)
      }
      
    Vis1_Map_Popup_Sel<-if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,MapVis1_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField]],MapVis1_1_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis1_1_SelectedWB_SHP()$Year,MapVis1_1_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField_Size,MapVis1_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField_Size]],MapVis1_1_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis1_1_SelectedWB_SHP()$Year,MapVis1_1_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,MapVis1_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField]],input$Vis1_MapDisplayField_Size,MapVis1_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField_Size]],MapVis1_1_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis1_1_SelectedWB_SHP()$Year,MapVis1_1_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      }
    

      pal <- colorNumeric(input$Vis1_MapColorPalette,MapVis1_1_PalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
      pal2 <-colorNumeric(input$Vis1_MapColorPalette,MapVis1_1_PercentilesPalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
        
       leafletProxy("MapVis1_1",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
            addCircleMarkers(
              data=Creel_SHP_Vis1_1(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis1_1()$FID),
                options=pathOptions(pane="CreelData"),
                fillOpacity=input$Vis1_FillOpacity,
                stroke=FALSE,
                fillColor =if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){Vis_1_1_MapColorSolid()}else{if(input$Vis1_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis1_MapDisplayField))}else{~pal2(ColorPercentile_Vis1)}},
                radius=if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){Vis_1_1_MapSizeSingle()}else{if(input$Vis1_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis1_MapDisplayField_Size)-Vis_1_1_MapSizeMin())*Vis_1_1_MapPix_Dif())/Vis_1_1_MapSizeDenom())+Vis_1_1_MapSizeMinPix()))}else{~(((SizePercentile_Vis1*Vis_1_1_MapPix_Dif())/100)+Vis_1_1_MapSizeMinPix())}},
               label=Vis1_Map_Popup
          )%>%
            addCircleMarkers(data=MapVis1_1_SelectedWB_SHP(),
                             group='Selected Waterbodies',
                             stroke=FALSE,
                             fillOpacity=1,
                    fillColor =if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){Vis_1_1_MapColorSolid()}else{if(input$Vis1_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis1_MapDisplayField))}else{~pal2(ColorPercentile_Vis1)}},
                    radius=if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){Vis_1_1_MapSizeSingle()}else{if(input$Vis1_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis1_MapDisplayField_Size)-Vis_1_1_MapSizeMin())*Vis_1_1_MapPix_Dif())/Vis_1_1_MapSizeDenom())+Vis_1_1_MapSizeMinPix()))}else{~(((SizePercentile_Vis1*Vis_1_1_MapPix_Dif())/100)+Vis_1_1_MapSizeMinPix())}},
                   label=Vis1_Map_Popup_Sel,
                             options=pathOptions(pane="SelectedWBs"))

      },ignoreInit=TRUE )
  

    observeEvent(c(
      input$DisplayCreel_Map_Vis_1,
      input$Vis1_Map_CreelDisplayType,
      input$Vis1_AddLegend_Switch,
      input$Vis1_MapColorPalette,
      MapVis1_1_PercentilesPalRange(),
      input$Vis1_Map_PalToggle,
      input$Vis1_Map_CreelColorscalePer,
      input$AF_VisNum_Selection,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis1_1())>0)
      req(input$Vis1_Map_CreelDisplayType)
      req(length(input$Vis_1_Input_rows_selected)>0)


      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }


      if(input$Vis1_AddLegend_Switch=="Yes"&&(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both")){
        Vis1_Feature<-input$Vis1_MapDisplayField
         pal <- colorNumeric(input$Vis1_MapColorPalette,MapVis1_1_PalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis1_MapColorPalette,MapVis1_1_PercentilesPalRange()[[1]],reverse=input$Vis1_Map_PalToggle)

      leafletProxy("MapVis1_1",session)%>%
          removeControl(layerId="Legend")%>%
          addLegend("bottomright",
                pal = if(input$Vis1_Map_CreelColorscalePer=="Values"){pal}else{pal2},
                values=if(input$Vis1_Map_CreelColorscalePer=="Values"){Creel_SHP_Vis1_1()[[Vis1_Feature]]}else{c(0:100)},
                title=if(input$Vis1_Map_CreelColorscalePer=="Values"){paste(Vis1_Feature)}else{paste(Vis1_Feature,"</br>Percentile")},
                group= "CreelCat Data",
                layerId="Legend",
                opacity = 1)
      }else if(input$Vis1_AddLegend_Switch=="No"||input$Vis1_Map_CreelDisplayType=="Scaled Size"){
        leafletProxy("MapVis1_1",session)%>%
          removeControl(layerId="Legend")
      }
    },ignoreInit=TRUE)

    observeEvent(c(
      input$Vis1_CreelExtentZoomBTN,
      input$AF_VisNum_Selection,
      input$DisplayCreel_Map_Vis_1,
      Creel_SHP_Vis1_1(),
    input$AF_VisNum_Selection
    ),{
      req(input$Vis1_Map_CreelDisplayType)
      req(length(Creel_SHP_Vis1_1())>0)
    

      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }

       CreelBounds<- st_bbox(Creel_SHP_Vis1_1())%>%as.vector()
        leafletProxy("MapVis1_1",session)%>%
          fitBounds(CreelBounds[1], CreelBounds[2], CreelBounds[3], CreelBounds[4])
    },ignoreInit=TRUE)


    observeEvent({
      input$Vis1_GeographyZoomBTN
    },{
      if(input$Vis1_ZoomToCounty=="Statewide"){
        SelectedStateBounds<-st_bbox(StateBoundaries_SHP[StateBoundaries_SHP$NAME==input$Vis1_ZoomToState,])%>%as.vector()
        leafletProxy("MapVis1_1",session)%>%
          fitBounds(SelectedStateBounds[1], SelectedStateBounds[2], SelectedStateBounds[3], SelectedStateBounds[4])
      }
      if(input$Vis1_ZoomToCounty!="Statewide"){
        SelectedCountyBounds<-st_bbox(CountyBoundaries_SHP%>%filter(State==input$Vis1_ZoomToState & County==input$Vis1_ZoomToCounty))%>%as.vector()
        leafletProxy("MapVis1_1",session)%>%
          fitBounds(SelectedCountyBounds[1], SelectedCountyBounds[2], SelectedCountyBounds[3], SelectedCountyBounds[4])
      }},ignoreInit=TRUE)

    observeEvent(c(
      input$Map_Vis1_Title_Text,
      input$Map_Vis1_Title_Switch
    ),{
      req(length(Creel_SHP_Vis1_1())>0)
      if(input$Map_Vis1_Title_Switch=="Yes"){
        leafletProxy("MapVis1_1",session)%>%
         removeControl(layerId="Map1_1_Title")%>%
          addControl(Map_1_1_Title(),position=c("bottomright"),layerId="Map1_1_Title")
      }else if(input$Map_Vis1_Title_Switch=="No"){
        leafletProxy("MapVis1_1",session)%>%
         removeControl(layerId="Map1_1_Title")
      }
    },ignoreInit=TRUE)
    


  MapVis1_1_SelectedWB_SHP<-reactiveVal(NULL)

  MapVis1_1_area<-reactiveValues()
  Poly_SHP_MapVis1_1<-reactiveVal()

observeEvent(input$MapVis1_1_click, {
  req(input$Vis1_SelectType=="Polygon")
  req(input$Vis1_SelectPolygon=="Draw")

    coords <- input$MapVis1_1_click
    cm <- matrix(data = c(coords$lat, coords$lng), nrow = 1, ncol = 2)
    MapVis1_1_area$mp <- if(!is.null(MapVis1_1_area$mp)){rbind(MapVis1_1_area$mp, cm)}else{cm}

    leafletProxy("MapVis1_1")%>%
      clearGroup("Polygon Draw")%>%
      addPolygons(lat = MapVis1_1_area$mp[ , 1], lng = MapVis1_1_area$mp[ , 2],color="red",fillOpacity=0,group='Polygon Draw',
          options=pathOptions(pane="SelectedArea"))

},ignoreInit=TRUE)

observeEvent(input$Vis1_SelectPolygon, {

  req(input$Vis1_SelectType=="Polygon")
  req(length(MapVis1_1_area$mp)>5)
  req(input$Vis1_SelectPolygon=="Complete")

  Sel_MapVis1_1_area<-as.data.frame(MapVis1_1_area$mp)%>%
    rename(lat=1)%>%
    rename(lng=2)


 Poly_SHP_MapVis1_1(
    polygon_MapVis1_1<-Sel_MapVis1_1_area%>%
  st_as_sf(coords = c("lng", "lat"), crs = 4326)%>%
  summarise(geometry = st_combine(geometry))%>%
  st_cast("POLYGON")
 )
 
 PolyPoints<-Creel_SHP_Vis1_1()%>%
                  filter(st_intersects(.,Poly_SHP_MapVis1_1(),sparse=FALSE)[,1])
 
  MapVis1_1_SelectedWB_SHP(PolyPoints)

},ignoreInit=TRUE)

observeEvent(input$Vis1_SelectPolygon,{

  req(input$Vis1_SelectPolygon=="Clear")
  req(input$Vis1_SelectType=="Polygon")

  Sel_SurveysScatter_Vis_1_1_UL(NULL) 
  MapVis1_1_area$mp<-NULL
  Poly_SHP_MapVis1_1(NULL)
  Sel_SurveysMap_Vis_1_1_UL(NULL)
  Sel_SurveysAll_Vis_1_1_UL(NULL)
  MapVis1_1_SelectedWB_SHP(NULL)

},ignoreInit=TRUE)

State_Clicks_MapVis1_1<-reactiveVal()
SelStatePoly_SHP_MapVis1_1<-reactiveVal()
SelStatePoints_SHP_MapVis1_1<-reactiveVal()
SelStates_Filtered_MapVis1_1<-reactiveVal()

observeEvent(input$MapVis1_1_click, {

  req(input$Vis1_SelectType=="States")
  req(input$Vis1_SelectState=="Select")

      click <- input$MapVis1_1_shape_click

      State_Clicks_MapVis1_1(list(c(State_Clicks_MapVis1_1(),click$id)))

    SelStates_df<-as.data.frame(State_Clicks_MapVis1_1())


    Selected_States_Vector<-as.character(SelStates_df[1,])


    PH<-StateBoundaries_SHP%>%
      filter(., STUSPS %in% Selected_States_Vector)

    SelStates_Filtered_MapVis1_1(PH)


    leafletProxy("MapVis1_1")%>%
      clearGroup("Selected States")%>%
      addPolygons(data=SelStates_Filtered_MapVis1_1(),color="red",weight=3,fillOpacity=0,group='Selected States',
          options=pathOptions(pane="SelectedArea"))
  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectState, {

  req(input$Vis1_SelectType=="States")
  req(input$Vis1_SelectState=="Complete")
  req(!is.null(SelStates_Filtered_MapVis1_1()))

    SelStatePoly_SHP_MapVis1_1(SelStates_Filtered_MapVis1_1())

    State_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis1_1(),SelStatePoly_SHP_MapVis1_1(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    State_Intersects2<-State_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      State_Intersects3<-Creel_SHP_Vis1_1()%>%slice(as.numeric(row.names(State_Intersects2)))

       MapVis1_1_SelectedWB_SHP(State_Intersects3)


  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectState, {
  req(input$Vis1_SelectType=="States")
  req(input$Vis1_SelectState=="Clear")
  

  Sel_SurveysScatter_Vis_1_1_UL(NULL) 
  MapVis1_1_SelectedWB_SHP(NULL) 

    SelStatePoly_SHP_MapVis1_1(NULL)

    State_Clicks_MapVis1_1(NULL)
    SelStates_Filtered_MapVis1_1(NULL)
    SelStatePoints_SHP_MapVis1_1(NULL)
    Sel_SurveysMap_Vis_1_1_UL(NULL)
    Sel_SurveysAll_Vis_1_1_UL(NULL)

  
  },ignoreInit=TRUE)


observeEvent(input$Vis1_SelectType, {

  req(input$Vis1_SelectType=="States")

    leafletProxy("MapVis1_1")%>%
      hideGroup("County Boundaries")%>%
      showGroup("State Boundaries")
},ignoreInit=TRUE)

observeEvent(input$Vis1_SelectType, {

  req(input$Vis1_SelectType=="Counties")

    leafletProxy("MapVis1_1")%>%
      hideGroup("State Boundaries")%>%
      showGroup("County Boundaries")
},ignoreInit=TRUE)


County_Clicks_MapVis1_1<-reactiveVal()
SelCountyPoly_SHP_MapVis1_1<-reactiveVal()
SelCountyPoints_SHP_MapVis1_1<-reactiveVal()
SelCounties_Filtered_MapVis1_1<-reactiveVal()

observeEvent(input$MapVis1_1_click, {

  req(input$Vis1_SelectType=="Counties")
  req(input$Vis1_SelectCounty=="Select")

      click <- input$MapVis1_1_shape_click

      County_Clicks_MapVis1_1(list(c(County_Clicks_MapVis1_1(),click$id)))

    SelCounties_df<-as.data.frame(County_Clicks_MapVis1_1())


    Selected_Counties_Vector<-as.character(SelCounties_df[1,])


    PH<-CountyBoundaries_SHP%>%
      filter(., County_ID %in% Selected_Counties_Vector)

    SelCounties_Filtered_MapVis1_1(PH)

    leafletProxy("MapVis1_1")%>%
      clearGroup("Selected Counties")%>%
      addPolygons(data=SelCounties_Filtered_MapVis1_1(),color="red",weight=3,fillOpacity=0,group='Selected Counties',
          options=pathOptions(pane="SelectedArea"))
  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectCounty, {

  req(input$Vis1_SelectType=="Counties")
  req(input$Vis1_SelectCounty=="Complete")
  req(!is.null(SelCounties_Filtered_MapVis1_1()))



    SelCountyPoly_SHP_MapVis1_1(SelCounties_Filtered_MapVis1_1())

    County_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis1_1(),SelCountyPoly_SHP_MapVis1_1(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    County_Intersects2<-County_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      County_Intersects3<-Creel_SHP_Vis1_1()%>%slice(as.numeric(row.names(County_Intersects2)))


      MapVis1_1_SelectedWB_SHP(County_Intersects3)

   
  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectCounty, {
  req(input$Vis1_SelectType=="Counties")
  req(input$Vis1_SelectCounty=="Clear")

    
    Sel_SurveysScatter_Vis_1_1_UL(NULL) 
  MapVis1_1_SelectedWB_SHP(NULL) 


    SelCountyPoly_SHP_MapVis1_1(NULL)

    County_Clicks_MapVis1_1(NULL)
    SelCounties_Filtered_MapVis1_1(NULL)
    SelCountyPoints_SHP_MapVis1_1(NULL)
    Sel_SurveysMap_Vis_1_1_UL(NULL)
    Sel_SurveysAll_Vis_1_1_UL(NULL) 


  },ignoreInit=TRUE)


    #### Vis 2_1 Map ####

    
  Map_2_1_Title<-eventReactive(c(input$Map_Vis1_Title_Text),{
     PH<-input$Map_Vis1_Title_Text
     return(paste("<span style=\"color:grey50,background-color:rgba(255,255,255,0)\"><strong>",PH,"</span>"))
   })
   
   
   Data_2_1_Complete_Percentiles<-reactiveVal(NULL)
   
   observeEvent(c(
     Data_2_1_Complete(),
     input$DisplayCreel_Map_Vis_1,
     input$Vis1_MapDisplayField,
     input$Vis1_MapDisplayField_Size,
     input$AF_VisNum_Selection
   ),{
     req(input$AF_VisNum_Selection==2)
     req(input$AF_SharedData)
     req(nrow(Data_2_1_Complete())>0)
     

      if(nrow(Data_2_1_Complete())>1){
       PH<-Data_2_1_Complete()%>%
        {if(input$Vis1_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis1=percent_rank(get(input$Vis1_MapDisplayField))*100) else .}%>%
        {if(input$Vis1_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis1=percent_rank(get(input$Vis1_MapDisplayField_Size))*100) else .}
    }else{
      PH<-Data_2_1_Complete()%>%
        {if(input$Vis1_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis1=50) else .}%>%
        {if(input$Vis1_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis1=50) else .}
    } 
      
      Data_2_1_Complete_Percentiles(PH)
     
   },ignoreInit=TRUE)


    Creel_SHP_Vis2_1<-eventReactive(Data_2_1_Complete_Percentiles(),{
      req(length(Data_2_1_Complete_Percentiles())>0)
      req(input$SelectVis1=="Map")
      req(input$AF_VisNum_Selection==2)
      
      sp::merge(x=CreelWaterbodies_SHP,y=Data_2_1_Complete_Percentiles(),by.x="WB_ID",by.y="WB_ID",all.x=FALSE)%>%
        st_jitter(amount=0.002)
      })

  Vis_2_1_MapSizeField<-eventReactive(input$Vis1_MapDisplayField_Size,{
    input$Vis1_MapDisplayField_Size
    })

  Vis_2_1_MapSizeMin<-eventReactive(c(input$Vis1_MapDisplayField_Size,input$Vis_1_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(length(Creel_SHP_Vis2_1())>0)
    PH<-Creel_SHP_Vis2_1()%>%
      pull(input$Vis1_MapDisplayField_Size)
      return(min(PH,na.rm=TRUE))
      })

  Vis_2_1_MapSizeMax<-eventReactive(
    c(input$Vis1_MapDisplayField_Size,input$Vis_1_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
        req(length(Creel_SHP_Vis2_1())>0)
      PH<-Creel_SHP_Vis2_1()%>%
        pull(input$Vis1_MapDisplayField_Size)
        return(max(PH,na.rm=TRUE))
      })

  Vis_2_1_MapSizeMinPix<-eventReactive(input$Vis1_MapDisplayField_SizeSlider,{
    input$Vis1_MapDisplayField_SizeSlider[1]
    })

  Vis_2_1_MapSizeMaxPix<-eventReactive(input$Vis1_MapDisplayField_SizeSlider,{
    input$Vis1_MapDisplayField_SizeSlider[2]
    })

  Vis_2_1_MapPix_Dif<-eventReactive(c(Vis_2_1_MapSizeMaxPix(),Vis_2_1_MapSizeMinPix()),{
    Vis_2_1_MapSizeMaxPix()-Vis_2_1_MapSizeMinPix()
    })

  Vis_2_1_MapSizeDenom<-eventReactive(c(Vis_2_1_MapSizeMax(),Vis_2_1_MapSizeMin()),{
    
    req(length(Creel_SHP_Vis2_1())>0)
    
    (Vis_2_1_MapSizeMax()-Vis_2_1_MapSizeMin())
    })

  Vis_2_1_MapSizeSingle<-eventReactive(input$Vis1_MapDisplayField_SizeSliderSingle,{
    input$Vis1_MapDisplayField_SizeSliderSingle
    })

  Vis_2_1_MapColorSolid<-eventReactive(input$Vis1_MapColorSolid,{
    input$Vis1_MapColorSolid
    })

    MapVis2_1_PalRange<-reactive({
     
    req(length(Creel_SHP_Vis2_1())>0)
    
      req(input$Vis1_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis2_1()%>%
        select(input$Vis1_MapDisplayField)
      })

   MapVis2_1_PercentilesPalRange<-reactive({
      req(length(Creel_SHP_Vis2_1())>0)
      req(Creel_SHP_Vis2_1()$ColorPercentile_Vis1)
    
      req(input$Vis1_MapDisplayField!="Nothing Selected")
      
      Creel_SHP_Vis2_1()%>%
        select(ColorPercentile_Vis1)
      
      })


    output$MapVis2_1 <- renderLeaflet({
      MapVis2_1_Requirement<-HTML(
       "<span style=\"color:red;background-color:white\"><strong>Click 'Display Creel Data on Map' from sidebar to add your creel data to the map.</span>"
   )


      CreelMap <- leaflet()%>%
        addMapPane("SelectedWBs",zIndex=440)%>%
        addMapPane("CreelData",zIndex=430)%>%
        addMapPane("SelectedArea",zIndex=420)%>%
        addMapPane("SupplementaryData",zIndex=410)%>%
        addProviderTiles("CartoDB.DarkMatter",group="Dark")%>%
        addProviderTiles("CartoDB.Positron",group="Light")%>%
        addWMSTiles(GetURL("USGSImageryTopo"),group="Imagery Topo Hybrid",layers="0")%>%
        addWMSTiles(GetURL("USGSTopo"),group="Topo",layers="0")%>%
        addWMSTiles(GetURL("USGSImageryOnly"),group="Imagery",layers="0")%>%
        addWMSTiles(GetURL("USGSShadedReliefOnly"),group="Shaded Relief",layers="0")%>%
        addWMSTiles(GetURL("USGSHydroCached"),group="Hydrography",layers="0",options =list(format="image/png",transparent=TRUE))%>%
        addPolygons(data=StateBoundaries_SHP,
                    group="State Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 2,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=StateBoundaries_SHP$STUSPS,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE),
        )%>%
        addPolygons(data=CountyBoundaries_SHP,
                    group="County Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 1.5,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=CountyBoundaries_SHP$County_ID,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE)
        )%>%
        addLayersControl(
          baseGroups=isolate(if(input$DarkMode=='Dark'){c("Dark","Light","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}else{c("Light","Dark","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}),
          overlayGroups =c("Creel Data", "State Boundaries","County Boundaries","Hydrography"),
          options = layersControlOptions(collapsed = TRUE))%>%
        hideGroup("County Boundaries")%>%
        hideGroup("Hydrography")%>%
        addMeasure()%>%
        addMiniMap(position="bottomleft",minimized=TRUE,toggleDisplay=TRUE)%>%
        addEasyButton(easyButton(
          icon="fa-globe", title="Zoom to Level 1",
          onClick=JS("function(btn, map){ map.setZoom(3); }")))%>%
        addEasyButton(easyButton(
          icon="fa-crosshairs", title="Locate Me",
          onClick=JS("function(btn, map){ map.locate({setView: true, maxZoom: 10}); }")))%>%
        onRender(
          "function(el, x) {
            L.easyPrint({
              sizeModes: ['Current', 'A4Landscape', 'A4Portrait'],
              filename: 'MyMap',
              exportOnly: true,
              hideControlContainer: false
            }).addTo(this);
            }"
        )%>%
      addControl(MapVis2_1_Requirement,position="topright",layerId="ShowCreelMessage")
    })
    
  observeEvent(c(
    input$DarkMode,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
  ),{
    req(length(Creel_SHP_Vis2_1())>0)
    if(input$DarkMode=="Dark"){
      leafletProxy("MapVis2_1",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Light")%>%
        showGroup("Dark")
    }
    if(input$DarkMode=="Light"){
      leafletProxy("MapVis2_1",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Dark")%>%
        showGroup("Light")
    }
  },ignoreInit=TRUE)  

  observeEvent(c(
    MapVis2_1_SelectedWB_SHP(),
    MapVis2_1_PercentilesPalRange(),
    input$DisplayCreel_Map_Vis_1,
     input$Vis1_MapColorPalette,
     input$Vis1_Map_PalToggle,
     input$Vis1_Map_CreelColorscalePer,
     input$Vis1_MapDisplayField_SizeSlider,
     input$Vis1_MapColorSolid,
     input$Vis1_MapDisplayField_SizeSliderSingle,
     input$Vis1_Map_CreelSizescalePer,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis2_1())>0)
      req(input$Vis1_Map_CreelDisplayType)
    
      
        
      req(is.null(MapVis2_1_SelectedWB_SHP()))
      
      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }


      Vis1_Map_Popup<- if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis2_1()[[input$Vis1_MapDisplayField]],Creel_SHP_Vis2_1()$Waterbody_Name_Unique,Creel_SHP_Vis2_1()$Year,Creel_SHP_Vis2_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField_Size,Creel_SHP_Vis2_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis2_1()$Waterbody_Name_Unique,Creel_SHP_Vis2_1()$Year,Creel_SHP_Vis2_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis2_1()[[input$Vis1_MapDisplayField]],input$Vis1_MapDisplayField_Size,Creel_SHP_Vis2_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis2_1()$Waterbody_Name_Unique,Creel_SHP_Vis2_1()$Year,Creel_SHP_Vis2_1()$Survey_ID)%>% lapply(htmltools::HTML)
      }

        pal <- colorNumeric(input$Vis1_MapColorPalette,MapVis2_1_PalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
        pal2 <-colorNumeric(input$Vis1_MapColorPalette,MapVis2_1_PercentilesPalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
        
       leafletProxy("MapVis2_1",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis2_1(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis2_1()$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 1,
                fillOpacity=1,
                stroke=FALSE,
                fillColor =if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){Vis_2_1_MapColorSolid()}else{if(input$Vis1_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis1_MapDisplayField))}else{~pal2(ColorPercentile_Vis1)}},
                radius=if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){Vis_2_1_MapSizeSingle()}else{if(input$Vis1_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis1_MapDisplayField_Size)-Vis_2_1_MapSizeMin())*Vis_2_1_MapPix_Dif())/Vis_2_1_MapSizeDenom())+Vis_2_1_MapSizeMinPix()))}else{~(((SizePercentile_Vis1*Vis_2_1_MapPix_Dif())/100)+Vis_2_1_MapSizeMinPix())}},
               label=Vis1_Map_Popup
      )

      },ignoreInit=TRUE)

  observeEvent(c(
    MapVis2_1_SelectedWB_SHP(),
    input$DisplayCreel_Map_Vis_1,
    input$Vis1_MapColorPalette,
    MapVis2_1_PercentilesPalRange(),
    input$Vis1_Map_PalToggle,
    input$Vis1_Map_CreelColorscalePer,
    input$Vis1_MapDisplayField_SizeSlider,
    input$Vis1_MapColorSolid,
    input$Vis1_MapDisplayField_SizeSliderSingle,
    input$Vis1_Map_CreelSizescalePer,
    input$Vis1_FillOpacity,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis2_1())>0)
      req(input$Vis1_Map_CreelDisplayType)
      req(!is.null(MapVis2_1_SelectedWB_SHP()))

      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }


      Vis1_Map_Popup<- if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis2_1()[[input$Vis1_MapDisplayField]],Creel_SHP_Vis2_1()$Waterbody_Name_Unique,Creel_SHP_Vis2_1()$Year,Creel_SHP_Vis2_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField_Size,Creel_SHP_Vis2_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis2_1()$Waterbody_Name_Unique,Creel_SHP_Vis2_1()$Year,Creel_SHP_Vis2_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis2_1()[[input$Vis1_MapDisplayField]],input$Vis1_MapDisplayField_Size,Creel_SHP_Vis2_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis2_1()$Waterbody_Name_Unique,Creel_SHP_Vis2_1()$Year,Creel_SHP_Vis2_1()$Survey_ID)%>% lapply(htmltools::HTML)
      }
      
    Vis1_Map_Popup_Sel<-if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,MapVis2_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField]],MapVis2_1_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis2_1_SelectedWB_SHP()$Year,MapVis2_1_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField_Size,MapVis2_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField_Size]],MapVis2_1_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis2_1_SelectedWB_SHP()$Year,MapVis2_1_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,MapVis2_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField]],input$Vis1_MapDisplayField_Size,MapVis2_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField_Size]],MapVis2_1_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis2_1_SelectedWB_SHP()$Year,MapVis2_1_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      }
    

      pal <- colorNumeric(input$Vis1_MapColorPalette,MapVis2_1_PalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
      pal2 <-colorNumeric(input$Vis1_MapColorPalette,MapVis2_1_PercentilesPalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
        
       leafletProxy("MapVis2_1",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
            addCircleMarkers(
              data=Creel_SHP_Vis2_1(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis2_1()$FID),
                options=pathOptions(pane="CreelData"),
                fillOpacity=input$Vis1_FillOpacity,
                stroke=FALSE,
                fillColor =if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){Vis_2_1_MapColorSolid()}else{if(input$Vis1_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis1_MapDisplayField))}else{~pal2(ColorPercentile_Vis1)}},
                radius=if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){Vis_2_1_MapSizeSingle()}else{if(input$Vis1_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis1_MapDisplayField_Size)-Vis_2_1_MapSizeMin())*Vis_2_1_MapPix_Dif())/Vis_2_1_MapSizeDenom())+Vis_2_1_MapSizeMinPix()))}else{~(((SizePercentile_Vis1*Vis_2_1_MapPix_Dif())/100)+Vis_2_1_MapSizeMinPix())}},
               label=Vis1_Map_Popup
          )%>%
            addCircleMarkers(data=MapVis2_1_SelectedWB_SHP(),
                             group='Selected Waterbodies',
                             stroke=FALSE,
                             fillOpacity=1,
                    fillColor =if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){Vis_2_1_MapColorSolid()}else{if(input$Vis1_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis1_MapDisplayField))}else{~pal2(ColorPercentile_Vis1)}},
                    radius=if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){Vis_2_1_MapSizeSingle()}else{if(input$Vis1_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis1_MapDisplayField_Size)-Vis_2_1_MapSizeMin())*Vis_2_1_MapPix_Dif())/Vis_2_1_MapSizeDenom())+Vis_2_1_MapSizeMinPix()))}else{~(((SizePercentile_Vis1*Vis_2_1_MapPix_Dif())/100)+Vis_2_1_MapSizeMinPix())}},
                   label=Vis1_Map_Popup_Sel,
                             options=pathOptions(pane="SelectedWBs"))

      },ignoreInit=TRUE)
  

    observeEvent(c(
      input$DisplayCreel_Map_Vis_1,
      input$Vis1_Map_CreelDisplayType,
      input$Vis1_AddLegend_Switch,
      input$Vis1_MapColorPalette,
      MapVis2_1_PercentilesPalRange(),
      input$Vis1_Map_PalToggle,
      input$Vis1_Map_CreelColorscalePer,
      input$AF_LinkedSelection,
      input$AF_SharedData,
      input$AF_VisNum_Selection,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis2_1())>0)
      req(input$Vis1_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_1_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})


      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }


      if(input$Vis1_AddLegend_Switch=="Yes"&&(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both")){
        Vis1_Feature<-input$Vis1_MapDisplayField
         pal <- colorNumeric(input$Vis1_MapColorPalette,MapVis2_1_PalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis1_MapColorPalette,MapVis2_1_PercentilesPalRange()[[1]],reverse=input$Vis1_Map_PalToggle)

      leafletProxy("MapVis2_1",session)%>%
          removeControl(layerId="Legend")%>%
          addLegend("bottomright",
                pal = if(input$Vis1_Map_CreelColorscalePer=="Values"){pal}else{pal2},
                values=if(input$Vis1_Map_CreelColorscalePer=="Values"){Creel_SHP_Vis2_1()[[Vis1_Feature]]}else{c(0:100)},
                title=if(input$Vis1_Map_CreelColorscalePer=="Values"){paste(Vis1_Feature)}else{paste(Vis1_Feature,"</br>Percentile")},
                group= "CreelCat Data",
                layerId="Legend",
                opacity = 1)
      }else if(input$Vis1_AddLegend_Switch=="No"||input$Vis1_Map_CreelDisplayType=="Scaled Size"){
        leafletProxy("MapVis2_1",session)%>%
          removeControl(layerId="Legend")
      }
    },ignoreInit=TRUE)

    observeEvent(c(
      input$Vis1_CreelExtentZoomBTN,
      input$AF_VisNum_Selection,
      input$DisplayCreel_Map_Vis_1,
      Creel_SHP_Vis2_1(),
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(input$Vis1_Map_CreelDisplayType)
      req(length(Creel_SHP_Vis2_1())>0)
    

      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }

       CreelBounds<- st_bbox(Creel_SHP_Vis2_1())%>%as.vector()
        leafletProxy("MapVis2_1",session)%>%
          fitBounds(CreelBounds[1], CreelBounds[2], CreelBounds[3], CreelBounds[4])
    },ignoreInit=TRUE)


    observeEvent({
      input$Vis1_GeographyZoomBTN
    },{
      if(input$Vis1_ZoomToCounty=="Statewide"){
        SelectedStateBounds<-st_bbox(StateBoundaries_SHP[StateBoundaries_SHP$NAME==input$Vis1_ZoomToState,])%>%as.vector()
        leafletProxy("MapVis2_1",session)%>%
          fitBounds(SelectedStateBounds[1], SelectedStateBounds[2], SelectedStateBounds[3], SelectedStateBounds[4])
      }
      if(input$Vis1_ZoomToCounty!="Statewide"){
        SelectedCountyBounds<-st_bbox(CountyBoundaries_SHP%>%filter(State==input$Vis1_ZoomToState & County==input$Vis1_ZoomToCounty))%>%as.vector()
        leafletProxy("MapVis2_1",session)%>%
          fitBounds(SelectedCountyBounds[1], SelectedCountyBounds[2], SelectedCountyBounds[3], SelectedCountyBounds[4])
      }},ignoreInit=TRUE)

    observeEvent(c(
      input$Map_Vis1_Title_Text,
      input$Map_Vis1_Title_Switch
    ),{
      req(length(Creel_SHP_Vis2_1())>0)
      if(input$Map_Vis1_Title_Switch=="Yes"){
        leafletProxy("MapVis2_1",session)%>%
         removeControl(layerId="Map2_1_Title")%>%
          addControl(Map_2_1_Title(),position=c("bottomright"),layerId="Map2_1_Title")
      }else if(input$Map_Vis1_Title_Switch=="No"){
        leafletProxy("MapVis2_1",session)%>%
         removeControl(layerId="Map2_1_Title")
      }
    },ignoreInit=TRUE)
    


  MapVis2_1_SelectedWB_SHP<-reactiveVal(NULL)

  MapVis2_1_area<-reactiveValues()
  Poly_SHP_MapVis2_1<-reactiveVal()

observeEvent(input$MapVis2_1_click, {
  req(input$Vis1_SelectType=="Polygon")
  req(input$Vis1_SelectPolygon=="Draw")

    coords <- input$MapVis2_1_click
    cm <- matrix(data = c(coords$lat, coords$lng), nrow = 1, ncol = 2)
    MapVis2_1_area$mp <- if(!is.null(MapVis2_1_area$mp)){rbind(MapVis2_1_area$mp, cm)}else{cm}

    leafletProxy("MapVis2_1")%>%
      clearGroup("Polygon Draw")%>%
      addPolygons(lat = MapVis2_1_area$mp[ , 1], lng = MapVis2_1_area$mp[ , 2],color="red",fillOpacity=0,group='Polygon Draw',
          options=pathOptions(pane="SelectedArea"))

},ignoreInit=TRUE)

observeEvent(input$Vis1_SelectPolygon, {

  req(input$Vis1_SelectType=="Polygon")
  req(length(MapVis2_1_area$mp)>5)
  req(input$Vis1_SelectPolygon=="Complete")

  Sel_MapVis2_1_area<-as.data.frame(MapVis2_1_area$mp)%>%
    rename(lat=1)%>%
    rename(lng=2)


 Poly_SHP_MapVis2_1(
    polygon_MapVis2_1<-Sel_MapVis2_1_area%>%
  st_as_sf(coords = c("lng", "lat"), crs = 4326)%>%
  summarise(geometry = st_combine(geometry))%>%
  st_cast("POLYGON")
 )
 
 PolyPoints<-Creel_SHP_Vis2_1()%>%
                  filter(st_intersects(.,Poly_SHP_MapVis2_1(),sparse=FALSE)[,1])
 
  MapVis2_1_SelectedWB_SHP(PolyPoints)

},ignoreInit=TRUE)

observeEvent(input$Vis1_SelectPolygon,{

  req(input$Vis1_SelectPolygon=="Clear")
  req(input$Vis1_SelectType=="Polygon")
  
  HighlightTrace_2Vis(NULL)
  All_SelectedWB_2Vis(NULL)
  Data_2_1_Selected(NULL)
  Sel_SurveysScatter_Vis_2_1_UL(NULL) 
  HighlightTrace_Vis_2_1(NULL) 
  MapVis2_1_area$mp<-NULL
  Poly_SHP_MapVis2_1(NULL)
  Sel_SurveysMap_Vis_2_1_UL(NULL)
  Sel_SurveysAll_Vis_2_1_UL(NULL)
  MapVis2_1_SelectedWB_SHP(NULL)

},ignoreInit=TRUE)

State_Clicks_MapVis2_1<-reactiveVal()
SelStatePoly_SHP_MapVis2_1<-reactiveVal()
SelStatePoints_SHP_MapVis2_1<-reactiveVal()
SelStates_Filtered_MapVis2_1<-reactiveVal()

observeEvent(input$MapVis2_1_click, {

  req(input$Vis1_SelectType=="States")
  req(input$Vis1_SelectState=="Select")

      click <- input$MapVis2_1_shape_click

      State_Clicks_MapVis2_1(list(c(State_Clicks_MapVis2_1(),click$id)))

    SelStates_df<-as.data.frame(State_Clicks_MapVis2_1())


    Selected_States_Vector<-as.character(SelStates_df[1,])


    PH<-StateBoundaries_SHP%>%
      filter(., STUSPS %in% Selected_States_Vector)

    SelStates_Filtered_MapVis2_1(PH)


    leafletProxy("MapVis2_1")%>%
      clearGroup("Selected States")%>%
      addPolygons(data=SelStates_Filtered_MapVis2_1(),color="red",weight=3,fillOpacity=0,group='Selected States',
          options=pathOptions(pane="SelectedArea"))
  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectState, {

  req(input$Vis1_SelectType=="States")
  req(input$Vis1_SelectState=="Complete")
  req(!is.null(SelStates_Filtered_MapVis2_1()))

    SelStatePoly_SHP_MapVis2_1(SelStates_Filtered_MapVis2_1())

    State_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis2_1(),SelStatePoly_SHP_MapVis2_1(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    State_Intersects2<-State_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      State_Intersects3<-Creel_SHP_Vis2_1()%>%slice(as.numeric(row.names(State_Intersects2)))

       MapVis2_1_SelectedWB_SHP(State_Intersects3)


  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectState, {
  req(input$Vis1_SelectType=="States")
  req(input$Vis1_SelectState=="Clear")
  
  HighlightTrace_2Vis(NULL)
  All_SelectedWB_2Vis(NULL)
  Data_2_1_Selected(NULL)
  Sel_SurveysScatter_Vis_2_1_UL(NULL) 
  HighlightTrace_Vis_2_1(NULL)
  MapVis2_1_SelectedWB_SHP(NULL) 

    SelStatePoly_SHP_MapVis2_1(NULL)

    State_Clicks_MapVis2_1(NULL)
    SelStates_Filtered_MapVis2_1(NULL)
    SelStatePoints_SHP_MapVis2_1(NULL)
    Sel_SurveysMap_Vis_2_1_UL(NULL)
    Sel_SurveysAll_Vis_2_1_UL(NULL)

  
  },ignoreInit=TRUE)


observeEvent(input$Vis1_SelectType, {

  req(input$Vis1_SelectType=="States")

    leafletProxy("MapVis2_1")%>%
      hideGroup("County Boundaries")%>%
      showGroup("State Boundaries")
},ignoreInit=TRUE)

observeEvent(input$Vis1_SelectType, {

  req(input$Vis1_SelectType=="Counties")

    leafletProxy("MapVis2_1")%>%
      hideGroup("State Boundaries")%>%
      showGroup("County Boundaries")
},ignoreInit=TRUE)


County_Clicks_MapVis2_1<-reactiveVal()
SelCountyPoly_SHP_MapVis2_1<-reactiveVal()
SelCountyPoints_SHP_MapVis2_1<-reactiveVal()
SelCounties_Filtered_MapVis2_1<-reactiveVal()

observeEvent(input$MapVis2_1_click, {

  req(input$Vis1_SelectType=="Counties")
  req(input$Vis1_SelectCounty=="Select")

      click <- input$MapVis2_1_shape_click

      County_Clicks_MapVis2_1(list(c(County_Clicks_MapVis2_1(),click$id)))

    SelCounties_df<-as.data.frame(County_Clicks_MapVis2_1())


    Selected_Counties_Vector<-as.character(SelCounties_df[1,])


    PH<-CountyBoundaries_SHP%>%
      filter(., County_ID %in% Selected_Counties_Vector)

    SelCounties_Filtered_MapVis2_1(PH)

    leafletProxy("MapVis2_1")%>%
      clearGroup("Selected Counties")%>%
      addPolygons(data=SelCounties_Filtered_MapVis2_1(),color="red",weight=3,fillOpacity=0,group='Selected Counties',
          options=pathOptions(pane="SelectedArea"))
  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectCounty, {

  req(input$Vis1_SelectType=="Counties")
  req(input$Vis1_SelectCounty=="Complete")
  req(!is.null(SelCounties_Filtered_MapVis2_1()))



    SelCountyPoly_SHP_MapVis2_1(SelCounties_Filtered_MapVis2_1())

    County_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis2_1(),SelCountyPoly_SHP_MapVis2_1(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    County_Intersects2<-County_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      County_Intersects3<-Creel_SHP_Vis2_1()%>%slice(as.numeric(row.names(County_Intersects2)))


      MapVis2_1_SelectedWB_SHP(County_Intersects3)

   
  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectCounty, {
  req(input$Vis1_SelectType=="Counties")
  req(input$Vis1_SelectCounty=="Clear")

    HighlightTrace_2Vis(NULL)
    All_SelectedWB_2Vis(NULL)
    Data_2_1_Selected(NULL)
    Sel_SurveysScatter_Vis_2_1_UL(NULL) 
    HighlightTrace_Vis_2_1(NULL)
  MapVis2_1_SelectedWB_SHP(NULL) 


    SelCountyPoly_SHP_MapVis2_1(NULL)

    County_Clicks_MapVis2_1(NULL)
    SelCounties_Filtered_MapVis2_1(NULL)
    SelCountyPoints_SHP_MapVis2_1(NULL)
    Sel_SurveysMap_Vis_2_1_UL(NULL)
    Sel_SurveysAll_Vis_2_1_UL(NULL) 


  },ignoreInit=TRUE)

    #### Vis 3_1 Map ####

    
  Map_3_1_Title<-eventReactive(c(input$Map_Vis1_Title_Text),{
     PH<-input$Map_Vis1_Title_Text
     return(paste("<span style=\"color:grey50,background-color:rgba(255,255,255,0)\"><strong>",PH,"</span>"))
   })
   
   
   Data_3_1_Complete_Percentiles<-reactiveVal(NULL)
   
   observeEvent(c(
     Data_3_1_Complete(),
     input$DisplayCreel_Map_Vis_1,
     input$Vis1_MapDisplayField,
     input$Vis1_MapDisplayField_Size,
     input$AF_VisNum_Selection
   ),{
     req(input$AF_VisNum_Selection==3)
     req(input$AF_SharedData)
     req(nrow(Data_3_1_Complete())>0)
     
     if(nrow(Data_3_1_Complete())>1){
       PH<-Data_3_1_Complete()%>%
        {if(input$Vis1_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis1=percent_rank(get(input$Vis1_MapDisplayField))*100) else .}%>%
        {if(input$Vis1_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis1=percent_rank(get(input$Vis1_MapDisplayField_Size))*100) else .}
    }else{
      PH<-Data_3_1_Complete()%>%
        {if(input$Vis1_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis1=50) else .}%>%
        {if(input$Vis1_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis1=50) else .}
    } 
      
      Data_3_1_Complete_Percentiles(PH)
     
   },ignoreInit=TRUE)


    Creel_SHP_Vis3_1<-eventReactive(Data_3_1_Complete_Percentiles(),{
      req(length(Data_3_1_Complete_Percentiles())>0)
      req(input$SelectVis1=="Map")
      req(input$AF_VisNum_Selection==3)
      
      sp::merge(x=CreelWaterbodies_SHP,y=Data_3_1_Complete_Percentiles(),by.x="WB_ID",by.y="WB_ID",all.x=FALSE)%>%
        st_jitter(amount=0.002)
      })

  Vis_3_1_MapSizeField<-eventReactive(input$Vis1_MapDisplayField_Size,{
    input$Vis1_MapDisplayField_Size
    })

  Vis_3_1_MapSizeMin<-eventReactive(c(input$Vis1_MapDisplayField_Size,input$Vis_1_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(length(Creel_SHP_Vis3_1())>0)
    PH<-Creel_SHP_Vis3_1()%>%
      pull(input$Vis1_MapDisplayField_Size)
      return(min(PH,na.rm=TRUE))
      })

  Vis_3_1_MapSizeMax<-eventReactive(
    c(input$Vis1_MapDisplayField_Size,input$Vis_1_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
        req(length(Creel_SHP_Vis3_1())>0)
      PH<-Creel_SHP_Vis3_1()%>%
        pull(input$Vis1_MapDisplayField_Size)
        return(max(PH,na.rm=TRUE))
      })

  Vis_3_1_MapSizeMinPix<-eventReactive(input$Vis1_MapDisplayField_SizeSlider,{
    input$Vis1_MapDisplayField_SizeSlider[1]
    })

  Vis_3_1_MapSizeMaxPix<-eventReactive(input$Vis1_MapDisplayField_SizeSlider,{
    input$Vis1_MapDisplayField_SizeSlider[2]
    })

  Vis_3_1_MapPix_Dif<-eventReactive(c(Vis_3_1_MapSizeMaxPix(),Vis_3_1_MapSizeMinPix()),{
    Vis_3_1_MapSizeMaxPix()-Vis_3_1_MapSizeMinPix()
    })

  Vis_3_1_MapSizeDenom<-eventReactive(c(Vis_3_1_MapSizeMax(),Vis_3_1_MapSizeMin()),{
    
    req(length(Creel_SHP_Vis3_1())>0)
    
    (Vis_3_1_MapSizeMax()-Vis_3_1_MapSizeMin())
    })

  Vis_3_1_MapSizeSingle<-eventReactive(input$Vis1_MapDisplayField_SizeSliderSingle,{
    input$Vis1_MapDisplayField_SizeSliderSingle
    })

  Vis_3_1_MapColorSolid<-eventReactive(input$Vis1_MapColorSolid,{
    input$Vis1_MapColorSolid
    })

    MapVis3_1_PalRange<-reactive({
     
    req(length(Creel_SHP_Vis3_1())>0)
    
      req(input$Vis1_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis3_1()%>%
        select(input$Vis1_MapDisplayField)
      })

   MapVis3_1_PercentilesPalRange<-reactive({
      req(length(Creel_SHP_Vis3_1())>0)
      req(Creel_SHP_Vis3_1()$ColorPercentile_Vis1)
    
      req(input$Vis1_MapDisplayField!="Nothing Selected")
      
      Creel_SHP_Vis3_1()%>%
        select(ColorPercentile_Vis1)
      
      })


    output$MapVis3_1 <- renderLeaflet({
      MapVis3_1_Requirement<-HTML(
       "<span style=\"color:red;background-color:white\"><strong>Click 'Display Creel Data on Map' from sidebar to add your creel data to the map.</span>"
   )


      CreelMap <- leaflet()%>%
        addMapPane("SelectedWBs",zIndex=440)%>%
        addMapPane("CreelData",zIndex=430)%>%
        addMapPane("SelectedArea",zIndex=420)%>%
        addMapPane("SupplementaryData",zIndex=410)%>%
        addProviderTiles("CartoDB.DarkMatter",group="Dark")%>%
        addProviderTiles("CartoDB.Positron",group="Light")%>%
        addWMSTiles(GetURL("USGSImageryTopo"),group="Imagery Topo Hybrid",layers="0")%>%
        addWMSTiles(GetURL("USGSTopo"),group="Topo",layers="0")%>%
        addWMSTiles(GetURL("USGSImageryOnly"),group="Imagery",layers="0")%>%
        addWMSTiles(GetURL("USGSShadedReliefOnly"),group="Shaded Relief",layers="0")%>%
        addWMSTiles(GetURL("USGSHydroCached"),group="Hydrography",layers="0",options =list(format="image/png",transparent=TRUE))%>%
        addPolygons(data=StateBoundaries_SHP,
                    group="State Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 2,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=StateBoundaries_SHP$STUSPS,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE),
        )%>%
        addPolygons(data=CountyBoundaries_SHP,
                    group="County Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 1.5,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=CountyBoundaries_SHP$County_ID,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE)
        )%>%
        addLayersControl(
          baseGroups=isolate(if(input$DarkMode=='Dark'){c("Dark","Light","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}else{c("Light","Dark","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}),
          overlayGroups =c("Creel Data", "State Boundaries","County Boundaries","Hydrography"),
          options = layersControlOptions(collapsed = TRUE))%>%
        hideGroup("County Boundaries")%>%
        hideGroup("Hydrography")%>%
        addMeasure()%>%
        addMiniMap(position="bottomleft",minimized=TRUE,toggleDisplay=TRUE)%>%
        addEasyButton(easyButton(
          icon="fa-globe", title="Zoom to Level 1",
          onClick=JS("function(btn, map){ map.setZoom(3); }")))%>%
        addEasyButton(easyButton(
          icon="fa-crosshairs", title="Locate Me",
          onClick=JS("function(btn, map){ map.locate({setView: true, maxZoom: 10}); }")))%>%
        onRender(
          "function(el, x) {
            L.easyPrint({
              sizeModes: ['Current', 'A4Landscape', 'A4Portrait'],
              filename: 'MyMap',
              exportOnly: true,
              hideControlContainer: false
            }).addTo(this);
            }"
        )%>%
      addControl(MapVis3_1_Requirement,position="topright",layerId="ShowCreelMessage")
    })
    
  observeEvent(c(
    input$DarkMode,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
  ),{
    req(length(Creel_SHP_Vis3_1())>0)
    if(input$DarkMode=="Dark"){
      leafletProxy("MapVis3_1",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Light")%>%
        showGroup("Dark")
    }
    if(input$DarkMode=="Light"){
      leafletProxy("MapVis3_1",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Dark")%>%
        showGroup("Light")
    }
  })  

  observeEvent(c(
    MapVis3_1_SelectedWB_SHP(),
    MapVis3_1_PercentilesPalRange(),
    input$DisplayCreel_Map_Vis_1,
     input$Vis1_MapColorPalette,
     input$Vis1_Map_PalToggle,
     input$Vis1_Map_CreelColorscalePer,
     input$Vis1_MapDisplayField_SizeSlider,
     input$Vis1_MapColorSolid,
     input$Vis1_MapDisplayField_SizeSliderSingle,
     input$Vis1_Map_CreelSizescalePer,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis3_1())>0)
      req(input$Vis1_Map_CreelDisplayType)
    
      
        
      req(is.null(MapVis3_1_SelectedWB_SHP()))
      
      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }


      Vis1_Map_Popup<- if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis3_1()[[input$Vis1_MapDisplayField]],Creel_SHP_Vis3_1()$Waterbody_Name_Unique,Creel_SHP_Vis3_1()$Year,Creel_SHP_Vis3_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField_Size,Creel_SHP_Vis3_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis3_1()$Waterbody_Name_Unique,Creel_SHP_Vis3_1()$Year,Creel_SHP_Vis3_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis3_1()[[input$Vis1_MapDisplayField]],input$Vis1_MapDisplayField_Size,Creel_SHP_Vis3_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis3_1()$Waterbody_Name_Unique,Creel_SHP_Vis3_1()$Year,Creel_SHP_Vis3_1()$Survey_ID)%>% lapply(htmltools::HTML)
      }

        pal <- colorNumeric(input$Vis1_MapColorPalette,MapVis3_1_PalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
        pal2 <-colorNumeric(input$Vis1_MapColorPalette,MapVis3_1_PercentilesPalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
        
       leafletProxy("MapVis3_1",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis3_1(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis3_1()$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 1,
                fillOpacity=1,
                stroke=FALSE,
                fillColor =if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){Vis_3_1_MapColorSolid()}else{if(input$Vis1_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis1_MapDisplayField))}else{~pal2(ColorPercentile_Vis1)}},
                radius=if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){Vis_3_1_MapSizeSingle()}else{if(input$Vis1_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis1_MapDisplayField_Size)-Vis_3_1_MapSizeMin())*Vis_3_1_MapPix_Dif())/Vis_3_1_MapSizeDenom())+Vis_3_1_MapSizeMinPix()))}else{~(((SizePercentile_Vis1*Vis_3_1_MapPix_Dif())/100)+Vis_3_1_MapSizeMinPix())}},
               label=Vis1_Map_Popup
      )

      },ignoreInit=TRUE)

  observeEvent(c(
    MapVis3_1_SelectedWB_SHP(),
    input$DisplayCreel_Map_Vis_1,
    input$Vis1_MapColorPalette,
    MapVis3_1_PercentilesPalRange(),
    input$Vis1_Map_PalToggle,
    input$Vis1_Map_CreelColorscalePer,
    input$Vis1_MapDisplayField_SizeSlider,
    input$Vis1_MapColorSolid,
    input$Vis1_MapDisplayField_SizeSliderSingle,
    input$Vis1_Map_CreelSizescalePer,
    input$Vis1_FillOpacity,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis3_1())>0)
      req(input$Vis1_Map_CreelDisplayType)
      req(!is.null(MapVis3_1_SelectedWB_SHP()))

      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }


      Vis1_Map_Popup<- if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis3_1()[[input$Vis1_MapDisplayField]],Creel_SHP_Vis3_1()$Waterbody_Name_Unique,Creel_SHP_Vis3_1()$Year,Creel_SHP_Vis3_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField_Size,Creel_SHP_Vis3_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis3_1()$Waterbody_Name_Unique,Creel_SHP_Vis3_1()$Year,Creel_SHP_Vis3_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis3_1()[[input$Vis1_MapDisplayField]],input$Vis1_MapDisplayField_Size,Creel_SHP_Vis3_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis3_1()$Waterbody_Name_Unique,Creel_SHP_Vis3_1()$Year,Creel_SHP_Vis3_1()$Survey_ID)%>% lapply(htmltools::HTML)
      }
      
    Vis1_Map_Popup_Sel<-if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,MapVis3_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField]],MapVis3_1_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis3_1_SelectedWB_SHP()$Year,MapVis3_1_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField_Size,MapVis3_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField_Size]],MapVis3_1_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis3_1_SelectedWB_SHP()$Year,MapVis3_1_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,MapVis3_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField]],input$Vis1_MapDisplayField_Size,MapVis3_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField_Size]],MapVis3_1_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis3_1_SelectedWB_SHP()$Year,MapVis3_1_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      }
    

      pal <- colorNumeric(input$Vis1_MapColorPalette,MapVis3_1_PalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
      pal2 <-colorNumeric(input$Vis1_MapColorPalette,MapVis3_1_PercentilesPalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
        
       leafletProxy("MapVis3_1",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
            addCircleMarkers(
              data=Creel_SHP_Vis3_1(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis3_1()$FID),
                options=pathOptions(pane="CreelData"),
                fillOpacity=input$Vis1_FillOpacity,
                stroke=FALSE,
                fillColor =if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){Vis_3_1_MapColorSolid()}else{if(input$Vis1_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis1_MapDisplayField))}else{~pal2(ColorPercentile_Vis1)}},
                radius=if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){Vis_3_1_MapSizeSingle()}else{if(input$Vis1_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis1_MapDisplayField_Size)-Vis_3_1_MapSizeMin())*Vis_3_1_MapPix_Dif())/Vis_3_1_MapSizeDenom())+Vis_3_1_MapSizeMinPix()))}else{~(((SizePercentile_Vis1*Vis_3_1_MapPix_Dif())/100)+Vis_3_1_MapSizeMinPix())}},
               label=Vis1_Map_Popup
          )%>%
            addCircleMarkers(data=MapVis3_1_SelectedWB_SHP(),
                             group='Selected Waterbodies',
                             stroke=FALSE,
                             fillOpacity=1,
                    fillColor =if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){Vis_3_1_MapColorSolid()}else{if(input$Vis1_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis1_MapDisplayField))}else{~pal2(ColorPercentile_Vis1)}},
                    radius=if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){Vis_3_1_MapSizeSingle()}else{if(input$Vis1_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis1_MapDisplayField_Size)-Vis_3_1_MapSizeMin())*Vis_3_1_MapPix_Dif())/Vis_3_1_MapSizeDenom())+Vis_3_1_MapSizeMinPix()))}else{~(((SizePercentile_Vis1*Vis_3_1_MapPix_Dif())/100)+Vis_3_1_MapSizeMinPix())}},
                   label=Vis1_Map_Popup_Sel,
                             options=pathOptions(pane="SelectedWBs"))

      },ignoreInit=TRUE)
  

    observeEvent(c(
      input$DisplayCreel_Map_Vis_1,
      input$Vis1_Map_CreelDisplayType,
      input$Vis1_AddLegend_Switch,
      input$Vis1_MapColorPalette,
      MapVis3_1_PercentilesPalRange(),
      input$Vis1_Map_PalToggle,
      input$Vis1_Map_CreelColorscalePer
    ),{
      req(length(Creel_SHP_Vis3_1())>0)
      req(input$Vis1_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_1_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})


      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }


      if(input$Vis1_AddLegend_Switch=="Yes"&&(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both")){
        Vis1_Feature<-input$Vis1_MapDisplayField
         pal <- colorNumeric(input$Vis1_MapColorPalette,MapVis3_1_PalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis1_MapColorPalette,MapVis3_1_PercentilesPalRange()[[1]],reverse=input$Vis1_Map_PalToggle)

      leafletProxy("MapVis3_1",session)%>%
          removeControl(layerId="Legend")%>%
          addLegend("bottomright",
                pal = if(input$Vis1_Map_CreelColorscalePer=="Values"){pal}else{pal2},
                values=if(input$Vis1_Map_CreelColorscalePer=="Values"){Creel_SHP_Vis3_1()[[Vis1_Feature]]}else{c(0:100)},
                title=if(input$Vis1_Map_CreelColorscalePer=="Values"){paste(Vis1_Feature)}else{paste(Vis1_Feature,"</br>Percentile")},
                group= "CreelCat Data",
                layerId="Legend",
                opacity = 1)
      }else if(input$Vis1_AddLegend_Switch=="No"||input$Vis1_Map_CreelDisplayType=="Scaled Size"){
        leafletProxy("MapVis3_1",session)%>%
          removeControl(layerId="Legend")
      }
    },ignoreInit=TRUE)

    observeEvent(c(
      input$Vis1_CreelExtentZoomBTN,
      input$AF_VisNum_Selection,
      input$DisplayCreel_Map_Vis_1,
      Creel_SHP_Vis3_1(),
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(input$Vis1_Map_CreelDisplayType)
      req(length(Creel_SHP_Vis3_1())>0)
    

      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }

       CreelBounds<- st_bbox(Creel_SHP_Vis3_1())%>%as.vector()
        leafletProxy("MapVis3_1",session)%>%
          fitBounds(CreelBounds[1], CreelBounds[2], CreelBounds[3], CreelBounds[4])
    },ignoreInit=TRUE)


    observeEvent({
      input$Vis1_GeographyZoomBTN
    },{
      if(input$Vis1_ZoomToCounty=="Statewide"){
        SelectedStateBounds<-st_bbox(StateBoundaries_SHP[StateBoundaries_SHP$NAME==input$Vis1_ZoomToState,])%>%as.vector()
        leafletProxy("MapVis3_1",session)%>%
          fitBounds(SelectedStateBounds[1], SelectedStateBounds[2], SelectedStateBounds[3], SelectedStateBounds[4])
      }
      if(input$Vis1_ZoomToCounty!="Statewide"){
        SelectedCountyBounds<-st_bbox(CountyBoundaries_SHP%>%filter(State==input$Vis1_ZoomToState & County==input$Vis1_ZoomToCounty))%>%as.vector()
        leafletProxy("MapVis3_1",session)%>%
          fitBounds(SelectedCountyBounds[1], SelectedCountyBounds[2], SelectedCountyBounds[3], SelectedCountyBounds[4])
      }},ignoreInit=TRUE)

    observeEvent(c(
      input$Map_Vis1_Title_Text,
      input$Map_Vis1_Title_Switch
    ),{
      req(length(Creel_SHP_Vis3_1())>0)
      if(input$Map_Vis1_Title_Switch=="Yes"){
        leafletProxy("MapVis3_1",session)%>%
         removeControl(layerId="Map3_1_Title")%>%
          addControl(Map_3_1_Title(),position=c("bottomright"),layerId="Map3_1_Title")
      }else if(input$Map_Vis1_Title_Switch=="No"){
        leafletProxy("MapVis3_1",session)%>%
         removeControl(layerId="Map3_1_Title")
      }
    },ignoreInit=TRUE)
    


  MapVis3_1_SelectedWB_SHP<-reactiveVal(NULL)

  MapVis3_1_area<-reactiveValues()
  Poly_SHP_MapVis3_1<-reactiveVal()

observeEvent(input$MapVis3_1_click, {
  req(input$Vis1_SelectType=="Polygon")
  req(input$Vis1_SelectPolygon=="Draw")

    coords <- input$MapVis3_1_click
    cm <- matrix(data = c(coords$lat, coords$lng), nrow = 1, ncol = 2)
    MapVis3_1_area$mp <- if(!is.null(MapVis3_1_area$mp)){rbind(MapVis3_1_area$mp, cm)}else{cm}

    leafletProxy("MapVis3_1")%>%
      clearGroup("Polygon Draw")%>%
      addPolygons(lat = MapVis3_1_area$mp[ , 1], lng = MapVis3_1_area$mp[ , 2],color="red",fillOpacity=0,group='Polygon Draw',
          options=pathOptions(pane="SelectedArea"))

},ignoreInit=TRUE)

observeEvent(input$Vis1_SelectPolygon, {

  req(input$Vis1_SelectType=="Polygon")
  req(length(MapVis3_1_area$mp)>5)
  req(input$Vis1_SelectPolygon=="Complete")

  Sel_MapVis3_1_area<-as.data.frame(MapVis3_1_area$mp)%>%
    rename(lat=1)%>%
    rename(lng=2)


 Poly_SHP_MapVis3_1(
    polygon_MapVis3_1<-Sel_MapVis3_1_area%>%
  st_as_sf(coords = c("lng", "lat"), crs = 4326)%>%
  summarise(geometry = st_combine(geometry))%>%
  st_cast("POLYGON")
 )
 
 PolyPoints<-Creel_SHP_Vis3_1()%>%
                  filter(st_intersects(.,Poly_SHP_MapVis3_1(),sparse=FALSE)[,1])
 
  MapVis3_1_SelectedWB_SHP(PolyPoints)

},ignoreInit=TRUE)

observeEvent(input$Vis1_SelectPolygon,{

  req(input$Vis1_SelectPolygon=="Clear")
  req(input$Vis1_SelectType=="Polygon")
  
  HighlightTrace_3Vis(NULL)
  All_SelectedWB_3Vis(NULL)
  Data_3_1_Selected(NULL)
  Sel_SurveysScatter_Vis_3_1_UL(NULL) 
  HighlightTrace_Vis_3_1(NULL) 
  MapVis3_1_area$mp<-NULL
  Poly_SHP_MapVis3_1(NULL)
  Sel_SurveysMap_Vis_3_1_UL(NULL)
  Sel_SurveysAll_Vis_3_1_UL(NULL)
  MapVis3_1_SelectedWB_SHP(NULL)

},ignoreInit=TRUE)

State_Clicks_MapVis3_1<-reactiveVal()
SelStatePoly_SHP_MapVis3_1<-reactiveVal()
SelStatePoints_SHP_MapVis3_1<-reactiveVal()
SelStates_Filtered_MapVis3_1<-reactiveVal()

observeEvent(input$MapVis3_1_click, {

  req(input$Vis1_SelectType=="States")
  req(input$Vis1_SelectState=="Select")

      click <- input$MapVis3_1_shape_click

      State_Clicks_MapVis3_1(list(c(State_Clicks_MapVis3_1(),click$id)))

    SelStates_df<-as.data.frame(State_Clicks_MapVis3_1())


    Selected_States_Vector<-as.character(SelStates_df[1,])


    PH<-StateBoundaries_SHP%>%
      filter(., STUSPS %in% Selected_States_Vector)

    SelStates_Filtered_MapVis3_1(PH)


    leafletProxy("MapVis3_1")%>%
      clearGroup("Selected States")%>%
      addPolygons(data=SelStates_Filtered_MapVis3_1(),color="red",weight=3,fillOpacity=0,group='Selected States',
          options=pathOptions(pane="SelectedArea"))
  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectState, {

  req(input$Vis1_SelectType=="States")
  req(input$Vis1_SelectState=="Complete")
  req(!is.null(SelStates_Filtered_MapVis3_1()))

    SelStatePoly_SHP_MapVis3_1(SelStates_Filtered_MapVis3_1())

    State_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis3_1(),SelStatePoly_SHP_MapVis3_1(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    State_Intersects2<-State_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      State_Intersects3<-Creel_SHP_Vis3_1()%>%slice(as.numeric(row.names(State_Intersects2)))

       MapVis3_1_SelectedWB_SHP(State_Intersects3)

  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectState, {
  req(input$Vis1_SelectType=="States")
  req(input$Vis1_SelectState=="Clear")
  
  HighlightTrace_3Vis(NULL)
  All_SelectedWB_3Vis(NULL)
  Data_3_1_Selected(NULL)
  Sel_SurveysScatter_Vis_3_1_UL(NULL) 
  HighlightTrace_Vis_3_1(NULL) 
  MapVis3_1_SelectedWB_SHP(NULL)

    SelStatePoly_SHP_MapVis3_1(NULL)

    State_Clicks_MapVis3_1(NULL)
    SelStates_Filtered_MapVis3_1(NULL)
    SelStatePoints_SHP_MapVis3_1(NULL)
    Sel_SurveysMap_Vis_3_1_UL(NULL)
    Sel_SurveysAll_Vis_3_1_UL(NULL)

  
  },ignoreInit=TRUE)


observeEvent(input$Vis1_SelectType, {

  req(input$Vis1_SelectType=="States")

    leafletProxy("MapVis3_1")%>%
      hideGroup("County Boundaries")%>%
      showGroup("State Boundaries")
},ignoreInit=TRUE)

observeEvent(input$Vis1_SelectType, {

  req(input$Vis1_SelectType=="Counties")

    leafletProxy("MapVis3_1")%>%
      hideGroup("State Boundaries")%>%
      showGroup("County Boundaries")
},ignoreInit=TRUE)


County_Clicks_MapVis3_1<-reactiveVal()
SelCountyPoly_SHP_MapVis3_1<-reactiveVal()
SelCountyPoints_SHP_MapVis3_1<-reactiveVal()
SelCounties_Filtered_MapVis3_1<-reactiveVal()

observeEvent(input$MapVis3_1_click, {

  req(input$Vis1_SelectType=="Counties")
  req(input$Vis1_SelectCounty=="Select")

      click <- input$MapVis3_1_shape_click

      County_Clicks_MapVis3_1(list(c(County_Clicks_MapVis3_1(),click$id)))

    SelCounties_df<-as.data.frame(County_Clicks_MapVis3_1())


    Selected_Counties_Vector<-as.character(SelCounties_df[1,])


    PH<-CountyBoundaries_SHP%>%
      filter(., County_ID %in% Selected_Counties_Vector)

    SelCounties_Filtered_MapVis3_1(PH)

    leafletProxy("MapVis3_1")%>%
      clearGroup("Selected Counties")%>%
      addPolygons(data=SelCounties_Filtered_MapVis3_1(),color="red",weight=3,fillOpacity=0,group='Selected Counties',
          options=pathOptions(pane="SelectedArea"))
  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectCounty, {

  req(input$Vis1_SelectType=="Counties")
  req(input$Vis1_SelectCounty=="Complete")
  req(!is.null(SelCounties_Filtered_MapVis3_1()))



    SelCountyPoly_SHP_MapVis3_1(SelCounties_Filtered_MapVis3_1())

    County_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis3_1(),SelCountyPoly_SHP_MapVis3_1(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    County_Intersects2<-County_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      County_Intersects3<-Creel_SHP_Vis3_1()%>%slice(as.numeric(row.names(County_Intersects2)))


      MapVis3_1_SelectedWB_SHP(County_Intersects3)

  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectCounty, {
  req(input$Vis1_SelectType=="Counties")
  req(input$Vis1_SelectCounty=="Clear")

    HighlightTrace_3Vis(NULL)
    All_SelectedWB_3Vis(NULL)
    Data_3_1_Selected(NULL)
    Sel_SurveysScatter_Vis_3_1_UL(NULL) 
    HighlightTrace_Vis_3_1(NULL)
  MapVis3_1_SelectedWB_SHP(NULL) 


    SelCountyPoly_SHP_MapVis3_1(NULL)

    County_Clicks_MapVis3_1(NULL)
    SelCounties_Filtered_MapVis3_1(NULL)
    SelCountyPoints_SHP_MapVis3_1(NULL)
    Sel_SurveysMap_Vis_3_1_UL(NULL)
    Sel_SurveysAll_Vis_3_1_UL(NULL) 


  },ignoreInit=TRUE)

    #### Vis 4_1 Map ####

    
  Map_4_1_Title<-eventReactive(c(input$Map_Vis1_Title_Text),{
     PH<-input$Map_Vis1_Title_Text
     return(paste("<span style=\"color:grey50,background-color:rgba(255,255,255,0)\"><strong>",PH,"</span>"))
   })
   
   
   Data_4_1_Complete_Percentiles<-reactiveVal(NULL)
   
   observeEvent(c(
     Data_4_1_Complete(),
     input$DisplayCreel_Map_Vis_1,
     input$Vis1_MapDisplayField,
     input$Vis1_MapDisplayField_Size,
     input$AF_VisNum_Selection
   ),{
     req(input$AF_VisNum_Selection==4)
     req(input$AF_SharedData)
     req(nrow(Data_4_1_Complete())>0)
     

      if(nrow(Data_4_1_Complete())>1){
       PH<-Data_4_1_Complete()%>%
        {if(input$Vis1_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis1=percent_rank(get(input$Vis1_MapDisplayField))*100) else .}%>%
        {if(input$Vis1_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis1=percent_rank(get(input$Vis1_MapDisplayField_Size))*100) else .}
    }else{
      PH<-Data_4_1_Complete()%>%
        {if(input$Vis1_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis1=50) else .}%>%
        {if(input$Vis1_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis1=50) else .}
    } 
      
      Data_4_1_Complete_Percentiles(PH)
     
   },ignoreInit=TRUE)


    Creel_SHP_Vis4_1<-eventReactive(Data_4_1_Complete_Percentiles(),{
      req(length(Data_4_1_Complete_Percentiles())>0)
      req(input$SelectVis1=="Map")
      req(input$AF_VisNum_Selection==4)
      
      sp::merge(x=CreelWaterbodies_SHP,y=Data_4_1_Complete_Percentiles(),by.x="WB_ID",by.y="WB_ID",all.x=FALSE)%>%
        st_jitter(amount=0.002)
      })

  Vis_4_1_MapSizeField<-eventReactive(input$Vis1_MapDisplayField_Size,{
    input$Vis1_MapDisplayField_Size
    })

  Vis_4_1_MapSizeMin<-eventReactive(c(input$Vis1_MapDisplayField_Size,input$Vis_1_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(length(Creel_SHP_Vis4_1())>0)
    PH<-Creel_SHP_Vis4_1()%>%
      pull(input$Vis1_MapDisplayField_Size)
      return(min(PH,na.rm=TRUE))
      })

  Vis_4_1_MapSizeMax<-eventReactive(
    c(input$Vis1_MapDisplayField_Size,input$Vis_1_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
        req(length(Creel_SHP_Vis4_1())>0)
      PH<-Creel_SHP_Vis4_1()%>%
        pull(input$Vis1_MapDisplayField_Size)
        return(max(PH,na.rm=TRUE))
      })

  Vis_4_1_MapSizeMinPix<-eventReactive(input$Vis1_MapDisplayField_SizeSlider,{
    input$Vis1_MapDisplayField_SizeSlider[1]
    })

  Vis_4_1_MapSizeMaxPix<-eventReactive(input$Vis1_MapDisplayField_SizeSlider,{
    input$Vis1_MapDisplayField_SizeSlider[2]
    })

  Vis_4_1_MapPix_Dif<-eventReactive(c(Vis_4_1_MapSizeMaxPix(),Vis_4_1_MapSizeMinPix()),{
    Vis_4_1_MapSizeMaxPix()-Vis_4_1_MapSizeMinPix()
    })

  Vis_4_1_MapSizeDenom<-eventReactive(c(Vis_4_1_MapSizeMax(),Vis_4_1_MapSizeMin()),{
    
    req(length(Creel_SHP_Vis4_1())>0)
    
    (Vis_4_1_MapSizeMax()-Vis_4_1_MapSizeMin())
    })

  Vis_4_1_MapSizeSingle<-eventReactive(input$Vis1_MapDisplayField_SizeSliderSingle,{
    input$Vis1_MapDisplayField_SizeSliderSingle
    })

  Vis_4_1_MapColorSolid<-eventReactive(input$Vis1_MapColorSolid,{
    input$Vis1_MapColorSolid
    })

    MapVis4_1_PalRange<-reactive({
     
    req(length(Creel_SHP_Vis4_1())>0)
    
      req(input$Vis1_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis4_1()%>%
        select(input$Vis1_MapDisplayField)
      })

   MapVis4_1_PercentilesPalRange<-reactive({
      req(length(Creel_SHP_Vis4_1())>0)
      req(Creel_SHP_Vis4_1()$ColorPercentile_Vis1)
    
      req(input$Vis1_MapDisplayField!="Nothing Selected")
      
      Creel_SHP_Vis4_1()%>%
        select(ColorPercentile_Vis1)
      
      })


    output$MapVis4_1 <- renderLeaflet({
      MapVis4_1_Requirement<-HTML(
       "<span style=\"color:red;background-color:white\"><strong>Click 'Display Creel Data on Map' from sidebar to add your creel data to the map.</span>"
   )


      CreelMap <- leaflet()%>%
        addMapPane("SelectedWBs",zIndex=440)%>%
        addMapPane("CreelData",zIndex=430)%>%
        addMapPane("SelectedArea",zIndex=420)%>%
        addMapPane("SupplementaryData",zIndex=410)%>%
        addProviderTiles("CartoDB.DarkMatter",group="Dark")%>%
        addProviderTiles("CartoDB.Positron",group="Light")%>%
        addWMSTiles(GetURL("USGSImageryTopo"),group="Imagery Topo Hybrid",layers="0")%>%
        addWMSTiles(GetURL("USGSTopo"),group="Topo",layers="0")%>%
        addWMSTiles(GetURL("USGSImageryOnly"),group="Imagery",layers="0")%>%
        addWMSTiles(GetURL("USGSShadedReliefOnly"),group="Shaded Relief",layers="0")%>%
        addWMSTiles(GetURL("USGSHydroCached"),group="Hydrography",layers="0",options =list(format="image/png",transparent=TRUE))%>%
        addPolygons(data=StateBoundaries_SHP,
                    group="State Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 2,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=StateBoundaries_SHP$STUSPS,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE),
        )%>%
        addPolygons(data=CountyBoundaries_SHP,
                    group="County Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 1.5,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=CountyBoundaries_SHP$County_ID,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE)
        )%>%
        addLayersControl(
          baseGroups=isolate(if(input$DarkMode=='Dark'){c("Dark","Light","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}else{c("Light","Dark","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}),
          overlayGroups =c("Creel Data", "State Boundaries","County Boundaries","Hydrography"),
          options = layersControlOptions(collapsed = TRUE))%>%
        hideGroup("County Boundaries")%>%
        hideGroup("Hydrography")%>%
        addMeasure()%>%
        addMiniMap(position="bottomleft",minimized=TRUE,toggleDisplay=TRUE)%>%
        addEasyButton(easyButton(
          icon="fa-globe", title="Zoom to Level 1",
          onClick=JS("function(btn, map){ map.setZoom(3); }")))%>%
        addEasyButton(easyButton(
          icon="fa-crosshairs", title="Locate Me",
          onClick=JS("function(btn, map){ map.locate({setView: true, maxZoom: 10}); }")))%>%
        onRender(
          "function(el, x) {
            L.easyPrint({
              sizeModes: ['Current', 'A4Landscape', 'A4Portrait'],
              filename: 'MyMap',
              exportOnly: true,
              hideControlContainer: false
            }).addTo(this);
            }"
        )%>%
      addControl(MapVis4_1_Requirement,position="topright",layerId="ShowCreelMessage")
    })
    
  observeEvent(c(
    input$DarkMode,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
  ),{
    req(length(Creel_SHP_Vis4_1())>0)
    if(input$DarkMode=="Dark"){
      leafletProxy("MapVis4_1",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Light")%>%
        showGroup("Dark")
    }
    if(input$DarkMode=="Light"){
      leafletProxy("MapVis4_1",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Dark")%>%
        showGroup("Light")
    }
  },ignoreInit=TRUE)  

  observeEvent(c(
    MapVis4_1_SelectedWB_SHP(),
    MapVis4_1_PercentilesPalRange(),
    input$DisplayCreel_Map_Vis_1,
     input$Vis1_MapColorPalette,
     input$Vis1_Map_PalToggle,
     input$Vis1_Map_CreelColorscalePer,
     input$Vis1_MapDisplayField_SizeSlider,
     input$Vis1_MapColorSolid,
     input$Vis1_MapDisplayField_SizeSliderSingle,
     input$Vis1_Map_CreelSizescalePer,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis4_1())>0)
      req(input$Vis1_Map_CreelDisplayType)
    
      
        
      req(is.null(MapVis4_1_SelectedWB_SHP()))
      
      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }


      Vis1_Map_Popup<- if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis4_1()[[input$Vis1_MapDisplayField]],Creel_SHP_Vis4_1()$Waterbody_Name_Unique,Creel_SHP_Vis4_1()$Year,Creel_SHP_Vis4_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField_Size,Creel_SHP_Vis4_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis4_1()$Waterbody_Name_Unique,Creel_SHP_Vis4_1()$Year,Creel_SHP_Vis4_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis4_1()[[input$Vis1_MapDisplayField]],input$Vis1_MapDisplayField_Size,Creel_SHP_Vis4_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis4_1()$Waterbody_Name_Unique,Creel_SHP_Vis4_1()$Year,Creel_SHP_Vis4_1()$Survey_ID)%>% lapply(htmltools::HTML)
      }

        pal <- colorNumeric(input$Vis1_MapColorPalette,MapVis4_1_PalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
        pal2 <-colorNumeric(input$Vis1_MapColorPalette,MapVis4_1_PercentilesPalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
        
       leafletProxy("MapVis4_1",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis4_1(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis4_1()$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 1,
                fillOpacity=1,
                stroke=FALSE,
                fillColor =if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){Vis_4_1_MapColorSolid()}else{if(input$Vis1_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis1_MapDisplayField))}else{~pal2(ColorPercentile_Vis1)}},
                radius=if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){Vis_4_1_MapSizeSingle()}else{if(input$Vis1_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis1_MapDisplayField_Size)-Vis_4_1_MapSizeMin())*Vis_4_1_MapPix_Dif())/Vis_4_1_MapSizeDenom())+Vis_4_1_MapSizeMinPix()))}else{~(((SizePercentile_Vis1*Vis_4_1_MapPix_Dif())/100)+Vis_4_1_MapSizeMinPix())}},
               label=Vis1_Map_Popup
      )

      },ignoreInit=TRUE)

  observeEvent(c(
    MapVis4_1_SelectedWB_SHP(),
    input$DisplayCreel_Map_Vis_1,
    input$Vis1_MapColorPalette,
    MapVis4_1_PercentilesPalRange(),
    input$Vis1_Map_PalToggle,
    input$Vis1_Map_CreelColorscalePer,
    input$Vis1_MapDisplayField_SizeSlider,
    input$Vis1_MapColorSolid,
    input$Vis1_MapDisplayField_SizeSliderSingle,
    input$Vis1_Map_CreelSizescalePer,
    input$Vis1_FillOpacity,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis4_1())>0)
      req(input$Vis1_Map_CreelDisplayType)
      req(!is.null(MapVis4_1_SelectedWB_SHP()))

      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }


      Vis1_Map_Popup<- if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis4_1()[[input$Vis1_MapDisplayField]],Creel_SHP_Vis4_1()$Waterbody_Name_Unique,Creel_SHP_Vis4_1()$Year,Creel_SHP_Vis4_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField_Size,Creel_SHP_Vis4_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis4_1()$Waterbody_Name_Unique,Creel_SHP_Vis4_1()$Year,Creel_SHP_Vis4_1()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,Creel_SHP_Vis4_1()[[input$Vis1_MapDisplayField]],input$Vis1_MapDisplayField_Size,Creel_SHP_Vis4_1()[[input$Vis1_MapDisplayField_Size]],Creel_SHP_Vis4_1()$Waterbody_Name_Unique,Creel_SHP_Vis4_1()$Year,Creel_SHP_Vis4_1()$Survey_ID)%>% lapply(htmltools::HTML)
      }
      
    Vis1_Map_Popup_Sel<-if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,MapVis4_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField]],MapVis4_1_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis4_1_SelectedWB_SHP()$Year,MapVis4_1_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField_Size,MapVis4_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField_Size]],MapVis4_1_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis4_1_SelectedWB_SHP()$Year,MapVis4_1_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis1_MapDisplayField,MapVis4_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField]],input$Vis1_MapDisplayField_Size,MapVis4_1_SelectedWB_SHP()[[input$Vis1_MapDisplayField_Size]],MapVis4_1_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis4_1_SelectedWB_SHP()$Year,MapVis4_1_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      }
    

      pal <- colorNumeric(input$Vis1_MapColorPalette,MapVis4_1_PalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
      pal2 <-colorNumeric(input$Vis1_MapColorPalette,MapVis4_1_PercentilesPalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
        
       leafletProxy("MapVis4_1",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
            addCircleMarkers(
              data=Creel_SHP_Vis4_1(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis4_1()$FID),
                options=pathOptions(pane="CreelData"),
                fillOpacity=input$Vis1_FillOpacity,
                stroke=FALSE,
                fillColor =if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){Vis_4_1_MapColorSolid()}else{if(input$Vis1_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis1_MapDisplayField))}else{~pal2(ColorPercentile_Vis1)}},
                radius=if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){Vis_4_1_MapSizeSingle()}else{if(input$Vis1_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis1_MapDisplayField_Size)-Vis_4_1_MapSizeMin())*Vis_4_1_MapPix_Dif())/Vis_4_1_MapSizeDenom())+Vis_4_1_MapSizeMinPix()))}else{~(((SizePercentile_Vis1*Vis_4_1_MapPix_Dif())/100)+Vis_4_1_MapSizeMinPix())}},
               label=Vis1_Map_Popup
          )%>%
            addCircleMarkers(data=MapVis4_1_SelectedWB_SHP(),
                             group='Selected Waterbodies',
                             stroke=FALSE,
                             fillOpacity=1,
                    fillColor =if(input$Vis1_Map_CreelDisplayType=="Scaled Size"){Vis_4_1_MapColorSolid()}else{if(input$Vis1_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis1_MapDisplayField))}else{~pal2(ColorPercentile_Vis1)}},
                    radius=if(input$Vis1_Map_CreelDisplayType=="Scaled Color"){Vis_4_1_MapSizeSingle()}else{if(input$Vis1_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis1_MapDisplayField_Size)-Vis_4_1_MapSizeMin())*Vis_4_1_MapPix_Dif())/Vis_4_1_MapSizeDenom())+Vis_4_1_MapSizeMinPix()))}else{~(((SizePercentile_Vis1*Vis_4_1_MapPix_Dif())/100)+Vis_4_1_MapSizeMinPix())}},
                   label=Vis1_Map_Popup_Sel,
                             options=pathOptions(pane="SelectedWBs"))

      },ignoreInit=TRUE)
  

    observeEvent(c(
      input$DisplayCreel_Map_Vis_1,
      input$Vis1_Map_CreelDisplayType,
      input$Vis1_AddLegend_Switch,
      input$Vis1_MapColorPalette,
      MapVis4_1_PercentilesPalRange(),
      input$Vis1_Map_PalToggle,
      input$Vis1_Map_CreelColorscalePer
    ),{
      req(length(Creel_SHP_Vis4_1())>0)
      req(input$Vis1_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_1_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})


      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }


      if(input$Vis1_AddLegend_Switch=="Yes"&&(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both")){
        Vis1_Feature<-input$Vis1_MapDisplayField
         pal <- colorNumeric(input$Vis1_MapColorPalette,MapVis4_1_PalRange()[[1]],reverse=input$Vis1_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis1_MapColorPalette,MapVis4_1_PercentilesPalRange()[[1]],reverse=input$Vis1_Map_PalToggle)

      leafletProxy("MapVis4_1",session)%>%
          removeControl(layerId="Legend")%>%
          addLegend("bottomright",
                pal = if(input$Vis1_Map_CreelColorscalePer=="Values"){pal}else{pal2},
                values=if(input$Vis1_Map_CreelColorscalePer=="Values"){Creel_SHP_Vis4_1()[[Vis1_Feature]]}else{c(0:100)},
                title=if(input$Vis1_Map_CreelColorscalePer=="Values"){paste(Vis1_Feature)}else{paste(Vis1_Feature,"</br>Percentile")},
                group= "CreelCat Data",
                layerId="Legend",
                opacity = 1)
      }else if(input$Vis1_AddLegend_Switch=="No"||input$Vis1_Map_CreelDisplayType=="Scaled Size"){
        leafletProxy("MapVis4_1",session)%>%
          removeControl(layerId="Legend")
      }
    },ignoreInit=TRUE)

    observeEvent(c(
      input$Vis1_CreelExtentZoomBTN,
      input$AF_VisNum_Selection,
      input$DisplayCreel_Map_Vis_1,
      Creel_SHP_Vis4_1(),
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(input$Vis1_Map_CreelDisplayType)
      req(length(Creel_SHP_Vis4_1())>0)
    

      if(input$Vis1_Map_CreelDisplayType=="Scaled Color"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis1_Map_CreelDisplayType=="Scaled Size"||input$Vis1_Map_CreelDisplayType=="Both"){
        req(input$Vis1_MapDisplayField_Size!="Nothing Selected")
      }

       CreelBounds<- st_bbox(Creel_SHP_Vis4_1())%>%as.vector()
        leafletProxy("MapVis4_1",session)%>%
          fitBounds(CreelBounds[1], CreelBounds[2], CreelBounds[3], CreelBounds[4])
    },ignoreInit=TRUE)


    observeEvent({
      input$Vis1_GeographyZoomBTN
    },{
      if(input$Vis1_ZoomToCounty=="Statewide"){
        SelectedStateBounds<-st_bbox(StateBoundaries_SHP[StateBoundaries_SHP$NAME==input$Vis1_ZoomToState,])%>%as.vector()
        leafletProxy("MapVis4_1",session)%>%
          fitBounds(SelectedStateBounds[1], SelectedStateBounds[2], SelectedStateBounds[3], SelectedStateBounds[4])
      }
      if(input$Vis1_ZoomToCounty!="Statewide"){
        SelectedCountyBounds<-st_bbox(CountyBoundaries_SHP%>%filter(State==input$Vis1_ZoomToState & County==input$Vis1_ZoomToCounty))%>%as.vector()
        leafletProxy("MapVis4_1",session)%>%
          fitBounds(SelectedCountyBounds[1], SelectedCountyBounds[2], SelectedCountyBounds[3], SelectedCountyBounds[4])
      }},ignoreInit=TRUE)

    observeEvent(c(
      input$Map_Vis1_Title_Text,
      input$Map_Vis1_Title_Switch
    ),{
      req(length(Creel_SHP_Vis4_1())>0)
      if(input$Map_Vis1_Title_Switch=="Yes"){
        leafletProxy("MapVis4_1",session)%>%
         removeControl(layerId="Map4_1_Title")%>%
          addControl(Map_4_1_Title(),position=c("bottomright"),layerId="Map4_1_Title")
      }else if(input$Map_Vis1_Title_Switch=="No"){
        leafletProxy("MapVis4_1",session)%>%
         removeControl(layerId="Map4_1_Title")
      }
    },ignoreInit=TRUE)
    


  MapVis4_1_SelectedWB_SHP<-reactiveVal(NULL)

  MapVis4_1_area<-reactiveValues()
  Poly_SHP_MapVis4_1<-reactiveVal()

observeEvent(input$MapVis4_1_click, {
  req(input$Vis1_SelectType=="Polygon")
  req(input$Vis1_SelectPolygon=="Draw")

    coords <- input$MapVis4_1_click
    cm <- matrix(data = c(coords$lat, coords$lng), nrow = 1, ncol = 2)
    MapVis4_1_area$mp <- if(!is.null(MapVis4_1_area$mp)){rbind(MapVis4_1_area$mp, cm)}else{cm}

    leafletProxy("MapVis4_1")%>%
      clearGroup("Polygon Draw")%>%
      addPolygons(lat = MapVis4_1_area$mp[ , 1], lng = MapVis4_1_area$mp[ , 2],color="red",fillOpacity=0,group='Polygon Draw',
          options=pathOptions(pane="SelectedArea"))

},ignoreInit=TRUE)

observeEvent(input$Vis1_SelectPolygon, {

  req(input$Vis1_SelectType=="Polygon")
  req(length(MapVis4_1_area$mp)>5)
  req(input$Vis1_SelectPolygon=="Complete")

  Sel_MapVis4_1_area<-as.data.frame(MapVis4_1_area$mp)%>%
    rename(lat=1)%>%
    rename(lng=2)


 Poly_SHP_MapVis4_1(
    polygon_MapVis4_1<-Sel_MapVis4_1_area%>%
  st_as_sf(coords = c("lng", "lat"), crs = 4326)%>%
  summarise(geometry = st_combine(geometry))%>%
  st_cast("POLYGON")
 )
 
 PolyPoints<-Creel_SHP_Vis4_1()%>%
                  filter(st_intersects(.,Poly_SHP_MapVis4_1(),sparse=FALSE)[,1])
 
  MapVis4_1_SelectedWB_SHP(PolyPoints)

},ignoreInit=TRUE)

observeEvent(input$Vis1_SelectPolygon,{

  req(input$Vis1_SelectPolygon=="Clear")
  req(input$Vis1_SelectType=="Polygon")
  
  HighlightTrace_4Vis(NULL)
  All_SelectedWB_4Vis(NULL)
  Data_4_1_Selected(NULL)
  Sel_SurveysScatter_Vis_4_1_UL(NULL) 
  HighlightTrace_Vis_4_1(NULL) 
  MapVis4_1_area$mp<-NULL
  Poly_SHP_MapVis4_1(NULL)
  Sel_SurveysMap_Vis_4_1_UL(NULL)
  Sel_SurveysAll_Vis_4_1_UL(NULL)
  MapVis4_1_SelectedWB_SHP(NULL)

},ignoreInit=TRUE)

State_Clicks_MapVis4_1<-reactiveVal()
SelStatePoly_SHP_MapVis4_1<-reactiveVal()
SelStatePoints_SHP_MapVis4_1<-reactiveVal()
SelStates_Filtered_MapVis4_1<-reactiveVal()

observeEvent(input$MapVis4_1_click, {

  req(input$Vis1_SelectType=="States")
  req(input$Vis1_SelectState=="Select")

      click <- input$MapVis4_1_shape_click

      State_Clicks_MapVis4_1(list(c(State_Clicks_MapVis4_1(),click$id)))

    SelStates_df<-as.data.frame(State_Clicks_MapVis4_1())


    Selected_States_Vector<-as.character(SelStates_df[1,])


    PH<-StateBoundaries_SHP%>%
      filter(., STUSPS %in% Selected_States_Vector)

    SelStates_Filtered_MapVis4_1(PH)


    leafletProxy("MapVis4_1")%>%
      clearGroup("Selected States")%>%
      addPolygons(data=SelStates_Filtered_MapVis4_1(),color="red",weight=3,fillOpacity=0,group='Selected States',
          options=pathOptions(pane="SelectedArea"))
  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectState, {

  req(input$Vis1_SelectType=="States")
  req(input$Vis1_SelectState=="Complete")
  req(!is.null(SelStates_Filtered_MapVis4_1()))

    SelStatePoly_SHP_MapVis4_1(SelStates_Filtered_MapVis4_1())

    State_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis4_1(),SelStatePoly_SHP_MapVis4_1(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    State_Intersects2<-State_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      State_Intersects3<-Creel_SHP_Vis4_1()%>%slice(as.numeric(row.names(State_Intersects2)))

       MapVis4_1_SelectedWB_SHP(State_Intersects3)
  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectState, {
  req(input$Vis1_SelectType=="States")
  req(input$Vis1_SelectState=="Clear")
  
  HighlightTrace_4Vis(NULL)
  All_SelectedWB_4Vis(NULL)
  Data_4_1_Selected(NULL)
  Sel_SurveysScatter_Vis_4_1_UL(NULL) 
  HighlightTrace_Vis_4_1(NULL) 
  MapVis4_1_SelectedWB_SHP(NULL)

    SelStatePoly_SHP_MapVis4_1(NULL)

    State_Clicks_MapVis4_1(NULL)
    SelStates_Filtered_MapVis4_1(NULL)
    SelStatePoints_SHP_MapVis4_1(NULL)
    Sel_SurveysMap_Vis_4_1_UL(NULL)
    Sel_SurveysAll_Vis_4_1_UL(NULL)

  
  },ignoreInit=TRUE)


observeEvent(input$Vis1_SelectType, {

  req(input$Vis1_SelectType=="States")

    leafletProxy("MapVis4_1")%>%
      hideGroup("County Boundaries")%>%
      showGroup("State Boundaries")
})

observeEvent(input$Vis1_SelectType, {

  req(input$Vis1_SelectType=="Counties")

    leafletProxy("MapVis4_1")%>%
      hideGroup("State Boundaries")%>%
      showGroup("County Boundaries")
},ignoreInit=TRUE)


County_Clicks_MapVis4_1<-reactiveVal()
SelCountyPoly_SHP_MapVis4_1<-reactiveVal()
SelCountyPoints_SHP_MapVis4_1<-reactiveVal()
SelCounties_Filtered_MapVis4_1<-reactiveVal()

observeEvent(input$MapVis4_1_click, {

  req(input$Vis1_SelectType=="Counties")
  req(input$Vis1_SelectCounty=="Select")

      click <- input$MapVis4_1_shape_click

      County_Clicks_MapVis4_1(list(c(County_Clicks_MapVis4_1(),click$id)))

    SelCounties_df<-as.data.frame(County_Clicks_MapVis4_1())


    Selected_Counties_Vector<-as.character(SelCounties_df[1,])


    PH<-CountyBoundaries_SHP%>%
      filter(., County_ID %in% Selected_Counties_Vector)

    SelCounties_Filtered_MapVis4_1(PH)

    leafletProxy("MapVis4_1")%>%
      clearGroup("Selected Counties")%>%
      addPolygons(data=SelCounties_Filtered_MapVis4_1(),color="red",weight=3,fillOpacity=0,group='Selected Counties',
          options=pathOptions(pane="SelectedArea"))
  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectCounty, {

  req(input$Vis1_SelectType=="Counties")
  req(input$Vis1_SelectCounty=="Complete")
  req(!is.null(SelCounties_Filtered_MapVis4_1()))



    SelCountyPoly_SHP_MapVis4_1(SelCounties_Filtered_MapVis4_1())

    County_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis4_1(),SelCountyPoly_SHP_MapVis4_1(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    County_Intersects2<-County_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      County_Intersects3<-Creel_SHP_Vis4_1()%>%slice(as.numeric(row.names(County_Intersects2)))


      MapVis4_1_SelectedWB_SHP(County_Intersects3)
  },ignoreInit=TRUE)

observeEvent(input$Vis1_SelectCounty, {
  req(input$Vis1_SelectType=="Counties")
  req(input$Vis1_SelectCounty=="Clear")

    HighlightTrace_4Vis(NULL)
    All_SelectedWB_4Vis(NULL)
    Data_4_1_Selected(NULL)
    Sel_SurveysScatter_Vis_4_1_UL(NULL) 
    HighlightTrace_Vis_4_1(NULL)
    MapVis4_1_SelectedWB_SHP(NULL) 


    SelCountyPoly_SHP_MapVis4_1(NULL)

    County_Clicks_MapVis4_1(NULL)
    SelCounties_Filtered_MapVis4_1(NULL)
    SelCountyPoints_SHP_MapVis4_1(NULL)
    Sel_SurveysMap_Vis_4_1_UL(NULL)
    Sel_SurveysAll_Vis_4_1_UL(NULL) 


  },ignoreInit=TRUE)


    #### Vis 2_2 Map ####

    
  Map_2_2_Title<-eventReactive(c(input$Map_Vis2_Title_Text),{
     PH<-input$Map_Vis2_Title_Text
     return(paste("<span style=\"color:grey50,background-color:rgba(255,255,255,0)\"><strong>",PH,"</span>"))
   })

 Data_2_2_Complete_Percentiles<-reactiveVal(NULL)
   
   observeEvent(c(
     Data_2_2_Complete(),
     input$DisplayCreel_Map_Vis_2,
     input$Vis2_MapDisplayField,
     input$Vis2_MapDisplayField_Size,
     input$AF_VisNum_Selection
   ),{
     req(input$AF_VisNum_Selection==2)
     req(input$AF_SharedData)
     req(nrow(Data_2_2_Complete())>0)
     

      if(nrow(Data_2_2_Complete())>1){
       PH<-Data_2_2_Complete()%>%
        {if(input$Vis2_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis2=percent_rank(get(input$Vis2_MapDisplayField))*100) else .}%>%
        {if(input$Vis2_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis2=percent_rank(get(input$Vis2_MapDisplayField_Size))*100) else .}
    }else{
      PH<-Data_2_2_Complete()%>%
        {if(input$Vis2_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis2=50) else .}%>%
        {if(input$Vis2_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis2=50) else .}
    } 
      
      
      Data_2_2_Complete_Percentiles(PH)
     
   },ignoreInit=TRUE)

    Creel_SHP_Vis2_2<-eventReactive(Data_2_2_Complete_Percentiles(),{
      req(length(Data_2_2_Complete_Percentiles())>0)
      req(input$SelectVis2=="Map")
      req(input$AF_VisNum_Selection==2)
      sp::merge(x=CreelWaterbodies_SHP,y=Data_2_2_Complete_Percentiles(),by.x="WB_ID",by.y="WB_ID",all.x=FALSE)%>%
        st_jitter(amount=0.002)
      })

  Vis_2_2_MapSizeField<-eventReactive(input$Vis2_MapDisplayField_Size,{
    input$Vis2_MapDisplayField_Size
    })

  Vis_2_2_MapSizeMin<-eventReactive(c(input$Vis2_MapDisplayField_Size,input$Vis_2_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    PH<-Creel_SHP_Vis2_2()%>%
      pull(input$Vis2_MapDisplayField_Size)
      return(min(PH,na.rm=TRUE))
      })

  Vis_2_2_MapSizeMax<-eventReactive(
    c(input$Vis2_MapDisplayField_Size,input$Vis_2_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
      PH<-Creel_SHP_Vis2_2()%>%
        pull(input$Vis2_MapDisplayField_Size)
        return(max(PH,na.rm=TRUE))
      })

  Vis_2_2_MapSizeMinPix<-eventReactive(input$Vis2_MapDisplayField_SizeSlider,{
    input$Vis2_MapDisplayField_SizeSlider[1]
    })

  Vis_2_2_MapSizeMaxPix<-eventReactive(input$Vis2_MapDisplayField_SizeSlider,{
    input$Vis2_MapDisplayField_SizeSlider[2]
    })

  Vis_2_2_MapPix_Dif<-eventReactive(c(Vis_2_2_MapSizeMaxPix(),Vis_2_2_MapSizeMinPix()),{
    Vis_2_2_MapSizeMaxPix()-Vis_2_2_MapSizeMinPix()
    })

  Vis_2_2_MapSizeDenom<-eventReactive(c(Vis_2_2_MapSizeMax(),Vis_2_2_MapSizeMin()),{
    
    req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    
    (Vis_2_2_MapSizeMax()-Vis_2_2_MapSizeMin())
    })

  Vis_2_2_MapSizeSingle<-eventReactive(input$Vis2_MapDisplayField_SizeSliderSingle,{
    input$Vis2_MapDisplayField_SizeSliderSingle
    })

  Vis_2_2_MapColorSolid<-eventReactive(input$Vis2_MapColorSolid,{
    input$Vis2_MapColorSolid
    })

    MapVis2_2_PalRange<-reactive({
      req(length(Creel_SHP_Vis2_2())>0)
    
      req(input$Vis2_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis2_2()%>%
        select(input$Vis2_MapDisplayField)
      })


   MapVis2_2_PercentilesPalRange<-reactive({
      req(length(Creel_SHP_Vis2_2())>0)
      req(Creel_SHP_Vis2_2()$ColorPercentile_Vis2)
    
      req(input$Vis2_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis2_2()%>%
        select(ColorPercentile_Vis2)
      })


    output$MapVis2_2 <- renderLeaflet({
      MapVis2_2_Requirement<-HTML(
       "<span style=\"color:red;background-color:white\"><strong>Click 'Display Creel Data on Map' from sidebar to add your creel data to the map.</span>"
   )


      CreelMap <- leaflet()%>%
        addMapPane("SelectedWBs",zIndex=440)%>%
        addMapPane("CreelData",zIndex=430)%>%
        addMapPane("SelectedArea",zIndex=420)%>%
        addMapPane("SupplementaryData",zIndex=410)%>%
        addProviderTiles("CartoDB.DarkMatter",group="Dark")%>%
        addProviderTiles("CartoDB.Positron",group="Light")%>%
        addWMSTiles(GetURL("USGSImageryTopo"),group="Imagery Topo Hybrid",layers="0")%>%
        addWMSTiles(GetURL("USGSTopo"),group="Topo",layers="0")%>%
        addWMSTiles(GetURL("USGSImageryOnly"),group="Imagery",layers="0")%>%
        addWMSTiles(GetURL("USGSShadedReliefOnly"),group="Shaded Relief",layers="0")%>%
        addWMSTiles(GetURL("USGSHydroCached"),group="Hydrography",layers="0",options =list(format="image/png",transparent=TRUE))%>%
        addPolygons(data=StateBoundaries_SHP,
                    group="State Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 2,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=StateBoundaries_SHP$STUSPS,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE),
        )%>%
        addPolygons(data=CountyBoundaries_SHP,
                    group="County Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 1.5,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=CountyBoundaries_SHP$County_ID,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE)
        )%>%
        addLayersControl(
          baseGroups=isolate(if(input$DarkMode=='Dark'){c("Dark","Light","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}else{c("Light","Dark","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}),
          overlayGroups =c("Creel Data", "State Boundaries","County Boundaries","Hydrography"),
          options = layersControlOptions(collapsed = TRUE))%>%
        hideGroup("County Boundaries")%>%
        hideGroup("Hydrography")%>%
        addMeasure()%>%
        addMiniMap(position="bottomleft",minimized=TRUE,toggleDisplay=TRUE)%>%
        addEasyButton(easyButton(
          icon="fa-globe", title="Zoom to Level 1",
          onClick=JS("function(btn, map){ map.setZoom(3); }")))%>%
        addEasyButton(easyButton(
          icon="fa-crosshairs", title="Locate Me",
          onClick=JS("function(btn, map){ map.locate({setView: true, maxZoom: 10}); }")))%>%
        onRender(
          "function(el, x) {
            L.easyPrint({
              sizeModes: ['Current', 'A4Landscape', 'A4Portrait'],
              filename: 'mymap',
              exportOnly: true,
              hideControlContainer: false
            }).addTo(this);
            }"
        )%>%
      addControl(MapVis2_2_Requirement,position="topright",layerId="ShowCreelMessage")
    })
    
  observeEvent(c(
    input$DarkMode,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
  ),{
    req(length(Creel_SHP_Vis2_2())>0)
    if(input$DarkMode=="Dark"){
      leafletProxy("MapVis2_2",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Light")%>%
        showGroup("Dark")
    }
        if(input$DarkMode=="Light"){
      leafletProxy("MapVis2_2",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Dark")%>%
        showGroup("Light")
    }
  },ignoreInit=TRUE)      

  observeEvent(c(
     MapVis2_2_SelectedWB_SHP(),
     MapVis2_2_PercentilesPalRange(),
    input$DisplayCreel_Map_Vis_2,
    input$Vis2_MapColorPalette,
    input$Vis2_Map_PalToggle,
    input$Vis2_Map_CreelColorscalePer,
    input$Vis2_MapDisplayField_SizeSlider,
    input$Vis2_MapColorSolid,
    input$Vis2_MapDisplayField_SizeSliderSingle,
    input$Vis2_Map_CreelSizescalePer,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis2_2())>0)
      req(input$Vis2_Map_CreelDisplayType)
      req(is.null(MapVis2_2_SelectedWB_SHP()))

      if(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis2_Map_CreelDisplayType=="Scaled Size"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField_Size!="Nothing Selected")
      }


      Vis2_Map_Popup<- if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,Creel_SHP_Vis2_2()[[input$Vis2_MapDisplayField]],Creel_SHP_Vis2_2()$Waterbody_Name_Unique,Creel_SHP_Vis2_2()$Year,Creel_SHP_Vis2_2()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField_Size,Creel_SHP_Vis2_2()[[input$Vis2_MapDisplayField_Size]],Creel_SHP_Vis2_2()$Waterbody_Name_Unique,Creel_SHP_Vis2_2()$Year,Creel_SHP_Vis2_2()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,Creel_SHP_Vis2_2()[[input$Vis2_MapDisplayField]],input$Vis2_MapDisplayField_Size,Creel_SHP_Vis2_2()[[input$Vis2_MapDisplayField_Size]],Creel_SHP_Vis2_2()$Waterbody_Name_Unique,Creel_SHP_Vis2_2()$Year,Creel_SHP_Vis2_2()$Survey_ID)%>% lapply(htmltools::HTML)
      }

         pal <- colorNumeric(input$Vis2_MapColorPalette,MapVis2_2_PalRange()[[1]],reverse=input$Vis2_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis2_MapColorPalette,MapVis2_2_PercentilesPalRange()[[1]],reverse=input$Vis2_Map_PalToggle) 
        
       leafletProxy("MapVis2_2",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis2_2(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis2_2()$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 1,
                fillOpacity=1,
                stroke=FALSE,
                fillColor =if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){Vis_2_2_MapColorSolid()}else{if(input$Vis2_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis2_MapDisplayField))}else{~pal2(ColorPercentile_Vis2)}},
                radius=if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){Vis_2_2_MapSizeSingle()}else{if(input$Vis2_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis2_MapDisplayField_Size)-Vis_2_2_MapSizeMin())*Vis_2_2_MapPix_Dif())/Vis_2_2_MapSizeDenom())+Vis_2_2_MapSizeMinPix()))}else{~(((SizePercentile_Vis2*Vis_2_2_MapPix_Dif())/100)+Vis_2_2_MapSizeMinPix())}},
               label=Vis2_Map_Popup
      )

      },ignoreInit=TRUE)

  observeEvent(c(
     MapVis2_2_SelectedWB_SHP(),
    input$DisplayCreel_Map_Vis_2,
    input$Vis2_MapColorPalette,
    input$Vis2_Map_PalToggle,
     MapVis2_2_PercentilesPalRange(),
    input$Vis2_Map_CreelColorscalePer,
    input$Vis2_MapDisplayField_SizeSlider,
    input$Vis2_MapColorSolid,
    input$Vis2_MapDisplayField_SizeSliderSingle,
    input$Vis2_Map_CreelSizescalePer,
    input$Vis2_FillOpacity,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis2_2())>0)
      req(input$Vis2_Map_CreelDisplayType)
      req(!is.null(MapVis2_2_SelectedWB_SHP()))

      if(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis2_Map_CreelDisplayType=="Scaled Size"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField_Size!="Nothing Selected")
      }


      Vis2_Map_Popup<- if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,Creel_SHP_Vis2_2()[[input$Vis2_MapDisplayField]],Creel_SHP_Vis2_2()$Waterbody_Name_Unique,Creel_SHP_Vis2_2()$Year,Creel_SHP_Vis2_2()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField_Size,Creel_SHP_Vis2_2()[[input$Vis2_MapDisplayField_Size]],Creel_SHP_Vis2_2()$Waterbody_Name_Unique,Creel_SHP_Vis2_2()$Year,Creel_SHP_Vis2_2()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,Creel_SHP_Vis2_2()[[input$Vis2_MapDisplayField]],input$Vis2_MapDisplayField_Size,Creel_SHP_Vis2_2()[[input$Vis2_MapDisplayField_Size]],Creel_SHP_Vis2_2()$Waterbody_Name_Unique,Creel_SHP_Vis2_2()$Year,Creel_SHP_Vis2_2()$Survey_ID)%>% lapply(htmltools::HTML)
      }
      
    Vis2_Map_Popup_Sel<-if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,MapVis2_2_SelectedWB_SHP()[[input$Vis2_MapDisplayField]],MapVis2_2_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis2_2_SelectedWB_SHP()$Year,MapVis2_2_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField_Size,MapVis2_2_SelectedWB_SHP()[[input$Vis2_MapDisplayField_Size]],MapVis2_2_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis2_2_SelectedWB_SHP()$Year,MapVis2_2_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,MapVis2_2_SelectedWB_SHP()[[input$Vis2_MapDisplayField]],input$Vis2_MapDisplayField_Size,MapVis2_2_SelectedWB_SHP()[[input$Vis2_MapDisplayField_Size]],MapVis2_2_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis2_2_SelectedWB_SHP()$Year,MapVis2_2_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      }
    

         pal <- colorNumeric(input$Vis2_MapColorPalette,MapVis2_2_PalRange()[[1]],reverse=input$Vis2_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis2_MapColorPalette,MapVis2_2_PercentilesPalRange()[[1]],reverse=input$Vis2_Map_PalToggle) 
        
       leafletProxy("MapVis2_2",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis2_2(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis2_2()$FID),
                options=pathOptions(pane="CreelData"),
                fillOpacity=input$Vis2_FillOpacity,
                stroke=FALSE,
                fillColor =if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){Vis_2_2_MapColorSolid()}else{if(input$Vis2_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis2_MapDisplayField))}else{~pal2(ColorPercentile_Vis2)}},
                radius=if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){Vis_2_2_MapSizeSingle()}else{if(input$Vis2_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis2_MapDisplayField_Size)-Vis_2_2_MapSizeMin())*Vis_2_2_MapPix_Dif())/Vis_2_2_MapSizeDenom())+Vis_2_2_MapSizeMinPix()))}else{~(((SizePercentile_Vis2*Vis_2_2_MapPix_Dif())/100)+Vis_2_2_MapSizeMinPix())}},
               label=Vis2_Map_Popup
      )%>%
        addCircleMarkers(data=MapVis2_2_SelectedWB_SHP(),
                         group='Selected Waterbodies',
                         stroke=FALSE,
                         fillOpacity=1,
                fillColor =if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){Vis_2_2_MapColorSolid()}else{if(input$Vis2_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis2_MapDisplayField))}else{~pal2(ColorPercentile_Vis2)}},
                radius=if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){Vis_2_2_MapSizeSingle()}else{if(input$Vis2_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis2_MapDisplayField_Size)-Vis_2_2_MapSizeMin())*Vis_2_2_MapPix_Dif())/Vis_2_2_MapSizeDenom())+Vis_2_2_MapSizeMinPix()))}else{~(((SizePercentile_Vis2*Vis_2_2_MapPix_Dif())/100)+Vis_2_2_MapSizeMinPix())}},
               label=Vis2_Map_Popup_Sel,
                         options=pathOptions(pane="SelectedWBs"))

      },ignoreInit=TRUE)
  

    observeEvent(c(
      input$DisplayCreel_Map_Vis_2,
      input$Vis2_Map_CreelDisplayType,
      input$Vis2_AddLegend_Switch,
      input$Vis2_MapColorPalette,
      input$Vis2_Map_PalToggle,
      MapVis2_2_PercentilesPalRange(),
      input$Vis2_MapDisplayField_Size,
      input$Vis2_Map_CreelColorscalePer
    ),{
      req(length(Creel_SHP_Vis2_2())>0)
      req(input$Vis2_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    

      if(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis2_Map_CreelDisplayType=="Scaled Size"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField_Size!="Nothing Selected")
      }


      if(input$Vis2_AddLegend_Switch=="Yes"&&(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both")){
        Vis2_Feature<-input$Vis2_MapDisplayField
         pal <- colorNumeric(input$Vis2_MapColorPalette,MapVis2_2_PalRange()[[1]],reverse=input$Vis2_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis2_MapColorPalette,MapVis2_2_PercentilesPalRange()[[1]],reverse=input$Vis2_Map_PalToggle) 
        
        leafletProxy("MapVis2_2",session)%>%
          removeControl(layerId="Legend")%>%
          addLegend("bottomright",
                pal = if(input$Vis2_Map_CreelColorscalePer=="Values"){pal}else{pal2},
                values=if(input$Vis2_Map_CreelColorscalePer=="Values"){Creel_SHP_Vis2_2()[[Vis2_Feature]]}else{c(0:100)},
                title=if(input$Vis2_Map_CreelColorscalePer=="Values"){paste(Vis2_Feature)}else{paste(Vis2_Feature,"</br>Percentile")},
                group= "CreelCat Data",
                layerId="Legend",
                opacity = 1)
      }else if(input$Vis2_AddLegend_Switch=="No"||input$Vis2_Map_CreelDisplayType=="Scaled Size"){
        leafletProxy("MapVis2_2",session)%>%
          removeControl(layerId="Legend")
      }
    },ignoreInit=TRUE)

    observeEvent(c(
      input$Vis2_CreelExtentZoomBTN,
      input$AF_VisNum_Selection,
      input$DisplayCreel_Map_Vis_2,
      Creel_SHP_Vis2_2(),
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(input$Vis2_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    

      if(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis2_Map_CreelDisplayType=="Scaled Size"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField_Size!="Nothing Selected")
      }

       CreelBounds<- st_bbox(Creel_SHP_Vis2_2())%>%as.vector()
        leafletProxy("MapVis2_2",session)%>%
          fitBounds(CreelBounds[1], CreelBounds[2], CreelBounds[3], CreelBounds[4])
    },ignoreInit=TRUE)


    observeEvent({
      input$Vis2_GeographyZoomBTN
    },{
      if(input$Vis2_ZoomToCounty=="Statewide"){
        SelectedStateBounds<-st_bbox(StateBoundaries_SHP[StateBoundaries_SHP$NAME==input$Vis2_ZoomToState,])%>%as.vector()
        leafletProxy("MapVis2_2",session)%>%
          fitBounds(SelectedStateBounds[1], SelectedStateBounds[2], SelectedStateBounds[3], SelectedStateBounds[4])
      }
      if(input$Vis2_ZoomToCounty!="Statewide"){
        SelectedCountyBounds<-st_bbox(CountyBoundaries_SHP%>%filter(State==input$Vis2_ZoomToState & County==input$Vis2_ZoomToCounty))%>%as.vector()
        leafletProxy("MapVis2_2",session)%>%
          fitBounds(SelectedCountyBounds[1], SelectedCountyBounds[2], SelectedCountyBounds[3], SelectedCountyBounds[4])
      }},ignoreInit=TRUE)

    observeEvent(c(
      input$Map_Vis2_Title_Text,
      input$Map_Vis2_Title_Switch
    ),{
      req(length(Creel_SHP_Vis2_2())>0)
      if(input$Map_Vis2_Title_Switch=="Yes"){
        leafletProxy("MapVis2_2",session)%>%
         removeControl(layerId="Map2_2_Title")%>%
          addControl(Map_2_2_Title(),position=c("bottomright"),layerId="Map2_2_Title")
      }else if(input$Map_Vis2_Title_Switch=="No"){
        leafletProxy("MapVis2_2",session)%>%
         removeControl(layerId="Map2_2_Title")
      }
    },ignoreInit=TRUE)
    

MapVis2_2_SelectedWB_SHP<-reactiveVal(NULL)
    
MapVis2_2_area<-reactiveValues()

Poly_SHP_MapVis2_2<-reactiveVal()

observeEvent(input$MapVis2_2_click, {
  req(input$Vis2_SelectType=="Polygon")
  req(input$Vis2_SelectPolygon=="Draw")

    coords <- input$MapVis2_2_click
    cm <- matrix(data = c(coords$lat, coords$lng), nrow = 1, ncol = 2)
    MapVis2_2_area$mp <- if(!is.null(MapVis2_2_area$mp)){rbind(MapVis2_2_area$mp, cm)}else{cm}

    leafletProxy("MapVis2_2")%>%
      clearGroup("Polygon Draw")%>%
      addPolygons(lat = MapVis2_2_area$mp[ , 1], lng = MapVis2_2_area$mp[ , 2],color="red",fillOpacity=0,group='Polygon Draw',
          options=pathOptions(pane="SelectedArea"))

},ignoreInit=TRUE)

observeEvent(input$Vis2_SelectPolygon, {

  req(input$Vis2_SelectType=="Polygon")
  req(length(MapVis2_2_area$mp)>5)
  req(input$Vis2_SelectPolygon=="Complete")

  Sel_MapVis2_2_area<-as.data.frame(MapVis2_2_area$mp)%>%
    rename(lat=1)%>%
    rename(lng=2)



 Poly_SHP_MapVis2_2(
    polygon_MapVis2_2<-Sel_MapVis2_2_area%>%
  st_as_sf(coords = c("lng", "lat"), crs = 4326)%>%
  summarise(geometry = st_combine(geometry))%>%
  st_cast("POLYGON")
 )
 
 PolyPoints<-Creel_SHP_Vis2_2()%>%
                  filter(st_intersects(.,Poly_SHP_MapVis2_2(),sparse=FALSE)[,1])
 
  MapVis2_2_SelectedWB_SHP(PolyPoints)

},ignoreInit=TRUE)

observeEvent(input$Vis2_SelectPolygon,{

  req(input$Vis2_SelectPolygon=="Clear")
  req(input$Vis2_SelectType=="Polygon")
  
  HighlightTrace_2Vis(NULL)
  All_SelectedWB_2Vis(NULL)
  Data_2_2_Selected(NULL)
  Sel_SurveysScatter_Vis_2_2_UL(NULL) 
  HighlightTrace_Vis_2_2(NULL) 
  MapVis2_2_SelectedWB_SHP(NULL)
  

  MapVis2_2_area$mp<-NULL

  Poly_SHP_MapVis2_2(NULL)


  Vis2_Map_Popup<- if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,Creel_SHP_Vis2_2()[[input$Vis2_MapDisplayField]],Creel_SHP_Vis2_2()$Waterbody_Name_Unique,Creel_SHP_Vis2_2()$Year,Creel_SHP_Vis2_2()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField_Size,Creel_SHP_Vis2_2()[[input$Vis2_MapDisplayField_Size]],Creel_SHP_Vis2_2()$Waterbody_Name_Unique,Creel_SHP_Vis2_2()$Year,Creel_SHP_Vis2_2()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,Creel_SHP_Vis2_2()[[input$Vis2_MapDisplayField]],input$Vis2_MapDisplayField_Size,Creel_SHP_Vis2_2()[[input$Vis2_MapDisplayField_Size]],Creel_SHP_Vis2_2()$Waterbody_Name_Unique,Creel_SHP_Vis2_2()$Year,Creel_SHP_Vis2_2()$Survey_ID)%>% lapply(htmltools::HTML)
      }
         pal <- colorNumeric(input$Vis2_MapColorPalette,MapVis2_2_PalRange()[[1]],reverse=input$Vis2_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis2_MapColorPalette,MapVis2_2_PercentilesPalRange()[[1]],reverse=input$Vis2_Map_PalToggle) 

    Sel_SurveysMap_Vis_2_2_UL(NULL)
    Sel_SurveysAll_Vis_2_2_UL(NULL)
  

},ignoreInit=TRUE)

State_Clicks_MapVis2_2<-reactiveVal()
SelStatePoly_SHP_MapVis2_2<-reactiveVal()
SelStatePoints_SHP_MapVis2_2<-reactiveVal()
SelStates_Filtered_MapVis2_2<-reactiveVal()

observeEvent(input$MapVis2_2_click, {

  req(input$Vis2_SelectType=="States")
  req(input$Vis2_SelectState=="Select")

      click <- input$MapVis2_2_shape_click

      State_Clicks_MapVis2_2(list(c(State_Clicks_MapVis2_2(),click$id)))

    SelStates_df<-as.data.frame(State_Clicks_MapVis2_2())


    Selected_States_Vector<-as.character(SelStates_df[1,])


    PH<-StateBoundaries_SHP%>%
      filter(., STUSPS %in% Selected_States_Vector)

    SelStates_Filtered_MapVis2_2(PH)


    leafletProxy("MapVis2_2")%>%
      clearGroup("Selected States")%>%
      addPolygons(data=SelStates_Filtered_MapVis2_2(),color="red",weight=3,fillOpacity=0,group='Selected States',
          options=pathOptions(pane="SelectedArea"))
  },ignoreInit=TRUE)

observeEvent(input$Vis2_SelectState, {

  req(input$Vis2_SelectType=="States")
  req(input$Vis2_SelectState=="Complete")
  req(!is.null(SelStates_Filtered_MapVis2_2()))

    SelStatePoly_SHP_MapVis2_2(SelStates_Filtered_MapVis2_2())

    State_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis2_2(),SelStatePoly_SHP_MapVis2_2(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    State_Intersects2<-State_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      State_Intersects3<-Creel_SHP_Vis2_2()%>%slice(as.numeric(row.names(State_Intersects2)))


       MapVis2_2_SelectedWB_SHP(State_Intersects3)

  },ignoreInit=TRUE)

observeEvent(input$Vis2_SelectState, {
  req(input$Vis2_SelectType=="States")
  req(input$Vis2_SelectState=="Clear")
  
  HighlightTrace_2Vis(NULL)
  All_SelectedWB_2Vis(NULL)
  Data_2_2_Selected(NULL)
  Sel_SurveysScatter_Vis_2_2_UL(NULL) 
  HighlightTrace_Vis_2_2(NULL) 
  MapVis2_2_SelectedWB_SHP(NULL)


    SelStatePoly_SHP_MapVis2_2(NULL)

    State_Clicks_MapVis2_2(NULL)
    SelStates_Filtered_MapVis2_2(NULL)
    SelStatePoints_SHP_MapVis2_2(NULL)
    Sel_SurveysMap_Vis_2_2_UL(NULL)
    Sel_SurveysAll_Vis_2_2_UL(NULL)

  },ignoreInit=TRUE)



observeEvent(input$Vis2_SelectType, {

  req(input$Vis2_SelectType=="States")

    leafletProxy("MapVis2_2")%>%
      hideGroup("County Boundaries")%>%
      showGroup("State Boundaries")
},ignoreInit=TRUE)

observeEvent(input$Vis2_SelectType, {

  req(input$Vis2_SelectType=="Counties")

    leafletProxy("MapVis2_2")%>%
      hideGroup("State Boundaries")%>%
      showGroup("County Boundaries")
},ignoreInit=TRUE)


County_Clicks_MapVis2_2<-reactiveVal()
SelCountyPoly_SHP_MapVis2_2<-reactiveVal()
SelCountyPoints_SHP_MapVis2_2<-reactiveVal()
SelCounties_Filtered_MapVis2_2<-reactiveVal()

observeEvent(input$MapVis2_2_click, {

  req(input$Vis2_SelectType=="Counties")
  req(input$Vis2_SelectCounty=="Select")

      click <- input$MapVis2_2_shape_click

      County_Clicks_MapVis2_2(list(c(County_Clicks_MapVis2_2(),click$id)))

    SelCounties_df<-as.data.frame(County_Clicks_MapVis2_2())


    Selected_Counties_Vector<-as.character(SelCounties_df[1,])


    PH<-CountyBoundaries_SHP%>%
      filter(., County_ID %in% Selected_Counties_Vector)

    SelCounties_Filtered_MapVis2_2(PH)

    leafletProxy("MapVis2_2")%>%
      clearGroup("Selected Counties")%>%
      addPolygons(data=SelCounties_Filtered_MapVis2_2(),color="red",weight=3,fillOpacity=0,group='Selected Counties',
          options=pathOptions(pane="SelectedArea"))



  },ignoreInit=TRUE)

observeEvent(input$Vis2_SelectCounty, {

  req(input$Vis2_SelectType=="Counties")
  req(input$Vis2_SelectCounty=="Complete")
  req(!is.null(SelCounties_Filtered_MapVis2_2()))



    SelCountyPoly_SHP_MapVis2_2(SelCounties_Filtered_MapVis2_2())

    County_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis2_2(),SelCountyPoly_SHP_MapVis2_2(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    County_Intersects2<-County_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      County_Intersects3<-Creel_SHP_Vis2_2()%>%slice(as.numeric(row.names(County_Intersects2)))

      MapVis2_2_SelectedWB_SHP(County_Intersects3)

  },ignoreInit=TRUE)

observeEvent(input$Vis2_SelectCounty, {
  req(input$Vis2_SelectType=="Counties")
  req(input$Vis2_SelectCounty=="Clear")

    HighlightTrace_2Vis(NULL)
    All_SelectedWB_2Vis(NULL)
    Data_2_2_Selected(NULL)
    Sel_SurveysScatter_Vis_2_2_UL(NULL) 
    HighlightTrace_Vis_2_2(NULL) 
  MapVis2_2_SelectedWB_SHP(NULL)


    SelCountyPoly_SHP_MapVis2_2(NULL)

    County_Clicks_MapVis2_2(NULL)
    SelCounties_Filtered_MapVis2_2(NULL)
    SelCountyPoints_SHP_MapVis2_2(NULL)
    Sel_SurveysMap_Vis_2_2_UL(NULL)
    Sel_SurveysAll_Vis_2_2_UL(NULL)


  },ignoreInit=TRUE)

   #### Vis 3_2 Map ####

    
  Map_3_2_Title<-eventReactive(c(input$Map_Vis2_Title_Text),{
     PH<-input$Map_Vis2_Title_Text
     return(paste("<span style=\"color:grey50,background-color:rgba(255,255,255,0)\"><strong>",PH,"</span>"))
   })

 Data_3_2_Complete_Percentiles<-reactiveVal(NULL)
   
   observeEvent(c(
     Data_3_2_Complete(),
     input$DisplayCreel_Map_Vis_2,
     input$Vis2_MapDisplayField,
     input$Vis2_MapDisplayField_Size,
     input$AF_VisNum_Selection
   ),{
     req(input$AF_VisNum_Selection==3)
     req(input$AF_SharedData)
     req(nrow(Data_3_2_Complete())>0)
     
    
      if(nrow(Data_3_2_Complete())>1){
       PH<-Data_3_2_Complete()%>%
        {if(input$Vis2_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis2=percent_rank(get(input$Vis2_MapDisplayField))*100) else .}%>%
        {if(input$Vis2_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis2=percent_rank(get(input$Vis2_MapDisplayField_Size))*100) else .}
    }else{
      PH<-Data_3_2_Complete()%>%
        {if(input$Vis2_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis2=50) else .}%>%
        {if(input$Vis2_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis2=50) else .}
    } 
      
      
      Data_3_2_Complete_Percentiles(PH)
     
   },ignoreInit=TRUE)

    Creel_SHP_Vis3_2<-eventReactive(Data_3_2_Complete_Percentiles(),{
      req(length(Data_3_2_Complete_Percentiles())>0)
      req(input$SelectVis2=="Map")
      req(input$AF_VisNum_Selection==3)
      sp::merge(x=CreelWaterbodies_SHP,y=Data_3_2_Complete_Percentiles(),by.x="WB_ID",by.y="WB_ID",all.x=FALSE)%>%
        st_jitter(amount=0.002)
      })

  Vis_3_2_MapSizeField<-eventReactive(input$Vis2_MapDisplayField_Size,{
    input$Vis2_MapDisplayField_Size
    })

  Vis_3_2_MapSizeMin<-eventReactive(c(input$Vis2_MapDisplayField_Size,input$Vis_2_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    PH<-Creel_SHP_Vis3_2()%>%
      pull(input$Vis2_MapDisplayField_Size)
      return(min(PH,na.rm=TRUE))
      })

  Vis_3_2_MapSizeMax<-eventReactive(
    c(input$Vis2_MapDisplayField_Size,input$Vis_2_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
      PH<-Creel_SHP_Vis3_2()%>%
        pull(input$Vis2_MapDisplayField_Size)
        return(max(PH,na.rm=TRUE))
      })

  Vis_3_2_MapSizeMinPix<-eventReactive(input$Vis2_MapDisplayField_SizeSlider,{
    input$Vis2_MapDisplayField_SizeSlider[1]
    })

  Vis_3_2_MapSizeMaxPix<-eventReactive(input$Vis2_MapDisplayField_SizeSlider,{
    input$Vis2_MapDisplayField_SizeSlider[2]
    })

  Vis_3_2_MapPix_Dif<-eventReactive(c(Vis_3_2_MapSizeMaxPix(),Vis_3_2_MapSizeMinPix()),{
    Vis_3_2_MapSizeMaxPix()-Vis_3_2_MapSizeMinPix()
    })

  Vis_3_2_MapSizeDenom<-eventReactive(c(Vis_3_2_MapSizeMax(),Vis_3_2_MapSizeMin()),{
    
    req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    
    (Vis_3_2_MapSizeMax()-Vis_3_2_MapSizeMin())
    })

  Vis_3_2_MapSizeSingle<-eventReactive(input$Vis2_MapDisplayField_SizeSliderSingle,{
    input$Vis2_MapDisplayField_SizeSliderSingle
    })

  Vis_3_2_MapColorSolid<-eventReactive(input$Vis2_MapColorSolid,{
    input$Vis2_MapColorSolid
    })

    MapVis3_2_PalRange<-reactive({
      req(length(Creel_SHP_Vis3_2())>0)
    
      req(input$Vis2_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis3_2()%>%
        select(input$Vis2_MapDisplayField)
      })


   MapVis3_2_PercentilesPalRange<-reactive({
      req(length(Creel_SHP_Vis3_2())>0)
      req(Creel_SHP_Vis3_2()$ColorPercentile_Vis2)
    
      req(input$Vis2_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis3_2()%>%
        select(ColorPercentile_Vis2)
      })


    output$MapVis3_2 <- renderLeaflet({
      MapVis3_2_Requirement<-HTML(
       "<span style=\"color:red;background-color:white\"><strong>Click 'Display Creel Data on Map' from sidebar to add your creel data to the map.</span>"
   )


      CreelMap <- leaflet()%>%
        addMapPane("SelectedWBs",zIndex=440)%>%
        addMapPane("CreelData",zIndex=430)%>%
        addMapPane("SelectedArea",zIndex=420)%>%
        addMapPane("SupplementaryData",zIndex=410)%>%
        addProviderTiles("CartoDB.DarkMatter",group="Dark")%>%
        addProviderTiles("CartoDB.Positron",group="Light")%>%
        addWMSTiles(GetURL("USGSImageryTopo"),group="Imagery Topo Hybrid",layers="0")%>%
        addWMSTiles(GetURL("USGSTopo"),group="Topo",layers="0")%>%
        addWMSTiles(GetURL("USGSImageryOnly"),group="Imagery",layers="0")%>%
        addWMSTiles(GetURL("USGSShadedReliefOnly"),group="Shaded Relief",layers="0")%>%
        addWMSTiles(GetURL("USGSHydroCached"),group="Hydrography",layers="0",options =list(format="image/png",transparent=TRUE))%>%
        addPolygons(data=StateBoundaries_SHP,
                    group="State Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 2,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=StateBoundaries_SHP$STUSPS,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE),
        )%>%
        addPolygons(data=CountyBoundaries_SHP,
                    group="County Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 1.5,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=CountyBoundaries_SHP$County_ID,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE)
        )%>%
        addLayersControl(
          baseGroups=isolate(if(input$DarkMode=='Dark'){c("Dark","Light","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}else{c("Light","Dark","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}),
          overlayGroups =c("Creel Data", "State Boundaries","County Boundaries","Hydrography"),
          options = layersControlOptions(collapsed = TRUE))%>%
        hideGroup("County Boundaries")%>%
        hideGroup("Hydrography")%>%
        addMeasure()%>%
        addMiniMap(position="bottomleft",minimized=TRUE,toggleDisplay=TRUE)%>%
        addEasyButton(easyButton(
          icon="fa-globe", title="Zoom to Level 1",
          onClick=JS("function(btn, map){ map.setZoom(3); }")))%>%
        addEasyButton(easyButton(
          icon="fa-crosshairs", title="Locate Me",
          onClick=JS("function(btn, map){ map.locate({setView: true, maxZoom: 10}); }")))%>%
        onRender(
          "function(el, x) {
            L.easyPrint({
              sizeModes: ['Current', 'A4Landscape', 'A4Portrait'],
              filename: 'mymap',
              exportOnly: true,
              hideControlContainer: false
            }).addTo(this);
            }"
        )%>%
      addControl(MapVis3_2_Requirement,position="topright",layerId="ShowCreelMessage")
    })
    
  observeEvent(c(
    input$DarkMode,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
  ),{
    req(length(Creel_SHP_Vis3_2())>0)
    if(input$DarkMode=="Dark"){
      leafletProxy("MapVis3_2",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Light")%>%
        showGroup("Dark")
    }
        if(input$DarkMode=="Light"){
      leafletProxy("MapVis3_2",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Dark")%>%
        showGroup("Light")
    }
  },ignoreInit=TRUE)      

  observeEvent(c(
     MapVis3_2_SelectedWB_SHP(),
     MapVis3_2_PercentilesPalRange(),
    input$DisplayCreel_Map_Vis_2,
    input$Vis2_MapColorPalette,
    input$Vis2_Map_PalToggle,
    input$Vis2_Map_CreelColorscalePer,
    input$Vis2_MapDisplayField_SizeSlider,
    input$Vis2_MapColorSolid,
    input$Vis2_MapDisplayField_SizeSliderSingle,
    input$Vis2_Map_CreelSizescalePer,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis3_2())>0)
      req(input$Vis2_Map_CreelDisplayType)
      req(is.null(MapVis3_2_SelectedWB_SHP()))

      if(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis2_Map_CreelDisplayType=="Scaled Size"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField_Size!="Nothing Selected")
      }


      Vis2_Map_Popup<- if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,Creel_SHP_Vis3_2()[[input$Vis2_MapDisplayField]],Creel_SHP_Vis3_2()$Waterbody_Name_Unique,Creel_SHP_Vis3_2()$Year,Creel_SHP_Vis3_2()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField_Size,Creel_SHP_Vis3_2()[[input$Vis2_MapDisplayField_Size]],Creel_SHP_Vis3_2()$Waterbody_Name_Unique,Creel_SHP_Vis3_2()$Year,Creel_SHP_Vis3_2()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,Creel_SHP_Vis3_2()[[input$Vis2_MapDisplayField]],input$Vis2_MapDisplayField_Size,Creel_SHP_Vis3_2()[[input$Vis2_MapDisplayField_Size]],Creel_SHP_Vis3_2()$Waterbody_Name_Unique,Creel_SHP_Vis3_2()$Year,Creel_SHP_Vis3_2()$Survey_ID)%>% lapply(htmltools::HTML)
      }

         pal <- colorNumeric(input$Vis2_MapColorPalette,MapVis3_2_PalRange()[[1]],reverse=input$Vis2_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis2_MapColorPalette,MapVis3_2_PercentilesPalRange()[[1]],reverse=input$Vis2_Map_PalToggle) 
        
       leafletProxy("MapVis3_2",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis3_2(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis3_2()$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 1,
                fillOpacity=1,
                stroke=FALSE,
                fillColor =if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){Vis_3_2_MapColorSolid()}else{if(input$Vis2_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis2_MapDisplayField))}else{~pal2(ColorPercentile_Vis2)}},
                radius=if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){Vis_3_2_MapSizeSingle()}else{if(input$Vis2_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis2_MapDisplayField_Size)-Vis_3_2_MapSizeMin())*Vis_3_2_MapPix_Dif())/Vis_3_2_MapSizeDenom())+Vis_3_2_MapSizeMinPix()))}else{~(((SizePercentile_Vis2*Vis_3_2_MapPix_Dif())/100)+Vis_3_2_MapSizeMinPix())}},
               label=Vis2_Map_Popup
      )

      },ignoreInit=TRUE)

  observeEvent(c(
     MapVis3_2_SelectedWB_SHP(),
    input$DisplayCreel_Map_Vis_2,
    input$Vis2_MapColorPalette,
    input$Vis2_Map_PalToggle,
     MapVis3_2_PercentilesPalRange(),
    input$Vis2_Map_CreelColorscalePer,
    input$Vis2_MapDisplayField_SizeSlider,
    input$Vis2_MapColorSolid,
    input$Vis2_MapDisplayField_SizeSliderSingle,
    input$Vis2_Map_CreelSizescalePer,
    input$Vis2_FillOpacity,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis3_2())>0)
      req(input$Vis2_Map_CreelDisplayType)
      req(!is.null(MapVis3_2_SelectedWB_SHP()))

      if(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis2_Map_CreelDisplayType=="Scaled Size"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField_Size!="Nothing Selected")
      }


      Vis2_Map_Popup<- if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,Creel_SHP_Vis3_2()[[input$Vis2_MapDisplayField]],Creel_SHP_Vis3_2()$Waterbody_Name_Unique,Creel_SHP_Vis3_2()$Year,Creel_SHP_Vis3_2()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField_Size,Creel_SHP_Vis3_2()[[input$Vis2_MapDisplayField_Size]],Creel_SHP_Vis3_2()$Waterbody_Name_Unique,Creel_SHP_Vis3_2()$Year,Creel_SHP_Vis3_2()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,Creel_SHP_Vis3_2()[[input$Vis2_MapDisplayField]],input$Vis2_MapDisplayField_Size,Creel_SHP_Vis3_2()[[input$Vis2_MapDisplayField_Size]],Creel_SHP_Vis3_2()$Waterbody_Name_Unique,Creel_SHP_Vis3_2()$Year,Creel_SHP_Vis3_2()$Survey_ID)%>% lapply(htmltools::HTML)
      }
      
    Vis2_Map_Popup_Sel<-if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,MapVis3_2_SelectedWB_SHP()[[input$Vis2_MapDisplayField]],MapVis3_2_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis3_2_SelectedWB_SHP()$Year,MapVis3_2_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField_Size,MapVis3_2_SelectedWB_SHP()[[input$Vis2_MapDisplayField_Size]],MapVis3_2_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis3_2_SelectedWB_SHP()$Year,MapVis3_2_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,MapVis3_2_SelectedWB_SHP()[[input$Vis2_MapDisplayField]],input$Vis2_MapDisplayField_Size,MapVis3_2_SelectedWB_SHP()[[input$Vis2_MapDisplayField_Size]],MapVis3_2_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis3_2_SelectedWB_SHP()$Year,MapVis3_2_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      }
    

         pal <- colorNumeric(input$Vis2_MapColorPalette,MapVis3_2_PalRange()[[1]],reverse=input$Vis2_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis2_MapColorPalette,MapVis3_2_PercentilesPalRange()[[1]],reverse=input$Vis2_Map_PalToggle) 
        
       leafletProxy("MapVis3_2",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis3_2(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis3_2()$FID),
                options=pathOptions(pane="CreelData"),
                fillOpacity=input$Vis2_FillOpacity,
                stroke=FALSE,
                fillColor =if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){Vis_3_2_MapColorSolid()}else{if(input$Vis2_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis2_MapDisplayField))}else{~pal2(ColorPercentile_Vis2)}},
                radius=if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){Vis_3_2_MapSizeSingle()}else{if(input$Vis2_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis2_MapDisplayField_Size)-Vis_3_2_MapSizeMin())*Vis_3_2_MapPix_Dif())/Vis_3_2_MapSizeDenom())+Vis_3_2_MapSizeMinPix()))}else{~(((SizePercentile_Vis2*Vis_3_2_MapPix_Dif())/100)+Vis_3_2_MapSizeMinPix())}},
               label=Vis2_Map_Popup
      )%>%
        addCircleMarkers(data=MapVis3_2_SelectedWB_SHP(),
                         group='Selected Waterbodies',
                         stroke=FALSE,
                         fillOpacity=1,
                fillColor =if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){Vis_3_2_MapColorSolid()}else{if(input$Vis2_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis2_MapDisplayField))}else{~pal2(ColorPercentile_Vis2)}},
                radius=if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){Vis_3_2_MapSizeSingle()}else{if(input$Vis2_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis2_MapDisplayField_Size)-Vis_3_2_MapSizeMin())*Vis_3_2_MapPix_Dif())/Vis_3_2_MapSizeDenom())+Vis_3_2_MapSizeMinPix()))}else{~(((SizePercentile_Vis2*Vis_3_2_MapPix_Dif())/100)+Vis_3_2_MapSizeMinPix())}},
               label=Vis2_Map_Popup_Sel,
                         options=pathOptions(pane="SelectedWBs"))

      },ignoreInit=TRUE)
  

    observeEvent(c(
      input$DisplayCreel_Map_Vis_2,
      input$Vis2_Map_CreelDisplayType,
      input$Vis2_AddLegend_Switch,
      input$Vis2_MapColorPalette,
      input$Vis2_Map_PalToggle,
      MapVis3_2_PercentilesPalRange(),
      input$Vis2_MapDisplayField_Size,
      input$Vis2_Map_CreelColorscalePer
    ),{
      req(length(Creel_SHP_Vis3_2())>0)
      req(input$Vis2_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    

      if(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis2_Map_CreelDisplayType=="Scaled Size"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField_Size!="Nothing Selected")
      }


      if(input$Vis2_AddLegend_Switch=="Yes"&&(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both")){
        Vis2_Feature<-input$Vis2_MapDisplayField
         pal <- colorNumeric(input$Vis2_MapColorPalette,MapVis3_2_PalRange()[[1]],reverse=input$Vis2_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis2_MapColorPalette,MapVis3_2_PercentilesPalRange()[[1]],reverse=input$Vis2_Map_PalToggle) 
        
        leafletProxy("MapVis3_2",session)%>%
          removeControl(layerId="Legend")%>%
          addLegend("bottomright",
                pal = if(input$Vis2_Map_CreelColorscalePer=="Values"){pal}else{pal2},
                values=if(input$Vis2_Map_CreelColorscalePer=="Values"){Creel_SHP_Vis3_2()[[Vis2_Feature]]}else{c(0:100)},
                title=if(input$Vis2_Map_CreelColorscalePer=="Values"){paste(Vis2_Feature)}else{paste(Vis2_Feature,"</br>Percentile")},
                group= "CreelCat Data",
                layerId="Legend",
                opacity = 1)
      }else if(input$Vis2_AddLegend_Switch=="No"||input$Vis2_Map_CreelDisplayType=="Scaled Size"){
        leafletProxy("MapVis3_2",session)%>%
          removeControl(layerId="Legend")
      }
    },ignoreInit=TRUE)

    observeEvent(c(
      input$Vis2_CreelExtentZoomBTN,
      input$AF_VisNum_Selection,
      input$DisplayCreel_Map_Vis_2,
      Creel_SHP_Vis3_2(),
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(input$Vis2_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    

      if(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis2_Map_CreelDisplayType=="Scaled Size"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField_Size!="Nothing Selected")
      }

       CreelBounds<- st_bbox(Creel_SHP_Vis3_2())%>%as.vector()
        leafletProxy("MapVis3_2",session)%>%
          fitBounds(CreelBounds[1], CreelBounds[2], CreelBounds[3], CreelBounds[4])
    },ignoreInit=TRUE)


    observeEvent({
      input$Vis2_GeographyZoomBTN
    },{
      if(input$Vis2_ZoomToCounty=="Statewide"){
        SelectedStateBounds<-st_bbox(StateBoundaries_SHP[StateBoundaries_SHP$NAME==input$Vis2_ZoomToState,])%>%as.vector()
        leafletProxy("MapVis3_2",session)%>%
          fitBounds(SelectedStateBounds[1], SelectedStateBounds[2], SelectedStateBounds[3], SelectedStateBounds[4])
      }
      if(input$Vis2_ZoomToCounty!="Statewide"){
        SelectedCountyBounds<-st_bbox(CountyBoundaries_SHP%>%filter(State==input$Vis2_ZoomToState & County==input$Vis2_ZoomToCounty))%>%as.vector()
        leafletProxy("MapVis3_2",session)%>%
          fitBounds(SelectedCountyBounds[1], SelectedCountyBounds[2], SelectedCountyBounds[3], SelectedCountyBounds[4])
      }},ignoreInit=TRUE)

    observeEvent(c(
      input$Map_Vis2_Title_Text,
      input$Map_Vis2_Title_Switch
    ),{
      req(length(Creel_SHP_Vis3_2())>0)
      if(input$Map_Vis2_Title_Switch=="Yes"){
        leafletProxy("MapVis3_2",session)%>%
         removeControl(layerId="Map3_2_Title")%>%
          addControl(Map_3_2_Title(),position=c("bottomright"),layerId="Map3_2_Title")
      }else if(input$Map_Vis2_Title_Switch=="No"){
        leafletProxy("MapVis3_2",session)%>%
         removeControl(layerId="Map3_2_Title")
      }
    },ignoreInit=TRUE)
    

MapVis3_2_SelectedWB_SHP<-reactiveVal(NULL)
    
MapVis3_2_area<-reactiveValues()

Poly_SHP_MapVis3_2<-reactiveVal()

observeEvent(input$MapVis3_2_click, {
  req(input$Vis2_SelectType=="Polygon")
  req(input$Vis2_SelectPolygon=="Draw")

    coords <- input$MapVis3_2_click
    cm <- matrix(data = c(coords$lat, coords$lng), nrow = 1, ncol = 2)
    MapVis3_2_area$mp <- if(!is.null(MapVis3_2_area$mp)){rbind(MapVis3_2_area$mp, cm)}else{cm}

    leafletProxy("MapVis3_2")%>%
      clearGroup("Polygon Draw")%>%
      addPolygons(lat = MapVis3_2_area$mp[ , 1], lng = MapVis3_2_area$mp[ , 2],color="red",fillOpacity=0,group='Polygon Draw',
          options=pathOptions(pane="SelectedArea"))

},ignoreInit=TRUE)

observeEvent(input$Vis2_SelectPolygon, {

  req(input$Vis2_SelectType=="Polygon")
  req(length(MapVis3_2_area$mp)>5)
  req(input$Vis2_SelectPolygon=="Complete")

  Sel_MapVis3_2_area<-as.data.frame(MapVis3_2_area$mp)%>%
    rename(lat=1)%>%
    rename(lng=2)



 Poly_SHP_MapVis3_2(
    polygon_MapVis3_2<-Sel_MapVis3_2_area%>%
  st_as_sf(coords = c("lng", "lat"), crs = 4326)%>%
  summarise(geometry = st_combine(geometry))%>%
  st_cast("POLYGON")
 )
 
 PolyPoints<-Creel_SHP_Vis3_2()%>%
                  filter(st_intersects(.,Poly_SHP_MapVis3_2(),sparse=FALSE)[,1])
 
  MapVis3_2_SelectedWB_SHP(PolyPoints)

},ignoreInit=TRUE)

observeEvent(input$Vis2_SelectPolygon,{

  req(input$Vis2_SelectPolygon=="Clear")
  req(input$Vis2_SelectType=="Polygon")
  
  HighlightTrace_3Vis(NULL)
  All_SelectedWB_3Vis(NULL)
  Data_3_2_Selected(NULL)
  Sel_SurveysScatter_Vis_3_2_UL(NULL) 
  HighlightTrace_Vis_3_2(NULL) 
  MapVis3_2_SelectedWB_SHP(NULL)
  

  MapVis3_2_area$mp<-NULL

  Poly_SHP_MapVis3_2(NULL)

    Sel_SurveysMap_Vis_3_2_UL(NULL)
    Sel_SurveysAll_Vis_3_2_UL(NULL)
  

},ignoreInit=TRUE)

State_Clicks_MapVis3_2<-reactiveVal()
SelStatePoly_SHP_MapVis3_2<-reactiveVal()
SelStatePoints_SHP_MapVis3_2<-reactiveVal()
SelStates_Filtered_MapVis3_2<-reactiveVal()

observeEvent(input$MapVis3_2_click, {

  req(input$Vis2_SelectType=="States")
  req(input$Vis2_SelectState=="Select")

      click <- input$MapVis3_2_shape_click

      State_Clicks_MapVis3_2(list(c(State_Clicks_MapVis3_2(),click$id)))

    SelStates_df<-as.data.frame(State_Clicks_MapVis3_2())


    Selected_States_Vector<-as.character(SelStates_df[1,])


    PH<-StateBoundaries_SHP%>%
      filter(., STUSPS %in% Selected_States_Vector)

    SelStates_Filtered_MapVis3_2(PH)


    leafletProxy("MapVis3_2")%>%
      clearGroup("Selected States")%>%
      addPolygons(data=SelStates_Filtered_MapVis3_2(),color="red",weight=3,fillOpacity=0,group='Selected States',
          options=pathOptions(pane="SelectedArea"))
  },ignoreInit=TRUE)

observeEvent(input$Vis2_SelectState, {

  req(input$Vis2_SelectType=="States")
  req(input$Vis2_SelectState=="Complete")
  req(!is.null(SelStates_Filtered_MapVis3_2()))

    SelStatePoly_SHP_MapVis3_2(SelStates_Filtered_MapVis3_2())

    State_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis3_2(),SelStatePoly_SHP_MapVis3_2(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    State_Intersects2<-State_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      State_Intersects3<-Creel_SHP_Vis3_2()%>%slice(as.numeric(row.names(State_Intersects2)))


       MapVis3_2_SelectedWB_SHP(State_Intersects3)

  },ignoreInit=TRUE)

observeEvent(input$Vis2_SelectState, {
  req(input$Vis2_SelectType=="States")
  req(input$Vis2_SelectState=="Clear")
  
  HighlightTrace_3Vis(NULL)
  All_SelectedWB_3Vis(NULL)
  Data_3_2_Selected(NULL)
  Sel_SurveysScatter_Vis_3_2_UL(NULL) 
  HighlightTrace_Vis_3_2(NULL) 
  MapVis3_2_SelectedWB_SHP(NULL)


    SelStatePoly_SHP_MapVis3_2(NULL)

    State_Clicks_MapVis3_2(NULL)
    SelStates_Filtered_MapVis3_2(NULL)
    SelStatePoints_SHP_MapVis3_2(NULL)
    Sel_SurveysMap_Vis_3_2_UL(NULL)
    Sel_SurveysAll_Vis_3_2_UL(NULL)

  },ignoreInit=TRUE)



observeEvent(input$Vis2_SelectType, {

  req(input$Vis2_SelectType=="States")

    leafletProxy("MapVis3_2")%>%
      hideGroup("County Boundaries")%>%
      showGroup("State Boundaries")
},ignoreInit=TRUE)

observeEvent(input$Vis2_SelectType, {

  req(input$Vis2_SelectType=="Counties")

    leafletProxy("MapVis3_2")%>%
      hideGroup("State Boundaries")%>%
      showGroup("County Boundaries")
},ignoreInit=TRUE)


County_Clicks_MapVis3_2<-reactiveVal()
SelCountyPoly_SHP_MapVis3_2<-reactiveVal()
SelCountyPoints_SHP_MapVis3_2<-reactiveVal()
SelCounties_Filtered_MapVis3_2<-reactiveVal()

observeEvent(input$MapVis3_2_click, {

  req(input$Vis2_SelectType=="Counties")
  req(input$Vis2_SelectCounty=="Select")

      click <- input$MapVis3_2_shape_click

      County_Clicks_MapVis3_2(list(c(County_Clicks_MapVis3_2(),click$id)))

    SelCounties_df<-as.data.frame(County_Clicks_MapVis3_2())


    Selected_Counties_Vector<-as.character(SelCounties_df[1,])


    PH<-CountyBoundaries_SHP%>%
      filter(., County_ID %in% Selected_Counties_Vector)

    SelCounties_Filtered_MapVis3_2(PH)

    leafletProxy("MapVis3_2")%>%
      clearGroup("Selected Counties")%>%
      addPolygons(data=SelCounties_Filtered_MapVis3_2(),color="red",weight=3,fillOpacity=0,group='Selected Counties',
          options=pathOptions(pane="SelectedArea"))



  },ignoreInit=TRUE)

observeEvent(input$Vis2_SelectCounty, {

  req(input$Vis2_SelectType=="Counties")
  req(input$Vis2_SelectCounty=="Complete")
  req(!is.null(SelCounties_Filtered_MapVis3_2()))



    SelCountyPoly_SHP_MapVis3_2(SelCounties_Filtered_MapVis3_2())

    County_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis3_2(),SelCountyPoly_SHP_MapVis3_2(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    County_Intersects2<-County_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      County_Intersects3<-Creel_SHP_Vis3_2()%>%slice(as.numeric(row.names(County_Intersects2)))

      MapVis3_2_SelectedWB_SHP(County_Intersects3)
  },ignoreInit=TRUE)

observeEvent(input$Vis2_SelectCounty, {
  req(input$Vis2_SelectType=="Counties")
  req(input$Vis2_SelectCounty=="Clear")

    HighlightTrace_3Vis(NULL)
    All_SelectedWB_3Vis(NULL)
    Data_3_2_Selected(NULL)
    Sel_SurveysScatter_Vis_3_2_UL(NULL) 
    HighlightTrace_Vis_3_2(NULL)
    MapVis3_2_SelectedWB_SHP(NULL) 


    SelCountyPoly_SHP_MapVis3_2(NULL)

    County_Clicks_MapVis3_2(NULL)
    SelCounties_Filtered_MapVis3_2(NULL)
    SelCountyPoints_SHP_MapVis3_2(NULL)
    Sel_SurveysMap_Vis_3_2_UL(NULL)
    Sel_SurveysAll_Vis_3_2_UL(NULL)


  },ignoreInit=TRUE)

   #### Vis 4_2 Map ####

    
  Map_4_2_Title<-eventReactive(c(input$Map_Vis2_Title_Text),{
     PH<-input$Map_Vis2_Title_Text
     return(paste("<span style=\"color:grey50,background-color:rgba(255,255,255,0)\"><strong>",PH,"</span>"))
   })

 Data_4_2_Complete_Percentiles<-reactiveVal(NULL)
 
   observeEvent(c(
     Data_4_2_Complete(),
     input$DisplayCreel_Map_Vis_2,
     input$Vis2_MapDisplayField,
     input$Vis2_MapDisplayField_Size,
     input$AF_VisNum_Selection
   ),{
     req(input$AF_VisNum_Selection==4)
     req(input$AF_SharedData)
     req(nrow(Data_4_2_Complete())>0)
     
      if(nrow(Data_4_2_Complete())>1){
       PH<-Data_4_2_Complete()%>%
        {if(input$Vis2_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis2=percent_rank(get(input$Vis2_MapDisplayField))*100) else .}%>%
        {if(input$Vis2_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis2=percent_rank(get(input$Vis2_MapDisplayField_Size))*100) else .}
    }else{
      PH<-Data_4_2_Complete()%>%
        {if(input$Vis2_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis2=50) else .}%>%
        {if(input$Vis2_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis2=50) else .}
    }

      Data_4_2_Complete_Percentiles(PH)

   },ignoreInit=TRUE)

    Creel_SHP_Vis4_2<-eventReactive(Data_4_2_Complete_Percentiles(),{
      req(length(Data_4_2_Complete_Percentiles())>0)
      req(input$SelectVis2=="Map")
      req(input$AF_VisNum_Selection==4)
      sp::merge(x=CreelWaterbodies_SHP,y=Data_4_2_Complete_Percentiles(),by.x="WB_ID",by.y="WB_ID",all.x=FALSE)%>%
        st_jitter(amount=0.002)
      })

  Vis_4_2_MapSizeField<-eventReactive(input$Vis2_MapDisplayField_Size,{
    input$Vis2_MapDisplayField_Size
    })

  Vis_4_2_MapSizeMin<-eventReactive(c(input$Vis2_MapDisplayField_Size,input$Vis_2_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    PH<-Creel_SHP_Vis4_2()%>%
      pull(input$Vis2_MapDisplayField_Size)
      return(min(PH,na.rm=TRUE))
      })

  Vis_4_2_MapSizeMax<-eventReactive(
    c(input$Vis2_MapDisplayField_Size,input$Vis_2_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
      PH<-Creel_SHP_Vis4_2()%>%
        pull(input$Vis2_MapDisplayField_Size)
        return(max(PH,na.rm=TRUE))
      })

  Vis_4_2_MapSizeMinPix<-eventReactive(input$Vis2_MapDisplayField_SizeSlider,{
    input$Vis2_MapDisplayField_SizeSlider[1]
    })

  Vis_4_2_MapSizeMaxPix<-eventReactive(input$Vis2_MapDisplayField_SizeSlider,{
    input$Vis2_MapDisplayField_SizeSlider[2]
    })

  Vis_4_2_MapPix_Dif<-eventReactive(c(Vis_4_2_MapSizeMaxPix(),Vis_4_2_MapSizeMinPix()),{
    Vis_4_2_MapSizeMaxPix()-Vis_4_2_MapSizeMinPix()
    })

  Vis_4_2_MapSizeDenom<-eventReactive(c(Vis_4_2_MapSizeMax(),Vis_4_2_MapSizeMin()),{
    
    req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    
    (Vis_4_2_MapSizeMax()-Vis_4_2_MapSizeMin())
    })

  Vis_4_2_MapSizeSingle<-eventReactive(input$Vis2_MapDisplayField_SizeSliderSingle,{
    input$Vis2_MapDisplayField_SizeSliderSingle
    })

  Vis_4_2_MapColorSolid<-eventReactive(input$Vis2_MapColorSolid,{
    input$Vis2_MapColorSolid
    })

    MapVis4_2_PalRange<-reactive({
      req(length(Creel_SHP_Vis4_2())>0)
    
      req(input$Vis2_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis4_2()%>%
        select(input$Vis2_MapDisplayField)
      })


   MapVis4_2_PercentilesPalRange<-reactive({
      req(length(Creel_SHP_Vis4_2())>0)
      req(Creel_SHP_Vis4_2()$ColorPercentile_Vis2)
    
      req(input$Vis2_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis4_2()%>%
        select(ColorPercentile_Vis2)
      })


    output$MapVis4_2 <- renderLeaflet({
      MapVis4_2_Requirement<-HTML(
       "<span style=\"color:red;background-color:white\"><strong>Click 'Display Creel Data on Map' from sidebar to add your creel data to the map.</span>"
   )


      CreelMap <- leaflet()%>%
        addMapPane("SelectedWBs",zIndex=440)%>%
        addMapPane("CreelData",zIndex=430)%>%
        addMapPane("SelectedArea",zIndex=420)%>%
        addMapPane("SupplementaryData",zIndex=410)%>%
        addProviderTiles("CartoDB.DarkMatter",group="Dark")%>%
        addProviderTiles("CartoDB.Positron",group="Light")%>%
        addWMSTiles(GetURL("USGSImageryTopo"),group="Imagery Topo Hybrid",layers="0")%>%
        addWMSTiles(GetURL("USGSTopo"),group="Topo",layers="0")%>%
        addWMSTiles(GetURL("USGSImageryOnly"),group="Imagery",layers="0")%>%
        addWMSTiles(GetURL("USGSShadedReliefOnly"),group="Shaded Relief",layers="0")%>%
        addWMSTiles(GetURL("USGSHydroCached"),group="Hydrography",layers="0",options =list(format="image/png",transparent=TRUE))%>%
        addPolygons(data=StateBoundaries_SHP,
                    group="State Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 2,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=StateBoundaries_SHP$STUSPS,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE),
        )%>%
        addPolygons(data=CountyBoundaries_SHP,
                    group="County Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 1.5,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=CountyBoundaries_SHP$County_ID,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE)
        )%>%
        addLayersControl(
          baseGroups=isolate(if(input$DarkMode=='Dark'){c("Dark","Light","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}else{c("Light","Dark","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}),
          overlayGroups =c("Creel Data", "State Boundaries","County Boundaries","Hydrography"),
          options = layersControlOptions(collapsed = TRUE))%>%
        hideGroup("County Boundaries")%>%
        hideGroup("Hydrography")%>%
        addMeasure()%>%
        addMiniMap(position="bottomleft",minimized=TRUE,toggleDisplay=TRUE)%>%
        addEasyButton(easyButton(
          icon="fa-globe", title="Zoom to Level 1",
          onClick=JS("function(btn, map){ map.setZoom(3); }")))%>%
        addEasyButton(easyButton(
          icon="fa-crosshairs", title="Locate Me",
          onClick=JS("function(btn, map){ map.locate({setView: true, maxZoom: 10}); }")))%>%
        onRender(
          "function(el, x) {
            L.easyPrint({
              sizeModes: ['Current', 'A4Landscape', 'A4Portrait'],
              filename: 'mymap',
              exportOnly: true,
              hideControlContainer: false
            }).addTo(this);
            }"
        )%>%
      addControl(MapVis4_2_Requirement,position="topright",layerId="ShowCreelMessage")
    })
    
  observeEvent(c(
    input$DarkMode,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
  ),{
    req(length(Creel_SHP_Vis4_2())>0)
    if(input$DarkMode=="Dark"){
      leafletProxy("MapVis4_2",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Light")%>%
        showGroup("Dark")
    }
        if(input$DarkMode=="Light"){
      leafletProxy("MapVis4_2",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Dark")%>%
        showGroup("Light")
    }
  },ignoreInit=TRUE)      

  observeEvent(c(
     MapVis4_2_SelectedWB_SHP(),
     MapVis4_2_PercentilesPalRange(),
    input$DisplayCreel_Map_Vis_2,
    input$Vis2_MapColorPalette,
    input$Vis2_Map_PalToggle,
    input$Vis2_Map_CreelColorscalePer,
    input$Vis2_MapDisplayField_SizeSlider,
    input$Vis2_MapColorSolid,
    input$Vis2_MapDisplayField_SizeSliderSingle,
    input$Vis2_Map_CreelSizescalePer,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis4_2())>0)
      req(input$Vis2_Map_CreelDisplayType)
      req(is.null(MapVis4_2_SelectedWB_SHP()))

      if(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis2_Map_CreelDisplayType=="Scaled Size"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField_Size!="Nothing Selected")
      }


      Vis2_Map_Popup<- if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,Creel_SHP_Vis4_2()[[input$Vis2_MapDisplayField]],Creel_SHP_Vis4_2()$Waterbody_Name_Unique,Creel_SHP_Vis4_2()$Year,Creel_SHP_Vis4_2()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField_Size,Creel_SHP_Vis4_2()[[input$Vis2_MapDisplayField_Size]],Creel_SHP_Vis4_2()$Waterbody_Name_Unique,Creel_SHP_Vis4_2()$Year,Creel_SHP_Vis4_2()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,Creel_SHP_Vis4_2()[[input$Vis2_MapDisplayField]],input$Vis2_MapDisplayField_Size,Creel_SHP_Vis4_2()[[input$Vis2_MapDisplayField_Size]],Creel_SHP_Vis4_2()$Waterbody_Name_Unique,Creel_SHP_Vis4_2()$Year,Creel_SHP_Vis4_2()$Survey_ID)%>% lapply(htmltools::HTML)
      }

         pal <- colorNumeric(input$Vis2_MapColorPalette,MapVis4_2_PalRange()[[1]],reverse=input$Vis2_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis2_MapColorPalette,MapVis4_2_PercentilesPalRange()[[1]],reverse=input$Vis2_Map_PalToggle) 
        
       leafletProxy("MapVis4_2",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis4_2(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis4_2()$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 1,
                fillOpacity=1,
                stroke=FALSE,
                fillColor =if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){Vis_4_2_MapColorSolid()}else{if(input$Vis2_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis2_MapDisplayField))}else{~pal2(ColorPercentile_Vis2)}},
                radius=if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){Vis_4_2_MapSizeSingle()}else{if(input$Vis2_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis2_MapDisplayField_Size)-Vis_4_2_MapSizeMin())*Vis_4_2_MapPix_Dif())/Vis_4_2_MapSizeDenom())+Vis_4_2_MapSizeMinPix()))}else{~(((SizePercentile_Vis2*Vis_4_2_MapPix_Dif())/100)+Vis_4_2_MapSizeMinPix())}},
               label=Vis2_Map_Popup
      )

      },ignoreInit=TRUE)

  observeEvent(c(
     MapVis4_2_SelectedWB_SHP(),
    input$DisplayCreel_Map_Vis_2,
    input$Vis2_MapColorPalette,
    input$Vis2_Map_PalToggle,
     MapVis4_2_PercentilesPalRange(),
    input$Vis2_Map_CreelColorscalePer,
    input$Vis2_MapDisplayField_SizeSlider,
    input$Vis2_MapColorSolid,
    input$Vis2_MapDisplayField_SizeSliderSingle,
    input$Vis2_Map_CreelSizescalePer,
    input$Vis2_FillOpacity,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis4_2())>0)
      req(input$Vis2_Map_CreelDisplayType)
      req(!is.null(MapVis4_2_SelectedWB_SHP()))

      if(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis2_Map_CreelDisplayType=="Scaled Size"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField_Size!="Nothing Selected")
      }


      Vis2_Map_Popup<- if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,Creel_SHP_Vis4_2()[[input$Vis2_MapDisplayField]],Creel_SHP_Vis4_2()$Waterbody_Name_Unique,Creel_SHP_Vis4_2()$Year,Creel_SHP_Vis4_2()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField_Size,Creel_SHP_Vis4_2()[[input$Vis2_MapDisplayField_Size]],Creel_SHP_Vis4_2()$Waterbody_Name_Unique,Creel_SHP_Vis4_2()$Year,Creel_SHP_Vis4_2()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,Creel_SHP_Vis4_2()[[input$Vis2_MapDisplayField]],input$Vis2_MapDisplayField_Size,Creel_SHP_Vis4_2()[[input$Vis2_MapDisplayField_Size]],Creel_SHP_Vis4_2()$Waterbody_Name_Unique,Creel_SHP_Vis4_2()$Year,Creel_SHP_Vis4_2()$Survey_ID)%>% lapply(htmltools::HTML)
      }
      
    Vis2_Map_Popup_Sel<-if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,MapVis4_2_SelectedWB_SHP()[[input$Vis2_MapDisplayField]],MapVis4_2_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis4_2_SelectedWB_SHP()$Year,MapVis4_2_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField_Size,MapVis4_2_SelectedWB_SHP()[[input$Vis2_MapDisplayField_Size]],MapVis4_2_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis4_2_SelectedWB_SHP()$Year,MapVis4_2_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis2_MapDisplayField,MapVis4_2_SelectedWB_SHP()[[input$Vis2_MapDisplayField]],input$Vis2_MapDisplayField_Size,MapVis4_2_SelectedWB_SHP()[[input$Vis2_MapDisplayField_Size]],MapVis4_2_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis4_2_SelectedWB_SHP()$Year,MapVis4_2_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      }
    

         pal <- colorNumeric(input$Vis2_MapColorPalette,MapVis4_2_PalRange()[[1]],reverse=input$Vis2_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis2_MapColorPalette,MapVis4_2_PercentilesPalRange()[[1]],reverse=input$Vis2_Map_PalToggle) 
        
       leafletProxy("MapVis4_2",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis4_2(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis4_2()$FID),
                options=pathOptions(pane="CreelData"),
                fillOpacity=input$Vis2_FillOpacity,
                stroke=FALSE,
                fillColor =if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){Vis_4_2_MapColorSolid()}else{if(input$Vis2_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis2_MapDisplayField))}else{~pal2(ColorPercentile_Vis2)}},
                radius=if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){Vis_4_2_MapSizeSingle()}else{if(input$Vis2_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis2_MapDisplayField_Size)-Vis_4_2_MapSizeMin())*Vis_4_2_MapPix_Dif())/Vis_4_2_MapSizeDenom())+Vis_4_2_MapSizeMinPix()))}else{~(((SizePercentile_Vis2*Vis_4_2_MapPix_Dif())/100)+Vis_4_2_MapSizeMinPix())}},
               label=Vis2_Map_Popup
      )%>%
        addCircleMarkers(data=MapVis4_2_SelectedWB_SHP(),
                         group='Selected Waterbodies',
                         stroke=FALSE,
                         fillOpacity=1,
                fillColor =if(input$Vis2_Map_CreelDisplayType=="Scaled Size"){Vis_4_2_MapColorSolid()}else{if(input$Vis2_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis2_MapDisplayField))}else{~pal2(ColorPercentile_Vis2)}},
                radius=if(input$Vis2_Map_CreelDisplayType=="Scaled Color"){Vis_4_2_MapSizeSingle()}else{if(input$Vis2_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis2_MapDisplayField_Size)-Vis_4_2_MapSizeMin())*Vis_4_2_MapPix_Dif())/Vis_4_2_MapSizeDenom())+Vis_4_2_MapSizeMinPix()))}else{~(((SizePercentile_Vis2*Vis_4_2_MapPix_Dif())/100)+Vis_4_2_MapSizeMinPix())}},
               label=Vis2_Map_Popup_Sel,
                         options=pathOptions(pane="SelectedWBs"))

      },ignoreInit=TRUE)
  

    observeEvent(c(
      input$DisplayCreel_Map_Vis_2,
      input$Vis2_Map_CreelDisplayType,
      input$Vis2_AddLegend_Switch,
      input$Vis2_MapColorPalette,
      input$Vis2_Map_PalToggle,
      MapVis4_2_PercentilesPalRange(),
      input$Vis2_MapDisplayField_Size,
      input$Vis2_Map_CreelColorscalePer
    ),{
      req(length(Creel_SHP_Vis4_2())>0)
      req(input$Vis2_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    

      if(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis2_Map_CreelDisplayType=="Scaled Size"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField_Size!="Nothing Selected")
      }


      if(input$Vis2_AddLegend_Switch=="Yes"&&(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both")){
        Vis2_Feature<-input$Vis2_MapDisplayField
         pal <- colorNumeric(input$Vis2_MapColorPalette,MapVis4_2_PalRange()[[1]],reverse=input$Vis2_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis2_MapColorPalette,MapVis4_2_PercentilesPalRange()[[1]],reverse=input$Vis2_Map_PalToggle) 
        
        leafletProxy("MapVis4_2",session)%>%
          removeControl(layerId="Legend")%>%
          addLegend("bottomright",
                pal = if(input$Vis2_Map_CreelColorscalePer=="Values"){pal}else{pal2},
                values=if(input$Vis2_Map_CreelColorscalePer=="Values"){Creel_SHP_Vis4_2()[[Vis2_Feature]]}else{c(0:100)},
                title=if(input$Vis2_Map_CreelColorscalePer=="Values"){paste(Vis2_Feature)}else{paste(Vis2_Feature,"</br>Percentile")},
                group= "CreelCat Data",
                layerId="Legend",
                opacity = 1)
      }else if(input$Vis2_AddLegend_Switch=="No"||input$Vis2_Map_CreelDisplayType=="Scaled Size"){
        leafletProxy("MapVis4_2",session)%>%
          removeControl(layerId="Legend")
      }
    },ignoreInit=TRUE)

    observeEvent(c(
      input$Vis2_CreelExtentZoomBTN,
      input$AF_VisNum_Selection,
      input$DisplayCreel_Map_Vis_2,
      Creel_SHP_Vis4_2(),
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(input$Vis2_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_2_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    

      if(input$Vis2_Map_CreelDisplayType=="Scaled Color"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis2_Map_CreelDisplayType=="Scaled Size"||input$Vis2_Map_CreelDisplayType=="Both"){
        req(input$Vis2_MapDisplayField_Size!="Nothing Selected")
      }

       CreelBounds<- st_bbox(Creel_SHP_Vis4_2())%>%as.vector()
        leafletProxy("MapVis4_2",session)%>%
          fitBounds(CreelBounds[1], CreelBounds[2], CreelBounds[3], CreelBounds[4])
    },ignoreInit=TRUE)


    observeEvent({
      input$Vis2_GeographyZoomBTN
    },{
      if(input$Vis2_ZoomToCounty=="Statewide"){
        SelectedStateBounds<-st_bbox(StateBoundaries_SHP[StateBoundaries_SHP$NAME==input$Vis2_ZoomToState,])%>%as.vector()
        leafletProxy("MapVis4_2",session)%>%
          fitBounds(SelectedStateBounds[1], SelectedStateBounds[2], SelectedStateBounds[3], SelectedStateBounds[4])
      }
      if(input$Vis2_ZoomToCounty!="Statewide"){
        SelectedCountyBounds<-st_bbox(CountyBoundaries_SHP%>%filter(State==input$Vis2_ZoomToState & County==input$Vis2_ZoomToCounty))%>%as.vector()
        leafletProxy("MapVis4_2",session)%>%
          fitBounds(SelectedCountyBounds[1], SelectedCountyBounds[2], SelectedCountyBounds[3], SelectedCountyBounds[4])
      }},ignoreInit=TRUE)

    observeEvent(c(
      input$Map_Vis2_Title_Text,
      input$Map_Vis2_Title_Switch
    ),{
      req(length(Creel_SHP_Vis4_2())>0)
      if(input$Map_Vis2_Title_Switch=="Yes"){
        leafletProxy("MapVis4_2",session)%>%
         removeControl(layerId="Map4_2_Title")%>%
          addControl(Map_4_2_Title(),position=c("bottomright"),layerId="Map4_2_Title")
      }else if(input$Map_Vis2_Title_Switch=="No"){
        leafletProxy("MapVis4_2",session)%>%
         removeControl(layerId="Map4_2_Title")
      }
    },ignoreInit=TRUE)
    

MapVis4_2_SelectedWB_SHP<-reactiveVal(NULL)
    
MapVis4_2_area<-reactiveValues()

Poly_SHP_MapVis4_2<-reactiveVal()

observeEvent(input$MapVis4_2_click, {
  req(input$Vis2_SelectType=="Polygon")
  req(input$Vis2_SelectPolygon=="Draw")

    coords <- input$MapVis4_2_click
    cm <- matrix(data = c(coords$lat, coords$lng), nrow = 1, ncol = 2)
    MapVis4_2_area$mp <- if(!is.null(MapVis4_2_area$mp)){rbind(MapVis4_2_area$mp, cm)}else{cm}

    leafletProxy("MapVis4_2")%>%
      clearGroup("Polygon Draw")%>%
      addPolygons(lat = MapVis4_2_area$mp[ , 1], lng = MapVis4_2_area$mp[ , 2],color="red",fillOpacity=0,group='Polygon Draw',
          options=pathOptions(pane="SelectedArea"))

},ignoreInit=TRUE)

observeEvent(input$Vis2_SelectPolygon, {

  req(input$Vis2_SelectType=="Polygon")
  req(length(MapVis4_2_area$mp)>5)
  req(input$Vis2_SelectPolygon=="Complete")

  Sel_MapVis4_2_area<-as.data.frame(MapVis4_2_area$mp)%>%
    rename(lat=1)%>%
    rename(lng=2)



 Poly_SHP_MapVis4_2(
    polygon_MapVis4_2<-Sel_MapVis4_2_area%>%
  st_as_sf(coords = c("lng", "lat"), crs = 4326)%>%
  summarise(geometry = st_combine(geometry))%>%
  st_cast("POLYGON")
 )
 
 PolyPoints<-Creel_SHP_Vis4_2()%>%
                  filter(st_intersects(.,Poly_SHP_MapVis4_2(),sparse=FALSE)[,1])
 
  MapVis4_2_SelectedWB_SHP(PolyPoints)

},ignoreInit=TRUE)

observeEvent(input$Vis2_SelectPolygon,{

  req(input$Vis2_SelectPolygon=="Clear")
  req(input$Vis2_SelectType=="Polygon")
  
  HighlightTrace_4Vis(NULL)
  All_SelectedWB_4Vis(NULL)
  Data_4_2_Selected(NULL)
  Sel_SurveysScatter_Vis_4_2_UL(NULL) 
  HighlightTrace_Vis_4_2(NULL) 
  MapVis4_2_SelectedWB_SHP(NULL)
  

  MapVis4_2_area$mp<-NULL

  Poly_SHP_MapVis4_2(NULL)


    Sel_SurveysMap_Vis_4_2_UL(NULL)
    Sel_SurveysAll_Vis_4_2_UL(NULL)
  

},ignoreInit=TRUE)

State_Clicks_MapVis4_2<-reactiveVal()
SelStatePoly_SHP_MapVis4_2<-reactiveVal()
SelStatePoints_SHP_MapVis4_2<-reactiveVal()
SelStates_Filtered_MapVis4_2<-reactiveVal()

observeEvent(input$MapVis4_2_click, {

  req(input$Vis2_SelectType=="States")
  req(input$Vis2_SelectState=="Select")

      click <- input$MapVis4_2_shape_click

      State_Clicks_MapVis4_2(list(c(State_Clicks_MapVis4_2(),click$id)))

    SelStates_df<-as.data.frame(State_Clicks_MapVis4_2())


    Selected_States_Vector<-as.character(SelStates_df[1,])


    PH<-StateBoundaries_SHP%>%
      filter(., STUSPS %in% Selected_States_Vector)

    SelStates_Filtered_MapVis4_2(PH)


    leafletProxy("MapVis4_2")%>%
      clearGroup("Selected States")%>%
      addPolygons(data=SelStates_Filtered_MapVis4_2(),color="red",weight=3,fillOpacity=0,group='Selected States',
          options=pathOptions(pane="SelectedArea"))
  },ignoreInit=TRUE)

observeEvent(input$Vis2_SelectState, {

  req(input$Vis2_SelectType=="States")
  req(input$Vis2_SelectState=="Complete")
  req(!is.null(SelStates_Filtered_MapVis4_2()))

    SelStatePoly_SHP_MapVis4_2(SelStates_Filtered_MapVis4_2())

    State_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis4_2(),SelStatePoly_SHP_MapVis4_2(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    State_Intersects2<-State_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      State_Intersects3<-Creel_SHP_Vis4_2()%>%slice(as.numeric(row.names(State_Intersects2)))


       MapVis4_2_SelectedWB_SHP(State_Intersects3)
  },ignoreInit=TRUE)

observeEvent(input$Vis2_SelectState, {
  req(input$Vis2_SelectType=="States")
  req(input$Vis2_SelectState=="Clear")
  
  HighlightTrace_4Vis(NULL)
  All_SelectedWB_4Vis(NULL)
  Data_4_2_Selected(NULL)
  Sel_SurveysScatter_Vis_4_2_UL(NULL) 
  HighlightTrace_Vis_4_2(NULL) 
  MapVis4_2_SelectedWB_SHP(NULL)


    SelStatePoly_SHP_MapVis4_2(NULL)

    State_Clicks_MapVis4_2(NULL)
    SelStates_Filtered_MapVis4_2(NULL)
    SelStatePoints_SHP_MapVis4_2(NULL)
    Sel_SurveysMap_Vis_4_2_UL(NULL)
    Sel_SurveysAll_Vis_4_2_UL(NULL)

  },ignoreInit=TRUE)



observeEvent(input$Vis2_SelectType, {

  req(input$Vis2_SelectType=="States")

    leafletProxy("MapVis4_2")%>%
      hideGroup("County Boundaries")%>%
      showGroup("State Boundaries")
},ignoreInit=TRUE)

observeEvent(input$Vis2_SelectType, {

  req(input$Vis2_SelectType=="Counties")

    leafletProxy("MapVis4_2")%>%
      hideGroup("State Boundaries")%>%
      showGroup("County Boundaries")
},ignoreInit=TRUE)


County_Clicks_MapVis4_2<-reactiveVal()
SelCountyPoly_SHP_MapVis4_2<-reactiveVal()
SelCountyPoints_SHP_MapVis4_2<-reactiveVal()
SelCounties_Filtered_MapVis4_2<-reactiveVal()

observeEvent(input$MapVis4_2_click, {

  req(input$Vis2_SelectType=="Counties")
  req(input$Vis2_SelectCounty=="Select")

      click <- input$MapVis4_2_shape_click

      County_Clicks_MapVis4_2(list(c(County_Clicks_MapVis4_2(),click$id)))

    SelCounties_df<-as.data.frame(County_Clicks_MapVis4_2())


    Selected_Counties_Vector<-as.character(SelCounties_df[1,])


    PH<-CountyBoundaries_SHP%>%
      filter(., County_ID %in% Selected_Counties_Vector)

    SelCounties_Filtered_MapVis4_2(PH)

    leafletProxy("MapVis4_2")%>%
      clearGroup("Selected Counties")%>%
      addPolygons(data=SelCounties_Filtered_MapVis4_2(),color="red",weight=3,fillOpacity=0,group='Selected Counties',
          options=pathOptions(pane="SelectedArea"))



  },ignoreInit=TRUE)

observeEvent(input$Vis2_SelectCounty, {

  req(input$Vis2_SelectType=="Counties")
  req(input$Vis2_SelectCounty=="Complete")
  req(!is.null(SelCounties_Filtered_MapVis4_2()))



    SelCountyPoly_SHP_MapVis4_2(SelCounties_Filtered_MapVis4_2())

    County_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis4_2(),SelCountyPoly_SHP_MapVis4_2(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    County_Intersects2<-County_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      County_Intersects3<-Creel_SHP_Vis4_2()%>%slice(as.numeric(row.names(County_Intersects2)))

      MapVis4_2_SelectedWB_SHP(County_Intersects3)
  },ignoreInit=TRUE)

observeEvent(input$Vis2_SelectCounty, {
  req(input$Vis2_SelectType=="Counties")
  req(input$Vis2_SelectCounty=="Clear")

    HighlightTrace_4Vis(NULL)
    All_SelectedWB_4Vis(NULL)
    Data_4_2_Selected(NULL)
    Sel_SurveysScatter_Vis_4_2_UL(NULL) 
    HighlightTrace_Vis_4_2(NULL) 
  MapVis4_2_SelectedWB_SHP(NULL)


    SelCountyPoly_SHP_MapVis4_2(NULL)

    County_Clicks_MapVis4_2(NULL)
    SelCounties_Filtered_MapVis4_2(NULL)
    SelCountyPoints_SHP_MapVis4_2(NULL)
    Sel_SurveysMap_Vis_4_2_UL(NULL)
    Sel_SurveysAll_Vis_4_2_UL(NULL)


  },ignoreInit=TRUE)

   #### Vis 3_3 Map ####

    
  Map_3_3_Title<-eventReactive(c(input$Map_Vis3_Title_Text),{
     PH<-input$Map_Vis3_Title_Text
     return(paste("<span style=\"color:grey50,background-color:rgba(255,255,255,0)\"><strong>",PH,"</span>"))
   })

 Data_3_3_Complete_Percentiles<-reactiveVal(NULL)
   
   observeEvent(c(
     Data_3_3_Complete(),
     input$DisplayCreel_Map_Vis_3,
     input$Vis3_MapDisplayField,
     input$Vis3_MapDisplayField_Size,
     input$AF_VisNum_Selection
   ),{
     req(input$AF_VisNum_Selection==3)
     req(input$AF_SharedData)
     req(nrow(Data_3_3_Complete())>0)
     
     if(nrow(Data_3_3_Complete())>1){
       PH<-Data_3_3_Complete()%>%
        {if(input$Vis3_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis3=percent_rank(get(input$Vis3_MapDisplayField))*100) else .}%>%
        {if(input$Vis3_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis3=percent_rank(get(input$Vis3_MapDisplayField_Size))*100) else .}
    }else{
      PH<-Data_3_3_Complete()%>%
        {if(input$Vis3_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis3=50) else .}%>%
        {if(input$Vis3_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis3=50) else .}
    } 
      
      
      Data_3_3_Complete_Percentiles(PH)
     
   },ignoreInit=TRUE)

    Creel_SHP_Vis3_3<-eventReactive(Data_3_3_Complete_Percentiles(),{
      req(length(Data_3_3_Complete_Percentiles())>0)
      req(input$SelectVis3=="Map")
      req(input$AF_VisNum_Selection==3)
      sp::merge(x=CreelWaterbodies_SHP,y=Data_3_3_Complete_Percentiles(),by.x="WB_ID",by.y="WB_ID",all.x=FALSE)%>%
        st_jitter(amount=0.002)
      })

  Vis_3_3_MapSizeField<-eventReactive(input$Vis3_MapDisplayField_Size,{
    input$Vis3_MapDisplayField_Size
    })

  Vis_3_3_MapSizeMin<-eventReactive(c(input$Vis3_MapDisplayField_Size,input$Vis_3_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(if(input$AF_SharedData=="No"){length(input$Vis_3_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    PH<-Creel_SHP_Vis3_3()%>%
      pull(input$Vis3_MapDisplayField_Size)
      return(min(PH,na.rm=TRUE))
      })

  Vis_3_3_MapSizeMax<-eventReactive(
    c(input$Vis3_MapDisplayField_Size,input$Vis_3_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(if(input$AF_SharedData=="No"){length(input$Vis_3_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
      PH<-Creel_SHP_Vis3_3()%>%
        pull(input$Vis3_MapDisplayField_Size)
        return(max(PH,na.rm=TRUE))
      })

  Vis_3_3_MapSizeMinPix<-eventReactive(input$Vis3_MapDisplayField_SizeSlider,{
    input$Vis3_MapDisplayField_SizeSlider[1]
    })

  Vis_3_3_MapSizeMaxPix<-eventReactive(input$Vis3_MapDisplayField_SizeSlider,{
    input$Vis3_MapDisplayField_SizeSlider[2]
    })

  Vis_3_3_MapPix_Dif<-eventReactive(c(Vis_3_3_MapSizeMaxPix(),Vis_3_3_MapSizeMinPix()),{
    Vis_3_3_MapSizeMaxPix()-Vis_3_3_MapSizeMinPix()
    })

  Vis_3_3_MapSizeDenom<-eventReactive(c(Vis_3_3_MapSizeMax(),Vis_3_3_MapSizeMin()),{
    
    req(if(input$AF_SharedData=="No"){length(input$Vis_3_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    
    (Vis_3_3_MapSizeMax()-Vis_3_3_MapSizeMin())
    })

  Vis_3_3_MapSizeSingle<-eventReactive(input$Vis3_MapDisplayField_SizeSliderSingle,{
    input$Vis3_MapDisplayField_SizeSliderSingle
    })

  Vis_3_3_MapColorSolid<-eventReactive(input$Vis3_MapColorSolid,{
    input$Vis3_MapColorSolid
    })

    MapVis3_3_PalRange<-reactive({
      req(length(Creel_SHP_Vis3_3())>0)
    
      req(input$Vis3_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis3_3()%>%
        select(input$Vis3_MapDisplayField)
      })


   MapVis3_3_PercentilesPalRange<-reactive({
      req(length(Creel_SHP_Vis3_3())>0)
      req(Creel_SHP_Vis3_3()$ColorPercentile_Vis3)
    
      req(input$Vis3_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis3_3()%>%
        select(ColorPercentile_Vis3)
      })


    output$MapVis3_3 <- renderLeaflet({
      MapVis3_3_Requirement<-HTML(
       "<span style=\"color:red;background-color:white\"><strong>Click 'Display Creel Data on Map' from sidebar to add your creel data to the map.</span>"
   )


      CreelMap <- leaflet()%>%
        addMapPane("SelectedWBs",zIndex=440)%>%
        addMapPane("CreelData",zIndex=430)%>%
        addMapPane("SelectedArea",zIndex=420)%>%
        addMapPane("SupplementaryData",zIndex=410)%>%
        addProviderTiles("CartoDB.DarkMatter",group="Dark")%>%
        addProviderTiles("CartoDB.Positron",group="Light")%>%
        addWMSTiles(GetURL("USGSImageryTopo"),group="Imagery Topo Hybrid",layers="0")%>%
        addWMSTiles(GetURL("USGSTopo"),group="Topo",layers="0")%>%
        addWMSTiles(GetURL("USGSImageryOnly"),group="Imagery",layers="0")%>%
        addWMSTiles(GetURL("USGSShadedReliefOnly"),group="Shaded Relief",layers="0")%>%
        addWMSTiles(GetURL("USGSHydroCached"),group="Hydrography",layers="0",options =list(format="image/png",transparent=TRUE))%>%
        addPolygons(data=StateBoundaries_SHP,
                    group="State Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 2,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=StateBoundaries_SHP$STUSPS,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE),
        )%>%
        addPolygons(data=CountyBoundaries_SHP,
                    group="County Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 1.5,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=CountyBoundaries_SHP$County_ID,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE)
        )%>%
        addLayersControl(
          baseGroups=isolate(if(input$DarkMode=='Dark'){c("Dark","Light","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}else{c("Light","Dark","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}),
          overlayGroups =c("Creel Data", "State Boundaries","County Boundaries","Hydrography"),
          options = layersControlOptions(collapsed = TRUE))%>%
        hideGroup("County Boundaries")%>%
        hideGroup("Hydrography")%>%
        addMeasure()%>%
        addMiniMap(position="bottomleft",minimized=TRUE,toggleDisplay=TRUE)%>%
        addEasyButton(easyButton(
          icon="fa-globe", title="Zoom to Level 1",
          onClick=JS("function(btn, map){ map.setZoom(3); }")))%>%
        addEasyButton(easyButton(
          icon="fa-crosshairs", title="Locate Me",
          onClick=JS("function(btn, map){ map.locate({setView: true, maxZoom: 10}); }")))%>%
        onRender(
          "function(el, x) {
            L.easyPrint({
              sizeModes: ['Current', 'A4Landscape', 'A4Portrait'],
              filename: 'mymap',
              exportOnly: true,
              hideControlContainer: false
            }).addTo(this);
            }"
        )%>%
      addControl(MapVis3_3_Requirement,position="topright",layerId="ShowCreelMessage")
    })
    
  observeEvent(c(
    input$DarkMode,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
  ),{
    req(length(Creel_SHP_Vis3_3())>0)
    if(input$DarkMode=="Dark"){
      leafletProxy("MapVis3_3",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Light")%>%
        showGroup("Dark")
    }
        if(input$DarkMode=="Light"){
      leafletProxy("MapVis3_3",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Dark")%>%
        showGroup("Light")
    }
  },ignoreInit=TRUE)      

  observeEvent(c(
     MapVis3_3_SelectedWB_SHP(),
     MapVis3_3_PercentilesPalRange(),
    input$DisplayCreel_Map_Vis_3,
    input$Vis3_MapColorPalette,
    input$Vis3_Map_PalToggle,
    input$Vis3_Map_CreelColorscalePer,
    input$Vis3_MapDisplayField_SizeSlider,
    input$Vis3_MapColorSolid,
    input$Vis3_MapDisplayField_SizeSliderSingle,
    input$Vis3_Map_CreelSizescalePer,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis3_3())>0)
      req(input$Vis3_Map_CreelDisplayType)
      req(is.null(MapVis3_3_SelectedWB_SHP()))

      if(input$Vis3_Map_CreelDisplayType=="Scaled Color"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis3_Map_CreelDisplayType=="Scaled Size"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField_Size!="Nothing Selected")
      }


      Vis3_Map_Popup<- if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField,Creel_SHP_Vis3_3()[[input$Vis3_MapDisplayField]],Creel_SHP_Vis3_3()$Waterbody_Name_Unique,Creel_SHP_Vis3_3()$Year,Creel_SHP_Vis3_3()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField_Size,Creel_SHP_Vis3_3()[[input$Vis3_MapDisplayField_Size]],Creel_SHP_Vis3_3()$Waterbody_Name_Unique,Creel_SHP_Vis3_3()$Year,Creel_SHP_Vis3_3()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField,Creel_SHP_Vis3_3()[[input$Vis3_MapDisplayField]],input$Vis3_MapDisplayField_Size,Creel_SHP_Vis3_3()[[input$Vis3_MapDisplayField_Size]],Creel_SHP_Vis3_3()$Waterbody_Name_Unique,Creel_SHP_Vis3_3()$Year,Creel_SHP_Vis3_3()$Survey_ID)%>% lapply(htmltools::HTML)
      }

         pal <- colorNumeric(input$Vis3_MapColorPalette,MapVis3_3_PalRange()[[1]],reverse=input$Vis3_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis3_MapColorPalette,MapVis3_3_PercentilesPalRange()[[1]],reverse=input$Vis3_Map_PalToggle) 
        
       leafletProxy("MapVis3_3",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis3_3(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis3_3()$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 1,
                fillOpacity=1,
                stroke=FALSE,
                fillColor =if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){Vis_3_3_MapColorSolid()}else{if(input$Vis3_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis3_MapDisplayField))}else{~pal2(ColorPercentile_Vis3)}},
                radius=if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){Vis_3_3_MapSizeSingle()}else{if(input$Vis3_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis3_MapDisplayField_Size)-Vis_3_3_MapSizeMin())*Vis_3_3_MapPix_Dif())/Vis_3_3_MapSizeDenom())+Vis_3_3_MapSizeMinPix()))}else{~(((SizePercentile_Vis3*Vis_3_3_MapPix_Dif())/100)+Vis_3_3_MapSizeMinPix())}},
               label=Vis3_Map_Popup
      )

      },ignoreInit=TRUE)

  observeEvent(c(
     MapVis3_3_SelectedWB_SHP(),
    input$DisplayCreel_Map_Vis_3,
    input$Vis3_MapColorPalette,
    input$Vis3_Map_PalToggle,
     MapVis3_3_PercentilesPalRange(),
    input$Vis3_Map_CreelColorscalePer,
    input$Vis3_MapDisplayField_SizeSlider,
    input$Vis3_MapColorSolid,
    input$Vis3_MapDisplayField_SizeSliderSingle,
    input$Vis3_Map_CreelSizescalePer,
    input$Vis3_FillOpacity,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis3_3())>0)
      req(input$Vis3_Map_CreelDisplayType)
      req(!is.null(MapVis3_3_SelectedWB_SHP()))

      if(input$Vis3_Map_CreelDisplayType=="Scaled Color"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis3_Map_CreelDisplayType=="Scaled Size"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField_Size!="Nothing Selected")
      }


      Vis3_Map_Popup<- if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField,Creel_SHP_Vis3_3()[[input$Vis3_MapDisplayField]],Creel_SHP_Vis3_3()$Waterbody_Name_Unique,Creel_SHP_Vis3_3()$Year,Creel_SHP_Vis3_3()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField_Size,Creel_SHP_Vis3_3()[[input$Vis3_MapDisplayField_Size]],Creel_SHP_Vis3_3()$Waterbody_Name_Unique,Creel_SHP_Vis3_3()$Year,Creel_SHP_Vis3_3()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField,Creel_SHP_Vis3_3()[[input$Vis3_MapDisplayField]],input$Vis3_MapDisplayField_Size,Creel_SHP_Vis3_3()[[input$Vis3_MapDisplayField_Size]],Creel_SHP_Vis3_3()$Waterbody_Name_Unique,Creel_SHP_Vis3_3()$Year,Creel_SHP_Vis3_3()$Survey_ID)%>% lapply(htmltools::HTML)
      }
      
    Vis3_Map_Popup_Sel<-if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField,MapVis3_3_SelectedWB_SHP()[[input$Vis3_MapDisplayField]],MapVis3_3_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis3_3_SelectedWB_SHP()$Year,MapVis3_3_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField_Size,MapVis3_3_SelectedWB_SHP()[[input$Vis3_MapDisplayField_Size]],MapVis3_3_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis3_3_SelectedWB_SHP()$Year,MapVis3_3_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField,MapVis3_3_SelectedWB_SHP()[[input$Vis3_MapDisplayField]],input$Vis3_MapDisplayField_Size,MapVis3_3_SelectedWB_SHP()[[input$Vis3_MapDisplayField_Size]],MapVis3_3_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis3_3_SelectedWB_SHP()$Year,MapVis3_3_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      }
    

         pal <- colorNumeric(input$Vis3_MapColorPalette,MapVis3_3_PalRange()[[1]],reverse=input$Vis3_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis3_MapColorPalette,MapVis3_3_PercentilesPalRange()[[1]],reverse=input$Vis3_Map_PalToggle) 
        
       leafletProxy("MapVis3_3",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis3_3(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis3_3()$FID),
                options=pathOptions(pane="CreelData"),
                fillOpacity=input$Vis3_FillOpacity,
                stroke=FALSE,
                fillColor =if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){Vis_3_3_MapColorSolid()}else{if(input$Vis3_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis3_MapDisplayField))}else{~pal2(ColorPercentile_Vis3)}},
                radius=if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){Vis_3_3_MapSizeSingle()}else{if(input$Vis3_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis3_MapDisplayField_Size)-Vis_3_3_MapSizeMin())*Vis_3_3_MapPix_Dif())/Vis_3_3_MapSizeDenom())+Vis_3_3_MapSizeMinPix()))}else{~(((SizePercentile_Vis3*Vis_3_3_MapPix_Dif())/100)+Vis_3_3_MapSizeMinPix())}},
               label=Vis3_Map_Popup
      )%>%
        addCircleMarkers(data=MapVis3_3_SelectedWB_SHP(),
                         group='Selected Waterbodies',
                         stroke=FALSE,
                         fillOpacity=1,
                fillColor =if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){Vis_3_3_MapColorSolid()}else{if(input$Vis3_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis3_MapDisplayField))}else{~pal2(ColorPercentile_Vis3)}},
                radius=if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){Vis_3_3_MapSizeSingle()}else{if(input$Vis3_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis3_MapDisplayField_Size)-Vis_3_3_MapSizeMin())*Vis_3_3_MapPix_Dif())/Vis_3_3_MapSizeDenom())+Vis_3_3_MapSizeMinPix()))}else{~(((SizePercentile_Vis3*Vis_3_3_MapPix_Dif())/100)+Vis_3_3_MapSizeMinPix())}},
               label=Vis3_Map_Popup_Sel,
                         options=pathOptions(pane="SelectedWBs"))

      },ignoreInit=TRUE)
  

    observeEvent(c(
      input$DisplayCreel_Map_Vis_3,
      input$Vis3_Map_CreelDisplayType,
      input$Vis3_AddLegend_Switch,
      input$Vis3_MapColorPalette,
      input$Vis3_Map_PalToggle,
      MapVis3_3_PercentilesPalRange(),
      input$Vis3_MapDisplayField_Size,
      input$Vis3_Map_CreelColorscalePer
    ),{
      req(length(Creel_SHP_Vis3_3())>0)
      req(input$Vis3_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_3_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    

      if(input$Vis3_Map_CreelDisplayType=="Scaled Color"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis3_Map_CreelDisplayType=="Scaled Size"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField_Size!="Nothing Selected")
      }


      if(input$Vis3_AddLegend_Switch=="Yes"&&(input$Vis3_Map_CreelDisplayType=="Scaled Color"||input$Vis3_Map_CreelDisplayType=="Both")){
        Vis3_Feature<-input$Vis3_MapDisplayField
         pal <- colorNumeric(input$Vis3_MapColorPalette,MapVis3_3_PalRange()[[1]],reverse=input$Vis3_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis3_MapColorPalette,MapVis3_3_PercentilesPalRange()[[1]],reverse=input$Vis3_Map_PalToggle) 
        
        leafletProxy("MapVis3_3",session)%>%
          removeControl(layerId="Legend")%>%
          addLegend("bottomright",
                pal = if(input$Vis3_Map_CreelColorscalePer=="Values"){pal}else{pal2},
                values=if(input$Vis3_Map_CreelColorscalePer=="Values"){Creel_SHP_Vis3_3()[[Vis3_Feature]]}else{c(0:100)},
                title=if(input$Vis3_Map_CreelColorscalePer=="Values"){paste(Vis3_Feature)}else{paste(Vis3_Feature,"</br>Percentile")},
                group= "CreelCat Data",
                layerId="Legend",
                opacity = 1)
      }else if(input$Vis3_AddLegend_Switch=="No"||input$Vis3_Map_CreelDisplayType=="Scaled Size"){
        leafletProxy("MapVis3_3",session)%>%
          removeControl(layerId="Legend")
      }
    },ignoreInit=TRUE)

    observeEvent(c(
      input$Vis3_CreelExtentZoomBTN,
      input$AF_VisNum_Selection,
      input$DisplayCreel_Map_Vis_3,
      Creel_SHP_Vis3_3(),
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(input$Vis3_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_3_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    

      if(input$Vis3_Map_CreelDisplayType=="Scaled Color"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis3_Map_CreelDisplayType=="Scaled Size"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField_Size!="Nothing Selected")
      }

       CreelBounds<- st_bbox(Creel_SHP_Vis3_3())%>%as.vector()
        leafletProxy("MapVis3_3",session)%>%
          fitBounds(CreelBounds[1], CreelBounds[2], CreelBounds[3], CreelBounds[4])
    },ignoreInit=TRUE)


    observeEvent({
      input$Vis3_GeographyZoomBTN
    },{
      if(input$Vis3_ZoomToCounty=="Statewide"){
        SelectedStateBounds<-st_bbox(StateBoundaries_SHP[StateBoundaries_SHP$NAME==input$Vis3_ZoomToState,])%>%as.vector()
        leafletProxy("MapVis3_3",session)%>%
          fitBounds(SelectedStateBounds[1], SelectedStateBounds[2], SelectedStateBounds[3], SelectedStateBounds[4])
      }
      if(input$Vis3_ZoomToCounty!="Statewide"){
        SelectedCountyBounds<-st_bbox(CountyBoundaries_SHP%>%filter(State==input$Vis3_ZoomToState & County==input$Vis3_ZoomToCounty))%>%as.vector()
        leafletProxy("MapVis3_3",session)%>%
          fitBounds(SelectedCountyBounds[1], SelectedCountyBounds[2], SelectedCountyBounds[3], SelectedCountyBounds[4])
      }},ignoreInit=TRUE)

    observeEvent(c(
      input$Map_Vis3_Title_Text,
      input$Map_Vis3_Title_Switch
    ),{
      req(length(Creel_SHP_Vis3_3())>0)
      if(input$Map_Vis3_Title_Switch=="Yes"){
        leafletProxy("MapVis3_3",session)%>%
         removeControl(layerId="Map3_3_Title")%>%
          addControl(Map_3_3_Title(),position=c("bottomright"),layerId="Map3_3_Title")
      }else if(input$Map_Vis3_Title_Switch=="No"){
        leafletProxy("MapVis3_3",session)%>%
         removeControl(layerId="Map3_3_Title")
      }
    },ignoreInit=TRUE)
    

MapVis3_3_SelectedWB_SHP<-reactiveVal(NULL)
    
MapVis3_3_area<-reactiveValues()

Poly_SHP_MapVis3_3<-reactiveVal()

observeEvent(input$MapVis3_3_click, {
  req(input$Vis3_SelectType=="Polygon")
  req(input$Vis3_SelectPolygon=="Draw")

    coords <- input$MapVis3_3_click
    cm <- matrix(data = c(coords$lat, coords$lng), nrow = 1, ncol = 2)
    MapVis3_3_area$mp <- if(!is.null(MapVis3_3_area$mp)){rbind(MapVis3_3_area$mp, cm)}else{cm}

    leafletProxy("MapVis3_3")%>%
      clearGroup("Polygon Draw")%>%
      addPolygons(lat = MapVis3_3_area$mp[ , 1], lng = MapVis3_3_area$mp[ , 2],color="red",fillOpacity=0,group='Polygon Draw',
          options=pathOptions(pane="SelectedArea"))

},ignoreInit=TRUE)

observeEvent(input$Vis3_SelectPolygon, {

  req(input$Vis3_SelectType=="Polygon")
  req(length(MapVis3_3_area$mp)>5)
  req(input$Vis3_SelectPolygon=="Complete")

  Sel_MapVis3_3_area<-as.data.frame(MapVis3_3_area$mp)%>%
    rename(lat=1)%>%
    rename(lng=2)



 Poly_SHP_MapVis3_3(
    polygon_MapVis3_3<-Sel_MapVis3_3_area%>%
  st_as_sf(coords = c("lng", "lat"), crs = 4326)%>%
  summarise(geometry = st_combine(geometry))%>%
  st_cast("POLYGON")
 )
 
 PolyPoints<-Creel_SHP_Vis3_3()%>%
                  filter(st_intersects(.,Poly_SHP_MapVis3_3(),sparse=FALSE)[,1])
 
  MapVis3_3_SelectedWB_SHP(PolyPoints)

},ignoreInit=TRUE)

observeEvent(input$Vis3_SelectPolygon,{

  req(input$Vis3_SelectPolygon=="Clear")
  req(input$Vis3_SelectType=="Polygon")
  
  HighlightTrace_3Vis(NULL)
  All_SelectedWB_3Vis(NULL)
  Data_3_3_Selected(NULL)
  Sel_SurveysScatter_Vis_3_3_UL(NULL) 
  HighlightTrace_Vis_3_3(NULL) 
  MapVis3_3_SelectedWB_SHP(NULL)
  

  MapVis3_3_area$mp<-NULL

  Poly_SHP_MapVis3_3(NULL)
    Sel_SurveysMap_Vis_3_3_UL(NULL)
    Sel_SurveysAll_Vis_3_3_UL(NULL)
  

},ignoreInit=TRUE)

State_Clicks_MapVis3_3<-reactiveVal()
SelStatePoly_SHP_MapVis3_3<-reactiveVal()
SelStatePoints_SHP_MapVis3_3<-reactiveVal()
SelStates_Filtered_MapVis3_3<-reactiveVal()

observeEvent(input$MapVis3_3_click, {

  req(input$Vis3_SelectType=="States")
  req(input$Vis3_SelectState=="Select")

      click <- input$MapVis3_3_shape_click

      State_Clicks_MapVis3_3(list(c(State_Clicks_MapVis3_3(),click$id)))

    SelStates_df<-as.data.frame(State_Clicks_MapVis3_3())


    Selected_States_Vector<-as.character(SelStates_df[1,])


    PH<-StateBoundaries_SHP%>%
      filter(., STUSPS %in% Selected_States_Vector)

    SelStates_Filtered_MapVis3_3(PH)


    leafletProxy("MapVis3_3")%>%
      clearGroup("Selected States")%>%
      addPolygons(data=SelStates_Filtered_MapVis3_3(),color="red",weight=3,fillOpacity=0,group='Selected States',
          options=pathOptions(pane="SelectedArea"))
  },ignoreInit=TRUE)

observeEvent(input$Vis3_SelectState, {

  req(input$Vis3_SelectType=="States")
  req(input$Vis3_SelectState=="Complete")
  req(!is.null(SelStates_Filtered_MapVis3_3()))

    SelStatePoly_SHP_MapVis3_3(SelStates_Filtered_MapVis3_3())

    State_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis3_3(),SelStatePoly_SHP_MapVis3_3(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    State_Intersects2<-State_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      State_Intersects3<-Creel_SHP_Vis3_3()%>%slice(as.numeric(row.names(State_Intersects2)))


       MapVis3_3_SelectedWB_SHP(State_Intersects3)

  },ignoreInit=TRUE)

observeEvent(input$Vis3_SelectState, {
  req(input$Vis3_SelectType=="States")
  req(input$Vis3_SelectState=="Clear")
  
  HighlightTrace_3Vis(NULL)
  All_SelectedWB_3Vis(NULL)
  Data_3_3_Selected(NULL)
  Sel_SurveysScatter_Vis_3_3_UL(NULL) 
  HighlightTrace_Vis_3_3(NULL) 
  MapVis3_3_SelectedWB_SHP(NULL)


    SelStatePoly_SHP_MapVis3_3(NULL)

    State_Clicks_MapVis3_3(NULL)
    SelStates_Filtered_MapVis3_3(NULL)
    SelStatePoints_SHP_MapVis3_3(NULL)
    Sel_SurveysMap_Vis_3_3_UL(NULL)
    Sel_SurveysAll_Vis_3_3_UL(NULL)

  },ignoreInit=TRUE)



observeEvent(input$Vis3_SelectType, {

  req(input$Vis3_SelectType=="States")

    leafletProxy("MapVis3_3")%>%
      hideGroup("County Boundaries")%>%
      showGroup("State Boundaries")
},ignoreInit=TRUE)

observeEvent(input$Vis3_SelectType, {

  req(input$Vis3_SelectType=="Counties")

    leafletProxy("MapVis3_3")%>%
      hideGroup("State Boundaries")%>%
      showGroup("County Boundaries")
},ignoreInit=TRUE)


County_Clicks_MapVis3_3<-reactiveVal()
SelCountyPoly_SHP_MapVis3_3<-reactiveVal()
SelCountyPoints_SHP_MapVis3_3<-reactiveVal()
SelCounties_Filtered_MapVis3_3<-reactiveVal()

observeEvent(input$MapVis3_3_click, {

  req(input$Vis3_SelectType=="Counties")
  req(input$Vis3_SelectCounty=="Select")

      click <- input$MapVis3_3_shape_click

      County_Clicks_MapVis3_3(list(c(County_Clicks_MapVis3_3(),click$id)))

    SelCounties_df<-as.data.frame(County_Clicks_MapVis3_3())


    Selected_Counties_Vector<-as.character(SelCounties_df[1,])


    PH<-CountyBoundaries_SHP%>%
      filter(., County_ID %in% Selected_Counties_Vector)

    SelCounties_Filtered_MapVis3_3(PH)

    leafletProxy("MapVis3_3")%>%
      clearGroup("Selected Counties")%>%
      addPolygons(data=SelCounties_Filtered_MapVis3_3(),color="red",weight=3,fillOpacity=0,group='Selected Counties',
          options=pathOptions(pane="SelectedArea"))



  },ignoreInit=TRUE)

observeEvent(input$Vis3_SelectCounty, {

  req(input$Vis3_SelectType=="Counties")
  req(input$Vis3_SelectCounty=="Complete")
  req(!is.null(SelCounties_Filtered_MapVis3_3()))



    SelCountyPoly_SHP_MapVis3_3(SelCounties_Filtered_MapVis3_3())

    County_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis3_3(),SelCountyPoly_SHP_MapVis3_3(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    County_Intersects2<-County_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      County_Intersects3<-Creel_SHP_Vis3_3()%>%slice(as.numeric(row.names(County_Intersects2)))

      MapVis3_3_SelectedWB_SHP(County_Intersects3)
  },ignoreInit=TRUE)

observeEvent(input$Vis3_SelectCounty, {
  req(input$Vis3_SelectType=="Counties")
  req(input$Vis3_SelectCounty=="Clear")

    HighlightTrace_3Vis(NULL)
    All_SelectedWB_3Vis(NULL)
    Data_3_3_Selected(NULL)
    Sel_SurveysScatter_Vis_3_3_UL(NULL) 
    HighlightTrace_Vis_3_3(NULL)
  MapVis3_3_SelectedWB_SHP(NULL) 


    SelCountyPoly_SHP_MapVis3_3(NULL)

    County_Clicks_MapVis3_3(NULL)
    SelCounties_Filtered_MapVis3_3(NULL)
    SelCountyPoints_SHP_MapVis3_3(NULL)
    Sel_SurveysMap_Vis_3_3_UL(NULL)
    Sel_SurveysAll_Vis_3_3_UL(NULL)


  },ignoreInit=TRUE)

   #### Vis 4_3 Map ####

    
  Map_4_3_Title<-eventReactive(c(input$Map_Vis3_Title_Text),{
     PH<-input$Map_Vis3_Title_Text
     return(paste("<span style=\"color:grey50,background-color:rgba(255,255,255,0)\"><strong>",PH,"</span>"))
   })

 Data_4_3_Complete_Percentiles<-reactiveVal(NULL)
   
   observeEvent(c(
     Data_4_3_Complete(),
     input$DisplayCreel_Map_Vis_3,
     input$Vis3_MapDisplayField,
     input$Vis3_MapDisplayField_Size,
     input$AF_VisNum_Selection
   ),{
     req(input$AF_VisNum_Selection==4)
     req(input$AF_SharedData)
     req(nrow(Data_4_3_Complete())>0)
     

      if(nrow(Data_4_3_Complete())>1){
       PH<-Data_4_3_Complete()%>%
        {if(input$Vis3_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis3=percent_rank(get(input$Vis3_MapDisplayField))*100) else .}%>%
        {if(input$Vis3_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis3=percent_rank(get(input$Vis3_MapDisplayField_Size))*100) else .}
    }else{
      PH<-Data_4_3_Complete()%>%
        {if(input$Vis3_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis3=50) else .}%>%
        {if(input$Vis3_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis3=50) else .}
    } 
      
      
      Data_4_3_Complete_Percentiles(PH)
     
   },ignoreInit=TRUE)

    Creel_SHP_Vis4_3<-eventReactive(Data_4_3_Complete_Percentiles(),{
      req(length(Data_4_3_Complete_Percentiles())>0)
      req(input$SelectVis3=="Map")
      req(input$AF_VisNum_Selection==4)
      sp::merge(x=CreelWaterbodies_SHP,y=Data_4_3_Complete_Percentiles(),by.x="WB_ID",by.y="WB_ID",all.x=FALSE)%>%
        st_jitter(amount=0.002)
      })

  Vis_4_3_MapSizeField<-eventReactive(input$Vis3_MapDisplayField_Size,{
    input$Vis3_MapDisplayField_Size
    })

  Vis_4_3_MapSizeMin<-eventReactive(c(input$Vis3_MapDisplayField_Size,input$Vis_3_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(if(input$AF_SharedData=="No"){length(input$Vis_3_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    PH<-Creel_SHP_Vis4_3()%>%
      pull(input$Vis3_MapDisplayField_Size)
      return(min(PH,na.rm=TRUE))
      })

  Vis_4_3_MapSizeMax<-eventReactive(
    c(input$Vis3_MapDisplayField_Size,input$Vis_3_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(if(input$AF_SharedData=="No"){length(input$Vis_3_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
      PH<-Creel_SHP_Vis4_3()%>%
        pull(input$Vis3_MapDisplayField_Size)
        return(max(PH,na.rm=TRUE))
      })

  Vis_4_3_MapSizeMinPix<-eventReactive(input$Vis3_MapDisplayField_SizeSlider,{
    input$Vis3_MapDisplayField_SizeSlider[1]
    })

  Vis_4_3_MapSizeMaxPix<-eventReactive(input$Vis3_MapDisplayField_SizeSlider,{
    input$Vis3_MapDisplayField_SizeSlider[2]
    })

  Vis_4_3_MapPix_Dif<-eventReactive(c(Vis_4_3_MapSizeMaxPix(),Vis_4_3_MapSizeMinPix()),{
    Vis_4_3_MapSizeMaxPix()-Vis_4_3_MapSizeMinPix()
    })

  Vis_4_3_MapSizeDenom<-eventReactive(c(Vis_4_3_MapSizeMax(),Vis_4_3_MapSizeMin()),{
    
    req(if(input$AF_SharedData=="No"){length(input$Vis_3_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    
    (Vis_4_3_MapSizeMax()-Vis_4_3_MapSizeMin())
    })

  Vis_4_3_MapSizeSingle<-eventReactive(input$Vis3_MapDisplayField_SizeSliderSingle,{
    input$Vis3_MapDisplayField_SizeSliderSingle
    })

  Vis_4_3_MapColorSolid<-eventReactive(input$Vis3_MapColorSolid,{
    input$Vis3_MapColorSolid
    })

    MapVis4_3_PalRange<-reactive({
      req(length(Creel_SHP_Vis4_3())>0)
    
      req(input$Vis3_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis4_3()%>%
        select(input$Vis3_MapDisplayField)
      })


   MapVis4_3_PercentilesPalRange<-reactive({
      req(length(Creel_SHP_Vis4_3())>0)
      req(Creel_SHP_Vis4_3()$ColorPercentile_Vis3)
    
      req(input$Vis3_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis4_3()%>%
        select(ColorPercentile_Vis3)
      })


    output$MapVis4_3 <- renderLeaflet({
      MapVis4_3_Requirement<-HTML(
       "<span style=\"color:red;background-color:white\"><strong>Click 'Display Creel Data on Map' from sidebar to add your creel data to the map.</span>"
   )


      CreelMap <- leaflet()%>%
        addMapPane("SelectedWBs",zIndex=440)%>%
        addMapPane("CreelData",zIndex=430)%>%
        addMapPane("SelectedArea",zIndex=420)%>%
        addMapPane("SupplementaryData",zIndex=410)%>%
        addProviderTiles("CartoDB.DarkMatter",group="Dark")%>%
        addProviderTiles("CartoDB.Positron",group="Light")%>%
        addWMSTiles(GetURL("USGSImageryTopo"),group="Imagery Topo Hybrid",layers="0")%>%
        addWMSTiles(GetURL("USGSTopo"),group="Topo",layers="0")%>%
        addWMSTiles(GetURL("USGSImageryOnly"),group="Imagery",layers="0")%>%
        addWMSTiles(GetURL("USGSShadedReliefOnly"),group="Shaded Relief",layers="0")%>%
        addWMSTiles(GetURL("USGSHydroCached"),group="Hydrography",layers="0",options =list(format="image/png",transparent=TRUE))%>%
        addPolygons(data=StateBoundaries_SHP,
                    group="State Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 2,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=StateBoundaries_SHP$STUSPS,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE),
        )%>%
        addPolygons(data=CountyBoundaries_SHP,
                    group="County Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 1.5,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=CountyBoundaries_SHP$County_ID,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE)
        )%>%
        addLayersControl(
          baseGroups=isolate(if(input$DarkMode=='Dark'){c("Dark","Light","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}else{c("Light","Dark","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}),
          overlayGroups =c("Creel Data", "State Boundaries","County Boundaries","Hydrography"),
          options = layersControlOptions(collapsed = TRUE))%>%
        hideGroup("County Boundaries")%>%
        hideGroup("Hydrography")%>%
        addMeasure()%>%
        addMiniMap(position="bottomleft",minimized=TRUE,toggleDisplay=TRUE)%>%
        addEasyButton(easyButton(
          icon="fa-globe", title="Zoom to Level 1",
          onClick=JS("function(btn, map){ map.setZoom(3); }")))%>%
        addEasyButton(easyButton(
          icon="fa-crosshairs", title="Locate Me",
          onClick=JS("function(btn, map){ map.locate({setView: true, maxZoom: 10}); }")))%>%
        onRender(
          "function(el, x) {
            L.easyPrint({
              sizeModes: ['Current', 'A4Landscape', 'A4Portrait'],
              filename: 'mymap',
              exportOnly: true,
              hideControlContainer: false
            }).addTo(this);
            }"
        )%>%
      addControl(MapVis4_3_Requirement,position="topright",layerId="ShowCreelMessage")
    })
    
  observeEvent(c(
    input$DarkMode,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
  ),{
    req(length(Creel_SHP_Vis4_3())>0)
    if(input$DarkMode=="Dark"){
      leafletProxy("MapVis4_3",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Light")%>%
        showGroup("Dark")
    }
        if(input$DarkMode=="Light"){
      leafletProxy("MapVis4_3",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Dark")%>%
        showGroup("Light")
    }
  },ignoreInit=TRUE)      

  observeEvent(c(
     MapVis4_3_SelectedWB_SHP(),
     MapVis4_3_PercentilesPalRange(),
    input$DisplayCreel_Map_Vis_3,
    input$Vis3_MapColorPalette,
    input$Vis3_Map_PalToggle,
    input$Vis3_Map_CreelColorscalePer,
    input$Vis3_MapDisplayField_SizeSlider,
    input$Vis3_MapColorSolid,
    input$Vis3_MapDisplayField_SizeSliderSingle,
    input$Vis3_Map_CreelSizescalePer,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis4_3())>0)
      req(input$Vis3_Map_CreelDisplayType)
      req(is.null(MapVis4_3_SelectedWB_SHP()))

      if(input$Vis3_Map_CreelDisplayType=="Scaled Color"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis3_Map_CreelDisplayType=="Scaled Size"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField_Size!="Nothing Selected")
      }


      Vis3_Map_Popup<- if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField,Creel_SHP_Vis4_3()[[input$Vis3_MapDisplayField]],Creel_SHP_Vis4_3()$Waterbody_Name_Unique,Creel_SHP_Vis4_3()$Year,Creel_SHP_Vis4_3()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField_Size,Creel_SHP_Vis4_3()[[input$Vis3_MapDisplayField_Size]],Creel_SHP_Vis4_3()$Waterbody_Name_Unique,Creel_SHP_Vis4_3()$Year,Creel_SHP_Vis4_3()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField,Creel_SHP_Vis4_3()[[input$Vis3_MapDisplayField]],input$Vis3_MapDisplayField_Size,Creel_SHP_Vis4_3()[[input$Vis3_MapDisplayField_Size]],Creel_SHP_Vis4_3()$Waterbody_Name_Unique,Creel_SHP_Vis4_3()$Year,Creel_SHP_Vis4_3()$Survey_ID)%>% lapply(htmltools::HTML)
      }

         pal <- colorNumeric(input$Vis3_MapColorPalette,MapVis4_3_PalRange()[[1]],reverse=input$Vis3_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis3_MapColorPalette,MapVis4_3_PercentilesPalRange()[[1]],reverse=input$Vis3_Map_PalToggle) 
        
       leafletProxy("MapVis4_3",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis4_3(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis4_3()$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 1,
                fillOpacity=1,
                stroke=FALSE,
                fillColor =if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){Vis_4_3_MapColorSolid()}else{if(input$Vis3_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis3_MapDisplayField))}else{~pal2(ColorPercentile_Vis3)}},
                radius=if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){Vis_4_3_MapSizeSingle()}else{if(input$Vis3_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis3_MapDisplayField_Size)-Vis_4_3_MapSizeMin())*Vis_4_3_MapPix_Dif())/Vis_4_3_MapSizeDenom())+Vis_4_3_MapSizeMinPix()))}else{~(((SizePercentile_Vis3*Vis_4_3_MapPix_Dif())/100)+Vis_4_3_MapSizeMinPix())}},
               label=Vis3_Map_Popup
      )

      },ignoreInit=TRUE)

  observeEvent(c(
     MapVis4_3_SelectedWB_SHP(),
    input$DisplayCreel_Map_Vis_3,
    input$Vis3_MapColorPalette,
    input$Vis3_Map_PalToggle,
     MapVis4_3_PercentilesPalRange(),
    input$Vis3_Map_CreelColorscalePer,
    input$Vis3_MapDisplayField_SizeSlider,
    input$Vis3_MapColorSolid,
    input$Vis3_MapDisplayField_SizeSliderSingle,
    input$Vis3_Map_CreelSizescalePer,
    input$Vis3_FillOpacity,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis4_3())>0)
      req(input$Vis3_Map_CreelDisplayType)
      req(!is.null(MapVis4_3_SelectedWB_SHP()))

      if(input$Vis3_Map_CreelDisplayType=="Scaled Color"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis3_Map_CreelDisplayType=="Scaled Size"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField_Size!="Nothing Selected")
      }


      Vis3_Map_Popup<- if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField,Creel_SHP_Vis4_3()[[input$Vis3_MapDisplayField]],Creel_SHP_Vis4_3()$Waterbody_Name_Unique,Creel_SHP_Vis4_3()$Year,Creel_SHP_Vis4_3()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField_Size,Creel_SHP_Vis4_3()[[input$Vis3_MapDisplayField_Size]],Creel_SHP_Vis4_3()$Waterbody_Name_Unique,Creel_SHP_Vis4_3()$Year,Creel_SHP_Vis4_3()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField,Creel_SHP_Vis4_3()[[input$Vis3_MapDisplayField]],input$Vis3_MapDisplayField_Size,Creel_SHP_Vis4_3()[[input$Vis3_MapDisplayField_Size]],Creel_SHP_Vis4_3()$Waterbody_Name_Unique,Creel_SHP_Vis4_3()$Year,Creel_SHP_Vis4_3()$Survey_ID)%>% lapply(htmltools::HTML)
      }
      
    Vis3_Map_Popup_Sel<-if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField,MapVis4_3_SelectedWB_SHP()[[input$Vis3_MapDisplayField]],MapVis4_3_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis4_3_SelectedWB_SHP()$Year,MapVis4_3_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField_Size,MapVis4_3_SelectedWB_SHP()[[input$Vis3_MapDisplayField_Size]],MapVis4_3_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis4_3_SelectedWB_SHP()$Year,MapVis4_3_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis3_MapDisplayField,MapVis4_3_SelectedWB_SHP()[[input$Vis3_MapDisplayField]],input$Vis3_MapDisplayField_Size,MapVis4_3_SelectedWB_SHP()[[input$Vis3_MapDisplayField_Size]],MapVis4_3_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis4_3_SelectedWB_SHP()$Year,MapVis4_3_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      }
    

         pal <- colorNumeric(input$Vis3_MapColorPalette,MapVis4_3_PalRange()[[1]],reverse=input$Vis3_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis3_MapColorPalette,MapVis4_3_PercentilesPalRange()[[1]],reverse=input$Vis3_Map_PalToggle) 
        
       leafletProxy("MapVis4_3",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis4_3(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis4_3()$FID),
                options=pathOptions(pane="CreelData"),
                fillOpacity=input$Vis3_FillOpacity,
                stroke=FALSE,
                fillColor =if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){Vis_4_3_MapColorSolid()}else{if(input$Vis3_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis3_MapDisplayField))}else{~pal2(ColorPercentile_Vis3)}},
                radius=if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){Vis_4_3_MapSizeSingle()}else{if(input$Vis3_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis3_MapDisplayField_Size)-Vis_4_3_MapSizeMin())*Vis_4_3_MapPix_Dif())/Vis_4_3_MapSizeDenom())+Vis_4_3_MapSizeMinPix()))}else{~(((SizePercentile_Vis3*Vis_4_3_MapPix_Dif())/100)+Vis_4_3_MapSizeMinPix())}},
               label=Vis3_Map_Popup
      )%>%
        addCircleMarkers(data=MapVis4_3_SelectedWB_SHP(),
                         group='Selected Waterbodies',
                         stroke=FALSE,
                         fillOpacity=1,
                fillColor =if(input$Vis3_Map_CreelDisplayType=="Scaled Size"){Vis_4_3_MapColorSolid()}else{if(input$Vis3_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis3_MapDisplayField))}else{~pal2(ColorPercentile_Vis3)}},
                radius=if(input$Vis3_Map_CreelDisplayType=="Scaled Color"){Vis_4_3_MapSizeSingle()}else{if(input$Vis3_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis3_MapDisplayField_Size)-Vis_4_3_MapSizeMin())*Vis_4_3_MapPix_Dif())/Vis_4_3_MapSizeDenom())+Vis_4_3_MapSizeMinPix()))}else{~(((SizePercentile_Vis3*Vis_4_3_MapPix_Dif())/100)+Vis_4_3_MapSizeMinPix())}},
               label=Vis3_Map_Popup_Sel,
                         options=pathOptions(pane="SelectedWBs"))

      },ignoreInit=TRUE)
  

    observeEvent(c(
      input$DisplayCreel_Map_Vis_3,
      input$Vis3_Map_CreelDisplayType,
      input$Vis3_AddLegend_Switch,
      input$Vis3_MapColorPalette,
      input$Vis3_Map_PalToggle,
      MapVis4_3_PercentilesPalRange(),
      input$Vis3_MapDisplayField_Size,
      input$Vis3_Map_CreelColorscalePer
    ),{
      req(length(Creel_SHP_Vis4_3())>0)
      req(input$Vis3_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_3_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    

      if(input$Vis3_Map_CreelDisplayType=="Scaled Color"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis3_Map_CreelDisplayType=="Scaled Size"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField_Size!="Nothing Selected")
      }


      if(input$Vis3_AddLegend_Switch=="Yes"&&(input$Vis3_Map_CreelDisplayType=="Scaled Color"||input$Vis3_Map_CreelDisplayType=="Both")){
        Vis3_Feature<-input$Vis3_MapDisplayField
         pal <- colorNumeric(input$Vis3_MapColorPalette,MapVis4_3_PalRange()[[1]],reverse=input$Vis3_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis3_MapColorPalette,MapVis4_3_PercentilesPalRange()[[1]],reverse=input$Vis3_Map_PalToggle) 
        
        leafletProxy("MapVis4_3",session)%>%
          removeControl(layerId="Legend")%>%
          addLegend("bottomright",
                pal = if(input$Vis3_Map_CreelColorscalePer=="Values"){pal}else{pal2},
                values=if(input$Vis3_Map_CreelColorscalePer=="Values"){Creel_SHP_Vis4_3()[[Vis3_Feature]]}else{c(0:100)},
                title=if(input$Vis3_Map_CreelColorscalePer=="Values"){paste(Vis3_Feature)}else{paste(Vis3_Feature,"</br>Percentile")},
                group= "CreelCat Data",
                layerId="Legend",
                opacity = 1)
      }else if(input$Vis3_AddLegend_Switch=="No"||input$Vis3_Map_CreelDisplayType=="Scaled Size"){
        leafletProxy("MapVis4_3",session)%>%
          removeControl(layerId="Legend")
      }
    },ignoreInit=TRUE)

    observeEvent(c(
      input$Vis3_CreelExtentZoomBTN,
      input$AF_VisNum_Selection,
      input$DisplayCreel_Map_Vis_3,
      Creel_SHP_Vis4_3(),
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(input$Vis3_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_3_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    

      if(input$Vis3_Map_CreelDisplayType=="Scaled Color"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis3_Map_CreelDisplayType=="Scaled Size"||input$Vis3_Map_CreelDisplayType=="Both"){
        req(input$Vis3_MapDisplayField_Size!="Nothing Selected")
      }

       CreelBounds<- st_bbox(Creel_SHP_Vis4_3())%>%as.vector()
        leafletProxy("MapVis4_3",session)%>%
          fitBounds(CreelBounds[1], CreelBounds[2], CreelBounds[3], CreelBounds[4])
    },ignoreInit=TRUE)


    observeEvent({
      input$Vis3_GeographyZoomBTN
    },{
      if(input$Vis3_ZoomToCounty=="Statewide"){
        SelectedStateBounds<-st_bbox(StateBoundaries_SHP[StateBoundaries_SHP$NAME==input$Vis3_ZoomToState,])%>%as.vector()
        leafletProxy("MapVis4_3",session)%>%
          fitBounds(SelectedStateBounds[1], SelectedStateBounds[2], SelectedStateBounds[3], SelectedStateBounds[4])
      }
      if(input$Vis3_ZoomToCounty!="Statewide"){
        SelectedCountyBounds<-st_bbox(CountyBoundaries_SHP%>%filter(State==input$Vis3_ZoomToState & County==input$Vis3_ZoomToCounty))%>%as.vector()
        leafletProxy("MapVis4_3",session)%>%
          fitBounds(SelectedCountyBounds[1], SelectedCountyBounds[2], SelectedCountyBounds[3], SelectedCountyBounds[4])
      }},ignoreInit=TRUE)

    observeEvent(c(
      input$Map_Vis3_Title_Text,
      input$Map_Vis3_Title_Switch
    ),{
      req(length(Creel_SHP_Vis4_3())>0)
      if(input$Map_Vis3_Title_Switch=="Yes"){
        leafletProxy("MapVis4_3",session)%>%
         removeControl(layerId="Map4_3_Title")%>%
          addControl(Map_4_3_Title(),position=c("bottomright"),layerId="Map4_3_Title")
      }else if(input$Map_Vis3_Title_Switch=="No"){
        leafletProxy("MapVis4_3",session)%>%
         removeControl(layerId="Map4_3_Title")
      }
    },ignoreInit=TRUE)
    

MapVis4_3_SelectedWB_SHP<-reactiveVal(NULL)
    
MapVis4_3_area<-reactiveValues()

Poly_SHP_MapVis4_3<-reactiveVal()

observeEvent(input$MapVis4_3_click, {
  req(input$Vis3_SelectType=="Polygon")
  req(input$Vis3_SelectPolygon=="Draw")

    coords <- input$MapVis4_3_click
    cm <- matrix(data = c(coords$lat, coords$lng), nrow = 1, ncol = 2)
    MapVis4_3_area$mp <- if(!is.null(MapVis4_3_area$mp)){rbind(MapVis4_3_area$mp, cm)}else{cm}

    leafletProxy("MapVis4_3")%>%
      clearGroup("Polygon Draw")%>%
      addPolygons(lat = MapVis4_3_area$mp[ , 1], lng = MapVis4_3_area$mp[ , 2],color="red",fillOpacity=0,group='Polygon Draw',
          options=pathOptions(pane="SelectedArea"))

},ignoreInit=TRUE)

observeEvent(input$Vis3_SelectPolygon, {

  req(input$Vis3_SelectType=="Polygon")
  req(length(MapVis4_3_area$mp)>5)
  req(input$Vis3_SelectPolygon=="Complete")

  Sel_MapVis4_3_area<-as.data.frame(MapVis4_3_area$mp)%>%
    rename(lat=1)%>%
    rename(lng=2)



 Poly_SHP_MapVis4_3(
    polygon_MapVis4_3<-Sel_MapVis4_3_area%>%
  st_as_sf(coords = c("lng", "lat"), crs = 4326)%>%
  summarise(geometry = st_combine(geometry))%>%
  st_cast("POLYGON")
 )
 
 PolyPoints<-Creel_SHP_Vis4_3()%>%
                  filter(st_intersects(.,Poly_SHP_MapVis4_3(),sparse=FALSE)[,1])
 
  MapVis4_3_SelectedWB_SHP(PolyPoints)

},ignoreInit=TRUE)

observeEvent(input$Vis3_SelectPolygon,{

  req(input$Vis3_SelectPolygon=="Clear")
  req(input$Vis3_SelectType=="Polygon")
  
  HighlightTrace_4Vis(NULL)
  All_SelectedWB_4Vis(NULL)
  Data_4_3_Selected(NULL)
  Sel_SurveysScatter_Vis_4_3_UL(NULL) 
  HighlightTrace_Vis_4_3(NULL) 
  MapVis3_3_SelectedWB_SHP(NULL)
  

  MapVis4_3_area$mp<-NULL

  Poly_SHP_MapVis4_3(NULL)

    Sel_SurveysMap_Vis_4_3_UL(NULL)
    Sel_SurveysAll_Vis_4_3_UL(NULL)
  

},ignoreInit=TRUE)

State_Clicks_MapVis4_3<-reactiveVal()
SelStatePoly_SHP_MapVis4_3<-reactiveVal()
SelStatePoints_SHP_MapVis4_3<-reactiveVal()
SelStates_Filtered_MapVis4_3<-reactiveVal()

observeEvent(input$MapVis4_3_click, {

  req(input$Vis3_SelectType=="States")
  req(input$Vis3_SelectState=="Select")

      click <- input$MapVis4_3_shape_click

      State_Clicks_MapVis4_3(list(c(State_Clicks_MapVis4_3(),click$id)))

    SelStates_df<-as.data.frame(State_Clicks_MapVis4_3())


    Selected_States_Vector<-as.character(SelStates_df[1,])


    PH<-StateBoundaries_SHP%>%
      filter(., STUSPS %in% Selected_States_Vector)

    SelStates_Filtered_MapVis4_3(PH)


    leafletProxy("MapVis4_3")%>%
      clearGroup("Selected States")%>%
      addPolygons(data=SelStates_Filtered_MapVis4_3(),color="red",weight=3,fillOpacity=0,group='Selected States',
          options=pathOptions(pane="SelectedArea"))
  },ignoreInit=TRUE)

observeEvent(input$Vis3_SelectState, {

  req(input$Vis3_SelectType=="States")
  req(input$Vis3_SelectState=="Complete")
  req(!is.null(SelStates_Filtered_MapVis4_3()))

    SelStatePoly_SHP_MapVis4_3(SelStates_Filtered_MapVis4_3())

    State_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis4_3(),SelStatePoly_SHP_MapVis4_3(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    State_Intersects2<-State_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      State_Intersects3<-Creel_SHP_Vis4_3()%>%slice(as.numeric(row.names(State_Intersects2)))


       MapVis4_3_SelectedWB_SHP(State_Intersects3)


  },ignoreInit=TRUE)

observeEvent(input$Vis3_SelectState, {
  req(input$Vis3_SelectType=="States")
  req(input$Vis3_SelectState=="Clear")
  
  HighlightTrace_4Vis(NULL)
  All_SelectedWB_4Vis(NULL)
  Data_4_3_Selected(NULL)
  Sel_SurveysScatter_Vis_4_3_UL(NULL) 
  HighlightTrace_Vis_4_3(NULL) 
  MapVis4_3_SelectedWB_SHP(NULL)

    SelStatePoly_SHP_MapVis4_3(NULL)

    State_Clicks_MapVis4_3(NULL)
    SelStates_Filtered_MapVis4_3(NULL)
    SelStatePoints_SHP_MapVis4_3(NULL)
    Sel_SurveysMap_Vis_4_3_UL(NULL)
    Sel_SurveysAll_Vis_4_3_UL(NULL)

  },ignoreInit=TRUE)



observeEvent(input$Vis3_SelectType, {

  req(input$Vis3_SelectType=="States")

    leafletProxy("MapVis4_3")%>%
      hideGroup("County Boundaries")%>%
      showGroup("State Boundaries")
},ignoreInit=TRUE)

observeEvent(input$Vis3_SelectType, {

  req(input$Vis3_SelectType=="Counties")

    leafletProxy("MapVis4_3")%>%
      hideGroup("State Boundaries")%>%
      showGroup("County Boundaries")
},ignoreInit=TRUE)


County_Clicks_MapVis4_3<-reactiveVal()
SelCountyPoly_SHP_MapVis4_3<-reactiveVal()
SelCountyPoints_SHP_MapVis4_3<-reactiveVal()
SelCounties_Filtered_MapVis4_3<-reactiveVal()

observeEvent(input$MapVis4_3_click, {

  req(input$Vis3_SelectType=="Counties")
  req(input$Vis3_SelectCounty=="Select")

      click <- input$MapVis4_3_shape_click

      County_Clicks_MapVis4_3(list(c(County_Clicks_MapVis4_3(),click$id)))

    SelCounties_df<-as.data.frame(County_Clicks_MapVis4_3())


    Selected_Counties_Vector<-as.character(SelCounties_df[1,])


    PH<-CountyBoundaries_SHP%>%
      filter(., County_ID %in% Selected_Counties_Vector)

    SelCounties_Filtered_MapVis4_3(PH)

    leafletProxy("MapVis4_3")%>%
      clearGroup("Selected Counties")%>%
      addPolygons(data=SelCounties_Filtered_MapVis4_3(),color="red",weight=3,fillOpacity=0,group='Selected Counties',
          options=pathOptions(pane="SelectedArea"))



  },ignoreInit=TRUE)

observeEvent(input$Vis3_SelectCounty, {

  req(input$Vis3_SelectType=="Counties")
  req(input$Vis3_SelectCounty=="Complete")
  req(!is.null(SelCounties_Filtered_MapVis4_3()))



    SelCountyPoly_SHP_MapVis4_3(SelCounties_Filtered_MapVis4_3())

    County_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis4_3(),SelCountyPoly_SHP_MapVis4_3(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    County_Intersects2<-County_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      County_Intersects3<-Creel_SHP_Vis4_3()%>%slice(as.numeric(row.names(County_Intersects2)))

      MapVis4_3_SelectedWB_SHP(County_Intersects3)


  },ignoreInit=TRUE)

observeEvent(input$Vis3_SelectCounty, {
  req(input$Vis3_SelectType=="Counties")
  req(input$Vis3_SelectCounty=="Clear")

    HighlightTrace_4Vis(NULL)
    All_SelectedWB_4Vis(NULL)
    Data_4_3_Selected(NULL)
    Sel_SurveysScatter_Vis_4_3_UL(NULL) 
    HighlightTrace_Vis_4_3(NULL)
  MapVis4_3_SelectedWB_SHP(NULL) 


    SelCountyPoly_SHP_MapVis4_3(NULL)

    County_Clicks_MapVis4_3(NULL)
    SelCounties_Filtered_MapVis4_3(NULL)
    SelCountyPoints_SHP_MapVis4_3(NULL)
    Sel_SurveysMap_Vis_4_3_UL(NULL)
    Sel_SurveysAll_Vis_4_3_UL(NULL)


  },ignoreInit=TRUE)

   #### Vis 4_4 Map ####

    
  Map_4_4_Title<-eventReactive(c(input$Map_Vis4_Title_Text),{
     PH<-input$Map_Vis4_Title_Text
     return(paste("<span style=\"color:grey50,background-color:rgba(255,255,255,0)\"><strong>",PH,"</span>"))
   })

 Data_4_4_Complete_Percentiles<-reactiveVal(NULL)
   
   observeEvent(c(
     Data_4_4_Complete(),
     input$DisplayCreel_Map_Vis_4,
     input$Vis4_MapDisplayField,
     input$Vis4_MapDisplayField_Size,
     input$AF_VisNum_Selection
   ),{
     req(input$AF_VisNum_Selection==4)
     req(input$AF_SharedData)
     req(nrow(Data_4_4_Complete())>0)
     

      if(nrow(Data_4_4_Complete())>1){
       PH<-Data_4_4_Complete()%>%
        {if(input$Vis4_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis4=percent_rank(get(input$Vis4_MapDisplayField))*100) else .}%>%
        {if(input$Vis4_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis4=percent_rank(get(input$Vis4_MapDisplayField_Size))*100) else .}
    }else{
      PH<-Data_4_4_Complete()%>%
        {if(input$Vis4_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis4=50) else .}%>%
        {if(input$Vis4_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis4=50) else .}
    } 
      
      Data_4_4_Complete_Percentiles(PH)
     
   },ignoreInit=TRUE)

    Creel_SHP_Vis4_4<-eventReactive(Data_4_4_Complete_Percentiles(),{
      req(length(Data_4_4_Complete_Percentiles())>0)
      req(input$SelectVis4=="Map")
      req(input$AF_VisNum_Selection==4)
      sp::merge(x=CreelWaterbodies_SHP,y=Data_4_4_Complete_Percentiles(),by.x="WB_ID",by.y="WB_ID",all.x=FALSE)%>%
        st_jitter(amount=0.002)
      })

  Vis_4_4_MapSizeField<-eventReactive(input$Vis4_MapDisplayField_Size,{
    input$Vis4_MapDisplayField_Size
    })

  Vis_4_4_MapSizeMin<-eventReactive(c(input$Vis4_MapDisplayField_Size,input$Vis_4_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(if(input$AF_SharedData=="No"){length(input$Vis_4_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    PH<-Creel_SHP_Vis4_4()%>%
      pull(input$Vis4_MapDisplayField_Size)
      return(min(PH,na.rm=TRUE))
      })

  Vis_4_4_MapSizeMax<-eventReactive(
    c(input$Vis4_MapDisplayField_Size,input$Vis_4_Input_rows_selected,input$Vis_Filters_Shared_rows_selected),{
    req(if(input$AF_SharedData=="No"){length(input$Vis_4_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
      PH<-Creel_SHP_Vis4_4()%>%
        pull(input$Vis4_MapDisplayField_Size)
        return(max(PH,na.rm=TRUE))
      })

  Vis_4_4_MapSizeMinPix<-eventReactive(input$Vis4_MapDisplayField_SizeSlider,{
    input$Vis4_MapDisplayField_SizeSlider[1]
    })

  Vis_4_4_MapSizeMaxPix<-eventReactive(input$Vis4_MapDisplayField_SizeSlider,{
    input$Vis4_MapDisplayField_SizeSlider[2]
    })

  Vis_4_4_MapPix_Dif<-eventReactive(c(Vis_4_4_MapSizeMaxPix(),Vis_4_4_MapSizeMinPix()),{
    Vis_4_4_MapSizeMaxPix()-Vis_4_4_MapSizeMinPix()
    })

  Vis_4_4_MapSizeDenom<-eventReactive(c(Vis_4_4_MapSizeMax(),Vis_4_4_MapSizeMin()),{
    
    req(if(input$AF_SharedData=="No"){length(input$Vis_4_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    
    (Vis_4_4_MapSizeMax()-Vis_4_4_MapSizeMin())
    })

  Vis_4_4_MapSizeSingle<-eventReactive(input$Vis4_MapDisplayField_SizeSliderSingle,{
    input$Vis4_MapDisplayField_SizeSliderSingle
    })

  Vis_4_4_MapColorSolid<-eventReactive(input$Vis4_MapColorSolid,{
    input$Vis4_MapColorSolid
    })

    MapVis4_4_PalRange<-reactive({
      req(length(Creel_SHP_Vis4_4())>0)
    
      req(input$Vis4_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis4_4()%>%
        select(input$Vis4_MapDisplayField)
      })


   MapVis4_4_PercentilesPalRange<-reactive({
      req(length(Creel_SHP_Vis4_4())>0)
      req(Creel_SHP_Vis4_4()$ColorPercentile_Vis4)
    
      req(input$Vis4_MapDisplayField!="Nothing Selected")
      Creel_SHP_Vis4_4()%>%
        select(ColorPercentile_Vis4)
      })


    output$MapVis4_4 <- renderLeaflet({
      MapVis4_4_Requirement<-HTML(
       "<span style=\"color:red;background-color:white\"><strong>Click 'Display Creel Data on Map' from sidebar to add your creel data to the map.</span>"
   )


      CreelMap <- leaflet()%>%
        addMapPane("SelectedWBs",zIndex=440)%>%
        addMapPane("CreelData",zIndex=430)%>%
        addMapPane("SelectedArea",zIndex=420)%>%
        addMapPane("SupplementaryData",zIndex=410)%>%
        addProviderTiles("CartoDB.DarkMatter",group="Dark")%>%
        addProviderTiles("CartoDB.Positron",group="Light")%>%
        addWMSTiles(GetURL("USGSImageryTopo"),group="Imagery Topo Hybrid",layers="0")%>%
        addWMSTiles(GetURL("USGSTopo"),group="Topo",layers="0")%>%
        addWMSTiles(GetURL("USGSImageryOnly"),group="Imagery",layers="0")%>%
        addWMSTiles(GetURL("USGSShadedReliefOnly"),group="Shaded Relief",layers="0")%>%
        addWMSTiles(GetURL("USGSHydroCached"),group="Hydrography",layers="0",options =list(format="image/png",transparent=TRUE))%>%
        addPolygons(data=StateBoundaries_SHP,
                    group="State Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 2,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=StateBoundaries_SHP$STUSPS,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE),
        )%>%
        addPolygons(data=CountyBoundaries_SHP,
                    group="County Boundaries",
                    options=pathOptions(pane="SupplementaryData"),
                    weight = 1.5,
                    opacity = 1,
                    color = "grey",
                    dashArray = "1",
                    fillOpacity = 0,
                    layerId=CountyBoundaries_SHP$County_ID,
                    highlight = highlightOptions(
                      weight = 5,
                      color = "#666",
                      dashArray = "",
                      fillOpacity = 0,
                      bringToFront = TRUE)
        )%>%
        addLayersControl(
          baseGroups=isolate(if(input$DarkMode=='Dark'){c("Dark","Light","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}else{c("Light","Dark","Imagery Topo Hybrid","Topo","Imagery","Shaded Relief")}),
          overlayGroups =c("Creel Data", "State Boundaries","County Boundaries","Hydrography"),
          options = layersControlOptions(collapsed = TRUE))%>%
        hideGroup("County Boundaries")%>%
        hideGroup("Hydrography")%>%
        addMeasure()%>%
        addMiniMap(position="bottomleft",minimized=TRUE,toggleDisplay=TRUE)%>%
        addEasyButton(easyButton(
          icon="fa-globe", title="Zoom to Level 1",
          onClick=JS("function(btn, map){ map.setZoom(3); }")))%>%
        addEasyButton(easyButton(
          icon="fa-crosshairs", title="Locate Me",
          onClick=JS("function(btn, map){ map.locate({setView: true, maxZoom: 10}); }")))%>%
        onRender(
          "function(el, x) {
            L.easyPrint({
              sizeModes: ['Current', 'A4Landscape', 'A4Portrait'],
              filename: 'mymap',
              exportOnly: true,
              hideControlContainer: false
            }).addTo(this);
            }"
        )%>%
      addControl(MapVis4_4_Requirement,position="topright",layerId="ShowCreelMessage")
    })
    
  observeEvent(c(
    input$DarkMode,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
  ),{
    req(length(Creel_SHP_Vis4_4())>0)
    if(input$DarkMode=="Dark"){
      leafletProxy("MapVis4_4",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Light")%>%
        showGroup("Dark")
    }
        if(input$DarkMode=="Light"){
      leafletProxy("MapVis4_4",session)%>%
        hideGroup("Imagery Topo Hybrid")%>%
        hideGroup("Topo")%>%
        hideGroup("Imagery")%>%
        hideGroup("Shaded Relief")%>%
        hideGroup("Dark")%>%
        showGroup("Light")
    }
  },ignoreInit=TRUE)      

  observeEvent(c(
     MapVis4_4_SelectedWB_SHP(),
     MapVis4_4_PercentilesPalRange(),
    input$DisplayCreel_Map_Vis_4,
    input$Vis4_MapColorPalette,
    input$Vis4_Map_PalToggle,
    input$Vis4_Map_CreelColorscalePer,
    input$Vis4_MapDisplayField_SizeSlider,
    input$Vis4_MapColorSolid,
    input$Vis4_MapDisplayField_SizeSliderSingle,
    input$Vis4_Map_CreelSizescalePer,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis4_4())>0)
      req(input$Vis4_Map_CreelDisplayType)
      req(is.null(MapVis4_4_SelectedWB_SHP()))

      if(input$Vis4_Map_CreelDisplayType=="Scaled Color"||input$Vis4_Map_CreelDisplayType=="Both"){
        req(input$Vis4_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis4_Map_CreelDisplayType=="Scaled Size"||input$Vis4_Map_CreelDisplayType=="Both"){
        req(input$Vis4_MapDisplayField_Size!="Nothing Selected")
      }


      Vis4_Map_Popup<- if(input$Vis4_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis4_MapDisplayField,Creel_SHP_Vis4_4()[[input$Vis4_MapDisplayField]],Creel_SHP_Vis4_4()$Waterbody_Name_Unique,Creel_SHP_Vis4_4()$Year,Creel_SHP_Vis4_4()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis4_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis4_MapDisplayField_Size,Creel_SHP_Vis4_4()[[input$Vis4_MapDisplayField_Size]],Creel_SHP_Vis4_4()$Waterbody_Name_Unique,Creel_SHP_Vis4_4()$Year,Creel_SHP_Vis4_4()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis4_MapDisplayField,Creel_SHP_Vis4_4()[[input$Vis4_MapDisplayField]],input$Vis4_MapDisplayField_Size,Creel_SHP_Vis4_4()[[input$Vis4_MapDisplayField_Size]],Creel_SHP_Vis4_4()$Waterbody_Name_Unique,Creel_SHP_Vis4_4()$Year,Creel_SHP_Vis4_4()$Survey_ID)%>% lapply(htmltools::HTML)
      }

         pal <- colorNumeric(input$Vis4_MapColorPalette,MapVis4_4_PalRange()[[1]],reverse=input$Vis4_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis4_MapColorPalette,MapVis4_4_PercentilesPalRange()[[1]],reverse=input$Vis4_Map_PalToggle) 
        
       leafletProxy("MapVis4_4",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis4_4(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis4_4()$FID),
                options=pathOptions(pane="CreelData"),
                weight = 1.0,
                opacity = 1,
                fillOpacity=1,
                stroke=FALSE,
                fillColor =if(input$Vis4_Map_CreelDisplayType=="Scaled Size"){Vis_4_4_MapColorSolid()}else{if(input$Vis4_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis4_MapDisplayField))}else{~pal2(ColorPercentile_Vis4)}},
                radius=if(input$Vis4_Map_CreelDisplayType=="Scaled Color"){Vis_4_4_MapSizeSingle()}else{if(input$Vis4_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis4_MapDisplayField_Size)-Vis_4_4_MapSizeMin())*Vis_4_4_MapPix_Dif())/Vis_4_4_MapSizeDenom())+Vis_4_4_MapSizeMinPix()))}else{~(((SizePercentile_Vis4*Vis_4_4_MapPix_Dif())/100)+Vis_4_4_MapSizeMinPix())}},
               label=Vis4_Map_Popup
      )

      },ignoreInit=TRUE)

  observeEvent(c(
     MapVis4_4_SelectedWB_SHP(),
    input$DisplayCreel_Map_Vis_4,
    input$Vis4_MapColorPalette,
    input$Vis4_Map_PalToggle,
     MapVis4_4_PercentilesPalRange(),
    input$Vis4_Map_CreelColorscalePer,
    input$Vis4_MapDisplayField_SizeSlider,
    input$Vis4_MapColorSolid,
    input$Vis4_MapDisplayField_SizeSliderSingle,
    input$Vis4_Map_CreelSizescalePer,
    input$Vis4_FillOpacity,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis4_4())>0)
      req(input$Vis4_Map_CreelDisplayType)
      req(!is.null(MapVis4_4_SelectedWB_SHP()))

      if(input$Vis4_Map_CreelDisplayType=="Scaled Color"||input$Vis4_Map_CreelDisplayType=="Both"){
        req(input$Vis4_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis4_Map_CreelDisplayType=="Scaled Size"||input$Vis4_Map_CreelDisplayType=="Both"){
        req(input$Vis4_MapDisplayField_Size!="Nothing Selected")
      }


      Vis4_Map_Popup<- if(input$Vis4_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis4_MapDisplayField,Creel_SHP_Vis4_4()[[input$Vis4_MapDisplayField]],Creel_SHP_Vis4_4()$Waterbody_Name_Unique,Creel_SHP_Vis4_4()$Year,Creel_SHP_Vis4_4()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis4_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis4_MapDisplayField_Size,Creel_SHP_Vis4_4()[[input$Vis4_MapDisplayField_Size]],Creel_SHP_Vis4_4()$Waterbody_Name_Unique,Creel_SHP_Vis4_4()$Year,Creel_SHP_Vis4_4()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis4_MapDisplayField,Creel_SHP_Vis4_4()[[input$Vis4_MapDisplayField]],input$Vis4_MapDisplayField_Size,Creel_SHP_Vis4_4()[[input$Vis4_MapDisplayField_Size]],Creel_SHP_Vis4_4()$Waterbody_Name_Unique,Creel_SHP_Vis4_4()$Year,Creel_SHP_Vis4_4()$Survey_ID)%>% lapply(htmltools::HTML)
      }
      
    Vis4_Map_Popup_Sel<-if(input$Vis4_Map_CreelDisplayType=="Scaled Color"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis4_MapDisplayField,MapVis4_4_SelectedWB_SHP()[[input$Vis4_MapDisplayField]],MapVis4_4_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis4_4_SelectedWB_SHP()$Year,MapVis4_4_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else if(input$Vis4_Map_CreelDisplayType=="Scaled Size"){sprintf(
          "<strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis4_MapDisplayField_Size,MapVis4_4_SelectedWB_SHP()[[input$Vis4_MapDisplayField_Size]],MapVis4_4_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis4_4_SelectedWB_SHP()$Year,MapVis4_4_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      } else {sprintf(
        "<strong>%s: %s</strong><br/><strong>%s: %s</strong><br/>%s (%s)<br/>Survey_ID: %s",
          input$Vis4_MapDisplayField,MapVis4_4_SelectedWB_SHP()[[input$Vis4_MapDisplayField]],input$Vis4_MapDisplayField_Size,MapVis4_4_SelectedWB_SHP()[[input$Vis4_MapDisplayField_Size]],MapVis4_4_SelectedWB_SHP()$Waterbody_Name_Unique,MapVis4_4_SelectedWB_SHP()$Year,MapVis4_4_SelectedWB_SHP()$Survey_ID)%>% lapply(htmltools::HTML)
      }
    

         pal <- colorNumeric(input$Vis4_MapColorPalette,MapVis4_4_PalRange()[[1]],reverse=input$Vis4_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis4_MapColorPalette,MapVis4_4_PercentilesPalRange()[[1]],reverse=input$Vis4_Map_PalToggle) 
        
       leafletProxy("MapVis4_4",session)%>%
        removeControl(layerId="ShowCreelMessage")%>%
          clearGroup("Creel Data")%>%
          clearGroup("Selected States")%>%
          clearGroup("Selected Counties")%>%
          clearGroup("Polygon Draw")%>%
          clearGroup('Selected Waterbodies')%>%
        addCircleMarkers(
          data=Creel_SHP_Vis4_4(),
                group=c("Creel Data"),
                layerId = as.character(Creel_SHP_Vis4_4()$FID),
                options=pathOptions(pane="CreelData"),
                fillOpacity=input$Vis4_FillOpacity,
                stroke=FALSE,
                fillColor =if(input$Vis4_Map_CreelDisplayType=="Scaled Size"){Vis_4_4_MapColorSolid()}else{if(input$Vis4_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis4_MapDisplayField))}else{~pal2(ColorPercentile_Vis4)}},
                radius=if(input$Vis4_Map_CreelDisplayType=="Scaled Color"){Vis_4_4_MapSizeSingle()}else{if(input$Vis4_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis4_MapDisplayField_Size)-Vis_4_4_MapSizeMin())*Vis_4_4_MapPix_Dif())/Vis_4_4_MapSizeDenom())+Vis_4_4_MapSizeMinPix()))}else{~(((SizePercentile_Vis4*Vis_4_4_MapPix_Dif())/100)+Vis_4_4_MapSizeMinPix())}},
               label=Vis4_Map_Popup
      )%>%
        addCircleMarkers(data=MapVis4_4_SelectedWB_SHP(),
                         group='Selected Waterbodies',
                         stroke=FALSE,
                         fillOpacity=1,
                fillColor =if(input$Vis4_Map_CreelDisplayType=="Scaled Size"){Vis_4_4_MapColorSolid()}else{if(input$Vis4_Map_CreelColorscalePer=="Values"){~pal(get(input$Vis4_MapDisplayField))}else{~pal2(ColorPercentile_Vis4)}},
                radius=if(input$Vis4_Map_CreelDisplayType=="Scaled Color"){Vis_4_4_MapSizeSingle()}else{if(input$Vis4_Map_CreelSizescalePer=="Values"){~(((((get(input$Vis4_MapDisplayField_Size)-Vis_4_4_MapSizeMin())*Vis_4_4_MapPix_Dif())/Vis_4_4_MapSizeDenom())+Vis_4_4_MapSizeMinPix()))}else{~(((SizePercentile_Vis4*Vis_4_4_MapPix_Dif())/100)+Vis_4_4_MapSizeMinPix())}},
               label=Vis4_Map_Popup_Sel,
                         options=pathOptions(pane="SelectedWBs"))

      },ignoreInit=TRUE)
  

    observeEvent(c(
      input$DisplayCreel_Map_Vis_4,
      input$Vis4_Map_CreelDisplayType,
      input$Vis4_AddLegend_Switch,
      input$Vis4_MapColorPalette,
      input$Vis4_Map_PalToggle,
      MapVis4_4_PercentilesPalRange(),
      input$Vis4_MapDisplayField_Size,
      input$Vis4_Map_CreelColorscalePer,
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(length(Creel_SHP_Vis4_4())>0)
      req(input$Vis4_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_4_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    

      if(input$Vis4_Map_CreelDisplayType=="Scaled Color"||input$Vis4_Map_CreelDisplayType=="Both"){
        req(input$Vis4_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis4_Map_CreelDisplayType=="Scaled Size"||input$Vis4_Map_CreelDisplayType=="Both"){
        req(input$Vis4_MapDisplayField_Size!="Nothing Selected")
      }


      if(input$Vis4_AddLegend_Switch=="Yes"&&(input$Vis4_Map_CreelDisplayType=="Scaled Color"||input$Vis4_Map_CreelDisplayType=="Both")){
        Vis4_Feature<-input$Vis4_MapDisplayField
         pal <- colorNumeric(input$Vis4_MapColorPalette,MapVis4_4_PalRange()[[1]],reverse=input$Vis4_Map_PalToggle)
         pal2 <-colorNumeric(input$Vis4_MapColorPalette,MapVis4_4_PercentilesPalRange()[[1]],reverse=input$Vis4_Map_PalToggle) 
        
        leafletProxy("MapVis4_4",session)%>%
          removeControl(layerId="Legend")%>%
          addLegend("bottomright",
                pal = if(input$Vis4_Map_CreelColorscalePer=="Values"){pal}else{pal2},
                values=if(input$Vis4_Map_CreelColorscalePer=="Values"){Creel_SHP_Vis4_4()[[Vis4_Feature]]}else{c(0:100)},
                title=if(input$Vis4_Map_CreelColorscalePer=="Values"){paste(Vis4_Feature)}else{paste(Vis4_Feature,"</br>Percentile")},
                group= "CreelCat Data",
                layerId="Legend",
                opacity = 1)
      }else if(input$Vis4_AddLegend_Switch=="No"||input$Vis4_Map_CreelDisplayType=="Scaled Size"){
        leafletProxy("MapVis4_4",session)%>%
          removeControl(layerId="Legend")
      }
    },ignoreInit=TRUE)

    observeEvent(c(
      input$Vis4_CreelExtentZoomBTN,
      input$AF_VisNum_Selection,
      input$DisplayCreel_Map_Vis_4,
      Creel_SHP_Vis4_4(),
    input$AF_LinkedSelection,
    input$AF_SharedData,
    input$AF_VisNum_Selection
    ),{
      req(input$Vis4_Map_CreelDisplayType)
      req(if(input$AF_SharedData=="No"){length(input$Vis_4_Input_rows_selected)>0}else{length(input$Vis_Filters_Shared_rows_selected)>0})
    

      if(input$Vis4_Map_CreelDisplayType=="Scaled Color"||input$Vis4_Map_CreelDisplayType=="Both"){
        req(input$Vis4_MapDisplayField!="Nothing Selected")
      }

      if(input$Vis4_Map_CreelDisplayType=="Scaled Size"||input$Vis4_Map_CreelDisplayType=="Both"){
        req(input$Vis4_MapDisplayField_Size!="Nothing Selected")
      }

       CreelBounds<- st_bbox(Creel_SHP_Vis4_4())%>%as.vector()
        leafletProxy("MapVis4_4",session)%>%
          fitBounds(CreelBounds[1], CreelBounds[2], CreelBounds[3], CreelBounds[4])
    },ignoreInit=TRUE)


    observeEvent({
      input$Vis4_GeographyZoomBTN
    },{
      if(input$Vis4_ZoomToCounty=="Statewide"){
        SelectedStateBounds<-st_bbox(StateBoundaries_SHP[StateBoundaries_SHP$NAME==input$Vis4_ZoomToState,])%>%as.vector()
        leafletProxy("MapVis4_4",session)%>%
          fitBounds(SelectedStateBounds[1], SelectedStateBounds[2], SelectedStateBounds[3], SelectedStateBounds[4])
      }
      if(input$Vis4_ZoomToCounty!="Statewide"){
        SelectedCountyBounds<-st_bbox(CountyBoundaries_SHP%>%filter(State==input$Vis4_ZoomToState & County==input$Vis4_ZoomToCounty))%>%as.vector()
        leafletProxy("MapVis4_4",session)%>%
          fitBounds(SelectedCountyBounds[1], SelectedCountyBounds[2], SelectedCountyBounds[3], SelectedCountyBounds[4])
      }},ignoreInit=TRUE)

    observeEvent(c(
      input$Map_Vis4_Title_Text,
      input$Map_Vis4_Title_Switch
    ),{
      req(length(Creel_SHP_Vis4_4())>0)
      if(input$Map_Vis4_Title_Switch=="Yes"){
        leafletProxy("MapVis4_4",session)%>%
         removeControl(layerId="Map4_4_Title")%>%
          addControl(Map_4_4_Title(),position=c("bottomright"),layerId="Map4_4_Title")
      }else if(input$Map_Vis4_Title_Switch=="No"){
        leafletProxy("MapVis4_4",session)%>%
         removeControl(layerId="Map4_4_Title")
      }
    },ignoreInit=TRUE)
    

MapVis4_4_SelectedWB_SHP<-reactiveVal(NULL)
    
MapVis4_4_area<-reactiveValues()

Poly_SHP_MapVis4_4<-reactiveVal()

observeEvent(input$MapVis4_4_click, {
  req(input$Vis4_SelectType=="Polygon")
  req(input$Vis4_SelectPolygon=="Draw")

    coords <- input$MapVis4_4_click
    cm <- matrix(data = c(coords$lat, coords$lng), nrow = 1, ncol = 2)
    MapVis4_4_area$mp <- if(!is.null(MapVis4_4_area$mp)){rbind(MapVis4_4_area$mp, cm)}else{cm}

    leafletProxy("MapVis4_4")%>%
      clearGroup("Polygon Draw")%>%
      addPolygons(lat = MapVis4_4_area$mp[ , 1], lng = MapVis4_4_area$mp[ , 2],color="red",fillOpacity=0,group='Polygon Draw',
          options=pathOptions(pane="SelectedArea"))

},ignoreInit=TRUE)

observeEvent(input$Vis4_SelectPolygon, {

  req(input$Vis4_SelectType=="Polygon")
  req(length(MapVis4_4_area$mp)>5)
  req(input$Vis4_SelectPolygon=="Complete")

  Sel_MapVis4_4_area<-as.data.frame(MapVis4_4_area$mp)%>%
    rename(lat=1)%>%
    rename(lng=2)



 Poly_SHP_MapVis4_4(
    polygon_MapVis4_4<-Sel_MapVis4_4_area%>%
  st_as_sf(coords = c("lng", "lat"), crs = 4326)%>%
  summarise(geometry = st_combine(geometry))%>%
  st_cast("POLYGON")
 )
 
 PolyPoints<-Creel_SHP_Vis4_4()%>%
                  filter(st_intersects(.,Poly_SHP_MapVis4_4(),sparse=FALSE)[,1])
 
  MapVis4_4_SelectedWB_SHP(PolyPoints)

},ignoreInit=TRUE)

observeEvent(input$Vis4_SelectPolygon,{

  req(input$Vis4_SelectPolygon=="Clear")
  req(input$Vis4_SelectType=="Polygon")
  
  HighlightTrace_4Vis(NULL)
  All_SelectedWB_4Vis(NULL)
  Data_4_4_Selected(NULL)
  Sel_SurveysScatter_Vis_4_4_UL(NULL) 
  HighlightTrace_Vis_4_4(NULL) 
  MapVis4_4_SelectedWB_SHP(NULL) 
  

  MapVis4_4_area$mp<-NULL

  Poly_SHP_MapVis4_4(NULL)

    Sel_SurveysMap_Vis_4_4_UL(NULL)
    Sel_SurveysAll_Vis_4_4_UL(NULL)
  

},ignoreInit=TRUE)

State_Clicks_MapVis4_4<-reactiveVal()
SelStatePoly_SHP_MapVis4_4<-reactiveVal()
SelStatePoints_SHP_MapVis4_4<-reactiveVal()
SelStates_Filtered_MapVis4_4<-reactiveVal()

observeEvent(input$MapVis4_4_click, {

  req(input$Vis4_SelectType=="States")
  req(input$Vis4_SelectState=="Select")

      click <- input$MapVis4_4_shape_click

      State_Clicks_MapVis4_4(list(c(State_Clicks_MapVis4_4(),click$id)))

    SelStates_df<-as.data.frame(State_Clicks_MapVis4_4())


    Selected_States_Vector<-as.character(SelStates_df[1,])


    PH<-StateBoundaries_SHP%>%
      filter(., STUSPS %in% Selected_States_Vector)

    SelStates_Filtered_MapVis4_4(PH)


    leafletProxy("MapVis4_4")%>%
      clearGroup("Selected States")%>%
      addPolygons(data=SelStates_Filtered_MapVis4_4(),color="red",weight=3,fillOpacity=0,group='Selected States',
          options=pathOptions(pane="SelectedArea"))
  },ignoreInit=TRUE)

observeEvent(input$Vis4_SelectState, {

  req(input$Vis4_SelectType=="States")
  req(input$Vis4_SelectState=="Complete")
  req(!is.null(SelStates_Filtered_MapVis4_4()))

    SelStatePoly_SHP_MapVis4_4(SelStates_Filtered_MapVis4_4())

    State_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis4_4(),SelStatePoly_SHP_MapVis4_4(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    State_Intersects2<-State_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      State_Intersects3<-Creel_SHP_Vis4_4()%>%slice(as.numeric(row.names(State_Intersects2)))


       MapVis4_4_SelectedWB_SHP(State_Intersects3)

  },ignoreInit=TRUE)

observeEvent(input$Vis4_SelectState, {
  req(input$Vis4_SelectType=="States")
  req(input$Vis4_SelectState=="Clear")
  
  HighlightTrace_4Vis(NULL)
  All_SelectedWB_4Vis(NULL)
  Data_4_4_Selected(NULL)
  Sel_SurveysScatter_Vis_4_4_UL(NULL) 
  HighlightTrace_Vis_4_4(NULL) 
  MapVis4_4_SelectedWB_SHP(NULL) 


    SelStatePoly_SHP_MapVis4_4(NULL)

    State_Clicks_MapVis4_4(NULL)
    SelStates_Filtered_MapVis4_4(NULL)
    SelStatePoints_SHP_MapVis4_4(NULL)
    Sel_SurveysMap_Vis_4_4_UL(NULL)
    Sel_SurveysAll_Vis_4_4_UL(NULL)

  },ignoreInit=TRUE)



observeEvent(input$Vis4_SelectType, {

  req(input$Vis4_SelectType=="States")

    leafletProxy("MapVis4_4")%>%
      hideGroup("County Boundaries")%>%
      showGroup("State Boundaries")
},ignoreInit=TRUE)

observeEvent(input$Vis4_SelectType, {

  req(input$Vis4_SelectType=="Counties")

    leafletProxy("MapVis4_4")%>%
      hideGroup("State Boundaries")%>%
      showGroup("County Boundaries")
},ignoreInit=TRUE)


County_Clicks_MapVis4_4<-reactiveVal()
SelCountyPoly_SHP_MapVis4_4<-reactiveVal()
SelCountyPoints_SHP_MapVis4_4<-reactiveVal()
SelCounties_Filtered_MapVis4_4<-reactiveVal()

observeEvent(input$MapVis4_4_click, {

  req(input$Vis4_SelectType=="Counties")
  req(input$Vis4_SelectCounty=="Select")

      click <- input$MapVis4_4_shape_click

      County_Clicks_MapVis4_4(list(c(County_Clicks_MapVis4_4(),click$id)))

    SelCounties_df<-as.data.frame(County_Clicks_MapVis4_4())


    Selected_Counties_Vector<-as.character(SelCounties_df[1,])


    PH<-CountyBoundaries_SHP%>%
      filter(., County_ID %in% Selected_Counties_Vector)

    SelCounties_Filtered_MapVis4_4(PH)

    leafletProxy("MapVis4_4")%>%
      clearGroup("Selected Counties")%>%
      addPolygons(data=SelCounties_Filtered_MapVis4_4(),color="red",weight=3,fillOpacity=0,group='Selected Counties',
          options=pathOptions(pane="SelectedArea"))



  },ignoreInit=TRUE)

observeEvent(input$Vis4_SelectCounty, {

  req(input$Vis4_SelectType=="Counties")
  req(input$Vis4_SelectCounty=="Complete")
  req(!is.null(SelCounties_Filtered_MapVis4_4()))



    SelCountyPoly_SHP_MapVis4_4(SelCounties_Filtered_MapVis4_4())

    County_Intersects<-as.data.frame(st_intersects(Creel_SHP_Vis4_4(),SelCountyPoly_SHP_MapVis4_4(),sparse=FALSE))%>%
      mutate_all(funs(as.character(.)))

    County_Intersects2<-County_Intersects%>%
      rownames_to_column("RowID")%>%
      filter(rowSums(across(everything(),~str_detect(.,"TRUE")))>0)%>%
      column_to_rownames("RowID")

      County_Intersects3<-Creel_SHP_Vis4_4()%>%slice(as.numeric(row.names(County_Intersects2)))

      MapVis4_4_SelectedWB_SHP(County_Intersects3)

  },ignoreInit=TRUE)

observeEvent(input$Vis4_SelectCounty, {
  req(input$Vis4_SelectType=="Counties")
  req(input$Vis4_SelectCounty=="Clear")

    HighlightTrace_4Vis(NULL)
    All_SelectedWB_4Vis(NULL)
    Data_4_4_Selected(NULL)
    Sel_SurveysScatter_Vis_4_4_UL(NULL) 
    HighlightTrace_Vis_4_4(NULL) 
  MapVis4_4_SelectedWB_SHP(NULL) 


    SelCountyPoly_SHP_MapVis4_4(NULL)

    County_Clicks_MapVis4_4(NULL)
    SelCounties_Filtered_MapVis4_4(NULL)
    SelCountyPoints_SHP_MapVis4_4(NULL)
    Sel_SurveysMap_Vis_4_4_UL(NULL)
    Sel_SurveysAll_Vis_4_4_UL(NULL)


  },ignoreInit=TRUE)
   

#### Linked Selection #####

    observeEvent(
      input$AF_SharedData,
      {if(input$AF_SharedData=='No'){
    updateRadioGroupButtons(session, "AF_LinkedSelection",selected="No")
      }
    },ignoreInit=TRUE)
   
   CompiledData_Percentiles<-reactive({
     
     req(input$AF_SharedData=='Yes')
      
      Shared_SelectedTBL()%>%
        {if(input$Vis1_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis1=percent_rank(get(input$Vis1_MapDisplayField))*100) else .}%>%
        {if(input$Vis1_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis1=percent_rank(get(input$Vis1_MapDisplayField_Size))*100) else .}%>%
        {if(input$Vis2_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis2=percent_rank(get(input$Vis2_MapDisplayField))*100) else .}%>%
        {if(input$Vis2_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis2=percent_rank(get(input$Vis2_MapDisplayField_Size))*100) else .}%>%
        {if(input$Vis3_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis3=percent_rank(get(input$Vis3_MapDisplayField))*100) else .}%>%
        {if(input$Vis3_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis3=percent_rank(get(input$Vis3_MapDisplayField_Size))*100) else .}%>%
        {if(input$Vis4_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis4=percent_rank(get(input$Vis4_MapDisplayField))*100) else .}%>%
        {if(input$Vis4_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis4=percent_rank(get(input$Vis4_MapDisplayField_Size))*100) else .}

     
   })

    Creel_SHP_Shared<-reactive({
      req(input$AF_SharedData=='Yes')
      req(length(Filtered_CompiledData())>0)
      sp::merge(x=CreelWaterbodies_SHP,y=CompiledData_Percentiles(),by.x="WB_ID",by.y="WB_ID",all.x=FALSE)%>%
        st_jitter(amount=0.002)
      })
      


    # 2 Vis #

    HighlightTrace_2Vis<-reactiveVal(NULL)
    All_SelectedWB_2Vis<-reactiveVal(NULL)
    
    output$LinkedSel_2Vis<-reactive(if(is.null(HighlightTrace_2Vis())){0}else{nrow(HighlightTrace_2Vis())})
    
          outputOptions(output,'LinkedSel_2Vis',suspendWhenHidden=FALSE)
   


        # 3 Vis #

    HighlightTrace_3Vis<-reactiveVal(NULL)
    All_SelectedWB_3Vis<-reactiveVal(NULL)

    output$LinkedSel_3Vis<-reactive(if(is.null(HighlightTrace_3Vis())){0}else{nrow(HighlightTrace_3Vis())})
    
          outputOptions(output,'LinkedSel_3Vis',suspendWhenHidden=FALSE)
    
  
       # 4 Vis #

    HighlightTrace_4Vis<-reactiveVal(NULL)
    All_SelectedWB_4Vis<-reactiveVal(NULL)
    
    output$LinkedSel_4Vis<-reactive(if(is.null(HighlightTrace_4Vis())){0}else{nrow(HighlightTrace_4Vis())})
    
          outputOptions(output,'LinkedSel_4Vis',suspendWhenHidden=FALSE)
          
 
    observeEvent(c(
      input$AF_LinkedSelection,
      input$ClearSel,
      Shared_SelectedTBL()),
      {
        req(input$AF_LinkedSelection=='Yes') 
        
        Data_2_1_Selected(NULL)
        Data_2_2_Selected(NULL)
        Data_3_1_Selected(NULL)
        Data_3_2_Selected(NULL)
        Data_3_3_Selected(NULL)
        Data_4_1_Selected(NULL)
        Data_4_2_Selected(NULL)
        Data_4_3_Selected(NULL)
        Data_4_4_Selected(NULL)
      },ignoreInit=TRUE)
 
    observeEvent(c(
      input$AF_LinkedSelection,
      input$AF_SharedData,
      input$ClearSel,
      Shared_SelectedTBL()),
      {
        
         HighlightTrace_2Vis(NULL)
        All_SelectedWB_2Vis(NULL)
        HighlightTrace_3Vis(NULL)
        All_SelectedWB_3Vis(NULL)
        HighlightTrace_4Vis(NULL)
        All_SelectedWB_4Vis(NULL)
        Sel_SurveysScatter_Vis_2_1_UL(NULL)
        Sel_SurveysScatter_Vis_3_1_UL(NULL)
        Sel_SurveysScatter_Vis_4_1_UL(NULL)
        Sel_SurveysScatter_Vis_2_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_2_UL(NULL)
        Sel_SurveysScatter_Vis_4_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_4_UL(NULL) 
        HighlightTrace_Vis_2_1(NULL) 
        HighlightTrace_Vis_2_2(NULL) 
        HighlightTrace_Vis_3_1(NULL)
        HighlightTrace_Vis_3_2(NULL)
        HighlightTrace_Vis_3_3(NULL)
        HighlightTrace_Vis_4_1(NULL)
        HighlightTrace_Vis_4_2(NULL)
        HighlightTrace_Vis_4_3(NULL)
        HighlightTrace_Vis_4_4(NULL)
        MapVis2_1_SelectedWB_SHP(NULL)
        MapVis2_2_SelectedWB_SHP(NULL)
        MapVis3_1_SelectedWB_SHP(NULL)
        MapVis3_2_SelectedWB_SHP(NULL)
        MapVis3_3_SelectedWB_SHP(NULL)
        MapVis4_1_SelectedWB_SHP(NULL)
        MapVis4_2_SelectedWB_SHP(NULL)
        MapVis4_3_SelectedWB_SHP(NULL)
        MapVis4_4_SelectedWB_SHP(NULL)
        MapVis2_1_area$mp<-NULL
        MapVis2_2_area$mp<-NULL
        MapVis3_1_area$mp<-NULL
        MapVis3_2_area$mp<-NULL
        MapVis3_3_area$mp<-NULL
        MapVis4_1_area$mp<-NULL
        MapVis4_2_area$mp<-NULL
        MapVis4_3_area$mp<-NULL
        MapVis4_4_area$mp<-NULL
        Poly_SHP_MapVis2_1(NULL)
        Poly_SHP_MapVis2_2(NULL)
        Poly_SHP_MapVis3_1(NULL)
        Poly_SHP_MapVis3_2(NULL)
        Poly_SHP_MapVis3_3(NULL)
        Poly_SHP_MapVis4_1(NULL)
        Poly_SHP_MapVis4_2(NULL)
        Poly_SHP_MapVis4_3(NULL)
        Poly_SHP_MapVis4_4(NULL)
        
        State_Clicks_MapVis2_1(NULL)
        State_Clicks_MapVis2_2(NULL)
        State_Clicks_MapVis3_1(NULL)
        State_Clicks_MapVis3_2(NULL)
        State_Clicks_MapVis3_3(NULL)
        State_Clicks_MapVis4_1(NULL)
        State_Clicks_MapVis4_2(NULL)
        State_Clicks_MapVis4_3(NULL)
        State_Clicks_MapVis4_4(NULL)
        
        SelStatePoly_SHP_MapVis2_1(NULL)
        SelStatePoly_SHP_MapVis2_2(NULL)
        SelStatePoly_SHP_MapVis3_1(NULL)
        SelStatePoly_SHP_MapVis3_2(NULL)
        SelStatePoly_SHP_MapVis3_3(NULL)
        SelStatePoly_SHP_MapVis4_1(NULL)
        SelStatePoly_SHP_MapVis4_2(NULL)
        SelStatePoly_SHP_MapVis4_3(NULL)
        SelStatePoly_SHP_MapVis4_4(NULL)
    
        
        SelStatePoints_SHP_MapVis2_1(NULL)
        SelStatePoints_SHP_MapVis2_2(NULL)
        SelStatePoints_SHP_MapVis3_1(NULL)
        SelStatePoints_SHP_MapVis3_2(NULL)
        SelStatePoints_SHP_MapVis3_3(NULL)
        SelStatePoints_SHP_MapVis4_1(NULL)
        SelStatePoints_SHP_MapVis4_2(NULL)
        SelStatePoints_SHP_MapVis4_3(NULL)
        SelStatePoints_SHP_MapVis4_4(NULL)
        
        SelStates_Filtered_MapVis2_1(NULL)
        SelStates_Filtered_MapVis2_2(NULL)
        SelStates_Filtered_MapVis3_1(NULL)
        SelStates_Filtered_MapVis3_2(NULL)
        SelStates_Filtered_MapVis3_3(NULL)
        SelStates_Filtered_MapVis4_1(NULL)
        SelStates_Filtered_MapVis4_2(NULL)
        SelStates_Filtered_MapVis4_3(NULL)
        SelStates_Filtered_MapVis4_4(NULL)

    
        
        County_Clicks_MapVis2_1(NULL)
        County_Clicks_MapVis2_2(NULL)
        County_Clicks_MapVis3_1(NULL)
        County_Clicks_MapVis3_2(NULL)
        County_Clicks_MapVis3_3(NULL)
        County_Clicks_MapVis4_1(NULL)
        County_Clicks_MapVis4_2(NULL)
        County_Clicks_MapVis4_3(NULL)
        County_Clicks_MapVis4_4(NULL)
        
        SelCountyPoly_SHP_MapVis2_1(NULL)
        SelCountyPoly_SHP_MapVis2_2(NULL)
        SelCountyPoly_SHP_MapVis3_1(NULL)
        SelCountyPoly_SHP_MapVis3_2(NULL)
        SelCountyPoly_SHP_MapVis3_3(NULL)
        SelCountyPoly_SHP_MapVis4_1(NULL)
        SelCountyPoly_SHP_MapVis4_2(NULL)
        SelCountyPoly_SHP_MapVis4_3(NULL)
        SelCountyPoly_SHP_MapVis4_4(NULL)
        
        SelCountyPoints_SHP_MapVis2_1(NULL)
        SelCountyPoints_SHP_MapVis2_2(NULL)
        SelCountyPoints_SHP_MapVis3_1(NULL)
        SelCountyPoints_SHP_MapVis3_2(NULL)
        SelCountyPoints_SHP_MapVis3_3(NULL)
        SelCountyPoints_SHP_MapVis4_1(NULL)
        SelCountyPoints_SHP_MapVis4_2(NULL)
        SelCountyPoints_SHP_MapVis4_3(NULL)
        SelCountyPoints_SHP_MapVis4_4(NULL)
        
        SelCounties_Filtered_MapVis2_1(NULL)
        SelCounties_Filtered_MapVis2_2(NULL)
        SelCounties_Filtered_MapVis3_1(NULL)
        SelCounties_Filtered_MapVis3_2(NULL)
        SelCounties_Filtered_MapVis3_3(NULL)
        SelCounties_Filtered_MapVis4_1(NULL)
        SelCounties_Filtered_MapVis4_2(NULL)
        SelCounties_Filtered_MapVis4_3(NULL)
        SelCounties_Filtered_MapVis4_4(NULL)
    
        Sel_SurveysMap_Vis_2_1_UL(NULL)
        Sel_SurveysMap_Vis_2_2_UL(NULL)
        Sel_SurveysMap_Vis_3_1_UL(NULL)
        Sel_SurveysMap_Vis_3_2_UL(NULL)
        Sel_SurveysMap_Vis_3_3_UL(NULL)
        Sel_SurveysMap_Vis_4_1_UL(NULL)
        Sel_SurveysMap_Vis_4_2_UL(NULL)
        Sel_SurveysMap_Vis_4_3_UL(NULL)
        Sel_SurveysMap_Vis_4_4_UL(NULL)
        
        Sel_SurveysAll_Vis_2_1_UL(NULL)
        Sel_SurveysAll_Vis_2_2_UL(NULL)
        Sel_SurveysAll_Vis_3_1_UL(NULL)
        Sel_SurveysAll_Vis_3_2_UL(NULL)
        Sel_SurveysAll_Vis_3_3_UL(NULL)
        Sel_SurveysAll_Vis_4_1_UL(NULL)
        Sel_SurveysAll_Vis_4_2_UL(NULL)
        Sel_SurveysAll_Vis_4_3_UL(NULL)
        Sel_SurveysAll_Vis_4_4_UL(NULL)
        
      },ignoreInit=TRUE)  
    
    observeEvent(c(
      input$Vis1_SelectPolygon),
      {
        req(input$Vis1_SelectPolygon=="Clear")
        req(input$Vis1_SelectType=="Polygon")
        req(input$AF_LinkedSelection=='Yes')
        
        HighlightTrace_2Vis(NULL)
        All_SelectedWB_2Vis(NULL)
        HighlightTrace_3Vis(NULL)
        All_SelectedWB_3Vis(NULL)
        HighlightTrace_4Vis(NULL)
        All_SelectedWB_4Vis(NULL)
        Sel_SurveysScatter_Vis_2_1_UL(NULL)
        Sel_SurveysScatter_Vis_3_1_UL(NULL)
        Sel_SurveysScatter_Vis_4_1_UL(NULL)
        Sel_SurveysScatter_Vis_2_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_2_UL(NULL)
        Sel_SurveysScatter_Vis_4_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_4_UL(NULL) 
        HighlightTrace_Vis_2_1(NULL) 
        HighlightTrace_Vis_2_2(NULL) 
        HighlightTrace_Vis_3_1(NULL)
        HighlightTrace_Vis_3_2(NULL)
        HighlightTrace_Vis_3_3(NULL)
        HighlightTrace_Vis_4_1(NULL)
        HighlightTrace_Vis_4_2(NULL)
        HighlightTrace_Vis_4_3(NULL)
        HighlightTrace_Vis_4_4(NULL)
        MapVis2_1_SelectedWB_SHP(NULL)
        MapVis2_2_SelectedWB_SHP(NULL)
        MapVis3_1_SelectedWB_SHP(NULL)
        MapVis3_2_SelectedWB_SHP(NULL)
        MapVis3_3_SelectedWB_SHP(NULL)
        MapVis4_1_SelectedWB_SHP(NULL)
        MapVis4_2_SelectedWB_SHP(NULL)
        MapVis4_3_SelectedWB_SHP(NULL)
        MapVis4_4_SelectedWB_SHP(NULL)
        MapVis2_1_area$mp<-NULL
        MapVis2_2_area$mp<-NULL
        MapVis3_1_area$mp<-NULL
        MapVis3_2_area$mp<-NULL
        MapVis3_3_area$mp<-NULL
        MapVis4_1_area$mp<-NULL
        MapVis4_2_area$mp<-NULL
        MapVis4_3_area$mp<-NULL
        MapVis4_4_area$mp<-NULL
        Poly_SHP_MapVis2_1(NULL)
        Poly_SHP_MapVis2_2(NULL)
        Poly_SHP_MapVis3_1(NULL)
        Poly_SHP_MapVis3_2(NULL)
        Poly_SHP_MapVis3_3(NULL)
        Poly_SHP_MapVis4_1(NULL)
        Poly_SHP_MapVis4_2(NULL)
        Poly_SHP_MapVis4_3(NULL)
        Poly_SHP_MapVis4_4(NULL)
        
        State_Clicks_MapVis2_1(NULL)
        State_Clicks_MapVis2_2(NULL)
        State_Clicks_MapVis3_1(NULL)
        State_Clicks_MapVis3_2(NULL)
        State_Clicks_MapVis3_3(NULL)
        State_Clicks_MapVis4_1(NULL)
        State_Clicks_MapVis4_2(NULL)
        State_Clicks_MapVis4_3(NULL)
        State_Clicks_MapVis4_4(NULL)
        
        SelStatePoly_SHP_MapVis2_1(NULL)
        SelStatePoly_SHP_MapVis2_2(NULL)
        SelStatePoly_SHP_MapVis3_1(NULL)
        SelStatePoly_SHP_MapVis3_2(NULL)
        SelStatePoly_SHP_MapVis3_3(NULL)
        SelStatePoly_SHP_MapVis4_1(NULL)
        SelStatePoly_SHP_MapVis4_2(NULL)
        SelStatePoly_SHP_MapVis4_3(NULL)
        SelStatePoly_SHP_MapVis4_4(NULL)
    
        
        SelStatePoints_SHP_MapVis2_1(NULL)
        SelStatePoints_SHP_MapVis2_2(NULL)
        SelStatePoints_SHP_MapVis3_1(NULL)
        SelStatePoints_SHP_MapVis3_2(NULL)
        SelStatePoints_SHP_MapVis3_3(NULL)
        SelStatePoints_SHP_MapVis4_1(NULL)
        SelStatePoints_SHP_MapVis4_2(NULL)
        SelStatePoints_SHP_MapVis4_3(NULL)
        SelStatePoints_SHP_MapVis4_4(NULL)
        
        SelStates_Filtered_MapVis2_1(NULL)
        SelStates_Filtered_MapVis2_2(NULL)
        SelStates_Filtered_MapVis3_1(NULL)
        SelStates_Filtered_MapVis3_2(NULL)
        SelStates_Filtered_MapVis3_3(NULL)
        SelStates_Filtered_MapVis4_1(NULL)
        SelStates_Filtered_MapVis4_2(NULL)
        SelStates_Filtered_MapVis4_3(NULL)
        SelStates_Filtered_MapVis4_4(NULL)

    
        
        County_Clicks_MapVis2_1(NULL)
        County_Clicks_MapVis2_2(NULL)
        County_Clicks_MapVis3_1(NULL)
        County_Clicks_MapVis3_2(NULL)
        County_Clicks_MapVis3_3(NULL)
        County_Clicks_MapVis4_1(NULL)
        County_Clicks_MapVis4_2(NULL)
        County_Clicks_MapVis4_3(NULL)
        County_Clicks_MapVis4_4(NULL)
        
        SelCountyPoly_SHP_MapVis2_1(NULL)
        SelCountyPoly_SHP_MapVis2_2(NULL)
        SelCountyPoly_SHP_MapVis3_1(NULL)
        SelCountyPoly_SHP_MapVis3_2(NULL)
        SelCountyPoly_SHP_MapVis3_3(NULL)
        SelCountyPoly_SHP_MapVis4_1(NULL)
        SelCountyPoly_SHP_MapVis4_2(NULL)
        SelCountyPoly_SHP_MapVis4_3(NULL)
        SelCountyPoly_SHP_MapVis4_4(NULL)
        
        SelCountyPoints_SHP_MapVis2_1(NULL)
        SelCountyPoints_SHP_MapVis2_2(NULL)
        SelCountyPoints_SHP_MapVis3_1(NULL)
        SelCountyPoints_SHP_MapVis3_2(NULL)
        SelCountyPoints_SHP_MapVis3_3(NULL)
        SelCountyPoints_SHP_MapVis4_1(NULL)
        SelCountyPoints_SHP_MapVis4_2(NULL)
        SelCountyPoints_SHP_MapVis4_3(NULL)
        SelCountyPoints_SHP_MapVis4_4(NULL)
        
        SelCounties_Filtered_MapVis2_1(NULL)
        SelCounties_Filtered_MapVis2_2(NULL)
        SelCounties_Filtered_MapVis3_1(NULL)
        SelCounties_Filtered_MapVis3_2(NULL)
        SelCounties_Filtered_MapVis3_3(NULL)
        SelCounties_Filtered_MapVis4_1(NULL)
        SelCounties_Filtered_MapVis4_2(NULL)
        SelCounties_Filtered_MapVis4_3(NULL)
        SelCounties_Filtered_MapVis4_4(NULL)
    
     
        Sel_SurveysMap_Vis_2_1_UL(NULL)
        Sel_SurveysMap_Vis_2_2_UL(NULL)
        Sel_SurveysMap_Vis_3_1_UL(NULL)
        Sel_SurveysMap_Vis_3_2_UL(NULL)
        Sel_SurveysMap_Vis_3_3_UL(NULL)
        Sel_SurveysMap_Vis_4_1_UL(NULL)
        Sel_SurveysMap_Vis_4_2_UL(NULL)
        Sel_SurveysMap_Vis_4_3_UL(NULL)
        Sel_SurveysMap_Vis_4_4_UL(NULL)
        
        Sel_SurveysAll_Vis_2_1_UL(NULL)
        Sel_SurveysAll_Vis_2_2_UL(NULL)
        Sel_SurveysAll_Vis_3_1_UL(NULL)
        Sel_SurveysAll_Vis_3_2_UL(NULL)
        Sel_SurveysAll_Vis_3_3_UL(NULL)
        Sel_SurveysAll_Vis_4_1_UL(NULL)
        Sel_SurveysAll_Vis_4_2_UL(NULL)
        Sel_SurveysAll_Vis_4_3_UL(NULL)
        Sel_SurveysAll_Vis_4_4_UL(NULL)
        
        Data_2_1_Selected(NULL)
        Data_2_2_Selected(NULL)
        Data_3_1_Selected(NULL)
        Data_3_2_Selected(NULL)
        Data_3_3_Selected(NULL)
        Data_4_1_Selected(NULL)
        Data_4_2_Selected(NULL)
        Data_4_3_Selected(NULL)
        Data_4_4_Selected(NULL)
        },ignoreInit=TRUE)    
    
    observeEvent(c(
      input$Vis2_SelectPolygon),
      {
        req(input$Vis2_SelectPolygon=="Clear")
        req(input$Vis2_SelectType=="Polygon")
        req(input$AF_LinkedSelection=='Yes')
        
        HighlightTrace_2Vis(NULL)
        All_SelectedWB_2Vis(NULL)
        HighlightTrace_3Vis(NULL)
        All_SelectedWB_3Vis(NULL)
        HighlightTrace_4Vis(NULL)
        All_SelectedWB_4Vis(NULL)
        Sel_SurveysScatter_Vis_2_1_UL(NULL)
        Sel_SurveysScatter_Vis_3_1_UL(NULL)
        Sel_SurveysScatter_Vis_4_1_UL(NULL)
        Sel_SurveysScatter_Vis_2_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_2_UL(NULL)
        Sel_SurveysScatter_Vis_4_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_4_UL(NULL) 
        HighlightTrace_Vis_2_1(NULL) 
        HighlightTrace_Vis_2_2(NULL) 
        HighlightTrace_Vis_3_1(NULL)
        HighlightTrace_Vis_3_2(NULL)
        HighlightTrace_Vis_3_3(NULL)
        HighlightTrace_Vis_4_1(NULL)
        HighlightTrace_Vis_4_2(NULL)
        HighlightTrace_Vis_4_3(NULL)
        HighlightTrace_Vis_4_4(NULL)
        MapVis2_1_SelectedWB_SHP(NULL)
        MapVis2_2_SelectedWB_SHP(NULL)
        MapVis3_1_SelectedWB_SHP(NULL)
        MapVis3_2_SelectedWB_SHP(NULL)
        MapVis3_3_SelectedWB_SHP(NULL)
        MapVis4_1_SelectedWB_SHP(NULL)
        MapVis4_2_SelectedWB_SHP(NULL)
        MapVis4_3_SelectedWB_SHP(NULL)
        MapVis4_4_SelectedWB_SHP(NULL)
        MapVis2_1_area$mp<-NULL
        MapVis2_2_area$mp<-NULL
        MapVis3_1_area$mp<-NULL
        MapVis3_2_area$mp<-NULL
        MapVis3_3_area$mp<-NULL
        MapVis4_1_area$mp<-NULL
        MapVis4_2_area$mp<-NULL
        MapVis4_3_area$mp<-NULL
        MapVis4_4_area$mp<-NULL
        Poly_SHP_MapVis2_1(NULL)
        Poly_SHP_MapVis2_2(NULL)
        Poly_SHP_MapVis3_1(NULL)
        Poly_SHP_MapVis3_2(NULL)
        Poly_SHP_MapVis3_3(NULL)
        Poly_SHP_MapVis4_1(NULL)
        Poly_SHP_MapVis4_2(NULL)
        Poly_SHP_MapVis4_3(NULL)
        Poly_SHP_MapVis4_4(NULL)
        
        State_Clicks_MapVis2_1(NULL)
        State_Clicks_MapVis2_2(NULL)
        State_Clicks_MapVis3_1(NULL)
        State_Clicks_MapVis3_2(NULL)
        State_Clicks_MapVis3_3(NULL)
        State_Clicks_MapVis4_1(NULL)
        State_Clicks_MapVis4_2(NULL)
        State_Clicks_MapVis4_3(NULL)
        State_Clicks_MapVis4_4(NULL)
        
        SelStatePoly_SHP_MapVis2_1(NULL)
        SelStatePoly_SHP_MapVis2_2(NULL)
        SelStatePoly_SHP_MapVis3_1(NULL)
        SelStatePoly_SHP_MapVis3_2(NULL)
        SelStatePoly_SHP_MapVis3_3(NULL)
        SelStatePoly_SHP_MapVis4_1(NULL)
        SelStatePoly_SHP_MapVis4_2(NULL)
        SelStatePoly_SHP_MapVis4_3(NULL)
        SelStatePoly_SHP_MapVis4_4(NULL)
    
        
        SelStatePoints_SHP_MapVis2_1(NULL)
        SelStatePoints_SHP_MapVis2_2(NULL)
        SelStatePoints_SHP_MapVis3_1(NULL)
        SelStatePoints_SHP_MapVis3_2(NULL)
        SelStatePoints_SHP_MapVis3_3(NULL)
        SelStatePoints_SHP_MapVis4_1(NULL)
        SelStatePoints_SHP_MapVis4_2(NULL)
        SelStatePoints_SHP_MapVis4_3(NULL)
        SelStatePoints_SHP_MapVis4_4(NULL)
        
        SelStates_Filtered_MapVis2_1(NULL)
        SelStates_Filtered_MapVis2_2(NULL)
        SelStates_Filtered_MapVis3_1(NULL)
        SelStates_Filtered_MapVis3_2(NULL)
        SelStates_Filtered_MapVis3_3(NULL)
        SelStates_Filtered_MapVis4_1(NULL)
        SelStates_Filtered_MapVis4_2(NULL)
        SelStates_Filtered_MapVis4_3(NULL)
        SelStates_Filtered_MapVis4_4(NULL)

    
        
        County_Clicks_MapVis2_1(NULL)
        County_Clicks_MapVis2_2(NULL)
        County_Clicks_MapVis3_1(NULL)
        County_Clicks_MapVis3_2(NULL)
        County_Clicks_MapVis3_3(NULL)
        County_Clicks_MapVis4_1(NULL)
        County_Clicks_MapVis4_2(NULL)
        County_Clicks_MapVis4_3(NULL)
        County_Clicks_MapVis4_4(NULL)
        
        SelCountyPoly_SHP_MapVis2_1(NULL)
        SelCountyPoly_SHP_MapVis2_2(NULL)
        SelCountyPoly_SHP_MapVis3_1(NULL)
        SelCountyPoly_SHP_MapVis3_2(NULL)
        SelCountyPoly_SHP_MapVis3_3(NULL)
        SelCountyPoly_SHP_MapVis4_1(NULL)
        SelCountyPoly_SHP_MapVis4_2(NULL)
        SelCountyPoly_SHP_MapVis4_3(NULL)
        SelCountyPoly_SHP_MapVis4_4(NULL)
        
        SelCountyPoints_SHP_MapVis2_1(NULL)
        SelCountyPoints_SHP_MapVis2_2(NULL)
        SelCountyPoints_SHP_MapVis3_1(NULL)
        SelCountyPoints_SHP_MapVis3_2(NULL)
        SelCountyPoints_SHP_MapVis3_3(NULL)
        SelCountyPoints_SHP_MapVis4_1(NULL)
        SelCountyPoints_SHP_MapVis4_2(NULL)
        SelCountyPoints_SHP_MapVis4_3(NULL)
        SelCountyPoints_SHP_MapVis4_4(NULL)
        
        SelCounties_Filtered_MapVis2_1(NULL)
        SelCounties_Filtered_MapVis2_2(NULL)
        SelCounties_Filtered_MapVis3_1(NULL)
        SelCounties_Filtered_MapVis3_2(NULL)
        SelCounties_Filtered_MapVis3_3(NULL)
        SelCounties_Filtered_MapVis4_1(NULL)
        SelCounties_Filtered_MapVis4_2(NULL)
        SelCounties_Filtered_MapVis4_3(NULL)
        SelCounties_Filtered_MapVis4_4(NULL)
    
        
        Sel_SurveysMap_Vis_2_1_UL(NULL)
        Sel_SurveysMap_Vis_2_2_UL(NULL)
        Sel_SurveysMap_Vis_3_1_UL(NULL)
        Sel_SurveysMap_Vis_3_2_UL(NULL)
        Sel_SurveysMap_Vis_3_3_UL(NULL)
        Sel_SurveysMap_Vis_4_1_UL(NULL)
        Sel_SurveysMap_Vis_4_2_UL(NULL)
        Sel_SurveysMap_Vis_4_3_UL(NULL)
        Sel_SurveysMap_Vis_4_4_UL(NULL)
        
        Sel_SurveysAll_Vis_2_1_UL(NULL)
        Sel_SurveysAll_Vis_2_2_UL(NULL)
        Sel_SurveysAll_Vis_3_1_UL(NULL)
        Sel_SurveysAll_Vis_3_2_UL(NULL)
        Sel_SurveysAll_Vis_3_3_UL(NULL)
        Sel_SurveysAll_Vis_4_1_UL(NULL)
        Sel_SurveysAll_Vis_4_2_UL(NULL)
        Sel_SurveysAll_Vis_4_3_UL(NULL)
        Sel_SurveysAll_Vis_4_4_UL(NULL)
        
        Data_2_1_Selected(NULL)
        Data_2_2_Selected(NULL)
        Data_3_1_Selected(NULL)
        Data_3_2_Selected(NULL)
        Data_3_3_Selected(NULL)
        Data_4_1_Selected(NULL)
        Data_4_2_Selected(NULL)
        Data_4_3_Selected(NULL)
        Data_4_4_Selected(NULL)
        },ignoreInit=TRUE)   
    
      observeEvent(c(
      input$Vis3_SelectPolygon),
      {
        req(input$Vis3_SelectPolygon=="Clear")
        req(input$Vis3_SelectType=="Polygon")
        req(input$AF_LinkedSelection=='Yes')
        
        HighlightTrace_2Vis(NULL)
        All_SelectedWB_2Vis(NULL)
        HighlightTrace_3Vis(NULL)
        All_SelectedWB_3Vis(NULL)
        HighlightTrace_4Vis(NULL)
        All_SelectedWB_4Vis(NULL)
        Sel_SurveysScatter_Vis_2_1_UL(NULL)
        Sel_SurveysScatter_Vis_3_1_UL(NULL)
        Sel_SurveysScatter_Vis_4_1_UL(NULL)
        Sel_SurveysScatter_Vis_2_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_2_UL(NULL)
        Sel_SurveysScatter_Vis_4_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_4_UL(NULL) 
        HighlightTrace_Vis_2_1(NULL) 
        HighlightTrace_Vis_2_2(NULL) 
        HighlightTrace_Vis_3_1(NULL)
        HighlightTrace_Vis_3_2(NULL)
        HighlightTrace_Vis_3_3(NULL)
        HighlightTrace_Vis_4_1(NULL)
        HighlightTrace_Vis_4_2(NULL)
        HighlightTrace_Vis_4_3(NULL)
        HighlightTrace_Vis_4_4(NULL)
        MapVis2_1_SelectedWB_SHP(NULL)
        MapVis2_2_SelectedWB_SHP(NULL)
        MapVis3_1_SelectedWB_SHP(NULL)
        MapVis3_2_SelectedWB_SHP(NULL)
        MapVis3_3_SelectedWB_SHP(NULL)
        MapVis4_1_SelectedWB_SHP(NULL)
        MapVis4_2_SelectedWB_SHP(NULL)
        MapVis4_3_SelectedWB_SHP(NULL)
        MapVis4_4_SelectedWB_SHP(NULL)
        MapVis2_1_area$mp<-NULL
        MapVis2_2_area$mp<-NULL
        MapVis3_1_area$mp<-NULL
        MapVis3_2_area$mp<-NULL
        MapVis3_3_area$mp<-NULL
        MapVis4_1_area$mp<-NULL
        MapVis4_2_area$mp<-NULL
        MapVis4_3_area$mp<-NULL
        MapVis4_4_area$mp<-NULL
        Poly_SHP_MapVis2_1(NULL)
        Poly_SHP_MapVis2_2(NULL)
        Poly_SHP_MapVis3_1(NULL)
        Poly_SHP_MapVis3_2(NULL)
        Poly_SHP_MapVis3_3(NULL)
        Poly_SHP_MapVis4_1(NULL)
        Poly_SHP_MapVis4_2(NULL)
        Poly_SHP_MapVis4_3(NULL)
        Poly_SHP_MapVis4_4(NULL)
        
        State_Clicks_MapVis2_1(NULL)
        State_Clicks_MapVis2_2(NULL)
        State_Clicks_MapVis3_1(NULL)
        State_Clicks_MapVis3_2(NULL)
        State_Clicks_MapVis3_3(NULL)
        State_Clicks_MapVis4_1(NULL)
        State_Clicks_MapVis4_2(NULL)
        State_Clicks_MapVis4_3(NULL)
        State_Clicks_MapVis4_4(NULL)
        
        SelStatePoly_SHP_MapVis2_1(NULL)
        SelStatePoly_SHP_MapVis2_2(NULL)
        SelStatePoly_SHP_MapVis3_1(NULL)
        SelStatePoly_SHP_MapVis3_2(NULL)
        SelStatePoly_SHP_MapVis3_3(NULL)
        SelStatePoly_SHP_MapVis4_1(NULL)
        SelStatePoly_SHP_MapVis4_2(NULL)
        SelStatePoly_SHP_MapVis4_3(NULL)
        SelStatePoly_SHP_MapVis4_4(NULL)
    
        
        SelStatePoints_SHP_MapVis2_1(NULL)
        SelStatePoints_SHP_MapVis2_2(NULL)
        SelStatePoints_SHP_MapVis3_1(NULL)
        SelStatePoints_SHP_MapVis3_2(NULL)
        SelStatePoints_SHP_MapVis3_3(NULL)
        SelStatePoints_SHP_MapVis4_1(NULL)
        SelStatePoints_SHP_MapVis4_2(NULL)
        SelStatePoints_SHP_MapVis4_3(NULL)
        SelStatePoints_SHP_MapVis4_4(NULL)
        
        SelStates_Filtered_MapVis2_1(NULL)
        SelStates_Filtered_MapVis2_2(NULL)
        SelStates_Filtered_MapVis3_1(NULL)
        SelStates_Filtered_MapVis3_2(NULL)
        SelStates_Filtered_MapVis3_3(NULL)
        SelStates_Filtered_MapVis4_1(NULL)
        SelStates_Filtered_MapVis4_2(NULL)
        SelStates_Filtered_MapVis4_3(NULL)
        SelStates_Filtered_MapVis4_4(NULL)

    
        
        County_Clicks_MapVis2_1(NULL)
        County_Clicks_MapVis2_2(NULL)
        County_Clicks_MapVis3_1(NULL)
        County_Clicks_MapVis3_2(NULL)
        County_Clicks_MapVis3_3(NULL)
        County_Clicks_MapVis4_1(NULL)
        County_Clicks_MapVis4_2(NULL)
        County_Clicks_MapVis4_3(NULL)
        County_Clicks_MapVis4_4(NULL)
        
        SelCountyPoly_SHP_MapVis2_1(NULL)
        SelCountyPoly_SHP_MapVis2_2(NULL)
        SelCountyPoly_SHP_MapVis3_1(NULL)
        SelCountyPoly_SHP_MapVis3_2(NULL)
        SelCountyPoly_SHP_MapVis3_3(NULL)
        SelCountyPoly_SHP_MapVis4_1(NULL)
        SelCountyPoly_SHP_MapVis4_2(NULL)
        SelCountyPoly_SHP_MapVis4_3(NULL)
        SelCountyPoly_SHP_MapVis4_4(NULL)
        
        SelCountyPoints_SHP_MapVis2_1(NULL)
        SelCountyPoints_SHP_MapVis2_2(NULL)
        SelCountyPoints_SHP_MapVis3_1(NULL)
        SelCountyPoints_SHP_MapVis3_2(NULL)
        SelCountyPoints_SHP_MapVis3_3(NULL)
        SelCountyPoints_SHP_MapVis4_1(NULL)
        SelCountyPoints_SHP_MapVis4_2(NULL)
        SelCountyPoints_SHP_MapVis4_3(NULL)
        SelCountyPoints_SHP_MapVis4_4(NULL)
        
        SelCounties_Filtered_MapVis2_1(NULL)
        SelCounties_Filtered_MapVis2_2(NULL)
        SelCounties_Filtered_MapVis3_1(NULL)
        SelCounties_Filtered_MapVis3_2(NULL)
        SelCounties_Filtered_MapVis3_3(NULL)
        SelCounties_Filtered_MapVis4_1(NULL)
        SelCounties_Filtered_MapVis4_2(NULL)
        SelCounties_Filtered_MapVis4_3(NULL)
        SelCounties_Filtered_MapVis4_4(NULL)
    
      
        Sel_SurveysMap_Vis_2_1_UL(NULL)
        Sel_SurveysMap_Vis_2_2_UL(NULL)
        Sel_SurveysMap_Vis_3_1_UL(NULL)
        Sel_SurveysMap_Vis_3_2_UL(NULL)
        Sel_SurveysMap_Vis_3_3_UL(NULL)
        Sel_SurveysMap_Vis_4_1_UL(NULL)
        Sel_SurveysMap_Vis_4_2_UL(NULL)
        Sel_SurveysMap_Vis_4_3_UL(NULL)
        Sel_SurveysMap_Vis_4_4_UL(NULL)
        
        Sel_SurveysAll_Vis_2_1_UL(NULL)
        Sel_SurveysAll_Vis_2_2_UL(NULL)
        Sel_SurveysAll_Vis_3_1_UL(NULL)
        Sel_SurveysAll_Vis_3_2_UL(NULL)
        Sel_SurveysAll_Vis_3_3_UL(NULL)
        Sel_SurveysAll_Vis_4_1_UL(NULL)
        Sel_SurveysAll_Vis_4_2_UL(NULL)
        Sel_SurveysAll_Vis_4_3_UL(NULL)
        Sel_SurveysAll_Vis_4_4_UL(NULL)
        
        Data_2_1_Selected(NULL)
        Data_2_2_Selected(NULL)
        Data_3_1_Selected(NULL)
        Data_3_2_Selected(NULL)
        Data_3_3_Selected(NULL)
        Data_4_1_Selected(NULL)
        Data_4_2_Selected(NULL)
        Data_4_3_Selected(NULL)
        Data_4_4_Selected(NULL)
        },ignoreInit=TRUE)   
      
      observeEvent(c(
      input$Vis4_SelectPolygon),
      {
        req(input$Vis4_SelectPolygon=="Clear")
        req(input$Vis4_SelectType=="Polygon")
        req(input$AF_LinkedSelection=='Yes')
        
        HighlightTrace_2Vis(NULL)
        All_SelectedWB_2Vis(NULL)
        HighlightTrace_3Vis(NULL)
        All_SelectedWB_3Vis(NULL)
        HighlightTrace_4Vis(NULL)
        All_SelectedWB_4Vis(NULL)
        Sel_SurveysScatter_Vis_2_1_UL(NULL)
        Sel_SurveysScatter_Vis_3_1_UL(NULL)
        Sel_SurveysScatter_Vis_4_1_UL(NULL)
        Sel_SurveysScatter_Vis_2_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_2_UL(NULL)
        Sel_SurveysScatter_Vis_4_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_4_UL(NULL) 
        HighlightTrace_Vis_2_1(NULL) 
        HighlightTrace_Vis_2_2(NULL) 
        HighlightTrace_Vis_3_1(NULL)
        HighlightTrace_Vis_3_2(NULL)
        HighlightTrace_Vis_3_3(NULL)
        HighlightTrace_Vis_4_1(NULL)
        HighlightTrace_Vis_4_2(NULL)
        HighlightTrace_Vis_4_3(NULL)
        HighlightTrace_Vis_4_4(NULL)
        MapVis2_1_SelectedWB_SHP(NULL)
        MapVis2_2_SelectedWB_SHP(NULL)
        MapVis3_1_SelectedWB_SHP(NULL)
        MapVis3_2_SelectedWB_SHP(NULL)
        MapVis3_3_SelectedWB_SHP(NULL)
        MapVis4_1_SelectedWB_SHP(NULL)
        MapVis4_2_SelectedWB_SHP(NULL)
        MapVis4_3_SelectedWB_SHP(NULL)
        MapVis4_4_SelectedWB_SHP(NULL)
        MapVis2_1_area$mp<-NULL
        MapVis2_2_area$mp<-NULL
        MapVis3_1_area$mp<-NULL
        MapVis3_2_area$mp<-NULL
        MapVis3_3_area$mp<-NULL
        MapVis4_1_area$mp<-NULL
        MapVis4_2_area$mp<-NULL
        MapVis4_3_area$mp<-NULL
        MapVis4_4_area$mp<-NULL
        Poly_SHP_MapVis2_1(NULL)
        Poly_SHP_MapVis2_2(NULL)
        Poly_SHP_MapVis3_1(NULL)
        Poly_SHP_MapVis3_2(NULL)
        Poly_SHP_MapVis3_3(NULL)
        Poly_SHP_MapVis4_1(NULL)
        Poly_SHP_MapVis4_2(NULL)
        Poly_SHP_MapVis4_3(NULL)
        Poly_SHP_MapVis4_4(NULL)
        
        State_Clicks_MapVis2_1(NULL)
        State_Clicks_MapVis2_2(NULL)
        State_Clicks_MapVis3_1(NULL)
        State_Clicks_MapVis3_2(NULL)
        State_Clicks_MapVis3_3(NULL)
        State_Clicks_MapVis4_1(NULL)
        State_Clicks_MapVis4_2(NULL)
        State_Clicks_MapVis4_3(NULL)
        State_Clicks_MapVis4_4(NULL)
        
        SelStatePoly_SHP_MapVis2_1(NULL)
        SelStatePoly_SHP_MapVis2_2(NULL)
        SelStatePoly_SHP_MapVis3_1(NULL)
        SelStatePoly_SHP_MapVis3_2(NULL)
        SelStatePoly_SHP_MapVis3_3(NULL)
        SelStatePoly_SHP_MapVis4_1(NULL)
        SelStatePoly_SHP_MapVis4_2(NULL)
        SelStatePoly_SHP_MapVis4_3(NULL)
        SelStatePoly_SHP_MapVis4_4(NULL)
    
        
        SelStatePoints_SHP_MapVis2_1(NULL)
        SelStatePoints_SHP_MapVis2_2(NULL)
        SelStatePoints_SHP_MapVis3_1(NULL)
        SelStatePoints_SHP_MapVis3_2(NULL)
        SelStatePoints_SHP_MapVis3_3(NULL)
        SelStatePoints_SHP_MapVis4_1(NULL)
        SelStatePoints_SHP_MapVis4_2(NULL)
        SelStatePoints_SHP_MapVis4_3(NULL)
        SelStatePoints_SHP_MapVis4_4(NULL)
        
        SelStates_Filtered_MapVis2_1(NULL)
        SelStates_Filtered_MapVis2_2(NULL)
        SelStates_Filtered_MapVis3_1(NULL)
        SelStates_Filtered_MapVis3_2(NULL)
        SelStates_Filtered_MapVis3_3(NULL)
        SelStates_Filtered_MapVis4_1(NULL)
        SelStates_Filtered_MapVis4_2(NULL)
        SelStates_Filtered_MapVis4_3(NULL)
        SelStates_Filtered_MapVis4_4(NULL)

    
        
        County_Clicks_MapVis2_1(NULL)
        County_Clicks_MapVis2_2(NULL)
        County_Clicks_MapVis3_1(NULL)
        County_Clicks_MapVis3_2(NULL)
        County_Clicks_MapVis3_3(NULL)
        County_Clicks_MapVis4_1(NULL)
        County_Clicks_MapVis4_2(NULL)
        County_Clicks_MapVis4_3(NULL)
        County_Clicks_MapVis4_4(NULL)
        
        SelCountyPoly_SHP_MapVis2_1(NULL)
        SelCountyPoly_SHP_MapVis2_2(NULL)
        SelCountyPoly_SHP_MapVis3_1(NULL)
        SelCountyPoly_SHP_MapVis3_2(NULL)
        SelCountyPoly_SHP_MapVis3_3(NULL)
        SelCountyPoly_SHP_MapVis4_1(NULL)
        SelCountyPoly_SHP_MapVis4_2(NULL)
        SelCountyPoly_SHP_MapVis4_3(NULL)
        SelCountyPoly_SHP_MapVis4_4(NULL)
        
        SelCountyPoints_SHP_MapVis2_1(NULL)
        SelCountyPoints_SHP_MapVis2_2(NULL)
        SelCountyPoints_SHP_MapVis3_1(NULL)
        SelCountyPoints_SHP_MapVis3_2(NULL)
        SelCountyPoints_SHP_MapVis3_3(NULL)
        SelCountyPoints_SHP_MapVis4_1(NULL)
        SelCountyPoints_SHP_MapVis4_2(NULL)
        SelCountyPoints_SHP_MapVis4_3(NULL)
        SelCountyPoints_SHP_MapVis4_4(NULL)
        
        SelCounties_Filtered_MapVis2_1(NULL)
        SelCounties_Filtered_MapVis2_2(NULL)
        SelCounties_Filtered_MapVis3_1(NULL)
        SelCounties_Filtered_MapVis3_2(NULL)
        SelCounties_Filtered_MapVis3_3(NULL)
        SelCounties_Filtered_MapVis4_1(NULL)
        SelCounties_Filtered_MapVis4_2(NULL)
        SelCounties_Filtered_MapVis4_3(NULL)
        SelCounties_Filtered_MapVis4_4(NULL)
    
     
        Sel_SurveysMap_Vis_2_1_UL(NULL)
        Sel_SurveysMap_Vis_2_2_UL(NULL)
        Sel_SurveysMap_Vis_3_1_UL(NULL)
        Sel_SurveysMap_Vis_3_2_UL(NULL)
        Sel_SurveysMap_Vis_3_3_UL(NULL)
        Sel_SurveysMap_Vis_4_1_UL(NULL)
        Sel_SurveysMap_Vis_4_2_UL(NULL)
        Sel_SurveysMap_Vis_4_3_UL(NULL)
        Sel_SurveysMap_Vis_4_4_UL(NULL)
        
        Sel_SurveysAll_Vis_2_1_UL(NULL)
        Sel_SurveysAll_Vis_2_2_UL(NULL)
        Sel_SurveysAll_Vis_3_1_UL(NULL)
        Sel_SurveysAll_Vis_3_2_UL(NULL)
        Sel_SurveysAll_Vis_3_3_UL(NULL)
        Sel_SurveysAll_Vis_4_1_UL(NULL)
        Sel_SurveysAll_Vis_4_2_UL(NULL)
        Sel_SurveysAll_Vis_4_3_UL(NULL)
        Sel_SurveysAll_Vis_4_4_UL(NULL)
        
        Data_2_1_Selected(NULL)
        Data_2_2_Selected(NULL)
        Data_3_1_Selected(NULL)
        Data_3_2_Selected(NULL)
        Data_3_3_Selected(NULL)
        Data_4_1_Selected(NULL)
        Data_4_2_Selected(NULL)
        Data_4_3_Selected(NULL)
        Data_4_4_Selected(NULL)
        },ignoreInit=TRUE)   
      
    observeEvent(c(
      input$Vis1_SelectState),
      {
        req(input$Vis1_SelectState=="Clear")
        req(input$Vis1_SelectType=="States")
        req(input$AF_LinkedSelection=='Yes')
        
        HighlightTrace_2Vis(NULL)
        All_SelectedWB_2Vis(NULL)
        HighlightTrace_3Vis(NULL)
        All_SelectedWB_3Vis(NULL)
        HighlightTrace_4Vis(NULL)
        All_SelectedWB_4Vis(NULL)
        Sel_SurveysScatter_Vis_2_1_UL(NULL)
        Sel_SurveysScatter_Vis_3_1_UL(NULL)
        Sel_SurveysScatter_Vis_4_1_UL(NULL)
        Sel_SurveysScatter_Vis_2_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_2_UL(NULL)
        Sel_SurveysScatter_Vis_4_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_4_UL(NULL) 
        HighlightTrace_Vis_2_1(NULL) 
        HighlightTrace_Vis_2_2(NULL) 
        HighlightTrace_Vis_3_1(NULL)
        HighlightTrace_Vis_3_2(NULL)
        HighlightTrace_Vis_3_3(NULL)
        HighlightTrace_Vis_4_1(NULL)
        HighlightTrace_Vis_4_2(NULL)
        HighlightTrace_Vis_4_3(NULL)
        HighlightTrace_Vis_4_4(NULL)
        MapVis2_1_SelectedWB_SHP(NULL)
        MapVis2_2_SelectedWB_SHP(NULL)
        MapVis3_1_SelectedWB_SHP(NULL)
        MapVis3_2_SelectedWB_SHP(NULL)
        MapVis3_3_SelectedWB_SHP(NULL)
        MapVis4_1_SelectedWB_SHP(NULL)
        MapVis4_2_SelectedWB_SHP(NULL)
        MapVis4_3_SelectedWB_SHP(NULL)
        MapVis4_4_SelectedWB_SHP(NULL)
        MapVis2_1_area$mp<-NULL
        MapVis2_2_area$mp<-NULL
        MapVis3_1_area$mp<-NULL
        MapVis3_2_area$mp<-NULL
        MapVis3_3_area$mp<-NULL
        MapVis4_1_area$mp<-NULL
        MapVis4_2_area$mp<-NULL
        MapVis4_3_area$mp<-NULL
        MapVis4_4_area$mp<-NULL
        Poly_SHP_MapVis2_1(NULL)
        Poly_SHP_MapVis2_2(NULL)
        Poly_SHP_MapVis3_1(NULL)
        Poly_SHP_MapVis3_2(NULL)
        Poly_SHP_MapVis3_3(NULL)
        Poly_SHP_MapVis4_1(NULL)
        Poly_SHP_MapVis4_2(NULL)
        Poly_SHP_MapVis4_3(NULL)
        Poly_SHP_MapVis4_4(NULL)
        
        State_Clicks_MapVis2_1(NULL)
        State_Clicks_MapVis2_2(NULL)
        State_Clicks_MapVis3_1(NULL)
        State_Clicks_MapVis3_2(NULL)
        State_Clicks_MapVis3_3(NULL)
        State_Clicks_MapVis4_1(NULL)
        State_Clicks_MapVis4_2(NULL)
        State_Clicks_MapVis4_3(NULL)
        State_Clicks_MapVis4_4(NULL)
        
        SelStatePoly_SHP_MapVis2_1(NULL)
        SelStatePoly_SHP_MapVis2_2(NULL)
        SelStatePoly_SHP_MapVis3_1(NULL)
        SelStatePoly_SHP_MapVis3_2(NULL)
        SelStatePoly_SHP_MapVis3_3(NULL)
        SelStatePoly_SHP_MapVis4_1(NULL)
        SelStatePoly_SHP_MapVis4_2(NULL)
        SelStatePoly_SHP_MapVis4_3(NULL)
        SelStatePoly_SHP_MapVis4_4(NULL)
    
        
        SelStatePoints_SHP_MapVis2_1(NULL)
        SelStatePoints_SHP_MapVis2_2(NULL)
        SelStatePoints_SHP_MapVis3_1(NULL)
        SelStatePoints_SHP_MapVis3_2(NULL)
        SelStatePoints_SHP_MapVis3_3(NULL)
        SelStatePoints_SHP_MapVis4_1(NULL)
        SelStatePoints_SHP_MapVis4_2(NULL)
        SelStatePoints_SHP_MapVis4_3(NULL)
        SelStatePoints_SHP_MapVis4_4(NULL)
        
        SelStates_Filtered_MapVis2_1(NULL)
        SelStates_Filtered_MapVis2_2(NULL)
        SelStates_Filtered_MapVis3_1(NULL)
        SelStates_Filtered_MapVis3_2(NULL)
        SelStates_Filtered_MapVis3_3(NULL)
        SelStates_Filtered_MapVis4_1(NULL)
        SelStates_Filtered_MapVis4_2(NULL)
        SelStates_Filtered_MapVis4_3(NULL)
        SelStates_Filtered_MapVis4_4(NULL)

    
        
        County_Clicks_MapVis2_1(NULL)
        County_Clicks_MapVis2_2(NULL)
        County_Clicks_MapVis3_1(NULL)
        County_Clicks_MapVis3_2(NULL)
        County_Clicks_MapVis3_3(NULL)
        County_Clicks_MapVis4_1(NULL)
        County_Clicks_MapVis4_2(NULL)
        County_Clicks_MapVis4_3(NULL)
        County_Clicks_MapVis4_4(NULL)
        
        SelCountyPoly_SHP_MapVis2_1(NULL)
        SelCountyPoly_SHP_MapVis2_2(NULL)
        SelCountyPoly_SHP_MapVis3_1(NULL)
        SelCountyPoly_SHP_MapVis3_2(NULL)
        SelCountyPoly_SHP_MapVis3_3(NULL)
        SelCountyPoly_SHP_MapVis4_1(NULL)
        SelCountyPoly_SHP_MapVis4_2(NULL)
        SelCountyPoly_SHP_MapVis4_3(NULL)
        SelCountyPoly_SHP_MapVis4_4(NULL)
        
        SelCountyPoints_SHP_MapVis2_1(NULL)
        SelCountyPoints_SHP_MapVis2_2(NULL)
        SelCountyPoints_SHP_MapVis3_1(NULL)
        SelCountyPoints_SHP_MapVis3_2(NULL)
        SelCountyPoints_SHP_MapVis3_3(NULL)
        SelCountyPoints_SHP_MapVis4_1(NULL)
        SelCountyPoints_SHP_MapVis4_2(NULL)
        SelCountyPoints_SHP_MapVis4_3(NULL)
        SelCountyPoints_SHP_MapVis4_4(NULL)
        
        SelCounties_Filtered_MapVis2_1(NULL)
        SelCounties_Filtered_MapVis2_2(NULL)
        SelCounties_Filtered_MapVis3_1(NULL)
        SelCounties_Filtered_MapVis3_2(NULL)
        SelCounties_Filtered_MapVis3_3(NULL)
        SelCounties_Filtered_MapVis4_1(NULL)
        SelCounties_Filtered_MapVis4_2(NULL)
        SelCounties_Filtered_MapVis4_3(NULL)
        SelCounties_Filtered_MapVis4_4(NULL)
    
        
      
        
        Sel_SurveysMap_Vis_2_1_UL(NULL)
        Sel_SurveysMap_Vis_2_2_UL(NULL)
        Sel_SurveysMap_Vis_3_1_UL(NULL)
        Sel_SurveysMap_Vis_3_2_UL(NULL)
        Sel_SurveysMap_Vis_3_3_UL(NULL)
        Sel_SurveysMap_Vis_4_1_UL(NULL)
        Sel_SurveysMap_Vis_4_2_UL(NULL)
        Sel_SurveysMap_Vis_4_3_UL(NULL)
        Sel_SurveysMap_Vis_4_4_UL(NULL)
        
        Sel_SurveysAll_Vis_2_1_UL(NULL)
        Sel_SurveysAll_Vis_2_2_UL(NULL)
        Sel_SurveysAll_Vis_3_1_UL(NULL)
        Sel_SurveysAll_Vis_3_2_UL(NULL)
        Sel_SurveysAll_Vis_3_3_UL(NULL)
        Sel_SurveysAll_Vis_4_1_UL(NULL)
        Sel_SurveysAll_Vis_4_2_UL(NULL)
        Sel_SurveysAll_Vis_4_3_UL(NULL)
        Sel_SurveysAll_Vis_4_4_UL(NULL)
        
        Data_2_1_Selected(NULL)
        Data_2_2_Selected(NULL)
        Data_3_1_Selected(NULL)
        Data_3_2_Selected(NULL)
        Data_3_3_Selected(NULL)
        Data_4_1_Selected(NULL)
        Data_4_2_Selected(NULL)
        Data_4_3_Selected(NULL)
        Data_4_4_Selected(NULL)
        
        },ignoreInit=TRUE)   

    observeEvent(c(
      input$Vis2_SelectState),
      {
        req(input$Vis2_SelectState=="Clear")
        req(input$Vis2_SelectType=="States")
        req(input$AF_LinkedSelection=='Yes')
        
        HighlightTrace_2Vis(NULL)
        All_SelectedWB_2Vis(NULL)
        HighlightTrace_3Vis(NULL)
        All_SelectedWB_3Vis(NULL)
        HighlightTrace_4Vis(NULL)
        All_SelectedWB_4Vis(NULL)
        Sel_SurveysScatter_Vis_2_1_UL(NULL)
        Sel_SurveysScatter_Vis_3_1_UL(NULL)
        Sel_SurveysScatter_Vis_4_1_UL(NULL)
        Sel_SurveysScatter_Vis_2_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_2_UL(NULL)
        Sel_SurveysScatter_Vis_4_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_4_UL(NULL) 
        HighlightTrace_Vis_2_1(NULL) 
        HighlightTrace_Vis_2_2(NULL) 
        HighlightTrace_Vis_3_1(NULL)
        HighlightTrace_Vis_3_2(NULL)
        HighlightTrace_Vis_3_3(NULL)
        HighlightTrace_Vis_4_1(NULL)
        HighlightTrace_Vis_4_2(NULL)
        HighlightTrace_Vis_4_3(NULL)
        HighlightTrace_Vis_4_4(NULL)
        MapVis2_1_SelectedWB_SHP(NULL)
        MapVis2_2_SelectedWB_SHP(NULL)
        MapVis3_1_SelectedWB_SHP(NULL)
        MapVis3_2_SelectedWB_SHP(NULL)
        MapVis3_3_SelectedWB_SHP(NULL)
        MapVis4_1_SelectedWB_SHP(NULL)
        MapVis4_2_SelectedWB_SHP(NULL)
        MapVis4_3_SelectedWB_SHP(NULL)
        MapVis4_4_SelectedWB_SHP(NULL)
        MapVis2_1_area$mp<-NULL
        MapVis2_2_area$mp<-NULL
        MapVis3_1_area$mp<-NULL
        MapVis3_2_area$mp<-NULL
        MapVis3_3_area$mp<-NULL
        MapVis4_1_area$mp<-NULL
        MapVis4_2_area$mp<-NULL
        MapVis4_3_area$mp<-NULL
        MapVis4_4_area$mp<-NULL
        Poly_SHP_MapVis2_1(NULL)
        Poly_SHP_MapVis2_2(NULL)
        Poly_SHP_MapVis3_1(NULL)
        Poly_SHP_MapVis3_2(NULL)
        Poly_SHP_MapVis3_3(NULL)
        Poly_SHP_MapVis4_1(NULL)
        Poly_SHP_MapVis4_2(NULL)
        Poly_SHP_MapVis4_3(NULL)
        Poly_SHP_MapVis4_4(NULL)
        
        State_Clicks_MapVis2_1(NULL)
        State_Clicks_MapVis2_2(NULL)
        State_Clicks_MapVis3_1(NULL)
        State_Clicks_MapVis3_2(NULL)
        State_Clicks_MapVis3_3(NULL)
        State_Clicks_MapVis4_1(NULL)
        State_Clicks_MapVis4_2(NULL)
        State_Clicks_MapVis4_3(NULL)
        State_Clicks_MapVis4_4(NULL)
        
        SelStatePoly_SHP_MapVis2_1(NULL)
        SelStatePoly_SHP_MapVis2_2(NULL)
        SelStatePoly_SHP_MapVis3_1(NULL)
        SelStatePoly_SHP_MapVis3_2(NULL)
        SelStatePoly_SHP_MapVis3_3(NULL)
        SelStatePoly_SHP_MapVis4_1(NULL)
        SelStatePoly_SHP_MapVis4_2(NULL)
        SelStatePoly_SHP_MapVis4_3(NULL)
        SelStatePoly_SHP_MapVis4_4(NULL)
    
        
        SelStatePoints_SHP_MapVis2_1(NULL)
        SelStatePoints_SHP_MapVis2_2(NULL)
        SelStatePoints_SHP_MapVis3_1(NULL)
        SelStatePoints_SHP_MapVis3_2(NULL)
        SelStatePoints_SHP_MapVis3_3(NULL)
        SelStatePoints_SHP_MapVis4_1(NULL)
        SelStatePoints_SHP_MapVis4_2(NULL)
        SelStatePoints_SHP_MapVis4_3(NULL)
        SelStatePoints_SHP_MapVis4_4(NULL)
        
        SelStates_Filtered_MapVis2_1(NULL)
        SelStates_Filtered_MapVis2_2(NULL)
        SelStates_Filtered_MapVis3_1(NULL)
        SelStates_Filtered_MapVis3_2(NULL)
        SelStates_Filtered_MapVis3_3(NULL)
        SelStates_Filtered_MapVis4_1(NULL)
        SelStates_Filtered_MapVis4_2(NULL)
        SelStates_Filtered_MapVis4_3(NULL)
        SelStates_Filtered_MapVis4_4(NULL)

    
        
        County_Clicks_MapVis2_1(NULL)
        County_Clicks_MapVis2_2(NULL)
        County_Clicks_MapVis3_1(NULL)
        County_Clicks_MapVis3_2(NULL)
        County_Clicks_MapVis3_3(NULL)
        County_Clicks_MapVis4_1(NULL)
        County_Clicks_MapVis4_2(NULL)
        County_Clicks_MapVis4_3(NULL)
        County_Clicks_MapVis4_4(NULL)
        
        SelCountyPoly_SHP_MapVis2_1(NULL)
        SelCountyPoly_SHP_MapVis2_2(NULL)
        SelCountyPoly_SHP_MapVis3_1(NULL)
        SelCountyPoly_SHP_MapVis3_2(NULL)
        SelCountyPoly_SHP_MapVis3_3(NULL)
        SelCountyPoly_SHP_MapVis4_1(NULL)
        SelCountyPoly_SHP_MapVis4_2(NULL)
        SelCountyPoly_SHP_MapVis4_3(NULL)
        SelCountyPoly_SHP_MapVis4_4(NULL)
        
        SelCountyPoints_SHP_MapVis2_1(NULL)
        SelCountyPoints_SHP_MapVis2_2(NULL)
        SelCountyPoints_SHP_MapVis3_1(NULL)
        SelCountyPoints_SHP_MapVis3_2(NULL)
        SelCountyPoints_SHP_MapVis3_3(NULL)
        SelCountyPoints_SHP_MapVis4_1(NULL)
        SelCountyPoints_SHP_MapVis4_2(NULL)
        SelCountyPoints_SHP_MapVis4_3(NULL)
        SelCountyPoints_SHP_MapVis4_4(NULL)
        
        SelCounties_Filtered_MapVis2_1(NULL)
        SelCounties_Filtered_MapVis2_2(NULL)
        SelCounties_Filtered_MapVis3_1(NULL)
        SelCounties_Filtered_MapVis3_2(NULL)
        SelCounties_Filtered_MapVis3_3(NULL)
        SelCounties_Filtered_MapVis4_1(NULL)
        SelCounties_Filtered_MapVis4_2(NULL)
        SelCounties_Filtered_MapVis4_3(NULL)
        SelCounties_Filtered_MapVis4_4(NULL)
    
      
        Sel_SurveysMap_Vis_2_1_UL(NULL)
        Sel_SurveysMap_Vis_2_2_UL(NULL)
        Sel_SurveysMap_Vis_3_1_UL(NULL)
        Sel_SurveysMap_Vis_3_2_UL(NULL)
        Sel_SurveysMap_Vis_3_3_UL(NULL)
        Sel_SurveysMap_Vis_4_1_UL(NULL)
        Sel_SurveysMap_Vis_4_2_UL(NULL)
        Sel_SurveysMap_Vis_4_3_UL(NULL)
        Sel_SurveysMap_Vis_4_4_UL(NULL)
        
        Sel_SurveysAll_Vis_2_1_UL(NULL)
        Sel_SurveysAll_Vis_2_2_UL(NULL)
        Sel_SurveysAll_Vis_3_1_UL(NULL)
        Sel_SurveysAll_Vis_3_2_UL(NULL)
        Sel_SurveysAll_Vis_3_3_UL(NULL)
        Sel_SurveysAll_Vis_4_1_UL(NULL)
        Sel_SurveysAll_Vis_4_2_UL(NULL)
        Sel_SurveysAll_Vis_4_3_UL(NULL)
        Sel_SurveysAll_Vis_4_4_UL(NULL)
        
        Data_2_1_Selected(NULL)
        Data_2_2_Selected(NULL)
        Data_3_1_Selected(NULL)
        Data_3_2_Selected(NULL)
        Data_3_3_Selected(NULL)
        Data_4_1_Selected(NULL)
        Data_4_2_Selected(NULL)
        Data_4_3_Selected(NULL)
        Data_4_4_Selected(NULL)
        },ignoreInit=TRUE)       
 
    observeEvent(c(
      input$Vis3_SelectState),
      {
        req(input$Vis3_SelectState=="Clear")
        req(input$Vis3_SelectType=="States")
        req(input$AF_LinkedSelection=='Yes')
        
        HighlightTrace_2Vis(NULL)
        All_SelectedWB_2Vis(NULL)
        HighlightTrace_3Vis(NULL)
        All_SelectedWB_3Vis(NULL)
        HighlightTrace_4Vis(NULL)
        All_SelectedWB_4Vis(NULL)
        Sel_SurveysScatter_Vis_2_1_UL(NULL)
        Sel_SurveysScatter_Vis_3_1_UL(NULL)
        Sel_SurveysScatter_Vis_4_1_UL(NULL)
        Sel_SurveysScatter_Vis_2_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_2_UL(NULL)
        Sel_SurveysScatter_Vis_4_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_4_UL(NULL) 
        HighlightTrace_Vis_2_1(NULL) 
        HighlightTrace_Vis_2_2(NULL) 
        HighlightTrace_Vis_3_1(NULL)
        HighlightTrace_Vis_3_2(NULL)
        HighlightTrace_Vis_3_3(NULL)
        HighlightTrace_Vis_4_1(NULL)
        HighlightTrace_Vis_4_2(NULL)
        HighlightTrace_Vis_4_3(NULL)
        HighlightTrace_Vis_4_4(NULL)
        MapVis2_1_SelectedWB_SHP(NULL)
        MapVis2_2_SelectedWB_SHP(NULL)
        MapVis3_1_SelectedWB_SHP(NULL)
        MapVis3_2_SelectedWB_SHP(NULL)
        MapVis3_3_SelectedWB_SHP(NULL)
        MapVis4_1_SelectedWB_SHP(NULL)
        MapVis4_2_SelectedWB_SHP(NULL)
        MapVis4_3_SelectedWB_SHP(NULL)
        MapVis4_4_SelectedWB_SHP(NULL)
        MapVis2_1_area$mp<-NULL
        MapVis2_2_area$mp<-NULL
        MapVis3_1_area$mp<-NULL
        MapVis3_2_area$mp<-NULL
        MapVis3_3_area$mp<-NULL
        MapVis4_1_area$mp<-NULL
        MapVis4_2_area$mp<-NULL
        MapVis4_3_area$mp<-NULL
        MapVis4_4_area$mp<-NULL
        Poly_SHP_MapVis2_1(NULL)
        Poly_SHP_MapVis2_2(NULL)
        Poly_SHP_MapVis3_1(NULL)
        Poly_SHP_MapVis3_2(NULL)
        Poly_SHP_MapVis3_3(NULL)
        Poly_SHP_MapVis4_1(NULL)
        Poly_SHP_MapVis4_2(NULL)
        Poly_SHP_MapVis4_3(NULL)
        Poly_SHP_MapVis4_4(NULL)
        
        State_Clicks_MapVis2_1(NULL)
        State_Clicks_MapVis2_2(NULL)
        State_Clicks_MapVis3_1(NULL)
        State_Clicks_MapVis3_2(NULL)
        State_Clicks_MapVis3_3(NULL)
        State_Clicks_MapVis4_1(NULL)
        State_Clicks_MapVis4_2(NULL)
        State_Clicks_MapVis4_3(NULL)
        State_Clicks_MapVis4_4(NULL)
        
        SelStatePoly_SHP_MapVis2_1(NULL)
        SelStatePoly_SHP_MapVis2_2(NULL)
        SelStatePoly_SHP_MapVis3_1(NULL)
        SelStatePoly_SHP_MapVis3_2(NULL)
        SelStatePoly_SHP_MapVis3_3(NULL)
        SelStatePoly_SHP_MapVis4_1(NULL)
        SelStatePoly_SHP_MapVis4_2(NULL)
        SelStatePoly_SHP_MapVis4_3(NULL)
        SelStatePoly_SHP_MapVis4_4(NULL)
    
        
        SelStatePoints_SHP_MapVis2_1(NULL)
        SelStatePoints_SHP_MapVis2_2(NULL)
        SelStatePoints_SHP_MapVis3_1(NULL)
        SelStatePoints_SHP_MapVis3_2(NULL)
        SelStatePoints_SHP_MapVis3_3(NULL)
        SelStatePoints_SHP_MapVis4_1(NULL)
        SelStatePoints_SHP_MapVis4_2(NULL)
        SelStatePoints_SHP_MapVis4_3(NULL)
        SelStatePoints_SHP_MapVis4_4(NULL)
        
        SelStates_Filtered_MapVis2_1(NULL)
        SelStates_Filtered_MapVis2_2(NULL)
        SelStates_Filtered_MapVis3_1(NULL)
        SelStates_Filtered_MapVis3_2(NULL)
        SelStates_Filtered_MapVis3_3(NULL)
        SelStates_Filtered_MapVis4_1(NULL)
        SelStates_Filtered_MapVis4_2(NULL)
        SelStates_Filtered_MapVis4_3(NULL)
        SelStates_Filtered_MapVis4_4(NULL)

    
        
        County_Clicks_MapVis2_1(NULL)
        County_Clicks_MapVis2_2(NULL)
        County_Clicks_MapVis3_1(NULL)
        County_Clicks_MapVis3_2(NULL)
        County_Clicks_MapVis3_3(NULL)
        County_Clicks_MapVis4_1(NULL)
        County_Clicks_MapVis4_2(NULL)
        County_Clicks_MapVis4_3(NULL)
        County_Clicks_MapVis4_4(NULL)
        
        SelCountyPoly_SHP_MapVis2_1(NULL)
        SelCountyPoly_SHP_MapVis2_2(NULL)
        SelCountyPoly_SHP_MapVis3_1(NULL)
        SelCountyPoly_SHP_MapVis3_2(NULL)
        SelCountyPoly_SHP_MapVis3_3(NULL)
        SelCountyPoly_SHP_MapVis4_1(NULL)
        SelCountyPoly_SHP_MapVis4_2(NULL)
        SelCountyPoly_SHP_MapVis4_3(NULL)
        SelCountyPoly_SHP_MapVis4_4(NULL)
        
        SelCountyPoints_SHP_MapVis2_1(NULL)
        SelCountyPoints_SHP_MapVis2_2(NULL)
        SelCountyPoints_SHP_MapVis3_1(NULL)
        SelCountyPoints_SHP_MapVis3_2(NULL)
        SelCountyPoints_SHP_MapVis3_3(NULL)
        SelCountyPoints_SHP_MapVis4_1(NULL)
        SelCountyPoints_SHP_MapVis4_2(NULL)
        SelCountyPoints_SHP_MapVis4_3(NULL)
        SelCountyPoints_SHP_MapVis4_4(NULL)
        
        SelCounties_Filtered_MapVis2_1(NULL)
        SelCounties_Filtered_MapVis2_2(NULL)
        SelCounties_Filtered_MapVis3_1(NULL)
        SelCounties_Filtered_MapVis3_2(NULL)
        SelCounties_Filtered_MapVis3_3(NULL)
        SelCounties_Filtered_MapVis4_1(NULL)
        SelCounties_Filtered_MapVis4_2(NULL)
        SelCounties_Filtered_MapVis4_3(NULL)
        SelCounties_Filtered_MapVis4_4(NULL)
    
        Sel_SurveysMap_Vis_2_1_UL(NULL)
        Sel_SurveysMap_Vis_2_2_UL(NULL)
        Sel_SurveysMap_Vis_3_1_UL(NULL)
        Sel_SurveysMap_Vis_3_2_UL(NULL)
        Sel_SurveysMap_Vis_3_3_UL(NULL)
        Sel_SurveysMap_Vis_4_1_UL(NULL)
        Sel_SurveysMap_Vis_4_2_UL(NULL)
        Sel_SurveysMap_Vis_4_3_UL(NULL)
        Sel_SurveysMap_Vis_4_4_UL(NULL)
        
        Sel_SurveysAll_Vis_2_1_UL(NULL)
        Sel_SurveysAll_Vis_2_2_UL(NULL)
        Sel_SurveysAll_Vis_3_1_UL(NULL)
        Sel_SurveysAll_Vis_3_2_UL(NULL)
        Sel_SurveysAll_Vis_3_3_UL(NULL)
        Sel_SurveysAll_Vis_4_1_UL(NULL)
        Sel_SurveysAll_Vis_4_2_UL(NULL)
        Sel_SurveysAll_Vis_4_3_UL(NULL)
        Sel_SurveysAll_Vis_4_4_UL(NULL)
        
        Data_2_1_Selected(NULL)
        Data_2_2_Selected(NULL)
        Data_3_1_Selected(NULL)
        Data_3_2_Selected(NULL)
        Data_3_3_Selected(NULL)
        Data_4_1_Selected(NULL)
        Data_4_2_Selected(NULL)
        Data_4_3_Selected(NULL)
        Data_4_4_Selected(NULL)
        
        },ignoreInit=TRUE)       
    
    observeEvent(c(
      input$Vis4_SelectState),
      {
        req(input$Vis4_SelectState=="Clear")
        req(input$Vis4_SelectType=="States")
        req(input$AF_LinkedSelection=='Yes')
        
        HighlightTrace_2Vis(NULL)
        All_SelectedWB_2Vis(NULL)
        HighlightTrace_3Vis(NULL)
        All_SelectedWB_3Vis(NULL)
        HighlightTrace_4Vis(NULL)
        All_SelectedWB_4Vis(NULL)
        Sel_SurveysScatter_Vis_2_1_UL(NULL)
        Sel_SurveysScatter_Vis_3_1_UL(NULL)
        Sel_SurveysScatter_Vis_4_1_UL(NULL)
        Sel_SurveysScatter_Vis_2_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_2_UL(NULL)
        Sel_SurveysScatter_Vis_4_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_4_UL(NULL) 
        HighlightTrace_Vis_2_1(NULL) 
        HighlightTrace_Vis_2_2(NULL) 
        HighlightTrace_Vis_3_1(NULL)
        HighlightTrace_Vis_3_2(NULL)
        HighlightTrace_Vis_3_3(NULL)
        HighlightTrace_Vis_4_1(NULL)
        HighlightTrace_Vis_4_2(NULL)
        HighlightTrace_Vis_4_3(NULL)
        HighlightTrace_Vis_4_4(NULL)
        MapVis2_1_SelectedWB_SHP(NULL)
        MapVis2_2_SelectedWB_SHP(NULL)
        MapVis3_1_SelectedWB_SHP(NULL)
        MapVis3_2_SelectedWB_SHP(NULL)
        MapVis3_3_SelectedWB_SHP(NULL)
        MapVis4_1_SelectedWB_SHP(NULL)
        MapVis4_2_SelectedWB_SHP(NULL)
        MapVis4_3_SelectedWB_SHP(NULL)
        MapVis4_4_SelectedWB_SHP(NULL)
        MapVis2_1_area$mp<-NULL
        MapVis2_2_area$mp<-NULL
        MapVis3_1_area$mp<-NULL
        MapVis3_2_area$mp<-NULL
        MapVis3_3_area$mp<-NULL
        MapVis4_1_area$mp<-NULL
        MapVis4_2_area$mp<-NULL
        MapVis4_3_area$mp<-NULL
        MapVis4_4_area$mp<-NULL
        Poly_SHP_MapVis2_1(NULL)
        Poly_SHP_MapVis2_2(NULL)
        Poly_SHP_MapVis3_1(NULL)
        Poly_SHP_MapVis3_2(NULL)
        Poly_SHP_MapVis3_3(NULL)
        Poly_SHP_MapVis4_1(NULL)
        Poly_SHP_MapVis4_2(NULL)
        Poly_SHP_MapVis4_3(NULL)
        Poly_SHP_MapVis4_4(NULL)
        
        State_Clicks_MapVis2_1(NULL)
        State_Clicks_MapVis2_2(NULL)
        State_Clicks_MapVis3_1(NULL)
        State_Clicks_MapVis3_2(NULL)
        State_Clicks_MapVis3_3(NULL)
        State_Clicks_MapVis4_1(NULL)
        State_Clicks_MapVis4_2(NULL)
        State_Clicks_MapVis4_3(NULL)
        State_Clicks_MapVis4_4(NULL)
        
        SelStatePoly_SHP_MapVis2_1(NULL)
        SelStatePoly_SHP_MapVis2_2(NULL)
        SelStatePoly_SHP_MapVis3_1(NULL)
        SelStatePoly_SHP_MapVis3_2(NULL)
        SelStatePoly_SHP_MapVis3_3(NULL)
        SelStatePoly_SHP_MapVis4_1(NULL)
        SelStatePoly_SHP_MapVis4_2(NULL)
        SelStatePoly_SHP_MapVis4_3(NULL)
        SelStatePoly_SHP_MapVis4_4(NULL)
    
        
        SelStatePoints_SHP_MapVis2_1(NULL)
        SelStatePoints_SHP_MapVis2_2(NULL)
        SelStatePoints_SHP_MapVis3_1(NULL)
        SelStatePoints_SHP_MapVis3_2(NULL)
        SelStatePoints_SHP_MapVis3_3(NULL)
        SelStatePoints_SHP_MapVis4_1(NULL)
        SelStatePoints_SHP_MapVis4_2(NULL)
        SelStatePoints_SHP_MapVis4_3(NULL)
        SelStatePoints_SHP_MapVis4_4(NULL)
        
        SelStates_Filtered_MapVis2_1(NULL)
        SelStates_Filtered_MapVis2_2(NULL)
        SelStates_Filtered_MapVis3_1(NULL)
        SelStates_Filtered_MapVis3_2(NULL)
        SelStates_Filtered_MapVis3_3(NULL)
        SelStates_Filtered_MapVis4_1(NULL)
        SelStates_Filtered_MapVis4_2(NULL)
        SelStates_Filtered_MapVis4_3(NULL)
        SelStates_Filtered_MapVis4_4(NULL)

    
        
        County_Clicks_MapVis2_1(NULL)
        County_Clicks_MapVis2_2(NULL)
        County_Clicks_MapVis3_1(NULL)
        County_Clicks_MapVis3_2(NULL)
        County_Clicks_MapVis3_3(NULL)
        County_Clicks_MapVis4_1(NULL)
        County_Clicks_MapVis4_2(NULL)
        County_Clicks_MapVis4_3(NULL)
        County_Clicks_MapVis4_4(NULL)
        
        SelCountyPoly_SHP_MapVis2_1(NULL)
        SelCountyPoly_SHP_MapVis2_2(NULL)
        SelCountyPoly_SHP_MapVis3_1(NULL)
        SelCountyPoly_SHP_MapVis3_2(NULL)
        SelCountyPoly_SHP_MapVis3_3(NULL)
        SelCountyPoly_SHP_MapVis4_1(NULL)
        SelCountyPoly_SHP_MapVis4_2(NULL)
        SelCountyPoly_SHP_MapVis4_3(NULL)
        SelCountyPoly_SHP_MapVis4_4(NULL)
        
        SelCountyPoints_SHP_MapVis2_1(NULL)
        SelCountyPoints_SHP_MapVis2_2(NULL)
        SelCountyPoints_SHP_MapVis3_1(NULL)
        SelCountyPoints_SHP_MapVis3_2(NULL)
        SelCountyPoints_SHP_MapVis3_3(NULL)
        SelCountyPoints_SHP_MapVis4_1(NULL)
        SelCountyPoints_SHP_MapVis4_2(NULL)
        SelCountyPoints_SHP_MapVis4_3(NULL)
        SelCountyPoints_SHP_MapVis4_4(NULL)
        
        SelCounties_Filtered_MapVis2_1(NULL)
        SelCounties_Filtered_MapVis2_2(NULL)
        SelCounties_Filtered_MapVis3_1(NULL)
        SelCounties_Filtered_MapVis3_2(NULL)
        SelCounties_Filtered_MapVis3_3(NULL)
        SelCounties_Filtered_MapVis4_1(NULL)
        SelCounties_Filtered_MapVis4_2(NULL)
        SelCounties_Filtered_MapVis4_3(NULL)
        SelCounties_Filtered_MapVis4_4(NULL)
    
        Sel_SurveysMap_Vis_2_1_UL(NULL)
        Sel_SurveysMap_Vis_2_2_UL(NULL)
        Sel_SurveysMap_Vis_3_1_UL(NULL)
        Sel_SurveysMap_Vis_3_2_UL(NULL)
        Sel_SurveysMap_Vis_3_3_UL(NULL)
        Sel_SurveysMap_Vis_4_1_UL(NULL)
        Sel_SurveysMap_Vis_4_2_UL(NULL)
        Sel_SurveysMap_Vis_4_3_UL(NULL)
        Sel_SurveysMap_Vis_4_4_UL(NULL)
        
        Sel_SurveysAll_Vis_2_1_UL(NULL)
        Sel_SurveysAll_Vis_2_2_UL(NULL)
        Sel_SurveysAll_Vis_3_1_UL(NULL)
        Sel_SurveysAll_Vis_3_2_UL(NULL)
        Sel_SurveysAll_Vis_3_3_UL(NULL)
        Sel_SurveysAll_Vis_4_1_UL(NULL)
        Sel_SurveysAll_Vis_4_2_UL(NULL)
        Sel_SurveysAll_Vis_4_3_UL(NULL)
        Sel_SurveysAll_Vis_4_4_UL(NULL)
        
        Data_2_1_Selected(NULL)
        Data_2_2_Selected(NULL)
        Data_3_1_Selected(NULL)
        Data_3_2_Selected(NULL)
        Data_3_3_Selected(NULL)
        Data_4_1_Selected(NULL)
        Data_4_2_Selected(NULL)
        Data_4_3_Selected(NULL)
        Data_4_4_Selected(NULL)
        },ignoreInit=TRUE)     
    
    observeEvent(c(
      input$Vis1_SelectCounty),
      {
        req(input$Vis1_SelectCounty=="Clear")
        req(input$Vis1_SelectType=="Counties")
        req(input$AF_LinkedSelection=='Yes')
        
        HighlightTrace_2Vis(NULL)
        All_SelectedWB_2Vis(NULL)
        HighlightTrace_3Vis(NULL)
        All_SelectedWB_3Vis(NULL)
        HighlightTrace_4Vis(NULL)
        All_SelectedWB_4Vis(NULL)
        Sel_SurveysScatter_Vis_2_1_UL(NULL)
        Sel_SurveysScatter_Vis_3_1_UL(NULL)
        Sel_SurveysScatter_Vis_4_1_UL(NULL)
        Sel_SurveysScatter_Vis_2_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_2_UL(NULL)
        Sel_SurveysScatter_Vis_4_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_4_UL(NULL) 
        HighlightTrace_Vis_2_1(NULL) 
        HighlightTrace_Vis_2_2(NULL) 
        HighlightTrace_Vis_3_1(NULL)
        HighlightTrace_Vis_3_2(NULL)
        HighlightTrace_Vis_3_3(NULL)
        HighlightTrace_Vis_4_1(NULL)
        HighlightTrace_Vis_4_2(NULL)
        HighlightTrace_Vis_4_3(NULL)
        HighlightTrace_Vis_4_4(NULL)
        MapVis2_1_SelectedWB_SHP(NULL)
        MapVis2_2_SelectedWB_SHP(NULL)
        MapVis3_1_SelectedWB_SHP(NULL)
        MapVis3_2_SelectedWB_SHP(NULL)
        MapVis3_3_SelectedWB_SHP(NULL)
        MapVis4_1_SelectedWB_SHP(NULL)
        MapVis4_2_SelectedWB_SHP(NULL)
        MapVis4_3_SelectedWB_SHP(NULL)
        MapVis4_4_SelectedWB_SHP(NULL)
        MapVis2_1_area$mp<-NULL
        MapVis2_2_area$mp<-NULL
        MapVis3_1_area$mp<-NULL
        MapVis3_2_area$mp<-NULL
        MapVis3_3_area$mp<-NULL
        MapVis4_1_area$mp<-NULL
        MapVis4_2_area$mp<-NULL
        MapVis4_3_area$mp<-NULL
        MapVis4_4_area$mp<-NULL
        Poly_SHP_MapVis2_1(NULL)
        Poly_SHP_MapVis2_2(NULL)
        Poly_SHP_MapVis3_1(NULL)
        Poly_SHP_MapVis3_2(NULL)
        Poly_SHP_MapVis3_3(NULL)
        Poly_SHP_MapVis4_1(NULL)
        Poly_SHP_MapVis4_2(NULL)
        Poly_SHP_MapVis4_3(NULL)
        Poly_SHP_MapVis4_4(NULL)
        
        State_Clicks_MapVis2_1(NULL)
        State_Clicks_MapVis2_2(NULL)
        State_Clicks_MapVis3_1(NULL)
        State_Clicks_MapVis3_2(NULL)
        State_Clicks_MapVis3_3(NULL)
        State_Clicks_MapVis4_1(NULL)
        State_Clicks_MapVis4_2(NULL)
        State_Clicks_MapVis4_3(NULL)
        State_Clicks_MapVis4_4(NULL)
        
        SelStatePoly_SHP_MapVis2_1(NULL)
        SelStatePoly_SHP_MapVis2_2(NULL)
        SelStatePoly_SHP_MapVis3_1(NULL)
        SelStatePoly_SHP_MapVis3_2(NULL)
        SelStatePoly_SHP_MapVis3_3(NULL)
        SelStatePoly_SHP_MapVis4_1(NULL)
        SelStatePoly_SHP_MapVis4_2(NULL)
        SelStatePoly_SHP_MapVis4_3(NULL)
        SelStatePoly_SHP_MapVis4_4(NULL)
    
        
        SelStatePoints_SHP_MapVis2_1(NULL)
        SelStatePoints_SHP_MapVis2_2(NULL)
        SelStatePoints_SHP_MapVis3_1(NULL)
        SelStatePoints_SHP_MapVis3_2(NULL)
        SelStatePoints_SHP_MapVis3_3(NULL)
        SelStatePoints_SHP_MapVis4_1(NULL)
        SelStatePoints_SHP_MapVis4_2(NULL)
        SelStatePoints_SHP_MapVis4_3(NULL)
        SelStatePoints_SHP_MapVis4_4(NULL)
        
        SelStates_Filtered_MapVis2_1(NULL)
        SelStates_Filtered_MapVis2_2(NULL)
        SelStates_Filtered_MapVis3_1(NULL)
        SelStates_Filtered_MapVis3_2(NULL)
        SelStates_Filtered_MapVis3_3(NULL)
        SelStates_Filtered_MapVis4_1(NULL)
        SelStates_Filtered_MapVis4_2(NULL)
        SelStates_Filtered_MapVis4_3(NULL)
        SelStates_Filtered_MapVis4_4(NULL)

    
        
        County_Clicks_MapVis2_1(NULL)
        County_Clicks_MapVis2_2(NULL)
        County_Clicks_MapVis3_1(NULL)
        County_Clicks_MapVis3_2(NULL)
        County_Clicks_MapVis3_3(NULL)
        County_Clicks_MapVis4_1(NULL)
        County_Clicks_MapVis4_2(NULL)
        County_Clicks_MapVis4_3(NULL)
        County_Clicks_MapVis4_4(NULL)
        
        SelCountyPoly_SHP_MapVis2_1(NULL)
        SelCountyPoly_SHP_MapVis2_2(NULL)
        SelCountyPoly_SHP_MapVis3_1(NULL)
        SelCountyPoly_SHP_MapVis3_2(NULL)
        SelCountyPoly_SHP_MapVis3_3(NULL)
        SelCountyPoly_SHP_MapVis4_1(NULL)
        SelCountyPoly_SHP_MapVis4_2(NULL)
        SelCountyPoly_SHP_MapVis4_3(NULL)
        SelCountyPoly_SHP_MapVis4_4(NULL)
        
        SelCountyPoints_SHP_MapVis2_1(NULL)
        SelCountyPoints_SHP_MapVis2_2(NULL)
        SelCountyPoints_SHP_MapVis3_1(NULL)
        SelCountyPoints_SHP_MapVis3_2(NULL)
        SelCountyPoints_SHP_MapVis3_3(NULL)
        SelCountyPoints_SHP_MapVis4_1(NULL)
        SelCountyPoints_SHP_MapVis4_2(NULL)
        SelCountyPoints_SHP_MapVis4_3(NULL)
        SelCountyPoints_SHP_MapVis4_4(NULL)
        
        SelCounties_Filtered_MapVis2_1(NULL)
        SelCounties_Filtered_MapVis2_2(NULL)
        SelCounties_Filtered_MapVis3_1(NULL)
        SelCounties_Filtered_MapVis3_2(NULL)
        SelCounties_Filtered_MapVis3_3(NULL)
        SelCounties_Filtered_MapVis4_1(NULL)
        SelCounties_Filtered_MapVis4_2(NULL)
        SelCounties_Filtered_MapVis4_3(NULL)
        SelCounties_Filtered_MapVis4_4(NULL)
    
        Sel_SurveysMap_Vis_2_1_UL(NULL)
        Sel_SurveysMap_Vis_2_2_UL(NULL)
        Sel_SurveysMap_Vis_3_1_UL(NULL)
        Sel_SurveysMap_Vis_3_2_UL(NULL)
        Sel_SurveysMap_Vis_3_3_UL(NULL)
        Sel_SurveysMap_Vis_4_1_UL(NULL)
        Sel_SurveysMap_Vis_4_2_UL(NULL)
        Sel_SurveysMap_Vis_4_3_UL(NULL)
        Sel_SurveysMap_Vis_4_4_UL(NULL)
        
        Sel_SurveysAll_Vis_2_1_UL(NULL)
        Sel_SurveysAll_Vis_2_2_UL(NULL)
        Sel_SurveysAll_Vis_3_1_UL(NULL)
        Sel_SurveysAll_Vis_3_2_UL(NULL)
        Sel_SurveysAll_Vis_3_3_UL(NULL)
        Sel_SurveysAll_Vis_4_1_UL(NULL)
        Sel_SurveysAll_Vis_4_2_UL(NULL)
        Sel_SurveysAll_Vis_4_3_UL(NULL)
        Sel_SurveysAll_Vis_4_4_UL(NULL)
        
        Data_2_1_Selected(NULL)
        Data_2_2_Selected(NULL)
        Data_3_1_Selected(NULL)
        Data_3_2_Selected(NULL)
        Data_3_3_Selected(NULL)
        Data_4_1_Selected(NULL)
        Data_4_2_Selected(NULL)
        Data_4_3_Selected(NULL)
        Data_4_4_Selected(NULL)
        },ignoreInit=TRUE)       
    
    observeEvent(c(
      input$Vis2_SelectCounty),
      {
        req(input$Vis2_SelectCounty=="Clear")
        req(input$Vis2_SelectType=="Counties")
        req(input$AF_LinkedSelection=='Yes')
        
        HighlightTrace_2Vis(NULL)
        All_SelectedWB_2Vis(NULL)
        HighlightTrace_3Vis(NULL)
        All_SelectedWB_3Vis(NULL)
        HighlightTrace_4Vis(NULL)
        All_SelectedWB_4Vis(NULL)
        Sel_SurveysScatter_Vis_2_1_UL(NULL)
        Sel_SurveysScatter_Vis_3_1_UL(NULL)
        Sel_SurveysScatter_Vis_4_1_UL(NULL)
        Sel_SurveysScatter_Vis_2_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_2_UL(NULL)
        Sel_SurveysScatter_Vis_4_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_4_UL(NULL) 
        HighlightTrace_Vis_2_1(NULL) 
        HighlightTrace_Vis_2_2(NULL) 
        HighlightTrace_Vis_3_1(NULL)
        HighlightTrace_Vis_3_2(NULL)
        HighlightTrace_Vis_3_3(NULL)
        HighlightTrace_Vis_4_1(NULL)
        HighlightTrace_Vis_4_2(NULL)
        HighlightTrace_Vis_4_3(NULL)
        HighlightTrace_Vis_4_4(NULL)
        MapVis2_1_SelectedWB_SHP(NULL)
        MapVis2_2_SelectedWB_SHP(NULL)
        MapVis3_1_SelectedWB_SHP(NULL)
        MapVis3_2_SelectedWB_SHP(NULL)
        MapVis3_3_SelectedWB_SHP(NULL)
        MapVis4_1_SelectedWB_SHP(NULL)
        MapVis4_2_SelectedWB_SHP(NULL)
        MapVis4_3_SelectedWB_SHP(NULL)
        MapVis4_4_SelectedWB_SHP(NULL)
        MapVis2_1_area$mp<-NULL
        MapVis2_2_area$mp<-NULL
        MapVis3_1_area$mp<-NULL
        MapVis3_2_area$mp<-NULL
        MapVis3_3_area$mp<-NULL
        MapVis4_1_area$mp<-NULL
        MapVis4_2_area$mp<-NULL
        MapVis4_3_area$mp<-NULL
        MapVis4_4_area$mp<-NULL
        Poly_SHP_MapVis2_1(NULL)
        Poly_SHP_MapVis2_2(NULL)
        Poly_SHP_MapVis3_1(NULL)
        Poly_SHP_MapVis3_2(NULL)
        Poly_SHP_MapVis3_3(NULL)
        Poly_SHP_MapVis4_1(NULL)
        Poly_SHP_MapVis4_2(NULL)
        Poly_SHP_MapVis4_3(NULL)
        Poly_SHP_MapVis4_4(NULL)
        
        State_Clicks_MapVis2_1(NULL)
        State_Clicks_MapVis2_2(NULL)
        State_Clicks_MapVis3_1(NULL)
        State_Clicks_MapVis3_2(NULL)
        State_Clicks_MapVis3_3(NULL)
        State_Clicks_MapVis4_1(NULL)
        State_Clicks_MapVis4_2(NULL)
        State_Clicks_MapVis4_3(NULL)
        State_Clicks_MapVis4_4(NULL)
        
        SelStatePoly_SHP_MapVis2_1(NULL)
        SelStatePoly_SHP_MapVis2_2(NULL)
        SelStatePoly_SHP_MapVis3_1(NULL)
        SelStatePoly_SHP_MapVis3_2(NULL)
        SelStatePoly_SHP_MapVis3_3(NULL)
        SelStatePoly_SHP_MapVis4_1(NULL)
        SelStatePoly_SHP_MapVis4_2(NULL)
        SelStatePoly_SHP_MapVis4_3(NULL)
        SelStatePoly_SHP_MapVis4_4(NULL)
    
        
        SelStatePoints_SHP_MapVis2_1(NULL)
        SelStatePoints_SHP_MapVis2_2(NULL)
        SelStatePoints_SHP_MapVis3_1(NULL)
        SelStatePoints_SHP_MapVis3_2(NULL)
        SelStatePoints_SHP_MapVis3_3(NULL)
        SelStatePoints_SHP_MapVis4_1(NULL)
        SelStatePoints_SHP_MapVis4_2(NULL)
        SelStatePoints_SHP_MapVis4_3(NULL)
        SelStatePoints_SHP_MapVis4_4(NULL)
        
        SelStates_Filtered_MapVis2_1(NULL)
        SelStates_Filtered_MapVis2_2(NULL)
        SelStates_Filtered_MapVis3_1(NULL)
        SelStates_Filtered_MapVis3_2(NULL)
        SelStates_Filtered_MapVis3_3(NULL)
        SelStates_Filtered_MapVis4_1(NULL)
        SelStates_Filtered_MapVis4_2(NULL)
        SelStates_Filtered_MapVis4_3(NULL)
        SelStates_Filtered_MapVis4_4(NULL)

    
        
        County_Clicks_MapVis2_1(NULL)
        County_Clicks_MapVis2_2(NULL)
        County_Clicks_MapVis3_1(NULL)
        County_Clicks_MapVis3_2(NULL)
        County_Clicks_MapVis3_3(NULL)
        County_Clicks_MapVis4_1(NULL)
        County_Clicks_MapVis4_2(NULL)
        County_Clicks_MapVis4_3(NULL)
        County_Clicks_MapVis4_4(NULL)
        
        SelCountyPoly_SHP_MapVis2_1(NULL)
        SelCountyPoly_SHP_MapVis2_2(NULL)
        SelCountyPoly_SHP_MapVis3_1(NULL)
        SelCountyPoly_SHP_MapVis3_2(NULL)
        SelCountyPoly_SHP_MapVis3_3(NULL)
        SelCountyPoly_SHP_MapVis4_1(NULL)
        SelCountyPoly_SHP_MapVis4_2(NULL)
        SelCountyPoly_SHP_MapVis4_3(NULL)
        SelCountyPoly_SHP_MapVis4_4(NULL)
        
        SelCountyPoints_SHP_MapVis2_1(NULL)
        SelCountyPoints_SHP_MapVis2_2(NULL)
        SelCountyPoints_SHP_MapVis3_1(NULL)
        SelCountyPoints_SHP_MapVis3_2(NULL)
        SelCountyPoints_SHP_MapVis3_3(NULL)
        SelCountyPoints_SHP_MapVis4_1(NULL)
        SelCountyPoints_SHP_MapVis4_2(NULL)
        SelCountyPoints_SHP_MapVis4_3(NULL)
        SelCountyPoints_SHP_MapVis4_4(NULL)
        
        SelCounties_Filtered_MapVis2_1(NULL)
        SelCounties_Filtered_MapVis2_2(NULL)
        SelCounties_Filtered_MapVis3_1(NULL)
        SelCounties_Filtered_MapVis3_2(NULL)
        SelCounties_Filtered_MapVis3_3(NULL)
        SelCounties_Filtered_MapVis4_1(NULL)
        SelCounties_Filtered_MapVis4_2(NULL)
        SelCounties_Filtered_MapVis4_3(NULL)
        SelCounties_Filtered_MapVis4_4(NULL)
    
        Sel_SurveysMap_Vis_2_1_UL(NULL)
        Sel_SurveysMap_Vis_2_2_UL(NULL)
        Sel_SurveysMap_Vis_3_1_UL(NULL)
        Sel_SurveysMap_Vis_3_2_UL(NULL)
        Sel_SurveysMap_Vis_3_3_UL(NULL)
        Sel_SurveysMap_Vis_4_1_UL(NULL)
        Sel_SurveysMap_Vis_4_2_UL(NULL)
        Sel_SurveysMap_Vis_4_3_UL(NULL)
        Sel_SurveysMap_Vis_4_4_UL(NULL)
        
        Sel_SurveysAll_Vis_2_1_UL(NULL)
        Sel_SurveysAll_Vis_2_2_UL(NULL)
        Sel_SurveysAll_Vis_3_1_UL(NULL)
        Sel_SurveysAll_Vis_3_2_UL(NULL)
        Sel_SurveysAll_Vis_3_3_UL(NULL)
        Sel_SurveysAll_Vis_4_1_UL(NULL)
        Sel_SurveysAll_Vis_4_2_UL(NULL)
        Sel_SurveysAll_Vis_4_3_UL(NULL)
        Sel_SurveysAll_Vis_4_4_UL(NULL)
        
        Data_2_1_Selected(NULL)
        Data_2_2_Selected(NULL)
        Data_3_1_Selected(NULL)
        Data_3_2_Selected(NULL)
        Data_3_3_Selected(NULL)
        Data_4_1_Selected(NULL)
        Data_4_2_Selected(NULL)
        Data_4_3_Selected(NULL)
        Data_4_4_Selected(NULL)
        },ignoreInit=TRUE)       
    
    observeEvent(c(
      input$Vis3_SelectCounty),
      {
        req(input$Vis3_SelectCounty=="Clear")
        req(input$Vis3_SelectType=="Counties")
        req(input$AF_LinkedSelection=='Yes')
        
        HighlightTrace_2Vis(NULL)
        All_SelectedWB_2Vis(NULL)
        HighlightTrace_3Vis(NULL)
        All_SelectedWB_3Vis(NULL)
        HighlightTrace_4Vis(NULL)
        All_SelectedWB_4Vis(NULL)
        Sel_SurveysScatter_Vis_2_1_UL(NULL)
        Sel_SurveysScatter_Vis_3_1_UL(NULL)
        Sel_SurveysScatter_Vis_4_1_UL(NULL)
        Sel_SurveysScatter_Vis_2_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_2_UL(NULL)
        Sel_SurveysScatter_Vis_4_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_4_UL(NULL) 
        HighlightTrace_Vis_2_1(NULL) 
        HighlightTrace_Vis_2_2(NULL) 
        HighlightTrace_Vis_3_1(NULL)
        HighlightTrace_Vis_3_2(NULL)
        HighlightTrace_Vis_3_3(NULL)
        HighlightTrace_Vis_4_1(NULL)
        HighlightTrace_Vis_4_2(NULL)
        HighlightTrace_Vis_4_3(NULL)
        HighlightTrace_Vis_4_4(NULL)
        MapVis2_1_SelectedWB_SHP(NULL)
        MapVis2_2_SelectedWB_SHP(NULL)
        MapVis3_1_SelectedWB_SHP(NULL)
        MapVis3_2_SelectedWB_SHP(NULL)
        MapVis3_3_SelectedWB_SHP(NULL)
        MapVis4_1_SelectedWB_SHP(NULL)
        MapVis4_2_SelectedWB_SHP(NULL)
        MapVis4_3_SelectedWB_SHP(NULL)
        MapVis4_4_SelectedWB_SHP(NULL)
        MapVis2_1_area$mp<-NULL
        MapVis2_2_area$mp<-NULL
        MapVis3_1_area$mp<-NULL
        MapVis3_2_area$mp<-NULL
        MapVis3_3_area$mp<-NULL
        MapVis4_1_area$mp<-NULL
        MapVis4_2_area$mp<-NULL
        MapVis4_3_area$mp<-NULL
        MapVis4_4_area$mp<-NULL
        Poly_SHP_MapVis2_1(NULL)
        Poly_SHP_MapVis2_2(NULL)
        Poly_SHP_MapVis3_1(NULL)
        Poly_SHP_MapVis3_2(NULL)
        Poly_SHP_MapVis3_3(NULL)
        Poly_SHP_MapVis4_1(NULL)
        Poly_SHP_MapVis4_2(NULL)
        Poly_SHP_MapVis4_3(NULL)
        Poly_SHP_MapVis4_4(NULL)
        
        State_Clicks_MapVis2_1(NULL)
        State_Clicks_MapVis2_2(NULL)
        State_Clicks_MapVis3_1(NULL)
        State_Clicks_MapVis3_2(NULL)
        State_Clicks_MapVis3_3(NULL)
        State_Clicks_MapVis4_1(NULL)
        State_Clicks_MapVis4_2(NULL)
        State_Clicks_MapVis4_3(NULL)
        State_Clicks_MapVis4_4(NULL)
        
        SelStatePoly_SHP_MapVis2_1(NULL)
        SelStatePoly_SHP_MapVis2_2(NULL)
        SelStatePoly_SHP_MapVis3_1(NULL)
        SelStatePoly_SHP_MapVis3_2(NULL)
        SelStatePoly_SHP_MapVis3_3(NULL)
        SelStatePoly_SHP_MapVis4_1(NULL)
        SelStatePoly_SHP_MapVis4_2(NULL)
        SelStatePoly_SHP_MapVis4_3(NULL)
        SelStatePoly_SHP_MapVis4_4(NULL)
    
        
        SelStatePoints_SHP_MapVis2_1(NULL)
        SelStatePoints_SHP_MapVis2_2(NULL)
        SelStatePoints_SHP_MapVis3_1(NULL)
        SelStatePoints_SHP_MapVis3_2(NULL)
        SelStatePoints_SHP_MapVis3_3(NULL)
        SelStatePoints_SHP_MapVis4_1(NULL)
        SelStatePoints_SHP_MapVis4_2(NULL)
        SelStatePoints_SHP_MapVis4_3(NULL)
        SelStatePoints_SHP_MapVis4_4(NULL)
        
        SelStates_Filtered_MapVis2_1(NULL)
        SelStates_Filtered_MapVis2_2(NULL)
        SelStates_Filtered_MapVis3_1(NULL)
        SelStates_Filtered_MapVis3_2(NULL)
        SelStates_Filtered_MapVis3_3(NULL)
        SelStates_Filtered_MapVis4_1(NULL)
        SelStates_Filtered_MapVis4_2(NULL)
        SelStates_Filtered_MapVis4_3(NULL)
        SelStates_Filtered_MapVis4_4(NULL)

    
        
        County_Clicks_MapVis2_1(NULL)
        County_Clicks_MapVis2_2(NULL)
        County_Clicks_MapVis3_1(NULL)
        County_Clicks_MapVis3_2(NULL)
        County_Clicks_MapVis3_3(NULL)
        County_Clicks_MapVis4_1(NULL)
        County_Clicks_MapVis4_2(NULL)
        County_Clicks_MapVis4_3(NULL)
        County_Clicks_MapVis4_4(NULL)
        
        SelCountyPoly_SHP_MapVis2_1(NULL)
        SelCountyPoly_SHP_MapVis2_2(NULL)
        SelCountyPoly_SHP_MapVis3_1(NULL)
        SelCountyPoly_SHP_MapVis3_2(NULL)
        SelCountyPoly_SHP_MapVis3_3(NULL)
        SelCountyPoly_SHP_MapVis4_1(NULL)
        SelCountyPoly_SHP_MapVis4_2(NULL)
        SelCountyPoly_SHP_MapVis4_3(NULL)
        SelCountyPoly_SHP_MapVis4_4(NULL)
        
        SelCountyPoints_SHP_MapVis2_1(NULL)
        SelCountyPoints_SHP_MapVis2_2(NULL)
        SelCountyPoints_SHP_MapVis3_1(NULL)
        SelCountyPoints_SHP_MapVis3_2(NULL)
        SelCountyPoints_SHP_MapVis3_3(NULL)
        SelCountyPoints_SHP_MapVis4_1(NULL)
        SelCountyPoints_SHP_MapVis4_2(NULL)
        SelCountyPoints_SHP_MapVis4_3(NULL)
        SelCountyPoints_SHP_MapVis4_4(NULL)
        
        SelCounties_Filtered_MapVis2_1(NULL)
        SelCounties_Filtered_MapVis2_2(NULL)
        SelCounties_Filtered_MapVis3_1(NULL)
        SelCounties_Filtered_MapVis3_2(NULL)
        SelCounties_Filtered_MapVis3_3(NULL)
        SelCounties_Filtered_MapVis4_1(NULL)
        SelCounties_Filtered_MapVis4_2(NULL)
        SelCounties_Filtered_MapVis4_3(NULL)
        SelCounties_Filtered_MapVis4_4(NULL)
    
        Sel_SurveysMap_Vis_2_1_UL(NULL)
        Sel_SurveysMap_Vis_2_2_UL(NULL)
        Sel_SurveysMap_Vis_3_1_UL(NULL)
        Sel_SurveysMap_Vis_3_2_UL(NULL)
        Sel_SurveysMap_Vis_3_3_UL(NULL)
        Sel_SurveysMap_Vis_4_1_UL(NULL)
        Sel_SurveysMap_Vis_4_2_UL(NULL)
        Sel_SurveysMap_Vis_4_3_UL(NULL)
        Sel_SurveysMap_Vis_4_4_UL(NULL)
        
        Sel_SurveysAll_Vis_2_1_UL(NULL)
        Sel_SurveysAll_Vis_2_2_UL(NULL)
        Sel_SurveysAll_Vis_3_1_UL(NULL)
        Sel_SurveysAll_Vis_3_2_UL(NULL)
        Sel_SurveysAll_Vis_3_3_UL(NULL)
        Sel_SurveysAll_Vis_4_1_UL(NULL)
        Sel_SurveysAll_Vis_4_2_UL(NULL)
        Sel_SurveysAll_Vis_4_3_UL(NULL)
        Sel_SurveysAll_Vis_4_4_UL(NULL)
        
        Data_2_1_Selected(NULL)
        Data_2_2_Selected(NULL)
        Data_3_1_Selected(NULL)
        Data_3_2_Selected(NULL)
        Data_3_3_Selected(NULL)
        Data_4_1_Selected(NULL)
        Data_4_2_Selected(NULL)
        Data_4_3_Selected(NULL)
        Data_4_4_Selected(NULL)
        },ignoreInit=TRUE)       
    
    observeEvent(c(
      input$Vis4_SelectCounty),
      {
        req(input$Vis4_SelectCounty=="Clear")
        req(input$Vis4_SelectType=="Counties")
        req(input$AF_LinkedSelection=='Yes')
        
        HighlightTrace_2Vis(NULL)
        All_SelectedWB_2Vis(NULL)
        HighlightTrace_3Vis(NULL)
        All_SelectedWB_3Vis(NULL)
        HighlightTrace_4Vis(NULL)
        All_SelectedWB_4Vis(NULL)
        Sel_SurveysScatter_Vis_2_1_UL(NULL)
        Sel_SurveysScatter_Vis_3_1_UL(NULL)
        Sel_SurveysScatter_Vis_4_1_UL(NULL)
        Sel_SurveysScatter_Vis_2_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_2_UL(NULL)
        Sel_SurveysScatter_Vis_4_2_UL(NULL)
        Sel_SurveysScatter_Vis_3_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_3_UL(NULL)
        Sel_SurveysScatter_Vis_4_4_UL(NULL) 
        HighlightTrace_Vis_2_1(NULL) 
        HighlightTrace_Vis_2_2(NULL) 
        HighlightTrace_Vis_3_1(NULL)
        HighlightTrace_Vis_3_2(NULL)
        HighlightTrace_Vis_3_3(NULL)
        HighlightTrace_Vis_4_1(NULL)
        HighlightTrace_Vis_4_2(NULL)
        HighlightTrace_Vis_4_3(NULL)
        HighlightTrace_Vis_4_4(NULL)
        MapVis2_1_SelectedWB_SHP(NULL)
        MapVis2_2_SelectedWB_SHP(NULL)
        MapVis3_1_SelectedWB_SHP(NULL)
        MapVis3_2_SelectedWB_SHP(NULL)
        MapVis3_3_SelectedWB_SHP(NULL)
        MapVis4_1_SelectedWB_SHP(NULL)
        MapVis4_2_SelectedWB_SHP(NULL)
        MapVis4_3_SelectedWB_SHP(NULL)
        MapVis4_4_SelectedWB_SHP(NULL)
        MapVis2_1_area$mp<-NULL
        MapVis2_2_area$mp<-NULL
        MapVis3_1_area$mp<-NULL
        MapVis3_2_area$mp<-NULL
        MapVis3_3_area$mp<-NULL
        MapVis4_1_area$mp<-NULL
        MapVis4_2_area$mp<-NULL
        MapVis4_3_area$mp<-NULL
        MapVis4_4_area$mp<-NULL
        Poly_SHP_MapVis2_1(NULL)
        Poly_SHP_MapVis2_2(NULL)
        Poly_SHP_MapVis3_1(NULL)
        Poly_SHP_MapVis3_2(NULL)
        Poly_SHP_MapVis3_3(NULL)
        Poly_SHP_MapVis4_1(NULL)
        Poly_SHP_MapVis4_2(NULL)
        Poly_SHP_MapVis4_3(NULL)
        Poly_SHP_MapVis4_4(NULL)
        
        State_Clicks_MapVis2_1(NULL)
        State_Clicks_MapVis2_2(NULL)
        State_Clicks_MapVis3_1(NULL)
        State_Clicks_MapVis3_2(NULL)
        State_Clicks_MapVis3_3(NULL)
        State_Clicks_MapVis4_1(NULL)
        State_Clicks_MapVis4_2(NULL)
        State_Clicks_MapVis4_3(NULL)
        State_Clicks_MapVis4_4(NULL)
        
        SelStatePoly_SHP_MapVis2_1(NULL)
        SelStatePoly_SHP_MapVis2_2(NULL)
        SelStatePoly_SHP_MapVis3_1(NULL)
        SelStatePoly_SHP_MapVis3_2(NULL)
        SelStatePoly_SHP_MapVis3_3(NULL)
        SelStatePoly_SHP_MapVis4_1(NULL)
        SelStatePoly_SHP_MapVis4_2(NULL)
        SelStatePoly_SHP_MapVis4_3(NULL)
        SelStatePoly_SHP_MapVis4_4(NULL)
    
        
        SelStatePoints_SHP_MapVis2_1(NULL)
        SelStatePoints_SHP_MapVis2_2(NULL)
        SelStatePoints_SHP_MapVis3_1(NULL)
        SelStatePoints_SHP_MapVis3_2(NULL)
        SelStatePoints_SHP_MapVis3_3(NULL)
        SelStatePoints_SHP_MapVis4_1(NULL)
        SelStatePoints_SHP_MapVis4_2(NULL)
        SelStatePoints_SHP_MapVis4_3(NULL)
        SelStatePoints_SHP_MapVis4_4(NULL)
        
        SelStates_Filtered_MapVis2_1(NULL)
        SelStates_Filtered_MapVis2_2(NULL)
        SelStates_Filtered_MapVis3_1(NULL)
        SelStates_Filtered_MapVis3_2(NULL)
        SelStates_Filtered_MapVis3_3(NULL)
        SelStates_Filtered_MapVis4_1(NULL)
        SelStates_Filtered_MapVis4_2(NULL)
        SelStates_Filtered_MapVis4_3(NULL)
        SelStates_Filtered_MapVis4_4(NULL)

    
        
        County_Clicks_MapVis2_1(NULL)
        County_Clicks_MapVis2_2(NULL)
        County_Clicks_MapVis3_1(NULL)
        County_Clicks_MapVis3_2(NULL)
        County_Clicks_MapVis3_3(NULL)
        County_Clicks_MapVis4_1(NULL)
        County_Clicks_MapVis4_2(NULL)
        County_Clicks_MapVis4_3(NULL)
        County_Clicks_MapVis4_4(NULL)
        
        SelCountyPoly_SHP_MapVis2_1(NULL)
        SelCountyPoly_SHP_MapVis2_2(NULL)
        SelCountyPoly_SHP_MapVis3_1(NULL)
        SelCountyPoly_SHP_MapVis3_2(NULL)
        SelCountyPoly_SHP_MapVis3_3(NULL)
        SelCountyPoly_SHP_MapVis4_1(NULL)
        SelCountyPoly_SHP_MapVis4_2(NULL)
        SelCountyPoly_SHP_MapVis4_3(NULL)
        SelCountyPoly_SHP_MapVis4_4(NULL)
        
        SelCountyPoints_SHP_MapVis2_1(NULL)
        SelCountyPoints_SHP_MapVis2_2(NULL)
        SelCountyPoints_SHP_MapVis3_1(NULL)
        SelCountyPoints_SHP_MapVis3_2(NULL)
        SelCountyPoints_SHP_MapVis3_3(NULL)
        SelCountyPoints_SHP_MapVis4_1(NULL)
        SelCountyPoints_SHP_MapVis4_2(NULL)
        SelCountyPoints_SHP_MapVis4_3(NULL)
        SelCountyPoints_SHP_MapVis4_4(NULL)
        
        SelCounties_Filtered_MapVis2_1(NULL)
        SelCounties_Filtered_MapVis2_2(NULL)
        SelCounties_Filtered_MapVis3_1(NULL)
        SelCounties_Filtered_MapVis3_2(NULL)
        SelCounties_Filtered_MapVis3_3(NULL)
        SelCounties_Filtered_MapVis4_1(NULL)
        SelCounties_Filtered_MapVis4_2(NULL)
        SelCounties_Filtered_MapVis4_3(NULL)
        SelCounties_Filtered_MapVis4_4(NULL)
    
      
        Sel_SurveysMap_Vis_2_1_UL(NULL)
        Sel_SurveysMap_Vis_2_2_UL(NULL)
        Sel_SurveysMap_Vis_3_1_UL(NULL)
        Sel_SurveysMap_Vis_3_2_UL(NULL)
        Sel_SurveysMap_Vis_3_3_UL(NULL)
        Sel_SurveysMap_Vis_4_1_UL(NULL)
        Sel_SurveysMap_Vis_4_2_UL(NULL)
        Sel_SurveysMap_Vis_4_3_UL(NULL)
        Sel_SurveysMap_Vis_4_4_UL(NULL)
        
        Sel_SurveysAll_Vis_2_1_UL(NULL)
        Sel_SurveysAll_Vis_2_2_UL(NULL)
        Sel_SurveysAll_Vis_3_1_UL(NULL)
        Sel_SurveysAll_Vis_3_2_UL(NULL)
        Sel_SurveysAll_Vis_3_3_UL(NULL)
        Sel_SurveysAll_Vis_4_1_UL(NULL)
        Sel_SurveysAll_Vis_4_2_UL(NULL)
        Sel_SurveysAll_Vis_4_3_UL(NULL)
        Sel_SurveysAll_Vis_4_4_UL(NULL)
        
        Data_2_1_Selected(NULL)
        Data_2_2_Selected(NULL)
        Data_3_1_Selected(NULL)
        Data_3_2_Selected(NULL)
        Data_3_3_Selected(NULL)
        Data_4_1_Selected(NULL)
        Data_4_2_Selected(NULL)
        Data_4_3_Selected(NULL)
        Data_4_4_Selected(NULL)
        },ignoreInit=TRUE)           
    
    

#### Unlinked Selection ####
    
    Sel_SurveysScatter_Vis_1_1_UL<-reactiveVal(NULL)
    Sel_SurveysBar_Vis_1_1_UL<-reactiveVal(NULL)
    Sel_SurveysLine_Vis_1_1_UL<-reactiveVal(NULL)
    Sel_SurveysMap_Vis_1_1_UL<-reactiveVal(NULL)
    Sel_SurveysAll_Vis_1_1_UL<-reactiveVal(NULL)
    
    Sel_SurveysScatter_Vis_2_1_UL<-reactiveVal(NULL)
    Sel_SurveysBar_Vis_2_1_UL<-reactiveVal(NULL)
    Sel_SurveysLine_Vis_2_1_UL<-reactiveVal(NULL)
    Sel_SurveysMap_Vis_2_1_UL<-reactiveVal(NULL)
    Sel_SurveysAll_Vis_2_1_UL<-reactiveVal(NULL)
    
    Sel_SurveysScatter_Vis_3_1_UL<-reactiveVal(NULL)
    Sel_SurveysBar_Vis_3_1_UL<-reactiveVal(NULL)
    Sel_SurveysLine_Vis_3_1_UL<-reactiveVal(NULL)
    Sel_SurveysMap_Vis_3_1_UL<-reactiveVal(NULL)
    Sel_SurveysAll_Vis_3_1_UL<-reactiveVal(NULL)
    
    Sel_SurveysScatter_Vis_4_1_UL<-reactiveVal(NULL)
    Sel_SurveysBar_Vis_4_1_UL<-reactiveVal(NULL)
    Sel_SurveysLine_Vis_4_1_UL<-reactiveVal(NULL)
    Sel_SurveysMap_Vis_4_1_UL<-reactiveVal(NULL)
    Sel_SurveysAll_Vis_4_1_UL<-reactiveVal(NULL)
    
    Sel_SurveysScatter_Vis_2_2_UL<-reactiveVal(NULL)
    Sel_SurveysBar_Vis_2_2_UL<-reactiveVal(NULL)
    Sel_SurveysLine_Vis_2_2_UL<-reactiveVal(NULL)
    Sel_SurveysMap_Vis_2_2_UL<-reactiveVal(NULL)
    Sel_SurveysAll_Vis_2_2_UL<-reactiveVal(NULL)
    
    Sel_SurveysScatter_Vis_3_2_UL<-reactiveVal(NULL)
    Sel_SurveysBar_Vis_3_2_UL<-reactiveVal(NULL)
    Sel_SurveysLine_Vis_3_2_UL<-reactiveVal(NULL)
    Sel_SurveysMap_Vis_3_2_UL<-reactiveVal(NULL)
    Sel_SurveysAll_Vis_3_2_UL<-reactiveVal(NULL)
    
    Sel_SurveysScatter_Vis_4_2_UL<-reactiveVal(NULL)
    Sel_SurveysBar_Vis_4_2_UL<-reactiveVal(NULL)
    Sel_SurveysLine_Vis_4_2_UL<-reactiveVal(NULL)
    Sel_SurveysMap_Vis_4_2_UL<-reactiveVal(NULL)
    Sel_SurveysAll_Vis_4_2_UL<-reactiveVal(NULL)    

    Sel_SurveysScatter_Vis_3_3_UL<-reactiveVal(NULL)
    Sel_SurveysBar_Vis_3_3_UL<-reactiveVal(NULL)
    Sel_SurveysLine_Vis_3_3_UL<-reactiveVal(NULL)
    Sel_SurveysMap_Vis_3_3_UL<-reactiveVal(NULL)
    Sel_SurveysAll_Vis_3_3_UL<-reactiveVal(NULL)    
    
    Sel_SurveysScatter_Vis_4_3_UL<-reactiveVal(NULL)
    Sel_SurveysBar_Vis_4_3_UL<-reactiveVal(NULL)
    Sel_SurveysLine_Vis_4_3_UL<-reactiveVal(NULL)
    Sel_SurveysMap_Vis_4_3_UL<-reactiveVal(NULL)
    Sel_SurveysAll_Vis_4_3_UL<-reactiveVal(NULL) 

    Sel_SurveysScatter_Vis_4_4_UL<-reactiveVal(NULL)
    Sel_SurveysBar_Vis_4_4_UL<-reactiveVal(NULL)
    Sel_SurveysLine_Vis_4_4_UL<-reactiveVal(NULL)
    Sel_SurveysMap_Vis_4_4_UL<-reactiveVal(NULL)
    Sel_SurveysAll_Vis_4_4_UL<-reactiveVal(NULL)         
    
observeEvent(c(
      event_data(event=c("plotly_selected"), source="Vis_1_1_Scatter",priority=c("event"))
      ),{
        req(length(Data_1_1())>0)
        PH<-event_data("plotly_selected", source="Vis_1_1_Scatter", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)%>%
	        unnest(Survey_ID)
	  
	  
    Selected_SurveysScatter_Vis_1_1_UL<-left_join(PH,Data_1_1(),by=c("Survey_ID"="Survey_ID"))
      
  
    Sel_SurveysScatter_Vis_1_1_UL(Selected_SurveysScatter_Vis_1_1_UL)
    
    Sel_SurveysAll_Vis_1_1_UL(Selected_SurveysScatter_Vis_1_1_UL)
    
       }
	  ,ignoreInit=TRUE
	  ) 

    observeEvent(c(
      Vis_1_1_Scatter_Factor_Palette()
      ),{

      req(length(Sel_SurveysScatter_Vis_1_1_UL())>0)


	  PH<-Sel_SurveysScatter_Vis_1_1_UL()%>%
	         select(Survey_ID)


    Selected_SurveysScatter_Vis_1_1_UL<-left_join(PH,Data_1_1(),by=c("Survey_ID"="Survey_ID"))


    Sel_SurveysScatter_Vis_1_1_UL(Selected_SurveysScatter_Vis_1_1_UL)

    Sel_SurveysAll_Vis_1_1_UL(Selected_SurveysScatter_Vis_1_1_UL)

      }
	  ,ignoreInit=TRUE
	 	  )
    
    
observeEvent(c(
      event_data(event=c("plotly_selected"), source="Vis_2_1_Scatter",priority=c("event"))
      ),{
        
        req(length(Data_2_1_Complete())>0)
        
        PH<-event_data("plotly_selected", source="Vis_2_1_Scatter", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)%>%
	        unnest(Survey_ID)
	  
	  
    Selected_SurveysScatter_Vis_2_1_UL<-left_join(PH,Data_2_1_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_2_1_UL(Selected_SurveysScatter_Vis_2_1_UL)
    
    Sel_SurveysAll_Vis_2_1_UL(Selected_SurveysScatter_Vis_2_1_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_2_1_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
    
    HighlightTrace_2Vis(Selected_SurveysScatter_Vis_2_1_L)
   
    SelectedWB_2Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_2_1_L,by="Survey_ID")
    
    Selected_SurveysScatter_Vis_2_1_UL<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
    
    MapVis2_2_SelectedWB_SHP(SelectedWB_2Vis)
    }
      }
	  ,ignoreInit=TRUE
	  ) 





    observeEvent(c(
      Vis_2_1_Scatter_Factor_Palette()
      ),{
       
        
      if(input$AF_LinkedSelection=="Yes"){req(nrow(HighlightTrace_2Vis())>0)}
      else{req(length(Sel_SurveysScatter_Vis_2_1_UL())>0)} 

	  
	  PH<-if(input$AF_LinkedSelection=="No"){
	    Sel_SurveysScatter_Vis_2_1_UL()%>%
	         select(Survey_ID)
	    } else {
      HighlightTrace_2Vis()%>%
          select(Survey_ID)
      }
        
    Selected_SurveysScatter_Vis_2_1_UL<-left_join(PH,Data_2_1_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_2_1_UL(Selected_SurveysScatter_Vis_2_1_UL)
    
    Sel_SurveysAll_Vis_2_1_UL(Selected_SurveysScatter_Vis_2_1_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_2_1_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
    
    HighlightTrace_2Vis(Selected_SurveysScatter_Vis_2_1_L)
   
    SelectedWB_2Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_2_1_L,by="Survey_ID")
    
    MapVis2_2_SelectedWB_SHP(SelectedWB_2Vis)
    }
    
      }
	  ,ignoreInit=TRUE

	  )

observeEvent(c(
      event_data(event=c("plotly_selected"), source="Vis_3_1_Scatter",priority=c("event"))
      ),{
        
        req(length(Data_3_1_Complete())>0)
        
        PH<-event_data("plotly_selected", source="Vis_3_1_Scatter", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)%>%
	        unnest(Survey_ID)
	  
	  
    Selected_SurveysScatter_Vis_3_1_UL<-left_join(PH,Data_3_1_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_3_1_UL(Selected_SurveysScatter_Vis_3_1_UL)
    
    Sel_SurveysAll_Vis_3_1_UL(Selected_SurveysScatter_Vis_3_1_UL)
    
    if(input$AF_LinkedSelection=="Yes"){    
      
      
      Selected_SurveysScatter_Vis_3_1_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
      
    HighlightTrace_3Vis(Selected_SurveysScatter_Vis_3_1_L)
   
    SelectedWB_3Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_3_1_L,by="Survey_ID")
    
    MapVis3_2_SelectedWB_SHP(SelectedWB_3Vis)
    MapVis3_3_SelectedWB_SHP(SelectedWB_3Vis)
    }
      }
	  ,ignoreInit=TRUE
	  ) 



    observeEvent(c(
      Vis_3_1_Scatter_Factor_Palette()
      ),{
       
        
      if(input$AF_LinkedSelection=="Yes"){req(nrow(HighlightTrace_3Vis())>0)}
      else{req(length(Sel_SurveysScatter_Vis_3_1_UL())>0)} 

	  
	  PH<-if(input$AF_LinkedSelection=="No"){
	    Sel_SurveysScatter_Vis_3_1_UL()%>%
	         select(Survey_ID)
	    } else {
      HighlightTrace_3Vis()%>%
          select(Survey_ID)
      }
        
    Selected_SurveysScatter_Vis_3_1_UL<-left_join(PH,Data_3_1_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_3_1_UL(Selected_SurveysScatter_Vis_3_1_UL)
    
    Sel_SurveysAll_Vis_3_1_UL(Selected_SurveysScatter_Vis_3_1_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_3_1_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
      
    HighlightTrace_3Vis(Selected_SurveysScatter_Vis_3_1_L)
   
    SelectedWB_3Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_3_1_L,by="Survey_ID")
    
    MapVis3_2_SelectedWB_SHP(SelectedWB_3Vis)
    MapVis3_3_SelectedWB_SHP(SelectedWB_3Vis)
    }
    
      }
	  ,ignoreInit=TRUE

	  )
    

observeEvent(c(
      event_data(event=c("plotly_selected"), source="Vis_4_1_Scatter",priority=c("event"))
      ),{
        
        req(length(Data_4_1_Complete())>0)
        
        PH<-event_data("plotly_selected", source="Vis_4_1_Scatter", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)%>%
	        unnest(Survey_ID)
	  
	  
    Selected_SurveysScatter_Vis_4_1_UL<-left_join(PH,Data_4_1_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_4_1_UL(Selected_SurveysScatter_Vis_4_1_UL)
    
    Sel_SurveysAll_Vis_4_1_UL(Selected_SurveysScatter_Vis_4_1_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_4_1_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
      
    HighlightTrace_4Vis(Selected_SurveysScatter_Vis_4_1_L)
   
    SelectedWB_4Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_4_1_L,by="Survey_ID")
    
    MapVis4_2_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_3_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_4_SelectedWB_SHP(SelectedWB_4Vis)
    }
      }
	  ,ignoreInit=TRUE
	  ) 



    observeEvent(c(
      Vis_4_1_Scatter_Factor_Palette()
      ),{
       
        
      if(input$AF_LinkedSelection=="Yes"){req(nrow(HighlightTrace_4Vis())>0)}
      else{req(length(Sel_SurveysScatter_Vis_4_1_UL())>0)} 

	  
	  PH<-if(input$AF_LinkedSelection=="No"){
	    Sel_SurveysScatter_Vis_4_1_UL()%>%
	         select(Survey_ID)
	    } else {
      HighlightTrace_4Vis()%>%
          select(Survey_ID)
      }
        
	  
    Selected_SurveysScatter_Vis_4_1_UL<-left_join(PH,Data_4_1_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_4_1_UL(Selected_SurveysScatter_Vis_4_1_UL)
    
    Sel_SurveysAll_Vis_4_1_UL(Selected_SurveysScatter_Vis_4_1_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_4_1_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
      
    HighlightTrace_4Vis(Selected_SurveysScatter_Vis_4_1_L)
   
    SelectedWB_4Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_4_1_L,by="Survey_ID")
    
    MapVis4_2_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_3_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_4_SelectedWB_SHP(SelectedWB_4Vis)
    
    }
    
      }
	  ,ignoreInit=TRUE
	  )

observeEvent(c(
      event_data(event=c("plotly_selected"), source="Vis_2_2_Scatter",priority=c("event"))
      ),{
        
        req(length(Data_2_2_Complete())>0)
        
        PH<-event_data("plotly_selected", source="Vis_2_2_Scatter", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)%>%
	        unnest(Survey_ID)
	  
	  
    Selected_SurveysScatter_Vis_2_2_UL<-left_join(PH,Data_2_2_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_2_2_UL(Selected_SurveysScatter_Vis_2_2_UL)
    
    Sel_SurveysAll_Vis_2_2_UL(Selected_SurveysScatter_Vis_2_2_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_2_2_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
      
    HighlightTrace_2Vis(Selected_SurveysScatter_Vis_2_2_L)
   
    SelectedWB_2Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_2_2_L,by="Survey_ID")
    
    MapVis2_1_SelectedWB_SHP(SelectedWB_2Vis)
    }
    
      }
	  ,ignoreInit=TRUE
	  
	  ) 



    observeEvent(c(
      Vis_2_2_Scatter_Factor_Palette()
      ),{
       
        
      if(input$AF_LinkedSelection=="Yes"){req(nrow(HighlightTrace_2Vis())>0)}
      else{req(length(Sel_SurveysScatter_Vis_2_2_UL())>0)} 

	  
	  PH<-if(input$AF_LinkedSelection=="No"){
	    Sel_SurveysScatter_Vis_2_2_UL()%>%
	         select(Survey_ID)
	    } else {
      HighlightTrace_2Vis()%>%
          select(Survey_ID)
      }
        
    Selected_SurveysScatter_Vis_2_2_UL<-left_join(PH,Data_2_2_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_2_2_UL(Selected_SurveysScatter_Vis_2_2_UL)
    
    Sel_SurveysAll_Vis_2_2_UL(Selected_SurveysScatter_Vis_2_2_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_2_2_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
      
    HighlightTrace_2Vis(Selected_SurveysScatter_Vis_2_2_L)
   
    SelectedWB_2Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_2_2_L,by="Survey_ID")
    
    MapVis2_1_SelectedWB_SHP(SelectedWB_2Vis)
    
    }
    
      }
	  ,ignoreInit=TRUE

	  )

observeEvent(c(
      event_data(event=c("plotly_selected"), source="Vis_3_2_Scatter",priority=c("event"))
      ),{
        
        req(length(Data_3_2_Complete())>0)
        
        PH<-event_data("plotly_selected", source="Vis_3_2_Scatter", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)%>%
	        unnest(Survey_ID)
	  
	  
    Selected_SurveysScatter_Vis_3_2_UL<-left_join(PH,Data_3_2_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_3_2_UL(Selected_SurveysScatter_Vis_3_2_UL)
    
    Sel_SurveysAll_Vis_3_2_UL(Selected_SurveysScatter_Vis_3_2_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_3_2_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
      
    HighlightTrace_3Vis(Selected_SurveysScatter_Vis_3_2_L)
   
    SelectedWB_3Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_3_2_L,by="Survey_ID")
    
    MapVis3_1_SelectedWB_SHP(SelectedWB_3Vis)
    MapVis3_3_SelectedWB_SHP(SelectedWB_3Vis)
    
    }
      }
	  ,ignoreInit=TRUE
	  
	  ) 



    observeEvent(c(
      Vis_3_2_Scatter_Factor_Palette()
      ),{
       
        
      if(input$AF_LinkedSelection=="Yes"){req(nrow(HighlightTrace_3Vis())>0)}
      else{req(length(Sel_SurveysScatter_Vis_3_2_UL())>0)} 

	  
	  PH<-if(input$AF_LinkedSelection=="No"){
	    Sel_SurveysScatter_Vis_3_2_UL()%>%
	         select(Survey_ID)
	    } else {
      HighlightTrace_3Vis()%>%
          select(Survey_ID)
      }
        
    Selected_SurveysScatter_Vis_3_2_UL<-left_join(PH,Data_3_2_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_3_2_UL(Selected_SurveysScatter_Vis_3_2_UL)
    
    Sel_SurveysAll_Vis_3_2_UL(Selected_SurveysScatter_Vis_3_2_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_3_2_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
      
    HighlightTrace_3Vis(Selected_SurveysScatter_Vis_3_2_L)
   
    SelectedWB_3Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_3_2_L,by="Survey_ID")
    
    MapVis3_1_SelectedWB_SHP(SelectedWB_3Vis)
    MapVis3_3_SelectedWB_SHP(SelectedWB_3Vis)
    
    }
    
      }
	  ,ignoreInit=TRUE

	  )
    
observeEvent(c(
      event_data(event=c("plotly_selected"), source="Vis_4_2_Scatter",priority=c("event"))
      ),{
        
        req(length(Data_4_2_Complete())>0)
        
        PH<-event_data("plotly_selected", source="Vis_4_2_Scatter", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)%>%
	        unnest(Survey_ID)
	  
	  
    Selected_SurveysScatter_Vis_4_2_UL<-left_join(PH,Data_4_2_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_4_2_UL(Selected_SurveysScatter_Vis_4_2_UL)
    
    Sel_SurveysAll_Vis_4_2_UL(Selected_SurveysScatter_Vis_4_2_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_4_2_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
      
    HighlightTrace_4Vis(Selected_SurveysScatter_Vis_4_2_L)
   
    SelectedWB_4Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_4_2_L,by="Survey_ID")
    
    MapVis4_1_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_3_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_4_SelectedWB_SHP(SelectedWB_4Vis)
    }
    
      }
	  ,ignoreInit=TRUE
	  
	  ) 



    observeEvent(c(
      Vis_4_2_Scatter_Factor_Palette()
      ),{
       
        
      if(input$AF_LinkedSelection=="Yes"){req(nrow(HighlightTrace_4Vis())>0)}
      else{req(length(Sel_SurveysScatter_Vis_4_2_UL())>0)} 

	  
	  PH<-if(input$AF_LinkedSelection=="No"){
	    Sel_SurveysScatter_Vis_4_2_UL()%>%
	         select(Survey_ID)
	    } else {
      HighlightTrace_4Vis()%>%
          select(Survey_ID)
      }
        
    Selected_SurveysScatter_Vis_4_2_UL<-left_join(PH,Data_4_2_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_4_2_UL(Selected_SurveysScatter_Vis_4_2_UL)
    
    Sel_SurveysAll_Vis_4_2_UL(Selected_SurveysScatter_Vis_4_2_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_4_2_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
      
    HighlightTrace_4Vis(Selected_SurveysScatter_Vis_4_2_L)
   
    SelectedWB_4Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_4_2_L,by="Survey_ID")
    
    MapVis4_1_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_3_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_4_SelectedWB_SHP(SelectedWB_4Vis)
    
    }
    
      }
	  ,ignoreInit=TRUE

	  )  
    
observeEvent(c(
      event_data(event=c("plotly_selected"), source="Vis_3_3_Scatter",priority=c("event"))
      ),{
        
        req(length(Data_3_3_Complete())>0)
        
        PH<-event_data("plotly_selected", source="Vis_3_3_Scatter", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)%>%
	        unnest(Survey_ID)
	  
	  
    Selected_SurveysScatter_Vis_3_3_UL<-left_join(PH,Data_3_3_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_3_3_UL(Selected_SurveysScatter_Vis_3_3_UL)
    
    Sel_SurveysAll_Vis_3_3_UL(Selected_SurveysScatter_Vis_3_3_UL)
    
   if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_3_3_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
       
    HighlightTrace_3Vis(Selected_SurveysScatter_Vis_3_3_L)
   
    SelectedWB_3Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_3_3_L,by="Survey_ID")
    
    MapVis3_1_SelectedWB_SHP(SelectedWB_3Vis)
    MapVis3_2_SelectedWB_SHP(SelectedWB_3Vis)
   }
    
      }
	  ,ignoreInit=TRUE
	  
	  ) 



    observeEvent(c(
      Vis_3_3_Scatter_Factor_Palette()
      ),{
       
        
      if(input$AF_LinkedSelection=="Yes"){req(nrow(HighlightTrace_3Vis())>0)}
      else{req(length(Sel_SurveysScatter_Vis_3_3_UL())>0)} 

	  
	  PH<-if(input$AF_LinkedSelection=="No"){
	    Sel_SurveysScatter_Vis_3_3_UL()%>%
	         select(Survey_ID)
	    } else {
      HighlightTrace_3Vis()%>%
          select(Survey_ID)
      }
        
    Selected_SurveysScatter_Vis_3_3_UL<-left_join(PH,Data_3_3_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_3_3_UL(Selected_SurveysScatter_Vis_3_3_UL)
    
    Sel_SurveysAll_Vis_3_3_UL(Selected_SurveysScatter_Vis_3_3_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_3_3_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
      
    HighlightTrace_3Vis(Selected_SurveysScatter_Vis_3_3_L)
   
    SelectedWB_3Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_3_3_L,by="Survey_ID")
    
    MapVis3_1_SelectedWB_SHP(SelectedWB_3Vis)
    MapVis3_2_SelectedWB_SHP(SelectedWB_3Vis)
    
    }
    
      }
	  ,ignoreInit=TRUE

	  )
    
observeEvent(c(
      event_data(event=c("plotly_selected"), source="Vis_4_3_Scatter",priority=c("event"))
      ),{
        
        req(length(Data_4_3_Complete())>0)
        
        PH<-event_data("plotly_selected", source="Vis_4_3_Scatter", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)%>%
	        unnest(Survey_ID)
	  
	  
    Selected_SurveysScatter_Vis_4_3_UL<-left_join(PH,Data_4_3_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_4_3_UL(Selected_SurveysScatter_Vis_4_3_UL)
    
    Sel_SurveysAll_Vis_4_3_UL(Selected_SurveysScatter_Vis_4_3_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_4_3_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
      
    HighlightTrace_4Vis(Selected_SurveysScatter_Vis_4_3_L)
   
    SelectedWB_4Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_4_3_L,by="Survey_ID")
    
    MapVis4_1_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_2_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_4_SelectedWB_SHP(SelectedWB_4Vis)
    
    }
      }
	  ,ignoreInit=TRUE
	  
	  ) 



    observeEvent(c(
      Vis_4_3_Scatter_Factor_Palette()
      ),{
       
        
      if(input$AF_LinkedSelection=="Yes"){req(nrow(HighlightTrace_4Vis())>0)}
      else{req(length(Sel_SurveysScatter_Vis_4_3_UL())>0)} 

	  
	  PH<-if(input$AF_LinkedSelection=="No"){
	    Sel_SurveysScatter_Vis_4_3_UL()%>%
	         select(Survey_ID)
	    } else {
      HighlightTrace_4Vis()%>%
          select(Survey_ID)
      }
        
    Selected_SurveysScatter_Vis_4_3_UL<-left_join(PH,Data_4_3_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_4_3_UL(Selected_SurveysScatter_Vis_4_3_UL)
    
    Sel_SurveysAll_Vis_4_3_UL(Selected_SurveysScatter_Vis_4_3_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_4_3_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
      
    HighlightTrace_4Vis(Selected_SurveysScatter_Vis_4_3_L)
   
    SelectedWB_4Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_4_3_L,by="Survey_ID")
    
    MapVis4_1_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_2_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_4_SelectedWB_SHP(SelectedWB_4Vis)
    
    }
    
      }
	  ,ignoreInit=TRUE

	  )  
    
observeEvent(c(
      event_data(event=c("plotly_selected"), source="Vis_4_4_Scatter",priority=c("event"))
      ),{
        
        req(length(Data_4_4_Complete())>0)
        
        PH<-event_data("plotly_selected", source="Vis_4_4_Scatter", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)%>%
	        unnest(Survey_ID)
	  
	  
    Selected_SurveysScatter_Vis_4_4_UL<-left_join(PH,Data_4_4_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_4_4_UL(Selected_SurveysScatter_Vis_4_4_UL)
    
    Sel_SurveysAll_Vis_4_4_UL(Selected_SurveysScatter_Vis_4_4_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
    Selected_SurveysScatter_Vis_4_4_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID")) #returnhere
      
    HighlightTrace_4Vis(Selected_SurveysScatter_Vis_4_4_L)
   
    SelectedWB_4Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_4_4_L,by="Survey_ID")
    
    MapVis4_1_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_2_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_3_SelectedWB_SHP(SelectedWB_4Vis)
    }
    
      }
	  ,ignoreInit=TRUE
	  
	  ) 



    observeEvent(c(
      Vis_4_4_Scatter_Factor_Palette()
      ),{
       
        
      if(input$AF_LinkedSelection=="Yes"){req(nrow(HighlightTrace_4Vis())>0)}
      else{req(length(Sel_SurveysScatter_Vis_4_4_UL())>0)} 

	  
	  PH<-if(input$AF_LinkedSelection=="No"){
	    Sel_SurveysScatter_Vis_4_4_UL()%>%
	         select(Survey_ID)
	    } else {
      HighlightTrace_4Vis()%>%
          select(Survey_ID)
      }
        
    Selected_SurveysScatter_Vis_4_4_UL<-left_join(PH,Data_4_4_Complete(),by=c("Survey_ID"="Survey_ID"))
    
    Sel_SurveysScatter_Vis_4_4_UL(Selected_SurveysScatter_Vis_4_4_UL)
    
    Sel_SurveysAll_Vis_4_4_UL(Selected_SurveysScatter_Vis_4_4_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
      Selected_SurveysScatter_Vis_4_4_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID")) #returnhere

      
    HighlightTrace_4Vis(Selected_SurveysScatter_Vis_4_4_L)
   
    SelectedWB_4Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysScatter_Vis_4_4_L,by="Survey_ID")
    
    MapVis4_1_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_2_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_3_SelectedWB_SHP(SelectedWB_4Vis)
    
    }
    
      }
	  ,ignoreInit=TRUE

	  )
    
    
#### Line ####
    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_1_1_Line",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis1=='Line Plot', input$AF_VisNum_Selection==1)
	      PH<-event_data("plotly_selected", source="Vis_1_1_Line", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysLine_Vis_1_1_UL<-left_join(PH,Vis_1_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysLine_Vis_1_1_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysLine_Vis_1_1_UL(Selected_SurveysLine_Vis_1_1_UL)
    Sel_SurveysAll_Vis_1_1_UL(Selected_SurveysLine_Vis_1_1_UL)
       },ignoreInit=TRUE
    )
    
    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_2_1_Line",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis1=='Line Plot', input$AF_VisNum_Selection==2)
	      PH<-event_data("plotly_selected", source="Vis_2_1_Line", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysLine_Vis_2_1_UL<-left_join(PH,Vis_1_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysLine_Vis_2_1_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysLine_Vis_2_1_UL(Selected_SurveysLine_Vis_2_1_UL)
    Sel_SurveysAll_Vis_2_1_UL(Selected_SurveysLine_Vis_2_1_UL)
       },ignoreInit=TRUE
    )    

    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_3_1_Line",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis1=='Line Plot', input$AF_VisNum_Selection==3)
	      PH<-event_data("plotly_selected", source="Vis_3_1_Line", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysLine_Vis_3_1_UL<-left_join(PH,Vis_1_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysLine_Vis_3_1_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysLine_Vis_3_1_UL(Selected_SurveysLine_Vis_3_1_UL)
    Sel_SurveysAll_Vis_3_1_UL(Selected_SurveysLine_Vis_3_1_UL)
       },ignoreInit=TRUE
    )    
    
    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_4_1_Line",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis1=='Line Plot', input$AF_VisNum_Selection==4)
	      PH<-event_data("plotly_selected", source="Vis_4_1_Line", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysLine_Vis_4_1_UL<-left_join(PH,Vis_1_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysLine_Vis_4_1_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysLine_Vis_4_1_UL(Selected_SurveysLine_Vis_4_1_UL)
    Sel_SurveysAll_Vis_4_1_UL(Selected_SurveysLine_Vis_4_1_UL)
       },ignoreInit=TRUE
    )    
    
    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_2_2_Line",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis2=='Line Plot', input$AF_VisNum_Selection==2)
	      PH<-event_data("plotly_selected", source="Vis_2_2_Line", priority="event")%>%
	       rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysLine_Vis_2_2_UL<-left_join(PH,Vis_2_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysLine_Vis_2_2_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysLine_Vis_2_2_UL(Selected_SurveysLine_Vis_2_2_UL)
    Sel_SurveysAll_Vis_2_2_UL(Selected_SurveysLine_Vis_2_2_UL)
       },ignoreInit=TRUE
    )    

    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_3_2_Line",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis2=='Line Plot', input$AF_VisNum_Selection==3)
	      PH<-event_data("plotly_selected", source="Vis_3_2_Line", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysLine_Vis_3_2_UL<-left_join(PH,Vis_2_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysLine_Vis_3_2_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysLine_Vis_3_2_UL(Selected_SurveysLine_Vis_3_2_UL)
    Sel_SurveysAll_Vis_3_2_UL(Selected_SurveysLine_Vis_3_2_UL)
       },ignoreInit=TRUE
    )    
    
    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_4_2_Line",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis2=='Line Plot', input$AF_VisNum_Selection==4)
	      PH<-event_data("plotly_selected", source="Vis_4_2_Line", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysLine_Vis_4_2_UL<-left_join(PH,Vis_2_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysLine_Vis_4_2_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysLine_Vis_4_2_UL(Selected_SurveysLine_Vis_4_2_UL)
    Sel_SurveysAll_Vis_4_2_UL(Selected_SurveysLine_Vis_4_2_UL)
       },ignoreInit=TRUE
    )    
    

    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_3_3_Line",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis3=='Line Plot', input$AF_VisNum_Selection==3)
	      PH<-event_data("plotly_selected", source="Vis_3_3_Line", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysLine_Vis_3_3_UL<-left_join(PH,Vis_3_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysLine_Vis_3_3_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysLine_Vis_3_3_UL(Selected_SurveysLine_Vis_3_3_UL)
    Sel_SurveysAll_Vis_3_3_UL(Selected_SurveysLine_Vis_3_3_UL)
       },ignoreInit=TRUE
    )    
    
    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_4_3_Line",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis3=='Line Plot', input$AF_VisNum_Selection==4)
	      PH<-event_data("plotly_selected", source="Vis_4_3_Line", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysLine_Vis_4_3_UL<-left_join(PH,Vis_3_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysLine_Vis_4_3_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysLine_Vis_4_3_UL(Selected_SurveysLine_Vis_4_3_UL)
    Sel_SurveysAll_Vis_4_3_UL(Selected_SurveysLine_Vis_4_3_UL)
       },ignoreInit=TRUE
    )
    
    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_4_4_Line",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis4=='Line Plot', input$AF_VisNum_Selection==4)
	      PH<-event_data("plotly_selected", source="Vis_4_4_Line", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysLine_Vis_4_4_UL<-left_join(PH,Vis_4_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysLine_Vis_4_4_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysLine_Vis_4_4_UL(Selected_SurveysLine_Vis_4_4_UL)
    Sel_SurveysAll_Vis_4_4_UL(Selected_SurveysLine_Vis_4_4_UL)
       },ignoreInit=TRUE
    )      
    
    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_1_1_Bar",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis1=='Bar Chart', input$AF_VisNum_Selection==1)
	      PH<-event_data("plotly_selected", source="Vis_1_1_Bar", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysBar_Vis_1_1_UL<-left_join(PH,Vis_1_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysBar_Vis_1_1_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysBar_Vis_1_1_UL(Selected_SurveysBar_Vis_1_1_UL)
    Sel_SurveysAll_Vis_1_1_UL(Selected_SurveysBar_Vis_1_1_UL)
       },ignoreInit=TRUE
    )
    
    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_2_1_Bar",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis1=='Bar Chart', input$AF_VisNum_Selection==2)
	      PH<-event_data("plotly_selected", source="Vis_2_1_Bar", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysBar_Vis_2_1_UL<-left_join(PH,Vis_1_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysBar_Vis_2_1_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysBar_Vis_2_1_UL(Selected_SurveysBar_Vis_2_1_UL)
    Sel_SurveysAll_Vis_2_1_UL(Selected_SurveysBar_Vis_2_1_UL)
       },ignoreInit=TRUE
    )    

    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_3_1_Bar",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis1=='Bar Chart', input$AF_VisNum_Selection==3)
	      PH<-event_data("plotly_selected", source="Vis_3_1_Bar", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysBar_Vis_3_1_UL<-left_join(PH,Vis_1_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysBar_Vis_3_1_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysBar_Vis_3_1_UL(Selected_SurveysBar_Vis_3_1_UL)
    Sel_SurveysAll_Vis_3_1_UL(Selected_SurveysBar_Vis_3_1_UL)
       },ignoreInit=TRUE
    )    
    
    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_4_1_Bar",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis1=='Bar Chart', input$AF_VisNum_Selection==4)
	      PH<-event_data("plotly_selected", source="Vis_4_1_Bar", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysBar_Vis_4_1_UL<-left_join(PH,Vis_1_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysBar_Vis_4_1_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysBar_Vis_4_1_UL(Selected_SurveysBar_Vis_4_1_UL)
    Sel_SurveysAll_Vis_4_1_UL(Selected_SurveysBar_Vis_4_1_UL)
       },ignoreInit=TRUE
    )    
    
    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_2_2_Bar",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis2=='Bar Chart', input$AF_VisNum_Selection==2)
	      PH<-event_data("plotly_selected", source="Vis_2_2_Bar", priority="event")%>%
	       rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysBar_Vis_2_2_UL<-left_join(PH,Vis_2_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysBar_Vis_2_2_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysBar_Vis_2_2_UL(Selected_SurveysBar_Vis_2_2_UL)
    Sel_SurveysAll_Vis_2_2_UL(Selected_SurveysBar_Vis_2_2_UL)
       },ignoreInit=TRUE
    )    

    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_3_2_Bar",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis2=='Bar Chart', input$AF_VisNum_Selection==3)
	      PH<-event_data("plotly_selected", source="Vis_3_2_Bar", priority="event")%>%
	       rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysBar_Vis_3_2_UL<-left_join(PH,Vis_2_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysBar_Vis_3_2_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysBar_Vis_3_2_UL(Selected_SurveysBar_Vis_3_2_UL)
    Sel_SurveysAll_Vis_3_2_UL(Selected_SurveysBar_Vis_3_2_UL)
       },ignoreInit=TRUE
    )    
    
    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_4_2_Bar",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis2=='Bar Chart', input$AF_VisNum_Selection==4)
	      PH<-event_data("plotly_selected", source="Vis_4_2_Bar", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysBar_Vis_4_2_UL<-left_join(PH,Vis_2_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysBar_Vis_4_2_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysBar_Vis_4_2_UL(Selected_SurveysBar_Vis_4_2_UL)
    Sel_SurveysAll_Vis_4_2_UL(Selected_SurveysBar_Vis_4_2_UL)
       },ignoreInit=TRUE
    )    
    

    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_3_3_Bar",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis3=='Bar Chart', input$AF_VisNum_Selection==3)
	      PH<-event_data("plotly_selected", source="Vis_3_3_Bar", priority="event")%>%
	        rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysBar_Vis_3_3_UL<-left_join(PH,Vis_3_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysBar_Vis_3_3_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysBar_Vis_3_3_UL(Selected_SurveysBar_Vis_3_3_UL)
    Sel_SurveysAll_Vis_3_3_UL(Selected_SurveysBar_Vis_3_3_UL)
       },ignoreInit=TRUE
    )    
    
    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_4_3_Bar",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis3=='Bar Chart', input$AF_VisNum_Selection==4)
	      PH<-event_data("plotly_selected", source="Vis_4_3_Bar", priority="event")%>%
	       rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	  
	  if(input$AF_SharedData=='No'){
        Selected_SurveysBar_Vis_4_3_UL<-left_join(PH,Vis_3_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysBar_Vis_4_3_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysBar_Vis_4_3_UL(Selected_SurveysBar_Vis_4_3_UL)
    Sel_SurveysAll_Vis_4_3_UL(Selected_SurveysBar_Vis_4_3_UL)
       },ignoreInit=TRUE
    )
    
    observeEvent(
      event_data(event=c("plotly_selected"), source="Vis_4_4_Bar",priority=c("event")),
      {
      req(input$AF_LinkedSelection=='No', input$SelectVis4=='Bar Chart', input$AF_VisNum_Selection==4)
	      PH<-event_data("plotly_selected", source="Vis_4_4_Bar", priority="event")%>%
	       rename(Survey_ID=key)%>%
	        select(-curveNumber,-pointNumber,-x,-y)
	      
	  if(input$AF_SharedData=='No'){
        Selected_SurveysBar_Vis_4_4_UL<-left_join(PH,Vis_4_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }else{
        Selected_SurveysBar_Vis_4_4_UL<-left_join(PH,Shared_SelectedTBL(),by=c("Survey_ID"="Survey_ID"))
      }
    Sel_SurveysBar_Vis_4_4_UL(Selected_SurveysBar_Vis_4_4_UL)
    Sel_SurveysAll_Vis_4_4_UL(Selected_SurveysBar_Vis_4_4_UL)
       },ignoreInit=TRUE
    )      
    
# Update Map Selection 
    
  observeEvent(
      MapVis1_1_SelectedWB_SHP(),
      {
        req(nrow(MapVis1_1_SelectedWB_SHP())>0)

	      PH<-MapVis1_1_SelectedWB_SHP()%>%
	        st_drop_geometry()%>%
	        select(Survey_ID)

	    Selected_SurveysMap_Vis_1_1_UL<-left_join(PH,Data_1_1_Percentiles(),by=c("Survey_ID"="Survey_ID"))

    Sel_SurveysMap_Vis_1_1_UL(Selected_SurveysMap_Vis_1_1_UL)
    Sel_SurveysAll_Vis_1_1_UL(Selected_SurveysMap_Vis_1_1_UL)
  },ignoreInit=TRUE)
  
    observeEvent(
      MapVis2_1_SelectedWB_SHP(),
      {
        req(nrow(MapVis2_1_SelectedWB_SHP())>0)
        req(nrow(Data_2_1_Complete_Percentiles())>0)

	      PH<-MapVis2_1_SelectedWB_SHP()%>%
	        st_drop_geometry()%>%
	        select(Survey_ID)

	    Selected_SurveysMap_Vis_2_1_UL<-left_join(PH,Data_2_1_Complete_Percentiles(),by=c("Survey_ID"="Survey_ID"))

    Sel_SurveysMap_Vis_2_1_UL(Selected_SurveysMap_Vis_2_1_UL)
    Sel_SurveysAll_Vis_2_1_UL(Selected_SurveysMap_Vis_2_1_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
    Selected_SurveysMap_Vis_2_1_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
    
    HighlightTrace_2Vis(Selected_SurveysMap_Vis_2_1_L)
   
    SelectedWB_2Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysMap_Vis_2_1_L,by="Survey_ID")
    
    MapVis2_2_SelectedWB_SHP(SelectedWB_2Vis)
    }
    
 },ignoreInit=TRUE)
    
    observeEvent(
      MapVis2_2_SelectedWB_SHP(),
      {
        req(nrow(MapVis2_2_SelectedWB_SHP())>0)
        req(nrow(Data_2_2_Complete_Percentiles())>0)

	      PH<-MapVis2_2_SelectedWB_SHP()%>%
	        st_drop_geometry()%>%
	        select(Survey_ID)

	    Selected_SurveysMap_Vis_2_2_UL<-left_join(PH,Data_2_2_Complete_Percentiles(),by=c("Survey_ID"="Survey_ID"))

    Sel_SurveysMap_Vis_2_2_UL(Selected_SurveysMap_Vis_2_2_UL)
    Sel_SurveysAll_Vis_2_2_UL(Selected_SurveysMap_Vis_2_2_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
    Selected_SurveysMap_Vis_2_2_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
    
    HighlightTrace_2Vis(Selected_SurveysMap_Vis_2_2_L)
   
    SelectedWB_2Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysMap_Vis_2_2_L,by="Survey_ID")
    
    MapVis2_1_SelectedWB_SHP(SelectedWB_2Vis)
    }
    
 },ignoreInit=TRUE)
    
    observeEvent(
      MapVis3_1_SelectedWB_SHP(),
      {
        req(nrow(MapVis3_1_SelectedWB_SHP())>0)
        req(nrow(Data_3_1_Complete_Percentiles())>0)

	      PH<-MapVis3_1_SelectedWB_SHP()%>%
	        st_drop_geometry()%>%
	        select(Survey_ID)

	    Selected_SurveysMap_Vis_3_1_UL<-left_join(PH,Data_3_1_Complete_Percentiles(),by=c("Survey_ID"="Survey_ID"))

    Sel_SurveysMap_Vis_3_1_UL(Selected_SurveysMap_Vis_3_1_UL)
    Sel_SurveysAll_Vis_3_1_UL(Selected_SurveysMap_Vis_3_1_UL)
    
    Selected_SurveysMap_Vis_3_1_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
    
    if(input$AF_LinkedSelection=="Yes"){
    
    HighlightTrace_3Vis(Selected_SurveysMap_Vis_3_1_L)
   
    SelectedWB_3Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysMap_Vis_3_1_L,by="Survey_ID")
    
    MapVis3_2_SelectedWB_SHP(SelectedWB_3Vis)
    MapVis3_3_SelectedWB_SHP(SelectedWB_3Vis)
    }
    
 },ignoreInit=TRUE)
    
    observeEvent(
      MapVis3_2_SelectedWB_SHP(),
      {
        req(nrow(MapVis3_2_SelectedWB_SHP())>0)
        req(nrow(Data_3_2_Complete_Percentiles())>0)

	      PH<-MapVis3_2_SelectedWB_SHP()%>%
	        st_drop_geometry()%>%
	        select(Survey_ID)

	    Selected_SurveysMap_Vis_3_2_UL<-left_join(PH,Data_3_2_Complete_Percentiles(),by=c("Survey_ID"="Survey_ID"))

    Sel_SurveysMap_Vis_3_2_UL(Selected_SurveysMap_Vis_3_2_UL)
    Sel_SurveysAll_Vis_3_2_UL(Selected_SurveysMap_Vis_3_2_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
      
    Selected_SurveysMap_Vis_3_2_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
    
    HighlightTrace_3Vis(Selected_SurveysMap_Vis_3_2_L)
   
    SelectedWB_3Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysMap_Vis_3_2_L,by="Survey_ID")
    
    MapVis3_1_SelectedWB_SHP(SelectedWB_3Vis)
    MapVis3_3_SelectedWB_SHP(SelectedWB_3Vis)
    }
    
 },ignoreInit=TRUE)
    
    observeEvent(
      MapVis3_3_SelectedWB_SHP(),
      {
        req(nrow(MapVis3_3_SelectedWB_SHP())>0)
        req(nrow(Data_3_3_Complete_Percentiles())>0)

	      PH<-MapVis3_3_SelectedWB_SHP()%>%
	        st_drop_geometry()%>%
	        select(Survey_ID)

	    Selected_SurveysMap_Vis_3_3_UL<-left_join(PH,Data_3_3_Complete_Percentiles(),by=c("Survey_ID"="Survey_ID"))

    Sel_SurveysMap_Vis_3_3_UL(Selected_SurveysMap_Vis_3_3_UL)
    Sel_SurveysAll_Vis_3_3_UL(Selected_SurveysMap_Vis_3_3_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
    
    Selected_SurveysMap_Vis_3_3_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
    
    HighlightTrace_3Vis(Selected_SurveysMap_Vis_3_3_L)
   
    SelectedWB_3Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysMap_Vis_3_3_L,by="Survey_ID")
    
    MapVis3_1_SelectedWB_SHP(SelectedWB_3Vis)
    MapVis3_2_SelectedWB_SHP(SelectedWB_3Vis)
    }
    
 },ignoreInit=TRUE)
    
    observeEvent(
      MapVis4_1_SelectedWB_SHP(),
      {
        req(nrow(MapVis4_1_SelectedWB_SHP())>0)
        req(nrow(Data_4_1_Complete_Percentiles())>0)

	      PH<-MapVis4_1_SelectedWB_SHP()%>%
	        st_drop_geometry()%>%
	        select(Survey_ID)

	    Selected_SurveysMap_Vis_4_1_UL<-left_join(PH,Data_4_1_Complete_Percentiles(),by=c("Survey_ID"="Survey_ID"))

    Sel_SurveysMap_Vis_4_1_UL(Selected_SurveysMap_Vis_4_1_UL)
    Sel_SurveysAll_Vis_4_1_UL(Selected_SurveysMap_Vis_4_1_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
    
    Selected_SurveysMap_Vis_4_1_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
    
    HighlightTrace_4Vis(Selected_SurveysMap_Vis_4_1_L)
   
    SelectedWB_4Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysMap_Vis_4_1_L,by="Survey_ID")
    
    MapVis4_2_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_3_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_4_SelectedWB_SHP(SelectedWB_4Vis)
    }
    
 },ignoreInit=TRUE)
    
    observeEvent(
      MapVis4_2_SelectedWB_SHP(),
      {
        req(nrow(MapVis4_2_SelectedWB_SHP())>0)
        req(nrow(Data_4_2_Complete_Percentiles())>0)

	      PH<-MapVis4_2_SelectedWB_SHP()%>%
	        st_drop_geometry()%>%
	        select(Survey_ID)

	    Selected_SurveysMap_Vis_4_2_UL<-left_join(PH,Data_4_2_Complete_Percentiles(),by=c("Survey_ID"="Survey_ID"))

    Sel_SurveysMap_Vis_4_2_UL(Selected_SurveysMap_Vis_4_2_UL)
    Sel_SurveysAll_Vis_4_2_UL(Selected_SurveysMap_Vis_4_2_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
    
    Selected_SurveysMap_Vis_4_2_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
    
    HighlightTrace_4Vis(Selected_SurveysMap_Vis_4_2_L)
   
    SelectedWB_4Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysMap_Vis_4_2_L,by="Survey_ID")
    
    MapVis4_1_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_3_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_4_SelectedWB_SHP(SelectedWB_4Vis)
    }
    
 },ignoreInit=TRUE)
    
    observeEvent(
      MapVis4_3_SelectedWB_SHP(),
      {
        req(nrow(MapVis4_3_SelectedWB_SHP())>0)
        req(nrow(Data_4_3_Complete_Percentiles())>0)

	      PH<-MapVis4_3_SelectedWB_SHP()%>%
	        st_drop_geometry()%>%
	        select(Survey_ID)

	    Selected_SurveysMap_Vis_4_3_UL<-left_join(PH,Data_4_3_Complete_Percentiles(),by=c("Survey_ID"="Survey_ID"))

    Sel_SurveysMap_Vis_4_3_UL(Selected_SurveysMap_Vis_4_3_UL)
    Sel_SurveysAll_Vis_4_3_UL(Selected_SurveysMap_Vis_4_3_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
    
    Selected_SurveysMap_Vis_4_3_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
    
    HighlightTrace_4Vis(Selected_SurveysMap_Vis_4_3_L)
   
    SelectedWB_4Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysMap_Vis_4_3_L,by="Survey_ID")
    
    MapVis4_1_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_2_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_4_SelectedWB_SHP(SelectedWB_4Vis)
    }
    
 },ignoreInit=TRUE)
    
    observeEvent(
      MapVis4_4_SelectedWB_SHP(),
      {
        req(nrow(MapVis4_4_SelectedWB_SHP())>0)
        req(nrow(Data_4_4_Complete_Percentiles())>0)

	      PH<-MapVis4_4_SelectedWB_SHP()%>%
	        st_drop_geometry()%>%
	        select(Survey_ID)

	    Selected_SurveysMap_Vis_4_4_UL<-left_join(PH,Data_4_4_Complete_Percentiles(),by=c("Survey_ID"="Survey_ID"))

    Sel_SurveysMap_Vis_4_4_UL(Selected_SurveysMap_Vis_4_4_UL)
    Sel_SurveysAll_Vis_4_4_UL(Selected_SurveysMap_Vis_4_4_UL)
    
    if(input$AF_LinkedSelection=="Yes"){
    
    Selected_SurveysMap_Vis_4_4_L<-left_join(PH,Vis_Linked_DataComplete(),by=c("Survey_ID"="Survey_ID"))
    
    HighlightTrace_4Vis(Selected_SurveysMap_Vis_4_4_L)
   
    SelectedWB_4Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],Selected_SurveysMap_Vis_4_4_L,by="Survey_ID")
    
    MapVis4_1_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_2_SelectedWB_SHP(SelectedWB_4Vis)
    MapVis4_3_SelectedWB_SHP(SelectedWB_4Vis)
    }
    
 },ignoreInit=TRUE)
   
    observeEvent(c(
      input$ClearSel_Vis1
    ),{
      if(is.null(input$AF_SharedData)||
         input$AF_SharedData=="No"){
        PH<-Vis_1_SelectedTBL()%>%
        droplevels()
        }else{
      PH<-Shared_SelectedTBL()%>%
        droplevels()
      }
      
    Data_1_1(NULL)
    Data_2_1_Selected(NULL)
    Data_3_1_Selected(NULL)
    Data_4_1_Selected(NULL)
      
    Data_1_1(PH)
    Data_2_1_Selected(PH)
    Data_3_1_Selected(PH)
    Data_4_1_Selected(PH)
      
    },ignoreInit=TRUE)
    
    observeEvent(c(
      input$ClearSel_Vis2
    ),{
      
      PH<-if(input$AF_SharedData=="No"){
        Vis_2_SelectedTBL()%>%
        droplevels()
        }else{
      Shared_SelectedTBL()%>%
        droplevels()
      }
    Data_2_2_Selected(NULL)
    Data_3_2_Selected(NULL)
    Data_4_2_Selected(NULL)
      
    Data_2_2_Selected(PH)
    Data_3_2_Selected(PH)
    Data_4_2_Selected(PH)
      
    },ignoreInit=TRUE)
        
 observeEvent(c(
  input$ClearSel_Vis3
    ),{
      PH<-if(input$AF_SharedData=="No"){
        Vis_3_SelectedTBL()%>%
        droplevels()
        }else{
      Shared_SelectedTBL()%>%
        droplevels()
      }
    Data_3_3_Selected(NULL)
    Data_4_3_Selected(NULL)
      
    Data_3_3_Selected(PH)
    Data_4_3_Selected(PH)
      
    },ignoreInit=TRUE)
 
         
 observeEvent(c(
  input$ClearSel_Vis4
    ),{
      
      PH<-if(input$AF_SharedData=="No"){
        Vis_4_SelectedTBL()%>%
        droplevels()
        }else{
      Shared_SelectedTBL()%>%
        droplevels()
      }
    
    Data_4_4_Selected(NULL)
      
    Data_4_4_Selected(PH)
      
    },ignoreInit=TRUE)


    
    observeEvent(c(
      input$AF_LinkedSelection,
      input$ClearSel_Vis1,
      input$SelectVis1
    ),{
    
    Sel_SurveysScatter_Vis_1_1_UL(NULL)
    Sel_SurveysBar_Vis_1_1_UL(NULL)
    Sel_SurveysLine_Vis_1_1_UL(NULL)
    Sel_SurveysMap_Vis_1_1_UL(NULL)
    Sel_SurveysAll_Vis_1_1_UL(NULL)

    Sel_SurveysScatter_Vis_2_1_UL(NULL)
    Sel_SurveysBar_Vis_2_1_UL(NULL)
    Sel_SurveysLine_Vis_2_1_UL(NULL)
    Sel_SurveysMap_Vis_2_1_UL(NULL)
    Sel_SurveysAll_Vis_2_1_UL(NULL)

    Sel_SurveysScatter_Vis_3_1_UL(NULL)
    Sel_SurveysBar_Vis_3_1_UL(NULL)
    Sel_SurveysLine_Vis_3_1_UL(NULL)
    Sel_SurveysMap_Vis_3_1_UL(NULL)
    Sel_SurveysAll_Vis_3_1_UL(NULL)

    Sel_SurveysScatter_Vis_4_1_UL(NULL)
    Sel_SurveysBar_Vis_4_1_UL(NULL)
    Sel_SurveysLine_Vis_4_1_UL(NULL)
    Sel_SurveysMap_Vis_4_1_UL(NULL)
    Sel_SurveysAll_Vis_4_1_UL(NULL)
    
         },ignoreInit=TRUE
      )

    observeEvent(c(
      input$AF_LinkedSelection,
      input$ClearSel_Vis2,
      input$SelectVis2
    ),{
    Sel_SurveysScatter_Vis_2_2_UL(NULL)
    Sel_SurveysBar_Vis_2_2_UL(NULL)
    Sel_SurveysLine_Vis_2_2_UL(NULL)
    Sel_SurveysMap_Vis_2_2_UL(NULL)
    Sel_SurveysAll_Vis_2_2_UL(NULL)

    Sel_SurveysScatter_Vis_3_2_UL(NULL)
    Sel_SurveysBar_Vis_3_2_UL(NULL)
    Sel_SurveysLine_Vis_3_2_UL(NULL)
    Sel_SurveysMap_Vis_3_2_UL(NULL)
    Sel_SurveysAll_Vis_3_2_UL(NULL)

    Sel_SurveysScatter_Vis_4_2_UL(NULL)
    Sel_SurveysBar_Vis_4_2_UL(NULL)
    Sel_SurveysLine_Vis_4_2_UL(NULL)
    Sel_SurveysMap_Vis_4_2_UL(NULL)
    Sel_SurveysAll_Vis_4_2_UL(NULL)
         },ignoreInit=TRUE
      )

     observeEvent(c(
      input$AF_LinkedSelection,
      input$ClearSel_Vis3,
      input$SelectVis3
    ),{
    Sel_SurveysScatter_Vis_3_3_UL(NULL)
    Sel_SurveysBar_Vis_3_3_UL(NULL)
    Sel_SurveysLine_Vis_3_3_UL(NULL)
    Sel_SurveysMap_Vis_3_3_UL(NULL)
    Sel_SurveysAll_Vis_3_3_UL(NULL)

    Sel_SurveysScatter_Vis_4_3_UL(NULL)
    Sel_SurveysBar_Vis_4_3_UL(NULL)
    Sel_SurveysLine_Vis_4_3_UL(NULL)
    Sel_SurveysMap_Vis_4_3_UL(NULL)
    Sel_SurveysAll_Vis_4_3_UL(NULL)
         },ignoreInit=TRUE
      )

    observeEvent(c(
      input$AF_LinkedSelection,
      input$ClearSel_Vis4,
      input$SelectVis4
    ),{
    Sel_SurveysScatter_Vis_4_4_UL(NULL)
    Sel_SurveysBar_Vis_4_4_UL(NULL)
    Sel_SurveysLine_Vis_4_4_UL(NULL)
    Sel_SurveysMap_Vis_4_4_UL(NULL)
    Sel_SurveysAll_Vis_4_4_UL(NULL)
    
         },ignoreInit=TRUE
      )
    

    Vis_1_VisSelectedTBL<-reactive({
      if(req(input$AF_VisNum_Selection)==1){
        req(Sel_SurveysAll_Vis_1_1_UL())
        distinct(Sel_SurveysAll_Vis_1_1_UL())
      } else if (input$AF_VisNum_Selection==2){
        req(Sel_SurveysAll_Vis_2_1_UL())
        distinct(Sel_SurveysAll_Vis_2_1_UL())
      } else if (input$AF_VisNum_Selection==3){
        req(Sel_SurveysAll_Vis_3_1_UL())
        distinct(Sel_SurveysAll_Vis_3_1_UL())
      } else if (input$AF_VisNum_Selection==4){
       req(Sel_SurveysAll_Vis_4_1_UL()) 
       distinct(Sel_SurveysAll_Vis_4_1_UL())
      }
    })
    
    Vis_2_VisSelectedTBL<-reactive({
      if (req(input$AF_VisNum_Selection)==2){
        req(Sel_SurveysAll_Vis_2_2_UL())
        distinct(Sel_SurveysAll_Vis_2_2_UL())
      } else if (input$AF_VisNum_Selection==3){
        req(Sel_SurveysAll_Vis_3_2_UL())
        distinct(Sel_SurveysAll_Vis_3_2_UL())
      } else if (input$AF_VisNum_Selection==4){
        req(Sel_SurveysAll_Vis_4_2_UL())
       distinct(Sel_SurveysAll_Vis_4_2_UL())
      }
    }) 
    
    Vis_3_VisSelectedTBL<-reactive({
      if (req(input$AF_VisNum_Selection)==3){
        req(Sel_SurveysAll_Vis_3_3_UL())
        distinct(Sel_SurveysAll_Vis_3_3_UL())
      } else if (input$AF_VisNum_Selection==4){
        req(Sel_SurveysAll_Vis_4_3_UL())
       distinct(Sel_SurveysAll_Vis_4_3_UL())
      }
    }) 
    
    Vis_4_VisSelectedTBL<-reactive({
      if (req(input$AF_VisNum_Selection)==4){
        req(Sel_SurveysAll_Vis_4_4_UL())
       distinct(Sel_SurveysAll_Vis_4_4_UL())
      }
    })
    

    
    output$Vis1SelClearStatus<-reactive({
      
      if(is.null(input$AF_LinkedSelection)){
      req(Vis_1_VisSelectedTBL())
      return(length(Vis_1_VisSelectedTBL()))
      }
      else if(input$AF_LinkedSelection=="No"){
      req(Vis_1_VisSelectedTBL())
      return(length(Vis_1_VisSelectedTBL()))
      }
      else if(input$AF_LinkedSelection=="Yes"){
      req(LinkedSelectionTBL())
      return(length(LinkedSelectionTBL()))
      } else{return(0)}
      
      })
      
    outputOptions(output,"Vis1SelClearStatus",suspendWhenHidden=FALSE)
    
    output$Vis2SelClearStatus<-reactive({
      
      if(is.null(input$AF_LinkedSelection)){
      req(Vis_2_VisSelectedTBL())
      return(length(Vis_2_VisSelectedTBL()))
      }
      else if(input$AF_LinkedSelection=="No"){
      req(Vis_2_VisSelectedTBL())
      return(length(Vis_2_VisSelectedTBL()))
      }
      else if(input$AF_LinkedSelection=="Yes"){
      req(LinkedSelectionTBL())
      return(length(LinkedSelectionTBL()))
      } else{return(0)}
      
      })
      
    outputOptions(output,"Vis2SelClearStatus",suspendWhenHidden=FALSE)
    
    output$Vis3SelClearStatus<-reactive({
      
      if(is.null(input$AF_LinkedSelection)){
      req(Vis_3_VisSelectedTBL())
      return(length(Vis_3_VisSelectedTBL()))
      }
      else if(input$AF_LinkedSelection=="No"){
      req(Vis_3_VisSelectedTBL())
      return(length(Vis_3_VisSelectedTBL()))
      }
      else if(input$AF_LinkedSelection=="Yes"){
      req(LinkedSelectionTBL())
      return(length(LinkedSelectionTBL()))
      } else{return(0)}
      
      })
      
    outputOptions(output,"Vis3SelClearStatus",suspendWhenHidden=FALSE) 
    
    output$Vis4SelClearStatus<-reactive({
      
      if(is.null(input$AF_LinkedSelection)){
      req(Vis_4_VisSelectedTBL())
      return(length(Vis_4_VisSelectedTBL()))
      }
      else if(input$AF_LinkedSelection=="No"){
      req(Vis_4_VisSelectedTBL())
      return(length(Vis_4_VisSelectedTBL()))
      }
      else if(input$AF_LinkedSelection=="Yes"){
      req(LinkedSelectionTBL())
      return(length(LinkedSelectionTBL()))
      } else{return(0)}
      
      })
      
    outputOptions(output,"Vis4SelClearStatus",suspendWhenHidden=FALSE)
    


    
    Vis_Linked_DataComplete<-reactive({
      req(input$AF_SharedData=='Yes')
      
      Shared_SelectedTBL()%>%
        {if(input$Vis1_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis1=percent_rank(get(input$Vis1_MapDisplayField))*100) else .}%>%
        {if(input$Vis1_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis1=percent_rank(get(input$Vis1_MapDisplayField_Size))*100) else .}%>%
        {if(input$Vis2_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis2=percent_rank(get(input$Vis2_MapDisplayField))*100) else .}%>%
        {if(input$Vis2_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis2=percent_rank(get(input$Vis2_MapDisplayField_Size))*100) else .}%>%
        {if(input$Vis3_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis3=percent_rank(get(input$Vis3_MapDisplayField))*100) else .}%>%
        {if(input$Vis3_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis3=percent_rank(get(input$Vis3_MapDisplayField_Size))*100) else .}%>%
        {if(input$Vis4_MapDisplayField!="Nothing Selected")
          mutate(.,ColorPercentile_Vis4=percent_rank(get(input$Vis4_MapDisplayField))*100) else .}%>%
        {if(input$Vis4_MapDisplayField_Size!="Nothing Selected")
          mutate(.,SizePercentile_Vis4=percent_rank(get(input$Vis4_MapDisplayField_Size))*100) else .}


  })
      
    
    output$Vis_Linked_VisSelect_Make<-DT::renderDT(
      Vis_Linked_DataComplete(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_Linked_VisSelect_Make table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_Linked_VisSelect_Make table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
    
   
  observeEvent(c(input$Vis_Linked_VisSelect_Make_rows_selected),{
    
        Vis_Linked_Ids<-input$Vis_Linked_VisSelect_Make_rows_selected
        PH<-Vis_Linked_DataComplete()[Vis_Linked_Ids,]
    
      if (input$AF_VisNum_Selection==2){
        HighlightTrace_2Vis(PH)
        
        SelectedWB_2Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],PH,by="Survey_ID")
        MapVis2_1_SelectedWB_SHP(SelectedWB_2Vis)
        MapVis2_2_SelectedWB_SHP(SelectedWB_2Vis)
      
      } else if (input$AF_VisNum_Selection==3){
        HighlightTrace_3Vis(PH)
        
        SelectedWB_3Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],PH,by="Survey_ID")
        MapVis3_1_SelectedWB_SHP(SelectedWB_3Vis)
        MapVis3_2_SelectedWB_SHP(SelectedWB_3Vis)
        MapVis3_3_SelectedWB_SHP(SelectedWB_3Vis)
             
      } else if (input$AF_VisNum_Selection==4){
        HighlightTrace_4Vis(PH)
        
        SelectedWB_4Vis<-right_join(Creel_SHP_Shared()[,c("Survey_ID")],PH,by="Survey_ID")
        MapVis4_1_SelectedWB_SHP(SelectedWB_4Vis)
        MapVis4_2_SelectedWB_SHP(SelectedWB_4Vis)
        MapVis4_3_SelectedWB_SHP(SelectedWB_4Vis)
        MapVis4_4_SelectedWB_SHP(SelectedWB_4Vis)
         
               
      }
               
  },ignoreInit=TRUE)
  
  
  Vis_Linked_SelTable_Length<-reactive({
    
    req(input$AF_VisNum_Selection)
    
    length(input$Vis_Linked_VisSelect_Make_rows_selected)
  })
  
  observeEvent(c(Vis_Linked_SelTable_Length()),{
    req(Vis_Linked_SelTable_Length()<1)
    
      if (input$AF_VisNum_Selection==2){
        HighlightTrace_2Vis(NULL)
        MapVis2_1_SelectedWB_SHP(NULL)
        MapVis2_2_SelectedWB_SHP(NULL)
      
            
      } else if (input$AF_VisNum_Selection==3){
        HighlightTrace_3Vis(NULL)
        MapVis3_1_SelectedWB_SHP(NULL)
        MapVis3_2_SelectedWB_SHP(NULL)
        MapVis3_3_SelectedWB_SHP(NULL)
               
           
      } else if (input$AF_VisNum_Selection==4){
        HighlightTrace_4Vis(NULL)
        MapVis4_1_SelectedWB_SHP(NULL)
        MapVis4_2_SelectedWB_SHP(NULL)
        MapVis4_3_SelectedWB_SHP(NULL)
        MapVis4_4_SelectedWB_SHP(NULL)
         
            
      }
               
  },ignoreInit=TRUE)  
  
  

    Vis_1_DataComplete<-reactive({
      req(input$AF_VisNum_Selection)
      if(input$AF_VisNum_Selection==1){
        req(Data_1_1_Percentiles())
        Data_1_1_Percentiles()
      } else if (input$AF_VisNum_Selection==2){
        req(Data_2_1_Complete_Percentiles())
        Data_2_1_Complete_Percentiles()
      } else if (input$AF_VisNum_Selection==3){
        req(Data_3_1_Complete_Percentiles())
        Data_3_1_Complete_Percentiles()
      } else if (input$AF_VisNum_Selection==4){
        req(Data_4_1_Complete_Percentiles())
        Data_4_1_Complete_Percentiles()
      }
    })
  
   

    
    output$Vis_1_VisSelect_Make<-DT::renderDT(
      Vis_1_DataComplete(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_1_VisSelect_Make table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_1_VisSelect_Make table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
    
    observeEvent(c(input$Vis_1_VisSelect_Make_rows_selected),{
    
    req(input$AF_VisNum_Selection)
    
        Vis_1_Ids<-input$Vis_1_VisSelect_Make_rows_selected
        PH<-Vis_1_DataComplete()[Vis_1_Ids,]
        
      if(input$AF_VisNum_Selection==1){
               Sel_SurveysScatter_Vis_1_1_UL(PH)
               Sel_SurveysBar_Vis_1_1_UL(PH)
               Sel_SurveysLine_Vis_1_1_UL(PH)
               Sel_SurveysMap_Vis_1_1_UL(PH)
               Sel_SurveysAll_Vis_1_1_UL(PH)
               
               SelectedWB<-right_join(Creel_SHP_Vis1_1()[,c("Survey_ID")],PH,by="Survey_ID")
               MapVis1_1_SelectedWB_SHP(SelectedWB)
        
      } else if (input$AF_VisNum_Selection==2){
               Sel_SurveysScatter_Vis_2_1_UL(PH)
               Sel_SurveysBar_Vis_2_1_UL(PH)
               Sel_SurveysLine_Vis_2_1_UL(PH)
               Sel_SurveysMap_Vis_2_1_UL(PH)
               Sel_SurveysAll_Vis_2_1_UL(PH) 
               
               SelectedWB<-right_join(Creel_SHP_Vis2_1()[,c("Survey_ID")],PH,by="Survey_ID")
               MapVis2_1_SelectedWB_SHP(SelectedWB)
               
      } else if (input$AF_VisNum_Selection==3){
               Sel_SurveysScatter_Vis_3_1_UL(PH)
               Sel_SurveysBar_Vis_3_1_UL(PH)
               Sel_SurveysLine_Vis_3_1_UL(PH)
               Sel_SurveysMap_Vis_3_1_UL(PH)
               Sel_SurveysAll_Vis_3_1_UL(PH)
               
               SelectedWB<-right_join(Creel_SHP_Vis3_1()[,c("Survey_ID")],PH,by="Survey_ID")
               MapVis3_1_SelectedWB_SHP(SelectedWB)
        
      } else if (input$AF_VisNum_Selection==4){
               Sel_SurveysScatter_Vis_4_1_UL(PH)
               Sel_SurveysBar_Vis_4_1_UL(PH)
               Sel_SurveysLine_Vis_4_1_UL(PH)
               Sel_SurveysMap_Vis_4_1_UL(PH)
               Sel_SurveysAll_Vis_4_1_UL(PH)  
               
               SelectedWB<-right_join(Creel_SHP_Vis4_1()[,c("Survey_ID")],PH,by="Survey_ID")
               MapVis4_1_SelectedWB_SHP(SelectedWB)
              
      }
        
  
  },ignoreInit=TRUE)
    
  Vis_1_SelTable_Length<-reactive({
    
    req(input$AF_VisNum_Selection)
    
    length(input$Vis_1_VisSelect_Make_rows_selected)
  })
  
  observeEvent(c(Vis_1_SelTable_Length()),{
    req(Vis_1_SelTable_Length()<1)
    
        if(input$AF_VisNum_Selection==1){
               Sel_SurveysScatter_Vis_1_1_UL(NULL)
               Sel_SurveysBar_Vis_1_1_UL(NULL)
               Sel_SurveysLine_Vis_1_1_UL(NULL)
               Sel_SurveysMap_Vis_1_1_UL(NULL)
               Sel_SurveysAll_Vis_1_1_UL(NULL) 
               MapVis1_1_SelectedWB_SHP(NULL)
        
      } else if (input$AF_VisNum_Selection==2){
               Sel_SurveysScatter_Vis_2_1_UL(NULL)
               Sel_SurveysBar_Vis_2_1_UL(NULL)
               Sel_SurveysLine_Vis_2_1_UL(NULL)
               Sel_SurveysMap_Vis_2_1_UL(NULL)
               Sel_SurveysAll_Vis_2_1_UL(NULL) 
               MapVis2_1_SelectedWB_SHP(NULL)
               
      } else if (input$AF_VisNum_Selection==3){
               Sel_SurveysScatter_Vis_3_1_UL(NULL)
               Sel_SurveysBar_Vis_3_1_UL(NULL)
               Sel_SurveysLine_Vis_3_1_UL(NULL)
               Sel_SurveysMap_Vis_3_1_UL(NULL)
               Sel_SurveysAll_Vis_3_1_UL(NULL) 
               MapVis3_1_SelectedWB_SHP(NULL)
        
      } else if (input$AF_VisNum_Selection==4){
               Sel_SurveysScatter_Vis_4_1_UL(NULL)
               Sel_SurveysBar_Vis_4_1_UL(NULL)
               Sel_SurveysLine_Vis_4_1_UL(NULL)
               Sel_SurveysMap_Vis_4_1_UL(NULL)
               Sel_SurveysAll_Vis_4_1_UL(NULL) 
               MapVis4_1_SelectedWB_SHP(NULL)
              
      }
  },ignoreInit=TRUE)
  
      Vis_2_DataComplete<-reactive({
      if (input$AF_VisNum_Selection==2){
        req(Data_2_2_Complete_Percentiles())
        Data_2_2_Complete_Percentiles()
      } else if (input$AF_VisNum_Selection==3){
        req(Data_3_2_Complete_Percentiles())
        Data_3_2_Complete_Percentiles()
      } else if (input$AF_VisNum_Selection==4){
        req(Data_4_2_Complete_Percentiles())
        Data_4_2_Complete_Percentiles()
      }
    }) 
    
    output$Vis_2_VisSelect_Make<-DT::renderDT(
      Vis_2_DataComplete(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_2_VisSelect_Make table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_2_VisSelect_Make table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
    

    
    observeEvent(c(input$Vis_2_VisSelect_Make_rows_selected),{
    
    req(input$AF_VisNum_Selection)
    
        Vis_2_Ids<-input$Vis_2_VisSelect_Make_rows_selected
        PH<-Vis_2_DataComplete()[Vis_2_Ids,]
        
      if (input$AF_VisNum_Selection==2){
               Sel_SurveysScatter_Vis_2_2_UL(PH)
               Sel_SurveysBar_Vis_2_2_UL(PH)
               Sel_SurveysLine_Vis_2_2_UL(PH)
               Sel_SurveysMap_Vis_2_2_UL(PH)
               Sel_SurveysAll_Vis_2_2_UL(PH) 
               
               SelectedWB<-right_join(Creel_SHP_Vis2_2()[,c("Survey_ID")],PH,by="Survey_ID")
               MapVis2_2_SelectedWB_SHP(SelectedWB)
               
      } else if (input$AF_VisNum_Selection==3){
               Sel_SurveysScatter_Vis_3_2_UL(PH)
               Sel_SurveysBar_Vis_3_2_UL(PH)
               Sel_SurveysLine_Vis_3_2_UL(PH)
               Sel_SurveysMap_Vis_3_2_UL(PH)
               Sel_SurveysAll_Vis_3_2_UL(PH)
               
               SelectedWB<-right_join(Creel_SHP_Vis3_2()[,c("Survey_ID")],PH,by="Survey_ID")
               MapVis3_2_SelectedWB_SHP(SelectedWB)
        
      } else if (input$AF_VisNum_Selection==4){
               Sel_SurveysScatter_Vis_4_2_UL(PH)
               Sel_SurveysBar_Vis_4_2_UL(PH)
               Sel_SurveysLine_Vis_4_2_UL(PH)
               Sel_SurveysMap_Vis_4_2_UL(PH)
               Sel_SurveysAll_Vis_4_2_UL(PH)  
               
               SelectedWB<-right_join(Creel_SHP_Vis4_2()[,c("Survey_ID")],PH,by="Survey_ID")
               MapVis4_2_SelectedWB_SHP(SelectedWB)
              
      }
        
  
  },ignoreInit=TRUE)
    
  Vis_2_SelTable_Length<-reactive({
    
    req(input$AF_VisNum_Selection)
    
    length(input$Vis_2_VisSelect_Make_rows_selected)
  })
  
  observeEvent(c(Vis_2_SelTable_Length()),{
    req(Vis_2_SelTable_Length()<1)
    
    if (input$AF_VisNum_Selection==2){
               Sel_SurveysScatter_Vis_2_2_UL(NULL)
               Sel_SurveysBar_Vis_2_2_UL(NULL)
               Sel_SurveysLine_Vis_2_2_UL(NULL)
               Sel_SurveysMap_Vis_2_2_UL(NULL)
               Sel_SurveysAll_Vis_2_2_UL(NULL) 
               MapVis2_2_SelectedWB_SHP(NULL)
               
      } else if (input$AF_VisNum_Selection==3){
               Sel_SurveysScatter_Vis_3_2_UL(NULL)
               Sel_SurveysBar_Vis_3_2_UL(NULL)
               Sel_SurveysLine_Vis_3_2_UL(NULL)
               Sel_SurveysMap_Vis_3_2_UL(NULL)
               Sel_SurveysAll_Vis_3_2_UL(NULL) 
               MapVis3_2_SelectedWB_SHP(NULL)
        
      } else if (input$AF_VisNum_Selection==4){
               Sel_SurveysScatter_Vis_4_2_UL(NULL)
               Sel_SurveysBar_Vis_4_2_UL(NULL)
               Sel_SurveysLine_Vis_4_2_UL(NULL)
               Sel_SurveysMap_Vis_4_2_UL(NULL)
               Sel_SurveysAll_Vis_4_2_UL(NULL) 
               MapVis4_2_SelectedWB_SHP(NULL)
              
      }
  }  
  )
  
      Vis_3_DataComplete<-reactive({
        if (input$AF_VisNum_Selection==3){
        req(Data_3_3_Complete_Percentiles())
        Data_3_3_Complete_Percentiles()
      } else if (input$AF_VisNum_Selection==4){
        req(Data_4_3_Complete_Percentiles())
        Data_4_3_Complete_Percentiles()
      }
    }) 
    
    output$Vis_3_VisSelect_Make<-DT::renderDT(
      Vis_3_DataComplete(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_3_VisSelect_Make table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_3_VisSelect_Make table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
    
    
    observeEvent(c(input$Vis_3_VisSelect_Make_rows_selected),{
    
    req(input$AF_VisNum_Selection)
    
        Vis_3_Ids<-input$Vis_3_VisSelect_Make_rows_selected
        PH<-Vis_3_DataComplete()[Vis_3_Ids,]
        
     if (input$AF_VisNum_Selection==3){
               Sel_SurveysScatter_Vis_3_3_UL(PH)
               Sel_SurveysBar_Vis_3_3_UL(PH)
               Sel_SurveysLine_Vis_3_3_UL(PH)
               Sel_SurveysMap_Vis_3_3_UL(PH)
               Sel_SurveysAll_Vis_3_3_UL(PH)
               
               SelectedWB<-right_join(Creel_SHP_Vis3_3()[,c("Survey_ID")],PH,by="Survey_ID")
               MapVis3_3_SelectedWB_SHP(SelectedWB)
        
      } else if (input$AF_VisNum_Selection==4){
               Sel_SurveysScatter_Vis_4_3_UL(PH)
               Sel_SurveysBar_Vis_4_3_UL(PH)
               Sel_SurveysLine_Vis_4_3_UL(PH)
               Sel_SurveysMap_Vis_4_3_UL(PH)
               Sel_SurveysAll_Vis_4_3_UL(PH)  
               
               SelectedWB<-right_join(Creel_SHP_Vis4_3()[,c("Survey_ID")],PH,by="Survey_ID")
               MapVis4_3_SelectedWB_SHP(SelectedWB)
              
      }
        
  
  })
    
  Vis_3_SelTable_Length<-reactive({
    
    req(input$AF_VisNum_Selection)
    
    length(input$Vis_3_VisSelect_Make_rows_selected)
  })
  
  observeEvent(c(Vis_3_SelTable_Length()),{
    req(Vis_3_SelTable_Length()<1)
    
      if (input$AF_VisNum_Selection==3){
               Sel_SurveysScatter_Vis_3_3_UL(NULL)
               Sel_SurveysBar_Vis_3_3_UL(NULL)
               Sel_SurveysLine_Vis_3_3_UL(NULL)
               Sel_SurveysMap_Vis_3_3_UL(NULL)
               Sel_SurveysAll_Vis_3_3_UL(NULL)
               MapVis3_3_SelectedWB_SHP(NULL)
        
      } else if (input$AF_VisNum_Selection==4){
               Sel_SurveysScatter_Vis_4_3_UL(NULL)
               Sel_SurveysBar_Vis_4_3_UL(NULL)
               Sel_SurveysLine_Vis_4_3_UL(NULL)
               Sel_SurveysMap_Vis_4_3_UL(NULL)
               Sel_SurveysAll_Vis_4_3_UL(NULL) 
               MapVis4_3_SelectedWB_SHP(NULL)
              
      }
  },ignoreInit=TRUE)
  
Vis_4_DataComplete<-reactive({
  if (input$AF_VisNum_Selection==4){
        req(Data_4_4_Complete_Percentiles())
        Data_4_4_Complete_Percentiles()
      }
    }) 
    
    output$Vis_4_VisSelect_Make<-DT::renderDT(
      Vis_4_DataComplete(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_4_VisSelect_Make table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_4_VisSelect_Make table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
    
    
    observeEvent(c(input$Vis_4_VisSelect_Make_rows_selected),{
    
      req(input$AF_VisNum_Selection)
      req(input$AF_VisNum_Selection==4)
      
      Vis_3_Ids<-input$Vis_3_VisSelect_Make_rows_selected
        PH<-Vis_3_DataComplete()[Vis_3_Ids,]
      
               Sel_SurveysScatter_Vis_4_4_UL(PH)
               Sel_SurveysBar_Vis_4_4_UL(PH)
               Sel_SurveysLine_Vis_4_4_UL(PH)
               Sel_SurveysMap_Vis_4_4_UL(PH)
               Sel_SurveysAll_Vis_4_4_UL(PH)  
               
               SelectedWB<-right_join(Creel_SHP_Vis4_4()[,c("Survey_ID")],PH,by="Survey_ID")
               MapVis4_4_SelectedWB_SHP(SelectedWB)
        
  
  },ignoreInit=TRUE)
    
  Vis_4_SelTable_Length<-reactive({
    
    req(input$AF_VisNum_Selection)
    
    length(input$Vis_4_VisSelect_Make_rows_selected)
  })
  
  observeEvent(c(Vis_4_SelTable_Length()),{
    req(Vis_4_SelTable_Length()<1)
    
      req(input$AF_VisNum_Selection==4)
      
               Sel_SurveysScatter_Vis_4_4_UL(NULL)
               Sel_SurveysBar_Vis_4_4_UL(NULL)
               Sel_SurveysLine_Vis_4_4_UL(NULL)
               Sel_SurveysMap_Vis_4_4_UL(NULL)
               Sel_SurveysAll_Vis_4_4_UL(NULL) 
               MapVis4_4_SelectedWB_SHP(NULL)
              
      
  }  
  )
    
     output$Vis_1_VisSelect<-DT::renderDT(
      Vis_1_VisSelectedTBL(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_1_VisSelect table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_1_VisSelect table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
     
      output$Vis_2_VisSelect<-DT::renderDT(
      Vis_2_VisSelectedTBL(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_2_VisSelect table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_2_VisSelect table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
      
       output$Vis_3_VisSelect<-DT::renderDT(
      Vis_3_VisSelectedTBL(),
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_3_VisSelect table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_3_VisSelect table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
       
    output$Vis_4_VisSelect<-DT::renderDT(
      Vis_4_VisSelectedTBL,
      extensions=c('Buttons','Select'),
      options=list(
        pageLength=25,
        scrollX=TRUE,
        select=list(style='os',items='row'),
        dom='Blfrtip',
        rowID='Survey_ID',
        buttons = list(list(extend='selectAll',className='selectAll',
                                text="Select All Filtered",
                                action=DT::JS("function () {
                                var table = $('#Vis_4_VisSelect table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).deselect();
                                table.rows({ search: 'applied'}).select();
                }")
            ), 
            list(extend='selectNone',className='selectNone',
                 text="Deselect All Filtered",
                 action=DT::JS("function () {
                                var table = $('#Vis_4_VisSelect table.dataTable').DataTable();
                                table.rows({ search: 'applied'}).select();
                                table.rows({ search: 'applied'}).deselect();

                }")
            ),
          'selectAll','selectNone','copy','csv','excel','pdf','print')),
      selection='none',
      class="display nowrap compact",
      filter="top",
      server = FALSE
    )
    

    
  output$Vis_1_Input_SelectCount<-reactive({
    
      if(is.null(input$AF_VisNum_Selection)){
        PH<-0
      }else if(input$AF_VisNum_Selection==1){
        PH<-length(input$Vis_1_Input_rows_selected)
      }else if(is.null(input$AF_SharedData)){
        PH<-0
      }else if(input$AF_SharedData=='Yes'){
        PH<-length(input$Vis_Filters_Shared_rows_selected)
      }else{
        PH<-length(input$Vis_1_Input_rows_selected)
      }
        return(PH)
          
    })
    
    outputOptions(output,'Vis_1_Input_SelectCount',suspendWhenHidden=FALSE)
    
    output$Vis_2_Input_SelectCount<-reactive({
      if(is.null(input$AF_SharedData)){
        PH<-0
      } else if(input$AF_SharedData=='Yes'){
        PH<-length(input$Vis_Filters_Shared_rows_selected)
      }else{
        PH<-length(input$Vis_2_Input_rows_selected)
      }
      return(PH)
    })
    outputOptions(output,'Vis_2_Input_SelectCount',suspendWhenHidden=FALSE)
    
    output$Vis_3_Input_SelectCount<-reactive({
      if(is.null(input$AF_SharedData)){
        PH<-0
      } else if(input$AF_SharedData=='Yes'){
        PH<-length(input$Vis_Filters_Shared_rows_selected)
      }else{
        PH<-length(input$Vis_3_Input_rows_selected)
      }
      return(PH)
    })
    outputOptions(output,'Vis_3_Input_SelectCount',suspendWhenHidden=FALSE)
    
    output$Vis_4_Input_SelectCount<-reactive({
      
      if(is.null(input$AF_SharedData)){
        PH<-0
      } else if(input$AF_SharedData=='Yes'){
        PH<-length(input$Vis_Filters_Shared_rows_selected)
      }else{
        PH<-length(input$Vis_4_Input_rows_selected)
      }
      return(PH)
    })
    
    outputOptions(output,'Vis_4_Input_SelectCount',suspendWhenHidden=FALSE)

    #### Data Submission ####

    #### File Upload ####

    observeEvent(input$File_Upload_Button,
                 {
                     if(input$FileUploadState_Input!=""&&input$FileUploadYear_Input!=""&&input$FileUploadCreator_Input!=""&&input$FileUploadDate_Input!=""&&input$FileUploadCreatorEmail_Input!=""&&input$FileUploadCreatorAffiliation_Input!="")
                     {
                         #### Create New Folder ####
                         observe({if(is.null(input$File_Upload_Button)){
                             runjs("
                                var click=0;
                                Shiny.onInputChange('File_Upload_Button',click)
                                var File_Upload_Button = document.getElementByID('File_Upload_Button')
                                File_Upload_Button.onclick = function() {click += 1; Shiny.onInputChange('File_Upload_Button', click)};
                                ")
                         }})
                         NewFolderName()<-renderText({paste(input$FileUploadState_Input,"_",input$FileUploadYear_Input,"_",input$FileUploadCreator_Input,"_",input$FileUploadDate_Input,"_",input$FileUploadCreatorEmail_Input,"_",input$FileUploadCreatorAffiliation_Input)})
                         drive_mkdir("TEST",path="File Submissions")

                         #### Write Data Note ####


                         #### Upload File ####

                         drive_upload(media = input$Btn_CreelCatUpload$datapath,
                                      name = input$Btn_CreelCatUpload$name
                         )

                     }
                     else
                     {
                         showModal(modalDialog(title ="Warning!!!", "Please fill all required fields before you click the Upload File buttion!!!"))
                     }
                 },ignoreInit=TRUE)





   
   
   
   
   
   
    #### Create New Folder ####
    
    
    #### Write Data Note ####
    
    
    #### Upload File ####
    
    observeEvent(input$Btn_CreelCatUpload, {
        drive_upload(media = input$Btn_CreelCatUpload$datapath,
                     name = input$Btn_CreelCatUpload$name)
    },ignoreInit=TRUE)
    
    
    #### Direct Input ####
    #### Create New Folder ####
    
    #### Create Copy of Database ####
    
    #### Write Data Note ####
    
    #### Print Link to Data ####
    
    #### Link to Personal Data ####
    
    
    
    
}
# Run the application 
shinyApp(ui = ui, server = server)

